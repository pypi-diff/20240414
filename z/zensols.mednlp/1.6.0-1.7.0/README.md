# Comparing `tmp/zensols.mednlp-1.6.0-py3-none-any.whl.zip` & `tmp/zensols.mednlp-1.7.0-py3-none-any.whl.zip`

## zipinfo {}

```diff
@@ -1,34 +1,34 @@
-Zip file size: 31942 bytes, number of entries: 32
--rw-rw-r--  2.0 unx      218 b- defN 24-Feb-27 23:23 zensols/mednlp/__init__.py
--rw-rw-r--  2.0 unx     6938 b- defN 24-Feb-27 23:23 zensols/mednlp/app.py
--rw-rw-r--  2.0 unx      830 b- defN 24-Feb-27 23:23 zensols/mednlp/cli.py
--rw-rw-r--  2.0 unx     4563 b- defN 24-Feb-27 23:23 zensols/mednlp/ctakes.py
--rw-rw-r--  2.0 unx     1737 b- defN 24-Feb-27 23:23 zensols/mednlp/cui2vec.py
--rw-rw-r--  2.0 unx     1078 b- defN 24-Feb-27 23:23 zensols/mednlp/domain.py
--rw-rw-r--  2.0 unx     3733 b- defN 24-Feb-27 23:23 zensols/mednlp/entlink.py
--rw-rw-r--  2.0 unx     3628 b- defN 24-Feb-27 23:23 zensols/mednlp/lib.py
--rw-rw-r--  2.0 unx     2583 b- defN 24-Feb-27 23:23 zensols/mednlp/parser.py
--rw-rw-r--  2.0 unx     8215 b- defN 24-Feb-27 23:23 zensols/mednlp/resource.py
--rw-rw-r--  2.0 unx     4536 b- defN 24-Feb-27 23:23 zensols/mednlp/tok.py
--rw-rw-r--  2.0 unx    10311 b- defN 24-Feb-27 23:23 zensols/mednlp/uts.py
--rw-r--r--  2.0 unx     1756 b- defN 24-Feb-27 23:23 zensols/mednlp/resources/app.conf
--rw-r--r--  2.0 unx      377 b- defN 24-Feb-27 23:23 zensols/mednlp/resources/ctakes.conf
--rw-rw-r--  2.0 unx     2843 b- defN 24-Feb-27 23:23 zensols/mednlp/resources/cui2vec.yml
--rw-r--r--  2.0 unx      415 b- defN 24-Feb-27 23:23 zensols/mednlp/resources/default.conf
--rw-r--r--  2.0 unx      414 b- defN 24-Feb-27 23:23 zensols/mednlp/resources/entlink.conf
--rw-r--r--  2.0 unx      464 b- defN 24-Feb-27 23:23 zensols/mednlp/resources/filter-medical.conf
--rw-r--r--  2.0 unx      617 b- defN 24-Feb-27 23:23 zensols/mednlp/resources/install-v1.conf
--rw-r--r--  2.0 unx      850 b- defN 24-Feb-27 23:23 zensols/mednlp/resources/install-v2.conf
--rw-r--r--  2.0 unx      820 b- defN 24-Feb-27 23:23 zensols/mednlp/resources/install.conf
--rw-r--r--  2.0 unx     4900 b- defN 24-Feb-27 23:23 zensols/mednlp/resources/lang.conf
--rw-r--r--  2.0 unx      507 b- defN 24-Feb-27 23:23 zensols/mednlp/resources/obj.conf
--rw-r--r--  2.0 unx      450 b- defN 24-Feb-27 23:23 zensols/mednlp/resources/uts.conf
--rw-r--r--  2.0 unx      358 b- defN 24-Feb-27 23:23 zensols/mednlp/resources/requirements/model-extra.txt
--rw-r--r--  2.0 unx      248 b- defN 24-Feb-27 23:23 zensols/mednlp/resources/requirements/model.txt
--rw-r--r--  2.0 unx      128 b- defN 24-Feb-27 23:23 zensols/mednlp/resources/requirements/scispacy.txt
--rw-rw-r--  2.0 unx     6987 b- defN 24-Feb-27 23:23 zensols.mednlp-1.6.0.dist-info/METADATA
--rw-rw-r--  2.0 unx       92 b- defN 24-Feb-27 23:23 zensols.mednlp-1.6.0.dist-info/WHEEL
--rw-rw-r--  2.0 unx       47 b- defN 24-Feb-27 23:23 zensols.mednlp-1.6.0.dist-info/entry_points.txt
--rw-rw-r--  2.0 unx       15 b- defN 24-Feb-27 23:23 zensols.mednlp-1.6.0.dist-info/top_level.txt
--rw-rw-r--  2.0 unx     2823 b- defN 24-Feb-27 23:23 zensols.mednlp-1.6.0.dist-info/RECORD
-32 files, 73481 bytes uncompressed, 27344 bytes compressed:  62.8%
+Zip file size: 32242 bytes, number of entries: 32
+-rw-rw-r--  2.0 unx      655 b- defN 24-Apr-14 20:16 zensols/mednlp/__init__.py
+-rw-rw-r--  2.0 unx     6938 b- defN 24-Apr-14 20:16 zensols/mednlp/app.py
+-rw-rw-r--  2.0 unx      830 b- defN 24-Apr-14 20:16 zensols/mednlp/cli.py
+-rw-rw-r--  2.0 unx     4563 b- defN 24-Apr-14 20:16 zensols/mednlp/ctakes.py
+-rw-rw-r--  2.0 unx     1737 b- defN 24-Apr-14 20:16 zensols/mednlp/cui2vec.py
+-rw-rw-r--  2.0 unx     1078 b- defN 24-Apr-14 20:16 zensols/mednlp/domain.py
+-rw-rw-r--  2.0 unx     3732 b- defN 24-Apr-14 20:16 zensols/mednlp/entlink.py
+-rw-rw-r--  2.0 unx     3628 b- defN 24-Apr-14 20:16 zensols/mednlp/lib.py
+-rw-rw-r--  2.0 unx     2359 b- defN 24-Apr-14 20:16 zensols/mednlp/parser.py
+-rw-rw-r--  2.0 unx     9718 b- defN 24-Apr-14 20:16 zensols/mednlp/resource.py
+-rw-rw-r--  2.0 unx     4546 b- defN 24-Apr-14 20:16 zensols/mednlp/tok.py
+-rw-rw-r--  2.0 unx    10311 b- defN 24-Apr-14 20:16 zensols/mednlp/uts.py
+-rw-r--r--  2.0 unx     1756 b- defN 24-Apr-14 20:16 zensols/mednlp/resources/app.conf
+-rw-r--r--  2.0 unx      377 b- defN 24-Apr-14 20:16 zensols/mednlp/resources/ctakes.conf
+-rw-rw-r--  2.0 unx     2843 b- defN 24-Apr-14 20:16 zensols/mednlp/resources/cui2vec.yml
+-rw-r--r--  2.0 unx      422 b- defN 24-Apr-14 20:16 zensols/mednlp/resources/default.conf
+-rw-r--r--  2.0 unx      414 b- defN 24-Apr-14 20:16 zensols/mednlp/resources/entlink.conf
+-rw-r--r--  2.0 unx      464 b- defN 24-Apr-14 20:16 zensols/mednlp/resources/filter-medical.conf
+-rw-r--r--  2.0 unx      617 b- defN 24-Apr-14 20:16 zensols/mednlp/resources/install-v1.conf
+-rw-r--r--  2.0 unx      850 b- defN 24-Apr-14 20:16 zensols/mednlp/resources/install-v2.conf
+-rw-r--r--  2.0 unx      820 b- defN 24-Apr-14 20:16 zensols/mednlp/resources/install.conf
+-rw-r--r--  2.0 unx     4084 b- defN 24-Apr-14 20:16 zensols/mednlp/resources/lang.conf
+-rw-r--r--  2.0 unx      507 b- defN 24-Apr-14 20:16 zensols/mednlp/resources/obj.conf
+-rw-r--r--  2.0 unx      450 b- defN 24-Apr-14 20:16 zensols/mednlp/resources/uts.conf
+-rw-r--r--  2.0 unx      358 b- defN 24-Apr-14 20:16 zensols/mednlp/resources/requirements/model-extra.txt
+-rw-r--r--  2.0 unx      248 b- defN 24-Apr-14 20:16 zensols/mednlp/resources/requirements/model.txt
+-rw-r--r--  2.0 unx      128 b- defN 24-Apr-14 20:16 zensols/mednlp/resources/requirements/scispacy.txt
+-rw-rw-r--  2.0 unx     6992 b- defN 24-Apr-14 20:16 zensols.mednlp-1.7.0.dist-info/METADATA
+-rw-rw-r--  2.0 unx       92 b- defN 24-Apr-14 20:16 zensols.mednlp-1.7.0.dist-info/WHEEL
+-rw-rw-r--  2.0 unx       47 b- defN 24-Apr-14 20:16 zensols.mednlp-1.7.0.dist-info/entry_points.txt
+-rw-rw-r--  2.0 unx       15 b- defN 24-Apr-14 20:16 zensols.mednlp-1.7.0.dist-info/top_level.txt
+-rw-rw-r--  2.0 unx     2823 b- defN 24-Apr-14 20:16 zensols.mednlp-1.7.0.dist-info/RECORD
+32 files, 74402 bytes uncompressed, 27644 bytes compressed:  62.8%
```

## zipnote {}

```diff
@@ -75,23 +75,23 @@
 
 Filename: zensols/mednlp/resources/requirements/model.txt
 Comment: 
 
 Filename: zensols/mednlp/resources/requirements/scispacy.txt
 Comment: 
 
-Filename: zensols.mednlp-1.6.0.dist-info/METADATA
+Filename: zensols.mednlp-1.7.0.dist-info/METADATA
 Comment: 
 
-Filename: zensols.mednlp-1.6.0.dist-info/WHEEL
+Filename: zensols.mednlp-1.7.0.dist-info/WHEEL
 Comment: 
 
-Filename: zensols.mednlp-1.6.0.dist-info/entry_points.txt
+Filename: zensols.mednlp-1.7.0.dist-info/entry_points.txt
 Comment: 
 
-Filename: zensols.mednlp-1.6.0.dist-info/top_level.txt
+Filename: zensols.mednlp-1.7.0.dist-info/top_level.txt
 Comment: 
 
-Filename: zensols.mednlp-1.6.0.dist-info/RECORD
+Filename: zensols.mednlp-1.7.0.dist-info/RECORD
 Comment: 
 
 Zip file comment:
```

## zensols/mednlp/__init__.py

```diff
@@ -1,8 +1,23 @@
+def surpress_warnings():
+    """Supress future warnings generated by spaCy and ScispaCy models."""
+    import warnings
+    # spaCy 3.6 and medcat 1.7 - 1.9 warns with what appears to be an
+    # unserialized regular expression from the language model; ScispaCy also
+    # complains
+    warnings.filterwarnings(
+        'ignore',
+        message=r'^Possible set union at position',
+        category=FutureWarning)
+
+
 from .domain import *
 from .uts import UTSError, NoResultsError, AuthenticationError, UTSClient
 from .resource import *
 from .tok import *
 from .lib import *
 from .parser import *
 from .app import *
 from .cli import *
+
+
+surpress_warnings()
```

## zensols/mednlp/entlink.py

```diff
@@ -48,15 +48,15 @@
         return self.cui
 
 
 @dataclass
 class EntitySimilarity(Entity):
     """A similarity measure of a medical concept in cui2vec.
 
-    :see: :meth:`.MedicalFeatureDocumentParser.similarity_by_term`
+    :see: :meth:`.MedCatFeatureDocumentParser.similarity_by_term`
     """
     similiarty: float = field()
 
 
 @dataclass
 class EntityLinkerResource(object):
     """Provides a way resolve :class:`scispacy.linking_utils.Entity` instances
```

## zensols/mednlp/parser.py

```diff
@@ -2,29 +2,28 @@
 
 """
 __author__ = 'Paul Landes'
 
 from typing import Type, Iterable, Dict, Set
 from dataclasses import dataclass, field
 import logging
-import warnings
 import collections
 import textwrap as tw
 from spacy.tokens.doc import Doc
 from spacy.language import Language
 from zensols.nlp import FeatureToken, FeatureDocumentParser
 from zensols.nlp.sparser import SpacyFeatureDocumentParser
 from . import MedNLPError, MedCatResource, MedicalFeatureToken
 from .domain import _MedicalEntity
 
 logger = logging.getLogger(__name__)
 
 
 @dataclass
-class MedicalFeatureDocumentParser(SpacyFeatureDocumentParser):
+class MedCatFeatureDocumentParser(SpacyFeatureDocumentParser):
     """A medical based language resources that parses concepts.
 
     """
     TOKEN_FEATURE_IDS = frozenset(FeatureDocumentParser.TOKEN_FEATURE_IDS |
                                   MedicalFeatureToken.FEATURE_IDS)
     """Default token feature ID set for the medical parser.
 
@@ -41,19 +40,14 @@
     medcat_resource: MedCatResource = field(default=None)
     """The MedCAT factory resource."""
 
     def __post_init__(self):
         if self.medcat_resource is None:
             raise MedNLPError('No medcat resource set')
         super().__post_init__()
-        # filter spacy language warning when using scispacy
-        warnings.filterwarnings(
-            'ignore',
-            message=r'^Possible set union at position',
-            category=FutureWarning)
 
     def _create_model_key(self) -> str:
         return f'name-{self.name}'
 
     def _create_model(self) -> Language:
         return self.medcat_resource.cat.pipe.spacy_nlp
```

## zensols/mednlp/resource.py

```diff
@@ -1,19 +1,21 @@
 """MedCAT wrapper.
 
 """
 __author__ = 'Paul Landes'
 
-from typing import Dict, Any, Set
+from typing import Tuple, Iterable, Dict, Any, Set
 from dataclasses import dataclass, field, InitVar
 import logging
 import warnings
 from pathlib import Path
+import re
 from frozendict import frozendict
 import pandas as pd
+import spacy.util
 from medcat.config import Config, MixingConfig
 from medcat.vocab import Vocab
 from medcat.cdb import CDB
 from medcat.cat import CAT
 from medcat.meta_cat import MetaCAT
 from zensols.util import APIError
 from zensols.install import Resource, Installer
@@ -23,14 +25,17 @@
 
 
 @dataclass
 class MedCatResource(object):
     """A factory class that creates MedCAT resources.
 
     """
+    _MODEL_REGEX = re.compile(r'^([^@]+) @ .+$')
+    """A regular expression for a spaCy model dependency (http syntax)."""
+
     installer: Installer = field()
     """Installs and provides paths to the model files."""
 
     vocab_resource: Resource = field()
     """The path to the ``vocab.dat`` file."""
 
     cdb_resource: Resource = field()
@@ -60,15 +65,16 @@
     to generate a list of CUIs from those mapped from ``name`` to ``tui` in
     :obj:`groups`.
 
     """
     spacy_enable_components: Set[str] = field(
         default_factory=lambda: set('sentencizer parser'.split()))
     """By default, MedCAT disables several pipeline components.  Some of these
-    are needed for sentence chunking and other downstream tasks.
+    are needed for sentence chunking and other downstream tasks.  Otherwise
+    sentence indexing won't work because sentence boundaries are missing.
 
     :see: `MedCAT Config <https://github.com/CogStack/MedCAT/blob/master/medcat/config.py>`_
 
     """
     cat_config: Dict[str, Dict[str, Any]] = field(default=None)
     """If provieded, set the CDB configuration.  Keys are ``general``,
     ``preprocessing`` and all other attributes documented in the `MedCAT Config
@@ -78,14 +84,17 @@
     cache_global: InitVar[bool] = field(default=True)
     """Whether or not to globally cache resources, which saves load time.
 
     """
     requirements_dir: Path = field(default=None)
     """The directory with the pip requirements files."""
 
+    auto_install_models: Tuple[str, ...] = field(default=())
+    """A list of spaCy models that will be installed if not already."""
+
     def __post_init__(self, cache_global: bool):
         self._tuis = PersistedWork('_tuis', self, cache_global=cache_global)
         self._cat = PersistedWork('_cat', self, cache_global=cache_global)
         self._installed = False
 
     @staticmethod
     def _filter_medcat_logger():
@@ -175,49 +184,76 @@
         mc_status = MetaCAT.load(self.installer[self.mc_status_resource])
         # enable sentence boundary annotation
         for name in self.spacy_enable_components:
             cdb.config.general['spacy_disabled_components'].remove(name)
         # override configuration
         if self.cat_config is not None:
             self._override_config(cdb.config, self.cat_config)
-        #
+        # add TUI filters (i.e. filter out non-medical terms)
         self._add_filters(cdb.config, cdb)
+        # ensure models are installed
+        self._assert_spacy_models()
         # create cat - each cdb comes with a config that was used to train it;
         # you can change that config in any way you want, before or after
         # creating cat
         try:
-            with warnings.catch_warnings():
-                # spaCy 3.6 and medcat 1.7 - 1.9 warns with what appears to be
-                # an unserialized regular expression from the language model
-                warnings.filterwarnings(
-                    'ignore',
-                    category=FutureWarning,
-                    message='^Possible set union at position')
-                cat = CAT(cdb=cdb, config=cdb.config, vocab=vocab,
-                          meta_cats=[mc_status])
+            cat = CAT(cdb=cdb, config=cdb.config, vocab=vocab,
+                      meta_cats=[mc_status])
         except OSError as e:
             msg: str = str(e)
             if msg.find("Can't find model") == -1:
                 raise e
             else:
+                logger.info('no scispacy model found--attempting to install')
                 self._install_model()
                 cat = CAT(cdb=cdb, config=cdb.config, vocab=vocab,
                           meta_cats=[mc_status])
         return cat
 
     def _install_model(self):
         if self.requirements_dir is None:
             raise APIError('model not installed and no requirements found')
         else:
-            import pip
-            logger.info('no scispacy model found--attempting to install')
+            from pip._internal import main as pipmain
             req_file: Path
             for req_file in self.requirements_dir.iterdir():
-                pip.main(['install', '--use-deprecated=legacy-resolver',
-                          '-r', str(req_file), '--no-deps'])
+                pipmain(['install', '--use-deprecated=legacy-resolver',
+                         '-r', str(req_file), '--no-deps'])
+
+    def _get_model_requirements(self) -> Iterable[Tuple[str, str]]:
+        path: Path
+        for path in self.requirements_dir.iterdir():
+            with open(path) as f:
+                line: str
+                for line in map(str.strip, f.readlines()):
+                    m: re.Match = self._MODEL_REGEX.match(line)
+                    if m is not None:
+                        yield (m.group(1), line)
+
+    def _install_dependency(self, dep: str):
+        from pip._internal import main as pipmain
+        pipmain(['install', '--use-deprecated=legacy-resolver',
+                 dep, '--no-deps'])
+
+    def _assert_spacy_models(self):
+        missing: Set[str] = set()
+        model_name: str
+        for model_name in self.auto_install_models:
+            if not spacy.util.is_package(model_name):
+                missing.add(model_name)
+        if len(missing) > 0:
+            if logger.isEnabledFor(logging.INFO):
+                logger.info(f'installing missing models: {missing}')
+            reqs: Dict[str, str] = dict(self._get_model_requirements())
+            for model_name in missing:
+                dep: str = reqs.get(model_name)
+                if dep is None:
+                    raise APIError(
+                        f'Resource needs unmapped model: {model_name}')
+                self._install_dependency(dep)
 
     def clear(self):
         self._tuis.clear()
         self._cat.clear()
 
 
 MedCatResource._filter_medcat_logger()
```

## zensols/mednlp/tok.py

```diff
@@ -86,15 +86,15 @@
         """The detected name of the concept."""
         if self.is_concept:
             return self.med_ent.concept_span._.detected_name
         else:
             return self.NONE
 
     @property
-    def sub_names(self) -> Tuple[str]:
+    def sub_names(self) -> Tuple[str, ...]:
         """Return other names for the concept."""
         if self.is_concept:
             return tuple(sorted(self._cdb.cui2names[self.cui_]))
         else:
             return []
 
     @property
@@ -107,15 +107,15 @@
 
     @property
     def definition_(self) -> str:
         """The definition if the concept."""
         return self._definition or FeatureToken.NONE
 
     @property
-    def tuis(self) -> Tuple[str]:
+    def tuis(self) -> Tuple[str, ...]:
         """The the CUI type of the concept."""
         if self.is_concept:
             cui: str = self.cui_
             return tuple(sorted(self._cdb.cui2type_ids.get(cui)))
         else:
             return self._NONE_SET
```

## zensols/mednlp/resources/default.conf

```diff
@@ -1,13 +1,13 @@
 #@meta {desc: 'application context default settings', date: '2024-02-10'}
 
 
 [mednlp_default]
 # see 'Parsers' section in `lang.conf`
-doc_parser = mednlp_combine_doc_parser
+doc_parser = mednlp_combine_medcat_doc_parser
 medcat_version = v1
 cui2vec_encode_transformed = False
 cui2vec_trainable = False
 
 [uts]
 api_key = NOT_SET
 cache_file = ${default:data_dir}/uts-cache
```

## zensols/mednlp/resources/lang.conf

```diff
@@ -14,109 +14,100 @@
 # medical nlp
 [mednlp_map_filter_token_normalizer]
 class_name = zensols.nlp.MapTokenNormalizer
 mapper_class_list = list: filter_token_mapper
 embed_entities = False
 
 
-## NLP Parser overrides
-#
-# install any missing spaCy at runtime (uses pip/effects pip install)
-[doc_parser]
-model_name = ${lang}_core_web_md
-auto_install_model = True
-
-# a biomedical (scispay) parser
-[mednlp_biomed_parser]
-class_name = zensols.nlp.sparser.SpacyFeatureDocumentParser
-lang = en
-model_name = ${lang}_core_sci_md
-token_normalizer = instance: map_filter_token_normalizer
-token_feature_ids = eval({'import': ['zensols.nlp as n']}):
-  n.FeatureToken.FEATURE_IDS
-auto_install_model = True
-
-
 ## MedCat resources
 #
 [medcat_resource]
 class_name = zensols.mednlp.MedCatResource
 installer = instance: medcat_installer
 vocab_resource = instance: medcat_vocab_resource
 cdb_resource = instance: medcat_cdb_resource
 mc_status_resource = instance: medcat_status_resource
 umls_tuis = instance: medcat_umls_tuis
 umls_groups = instance: medcal_uml_groups
 requirements_dir = resource(zensols.mednlp): resources/requirements
-cat_config = dict: {'general': {'spacy_model': 'en_core_sci_md'}}
+cat_config = dict:
+  {'general':
+    {'spacy_model': '${mednlp_biomed_doc_parser:model_name}'}}
 
 [mednlp_library]
 class_name = zensols.mednlp.MedicalLibrary
 medcat_resource = instance: medcat_resource
 # entity_linker_resource is optionally added in entlink.conf
 
-[mednlp_doc_parser]
-class_name = zensols.mednlp.MedicalFeatureDocumentParser
+
+## Base parser
+#
+# nlp parser override
+[doc_parser]
+# midsize model for standard NER
+model_name = ${lang}_core_web_md
+# install any missing spaCy models at runtime
+auto_install_model = True
+
+
+## Biomedical parsers
+#
+# ScispaCy parser
+[mednlp_biomed_doc_parser]
+class_name = zensols.nlp.sparser.SpacyFeatureDocumentParser
+lang = ${doc_parser:lang}
+# not very useful without using an entity recognizer model
+# model_name = en_ner_bionlp13cg_md
+# model_name = en_ner_jnlpba_md
+model_name = ${lang}_core_sci_md
+token_normalizer = instance: map_filter_token_normalizer
+token_feature_ids = eval({'import': ['zensols.nlp as n']}):
+  n.FeatureToken.FEATURE_IDS
+# install any missing spaCy models at runtime
+auto_install_model = True
+
+# MedCAT features (CUIs, TUIs etc.)
+[mednlp_medcat_doc_parser]
+class_name = zensols.mednlp.MedCatFeatureDocumentParser
 lang = ${doc_parser:lang}
 model_name = ${doc_parser:model_name}
 token_normalizer = instance: mednlp_map_filter_token_normalizer
 medcat_resource = instance: medcat_resource
 # set all features (override in your own configuration if you want them all)
 token_feature_ids = eval({'import': ['zensols.nlp as n', 'zensols.mednlp as m']}):
-  (n.FeatureToken.FEATURE_IDS | m.MedicalFeatureToken.FEATURE_IDS) - \
-  {'tuis', 'tui_descs_'}
+  (n.FeatureToken.FEATURE_IDS | m.MedicalFeatureToken.FEATURE_IDS)
 
 
-## Parsers
+## Combined parsers
 #
-# takes first the features of a default (doc_parser), then MedCAT features
-[mednlp_combine_doc_parser]
+# adds biomedical ScispaCy features (ent_) to the delegate (doc_parser)
+[mednlp_combine_biomed_doc_parser]
 class_name = zensols.nlp.combine.MappingCombinerFeatureDocumentParser
-target_parser = instance: doc_parser
-source_parsers = instance: list: mednlp_doc_parser
+delegate = instance: doc_parser
+source_parsers = instance: list: mednlp_biomed_doc_parser
 # add the FeatureToken attribute regardless
-overwrite_nones = True
-# copy the med entity if not already there
-yield_features = set: ent_, ent, ent_iob, ent_iob_
+#overwrite_nones = False
 # only entities are missing from the medical parser output
-overwrite_features = eval({'import': ['zensols.mednlp as m']}):
-  (m.MedicalFeatureToken.FEATURE_IDS -
-   {'tuis', 'tui_descs_', 'ent', 'ent_', 'ent_iob', 'ent_iob_', 'norm'})
+yield_features = set: ent_, ent, ent_iob, ent_iob_
 # only map token level instead of sentence
 merge_sentences = False
-# include MedCAT parsed features (i.e. 'cui_')
-token_feature_ids = ${mednlp_doc_parser:token_feature_ids}
+token_feature_ids = ${mednlp_biomed_doc_parser:token_feature_ids}
 
-# like `mednlp_combine_doc_parser` but add biomedical spacy parser features;
-# this also produces different features such NER and POS tags
-[mednlp_combine_biomed_doc_parser]
+# adds MedCAT features (CUIs, TUIs etc.) to the delegate (doc_parser)
+[mednlp_combine_medcat_doc_parser]
 class_name = zensols.nlp.combine.MappingCombinerFeatureDocumentParser
-target_parser = instance: doc_parser
-source_parsers = instance: list: mednlp_doc_parser, mednlp_biomed_parser
+delegate = instance: doc_parser
+source_parsers = instance: list: mednlp_medcat_doc_parser
 # add the FeatureToken attribute regardless
 overwrite_nones = True
-# add entities from MedCAT output in addition to the scispacy biomedical
-yield_features = eval({'import': ['zensols.nlp as n', 'zensols.mednlp as m']}):
-  list(m.MedicalFeatureToken.FEATURE_IDS | {'ent_', 'ent', 'ent_iob', 'ent_iob_'})
-# add feature nones for medical missing medical features, meaning `cui_` will
-# be `-<N>-` instead of missing from feature tokens
-yield_feature_defaults = eval({'import': ['zensols.nlp as n']}):
-  n.FeatureToken.NONE
-# keep the scispacy biomedical features, but don't overwrite default parser's
-# entity or norms
-overwrite_features = eval({'import': ['zensols.nlp as n']}):
-  list(n.FeatureToken.FEATURE_IDS -
-  {'norm', 'i', 'idx', 'i_sent', 'sent_i', 'ent_', 'ent', 'ent_iob', 'ent_iob_'})
+# only entities are missing from the medical parser output
+overwrite_features = eval({'import': ['zensols.mednlp as m']}):
+  m.MedicalFeatureToken.FEATURE_IDS
 # only map token level instead of sentence
 merge_sentences = False
-# include MedCAT parsed features (i.e. 'cui_')
-token_feature_ids = ${mednlp_doc_parser:token_feature_ids}
+token_feature_ids = ${mednlp_medcat_doc_parser:token_feature_ids}
 
-# another combiner that makes prioritizes MedCAT features
-[mednlp_combine_medfirst_doc_parser]
+# adds both biomedical ScispaCy and MedCAT features
+[mednlp_combine_biomed_medcat_doc_parser]
 class_name = zensols.nlp.combine.MappingCombinerFeatureDocumentParser
-target_parser = instance: mednlp_doc_parser
-source_parsers = instance: list: doc_parser
-# only entities are missing from the medical parser output
-overwrite_features = list: ent, ent_, ent_iob, ent_iob_, norm
-# only map token level instead of sentence
-merge_sentences = False
+delegate = instance: doc_parser
+source_parsers = instance: list: mednlp_combine_biomed_doc_parser, mednlp_combine_medcat_doc_parser
```

## Comparing `zensols.mednlp-1.6.0.dist-info/METADATA` & `zensols.mednlp-1.7.0.dist-info/METADATA`

 * *Files 2% similar despite different names*

```diff
@@ -1,28 +1,28 @@
 Metadata-Version: 2.1
 Name: zensols.mednlp
-Version: 1.6.0
+Version: 1.7.0
 Summary: A natural language medical domain parsing library.
 Home-page: https://github.com/plandes/mednlp
-Download-URL: https://github.com/plandes/mednlp/releases/download/v1.6.0/zensols.mednlp-1.6.0-py3-none-any.whl
+Download-URL: https://github.com/plandes/mednlp/releases/download/v1.7.0/zensols.mednlp-1.7.0-py3-none-any.whl
 Author: Paul Landes
 Author-email: landes@mailc.net
 Keywords: tooling
 Description-Content-Type: text/markdown
 Requires-Dist: lxml ~=4.9.3
 Requires-Dist: numpy ~=1.25.2
 Requires-Dist: scikit-learn ~=1.3.2
 Requires-Dist: blis ~=0.7.11
 Requires-Dist: pandas ~=2.1.3
 Requires-Dist: scipy ~=1.9.3
 Requires-Dist: scispacy ~=0.5.3
 Requires-Dist: medcat ~=1.9.3
 Requires-Dist: ctakes-parser ~=0.1.0
 Requires-Dist: zensols.install ~=1.1.1
-Requires-Dist: zensols.nlp ~=1.10.0
+Requires-Dist: zensols.nlp ~=1.11.0
 
 # Medical natural language parsing and utility library
 
 [![PyPI][pypi-badge]][pypi-link]
 [![Python 3.10][python310-badge]][python310-link]
 [![Python 3.11][python311-badge]][python311-link]
 [![Build Status][build-badge]][build-link]
@@ -82,15 +82,15 @@
 ```
 See the [full example](example/features/simple.py), and for other
 functionality, see the [examples](example).
 
 
 ## MedCAT Models
 
-By default, this library the small MedCAT model used for
+By default, this library uses the small MedCAT model used for
 [tutorials](https://github.com/CogStack/MedCATtutorials/pull/12), and is not
 sufficient for any serious project.  To get the UMLS trained model,the [MedCAT
 UMLS request form] from be filled out (see the [MedCAT] repository).
 
 After you obtain access and download the new model, add the following to
 `~/.mednlprc` with the following:
```

## Comparing `zensols.mednlp-1.6.0.dist-info/RECORD` & `zensols.mednlp-1.7.0.dist-info/RECORD`

 * *Files 17% similar despite different names*

```diff
@@ -1,32 +1,32 @@
-zensols/mednlp/__init__.py,sha256=bTMl3yZuX6Wbc6VUXafkrcgQznPEyZ97w-g5g-LUhJ0,218
+zensols/mednlp/__init__.py,sha256=TGw2daJf3j8p5us7vZ2KDOWUffGvCv3xiu4pkbnK-CM,655
 zensols/mednlp/app.py,sha256=vZ4aThMM4UalMt0JeUn2lDL0IemmKEJArzswNtP92SA,6938
 zensols/mednlp/cli.py,sha256=1rpoNogseYAm04IWvbsEFg194xMrU0VK_FIQWWU-WXk,830
 zensols/mednlp/ctakes.py,sha256=GWobSvIy0axnAmXaTTelgi0pSejyKyqcXUlDmtoDweo,4563
 zensols/mednlp/cui2vec.py,sha256=Yxy8E2LqHsiJFusbnYVcuacQQZ_OrF3IYYRHPawvPUQ,1737
 zensols/mednlp/domain.py,sha256=MjbJgZNNtSUk8poAiSetf1NhLV9vpj6rYw5_nZoFxVU,1078
-zensols/mednlp/entlink.py,sha256=pvXY0dQFGotcaTREEkvoVM6WQ8ZUbu1wdcZaIvExBoM,3733
+zensols/mednlp/entlink.py,sha256=gHBQbJwxvvdTNM20oktd0aKCFDxym0MPEjpQxgCMuPo,3732
 zensols/mednlp/lib.py,sha256=zeAhDP3bgtX8h98v_ir14flXb38KoiXWIZCCX9Ur9ag,3628
-zensols/mednlp/parser.py,sha256=igXt_LSFNihVQlUb0GFXYHWfUc_ziq0MtmUUrSqVyu0,2583
-zensols/mednlp/resource.py,sha256=dFSZtiHZOEykQJVjr9EFRJMSwysq8dPQLedJh3CnT3s,8215
-zensols/mednlp/tok.py,sha256=W3Ivy5MfN9ZHU_Xea8jsep102jLF1yqcLbFTI9DoQNU,4536
+zensols/mednlp/parser.py,sha256=jaX1I6d26LcH7NjRLQewLR3UzbjtuUcKMlTrzampINg,2359
+zensols/mednlp/resource.py,sha256=8JtWvUhpcaU8C8mjFtbzRLn92a667PSExi5pyAvvF3s,9718
+zensols/mednlp/tok.py,sha256=mQHYEFsSRFuDyqxlB11Bucs_wpwZPpWdwJWmyL-0Jtw,4546
 zensols/mednlp/uts.py,sha256=WFHYi3YgU8OMwm4Ba69pgq3nNBUOtMz0B9BnuF8pwFU,10311
 zensols/mednlp/resources/app.conf,sha256=5tI3uvjRh9dqnKBgcnzoG6bZSr_UeAQMQ4wCVedULkU,1756
 zensols/mednlp/resources/ctakes.conf,sha256=EBceHf6BzeQy5VrX1tARTOOVDEAzhWMlizssiFLfemU,377
 zensols/mednlp/resources/cui2vec.yml,sha256=0cRu40bLjZzNQuPcoHBhEb0FyWRYp1DEj-QrzD_x7mc,2843
-zensols/mednlp/resources/default.conf,sha256=9_aqkas_cArydwhKHWBpbvvXka0TQPqFELpVzki8upA,415
+zensols/mednlp/resources/default.conf,sha256=-26EXwmyjaP7MV_UMonkMqbg5AzDwnBPVruyHG4W39M,422
 zensols/mednlp/resources/entlink.conf,sha256=_XsjX973r-FJkPrZPRq6Wue1L-D2bwZuUadxZujDjdI,414
 zensols/mednlp/resources/filter-medical.conf,sha256=BUHi3MeEgnCbS9-1ZwEJb9V0Sn1ENv_2xM8S0lfgvfg,464
 zensols/mednlp/resources/install-v1.conf,sha256=-PDG2xElBUfObhEkBOZuahAjIya-IfX5qfXUbsYWCGM,617
 zensols/mednlp/resources/install-v2.conf,sha256=uKdmxalFaDPj72l_rap3wAr08tpjD9xXz_1kyt6N7pU,850
 zensols/mednlp/resources/install.conf,sha256=0Puq91Pavmy_YFbCjMxiDzAHytMJyGqJ0ejNB02kZPE,820
-zensols/mednlp/resources/lang.conf,sha256=gyvFmCpPn-VMUI5Qlwb_md2h4LuXZjm0ClQFFFQylD8,4900
+zensols/mednlp/resources/lang.conf,sha256=a-SohWi-1jihUXZgr40Fe6S7iJQVhKKapxhrk9Ei9CU,4084
 zensols/mednlp/resources/obj.conf,sha256=dElemm8UwusTjpz2DiavSd36soByIItjCsgwNC_EmMc,507
 zensols/mednlp/resources/uts.conf,sha256=pB2vY7SZrv63rGbcUumUCHEZ1Xlcm3cd9xIBtdEnAYQ,450
 zensols/mednlp/resources/requirements/model-extra.txt,sha256=aqu6zHPEoCJ9s50en84L1uJVcx2z6phPNMFxPxcFK-M,358
 zensols/mednlp/resources/requirements/model.txt,sha256=3tCL3wOV_P0jDao18mfZh0HpzWyMLy8sXOrpURiF1Y0,248
 zensols/mednlp/resources/requirements/scispacy.txt,sha256=KYNuZUMinJnM5gtGxkyF1QSEgteYxvKb6zcs7-ivDII,128
-zensols.mednlp-1.6.0.dist-info/METADATA,sha256=iRqwveeip7SLxTYGg7iLcXcVyiuSz2oKUga7Hpz1Ma8,6987
-zensols.mednlp-1.6.0.dist-info/WHEEL,sha256=oiQVh_5PnQM0E3gPdiz09WCNmwiHDMaGer_elqB3coM,92
-zensols.mednlp-1.6.0.dist-info/entry_points.txt,sha256=wmVdvhGasAc4DJDoMqYldOKWdesOFN4waG-OQ1J_U6c,47
-zensols.mednlp-1.6.0.dist-info/top_level.txt,sha256=VCWKF6UqwBVnb18kmh2LUJxfVFMAfMjbAmpoS7R54m8,15
-zensols.mednlp-1.6.0.dist-info/RECORD,,
+zensols.mednlp-1.7.0.dist-info/METADATA,sha256=OQaId4Dg19Ou1K47nFx2DS_IaQfvwHDD4gJcaHG5hSQ,6992
+zensols.mednlp-1.7.0.dist-info/WHEEL,sha256=oiQVh_5PnQM0E3gPdiz09WCNmwiHDMaGer_elqB3coM,92
+zensols.mednlp-1.7.0.dist-info/entry_points.txt,sha256=wmVdvhGasAc4DJDoMqYldOKWdesOFN4waG-OQ1J_U6c,47
+zensols.mednlp-1.7.0.dist-info/top_level.txt,sha256=VCWKF6UqwBVnb18kmh2LUJxfVFMAfMjbAmpoS7R54m8,15
+zensols.mednlp-1.7.0.dist-info/RECORD,,
```

