# Comparing `tmp/sympy_plot_backends-3.2.0.tar.gz` & `tmp/sympy_plot_backends-3.3.0.tar.gz`

## filetype from file(1)

```diff
@@ -1 +1 @@
-gzip compressed data, was "sympy_plot_backends-3.2.0.tar", last modified: Tue Apr  2 19:34:10 2024, max compression
+gzip compressed data, was "sympy_plot_backends-3.3.0.tar", last modified: Sun Apr 14 17:57:04 2024, max compression
```

## Comparing `sympy_plot_backends-3.2.0.tar` & `sympy_plot_backends-3.3.0.tar`

### file list

```diff
@@ -1,182 +1,183 @@
-drwxr-xr-x   0 runner    (1001) docker     (127)        0 2024-04-02 19:34:10.314035 sympy_plot_backends-3.2.0/
--rw-r--r--   0 runner    (1001) docker     (127)     1523 2024-04-02 19:34:06.000000 sympy_plot_backends-3.2.0/LICENSE
--rw-r--r--   0 runner    (1001) docker     (127)       89 2024-04-02 19:34:06.000000 sympy_plot_backends-3.2.0/MANIFEST.in
--rw-r--r--   0 runner    (1001) docker     (127)     6543 2024-04-02 19:34:10.314035 sympy_plot_backends-3.2.0/PKG-INFO
--rw-r--r--   0 runner    (1001) docker     (127)     4430 2024-04-02 19:34:06.000000 sympy_plot_backends-3.2.0/README.md
--rw-r--r--   0 runner    (1001) docker     (127)       38 2024-04-02 19:34:10.314035 sympy_plot_backends-3.2.0/setup.cfg
--rwxr-xr-x   0 runner    (1001) docker     (127)     2025 2024-04-02 19:34:06.000000 sympy_plot_backends-3.2.0/setup.py
-drwxr-xr-x   0 runner    (1001) docker     (127)        0 2024-04-02 19:34:10.282035 sympy_plot_backends-3.2.0/spb/
--rw-r--r--   0 runner    (1001) docker     (127)     3670 2024-04-02 19:34:06.000000 sympy_plot_backends-3.2.0/spb/__init__.py
--rw-r--r--   0 runner    (1001) docker     (127)       22 2024-04-02 19:34:06.000000 sympy_plot_backends-3.2.0/spb/_version.py
-drwxr-xr-x   0 runner    (1001) docker     (127)        0 2024-04-02 19:34:10.282035 sympy_plot_backends-3.2.0/spb/backends/
--rw-r--r--   0 runner    (1001) docker     (127)        0 2024-04-02 19:34:06.000000 sympy_plot_backends-3.2.0/spb/backends/__init__.py
--rw-r--r--   0 runner    (1001) docker     (127)    28636 2024-04-02 19:34:06.000000 sympy_plot_backends-3.2.0/spb/backends/base_backend.py
--rw-r--r--   0 runner    (1001) docker     (127)     2636 2024-04-02 19:34:06.000000 sympy_plot_backends-3.2.0/spb/backends/base_renderer.py
-drwxr-xr-x   0 runner    (1001) docker     (127)        0 2024-04-02 19:34:10.286035 sympy_plot_backends-3.2.0/spb/backends/bokeh/
--rw-r--r--   0 runner    (1001) docker     (127)       54 2024-04-02 19:34:06.000000 sympy_plot_backends-3.2.0/spb/backends/bokeh/__init__.py
--rw-r--r--   0 runner    (1001) docker     (127)    22406 2024-04-02 19:34:06.000000 sympy_plot_backends-3.2.0/spb/backends/bokeh/bokeh.py
-drwxr-xr-x   0 runner    (1001) docker     (127)        0 2024-04-02 19:34:10.286035 sympy_plot_backends-3.2.0/spb/backends/bokeh/renderers/
--rw-r--r--   0 runner    (1001) docker     (127)     1386 2024-04-02 19:34:06.000000 sympy_plot_backends-3.2.0/spb/backends/bokeh/renderers/__init__.py
--rw-r--r--   0 runner    (1001) docker     (127)     1289 2024-04-02 19:34:06.000000 sympy_plot_backends-3.2.0/spb/backends/bokeh/renderers/arrow2d.py
--rw-r--r--   0 runner    (1001) docker     (127)     4723 2024-04-02 19:34:06.000000 sympy_plot_backends-3.2.0/spb/backends/bokeh/renderers/complex.py
--rw-r--r--   0 runner    (1001) docker     (127)     1852 2024-04-02 19:34:06.000000 sympy_plot_backends-3.2.0/spb/backends/bokeh/renderers/contour.py
--rw-r--r--   0 runner    (1001) docker     (127)      897 2024-04-02 19:34:06.000000 sympy_plot_backends-3.2.0/spb/backends/bokeh/renderers/generic.py
--rw-r--r--   0 runner    (1001) docker     (127)     1379 2024-04-02 19:34:06.000000 sympy_plot_backends-3.2.0/spb/backends/bokeh/renderers/geometry.py
--rw-r--r--   0 runner    (1001) docker     (127)      646 2024-04-02 19:34:06.000000 sympy_plot_backends-3.2.0/spb/backends/bokeh/renderers/hvline.py
--rw-r--r--   0 runner    (1001) docker     (127)     4338 2024-04-02 19:34:06.000000 sympy_plot_backends-3.2.0/spb/backends/bokeh/renderers/line2d.py
--rw-r--r--   0 runner    (1001) docker     (127)     2088 2024-04-02 19:34:06.000000 sympy_plot_backends-3.2.0/spb/backends/bokeh/renderers/mcircles.py
--rw-r--r--   0 runner    (1001) docker     (127)     4869 2024-04-02 19:34:06.000000 sympy_plot_backends-3.2.0/spb/backends/bokeh/renderers/ngrid.py
--rw-r--r--   0 runner    (1001) docker     (127)     4317 2024-04-02 19:34:06.000000 sympy_plot_backends-3.2.0/spb/backends/bokeh/renderers/nichols.py
--rw-r--r--   0 runner    (1001) docker     (127)    13489 2024-04-02 19:34:06.000000 sympy_plot_backends-3.2.0/spb/backends/bokeh/renderers/nyquist.py
--rw-r--r--   0 runner    (1001) docker     (127)     4082 2024-04-02 19:34:06.000000 sympy_plot_backends-3.2.0/spb/backends/bokeh/renderers/polezero.py
--rw-r--r--   0 runner    (1001) docker     (127)     3746 2024-04-02 19:34:06.000000 sympy_plot_backends-3.2.0/spb/backends/bokeh/renderers/root_locus.py
--rw-r--r--   0 runner    (1001) docker     (127)     9079 2024-04-02 19:34:06.000000 sympy_plot_backends-3.2.0/spb/backends/bokeh/renderers/sgrid.py
--rw-r--r--   0 runner    (1001) docker     (127)     9708 2024-04-02 19:34:06.000000 sympy_plot_backends-3.2.0/spb/backends/bokeh/renderers/vector2d.py
--rw-r--r--   0 runner    (1001) docker     (127)     4970 2024-04-02 19:34:06.000000 sympy_plot_backends-3.2.0/spb/backends/bokeh/renderers/zgrid.py
-drwxr-xr-x   0 runner    (1001) docker     (127)        0 2024-04-02 19:34:10.286035 sympy_plot_backends-3.2.0/spb/backends/k3d/
--rw-r--r--   0 runner    (1001) docker     (127)       48 2024-04-02 19:34:06.000000 sympy_plot_backends-3.2.0/spb/backends/k3d/__init__.py
--rw-r--r--   0 runner    (1001) docker     (127)    17082 2024-04-02 19:34:06.000000 sympy_plot_backends-3.2.0/spb/backends/k3d/k3d.py
-drwxr-xr-x   0 runner    (1001) docker     (127)        0 2024-04-02 19:34:10.290035 sympy_plot_backends-3.2.0/spb/backends/k3d/renderers/
--rw-r--r--   0 runner    (1001) docker     (127)      612 2024-04-02 19:34:06.000000 sympy_plot_backends-3.2.0/spb/backends/k3d/renderers/__init__.py
--rw-r--r--   0 runner    (1001) docker     (127)      840 2024-04-02 19:34:06.000000 sympy_plot_backends-3.2.0/spb/backends/k3d/renderers/arrow3d.py
--rw-r--r--   0 runner    (1001) docker     (127)     2711 2024-04-02 19:34:06.000000 sympy_plot_backends-3.2.0/spb/backends/k3d/renderers/complex.py
--rw-r--r--   0 runner    (1001) docker     (127)      262 2024-04-02 19:34:06.000000 sympy_plot_backends-3.2.0/spb/backends/k3d/renderers/geometry.py
--rw-r--r--   0 runner    (1001) docker     (127)      865 2024-04-02 19:34:06.000000 sympy_plot_backends-3.2.0/spb/backends/k3d/renderers/implicit3d.py
--rw-r--r--   0 runner    (1001) docker     (127)     2424 2024-04-02 19:34:06.000000 sympy_plot_backends-3.2.0/spb/backends/k3d/renderers/line3d.py
--rw-r--r--   0 runner    (1001) docker     (127)     2877 2024-04-02 19:34:06.000000 sympy_plot_backends-3.2.0/spb/backends/k3d/renderers/surface.py
--rw-r--r--   0 runner    (1001) docker     (127)     3225 2024-04-02 19:34:06.000000 sympy_plot_backends-3.2.0/spb/backends/k3d/renderers/vector3d.py
-drwxr-xr-x   0 runner    (1001) docker     (127)        0 2024-04-02 19:34:10.290035 sympy_plot_backends-3.2.0/spb/backends/matplotlib/
--rw-r--r--   0 runner    (1001) docker     (127)      142 2024-04-02 19:34:06.000000 sympy_plot_backends-3.2.0/spb/backends/matplotlib/__init__.py
--rw-r--r--   0 runner    (1001) docker     (127)    30389 2024-04-02 19:34:06.000000 sympy_plot_backends-3.2.0/spb/backends/matplotlib/matplotlib.py
-drwxr-xr-x   0 runner    (1001) docker     (127)        0 2024-04-02 19:34:10.294035 sympy_plot_backends-3.2.0/spb/backends/matplotlib/renderers/
--rw-r--r--   0 runner    (1001) docker     (127)     2069 2024-04-02 19:34:06.000000 sympy_plot_backends-3.2.0/spb/backends/matplotlib/renderers/__init__.py
--rw-r--r--   0 runner    (1001) docker     (127)     1301 2024-04-02 19:34:06.000000 sympy_plot_backends-3.2.0/spb/backends/matplotlib/renderers/arrow2d.py
--rw-r--r--   0 runner    (1001) docker     (127)     3273 2024-04-02 19:34:06.000000 sympy_plot_backends-3.2.0/spb/backends/matplotlib/renderers/arrow3d.py
--rw-r--r--   0 runner    (1001) docker     (127)     5830 2024-04-02 19:34:06.000000 sympy_plot_backends-3.2.0/spb/backends/matplotlib/renderers/complex.py
--rw-r--r--   0 runner    (1001) docker     (127)     2289 2024-04-02 19:34:06.000000 sympy_plot_backends-3.2.0/spb/backends/matplotlib/renderers/contour.py
--rw-r--r--   0 runner    (1001) docker     (127)      825 2024-04-02 19:34:06.000000 sympy_plot_backends-3.2.0/spb/backends/matplotlib/renderers/generic.py
--rw-r--r--   0 runner    (1001) docker     (127)     1604 2024-04-02 19:34:06.000000 sympy_plot_backends-3.2.0/spb/backends/matplotlib/renderers/geometry.py
--rw-r--r--   0 runner    (1001) docker     (127)      743 2024-04-02 19:34:06.000000 sympy_plot_backends-3.2.0/spb/backends/matplotlib/renderers/hvline.py
--rw-r--r--   0 runner    (1001) docker     (127)     3218 2024-04-02 19:34:06.000000 sympy_plot_backends-3.2.0/spb/backends/matplotlib/renderers/implicit2d.py
--rw-r--r--   0 runner    (1001) docker     (127)     3897 2024-04-02 19:34:06.000000 sympy_plot_backends-3.2.0/spb/backends/matplotlib/renderers/line2d.py
--rw-r--r--   0 runner    (1001) docker     (127)     2913 2024-04-02 19:34:06.000000 sympy_plot_backends-3.2.0/spb/backends/matplotlib/renderers/line3d.py
--rw-r--r--   0 runner    (1001) docker     (127)     3020 2024-04-02 19:34:06.000000 sympy_plot_backends-3.2.0/spb/backends/matplotlib/renderers/mcircles.py
--rw-r--r--   0 runner    (1001) docker     (127)     4649 2024-04-02 19:34:06.000000 sympy_plot_backends-3.2.0/spb/backends/matplotlib/renderers/ngrid.py
--rw-r--r--   0 runner    (1001) docker     (127)     3135 2024-04-02 19:34:06.000000 sympy_plot_backends-3.2.0/spb/backends/matplotlib/renderers/nichols.py
--rw-r--r--   0 runner    (1001) docker     (127)     8938 2024-04-02 19:34:06.000000 sympy_plot_backends-3.2.0/spb/backends/matplotlib/renderers/nyquist.py
--rw-r--r--   0 runner    (1001) docker     (127)     1125 2024-04-02 19:34:06.000000 sympy_plot_backends-3.2.0/spb/backends/matplotlib/renderers/polezero.py
--rw-r--r--   0 runner    (1001) docker     (127)     1788 2024-04-02 19:34:06.000000 sympy_plot_backends-3.2.0/spb/backends/matplotlib/renderers/renderer.py
--rw-r--r--   0 runner    (1001) docker     (127)     2745 2024-04-02 19:34:06.000000 sympy_plot_backends-3.2.0/spb/backends/matplotlib/renderers/root_locus.py
--rw-r--r--   0 runner    (1001) docker     (127)     7386 2024-04-02 19:34:06.000000 sympy_plot_backends-3.2.0/spb/backends/matplotlib/renderers/sgrid.py
--rw-r--r--   0 runner    (1001) docker     (127)     2918 2024-04-02 19:34:06.000000 sympy_plot_backends-3.2.0/spb/backends/matplotlib/renderers/surface.py
--rw-r--r--   0 runner    (1001) docker     (127)     3880 2024-04-02 19:34:06.000000 sympy_plot_backends-3.2.0/spb/backends/matplotlib/renderers/vector2d.py
--rw-r--r--   0 runner    (1001) docker     (127)     3731 2024-04-02 19:34:06.000000 sympy_plot_backends-3.2.0/spb/backends/matplotlib/renderers/vector3d.py
--rw-r--r--   0 runner    (1001) docker     (127)     3111 2024-04-02 19:34:06.000000 sympy_plot_backends-3.2.0/spb/backends/matplotlib/renderers/zgrid.py
-drwxr-xr-x   0 runner    (1001) docker     (127)        0 2024-04-02 19:34:10.294035 sympy_plot_backends-3.2.0/spb/backends/mayavi/
--rw-r--r--   0 runner    (1001) docker     (127)       58 2024-04-02 19:34:06.000000 sympy_plot_backends-3.2.0/spb/backends/mayavi/__init__.py
--rw-r--r--   0 runner    (1001) docker     (127)     9122 2024-04-02 19:34:06.000000 sympy_plot_backends-3.2.0/spb/backends/mayavi/mayavi.py
-drwxr-xr-x   0 runner    (1001) docker     (127)        0 2024-04-02 19:34:10.294035 sympy_plot_backends-3.2.0/spb/backends/mayavi/renderers/
--rw-r--r--   0 runner    (1001) docker     (127)      270 2024-04-02 19:34:06.000000 sympy_plot_backends-3.2.0/spb/backends/mayavi/renderers/__init__.py
--rw-r--r--   0 runner    (1001) docker     (127)     1026 2024-04-02 19:34:06.000000 sympy_plot_backends-3.2.0/spb/backends/mayavi/renderers/implicit3d.py
--rw-r--r--   0 runner    (1001) docker     (127)     1106 2024-04-02 19:34:06.000000 sympy_plot_backends-3.2.0/spb/backends/mayavi/renderers/line3d.py
--rw-r--r--   0 runner    (1001) docker     (127)     1141 2024-04-02 19:34:06.000000 sympy_plot_backends-3.2.0/spb/backends/mayavi/renderers/surface.py
--rw-r--r--   0 runner    (1001) docker     (127)     1405 2024-04-02 19:34:06.000000 sympy_plot_backends-3.2.0/spb/backends/mayavi/renderers/vector3d.py
-drwxr-xr-x   0 runner    (1001) docker     (127)        0 2024-04-02 19:34:10.294035 sympy_plot_backends-3.2.0/spb/backends/plotly/
--rw-r--r--   0 runner    (1001) docker     (127)       57 2024-04-02 19:34:06.000000 sympy_plot_backends-3.2.0/spb/backends/plotly/__init__.py
--rw-r--r--   0 runner    (1001) docker     (127)    22056 2024-04-02 19:34:06.000000 sympy_plot_backends-3.2.0/spb/backends/plotly/plotly.py
-drwxr-xr-x   0 runner    (1001) docker     (127)        0 2024-04-02 19:34:10.298035 sympy_plot_backends-3.2.0/spb/backends/plotly/renderers/
--rw-r--r--   0 runner    (1001) docker     (127)     1059 2024-04-02 19:34:06.000000 sympy_plot_backends-3.2.0/spb/backends/plotly/renderers/__init__.py
--rw-r--r--   0 runner    (1001) docker     (127)     1126 2024-04-02 19:34:06.000000 sympy_plot_backends-3.2.0/spb/backends/plotly/renderers/arrow2d.py
--rw-r--r--   0 runner    (1001) docker     (127)     7442 2024-04-02 19:34:06.000000 sympy_plot_backends-3.2.0/spb/backends/plotly/renderers/complex.py
--rw-r--r--   0 runner    (1001) docker     (127)     1181 2024-04-02 19:34:06.000000 sympy_plot_backends-3.2.0/spb/backends/plotly/renderers/contour.py
--rw-r--r--   0 runner    (1001) docker     (127)      940 2024-04-02 19:34:06.000000 sympy_plot_backends-3.2.0/spb/backends/plotly/renderers/generic.py
--rw-r--r--   0 runner    (1001) docker     (127)     1272 2024-04-02 19:34:06.000000 sympy_plot_backends-3.2.0/spb/backends/plotly/renderers/geometry.py
--rw-r--r--   0 runner    (1001) docker     (127)      865 2024-04-02 19:34:06.000000 sympy_plot_backends-3.2.0/spb/backends/plotly/renderers/hvline.py
--rw-r--r--   0 runner    (1001) docker     (127)      850 2024-04-02 19:34:06.000000 sympy_plot_backends-3.2.0/spb/backends/plotly/renderers/implicit3d.py
--rw-r--r--   0 runner    (1001) docker     (127)     5663 2024-04-02 19:34:06.000000 sympy_plot_backends-3.2.0/spb/backends/plotly/renderers/line2d.py
--rw-r--r--   0 runner    (1001) docker     (127)     3553 2024-04-02 19:34:06.000000 sympy_plot_backends-3.2.0/spb/backends/plotly/renderers/line3d.py
--rw-r--r--   0 runner    (1001) docker     (127)     1761 2024-04-02 19:34:06.000000 sympy_plot_backends-3.2.0/spb/backends/plotly/renderers/surface.py
--rw-r--r--   0 runner    (1001) docker     (127)     2212 2024-04-02 19:34:06.000000 sympy_plot_backends-3.2.0/spb/backends/plotly/renderers/vector2d.py
--rw-r--r--   0 runner    (1001) docker     (127)     3234 2024-04-02 19:34:06.000000 sympy_plot_backends-3.2.0/spb/backends/plotly/renderers/vector3d.py
--rw-r--r--   0 runner    (1001) docker     (127)    22021 2024-04-02 19:34:06.000000 sympy_plot_backends-3.2.0/spb/backends/utils.py
-drwxr-xr-x   0 runner    (1001) docker     (127)        0 2024-04-02 19:34:10.298035 sympy_plot_backends-3.2.0/spb/ccomplex/
--rw-r--r--   0 runner    (1001) docker     (127)      228 2024-04-02 19:34:06.000000 sympy_plot_backends-3.2.0/spb/ccomplex/__init__.py
--rw-r--r--   0 runner    (1001) docker     (127)      515 2024-04-02 19:34:06.000000 sympy_plot_backends-3.2.0/spb/ccomplex/complex.py
--rw-r--r--   0 runner    (1001) docker     (127)      218 2024-04-02 19:34:06.000000 sympy_plot_backends-3.2.0/spb/ccomplex/wegert.py
--rw-r--r--   0 runner    (1001) docker     (127)     1028 2024-04-02 19:34:06.000000 sympy_plot_backends-3.2.0/spb/control.py
--rw-r--r--   0 runner    (1001) docker     (127)     9247 2024-04-02 19:34:06.000000 sympy_plot_backends-3.2.0/spb/defaults.py
--rw-r--r--   0 runner    (1001) docker     (127)    13274 2024-04-02 19:34:06.000000 sympy_plot_backends-3.2.0/spb/doc_utils.py
--rw-r--r--   0 runner    (1001) docker     (127)     1149 2024-04-02 19:34:06.000000 sympy_plot_backends-3.2.0/spb/functions.py
-drwxr-xr-x   0 runner    (1001) docker     (127)        0 2024-04-02 19:34:10.302035 sympy_plot_backends-3.2.0/spb/graphics/
--rw-r--r--   0 runner    (1001) docker     (127)     1813 2024-04-02 19:34:06.000000 sympy_plot_backends-3.2.0/spb/graphics/__init__.py
--rw-r--r--   0 runner    (1001) docker     (127)    57633 2024-04-02 19:34:06.000000 sympy_plot_backends-3.2.0/spb/graphics/complex_analysis.py
--rw-r--r--   0 runner    (1001) docker     (127)    95949 2024-04-02 19:34:06.000000 sympy_plot_backends-3.2.0/spb/graphics/control.py
--rw-r--r--   0 runner    (1001) docker     (127)    67311 2024-04-02 19:34:06.000000 sympy_plot_backends-3.2.0/spb/graphics/functions_2d.py
--rw-r--r--   0 runner    (1001) docker     (127)    58630 2024-04-02 19:34:06.000000 sympy_plot_backends-3.2.0/spb/graphics/functions_3d.py
--rw-r--r--   0 runner    (1001) docker     (127)    12416 2024-04-02 19:34:06.000000 sympy_plot_backends-3.2.0/spb/graphics/graphics.py
--rw-r--r--   0 runner    (1001) docker     (127)     6713 2024-04-02 19:34:06.000000 sympy_plot_backends-3.2.0/spb/graphics/utils.py
--rw-r--r--   0 runner    (1001) docker     (127)    31960 2024-04-02 19:34:06.000000 sympy_plot_backends-3.2.0/spb/graphics/vectors.py
-drwxr-xr-x   0 runner    (1001) docker     (127)        0 2024-04-02 19:34:10.302035 sympy_plot_backends-3.2.0/spb/interactive/
--rw-r--r--   0 runner    (1001) docker     (127)     6358 2024-04-02 19:34:06.000000 sympy_plot_backends-3.2.0/spb/interactive/__init__.py
-drwxr-xr-x   0 runner    (1001) docker     (127)        0 2024-04-02 19:34:10.302035 sympy_plot_backends-3.2.0/spb/interactive/bootstrap_spb/
--rw-r--r--   0 runner    (1001) docker     (127)     6213 2024-04-02 19:34:06.000000 sympy_plot_backends-3.2.0/spb/interactive/bootstrap_spb/__init__.py
--rw-r--r--   0 runner    (1001) docker     (127)     3665 2024-04-02 19:34:06.000000 sympy_plot_backends-3.2.0/spb/interactive/bootstrap_spb/bootstrap.css
--rw-r--r--   0 runner    (1001) docker     (127)     6582 2024-04-02 19:34:06.000000 sympy_plot_backends-3.2.0/spb/interactive/bootstrap_spb/bootstrap.html
--rw-r--r--   0 runner    (1001) docker     (127)    15839 2024-04-02 19:34:06.000000 sympy_plot_backends-3.2.0/spb/interactive/ipywidgets.py
--rw-r--r--   0 runner    (1001) docker     (127)    38079 2024-04-02 19:34:06.000000 sympy_plot_backends-3.2.0/spb/interactive/panel.py
-drwxr-xr-x   0 runner    (1001) docker     (127)        0 2024-04-02 19:34:10.302035 sympy_plot_backends-3.2.0/spb/plot_functions/
--rw-r--r--   0 runner    (1001) docker     (127)      615 2024-04-02 19:34:06.000000 sympy_plot_backends-3.2.0/spb/plot_functions/__init__.py
--rw-r--r--   0 runner    (1001) docker     (127)    43648 2024-04-02 19:34:06.000000 sympy_plot_backends-3.2.0/spb/plot_functions/complex_analysis.py
--rw-r--r--   0 runner    (1001) docker     (127)    50205 2024-04-02 19:34:06.000000 sympy_plot_backends-3.2.0/spb/plot_functions/control.py
--rw-r--r--   0 runner    (1001) docker     (127)    63806 2024-04-02 19:34:06.000000 sympy_plot_backends-3.2.0/spb/plot_functions/functions_2d.py
--rw-r--r--   0 runner    (1001) docker     (127)    39225 2024-04-02 19:34:06.000000 sympy_plot_backends-3.2.0/spb/plot_functions/functions_3d.py
--rw-r--r--   0 runner    (1001) docker     (127)    13615 2024-04-02 19:34:06.000000 sympy_plot_backends-3.2.0/spb/plot_functions/vectors.py
--rw-r--r--   0 runner    (1001) docker     (127)    24407 2024-04-02 19:34:06.000000 sympy_plot_backends-3.2.0/spb/plotgrid.py
--rw-r--r--   0 runner    (1001) docker     (127)   184262 2024-04-02 19:34:06.000000 sympy_plot_backends-3.2.0/spb/series.py
--rw-r--r--   0 runner    (1001) docker     (127)    32272 2024-04-02 19:34:06.000000 sympy_plot_backends-3.2.0/spb/utils.py
--rw-r--r--   0 runner    (1001) docker     (127)      304 2024-04-02 19:34:06.000000 sympy_plot_backends-3.2.0/spb/vectors.py
--rw-r--r--   0 runner    (1001) docker     (127)    15898 2024-04-02 19:34:06.000000 sympy_plot_backends-3.2.0/spb/wegert.py
-drwxr-xr-x   0 runner    (1001) docker     (127)        0 2024-04-02 19:34:10.314035 sympy_plot_backends-3.2.0/sympy_plot_backends.egg-info/
--rw-r--r--   0 runner    (1001) docker     (127)     6543 2024-04-02 19:34:10.000000 sympy_plot_backends-3.2.0/sympy_plot_backends.egg-info/PKG-INFO
--rw-r--r--   0 runner    (1001) docker     (127)     5380 2024-04-02 19:34:10.000000 sympy_plot_backends-3.2.0/sympy_plot_backends.egg-info/SOURCES.txt
--rw-r--r--   0 runner    (1001) docker     (127)        1 2024-04-02 19:34:10.000000 sympy_plot_backends-3.2.0/sympy_plot_backends.egg-info/dependency_links.txt
--rw-r--r--   0 runner    (1001) docker     (127)        1 2024-04-02 19:34:10.000000 sympy_plot_backends-3.2.0/sympy_plot_backends.egg-info/not-zip-safe
--rw-r--r--   0 runner    (1001) docker     (127)      435 2024-04-02 19:34:10.000000 sympy_plot_backends-3.2.0/sympy_plot_backends.egg-info/requires.txt
--rw-r--r--   0 runner    (1001) docker     (127)       10 2024-04-02 19:34:10.000000 sympy_plot_backends-3.2.0/sympy_plot_backends.egg-info/top_level.txt
-drwxr-xr-x   0 runner    (1001) docker     (127)        0 2024-04-02 19:34:10.306035 sympy_plot_backends-3.2.0/tests/
-drwxr-xr-x   0 runner    (1001) docker     (127)        0 2024-04-02 19:34:10.306035 sympy_plot_backends-3.2.0/tests/backends/
--rw-r--r--   0 runner    (1001) docker     (127)      605 2024-04-02 19:34:06.000000 sympy_plot_backends-3.2.0/tests/backends/__init__.py
--rw-r--r--   0 runner    (1001) docker     (127)    24371 2024-04-02 19:34:06.000000 sympy_plot_backends-3.2.0/tests/backends/make_tests.py
--rw-r--r--   0 runner    (1001) docker     (127)    12659 2024-04-02 19:34:06.000000 sympy_plot_backends-3.2.0/tests/backends/test_base_backend.py
--rw-r--r--   0 runner    (1001) docker     (127)    52074 2024-04-02 19:34:06.000000 sympy_plot_backends-3.2.0/tests/backends/test_bokeh.py
--rw-r--r--   0 runner    (1001) docker     (127)     3758 2024-04-02 19:34:06.000000 sympy_plot_backends-3.2.0/tests/backends/test_color_utils.py
--rw-r--r--   0 runner    (1001) docker     (127)    28531 2024-04-02 19:34:06.000000 sympy_plot_backends-3.2.0/tests/backends/test_k3d.py
--rw-r--r--   0 runner    (1001) docker     (127)    82714 2024-04-02 19:34:06.000000 sympy_plot_backends-3.2.0/tests/backends/test_matplotlib.py
--rw-r--r--   0 runner    (1001) docker     (127)    57115 2024-04-02 19:34:06.000000 sympy_plot_backends-3.2.0/tests/backends/test_plotly.py
-drwxr-xr-x   0 runner    (1001) docker     (127)        0 2024-04-02 19:34:10.310035 sympy_plot_backends-3.2.0/tests/graphics/
--rw-r--r--   0 runner    (1001) docker     (127)        0 2024-04-02 19:34:06.000000 sympy_plot_backends-3.2.0/tests/graphics/__init__.py
--rw-r--r--   0 runner    (1001) docker     (127)    15383 2024-04-02 19:34:06.000000 sympy_plot_backends-3.2.0/tests/graphics/test_complex_analysis.py
--rw-r--r--   0 runner    (1001) docker     (127)    34206 2024-04-02 19:34:06.000000 sympy_plot_backends-3.2.0/tests/graphics/test_control.py
--rw-r--r--   0 runner    (1001) docker     (127)     1548 2024-04-02 19:34:06.000000 sympy_plot_backends-3.2.0/tests/graphics/test_control_min_module.py
--rw-r--r--   0 runner    (1001) docker     (127)    10457 2024-04-02 19:34:06.000000 sympy_plot_backends-3.2.0/tests/graphics/test_functions_2d.py
--rw-r--r--   0 runner    (1001) docker     (127)    15142 2024-04-02 19:34:06.000000 sympy_plot_backends-3.2.0/tests/graphics/test_functions_3d.py
--rw-r--r--   0 runner    (1001) docker     (127)     4687 2024-04-02 19:34:06.000000 sympy_plot_backends-3.2.0/tests/graphics/test_graphics.py
--rw-r--r--   0 runner    (1001) docker     (127)    10885 2024-04-02 19:34:06.000000 sympy_plot_backends-3.2.0/tests/graphics/test_vectors.py
-drwxr-xr-x   0 runner    (1001) docker     (127)        0 2024-04-02 19:34:10.310035 sympy_plot_backends-3.2.0/tests/interactive/
--rw-r--r--   0 runner    (1001) docker     (127)        0 2024-04-02 19:34:06.000000 sympy_plot_backends-3.2.0/tests/interactive/__init__.py
--rw-r--r--   0 runner    (1001) docker     (127)     7936 2024-04-02 19:34:06.000000 sympy_plot_backends-3.2.0/tests/interactive/test_interactive.py
--rw-r--r--   0 runner    (1001) docker     (127)     3567 2024-04-02 19:34:06.000000 sympy_plot_backends-3.2.0/tests/interactive/test_ipywidgets.py
--rw-r--r--   0 runner    (1001) docker     (127)    11460 2024-04-02 19:34:06.000000 sympy_plot_backends-3.2.0/tests/interactive/test_panel.py
-drwxr-xr-x   0 runner    (1001) docker     (127)        0 2024-04-02 19:34:10.310035 sympy_plot_backends-3.2.0/tests/plot_functions/
--rw-r--r--   0 runner    (1001) docker     (127)        0 2024-04-02 19:34:06.000000 sympy_plot_backends-3.2.0/tests/plot_functions/__init__.py
--rw-r--r--   0 runner    (1001) docker     (127)    94547 2024-04-02 19:34:06.000000 sympy_plot_backends-3.2.0/tests/plot_functions/test_complex.py
--rw-r--r--   0 runner    (1001) docker     (127)    38150 2024-04-02 19:34:06.000000 sympy_plot_backends-3.2.0/tests/plot_functions/test_control.py
--rw-r--r--   0 runner    (1001) docker     (127)    51725 2024-04-02 19:34:06.000000 sympy_plot_backends-3.2.0/tests/plot_functions/test_functions_2d.py
--rw-r--r--   0 runner    (1001) docker     (127)    33383 2024-04-02 19:34:06.000000 sympy_plot_backends-3.2.0/tests/plot_functions/test_functions_3d.py
--rw-r--r--   0 runner    (1001) docker     (127)    52073 2024-04-02 19:34:06.000000 sympy_plot_backends-3.2.0/tests/plot_functions/test_vectors.py
--rw-r--r--   0 runner    (1001) docker     (127)     5513 2024-04-02 19:34:06.000000 sympy_plot_backends-3.2.0/tests/test_defaults.py
--rw-r--r--   0 runner    (1001) docker     (127)      935 2024-04-02 19:34:06.000000 sympy_plot_backends-3.2.0/tests/test_deprecated_module.py
--rw-r--r--   0 runner    (1001) docker     (127)     8617 2024-04-02 19:34:06.000000 sympy_plot_backends-3.2.0/tests/test_doc_utils.py
--rw-r--r--   0 runner    (1001) docker     (127)    26676 2024-04-02 19:34:06.000000 sympy_plot_backends-3.2.0/tests/test_plotgrid.py
--rw-r--r--   0 runner    (1001) docker     (127)   147177 2024-04-02 19:34:06.000000 sympy_plot_backends-3.2.0/tests/test_series.py
--rw-r--r--   0 runner    (1001) docker     (127)    15344 2024-04-02 19:34:06.000000 sympy_plot_backends-3.2.0/tests/test_utils.py
+drwxr-xr-x   0 runner    (1001) docker     (127)        0 2024-04-14 17:57:04.074653 sympy_plot_backends-3.3.0/
+-rw-r--r--   0 runner    (1001) docker     (127)     1523 2024-04-14 17:56:59.000000 sympy_plot_backends-3.3.0/LICENSE
+-rw-r--r--   0 runner    (1001) docker     (127)       89 2024-04-14 17:56:59.000000 sympy_plot_backends-3.3.0/MANIFEST.in
+-rw-r--r--   0 runner    (1001) docker     (127)     7287 2024-04-14 17:57:04.074653 sympy_plot_backends-3.3.0/PKG-INFO
+-rw-r--r--   0 runner    (1001) docker     (127)     5172 2024-04-14 17:56:59.000000 sympy_plot_backends-3.3.0/README.md
+-rw-r--r--   0 runner    (1001) docker     (127)       38 2024-04-14 17:57:04.074653 sympy_plot_backends-3.3.0/setup.cfg
+-rwxr-xr-x   0 runner    (1001) docker     (127)     2026 2024-04-14 17:56:59.000000 sympy_plot_backends-3.3.0/setup.py
+drwxr-xr-x   0 runner    (1001) docker     (127)        0 2024-04-14 17:57:04.042652 sympy_plot_backends-3.3.0/spb/
+-rw-r--r--   0 runner    (1001) docker     (127)     3670 2024-04-14 17:56:59.000000 sympy_plot_backends-3.3.0/spb/__init__.py
+-rw-r--r--   0 runner    (1001) docker     (127)       22 2024-04-14 17:56:59.000000 sympy_plot_backends-3.3.0/spb/_version.py
+drwxr-xr-x   0 runner    (1001) docker     (127)        0 2024-04-14 17:57:04.046652 sympy_plot_backends-3.3.0/spb/backends/
+-rw-r--r--   0 runner    (1001) docker     (127)        0 2024-04-14 17:56:59.000000 sympy_plot_backends-3.3.0/spb/backends/__init__.py
+-rw-r--r--   0 runner    (1001) docker     (127)    28866 2024-04-14 17:56:59.000000 sympy_plot_backends-3.3.0/spb/backends/base_backend.py
+-rw-r--r--   0 runner    (1001) docker     (127)     2636 2024-04-14 17:56:59.000000 sympy_plot_backends-3.3.0/spb/backends/base_renderer.py
+drwxr-xr-x   0 runner    (1001) docker     (127)        0 2024-04-14 17:57:04.046652 sympy_plot_backends-3.3.0/spb/backends/bokeh/
+-rw-r--r--   0 runner    (1001) docker     (127)       54 2024-04-14 17:56:59.000000 sympy_plot_backends-3.3.0/spb/backends/bokeh/__init__.py
+-rw-r--r--   0 runner    (1001) docker     (127)    24303 2024-04-14 17:56:59.000000 sympy_plot_backends-3.3.0/spb/backends/bokeh/bokeh.py
+drwxr-xr-x   0 runner    (1001) docker     (127)        0 2024-04-14 17:57:04.046652 sympy_plot_backends-3.3.0/spb/backends/bokeh/renderers/
+-rw-r--r--   0 runner    (1001) docker     (127)     1386 2024-04-14 17:56:59.000000 sympy_plot_backends-3.3.0/spb/backends/bokeh/renderers/__init__.py
+-rw-r--r--   0 runner    (1001) docker     (127)     1289 2024-04-14 17:56:59.000000 sympy_plot_backends-3.3.0/spb/backends/bokeh/renderers/arrow2d.py
+-rw-r--r--   0 runner    (1001) docker     (127)     4723 2024-04-14 17:56:59.000000 sympy_plot_backends-3.3.0/spb/backends/bokeh/renderers/complex.py
+-rw-r--r--   0 runner    (1001) docker     (127)     1852 2024-04-14 17:56:59.000000 sympy_plot_backends-3.3.0/spb/backends/bokeh/renderers/contour.py
+-rw-r--r--   0 runner    (1001) docker     (127)      897 2024-04-14 17:56:59.000000 sympy_plot_backends-3.3.0/spb/backends/bokeh/renderers/generic.py
+-rw-r--r--   0 runner    (1001) docker     (127)     1379 2024-04-14 17:56:59.000000 sympy_plot_backends-3.3.0/spb/backends/bokeh/renderers/geometry.py
+-rw-r--r--   0 runner    (1001) docker     (127)      646 2024-04-14 17:56:59.000000 sympy_plot_backends-3.3.0/spb/backends/bokeh/renderers/hvline.py
+-rw-r--r--   0 runner    (1001) docker     (127)     4338 2024-04-14 17:56:59.000000 sympy_plot_backends-3.3.0/spb/backends/bokeh/renderers/line2d.py
+-rw-r--r--   0 runner    (1001) docker     (127)     2088 2024-04-14 17:56:59.000000 sympy_plot_backends-3.3.0/spb/backends/bokeh/renderers/mcircles.py
+-rw-r--r--   0 runner    (1001) docker     (127)     4869 2024-04-14 17:56:59.000000 sympy_plot_backends-3.3.0/spb/backends/bokeh/renderers/ngrid.py
+-rw-r--r--   0 runner    (1001) docker     (127)     4317 2024-04-14 17:56:59.000000 sympy_plot_backends-3.3.0/spb/backends/bokeh/renderers/nichols.py
+-rw-r--r--   0 runner    (1001) docker     (127)    13489 2024-04-14 17:56:59.000000 sympy_plot_backends-3.3.0/spb/backends/bokeh/renderers/nyquist.py
+-rw-r--r--   0 runner    (1001) docker     (127)     4082 2024-04-14 17:56:59.000000 sympy_plot_backends-3.3.0/spb/backends/bokeh/renderers/polezero.py
+-rw-r--r--   0 runner    (1001) docker     (127)     3746 2024-04-14 17:56:59.000000 sympy_plot_backends-3.3.0/spb/backends/bokeh/renderers/root_locus.py
+-rw-r--r--   0 runner    (1001) docker     (127)     9121 2024-04-14 17:56:59.000000 sympy_plot_backends-3.3.0/spb/backends/bokeh/renderers/sgrid.py
+-rw-r--r--   0 runner    (1001) docker     (127)     9708 2024-04-14 17:56:59.000000 sympy_plot_backends-3.3.0/spb/backends/bokeh/renderers/vector2d.py
+-rw-r--r--   0 runner    (1001) docker     (127)     4970 2024-04-14 17:56:59.000000 sympy_plot_backends-3.3.0/spb/backends/bokeh/renderers/zgrid.py
+drwxr-xr-x   0 runner    (1001) docker     (127)        0 2024-04-14 17:57:04.050652 sympy_plot_backends-3.3.0/spb/backends/k3d/
+-rw-r--r--   0 runner    (1001) docker     (127)       48 2024-04-14 17:56:59.000000 sympy_plot_backends-3.3.0/spb/backends/k3d/__init__.py
+-rw-r--r--   0 runner    (1001) docker     (127)    17082 2024-04-14 17:56:59.000000 sympy_plot_backends-3.3.0/spb/backends/k3d/k3d.py
+drwxr-xr-x   0 runner    (1001) docker     (127)        0 2024-04-14 17:57:04.050652 sympy_plot_backends-3.3.0/spb/backends/k3d/renderers/
+-rw-r--r--   0 runner    (1001) docker     (127)      612 2024-04-14 17:56:59.000000 sympy_plot_backends-3.3.0/spb/backends/k3d/renderers/__init__.py
+-rw-r--r--   0 runner    (1001) docker     (127)      840 2024-04-14 17:56:59.000000 sympy_plot_backends-3.3.0/spb/backends/k3d/renderers/arrow3d.py
+-rw-r--r--   0 runner    (1001) docker     (127)     2711 2024-04-14 17:56:59.000000 sympy_plot_backends-3.3.0/spb/backends/k3d/renderers/complex.py
+-rw-r--r--   0 runner    (1001) docker     (127)      262 2024-04-14 17:56:59.000000 sympy_plot_backends-3.3.0/spb/backends/k3d/renderers/geometry.py
+-rw-r--r--   0 runner    (1001) docker     (127)      865 2024-04-14 17:56:59.000000 sympy_plot_backends-3.3.0/spb/backends/k3d/renderers/implicit3d.py
+-rw-r--r--   0 runner    (1001) docker     (127)     2424 2024-04-14 17:56:59.000000 sympy_plot_backends-3.3.0/spb/backends/k3d/renderers/line3d.py
+-rw-r--r--   0 runner    (1001) docker     (127)     2877 2024-04-14 17:56:59.000000 sympy_plot_backends-3.3.0/spb/backends/k3d/renderers/surface.py
+-rw-r--r--   0 runner    (1001) docker     (127)     3225 2024-04-14 17:56:59.000000 sympy_plot_backends-3.3.0/spb/backends/k3d/renderers/vector3d.py
+drwxr-xr-x   0 runner    (1001) docker     (127)        0 2024-04-14 17:57:04.050652 sympy_plot_backends-3.3.0/spb/backends/matplotlib/
+-rw-r--r--   0 runner    (1001) docker     (127)      142 2024-04-14 17:56:59.000000 sympy_plot_backends-3.3.0/spb/backends/matplotlib/__init__.py
+-rw-r--r--   0 runner    (1001) docker     (127)    30016 2024-04-14 17:56:59.000000 sympy_plot_backends-3.3.0/spb/backends/matplotlib/matplotlib.py
+drwxr-xr-x   0 runner    (1001) docker     (127)        0 2024-04-14 17:57:04.054653 sympy_plot_backends-3.3.0/spb/backends/matplotlib/renderers/
+-rw-r--r--   0 runner    (1001) docker     (127)     2069 2024-04-14 17:56:59.000000 sympy_plot_backends-3.3.0/spb/backends/matplotlib/renderers/__init__.py
+-rw-r--r--   0 runner    (1001) docker     (127)     5025 2024-04-14 17:56:59.000000 sympy_plot_backends-3.3.0/spb/backends/matplotlib/renderers/_sgrid_helper.py
+-rw-r--r--   0 runner    (1001) docker     (127)     1301 2024-04-14 17:56:59.000000 sympy_plot_backends-3.3.0/spb/backends/matplotlib/renderers/arrow2d.py
+-rw-r--r--   0 runner    (1001) docker     (127)     3273 2024-04-14 17:56:59.000000 sympy_plot_backends-3.3.0/spb/backends/matplotlib/renderers/arrow3d.py
+-rw-r--r--   0 runner    (1001) docker     (127)     5830 2024-04-14 17:56:59.000000 sympy_plot_backends-3.3.0/spb/backends/matplotlib/renderers/complex.py
+-rw-r--r--   0 runner    (1001) docker     (127)     2289 2024-04-14 17:56:59.000000 sympy_plot_backends-3.3.0/spb/backends/matplotlib/renderers/contour.py
+-rw-r--r--   0 runner    (1001) docker     (127)      825 2024-04-14 17:56:59.000000 sympy_plot_backends-3.3.0/spb/backends/matplotlib/renderers/generic.py
+-rw-r--r--   0 runner    (1001) docker     (127)     1604 2024-04-14 17:56:59.000000 sympy_plot_backends-3.3.0/spb/backends/matplotlib/renderers/geometry.py
+-rw-r--r--   0 runner    (1001) docker     (127)      743 2024-04-14 17:56:59.000000 sympy_plot_backends-3.3.0/spb/backends/matplotlib/renderers/hvline.py
+-rw-r--r--   0 runner    (1001) docker     (127)     3218 2024-04-14 17:56:59.000000 sympy_plot_backends-3.3.0/spb/backends/matplotlib/renderers/implicit2d.py
+-rw-r--r--   0 runner    (1001) docker     (127)     3897 2024-04-14 17:56:59.000000 sympy_plot_backends-3.3.0/spb/backends/matplotlib/renderers/line2d.py
+-rw-r--r--   0 runner    (1001) docker     (127)     2913 2024-04-14 17:56:59.000000 sympy_plot_backends-3.3.0/spb/backends/matplotlib/renderers/line3d.py
+-rw-r--r--   0 runner    (1001) docker     (127)     3020 2024-04-14 17:56:59.000000 sympy_plot_backends-3.3.0/spb/backends/matplotlib/renderers/mcircles.py
+-rw-r--r--   0 runner    (1001) docker     (127)     4649 2024-04-14 17:56:59.000000 sympy_plot_backends-3.3.0/spb/backends/matplotlib/renderers/ngrid.py
+-rw-r--r--   0 runner    (1001) docker     (127)     3135 2024-04-14 17:56:59.000000 sympy_plot_backends-3.3.0/spb/backends/matplotlib/renderers/nichols.py
+-rw-r--r--   0 runner    (1001) docker     (127)     8938 2024-04-14 17:56:59.000000 sympy_plot_backends-3.3.0/spb/backends/matplotlib/renderers/nyquist.py
+-rw-r--r--   0 runner    (1001) docker     (127)     1125 2024-04-14 17:56:59.000000 sympy_plot_backends-3.3.0/spb/backends/matplotlib/renderers/polezero.py
+-rw-r--r--   0 runner    (1001) docker     (127)     1788 2024-04-14 17:56:59.000000 sympy_plot_backends-3.3.0/spb/backends/matplotlib/renderers/renderer.py
+-rw-r--r--   0 runner    (1001) docker     (127)     2745 2024-04-14 17:56:59.000000 sympy_plot_backends-3.3.0/spb/backends/matplotlib/renderers/root_locus.py
+-rw-r--r--   0 runner    (1001) docker     (127)     7453 2024-04-14 17:56:59.000000 sympy_plot_backends-3.3.0/spb/backends/matplotlib/renderers/sgrid.py
+-rw-r--r--   0 runner    (1001) docker     (127)     2918 2024-04-14 17:56:59.000000 sympy_plot_backends-3.3.0/spb/backends/matplotlib/renderers/surface.py
+-rw-r--r--   0 runner    (1001) docker     (127)     3880 2024-04-14 17:56:59.000000 sympy_plot_backends-3.3.0/spb/backends/matplotlib/renderers/vector2d.py
+-rw-r--r--   0 runner    (1001) docker     (127)     3731 2024-04-14 17:56:59.000000 sympy_plot_backends-3.3.0/spb/backends/matplotlib/renderers/vector3d.py
+-rw-r--r--   0 runner    (1001) docker     (127)     3111 2024-04-14 17:56:59.000000 sympy_plot_backends-3.3.0/spb/backends/matplotlib/renderers/zgrid.py
+drwxr-xr-x   0 runner    (1001) docker     (127)        0 2024-04-14 17:57:04.054653 sympy_plot_backends-3.3.0/spb/backends/mayavi/
+-rw-r--r--   0 runner    (1001) docker     (127)       58 2024-04-14 17:56:59.000000 sympy_plot_backends-3.3.0/spb/backends/mayavi/__init__.py
+-rw-r--r--   0 runner    (1001) docker     (127)     9122 2024-04-14 17:56:59.000000 sympy_plot_backends-3.3.0/spb/backends/mayavi/mayavi.py
+drwxr-xr-x   0 runner    (1001) docker     (127)        0 2024-04-14 17:57:04.054653 sympy_plot_backends-3.3.0/spb/backends/mayavi/renderers/
+-rw-r--r--   0 runner    (1001) docker     (127)      270 2024-04-14 17:56:59.000000 sympy_plot_backends-3.3.0/spb/backends/mayavi/renderers/__init__.py
+-rw-r--r--   0 runner    (1001) docker     (127)     1026 2024-04-14 17:56:59.000000 sympy_plot_backends-3.3.0/spb/backends/mayavi/renderers/implicit3d.py
+-rw-r--r--   0 runner    (1001) docker     (127)     1106 2024-04-14 17:56:59.000000 sympy_plot_backends-3.3.0/spb/backends/mayavi/renderers/line3d.py
+-rw-r--r--   0 runner    (1001) docker     (127)     1141 2024-04-14 17:56:59.000000 sympy_plot_backends-3.3.0/spb/backends/mayavi/renderers/surface.py
+-rw-r--r--   0 runner    (1001) docker     (127)     1405 2024-04-14 17:56:59.000000 sympy_plot_backends-3.3.0/spb/backends/mayavi/renderers/vector3d.py
+drwxr-xr-x   0 runner    (1001) docker     (127)        0 2024-04-14 17:57:04.054653 sympy_plot_backends-3.3.0/spb/backends/plotly/
+-rw-r--r--   0 runner    (1001) docker     (127)       57 2024-04-14 17:56:59.000000 sympy_plot_backends-3.3.0/spb/backends/plotly/__init__.py
+-rw-r--r--   0 runner    (1001) docker     (127)    22056 2024-04-14 17:56:59.000000 sympy_plot_backends-3.3.0/spb/backends/plotly/plotly.py
+drwxr-xr-x   0 runner    (1001) docker     (127)        0 2024-04-14 17:57:04.058652 sympy_plot_backends-3.3.0/spb/backends/plotly/renderers/
+-rw-r--r--   0 runner    (1001) docker     (127)     1059 2024-04-14 17:56:59.000000 sympy_plot_backends-3.3.0/spb/backends/plotly/renderers/__init__.py
+-rw-r--r--   0 runner    (1001) docker     (127)     1126 2024-04-14 17:56:59.000000 sympy_plot_backends-3.3.0/spb/backends/plotly/renderers/arrow2d.py
+-rw-r--r--   0 runner    (1001) docker     (127)     7442 2024-04-14 17:56:59.000000 sympy_plot_backends-3.3.0/spb/backends/plotly/renderers/complex.py
+-rw-r--r--   0 runner    (1001) docker     (127)     1181 2024-04-14 17:56:59.000000 sympy_plot_backends-3.3.0/spb/backends/plotly/renderers/contour.py
+-rw-r--r--   0 runner    (1001) docker     (127)      940 2024-04-14 17:56:59.000000 sympy_plot_backends-3.3.0/spb/backends/plotly/renderers/generic.py
+-rw-r--r--   0 runner    (1001) docker     (127)     1272 2024-04-14 17:56:59.000000 sympy_plot_backends-3.3.0/spb/backends/plotly/renderers/geometry.py
+-rw-r--r--   0 runner    (1001) docker     (127)      865 2024-04-14 17:56:59.000000 sympy_plot_backends-3.3.0/spb/backends/plotly/renderers/hvline.py
+-rw-r--r--   0 runner    (1001) docker     (127)      850 2024-04-14 17:56:59.000000 sympy_plot_backends-3.3.0/spb/backends/plotly/renderers/implicit3d.py
+-rw-r--r--   0 runner    (1001) docker     (127)     5663 2024-04-14 17:56:59.000000 sympy_plot_backends-3.3.0/spb/backends/plotly/renderers/line2d.py
+-rw-r--r--   0 runner    (1001) docker     (127)     3553 2024-04-14 17:56:59.000000 sympy_plot_backends-3.3.0/spb/backends/plotly/renderers/line3d.py
+-rw-r--r--   0 runner    (1001) docker     (127)     1761 2024-04-14 17:56:59.000000 sympy_plot_backends-3.3.0/spb/backends/plotly/renderers/surface.py
+-rw-r--r--   0 runner    (1001) docker     (127)     2212 2024-04-14 17:56:59.000000 sympy_plot_backends-3.3.0/spb/backends/plotly/renderers/vector2d.py
+-rw-r--r--   0 runner    (1001) docker     (127)     3234 2024-04-14 17:56:59.000000 sympy_plot_backends-3.3.0/spb/backends/plotly/renderers/vector3d.py
+-rw-r--r--   0 runner    (1001) docker     (127)    22021 2024-04-14 17:56:59.000000 sympy_plot_backends-3.3.0/spb/backends/utils.py
+drwxr-xr-x   0 runner    (1001) docker     (127)        0 2024-04-14 17:57:04.058652 sympy_plot_backends-3.3.0/spb/ccomplex/
+-rw-r--r--   0 runner    (1001) docker     (127)      228 2024-04-14 17:56:59.000000 sympy_plot_backends-3.3.0/spb/ccomplex/__init__.py
+-rw-r--r--   0 runner    (1001) docker     (127)      515 2024-04-14 17:56:59.000000 sympy_plot_backends-3.3.0/spb/ccomplex/complex.py
+-rw-r--r--   0 runner    (1001) docker     (127)      218 2024-04-14 17:56:59.000000 sympy_plot_backends-3.3.0/spb/ccomplex/wegert.py
+-rw-r--r--   0 runner    (1001) docker     (127)     1028 2024-04-14 17:56:59.000000 sympy_plot_backends-3.3.0/spb/control.py
+-rw-r--r--   0 runner    (1001) docker     (127)     9239 2024-04-14 17:56:59.000000 sympy_plot_backends-3.3.0/spb/defaults.py
+-rw-r--r--   0 runner    (1001) docker     (127)    13270 2024-04-14 17:56:59.000000 sympy_plot_backends-3.3.0/spb/doc_utils.py
+-rw-r--r--   0 runner    (1001) docker     (127)     1149 2024-04-14 17:56:59.000000 sympy_plot_backends-3.3.0/spb/functions.py
+drwxr-xr-x   0 runner    (1001) docker     (127)        0 2024-04-14 17:57:04.058652 sympy_plot_backends-3.3.0/spb/graphics/
+-rw-r--r--   0 runner    (1001) docker     (127)     1813 2024-04-14 17:56:59.000000 sympy_plot_backends-3.3.0/spb/graphics/__init__.py
+-rw-r--r--   0 runner    (1001) docker     (127)    57633 2024-04-14 17:56:59.000000 sympy_plot_backends-3.3.0/spb/graphics/complex_analysis.py
+-rw-r--r--   0 runner    (1001) docker     (127)   104780 2024-04-14 17:56:59.000000 sympy_plot_backends-3.3.0/spb/graphics/control.py
+-rw-r--r--   0 runner    (1001) docker     (127)    68412 2024-04-14 17:56:59.000000 sympy_plot_backends-3.3.0/spb/graphics/functions_2d.py
+-rw-r--r--   0 runner    (1001) docker     (127)    58982 2024-04-14 17:56:59.000000 sympy_plot_backends-3.3.0/spb/graphics/functions_3d.py
+-rw-r--r--   0 runner    (1001) docker     (127)    12416 2024-04-14 17:56:59.000000 sympy_plot_backends-3.3.0/spb/graphics/graphics.py
+-rw-r--r--   0 runner    (1001) docker     (127)     6848 2024-04-14 17:56:59.000000 sympy_plot_backends-3.3.0/spb/graphics/utils.py
+-rw-r--r--   0 runner    (1001) docker     (127)    32186 2024-04-14 17:56:59.000000 sympy_plot_backends-3.3.0/spb/graphics/vectors.py
+drwxr-xr-x   0 runner    (1001) docker     (127)        0 2024-04-14 17:57:04.062653 sympy_plot_backends-3.3.0/spb/interactive/
+-rw-r--r--   0 runner    (1001) docker     (127)     7457 2024-04-14 17:56:59.000000 sympy_plot_backends-3.3.0/spb/interactive/__init__.py
+drwxr-xr-x   0 runner    (1001) docker     (127)        0 2024-04-14 17:57:04.062653 sympy_plot_backends-3.3.0/spb/interactive/bootstrap_spb/
+-rw-r--r--   0 runner    (1001) docker     (127)     6213 2024-04-14 17:56:59.000000 sympy_plot_backends-3.3.0/spb/interactive/bootstrap_spb/__init__.py
+-rw-r--r--   0 runner    (1001) docker     (127)     3665 2024-04-14 17:56:59.000000 sympy_plot_backends-3.3.0/spb/interactive/bootstrap_spb/bootstrap.css
+-rw-r--r--   0 runner    (1001) docker     (127)     6582 2024-04-14 17:56:59.000000 sympy_plot_backends-3.3.0/spb/interactive/bootstrap_spb/bootstrap.html
+-rw-r--r--   0 runner    (1001) docker     (127)    16263 2024-04-14 17:56:59.000000 sympy_plot_backends-3.3.0/spb/interactive/ipywidgets.py
+-rw-r--r--   0 runner    (1001) docker     (127)    31415 2024-04-14 17:56:59.000000 sympy_plot_backends-3.3.0/spb/interactive/panel.py
+drwxr-xr-x   0 runner    (1001) docker     (127)        0 2024-04-14 17:57:04.062653 sympy_plot_backends-3.3.0/spb/plot_functions/
+-rw-r--r--   0 runner    (1001) docker     (127)      615 2024-04-14 17:56:59.000000 sympy_plot_backends-3.3.0/spb/plot_functions/__init__.py
+-rw-r--r--   0 runner    (1001) docker     (127)    43648 2024-04-14 17:56:59.000000 sympy_plot_backends-3.3.0/spb/plot_functions/complex_analysis.py
+-rw-r--r--   0 runner    (1001) docker     (127)    52650 2024-04-14 17:56:59.000000 sympy_plot_backends-3.3.0/spb/plot_functions/control.py
+-rw-r--r--   0 runner    (1001) docker     (127)    64846 2024-04-14 17:56:59.000000 sympy_plot_backends-3.3.0/spb/plot_functions/functions_2d.py
+-rw-r--r--   0 runner    (1001) docker     (127)    39553 2024-04-14 17:56:59.000000 sympy_plot_backends-3.3.0/spb/plot_functions/functions_3d.py
+-rw-r--r--   0 runner    (1001) docker     (127)    13884 2024-04-14 17:56:59.000000 sympy_plot_backends-3.3.0/spb/plot_functions/vectors.py
+-rw-r--r--   0 runner    (1001) docker     (127)    24769 2024-04-14 17:56:59.000000 sympy_plot_backends-3.3.0/spb/plotgrid.py
+-rw-r--r--   0 runner    (1001) docker     (127)   183807 2024-04-14 17:56:59.000000 sympy_plot_backends-3.3.0/spb/series.py
+-rw-r--r--   0 runner    (1001) docker     (127)    35757 2024-04-14 17:56:59.000000 sympy_plot_backends-3.3.0/spb/utils.py
+-rw-r--r--   0 runner    (1001) docker     (127)      304 2024-04-14 17:56:59.000000 sympy_plot_backends-3.3.0/spb/vectors.py
+-rw-r--r--   0 runner    (1001) docker     (127)    15898 2024-04-14 17:56:59.000000 sympy_plot_backends-3.3.0/spb/wegert.py
+drwxr-xr-x   0 runner    (1001) docker     (127)        0 2024-04-14 17:57:04.070653 sympy_plot_backends-3.3.0/sympy_plot_backends.egg-info/
+-rw-r--r--   0 runner    (1001) docker     (127)     7287 2024-04-14 17:57:04.000000 sympy_plot_backends-3.3.0/sympy_plot_backends.egg-info/PKG-INFO
+-rw-r--r--   0 runner    (1001) docker     (127)     5431 2024-04-14 17:57:04.000000 sympy_plot_backends-3.3.0/sympy_plot_backends.egg-info/SOURCES.txt
+-rw-r--r--   0 runner    (1001) docker     (127)        1 2024-04-14 17:57:04.000000 sympy_plot_backends-3.3.0/sympy_plot_backends.egg-info/dependency_links.txt
+-rw-r--r--   0 runner    (1001) docker     (127)        1 2024-04-14 17:57:03.000000 sympy_plot_backends-3.3.0/sympy_plot_backends.egg-info/not-zip-safe
+-rw-r--r--   0 runner    (1001) docker     (127)      437 2024-04-14 17:57:04.000000 sympy_plot_backends-3.3.0/sympy_plot_backends.egg-info/requires.txt
+-rw-r--r--   0 runner    (1001) docker     (127)       10 2024-04-14 17:57:04.000000 sympy_plot_backends-3.3.0/sympy_plot_backends.egg-info/top_level.txt
+drwxr-xr-x   0 runner    (1001) docker     (127)        0 2024-04-14 17:57:04.066653 sympy_plot_backends-3.3.0/tests/
+drwxr-xr-x   0 runner    (1001) docker     (127)        0 2024-04-14 17:57:04.066653 sympy_plot_backends-3.3.0/tests/backends/
+-rw-r--r--   0 runner    (1001) docker     (127)      605 2024-04-14 17:56:59.000000 sympy_plot_backends-3.3.0/tests/backends/__init__.py
+-rw-r--r--   0 runner    (1001) docker     (127)    24971 2024-04-14 17:56:59.000000 sympy_plot_backends-3.3.0/tests/backends/make_tests.py
+-rw-r--r--   0 runner    (1001) docker     (127)    12659 2024-04-14 17:56:59.000000 sympy_plot_backends-3.3.0/tests/backends/test_base_backend.py
+-rw-r--r--   0 runner    (1001) docker     (127)    52843 2024-04-14 17:56:59.000000 sympy_plot_backends-3.3.0/tests/backends/test_bokeh.py
+-rw-r--r--   0 runner    (1001) docker     (127)     3758 2024-04-14 17:56:59.000000 sympy_plot_backends-3.3.0/tests/backends/test_color_utils.py
+-rw-r--r--   0 runner    (1001) docker     (127)    28531 2024-04-14 17:56:59.000000 sympy_plot_backends-3.3.0/tests/backends/test_k3d.py
+-rw-r--r--   0 runner    (1001) docker     (127)    84925 2024-04-14 17:56:59.000000 sympy_plot_backends-3.3.0/tests/backends/test_matplotlib.py
+-rw-r--r--   0 runner    (1001) docker     (127)    57115 2024-04-14 17:56:59.000000 sympy_plot_backends-3.3.0/tests/backends/test_plotly.py
+drwxr-xr-x   0 runner    (1001) docker     (127)        0 2024-04-14 17:57:04.066653 sympy_plot_backends-3.3.0/tests/graphics/
+-rw-r--r--   0 runner    (1001) docker     (127)        0 2024-04-14 17:56:59.000000 sympy_plot_backends-3.3.0/tests/graphics/__init__.py
+-rw-r--r--   0 runner    (1001) docker     (127)    15383 2024-04-14 17:56:59.000000 sympy_plot_backends-3.3.0/tests/graphics/test_complex_analysis.py
+-rw-r--r--   0 runner    (1001) docker     (127)    34946 2024-04-14 17:56:59.000000 sympy_plot_backends-3.3.0/tests/graphics/test_control.py
+-rw-r--r--   0 runner    (1001) docker     (127)     1548 2024-04-14 17:56:59.000000 sympy_plot_backends-3.3.0/tests/graphics/test_control_min_module.py
+-rw-r--r--   0 runner    (1001) docker     (127)    10457 2024-04-14 17:56:59.000000 sympy_plot_backends-3.3.0/tests/graphics/test_functions_2d.py
+-rw-r--r--   0 runner    (1001) docker     (127)    15142 2024-04-14 17:56:59.000000 sympy_plot_backends-3.3.0/tests/graphics/test_functions_3d.py
+-rw-r--r--   0 runner    (1001) docker     (127)     4687 2024-04-14 17:56:59.000000 sympy_plot_backends-3.3.0/tests/graphics/test_graphics.py
+-rw-r--r--   0 runner    (1001) docker     (127)    10885 2024-04-14 17:56:59.000000 sympy_plot_backends-3.3.0/tests/graphics/test_vectors.py
+drwxr-xr-x   0 runner    (1001) docker     (127)        0 2024-04-14 17:57:04.070653 sympy_plot_backends-3.3.0/tests/interactive/
+-rw-r--r--   0 runner    (1001) docker     (127)        0 2024-04-14 17:56:59.000000 sympy_plot_backends-3.3.0/tests/interactive/__init__.py
+-rw-r--r--   0 runner    (1001) docker     (127)     8079 2024-04-14 17:56:59.000000 sympy_plot_backends-3.3.0/tests/interactive/test_interactive.py
+-rw-r--r--   0 runner    (1001) docker     (127)     5569 2024-04-14 17:56:59.000000 sympy_plot_backends-3.3.0/tests/interactive/test_ipywidgets.py
+-rw-r--r--   0 runner    (1001) docker     (127)     9410 2024-04-14 17:56:59.000000 sympy_plot_backends-3.3.0/tests/interactive/test_panel.py
+drwxr-xr-x   0 runner    (1001) docker     (127)        0 2024-04-14 17:57:04.070653 sympy_plot_backends-3.3.0/tests/plot_functions/
+-rw-r--r--   0 runner    (1001) docker     (127)        0 2024-04-14 17:56:59.000000 sympy_plot_backends-3.3.0/tests/plot_functions/__init__.py
+-rw-r--r--   0 runner    (1001) docker     (127)    94547 2024-04-14 17:56:59.000000 sympy_plot_backends-3.3.0/tests/plot_functions/test_complex.py
+-rw-r--r--   0 runner    (1001) docker     (127)    43062 2024-04-14 17:56:59.000000 sympy_plot_backends-3.3.0/tests/plot_functions/test_control.py
+-rw-r--r--   0 runner    (1001) docker     (127)    51725 2024-04-14 17:56:59.000000 sympy_plot_backends-3.3.0/tests/plot_functions/test_functions_2d.py
+-rw-r--r--   0 runner    (1001) docker     (127)    33383 2024-04-14 17:56:59.000000 sympy_plot_backends-3.3.0/tests/plot_functions/test_functions_3d.py
+-rw-r--r--   0 runner    (1001) docker     (127)    52073 2024-04-14 17:56:59.000000 sympy_plot_backends-3.3.0/tests/plot_functions/test_vectors.py
+-rw-r--r--   0 runner    (1001) docker     (127)     5513 2024-04-14 17:56:59.000000 sympy_plot_backends-3.3.0/tests/test_defaults.py
+-rw-r--r--   0 runner    (1001) docker     (127)      935 2024-04-14 17:56:59.000000 sympy_plot_backends-3.3.0/tests/test_deprecated_module.py
+-rw-r--r--   0 runner    (1001) docker     (127)     8617 2024-04-14 17:56:59.000000 sympy_plot_backends-3.3.0/tests/test_doc_utils.py
+-rw-r--r--   0 runner    (1001) docker     (127)    26605 2024-04-14 17:56:59.000000 sympy_plot_backends-3.3.0/tests/test_plotgrid.py
+-rw-r--r--   0 runner    (1001) docker     (127)   148076 2024-04-14 17:56:59.000000 sympy_plot_backends-3.3.0/tests/test_series.py
+-rw-r--r--   0 runner    (1001) docker     (127)    18086 2024-04-14 17:56:59.000000 sympy_plot_backends-3.3.0/tests/test_utils.py
```

### Comparing `sympy_plot_backends-3.2.0/LICENSE` & `sympy_plot_backends-3.3.0/LICENSE`

 * *Files identical despite different names*

### Comparing `sympy_plot_backends-3.2.0/PKG-INFO` & `sympy_plot_backends-3.3.0/PKG-INFO`

 * *Files 6% similar despite different names*

```diff
@@ -1,10 +1,10 @@
 Metadata-Version: 2.1
 Name: sympy_plot_backends
-Version: 3.2.0
+Version: 3.3.0
 Summary: Backends for plotting with SymPy
 Home-page: https://github.com/Davide-sd/sympy-plot-backends
 Author: Davide Sandona
 Author-email: sandona.davide@gmail.com
 License: BSD License
 Keywords: sympy plot plotting backend plotly bokeh mayavi k3d panel
 Classifier: Development Status :: 5 - Production/Stable
@@ -28,45 +28,46 @@
 Requires-Dist: ipympl>=0.7.0; extra == "all"
 Requires-Dist: plotly>=4.14.3; extra == "all"
 Requires-Dist: panel>=1.0.0; extra == "all"
 Requires-Dist: ipywidgets_bokeh; extra == "all"
 Requires-Dist: colorcet; extra == "all"
 Requires-Dist: k3d>=2.9.7; extra == "all"
 Requires-Dist: vtk; extra == "all"
-Requires-Dist: control>=0.9.4; extra == "all"
+Requires-Dist: control>=0.10.0; extra == "all"
 Provides-Extra: dev
 Requires-Dist: scipy>=1.7.1; extra == "dev"
 Requires-Dist: adaptive>=0.13.1; extra == "dev"
 Requires-Dist: notebook; extra == "dev"
 Requires-Dist: ipympl>=0.7.0; extra == "dev"
 Requires-Dist: plotly>=4.14.3; extra == "dev"
 Requires-Dist: panel>=1.0.0; extra == "dev"
 Requires-Dist: ipywidgets_bokeh; extra == "dev"
 Requires-Dist: colorcet; extra == "dev"
 Requires-Dist: k3d>=2.9.7; extra == "dev"
 Requires-Dist: vtk; extra == "dev"
-Requires-Dist: control>=0.9.4; extra == "dev"
+Requires-Dist: control>=0.10.0; extra == "dev"
 Requires-Dist: pytest; extra == "dev"
 Requires-Dist: pytest-mock; extra == "dev"
 Requires-Dist: sphinx; extra == "dev"
 Requires-Dist: sphinx-rtd-theme; extra == "dev"
 Requires-Dist: kaleido; extra == "dev"
 Requires-Dist: numpydoc; extra == "dev"
 
 # Sympy Plotting Backends
 
 [![PyPI version](https://badge.fury.io/py/sympy-plot-backends.svg)](https://badge.fury.io/py/sympy-plot-backends)
 [![Conda Version](https://img.shields.io/conda/vn/conda-forge/sympy_plot_backends.svg)](https://anaconda.org/conda-forge/sympy_plot_backends)
 [![Documentation Status](https://readthedocs.org/projects/sympy-plot-backends/badge/?version=latest)](http://sympy-plot-backends.readthedocs.io/)
 ![Coverage](https://github.com/Davide-sd/sympy-plot-backends/blob/master/coverage.svg)
+[![](https://img.shields.io/static/v1?label=Github%20Sponsor&message=%E2%9D%A4&logo=GitHub&color=%23fe8e86)](https://github.com/sponsors/Davide-sd)
 
 
 This module contains a few plotting backends that can be used with [SymPy](github.com/sympy/sympy) and [Numpy](https://github.com/numpy/numpy). A backend represents the plotting library: it provides the necessary functionalities to quickly and easily plot the most common types of symbolic expressions (line plots, surface plots, parametric plots, vector plots, complex plots, control system plots).
 
-The following plotting libraries are supported: [Matplolib](https://matplotlib.org/), [Plotly](https://plotly.com/), [Bokeh](https://github.com/bokeh/bokeh), [K3D-Jupyter](https://github.com/K3D-tools/K3D-jupyter), [Mayavi](https://github.com/enthought/mayavi).
+The following plotting libraries are supported: [Matplolib](https://matplotlib.org/), [Plotly](https://plotly.com/), [Bokeh](https://github.com/bokeh/bokeh), [K3D-Jupyter](https://github.com/K3D-tools/K3D-jupyter).
 
 <div>
 <img src="https://raw.githubusercontent.com/Davide-sd/sympy-plot-backends/master/imgs/iplot_bokeh.png" width=250/>
 <img src="https://raw.githubusercontent.com/Davide-sd/sympy-plot-backends/master/imgs/mpl-streamplot.png" width=250/>
 <img src="https://raw.githubusercontent.com/Davide-sd/sympy-plot-backends/master/imgs/plotly_streamlines_2.png" width=250/>
 <img src="https://raw.githubusercontent.com/Davide-sd/sympy-plot-backends/master/imgs/K3D-spherical-harmonics.png" width=250/>
 <img src="https://raw.githubusercontent.com/Davide-sd/sympy-plot-backends/master/imgs/bokeh_domain_coloring.png" width=250/>
@@ -80,32 +81,39 @@
 `plot_parametric`, `plot3d`, etc.), this module offers the capabily to:
 
 * use a different plotting library.
 * visualize discontinuities on 2D line plots.
 * visualize 2D/3D vector fields with quivers or streamlines.
 * visualize complex functions with [domain coloring](https://en.wikipedia.org/wiki/Domain_coloring).
 * visualize entities from the `sympy.geometry` module.
-* visualize control systems' response to input signals, visualize Bode, Nyquist and Nichols plots.
+* visualize control systems' response to input signals, root locus, as well as Bode, Nyquist and Nichols diagrams.
 * create parametric-interactive plots using widgets
   (sliders, buttons, etc.) with *ipywidgets* or *Holoviz's Panel*.
-* combine multiple plots into a grid-like layout.
 
 Please, read the
 [following documentation page](https://sympy-plot-backends.readthedocs.io/en/latest/overview.html#differences-with-sympy-plotting)
 to understand the differences between this module and ``sympy.plotting``.
 
-If you feel like some feature could be implemented, open an issue or create
-a PR.
 
+## Development and Support
 
-## Explore the Capabilities
+If you feel like a feature could be implemented, open an issue or create a PR.
 
-[Read the documentation](https://sympy-plot-backends.readthedocs.io/) to 
-explore the capabilities before the installation, which contains plenty of
-examples.
+If you really want a new feature but you don't have the capabilities or the
+time to make it work, I'm willing to help; but first, open an issue or send
+me an email so that we can discuss a sponsorship strategy.
+
+Developing this module and its documentation was no easy job. Implementing
+new features and fixing bugs requires time and energy too. If you found this
+module useful and would like to show your appreciation, please consider
+sponsoring this project with either one of these options:
+
+[!["Buy Me A Coffee"](https://www.buymeacoffee.com/assets/img/custom_images/orange_img.png)](https://www.buymeacoffee.com/davide_sd)
+or
+[![](https://img.shields.io/static/v1?label=Github%20Sponsor&message=%E2%9D%A4&logo=GitHub&color=%23fe8e86)](https://github.com/sponsors/Davide-sd)
 
 
 ## Installation
 
 *SymPy Plotting Backends* can be installed with `pip` or `conda`. By default,
 only basic plotting with Matplotlib will be installed:
 
@@ -122,32 +130,33 @@
 To install the complete requirements in order to get interactive plots, bokeh,
 plotly, k3d, vtk, execute the following command:
 
 ```
 pip install sympy_plot_backends[all]
 ```
 
-Or:
+If you are using zshell, the above `pip` command is going to fail.
+Use the following instead:
+
+```
+pip install "sympy_plot_backends[all]"
+```
+
+Or, if you are using `conda`:
 
 ```
 conda install -c anaconda scipy notebook colorcet
 conda install -c conda-forge adaptive
 conda install -c conda-forge panel
 conda install -c anaconda ipywidgets
 conda install -c conda-forge ipympl
 conda install -c bokeh ipywidgets_bokeh
 conda install -c conda-forge k3d msgpack-python
 conda install -c plotly plotly
 conda install -c conda-forge vtk
+conda install -c conda-forge control slycot
 ```
 
-Finally, if you are using zshell, the above `pip` command is going to fail.
-Use the following instead:
-
-```
-pip install "sympy_plot_backends[all]"
-```
-  
 
 ## Warnings
 
 **Some backend comes with a memory cost**. Since they require external libraries and/or open a server-process in order to visualize the data, memory usage can quickly rise if we are showing many plots. Keep an eye on you system monitor and act accordingly (close the kernels, restart the browser, etc.).
```

### Comparing `sympy_plot_backends-3.2.0/README.md` & `sympy_plot_backends-3.3.0/README.md`

 * *Files 18% similar despite different names*

```diff
@@ -1,18 +1,19 @@
 # Sympy Plotting Backends
 
 [![PyPI version](https://badge.fury.io/py/sympy-plot-backends.svg)](https://badge.fury.io/py/sympy-plot-backends)
 [![Conda Version](https://img.shields.io/conda/vn/conda-forge/sympy_plot_backends.svg)](https://anaconda.org/conda-forge/sympy_plot_backends)
 [![Documentation Status](https://readthedocs.org/projects/sympy-plot-backends/badge/?version=latest)](http://sympy-plot-backends.readthedocs.io/)
 ![Coverage](https://github.com/Davide-sd/sympy-plot-backends/blob/master/coverage.svg)
+[![](https://img.shields.io/static/v1?label=Github%20Sponsor&message=%E2%9D%A4&logo=GitHub&color=%23fe8e86)](https://github.com/sponsors/Davide-sd)
 
 
 This module contains a few plotting backends that can be used with [SymPy](github.com/sympy/sympy) and [Numpy](https://github.com/numpy/numpy). A backend represents the plotting library: it provides the necessary functionalities to quickly and easily plot the most common types of symbolic expressions (line plots, surface plots, parametric plots, vector plots, complex plots, control system plots).
 
-The following plotting libraries are supported: [Matplolib](https://matplotlib.org/), [Plotly](https://plotly.com/), [Bokeh](https://github.com/bokeh/bokeh), [K3D-Jupyter](https://github.com/K3D-tools/K3D-jupyter), [Mayavi](https://github.com/enthought/mayavi).
+The following plotting libraries are supported: [Matplolib](https://matplotlib.org/), [Plotly](https://plotly.com/), [Bokeh](https://github.com/bokeh/bokeh), [K3D-Jupyter](https://github.com/K3D-tools/K3D-jupyter).
 
 <div>
 <img src="https://raw.githubusercontent.com/Davide-sd/sympy-plot-backends/master/imgs/iplot_bokeh.png" width=250/>
 <img src="https://raw.githubusercontent.com/Davide-sd/sympy-plot-backends/master/imgs/mpl-streamplot.png" width=250/>
 <img src="https://raw.githubusercontent.com/Davide-sd/sympy-plot-backends/master/imgs/plotly_streamlines_2.png" width=250/>
 <img src="https://raw.githubusercontent.com/Davide-sd/sympy-plot-backends/master/imgs/K3D-spherical-harmonics.png" width=250/>
 <img src="https://raw.githubusercontent.com/Davide-sd/sympy-plot-backends/master/imgs/bokeh_domain_coloring.png" width=250/>
@@ -26,32 +27,39 @@
 `plot_parametric`, `plot3d`, etc.), this module offers the capabily to:
 
 * use a different plotting library.
 * visualize discontinuities on 2D line plots.
 * visualize 2D/3D vector fields with quivers or streamlines.
 * visualize complex functions with [domain coloring](https://en.wikipedia.org/wiki/Domain_coloring).
 * visualize entities from the `sympy.geometry` module.
-* visualize control systems' response to input signals, visualize Bode, Nyquist and Nichols plots.
+* visualize control systems' response to input signals, root locus, as well as Bode, Nyquist and Nichols diagrams.
 * create parametric-interactive plots using widgets
   (sliders, buttons, etc.) with *ipywidgets* or *Holoviz's Panel*.
-* combine multiple plots into a grid-like layout.
 
 Please, read the
 [following documentation page](https://sympy-plot-backends.readthedocs.io/en/latest/overview.html#differences-with-sympy-plotting)
 to understand the differences between this module and ``sympy.plotting``.
 
-If you feel like some feature could be implemented, open an issue or create
-a PR.
 
+## Development and Support
 
-## Explore the Capabilities
+If you feel like a feature could be implemented, open an issue or create a PR.
 
-[Read the documentation](https://sympy-plot-backends.readthedocs.io/) to 
-explore the capabilities before the installation, which contains plenty of
-examples.
+If you really want a new feature but you don't have the capabilities or the
+time to make it work, I'm willing to help; but first, open an issue or send
+me an email so that we can discuss a sponsorship strategy.
+
+Developing this module and its documentation was no easy job. Implementing
+new features and fixing bugs requires time and energy too. If you found this
+module useful and would like to show your appreciation, please consider
+sponsoring this project with either one of these options:
+
+[!["Buy Me A Coffee"](https://www.buymeacoffee.com/assets/img/custom_images/orange_img.png)](https://www.buymeacoffee.com/davide_sd)
+or
+[![](https://img.shields.io/static/v1?label=Github%20Sponsor&message=%E2%9D%A4&logo=GitHub&color=%23fe8e86)](https://github.com/sponsors/Davide-sd)
 
 
 ## Installation
 
 *SymPy Plotting Backends* can be installed with `pip` or `conda`. By default,
 only basic plotting with Matplotlib will be installed:
 
@@ -68,32 +76,33 @@
 To install the complete requirements in order to get interactive plots, bokeh,
 plotly, k3d, vtk, execute the following command:
 
 ```
 pip install sympy_plot_backends[all]
 ```
 
-Or:
+If you are using zshell, the above `pip` command is going to fail.
+Use the following instead:
+
+```
+pip install "sympy_plot_backends[all]"
+```
+
+Or, if you are using `conda`:
 
 ```
 conda install -c anaconda scipy notebook colorcet
 conda install -c conda-forge adaptive
 conda install -c conda-forge panel
 conda install -c anaconda ipywidgets
 conda install -c conda-forge ipympl
 conda install -c bokeh ipywidgets_bokeh
 conda install -c conda-forge k3d msgpack-python
 conda install -c plotly plotly
 conda install -c conda-forge vtk
+conda install -c conda-forge control slycot
 ```
 
-Finally, if you are using zshell, the above `pip` command is going to fail.
-Use the following instead:
-
-```
-pip install "sympy_plot_backends[all]"
-```
-  
 
 ## Warnings
 
 **Some backend comes with a memory cost**. Since they require external libraries and/or open a server-process in order to visualize the data, memory usage can quickly rise if we are showing many plots. Keep an eye on you system monitor and act accordingly (close the kernels, restart the browser, etc.).
```

### Comparing `sympy_plot_backends-3.2.0/setup.py` & `sympy_plot_backends-3.3.0/setup.py`

 * *Files 1% similar despite different names*

```diff
@@ -17,15 +17,15 @@
     "ipympl>=0.7.0",
     "plotly>=4.14.3",
     "panel>=1.0.0", # this includes param and bokeh
     "ipywidgets_bokeh", # starting from panel v0.13.0, it is not part of panel anymore
     "colorcet",
     "k3d>=2.9.7",
     "vtk",  # needed for streamlines in k3d
-    "control>=0.9.4"
+    "control>=0.10.0"
     # mayavi-related
     # "mayavi>=4.8.0",
     # "PyQt5>=5.15.7",
 ]
 
 _dev_deps = _all_deps + [
     "pytest",
```

### Comparing `sympy_plot_backends-3.2.0/spb/__init__.py` & `sympy_plot_backends-3.3.0/spb/__init__.py`

 * *Files identical despite different names*

### Comparing `sympy_plot_backends-3.2.0/spb/backends/base_backend.py` & `sympy_plot_backends-3.3.0/spb/backends/base_backend.py`

 * *Files 2% similar despite different names*

```diff
@@ -13,28 +13,31 @@
     which implements the necessary functionalities in order to use SymPy
     plotting functions.
 
     How the plotting module works:
 
     1. The user creates the symbolic expressions and calls one of the plotting
        functions.
-    2. The plotting functions generate a list of instances of the `BaseSeries`
-       class, containing the necessary information to plot the expressions
-       (eg the expression, ranges, series name, ...). Eventually, these
-       objects will generate the numerical data to be plotted.
-    3. The plotting functions instantiate the `Plot` class, which stores the
+    2. The plotting functions generate a list of instances of ``BaseSeries``,
+       containing the necessary information to generate the appropriate
+       numerical data and create the proper visualization
+       (eg the expression, ranges, series name, ...).
+    3. The plotting functions instantiate the ``Plot`` class, which stores the
        list of series and the main attributes of the plot (eg axis labels,
-       title, etc.). Among the keyword arguments, there must be `backend`,
-       a subclass of `Plot` which specify the backend to be used.
-    4. The backend will render the numerical data to a plot and (eventually)
-       show it on the screen. The figure is populated with numerical data once
-       the `show()` method or the `fig` attribute are called.
+       title, etc.). Among the keyword arguments, there must be ``backend=``,
+       where a subclass of ``Plot`` can be specified in order to use a
+       particular plotting library.
+    4. Each data series will be associated to a corresponding renderer, which
+       receives the numerical data and add it to the figure. A renderer is also
+       responsible to keep objects up-to-date when interactive-widgets plots
+       are used. The figure is populated with numerical data when the
+       ``show()`` method or the ``fig`` attribute are called.
 
     The backend should check if it supports the data series that it's given.
-    Please, explore the `MatplotlibBackend` source code to understand how a
+    Please, explore ``MatplotlibBackend`` source code to understand how a
     backend should be coded.
 
     Also note that setting attributes to plot objects or to data series after
     they have been instantiated is strongly unrecommended, as it is not
     guaranteed that the figure will be updated.
 
     Notes
@@ -44,15 +47,15 @@
     the following methods and attributes:
 
     * ``show(self)``: used to loop over the data series, generate the
       numerical data, plot it and set the axis labels, title, ...
     * ``save(self, path, **kwargs)``: used to save the current plot to the
       specified file path.
     * ``self._fig``: an instance attribute to store the backend-specific plot
-      object, which can be retrieved with the `Plot.fig` attribute. This
+      object, which can be retrieved with the ``Plot.fig`` attribute. This
       object can then be used to further customize the resulting plot, using
       backend-specific commands.
     * ``update_interactive(self, params)``: this method receives a dictionary
       mapping parameters to their values from the ``iplot`` function, which
       are going to be used to update the objects of the figure.
 
     Parameters
@@ -330,16 +333,19 @@
 
         # Automatic legend: if more than 1 data series has been provided
         # and the user has not set legend=False, then show the legend for
         # better clarity.
         self.legend = kwargs.get("legend", None)
         if self.legend is None:
             series_to_show = [
-                s for s in self._series if (s.show_in_legend and (not s.use_cm)
-                and (not s.is_grid))
+                s for s in self._series if (
+                    s.show_in_legend and
+                    (not s.use_cm) and
+                    (not s.is_grid)
+                )
             ]
             if len(series_to_show) > 1:
                 # don't show the legend if `plot_piecewise` created this
                 # backend
                 if not ("process_piecewise" in kwargs.keys()):
                     self.legend = True
```

### Comparing `sympy_plot_backends-3.2.0/spb/backends/base_renderer.py` & `sympy_plot_backends-3.3.0/spb/backends/base_renderer.py`

 * *Files identical despite different names*

### Comparing `sympy_plot_backends-3.2.0/spb/backends/bokeh/bokeh.py` & `sympy_plot_backends-3.3.0/spb/backends/bokeh/bokeh.py`

 * *Files 3% similar despite different names*

```diff
@@ -102,14 +102,32 @@
     References
     ==========
     .. [#fn1] https://docs.bokeh.org/en/latest/docs/reference/plotting.html#bokeh.plotting.Figure.line
     .. [#fn2] https://docs.bokeh.org/en/latest/docs/reference/themes.html
     .. [#fn6] https://docs.bokeh.org/en/latest/docs/reference/plotting/figure.html#bokeh.plotting.Figure.scatter
 
 
+    Notes
+    =====
+
+    By providing ``update_event=True`` to any plot function, this backend
+    binds pan/zoom events in order to automatically compute new data as the
+    user interact with the plot.
+
+    When executing this mode of operation inside:
+
+    * Jupyter Notebook/Lab: no problem has been encountered (with
+      Firefox/Chrome).
+    * A standard Python interpreter:
+
+      * No problem has been encountered with Chrome.
+      * Memory leaks has been observed with Firefox. Watch out your system
+        monitor!
+
+
     See also
     ========
 
     Plot, MatplotlibBackend, PlotlyBackend, K3DBackend
     """
 
     _library = "bokeh"
@@ -156,15 +174,15 @@
     def __init__(self, *args, **kwargs):
         self.np = import_module('numpy')
         self.bokeh = import_module(
             'bokeh',
             import_kwargs={
                 'fromlist': [
                     'models', 'events', 'plotting', 'io',
-                    'palettes', 'embed', 'resources'
+                    'palettes', 'embed', 'resources', 'server'
                 ]
             },
             warn_not_installed=True,
             min_module_version='2.3.0'
         )
         bp = self.bokeh.palettes
         cc = import_module(
@@ -327,20 +345,24 @@
             r.draw()
             if hasattr(r, "_xlims"):
                 xlims.extend(r._xlims)
                 ylims.extend(r._ylims)
 
         if (len(xlims) > 0) and (self.xlim is None):
             # this is used in order to properly visualized some *GridSeries
-            np = import_module("numpy")
+            np = self.np
             xlims = np.array(xlims)
             xlim = (np.nanmin(xlims[:, 0]), np.nanmax(xlims[:, 1]))
+            self._fig.x_range = self.bokeh.models.Range1d(*xlim)
+
+        if (len(ylims) > 0) and (self.ylim is None):
+            # this is used in order to properly visualized some *GridSeries
+            np = self.np
             ylims = np.array(ylims)
             ylim = (np.nanmin(ylims[:, 0]), np.nanmax(ylims[:, 1]))
-            self._fig.x_range = self.bokeh.models.Range1d(*xlim)
             self._fig.y_range = self.bokeh.models.Range1d(*ylim)
 
         if len(self._fig.legend) > 0:
             # hide default legend
             self._fig.legend.visible = False
             # add a new legend only showing the appropriate items
             legend_items = []
@@ -426,17 +448,35 @@
 
         params : dict
             Map parameter-symbols to numeric values.
         """
         if len(self.renderers) > 0 and len(self.renderers[0].handles) == 0:
             self.draw()
 
+        xlims, ylims = [], []
         for r in self.renderers:
             if r.series.is_interactive:
                 r.update(params)
+                if hasattr(r, "_xlims"):
+                    xlims.extend(r._xlims)
+                    ylims.extend(r._ylims)
+
+        if (len(xlims) > 0) and (self.xlim is None):
+            # this is used in order to properly visualized some *GridSeries
+            np = self.np
+            xlims = np.array(xlims)
+            xlim = (np.nanmin(xlims[:, 0]), np.nanmax(xlims[:, 1]))
+            self._fig.x_range.update(start=xlim[0], end=xlim[1])
+
+        if (len(ylims) > 0) and (self.ylim is None):
+            # this is used in order to properly visualized some *GridSeries
+            np = self.np
+            ylims = np.array(ylims)
+            ylim = (np.nanmin(ylims[:, 0]), np.nanmax(ylims[:, 1]))
+            self._fig.y_range.update(start=ylim[0], end=ylim[1])
 
         self._set_axes_texts()
 
     def _set_axes_texts(self):
         title, xlabel, ylabel, zlabel = self._get_title_and_labels()
         self._fig.title = title
         self._fig.xaxis.axis_label = xlabel
@@ -485,30 +525,39 @@
             self.bokeh.io.export_png(self._fig, filename=path)
 
     def _launch_server(self, doc):
         """ By launching a server application, we can use Python callbacks
         associated to events.
         """
         doc.theme = self._theme
-        doc.add_root(self._fig)
+        doc.add_root(self.fig)
 
     def show(self):
         """Visualize the plot on the screen."""
         if len(self._fig.renderers) != len(self.series):
             self._process_renderers()
 
         if self._update_event:
-            # TODO: the current way we are launching the server only works within
-            # Jupyter Notebook. Is there another way of launching it so that it can
-            # run from any Python interpreter?
-            self.bokeh.plotting.show(self._launch_server)
+            if self._run_in_notebook:
+                self.bokeh.plotting.show(self._launch_server)
+            else:
+                # NOTE:
+                # 1. From: https://docs.bokeh.org/en/latest/docs/user_guide/server/library.html
+                #    In particular: https://github.com/bokeh/bokeh/tree/3.4.0/examples/server/api/standalone_embed.py
+                # 2. TODO: Only works for one plot, then python needs to be
+                #    closed and reopened.
+                # 3. Use Control+C to stop the server process
+                # 4. Watch out for memory leaks on Firefox.
+                from bokeh.server.server import Server
+                server = Server(self._launch_server, num_procs=1)
+                server.start()
+                server.io_loop.add_callback(server.show, "/")
+                server.io_loop.start()
         else:
-            # if the backend it running from a python interpreter, the server
-            # wont' work. Hence, launch a static figure, which doesn't listen
-            # to events (no pan-auto-update).
+            # launch a static figure
             curdoc = self.bokeh.io.curdoc
             curdoc().theme = self._theme
             self.bokeh.plotting.show(self._fig)
 
     def _get_quivers_data(self, xs, ys, u, v, **quiver_kw):
         """Compute the segments coordinates to plot quivers.
```

### Comparing `sympy_plot_backends-3.2.0/spb/backends/bokeh/renderers/__init__.py` & `sympy_plot_backends-3.3.0/spb/backends/bokeh/renderers/__init__.py`

 * *Files identical despite different names*

### Comparing `sympy_plot_backends-3.2.0/spb/backends/bokeh/renderers/arrow2d.py` & `sympy_plot_backends-3.3.0/spb/backends/bokeh/renderers/arrow2d.py`

 * *Files identical despite different names*

### Comparing `sympy_plot_backends-3.2.0/spb/backends/bokeh/renderers/complex.py` & `sympy_plot_backends-3.3.0/spb/backends/bokeh/renderers/complex.py`

 * *Files identical despite different names*

### Comparing `sympy_plot_backends-3.2.0/spb/backends/bokeh/renderers/contour.py` & `sympy_plot_backends-3.3.0/spb/backends/bokeh/renderers/contour.py`

 * *Files identical despite different names*

### Comparing `sympy_plot_backends-3.2.0/spb/backends/bokeh/renderers/generic.py` & `sympy_plot_backends-3.3.0/spb/backends/bokeh/renderers/generic.py`

 * *Files identical despite different names*

### Comparing `sympy_plot_backends-3.2.0/spb/backends/bokeh/renderers/geometry.py` & `sympy_plot_backends-3.3.0/spb/backends/bokeh/renderers/geometry.py`

 * *Files identical despite different names*

### Comparing `sympy_plot_backends-3.2.0/spb/backends/bokeh/renderers/hvline.py` & `sympy_plot_backends-3.3.0/spb/backends/bokeh/renderers/hvline.py`

 * *Files identical despite different names*

### Comparing `sympy_plot_backends-3.2.0/spb/backends/bokeh/renderers/line2d.py` & `sympy_plot_backends-3.3.0/spb/backends/bokeh/renderers/line2d.py`

 * *Files identical despite different names*

### Comparing `sympy_plot_backends-3.2.0/spb/backends/bokeh/renderers/mcircles.py` & `sympy_plot_backends-3.3.0/spb/backends/bokeh/renderers/mcircles.py`

 * *Files identical despite different names*

### Comparing `sympy_plot_backends-3.2.0/spb/backends/bokeh/renderers/ngrid.py` & `sympy_plot_backends-3.3.0/spb/backends/bokeh/renderers/ngrid.py`

 * *Files identical despite different names*

### Comparing `sympy_plot_backends-3.2.0/spb/backends/bokeh/renderers/nichols.py` & `sympy_plot_backends-3.3.0/spb/backends/bokeh/renderers/nichols.py`

 * *Files identical despite different names*

### Comparing `sympy_plot_backends-3.2.0/spb/backends/bokeh/renderers/nyquist.py` & `sympy_plot_backends-3.3.0/spb/backends/bokeh/renderers/nyquist.py`

 * *Files identical despite different names*

### Comparing `sympy_plot_backends-3.2.0/spb/backends/bokeh/renderers/polezero.py` & `sympy_plot_backends-3.3.0/spb/backends/bokeh/renderers/polezero.py`

 * *Files 0% similar despite different names*

```diff
@@ -72,16 +72,16 @@
             }
             tooltips = [
                 ("Real", "@x"), ("Imag", "@y"),
                 ("wn", "@wn π/T"), ("xi", "@xi"),
                 ("Ts/T", "@ts"), ("Tp/T", "@tp")
             ]
     else:
-        source = {"Real": x, "Imag": y}
-        tooltips = [("x", "@x"), ("y", "@y")]
+        source = {"x": x, "y": y}
+        tooltips = [("Real", "@x"), ("Imag", "@y")]
 
     return source, tooltips
 
 
 def _draw_pole_zero_helper(renderer, data):
     p, s = renderer.plot, renderer.series
     np = p.np
```

### Comparing `sympy_plot_backends-3.2.0/spb/backends/bokeh/renderers/root_locus.py` & `sympy_plot_backends-3.3.0/spb/backends/bokeh/renderers/root_locus.py`

 * *Files identical despite different names*

### Comparing `sympy_plot_backends-3.2.0/spb/backends/bokeh/renderers/sgrid.py` & `sympy_plot_backends-3.3.0/spb/backends/bokeh/renderers/sgrid.py`

 * *Files 1% similar despite different names*

```diff
@@ -228,19 +228,22 @@
                 xlims.append(s.xlim)
                 ylims.append(s.ylim)
         else:
             xlims, ylims = _find_data_axis_limits(self.plot._fig)
 
         if len(xlims) > 0:
             xlims = np.array(xlims)
-            ylims = np.array(ylims)
             xlim = (np.nanmin(xlims[:, 0]), np.nanmax(xlims[:, 1]))
-            ylim = (np.nanmin(ylims[:, 0]), np.nanmax(ylims[:, 1]))
         else:
             xlim = self.plot.xlim if self.plot.xlim else self.default_xlim
+
+        if len(ylims) > 0:
+            ylims = np.array(ylims)
+            ylim = (np.nanmin(ylims[:, 0]), np.nanmax(ylims[:, 1]))
+        else:
             ylim = self.plot.ylim if self.plot.ylim else self.default_ylim
 
         xlim = _modify_axis_limits(xlim, 0.15, 0.05)
         ylim = _modify_axis_limits(ylim, 0.05, 0.05)
         self.series.set_axis_limits(xlim, ylim)
 
     def draw(self):
```

### Comparing `sympy_plot_backends-3.2.0/spb/backends/bokeh/renderers/vector2d.py` & `sympy_plot_backends-3.3.0/spb/backends/bokeh/renderers/vector2d.py`

 * *Files identical despite different names*

### Comparing `sympy_plot_backends-3.2.0/spb/backends/bokeh/renderers/zgrid.py` & `sympy_plot_backends-3.3.0/spb/backends/bokeh/renderers/zgrid.py`

 * *Files identical despite different names*

### Comparing `sympy_plot_backends-3.2.0/spb/backends/k3d/k3d.py` & `sympy_plot_backends-3.3.0/spb/backends/k3d/k3d.py`

 * *Files identical despite different names*

### Comparing `sympy_plot_backends-3.2.0/spb/backends/k3d/renderers/__init__.py` & `sympy_plot_backends-3.3.0/spb/backends/k3d/renderers/__init__.py`

 * *Files identical despite different names*

### Comparing `sympy_plot_backends-3.2.0/spb/backends/k3d/renderers/arrow3d.py` & `sympy_plot_backends-3.3.0/spb/backends/k3d/renderers/arrow3d.py`

 * *Files identical despite different names*

### Comparing `sympy_plot_backends-3.2.0/spb/backends/k3d/renderers/complex.py` & `sympy_plot_backends-3.3.0/spb/backends/k3d/renderers/complex.py`

 * *Files identical despite different names*

### Comparing `sympy_plot_backends-3.2.0/spb/backends/k3d/renderers/implicit3d.py` & `sympy_plot_backends-3.3.0/spb/backends/k3d/renderers/implicit3d.py`

 * *Files identical despite different names*

### Comparing `sympy_plot_backends-3.2.0/spb/backends/k3d/renderers/line3d.py` & `sympy_plot_backends-3.3.0/spb/backends/k3d/renderers/line3d.py`

 * *Files identical despite different names*

### Comparing `sympy_plot_backends-3.2.0/spb/backends/k3d/renderers/surface.py` & `sympy_plot_backends-3.3.0/spb/backends/k3d/renderers/surface.py`

 * *Files identical despite different names*

### Comparing `sympy_plot_backends-3.2.0/spb/backends/k3d/renderers/vector3d.py` & `sympy_plot_backends-3.3.0/spb/backends/k3d/renderers/vector3d.py`

 * *Files identical despite different names*

### Comparing `sympy_plot_backends-3.2.0/spb/backends/matplotlib/matplotlib.py` & `sympy_plot_backends-3.3.0/spb/backends/matplotlib/matplotlib.py`

 * *Files 2% similar despite different names*

```diff
@@ -335,23 +335,28 @@
             is_3D = [s.is_3D for s in self.series]
             if any(is_3D) and (not all(is_3D)):
                 # allow sum of 3D plots with contour plots
                 if not all(s.is_3D or s.is_contour for s in self.series):
                     raise ValueError(
                         "MatplotlibBackend can not mix 2D and 3D.")
 
-            kwargs = {}
-            if any(is_3D):
-                kwargs["projection"] = "3d"
-            elif (
-                self.polar_axis and
-                any(s.is_2Dline or s.is_contour for s in self.series)
-            ):
-                kwargs["projection"] = "polar"
-            self._ax = self._fig.add_subplot(1, 1, 1, **kwargs)
+            if not any([isinstance(s, SGridLineSeries) and s.auto
+                for s in self.series]):
+                kwargs = {}
+                if any(is_3D):
+                    kwargs["projection"] = "3d"
+                elif (
+                    self.polar_axis and
+                    any(s.is_2Dline or s.is_contour for s in self.series)
+                ):
+                    kwargs["projection"] = "polar"
+                self._ax = self._fig.add_subplot(1, 1, 1, **kwargs)
+            else:
+                from spb.backends.matplotlib.renderers._sgrid_helper import sgrid_auto
+                self._ax = sgrid_auto(self._fig)
 
         if self._update_event:
             self._fig.canvas.mpl_connect(
                 'button_release_event', self._update_axis_limits)
             self._fig.canvas.mpl_connect(
                 'resize_event', self._update_axis_limits)
 
@@ -378,25 +383,14 @@
         self._create_ax_if_not_available()
         return self._ax
 
     def _process_renderers(self):
         # XXX Workaround for matplotlib issue
         # https://github.com/matplotlib/matplotlib/issues/17130
         xlims, ylims, zlims = [], [], []
-
-        if not self._use_existing_figure:
-            # If this instance visualizes only symbolic expressions,
-            # I want to clear axes so that each time `.show()` is called there
-            # won't be repeated handles.
-            # On the other hand:
-            # 1. If the current axes is created by plotgrid, the axes will
-            #    already be empty.
-            # 2. If the current axes is provided by the user, we don't want
-            #    to erase its content.
-            self._ax.cla()
         self._init_cyclers()
         self._legend_handles = []
 
         for r, s in zip(self.renderers, self.series):
             self._check_supported_series(r, s)
             r.draw()
             xlims.extend(r._xlims)
@@ -547,29 +541,27 @@
         if not isinstance(self._ax, self.Axes3D):
             self._ax.autoscale_view(
                 scalex=self._ax.get_autoscalex_on(),
                 scaley=self._ax.get_autoscaley_on()
             )
             # HACK: in order to make interactive contour plots to scale to
             # the appropriate range
-            if xlims and (
-                any(s.is_contour for s in self.series)
+            # TODO: do I still need cond?
+            cond = (
+                any(isinstance(s, (ContourSeries, RootLocusSeries))
+                    for s in self.series)
                 or any(s.is_vector and (not s.is_3D) for s in self.series)
                 or any(s.is_2Dline and s.is_parametric for s in self.series)
                 or any(s.is_grid for s in self.series)
-            ):
+            )
+            if xlims and cond:
                 xlims = np.array(xlims)
                 xlim = (np.nanmin(xlims[:, 0]), np.nanmax(xlims[:, 1]))
                 self._ax.set_xlim(xlim)
-            if ylims and (
-                any(s.is_contour for s in self.series)
-                or any(s.is_vector and (not s.is_3D) for s in self.series)
-                or any(s.is_2Dline and s.is_parametric for s in self.series)
-                or any(s.is_grid for s in self.series)
-            ):
+            if ylims and cond:
                 ylims = np.array(ylims)
                 ylim = (np.nanmin(ylims[:, 0]), np.nanmax(ylims[:, 1]))
                 self._ax.set_ylim(ylim)
         else:
             # XXX Workaround for matplotlib issue
             # https://github.com/matplotlib/matplotlib/issues/17130
             if xlims:
```

### Comparing `sympy_plot_backends-3.2.0/spb/backends/matplotlib/renderers/__init__.py` & `sympy_plot_backends-3.3.0/spb/backends/matplotlib/renderers/__init__.py`

 * *Files identical despite different names*

### Comparing `sympy_plot_backends-3.2.0/spb/backends/matplotlib/renderers/arrow2d.py` & `sympy_plot_backends-3.3.0/spb/backends/matplotlib/renderers/arrow2d.py`

 * *Files identical despite different names*

### Comparing `sympy_plot_backends-3.2.0/spb/backends/matplotlib/renderers/arrow3d.py` & `sympy_plot_backends-3.3.0/spb/backends/matplotlib/renderers/arrow3d.py`

 * *Files identical despite different names*

### Comparing `sympy_plot_backends-3.2.0/spb/backends/matplotlib/renderers/complex.py` & `sympy_plot_backends-3.3.0/spb/backends/matplotlib/renderers/complex.py`

 * *Files identical despite different names*

### Comparing `sympy_plot_backends-3.2.0/spb/backends/matplotlib/renderers/contour.py` & `sympy_plot_backends-3.3.0/spb/backends/matplotlib/renderers/contour.py`

 * *Files identical despite different names*

### Comparing `sympy_plot_backends-3.2.0/spb/backends/matplotlib/renderers/generic.py` & `sympy_plot_backends-3.3.0/spb/backends/matplotlib/renderers/generic.py`

 * *Files identical despite different names*

### Comparing `sympy_plot_backends-3.2.0/spb/backends/matplotlib/renderers/geometry.py` & `sympy_plot_backends-3.3.0/spb/backends/matplotlib/renderers/geometry.py`

 * *Files identical despite different names*

### Comparing `sympy_plot_backends-3.2.0/spb/backends/matplotlib/renderers/hvline.py` & `sympy_plot_backends-3.3.0/spb/backends/matplotlib/renderers/hvline.py`

 * *Files identical despite different names*

### Comparing `sympy_plot_backends-3.2.0/spb/backends/matplotlib/renderers/implicit2d.py` & `sympy_plot_backends-3.3.0/spb/backends/matplotlib/renderers/implicit2d.py`

 * *Files identical despite different names*

### Comparing `sympy_plot_backends-3.2.0/spb/backends/matplotlib/renderers/line2d.py` & `sympy_plot_backends-3.3.0/spb/backends/matplotlib/renderers/line2d.py`

 * *Files identical despite different names*

### Comparing `sympy_plot_backends-3.2.0/spb/backends/matplotlib/renderers/line3d.py` & `sympy_plot_backends-3.3.0/spb/backends/matplotlib/renderers/line3d.py`

 * *Files identical despite different names*

### Comparing `sympy_plot_backends-3.2.0/spb/backends/matplotlib/renderers/mcircles.py` & `sympy_plot_backends-3.3.0/spb/backends/matplotlib/renderers/mcircles.py`

 * *Files identical despite different names*

### Comparing `sympy_plot_backends-3.2.0/spb/backends/matplotlib/renderers/ngrid.py` & `sympy_plot_backends-3.3.0/spb/backends/matplotlib/renderers/ngrid.py`

 * *Files identical despite different names*

### Comparing `sympy_plot_backends-3.2.0/spb/backends/matplotlib/renderers/nichols.py` & `sympy_plot_backends-3.3.0/spb/backends/matplotlib/renderers/nichols.py`

 * *Files identical despite different names*

### Comparing `sympy_plot_backends-3.2.0/spb/backends/matplotlib/renderers/nyquist.py` & `sympy_plot_backends-3.3.0/spb/backends/matplotlib/renderers/nyquist.py`

 * *Files identical despite different names*

### Comparing `sympy_plot_backends-3.2.0/spb/backends/matplotlib/renderers/polezero.py` & `sympy_plot_backends-3.3.0/spb/backends/matplotlib/renderers/polezero.py`

 * *Files identical despite different names*

### Comparing `sympy_plot_backends-3.2.0/spb/backends/matplotlib/renderers/renderer.py` & `sympy_plot_backends-3.3.0/spb/backends/matplotlib/renderers/renderer.py`

 * *Files identical despite different names*

### Comparing `sympy_plot_backends-3.2.0/spb/backends/matplotlib/renderers/root_locus.py` & `sympy_plot_backends-3.3.0/spb/backends/matplotlib/renderers/root_locus.py`

 * *Files identical despite different names*

### Comparing `sympy_plot_backends-3.2.0/spb/backends/matplotlib/renderers/sgrid.py` & `sympy_plot_backends-3.3.0/spb/backends/matplotlib/renderers/sgrid.py`

 * *Files 2% similar despite different names*

```diff
@@ -21,14 +21,18 @@
     xtext_pos_lim = xlim[0] + (xlim[1] - xlim[0]) * 0.0 if xlim else -1
     ytext_pos_lim = ylim[1] - (ylim[1] - ylim[0]) * 0.03 if ylim else 1
     return xlim, ylim, xtext_pos_lim, ytext_pos_lim
 
 
 def _draw_sgrid_helper(renderer, data):
     p, s = renderer.plot, renderer.series
+
+    if s.auto:
+        return []
+
     np = p.np
     xi_dict, wn_dict, y_tp, x_ts = data
 
     lkw = p.sgrid_line_kw
     kw = p.merge({}, lkw, s.rendering_kw)
 
     xlim, ylim, xtext_pos_lim, ytext_pos_lim = _text_position_limits(
@@ -77,14 +81,18 @@
         ts_handles.append(h)
 
     return [xi_handles, wn_handles, tp_handles, ts_handles]
 
 
 def _update_sgrid_helper(renderer, data, handles):
     p, s = renderer.plot, renderer.series
+
+    if s.auto:
+        return
+
     np = p.np
     xi_dict, wn_dict, y_tp, x_ts = data
     xi_handles, wn_handles, tp_handles, ts_handles = handles
 
     xlim, ylim, xtext_pos_lim, ytext_pos_lim = _text_position_limits(
         renderer, p, s)
```

### Comparing `sympy_plot_backends-3.2.0/spb/backends/matplotlib/renderers/surface.py` & `sympy_plot_backends-3.3.0/spb/backends/matplotlib/renderers/surface.py`

 * *Files identical despite different names*

### Comparing `sympy_plot_backends-3.2.0/spb/backends/matplotlib/renderers/vector2d.py` & `sympy_plot_backends-3.3.0/spb/backends/matplotlib/renderers/vector2d.py`

 * *Files identical despite different names*

### Comparing `sympy_plot_backends-3.2.0/spb/backends/matplotlib/renderers/vector3d.py` & `sympy_plot_backends-3.3.0/spb/backends/matplotlib/renderers/vector3d.py`

 * *Files identical despite different names*

### Comparing `sympy_plot_backends-3.2.0/spb/backends/matplotlib/renderers/zgrid.py` & `sympy_plot_backends-3.3.0/spb/backends/matplotlib/renderers/zgrid.py`

 * *Files identical despite different names*

### Comparing `sympy_plot_backends-3.2.0/spb/backends/mayavi/mayavi.py` & `sympy_plot_backends-3.3.0/spb/backends/mayavi/mayavi.py`

 * *Files identical despite different names*

### Comparing `sympy_plot_backends-3.2.0/spb/backends/mayavi/renderers/implicit3d.py` & `sympy_plot_backends-3.3.0/spb/backends/mayavi/renderers/implicit3d.py`

 * *Files identical despite different names*

### Comparing `sympy_plot_backends-3.2.0/spb/backends/mayavi/renderers/line3d.py` & `sympy_plot_backends-3.3.0/spb/backends/mayavi/renderers/line3d.py`

 * *Files identical despite different names*

### Comparing `sympy_plot_backends-3.2.0/spb/backends/mayavi/renderers/surface.py` & `sympy_plot_backends-3.3.0/spb/backends/mayavi/renderers/surface.py`

 * *Files identical despite different names*

### Comparing `sympy_plot_backends-3.2.0/spb/backends/mayavi/renderers/vector3d.py` & `sympy_plot_backends-3.3.0/spb/backends/mayavi/renderers/vector3d.py`

 * *Files identical despite different names*

### Comparing `sympy_plot_backends-3.2.0/spb/backends/plotly/plotly.py` & `sympy_plot_backends-3.3.0/spb/backends/plotly/plotly.py`

 * *Files identical despite different names*

### Comparing `sympy_plot_backends-3.2.0/spb/backends/plotly/renderers/__init__.py` & `sympy_plot_backends-3.3.0/spb/backends/plotly/renderers/__init__.py`

 * *Files identical despite different names*

### Comparing `sympy_plot_backends-3.2.0/spb/backends/plotly/renderers/arrow2d.py` & `sympy_plot_backends-3.3.0/spb/backends/plotly/renderers/arrow2d.py`

 * *Files identical despite different names*

### Comparing `sympy_plot_backends-3.2.0/spb/backends/plotly/renderers/complex.py` & `sympy_plot_backends-3.3.0/spb/backends/plotly/renderers/complex.py`

 * *Files identical despite different names*

### Comparing `sympy_plot_backends-3.2.0/spb/backends/plotly/renderers/contour.py` & `sympy_plot_backends-3.3.0/spb/backends/plotly/renderers/contour.py`

 * *Files identical despite different names*

### Comparing `sympy_plot_backends-3.2.0/spb/backends/plotly/renderers/generic.py` & `sympy_plot_backends-3.3.0/spb/backends/plotly/renderers/generic.py`

 * *Files identical despite different names*

### Comparing `sympy_plot_backends-3.2.0/spb/backends/plotly/renderers/geometry.py` & `sympy_plot_backends-3.3.0/spb/backends/plotly/renderers/geometry.py`

 * *Files identical despite different names*

### Comparing `sympy_plot_backends-3.2.0/spb/backends/plotly/renderers/hvline.py` & `sympy_plot_backends-3.3.0/spb/backends/plotly/renderers/hvline.py`

 * *Files identical despite different names*

### Comparing `sympy_plot_backends-3.2.0/spb/backends/plotly/renderers/implicit3d.py` & `sympy_plot_backends-3.3.0/spb/backends/plotly/renderers/implicit3d.py`

 * *Files identical despite different names*

### Comparing `sympy_plot_backends-3.2.0/spb/backends/plotly/renderers/line2d.py` & `sympy_plot_backends-3.3.0/spb/backends/plotly/renderers/line2d.py`

 * *Files identical despite different names*

### Comparing `sympy_plot_backends-3.2.0/spb/backends/plotly/renderers/line3d.py` & `sympy_plot_backends-3.3.0/spb/backends/plotly/renderers/line3d.py`

 * *Files identical despite different names*

### Comparing `sympy_plot_backends-3.2.0/spb/backends/plotly/renderers/surface.py` & `sympy_plot_backends-3.3.0/spb/backends/plotly/renderers/surface.py`

 * *Files identical despite different names*

### Comparing `sympy_plot_backends-3.2.0/spb/backends/plotly/renderers/vector2d.py` & `sympy_plot_backends-3.3.0/spb/backends/plotly/renderers/vector2d.py`

 * *Files identical despite different names*

### Comparing `sympy_plot_backends-3.2.0/spb/backends/plotly/renderers/vector3d.py` & `sympy_plot_backends-3.3.0/spb/backends/plotly/renderers/vector3d.py`

 * *Files identical despite different names*

### Comparing `sympy_plot_backends-3.2.0/spb/backends/utils.py` & `sympy_plot_backends-3.3.0/spb/backends/utils.py`

 * *Files identical despite different names*

### Comparing `sympy_plot_backends-3.2.0/spb/ccomplex/complex.py` & `sympy_plot_backends-3.3.0/spb/ccomplex/complex.py`

 * *Files identical despite different names*

### Comparing `sympy_plot_backends-3.2.0/spb/control.py` & `sympy_plot_backends-3.3.0/spb/control.py`

 * *Files identical despite different names*

### Comparing `sympy_plot_backends-3.2.0/spb/defaults.py` & `sympy_plot_backends-3.3.0/spb/defaults.py`

 * *Files 0% similar despite different names*

```diff
@@ -29,15 +29,15 @@
             "update_event": False,
         },
         bokeh={
             # More themes at:
             # https://docs.bokeh.org/en/latest/docs/reference/themes.html
             "theme": "caliber",
             # How will the plot resizes to fill the available space.
-            "sizing_mode": "stretch_width",
+            "sizing_mode": "fixed",
             # the default size of the plot when sizing_mode=fixed
             "width": 600,
             "height": 400,
             # Show/hide main grid
             "grid": True,
             # Show/hide minor grid
             "show_minor_grid": True,
```

### Comparing `sympy_plot_backends-3.2.0/spb/doc_utils.py` & `sympy_plot_backends-3.3.0/spb/doc_utils.py`

 * *Files 0% similar despite different names*

```diff
@@ -195,15 +195,15 @@
                     node.value.keywords.append(
                         ast.keyword(
                             arg='imodule', value=ast.Constant(value="panel")))
 
         tree.body[-1] = ast.Assign(
             targets=[ast.Name(id="panelplot")],
             value=ln.value.func.value, lineno=ln.lineno)
-        last_command = ast.parse("panelplot.layout_controls()")
+        last_command = ast.parse("panelplot.layout_controls")
         tree.body.append(last_command.body[-1])
 
     elif (
         isinstance(ln, ast.Expr) and isinstance(ln.value, ast.Call) and
         isinstance(ln.value.func, ast.Name)
     ):
         # ordinary example: plot_something(expr, range, params={}, ...)
@@ -258,15 +258,15 @@
                     )
                 )
             tree.body[-1] = ast.Assign(
                 targets=[ast.Name(id="panelplot")],
                 value=ln.value, lineno=ln.lineno)
 
             if is_KB:
-                last_command = ast.parse("panelplot.layout_controls()")
+                last_command = ast.parse("panelplot.layout_controls")
             else:
                 last_command = ast.parse(
                     "panelplot._create_template(show=False)")
 
             tree.body.append(last_command.body[-1])
     return ast.unparse(tree)
```

### Comparing `sympy_plot_backends-3.2.0/spb/functions.py` & `sympy_plot_backends-3.3.0/spb/functions.py`

 * *Files identical despite different names*

### Comparing `sympy_plot_backends-3.2.0/spb/graphics/__init__.py` & `sympy_plot_backends-3.3.0/spb/graphics/__init__.py`

 * *Files identical despite different names*

### Comparing `sympy_plot_backends-3.2.0/spb/graphics/complex_analysis.py` & `sympy_plot_backends-3.3.0/spb/graphics/complex_analysis.py`

 * *Files identical despite different names*

### Comparing `sympy_plot_backends-3.2.0/spb/graphics/control.py` & `sympy_plot_backends-3.3.0/spb/graphics/control.py`

 * *Files 4% similar despite different names*

```diff
@@ -3,15 +3,15 @@
     PoleZeroWithSympySeries, LineOver1DRangeSeries, HVLineSeries,
     NyquistLineSeries,
     NicholsLineSeries, RootLocusSeries, SGridLineSeries, ZGridLineSeries,
     SystemResponseSeries, PoleZeroSeries, NGridLineSeries, MCirclesSeries
 )
 from spb.utils import (
     prange, is_number, tf_to_sympy, tf_to_control, _get_initial_params,
-    is_discrete_time, tf_find_time_delay
+    is_discrete_time, tf_find_time_delay, is_siso
 )
 import numpy as np
 from sympy import (
     roots, exp, Poly, degree, re, im, apart, Dummy, symbols,
     I, log, Abs, arg, sympify, S, Min, Max, Piecewise, sqrt, cos, acos, sin,
     floor, ceiling, frac, pi, fraction, Expr, Tuple, inverse_laplace_transform,
     Integer, Float
@@ -103,69 +103,72 @@
         allowed_types.append(ct.TransferFunction)
     if sp is not None:
         allowed_types.append(sp.signal.TransferFunction)
 
     if isinstance(system, tuple(allowed_types)):
         return system
 
-    if isinstance(system, (list, tuple)):
-        if len(system) == 2:
-            if all(isinstance(e, Expr) for e in system):
-                num, den = system
-                fs = Tuple(num, den).free_symbols.pop()
-                return sm.control.lti.TransferFunction(num, den, fs)
-            else:
-                num, den = system
-                num = [float(t) for t in num]
-                den = [float(t) for t in den]
-                return ct.tf(num, den)
-        elif len(system) == 3:
-            num, den, fs = system
-            return sm.control.lti.TransferFunction(num, den, fs)
-        else:
-            raise ValueError(
-                "If a tuple/list is provided, it must have "
-                "two or three elements: (num, den, free_symbol [opt]). "
-                f"Received len(system) = {len(system)}"
-            )
-
-    if isinstance(system, Expr):
-        params = kwargs.get("params", dict())
-        fs = system.free_symbols.difference(params.keys())
-        if len(fs) > 1:
-            raise ValueError(f"Too many free symbols: {fs}")
-        elif len(fs) == 0:
-            raise ValueError(
-                "An expression with one free symbol is required.")
-        return sm.control.lti.TransferFunction.from_rational_expression(system, fs.pop())
-
-    raise TypeError(f"type(system) = {type(system)} not recognized.")
-
+    # if isinstance(system, (
+    #     ct.TransferFunction,
+    #     sp.signal.TransferFunction,
+    #     sm.control.lti.TransferFunction,
+    #     sm.control.lti.TransferFunctionMatrix
+    # )):
+    #     return system
+
+    params = kwargs.get("params", {})
+    system = tf_to_sympy(system, params=params)
+    # fs = system.free_symbols
+    # if len(fs) > 1:
+    #     raise ValueError(f"Too many free symbols: {fs}")
+    # elif len(fs) == 0:
+    #     raise ValueError(
+    #         "An expression with one free symbol is required.")
+
+    return system
+
+    # if isinstance(system, (list, tuple)):
+    #     if len(system) == 2:
+    #         if all(isinstance(e, Expr) for e in system):
+    #             num, den = system
+    #             fs = Tuple(num, den).free_symbols.pop()
+    #             return sm.control.lti.TransferFunction(num, den, fs)
+    #         else:
+    #             num, den = system
+    #             num = [float(t) for t in num]
+    #             den = [float(t) for t in den]
+    #             return ct.tf(num, den)
+    #     elif len(system) == 3:
+    #         num, den, fs = system
+    #         return sm.control.lti.TransferFunction(num, den, fs)
+    #     else:
+    #         raise ValueError(
+    #             "If a tuple/list is provided, it must have "
+    #             "two or three elements: (num, den, free_symbol [opt]). "
+    #             f"Received len(system) = {len(system)}"
+    #         )
+
+    # if isinstance(system, Expr):
+    #     params = kwargs.get("params", dict())
+    #     fs = system.free_symbols.difference(params.keys())
+    #     if len(fs) > 1:
+    #         raise ValueError(f"Too many free symbols: {fs}")
+    #     elif len(fs) == 0:
+    #         raise ValueError(
+    #             "An expression with one free symbol is required.")
+    #     return sm.control.lti.TransferFunction.from_rational_expression(system, fs.pop())
 
-def _is_siso(system):
-    ct = import_module("control")
-    sp = import_module("scipy")
-    sm = import_module("sympy.physics", import_kwargs={'fromlist':['control']})
-    if isinstance(system, sm.control.lti.SISOLinearTimeInvariant):
-        return True
-    if isinstance(system, sp.signal.TransferFunction):
-        return True
-    if (
-        isinstance(system, ct.TransferFunction) and
-        (system.ninputs == 1) and (system.noutputs == 1)
-    ):
-        return True
-    return False
+    # raise TypeError(f"type(system) = {type(system)} not recognized.")
 
 
 def _check_system(system, bypass_delay_check=False):
     """Function to check whether the dynamical system passed for plots is
     compatible or not."""
 
-    if not _is_siso(system):
+    if not is_siso(system):
         raise NotImplementedError(
             "Only SISO LTI systems are currently supported.")
 
     sm = import_module("sympy.physics", import_kwargs={'fromlist':['control']})
 
     if isinstance(system, sm.control.lti.TransferFunction):
         sys = system.to_expr()
@@ -194,28 +197,28 @@
             return True
         return False
 
     if isinstance(system, sm.control.lti.TransferFunctionMatrix):
         for i in range(system.num_inputs):
             for o in range(system.num_outputs):
                 if _check_condition(i, o):
-                    lbl = label + pre + f"inp{i} -> out{o}"
+                    lbl = label + pre + f"u[{i}] to y[{o}]"
                     systems.append([system[o, i], lbl])
         return systems
 
     elif (ct is not None) and isinstance(system, ct.TransferFunction):
         if (system.ninputs == 1) and (system.noutputs == 1):
             return [[system, label]]
         systems = []
         for i in range(system.ninputs):
             for o in range(system.noutputs):
                 if _check_condition(i, o):
                     n = system.num[o][i]
                     d = system.den[o][i]
-                    lbl = label + pre + f"inp{i} -> out{o}"
+                    lbl = label + pre + f"u[{i}] to y[{o}]"
                     systems.append([ct.tf(n, d, dt=system.dt), lbl])
         return systems
 
     return [[system, label]]
 
 
 def _get_zeros_poles_from_symbolic_tf(system):
@@ -273,15 +276,15 @@
     if not isinstance(system, sm.control.lti.TransferFunction):
         system = tf_to_sympy(system)
 
     zeros, poles = _get_zeros_poles_from_symbolic_tf(system)
     zeros_re, zeros_im = [re(z) for z in zeros], [im(z) for z in zeros]
     poles_re, poles_im = [re(p) for p in poles], [im(p) for p in poles]
 
-    prk, zrk, p_label, z_label = _pole_zero_common_keyword_arguments(**kwargs)
+    prk, zrk, p_label, z_label = _pole_zero_common_keyword_arguments(kwargs)
     z_series = PoleZeroWithSympySeries(
         zeros_re, zeros_im, z_label, return_poles=False,
         scatter=True, is_filled=True, rendering_kw=zrk,
         zero_markersize=zero_markersize, **kwargs
     )
     p_series = PoleZeroWithSympySeries(
         poles_re, poles_im, p_label, return_poles=True,
@@ -291,25 +294,25 @@
     return [p_series, z_series]
 
 
 def _pole_zero_with_control_helper(
     system, pole_markersize, zero_markersize,
     **kwargs
 ):
-    prk, zrk, p_label, z_label = _pole_zero_common_keyword_arguments(**kwargs)
+    prk, zrk, p_label, z_label = _pole_zero_common_keyword_arguments(kwargs)
     return [
         PoleZeroSeries(system, p_label, return_poles=True,
             rendering_kw=prk, pole_markersize=pole_markersize, **kwargs),
         PoleZeroSeries(system, z_label, return_poles=False,
             rendering_kw=zrk, zero_markersize=zero_markersize, **kwargs),
     ]
 
 
-def _pole_zero_common_keyword_arguments(**kwargs):
-    label = kwargs.get("label", None)
+def _pole_zero_common_keyword_arguments(kwargs):
+    label = kwargs.pop("label", None)
     z_rendering_kw = kwargs.pop("z_rendering_kw", {})
     p_rendering_kw = kwargs.pop("p_rendering_kw", {})
     get_label = lambda t: t + " of " + label if label else t
     z_label = get_label("zeros")
     p_label = get_label("poles")
     return p_rendering_kw, z_rendering_kw, p_label, z_label
 
@@ -480,15 +483,15 @@
     series = []
     for s, l in systems:
         kw = kwargs.copy()
         kw["label"] = l
         s = _preprocess_system(s, **kw)
         _check_system(s)
         series.extend(
-            func(s, pole_markersize, zero_markersize, **kwargs.copy())
+            func(s, pole_markersize, zero_markersize, **kw)
         )
 
     grid = _get_grid_series(sgrid, zgrid)
     return grid + series
 
 
 def _get_grid_series(sgrid, zgrid):
@@ -513,14 +516,35 @@
     try:
         y = _fast_inverse_laplace(expr, s, t)
     except NotImplementedError:
         y = inverse_laplace_transform(expr, s, t)
     return y
 
 
+def _set_lower_upper_limits(system, lower_limit, upper_limit,
+    is_step=True, **kwargs
+):
+    """If user didn't set lower/upper time limits, compute the appropriate
+    values.
+    """
+    if not lower_limit:
+        lower_limit = 0
+    if not upper_limit:
+        tfinal = None
+        ct = import_module("control")
+        if ct and (not kwargs.get("params", None)):
+            # this procedure requires the control module
+            control_sys = tf_to_control(system)
+            tfinal, _ = _ideal_tfinal_and_dt(control_sys, is_step=is_step)
+        # if interactive widget plot, or control is not installed, use
+        # default value of 10
+        upper_limit = tfinal if tfinal else 10
+    return lower_limit, upper_limit
+
+
 def _step_response_helper(
     system, label, lower_limit, upper_limit, prec, **kwargs
 ):
     sm = import_module("sympy.physics", import_kwargs={'fromlist':['control']})
     system = _preprocess_system(system, **kwargs)
     _check_system(system)
 
@@ -575,15 +599,15 @@
             "module, but you also set ``lower_limit != 0``. This is likely "
             "going to produce incorrect results. Please, consider "
             "setting ``control=False`` when using ``lower_limit != 0``."
         )
 
 
 def step_response(
-    system, lower_limit=0, upper_limit=10, prec=8,
+    system, lower_limit=None, upper_limit=None, prec=8,
     label=None, rendering_kw=None, control=True,
     input=None, output=None, **kwargs
 ):
     """
     Returns the unit step response of a continuous-time system. It is
     the response of the system when the input signal is a step function.
 
@@ -600,20 +624,22 @@
         * an instance of :py:class:`scipy.signal.TransferFunction`
         * a symbolic expression in rational form, which will be converted to
           an object of type
           :py:class:`sympy.physics.control.lti.TransferFunction`.
         * a tuple of two or three elements: ``(num, den, generator [opt])``,
           which will be converted to an object of type
           :py:class:`sympy.physics.control.lti.TransferFunction`.
-    lower_limit : Number, optional
-        The lower limit of the plot range. Defaults to 0. If a different value
-        is to be used, also set ``control=False`` (see examples in order to
-        understand why).
-    upper_limit : Number, optional
-        The upper limit of the plot range. Defaults to 10.
+    lower_limit : Number or None, optional
+        The lower time limit of the plot range. Defaults to 0. If a different
+        value  is to be used, also set ``control=False`` (see examples in
+        order to understand why).
+    upper_limit : Number or None, optional
+        The upper time limit of the plot range. If not provided, an
+        appropriate value will be computed. If a interactive widget plot is
+        being created, it defaults to 10.
     prec : int, optional
         The decimal point precision for the point coordinate values.
         Defaults to 8.
     label : str, optional
         The label to be shown on the legend.
     rendering_kw : dict, optional
         A dictionary of keywords/values which is passed to the backend's
@@ -659,16 +685,16 @@
         from sympy.abc import s, t
         from sympy import Heaviside
         from sympy.physics.control.lti import TransferFunction
         from spb import *
         tf1 = TransferFunction(
             8*s**2 + 18*s + 32, s**3 + 6*s**2 + 14*s + 24, s)
         graphics(
-            line(Heaviside(t), (t, -1, 10), label="step"),
-            step_response(tf1, label="response"),
+            line(Heaviside(t), (t, -1, 8), label="step"),
+            step_response(tf1, label="response", upper_limit=8),
             xlabel="Time [s]", ylabel="Amplitude"
         )
 
     Plotting a MIMO system:
 
     .. plot::
         :context: close-figs
@@ -749,15 +775,18 @@
 
     References
     ==========
 
     .. [1] https://www.mathworks.com/help/control/ref/lti.step.html
 
     """
+
     control = _check_if_control_is_installed(use_control=control)
+    lower_limit, upper_limit = _set_lower_upper_limits(
+        system, lower_limit, upper_limit, is_step=True, **kwargs)
     _check_lower_limit_and_control(lower_limit, control)
     systems = _unpack_mimo_systems(
         system,
         "" if label is None else label,
         input, output
     )
 
@@ -809,15 +838,15 @@
     return SystemResponseSeries(
         expr, prange(_x, lower_limit, upper_limit),
         label, force_real_eval=True, response_type="impulse", **kwargs
     )
 
 
 def impulse_response(
-    system, prec=8, lower_limit=0, upper_limit=10,
+    system, prec=8, lower_limit=None, upper_limit=None,
     label=None, rendering_kw=None, control=True,
     input=None, output=None, **kwargs
 ):
     """
     Returns the unit impulse response (Input is the Dirac-Delta Function) of a
     continuous-time system
 
@@ -834,20 +863,22 @@
         * an instance of :py:class:`scipy.signal.TransferFunction`
         * a symbolic expression in rational form, which will be converted to
           an object of type
           :py:class:`sympy.physics.control.lti.TransferFunction`.
         * a tuple of two or three elements: ``(num, den, generator [opt])``,
           which will be converted to an object of type
           :py:class:`sympy.physics.control.lti.TransferFunction`.
-    lower_limit : Number, optional
-        The lower limit of the plot range. Defaults to 0. If a different value
-        is to be used, also set ``control=False`` (see examples in order to
-        understand why).
-    upper_limit : Number, optional
-        The upper limit of the plot range. Defaults to 10.
+    lower_limit : Number or None, optional
+        The lower time limit of the plot range. Defaults to 0. If a different
+        value  is to be used, also set ``control=False`` (see examples in
+        order to understand why).
+    upper_limit : Number or None, optional
+        The upper time limit of the plot range. If not provided, an
+        appropriate value will be computed. If a interactive widget plot is
+        being created, it defaults to 10.
     prec : int, optional
         The decimal point precision for the point coordinate values.
         Defaults to 8.
     label : str, optional
         The label to be shown on the legend.
     rendering_kw : dict, optional
         A dictionary of keywords/values which is passed to the backend's
@@ -982,14 +1013,16 @@
     References
     ==========
 
     .. [1] https://www.mathworks.com/help/control/ref/lti.impulse.html
 
     """
     control = _check_if_control_is_installed(use_control=control)
+    lower_limit, upper_limit = _set_lower_upper_limits(
+        system, lower_limit, upper_limit, is_step=False, **kwargs)
     _check_lower_limit_and_control(lower_limit, control)
     systems = _unpack_mimo_systems(
         system,
         "" if label is None else label,
         input, output
     )
 
@@ -1051,15 +1084,15 @@
     return SystemResponseSeries(
         expr, prange(_x, lower_limit, upper_limit),
         label, force_real_eval=True, response_type="ramp", **kwargs
     )
 
 
 def ramp_response(
-    system, prec=8, slope=1, lower_limit=0, upper_limit=10,
+    system, prec=8, slope=1, lower_limit=None, upper_limit=None,
     label=None, rendering_kw=None, control=True,
     input=None, output=None, **kwargs
 ):
     """
     Returns the ramp response of a continuous-time system.
 
     Ramp function is defined as the straight line passing through origin
@@ -1084,20 +1117,22 @@
           which will be converted to an object of type
           :py:class:`sympy.physics.control.lti.TransferFunction`.
     prec : int, optional
         The decimal point precision for the point coordinate values.
         Defaults to 8.
     slope : Number, optional
         The slope of the input ramp function. Defaults to 1.
-    lower_limit : Number, optional
-        The lower limit of the plot range. Defaults to 0. If a different value
-        is to be used, also set ``control=False`` (see examples in order to
-        understand why).
-    upper_limit : Number, optional
-        The upper limit of the plot range. Defaults to 10.
+    lower_limit : Number or None, optional
+        The lower time limit of the plot range. Defaults to 0. If a different
+        value  is to be used, also set ``control=False`` (see examples in
+        order to understand why).
+    upper_limit : Number or None, optional
+        The upper time limit of the plot range. If not provided, an
+        appropriate value will be computed. If a interactive widget plot is
+        being created, it defaults to 10.
     label : str, optional
         The label to be shown on the legend.
     rendering_kw : dict, optional
         A dictionary of keywords/values which is passed to the backend's
         function to customize the appearance of lines. Refer to the
         plotting library (backend) manual for more informations.
     control : bool, optional
@@ -1213,29 +1248,31 @@
            line(a*t, (t, 0, c), params=params, label="ramp"),
            ramp_response(
                tf1, label="A", slope=a, lower_limit=b, upper_limit=c,
                params=params, control=False),
            ramp_response(
                tf2, label="B", slope=a, lower_limit=b, upper_limit=c,
                params=params, control=True),
-           xlabel="Time [s]", ylabel="Amplitude", imodule="panel")
+           xlabel="Time [s]", ylabel="Amplitude")
 
     See Also
     ========
 
     plot_step_response, plot_impulse_response
 
     References
     ==========
 
     .. [1] https://en.wikipedia.org/wiki/Ramp_function
 
     """
     sm = import_module("sympy.physics", import_kwargs={'fromlist':['control']})
     control = _check_if_control_is_installed(use_control=control)
+    lower_limit, upper_limit = _set_lower_upper_limits(
+        system, lower_limit, upper_limit, is_step=False, **kwargs)
     _check_lower_limit_and_control(lower_limit, control)
     systems = _unpack_mimo_systems(
         system,
         "" if label is None else label,
         input, output
     )
 
@@ -1770,15 +1807,15 @@
         Limits to the range of frequencies.
     start_marker : str or dict, optional
         Marker to use to mark the starting point of the Nyquist plot. If
         `dict` is provided, it must containts keyword arguments to be passed
         to the plot function, for example to Matplotlib's `plt.plot`.
     control_kw : dict, optional
         A dictionary of keyword arguments passed to
-        :py:func:`control.nyquist_plot`
+        :py:func:`control.nyquist_response`
 
     Returns
     =======
 
     A list containing:
 
     * one instance of ``MCirclesSeries`` if ``mcircles=True``.
@@ -1838,15 +1875,15 @@
 
     .. plot::
        :context: close-figs
        :include-source: True
 
        graphics(
            nyquist(tf1, m_circles=True),
-           xlabel="Real", ylabel="Imaginary"
+           grid=False, xlabel="Real", ylabel="Imaginary"
        )
 
     Interactive-widgets plot of a systems:
 
     .. panel-screenshot::
        :small-size: 800, 650
 
@@ -2110,15 +2147,15 @@
         The label to be shown on the legend.
     rendering_kw : dict, optional
         A dictionary of keywords/values which is passed to the backend's
         function to customize the appearance of lines. Refer to the
         plotting library (backend) manual for more informations.
     control_kw : dict
         A dictionary of keyword arguments to be passed to
-        :py:func:`control.root_locus`.
+        :py:func:`control.root_locus_map`.
     sgrid : bool, optional
         Generates a grid of constant damping ratios and natural frequencies
         on the s-plane. Default to True.
     zgrid : bool, optional
         Generates a grid of constant damping ratios and natural frequencies
         on the z-plane. Default to False. If ``zgrid=True``, then it will
         automatically sets ``sgrid=False``.
@@ -2277,19 +2314,16 @@
 
     Auto-generate grid lines over a specified area of of the s-plane:
 
     .. plot::
        :context: close-figs
        :include-source: True
 
-       xlim = (-5.5, 1)
-       ylim = (-3, 3)
        graphics(
-           sgrid(auto=True),
-           grid=False, xlim=xlim, ylim=ylim
+           sgrid(auto=True)
        )
 
     Interactive-widgets plot of custom s-grid lines:
 
     .. panel-screenshot::
        :small-size: 800, 750
 
@@ -2782,7 +2816,187 @@
         lsp_max += np.log10(2. * np.pi)
 
     if freq_interesting:
         lsp_min = min(lsp_min, np.log10(min(freq_interesting)))
         lsp_max = max(lsp_max, np.log10(max(freq_interesting)))
 
     return lsp_min, lsp_max
+
+
+# utility function to find time period and time increment using pole locations
+# from control.timeresp 0.10.0
+def _ideal_tfinal_and_dt(sys, is_step=True):
+    """helper function to compute ideal simulation duration tfinal and dt, the
+    time increment. Usually called by _default_time_vector, whose job it is to
+    choose a realistic time vector. Considers both poles and zeros.
+
+    For discrete-time models, dt is inherent and only tfinal is computed.
+
+    Parameters
+    ----------
+    sys : StateSpace or TransferFunction
+        The system whose time response is to be computed
+    is_step : bool
+        Scales the dc value by the magnitude of the nonzero mode since
+        integrating the impulse response gives
+        :math:`\\int e^{-\\lambda t} = -e^{-\\lambda t}/ \\lambda`
+        Default is True.
+
+    Returns
+    -------
+    tfinal : float
+        The final time instance for which the simulation will be performed.
+    dt : float
+        The estimated sampling period for the simulation.
+
+    Notes
+    -----
+    Just by evaluating the fastest mode for dt and slowest for tfinal often
+    leads to unnecessary, bloated sampling (e.g., Transfer(1,[1,1001,1000]))
+    since dt will be very small and tfinal will be too large though the fast
+    mode hardly ever contributes. Similarly, change the numerator to [1, 2, 0]
+    and the simulation would be unnecessarily long and the plot is virtually
+    an L shape since the decay is so fast.
+
+    Instead, a modal decomposition in time domain hence a truncated ZIR and ZSR
+    can be used such that only the modes that have significant effect on the
+    time response are taken. But the sensitivity of the eigenvalues complicate
+    the matter since dlambda = <w, dA*v> with <w,v> = 1. Hence we can only work
+    with simple poles with this formulation. See Golub, Van Loan Section 7.2.2
+    for simple eigenvalue sensitivity about the nonunity of <w,v>. The size of
+    the response is dependent on the size of the eigenshapes rather than the
+    eigenvalues themselves.
+
+    By Ilhan Polat, with modifications by Sawyer Fuller to integrate into
+    python-control 2020.08.17
+
+    """
+    control = import_module("control")
+    sp = import_module("scipy")
+    np = import_module("numpy")
+
+    if not control:
+        return None, None
+
+    _convert_to_statespace = control.statesp._convert_to_statespace
+    isdtime = control.iosys.isdtime
+    matrix_balance = sp.linalg.matrix_balance
+    eig = sp.linalg.eig
+    norm = sp.linalg.norm
+
+    sqrt_eps = np.sqrt(np.spacing(1.))
+    default_tfinal = 5                  # Default simulation horizon
+    default_dt = 0.1
+    total_cycles = 5                    # Number cycles for oscillating modes
+    pts_per_cycle = 25                  # Number points divide period of osc
+    log_decay_percent = np.log(1000)    # Reduction factor for real pole decays
+
+    if sys._isstatic():
+        tfinal = default_tfinal
+        dt = sys.dt if isdtime(sys, strict=True) else default_dt
+    elif isdtime(sys, strict=True):
+        dt = sys.dt
+        A = _convert_to_statespace(sys).A
+        tfinal = default_tfinal
+        p = sp.linalg.eigvals(A)
+        # Array Masks
+        # unstable
+        m_u = (np.abs(p) >= 1 + sqrt_eps)
+        p_u, p = p[m_u], p[~m_u]
+        if p_u.size > 0:
+            m_u = (p_u.real < 0) & (np.abs(p_u.imag) < sqrt_eps)
+            if np.any(~m_u):
+                t_emp = np.max(
+                    log_decay_percent / np.abs(np.log(p_u[~m_u]) / dt))
+                tfinal = max(tfinal, t_emp)
+
+        # zero - negligible effect on tfinal
+        m_z = np.abs(p) < sqrt_eps
+        p = p[~m_z]
+        # Negative reals- treated as oscillary mode
+        m_nr = (p.real < 0) & (np.abs(p.imag) < sqrt_eps)
+        p_nr, p = p[m_nr], p[~m_nr]
+        if p_nr.size > 0:
+            t_emp = np.max(log_decay_percent / np.abs((np.log(p_nr)/dt).real))
+            tfinal = max(tfinal, t_emp)
+        # discrete integrators
+        m_int = (p.real - 1 < sqrt_eps) & (np.abs(p.imag) < sqrt_eps)
+        p_int, p = p[m_int], p[~m_int]
+        # pure oscillatory modes
+        m_w = (np.abs(np.abs(p) - 1) < sqrt_eps)
+        p_w, p = p[m_w], p[~m_w]
+        if p_w.size > 0:
+            t_emp = total_cycles * 2 * np.pi / np.abs(np.log(p_w)/dt).min()
+            tfinal = max(tfinal, t_emp)
+
+        if p.size > 0:
+            t_emp = log_decay_percent / np.abs((np.log(p)/dt).real).min()
+            tfinal = max(tfinal, t_emp)
+
+        if p_int.size > 0:
+            tfinal = tfinal * 5
+    else:       # cont time
+        sys_ss = _convert_to_statespace(sys)
+        # Improve conditioning via balancing and zeroing tiny entries
+        # See <w,v> for [[1,2,0], [9,1,0.01], [1,2,10*np.pi]]
+        #   before/after balance
+        b, (sca, perm) = matrix_balance(sys_ss.A, separate=True)
+        p, l, r = eig(b, left=True, right=True)
+        # Reciprocal of inner product <w,v> for each eigval, (bound the
+        #   ~infs by 1e12)
+        # G = Transfer([1], [1,0,1]) gives zero sensitivity (bound by 1e-12)
+        eig_sens = np.reciprocal(np.maximum(1e-12, np.einsum('ij,ij->j', l, r).real))
+        eig_sens = np.minimum(1e12, eig_sens)
+        # Tolerances
+        p[np.abs(p) < np.spacing(eig_sens * norm(b, 1))] = 0.
+        # Incorporate balancing to outer factors
+        l[perm, :] *= np.reciprocal(sca)[:, None]
+        r[perm, :] *= sca[:, None]
+        w, v = sys_ss.C @ r, l.T.conj() @ sys_ss.B
+
+        origin = False
+        # Computing the "size" of the response of each simple mode
+        wn = np.abs(p)
+        if np.any(wn == 0.):
+            origin = True
+
+        dc = np.zeros_like(p, dtype=float)
+        # well-conditioned nonzero poles, np.abs just in case
+        ok = np.abs(eig_sens) <= 1/sqrt_eps
+        # the averaged t->inf response of each simple eigval on each i/o
+        # channel. See, A = [[-1, k], [0, -2]], response sizes are
+        # k-dependent (that is R/L eigenvector dependent)
+        dc[ok] = norm(v[ok, :], axis=1)*norm(w[:, ok], axis=0)*eig_sens[ok]
+        dc[wn != 0.] /= wn[wn != 0] if is_step else 1.
+        dc[wn == 0.] = 0.
+        # double the oscillating mode magnitude for the conjugate
+        dc[p.imag != 0.] *= 2
+
+        # Now get rid of noncontributing integrators and simple modes if any
+        relevance = (dc > 0.1*dc.max()) | ~ok
+        psub = p[relevance]
+        wnsub = wn[relevance]
+
+        tfinal, dt = [], []
+        ints = wnsub == 0.
+        iw = (psub.imag != 0.) & (np.abs(psub.real) <= sqrt_eps)
+
+        # Pure imaginary?
+        if np.any(iw):
+            tfinal += (total_cycles * 2 * np.pi / wnsub[iw]).tolist()
+            dt += (2 * np.pi / pts_per_cycle / wnsub[iw]).tolist()
+        # The rest ~ts = log(%ss value) / exp(Re(eigval)t)
+        texp_mode = log_decay_percent / np.abs(psub[~iw & ~ints].real)
+        tfinal += texp_mode.tolist()
+        dt += np.minimum(
+            texp_mode / 50,
+            (2 * np.pi / pts_per_cycle / wnsub[~iw & ~ints])
+        ).tolist()
+
+        # All integrators?
+        if len(tfinal) == 0:
+            return default_tfinal*5, default_dt*5
+
+        tfinal = np.max(tfinal)*(5 if origin else 1)
+        dt = np.min(dt)
+
+    return tfinal, dt
```

### Comparing `sympy_plot_backends-3.2.0/spb/graphics/functions_2d.py` & `sympy_plot_backends-3.3.0/spb/graphics/functions_2d.py`

 * *Files 2% similar despite different names*

```diff
@@ -492,43 +492,49 @@
     This plot illustrates:
 
     * plotting multiple expressions, each one with its own label and
       rendering options.
     * the use of ``prange`` (parametric plotting range).
     * the use of the ``params`` dictionary to specify sliders in
       their basic form: (default, min, max).
+    * the use of :py:class:`panel.widgets.slider.RangeSlider`, which is a
+      2-values widget. In this case it is used to enforce the condition
+      `f1 < f2`.
     * the use of a parametric title, specified with a tuple of the form:
       ``(title_str, param_symbol1, ...)``, where:
 
       * ``title_str`` must be a formatted string, for example:
         ``"test = {:.2f}"``.
       * ``param_symbol1, ...`` must be a symbol or a symbolic expression
         whose free symbols are contained in the ``params`` dictionary.
 
     .. panel-screenshot::
        :small-size: 800, 625
 
        from sympy import *
        from spb import *
-       x, a, b, c, n = symbols("x, a, b, c, n")
+       import panel as pn
+       x, y, f1, f2, d, n = symbols("x, y, f_1, f_2, d, n")
        params = {
-           a: (1, 0, 10),     # frequency
-           b: (0, 0, 2 * pi), # phase
-           c: (0.25, 0, 1),   # damping
+           (f1, f2): pn.widgets.RangeSlider(
+               value=(1, 2), start=0, end=10, step=0.1),     # frequencies
+           d: (0.25, 0, 1),   # damping
            n: (2, 0, 4)       # multiple of pi
        }
        graphics(
-           line(cos(a * x + b) * exp(-c * x), prange(x, 0, n * pi),
-               label="oscillator", params=params),
-           line(exp(-c * x), prange(x, 0, n * pi), label="upper limit",
+           line(cos(f1 * x) * exp(-d * x), prange(x, 0, n * pi),
+               label="oscillator 1", params=params),
+           line(cos(f2 * x) * exp(-d * x), prange(x, 0, n * pi),
+               label="oscillator 2", params=params),
+           line(exp(-d * x), prange(x, 0, n * pi), label="upper limit",
                rendering_kw={"linestyle": ":"}, params=params),
-           line(-exp(-c * x), prange(x, 0, n * pi), label="lower limit",
+           line(-exp(-d * x), prange(x, 0, n * pi), label="lower limit",
                rendering_kw={"linestyle": ":"}, params=params),
            ylim=(-1.25, 1.25),
-           title=("Frequency = {:.2f} Hz", a)
+           title=("$f_1$ = {:.2f} Hz", f1)
        )
 
     See Also
     ========
 
     line_parametric_2d, line_polar, implicit_2d, list_2d, geometry,
     spb.graphics.functions_3d.line_parametric_3d
@@ -847,25 +853,25 @@
     * the use of the ``params`` dictionary to specify the widgets to be
       created by Holoviz's Panel.
 
     .. panel-screenshot::
 
        from sympy import *
        from spb import *
-       import param
+       import panel as pn
        a, b, c, d, e, f, theta, tp = symbols("a:f theta tp")
        def func(n):
            t1 = (c + sin(a * theta + d))
            t2 = ((b + sin(b * theta + e)) - (c + sin(a * theta + d)))
            t3 = (f + sin(a * theta + n / pi))
            return t1 + t2 * t3 / 2
        params = {
-           a: param.Integer(6, label="a"),
-           b: param.Integer(12, label="b"),
-           c: param.Integer(18, label="c"),
+           a: pn.widgets.IntInput(value=6, name="a"),
+           b: pn.widgets.IntInput(value=12, name="b"),
+           c: pn.widgets.IntInput(value=18, name="c"),
            d: (4.7, 0, 2*pi),
            e: (1.8, 0, 2*pi),
            f: (3, 0, 5),
            tp: (2, 0, 2)
        }
        series = []
        for n in range(20):
@@ -1038,27 +1044,36 @@
 
     Interactive-widget plot. Refer to the interactive sub-module documentation
     to learn more about the ``params`` dictionary. This plot illustrates:
 
     * the use of ``prange`` (parametric plotting range).
     * the use of the ``params`` dictionary to specify sliders in
       their basic form: (default, min, max).
+    * the use of :py:class:`panel.widgets.slider.RangeSlider`, which is a
+      2-values widget.
 
     .. panel-screenshot::
        :small-size: 800, 600
 
        from sympy import *
        from spb import *
-       x, y, a, b, xp, yp = symbols("x y a b x_p y_p")
+       import panel as pn
+       x, y, a, b = symbols("x y a b")
+       x_min, x_max, y_min, y_max = symbols("x_min x_max y_min y_max")
        expr = (cos(x) + a * sin(x) * sin(y) - b * sin(x) * cos(y))**2
        graphics(
-           contour(expr, prange(x, 0, xp*pi), prange(y, 0, yp * pi),
+           contour(
+               expr, prange(x, x_min*pi, x_max*pi), prange(y, y_min*pi, y_max*pi),
                params={
                    a: (1, 0, 2), b: (1, 0, 2),
-                   xp: (1, 0, 2), yp: (2, 0, 2)}),
+                   (x_min, x_max): pn.widgets.RangeSlider(
+                       value=(-1, 1), start=-3, end=3, step=0.1),
+                   (y_min, y_max): pn.widgets.RangeSlider(
+                       value=(-1, 1), start=-3, end=3, step=0.1),
+               }),
            grid=False
        )
 
     See Also
     ========
 
     spb.graphics.functions_3d.surface
@@ -1318,30 +1333,35 @@
     Interactive-widget implicit plot. Refer to the interactive sub-module
     documentation to learn more about the ``params`` dictionary.
     This plot illustrates:
 
     * the use of ``prange`` (parametric plotting range).
     * the use of the ``params`` dictionary to specify sliders in
       their basic form: (default, min, max).
+    * the use of :py:class:`panel.widgets.slider.RangeSlider`, which is a
+      2-values widget.
 
     .. panel-screenshot::
        :small-size: 800, 700
 
        from sympy import *
        from spb import *
-       x, y, a, b, c, d, e = symbols("x, y, a, b, c, d, e")
+       import panel as pn
+       x, y, a, b, c, d = symbols("x, y, a, b, c, d")
+       y_min, y_max = symbols("y_min, y_max")
        expr = Eq(a * x**2 - b * x + c, d * y + y**2)
        graphics(
-           implicit_2d(expr, (x, -2, 2), prange(y, -e, e),
+           implicit_2d(expr, (x, -2, 2), prange(y, y_min, y_max),
                params={
                    a: (10, -15, 15),
                    b: (7, -15, 15),
                    c: (3, -15, 15),
                    d: (2, -15, 15),
-                   e: (10, 1, 15),
+                   (y_min, y_max): pn.widgets.RangeSlider(
+                       value=(-10, 10), start=-15, end=15, step=0.1)
                }, n=150),
            ylim=(-10, 10))
 
     See Also
     ========
 
     line, spb.graphics.functions_3d.implicit_3d
@@ -1646,21 +1666,21 @@
     to learn more about the ``params`` dictionary.
 
     .. panel-screenshot::
        :small-size: 800, 625
 
        from sympy import *
        from spb import *
-       import param
+       import panel as pn
        a, b, c, d = symbols("a, b, c, d")
        params = {
            a: (0, -1, 1),
            b: (1, -1, 1),
            c: (2, 1, 2),
-           d: param.Integer(3, softbounds=(3, 8), label="n")
+           d: pn.widgets.IntInput(value=6, start=3, end=8, name="n")
        }
        graphics(
            geometry(Polygon((a, b), c, n=d), "a", params=params),
            geometry(
                Polygon((a + 2, b + 3), c, n=d + 1), "b",
                params=params, fill=False),
            aspect="equal",
```

### Comparing `sympy_plot_backends-3.2.0/spb/graphics/functions_3d.py` & `sympy_plot_backends-3.3.0/spb/graphics/functions_3d.py`

 * *Files 1% similar despite different names*

```diff
@@ -491,30 +491,36 @@
 
     Interactive-widget plot. Refer to the interactive sub-module documentation
     to learn more about the ``params`` dictionary. This plot illustrates:
 
     * the use of ``prange`` (parametric plotting range).
     * the use of the ``params`` dictionary to specify sliders in
       their basic form: (default, min, max).
+    * the use of :py:class:`panel.widgets.slider.RangeSlider`, which is a
+      2-values widget.
 
     .. panel-screenshot::
        :small-size: 800, 600
 
        from sympy import *
        from spb import *
-       x, y, a, b, d = symbols("x y a b d")
+       import panel as pn
+       x, y, a, b, c, d, e = symbols("x y a b c d e")
        graphics(
-           surface(cos(x**2 + y**2) * exp(-(x**2 + y**2) * d),
-               prange(x, -2*a, 2*a), prange(y, -2*b, 2*b),
-               use_cm=True, n=100,
+           surface(
+               cos(x**2 + y**2) * exp(-(x**2 + y**2) * a),
+               prange(x, b, c), prange(y, d, e),
                params={
-                   a: (1, 0, 3),
-                   b: (1, 0, 3),
-                   d: (0.25, 0, 1),
+                   a: (0.25, 0, 1),
+                   (b, c): pn.widgets.RangeSlider(
+                       value=(-2, 2), start=-4, end=4, step=0.1),
+                   (d, e): pn.widgets.RangeSlider(
+                       value=(-2, 2), start=-4, end=4, step=0.1),
                },
+               use_cm=True, n=100,
                wireframe=True, wf_n1=15, wf_n2=15),
            backend=PB, aspect=dict(x=1.5, y=1.5, z=0.75))
 
     See Also
     ========
 
     spb.graphics.functions_2d.contour, surface_parametric, surface_spherical,
@@ -750,23 +756,23 @@
     to learn more about the ``params`` dictionary. Note that the plot's
     creation might be slow due to the wireframe lines.
 
     .. panel-screenshot::
 
        from sympy import *
        from spb import *
-       import param
+       import panel as pn
        n, u, v = symbols("n, u, v")
        x = v * cos(u)
        y = v * sin(u)
        z = sin(n * u)
        graphics(
            surface_parametric(x, y, z, (u, 0, 2*pi), (v, -1, 0),
                params = {
-                   n: param.Integer(3, label="n")
+                   n: pn.widgets.IntInput(value=3, name="n")
                },
                use_cm=True, wireframe=True, wf_n1=75, wf_n2=6),
            backend=PB,
            title="Plücker's conoid",
            imodule="panel"
        )
 
@@ -904,24 +910,24 @@
     Refer to the interactive sub-module documentation to learn more about the
     ``params`` dictionary.
 
     .. panel-screenshot::
 
        from sympy import *
        from spb import *
-       import param
+       import panel as pn
        n, m = symbols("n, m")
        phi, theta = symbols("phi, theta", real=True)
        r = re(Ynm(n, m, theta, phi).expand(func=True).rewrite(sin).expand())
        graphics(
            surface_spherical(abs(r), (theta, 0, pi), (phi, 0, 2*pi),
                label="real",
                params = {
-                   n: param.Integer(2, label="n"),
-                   m: param.Integer(0, label="m"),
+                   n: pn.widgets.IntInput(value=2, name="n"),
+                   m: pn.widgets.IntInput(value=0, name="m"),
                },
                use_cm=True, color_func=r, force_real_eval=True),
            backend=PB, imodule="panel")
 
     See Also
     ========
```

### Comparing `sympy_plot_backends-3.2.0/spb/graphics/graphics.py` & `sympy_plot_backends-3.3.0/spb/graphics/graphics.py`

 * *Files identical despite different names*

### Comparing `sympy_plot_backends-3.2.0/spb/graphics/utils.py` & `sympy_plot_backends-3.3.0/spb/graphics/utils.py`

 * *Files 3% similar despite different names*

```diff
@@ -51,15 +51,17 @@
         param_expr, ranges = [], []
 
         if s.is_3Dsurface:
             expr = s.expr
 
             kw = wf_kwargs.copy()
             if s.is_interactive:
-                kw["params"] = s.params.copy()
+                # pass in the original parameters provided by the user, which
+                # might contain RangeSlider...
+                kw["params"] = s._original_params.copy()
 
             if s.is_parametric:
                 (x, sx, ex), (y, sy, ey) = s.ranges
                 is_callable = any(callable(e) for e in expr)
 
                 for uval in linspace(sx, ex, wf_n1):
                     kw["n"] = s.n[1] if npoints is None else npoints
```

### Comparing `sympy_plot_backends-3.2.0/spb/graphics/vectors.py` & `sympy_plot_backends-3.3.0/spb/graphics/vectors.py`

 * *Files 2% similar despite different names*

```diff
@@ -258,28 +258,33 @@
     sub-module documentation to learn more about the ``params`` dictionary.
     This plot illustrates:
 
     * customizing the appearance of quivers and countour.
     * the use of ``prange`` (parametric plotting range).
     * the use of the ``params`` dictionary to specify sliders in
       their basic form: (default, min, max).
+    * the use of :py:class:`panel.widgets.slider.RangeSlider`, which is a
+      2-values widget.
 
     .. panel-screenshot::
        :small-size: 800, 610
 
        from sympy import *
        from spb import *
-       x, y, a, b, c, d = symbols("x, y, a, b, c, d")
+       import panel as pn
+       x, y, a, b, c, d, e = symbols("x, y, a, b, c, d, e")
        v = [-sin(a * y), cos(b * x)]
        graphics(
            vector_field_2d(-sin(a * y), cos(b * x),
-               prange(x, -3*c, 3*c), prange(y, -3*d, 3*d),
+               prange(x, -3*c, 3*c), prange(y, d, e),
                params={
                    a: (1, -2, 2), b: (1, -2, 2),
-                   c: (1, 0, 2), d: (1, 0, 2),
+                   c: (1, 0, 2),
+                   (d, e): pn.widgets.RangeSlider(
+                       value=(-3, 3), start=-9, end=9, step=0.1)
                },
                quiver_kw=dict(color="black", scale=30, headwidth=5),
                contour_kw={"cmap": "Blues_r", "levels": 15}
            ),
            grid=False, xlabel="x", ylabel="y")
 
     See Also
```

### Comparing `sympy_plot_backends-3.2.0/spb/interactive/__init__.py` & `sympy_plot_backends-3.3.0/spb/interactive/__init__.py`

 * *Files 14% similar despite different names*

```diff
@@ -84,15 +84,15 @@
             N = int(a)
         elif TickFormatter and isinstance(a, TickFormatter):
             formatter = a
         elif isinstance(a, str):
             b = a.lower()
             if b in ["linear", "log"]:
                 spacing = b
-            elif b[0] == ".":
+            elif b[0] in [".", "%"]:
                 formatter = a
             else:
                 label = a
 
     N = N if N else 40
     step = (_max - _min) / N
 
@@ -112,17 +112,17 @@
     """Select which interactive module to use.
     """
     imodule = kwargs.pop("imodule", cfg["interactive"]["module"])
     if imodule is None:
         imodule = cfg["interactive"]["module"]
     imodule = imodule.lower()
 
-    if imodule == "panel":
-        # NOTE: Holoviz's Panel is really slow to load, so let's load it only when
+    # NOTE: Holoviz's Panel is really slow to load, so let's load it only when
         # it is necessary
+    if imodule == "panel":
         from spb.interactive.panel import iplot
         return iplot(*series, **kwargs)
     elif imodule == "ipywidgets":
         from spb.interactive.ipywidgets import iplot
         return iplot(*series, **kwargs)
 
     raise ValueError("`%s` is not a valid interactive module" % imodule)
@@ -190,7 +190,40 @@
 
         backend_kw = self._backend._copy_kwargs()
         iplot_kw = self._get_iplot_kw()
         iplot_kw["show"] = False
 
         new_iplot = type(self)(*series, **merge({}, backend_kw, iplot_kw))
         return new_iplot
+
+
+def _aggregate_parameters(params, series):
+    """Loop over data series to extract the `params` dictionaries provided by
+    the user. This is necessary when dealing with the ``graphics`` module.
+
+    Parameters
+    ==========
+    params : dict
+        Whatever was provided by the user in the main function call (be it
+        plot(), plot_paramentric(), ..., graphics())
+    series : list
+        Data series of the current interactive widget plot.
+
+    Returns
+    =======
+    params : dict
+    """
+    if params is None:
+        params = {}
+    if len(params) == 0:
+        # this is the case when an interactive widget plot is build with
+        # the `graphics` interface.
+        for s in series:
+            if s.is_interactive:
+                # use s._original_params instead of s.params in order to
+                # keep track of multi-values widgets
+                params.update(s._original_params)
+    if len(params) == 0:
+        raise ValueError(
+            "In order to create an interactive plot, "
+            "the `params` dictionary must be provided.")
+    return params
```

### Comparing `sympy_plot_backends-3.2.0/spb/interactive/bootstrap_spb/__init__.py` & `sympy_plot_backends-3.3.0/spb/interactive/bootstrap_spb/__init__.py`

 * *Files identical despite different names*

### Comparing `sympy_plot_backends-3.2.0/spb/interactive/bootstrap_spb/bootstrap.css` & `sympy_plot_backends-3.3.0/spb/interactive/bootstrap_spb/bootstrap.css`

 * *Files identical despite different names*

### Comparing `sympy_plot_backends-3.2.0/spb/interactive/bootstrap_spb/bootstrap.html` & `sympy_plot_backends-3.3.0/spb/interactive/bootstrap_spb/bootstrap.html`

 * *Files identical despite different names*

### Comparing `sympy_plot_backends-3.2.0/spb/interactive/ipywidgets.py` & `sympy_plot_backends-3.3.0/spb/interactive/ipywidgets.py`

 * *Files 8% similar despite different names*

```diff
@@ -1,11 +1,12 @@
 import ipywidgets
+from sympy import latex
 from sympy.external import import_module
 from spb.defaults import TWO_D_B, THREE_D_B
-from spb.interactive import _tuple_to_dict, IPlot
+from spb.interactive import _tuple_to_dict, IPlot, _aggregate_parameters
 from spb import BB, MB, PlotGrid
 from IPython.display import clear_output
 import warnings
 
 
 def _build_widgets(params, use_latex=True):
     widgets = []
@@ -22,14 +23,19 @@
                 d2 = d.copy()
                 if formatter and isinstance(formatter, str):
                     d2["readout_format"] = formatter
                 widgets.append(ipywidgets.FloatSlider(**d2))
             else:
                 widgets.append(ipywidgets.FloatLogSlider(**d))
         elif isinstance(v, ipywidgets.Widget):
+            if hasattr(v, "description") and len(v.description) == 0:
+                # show the symbol if no label was set to the widget
+                wrapper = "$%s$" if use_latex else "%s"
+                func = latex if use_latex else str
+                v.description = wrapper % func(s)
             widgets.append(v)
         else:
             raise ValueError(
                 "Cannot build a widget with the provided input: %s" % v)
     return widgets
 
 
@@ -50,32 +56,26 @@
                 c += 1
     return grid
 
 
 class InteractivePlot(IPlot):
     def __init__(self, *series, **kwargs):
         params = kwargs.pop("params", {})
-        if len(params) == 0:
-            # this is the case when an interactive widget plot is build with
-            # the `graphics` interface.
-            for s in series:
-                if s.is_interactive:
-                    params.update(s.params)
-        if not params:
-            raise ValueError("`params` must be provided.")
+        params = _aggregate_parameters(params, series)
         self._original_params = params
         self._use_latex = kwargs.pop("use_latex", True)
         self._ncols = kwargs.get("ncols", 2)
         self._layout = kwargs.get("layout", "tb")
 
         self._widgets = _build_widgets(params, self._use_latex)
         self._grid_widgets = _build_grid_layout(self._widgets, self._ncols)
 
         # map symbols to widgets
-        self._params_widgets = {k: v for k, v in zip(params.keys(), self._widgets)}
+        self._params_widgets = {
+            k: v for k, v in zip(params.keys(), self._widgets)}
 
         plotgrid = kwargs.get("plotgrid", None)
 
         if plotgrid:
             self._backend = plotgrid
         else:
             # assure that each series has the correct values associated
@@ -97,31 +97,31 @@
             "backend": type(self._backend),
             "layout": self._layout,
             "ncols": self._ncols,
             "use_latex": self._use_latex,
             "params": self._original_params,
         }
 
-    def show(self):
+    def _update(self, change):
         # bind widgets state to this update function
-        def update(change):
-            self._backend.update_interactive(
-                {k: v.value for k, v in self._params_widgets.items()})
-            if isinstance(self._backend, BB):
-                bokeh = import_module(
-                    'bokeh',
-                    import_kwargs={'fromlist': ['io']},
-                    warn_not_installed=True,
-                    min_module_version='2.3.0')
-                with self._output_figure:
-                    clear_output(True)
-                    bokeh.io.show(self._backend.fig)
+        self._backend.update_interactive(
+            {k: v.value for k, v in self._params_widgets.items()})
+        if isinstance(self._backend, BB):
+            bokeh = import_module(
+                'bokeh',
+                import_kwargs={'fromlist': ['io']},
+                warn_not_installed=True,
+                min_module_version='2.3.0')
+            with self._output_figure:
+                clear_output(True) # NOTE: this is the cause of flickering
+                bokeh.io.show(self._backend.fig)
 
+    def show(self):
         for w in self._widgets:
-            w.observe(update, "value")
+            w.observe(self._update, "value")
 
         # create the output figure
         if (isinstance(self._backend, MB) or
             (isinstance(self._backend, PlotGrid) and self._backend.is_matplotlib_fig)):
             # without plt.ioff, picture will show up twice. Morover, there
             # won't be any update
             self._backend.plt.ioff()
@@ -176,28 +176,33 @@
     exposed by the interactive module, which might not be included on the
     documentation of those other functions.
 
     Parameters
     ==========
 
     series : BaseSeries
-        Instances of BaseSeries, representing the symbolic expression to be
-        plotted.
+        Instances of :py:class:`spb.series.BaseSeries`, representing the
+        symbolic expression to be plotted.
 
     params : dict
         A dictionary mapping the symbols to a parameter. The parameter can be:
 
         1. a widget.
         2. a tuple of the form:
-           `(default, min, max, N, tick_format, label, spacing)`
-           where:
+           `(default, min, max, N, tick_format, label, spacing)`,
+           which will instantiate a
+           :py:class:`ipywidgets.widgets.widget_float.FloatSlider` or
+           a :py:class:`ipywidgets.widgets.widget_float.FloatLogSlider`,
+           depending on the spacing strategy. In particular:
 
            - default, min, max : float
                 Default value, minimum value and maximum value of the slider,
-                respectively. Must be finite numbers.
+                respectively. Must be finite numbers. The order of these 3
+                numbers is not important: the module will figure it out
+                which is what.
            - N : int, optional
                 Number of steps of the slider.
            - tick_format : str or None, optional
                 Provide a formatter for the tick value of the slider.
                 Default to ``".2f"``.
            - label: str, optional
                 Custom text associated to the slider.
@@ -221,16 +226,16 @@
     ncols : int, optional
         Number of columns to lay out the widgets. Default to 2.
 
     show : bool, optional
         Default to True.
         If True, it will return an object that will be rendered on the
         output cell of a Jupyter Notebook. If False, it returns an instance
-        of ``InteractivePlot``, which can later be be shown by calling the
-        `show()` method.
+        of ``InteractivePlot``, which can later be shown by calling the
+        ``show()`` method.
 
     title : str or tuple
         The title to be shown on top of the figure. To specify a parametric
         title, write a tuple of the form:``(title_str, param_symbol1, ...)``,
         where:
 
         * ``title_str`` must be a formatted string, for example:
@@ -241,23 +246,36 @@
     use_latex : bool, optional
         Default to True.
         If True, the latex representation of the symbols will be used in the
         labels of the parameter-controls. If False, the string
         representation will be used instead.
 
 
+    Notes
+    =====
+
+    1. This function is specifically designed to work within Jupyter Notebook
+       and requires the
+       `ipywidgets module <https://ipywidgets.readthedocs.io>`_ .
+
+    2. To update Matplotlib plots, the ``%matplotlib widget`` command must be
+       executed at the top of the Jupyter Notebook. It requires the
+       installation of the
+       `ipympl module <https://github.com/matplotlib/ipympl>`_ .
+
+
     Examples
     ========
 
     NOTE: the following examples use the ordinary plotting function because
     ``iplot`` is already integrated with them.
 
-    Surface plot between -10 <= x, y <= 10 with a damping parameter varying
-    from 0 to 1, with a default value of 0.15, discretized with 50 points
-    on both directions.
+    Surface plot between -10 <= x, y <= 10 discretized with 50 points
+    on both directions, with a damping parameter varying from 0 to 1, and a
+    default value of 0.15:
 
     .. code-block::
 
        from sympy import *
        from spb import *
        x, y, z = symbols("x, y, z")
        r = sqrt(x**2 + y**2)
@@ -276,15 +294,16 @@
            zlabel = "z axis",
            backend = PB,
            use_latex=False
        )
 
     A line plot illustrating how to specify widgets. In particular:
 
-    1. the parameter ``d`` will be rendered as a slider.
+    1. the parameter ``d`` will be rendered as a slider, with a custom
+       formatter showing 3 decimal places.
     2. the parameter ``n`` is a spinner.
     3. the parameter ``phi`` will be rendered as a slider: note the custom
        number of steps and the custom label.
     4. when using Matplotlib, the ``%matplotlib widget`` must be executed at
        the top of the notebook.
 
     .. code-block:: python
@@ -294,16 +313,17 @@
        from spb import *
        import ipywidgets
 
        x, phi, n, d = symbols("x, phi, n, d")
        plot(
            cos(x * n - phi) * exp(-abs(x) * d), (x, -5*pi, 5*pi),
            params={
-               d: (0.1, 0, 1),
-               n: ipywidgets.BoundedIntText(value=2, min=1, max=10, description="$n$"),
+               d: (0.1, 0, 1, ".3f"),
+               n: ipywidgets.BoundedIntText(value=2, min=1, max=10,
+                   description="$n$"),
                phi: (0, 0, 2*pi, 50, r"$\phi$ [rad]")
            },
            ylim=(-1.25, 1.25))
 
     A line plot illustrating the Fouries series approximation of a saw tooth
     wave and:
 
@@ -317,21 +337,21 @@
        import ipywidgets
 
        x, T, n, m = symbols("x, T, n, m")
        sawtooth = frac(x / T)
        # Fourier Series of a sawtooth wave
        fs = S(1) / 2 - (1 / pi) * Sum(sin(2 * n * pi * x / T) / n, (n, 1, m))
 
-       formatter = PrintfTickFormatter(format="%.3f")
        plot(
            (sawtooth, (x, 0, 10), "f", {"line_dash": "dotted"}),
            (fs, (x, 0, 10), "approx"),
            params = {
                T: (4, 0, 10, 80, "Period, T"),
-               m: ipywidgets.BoundedIntText(value=4, min=1, max=100, description="Sum up to n ")
+               m: ipywidgets.BoundedIntText(value=4, min=1, max=100,
+                   description="Sum up to n ")
            },
            xlabel = "x",
            ylabel = "y",
            backend = BB
        )
 
     A line plot of the magnitude of a transfer function, illustrating the use
@@ -361,15 +381,14 @@
                z: (0.2, 0, 1, 200, "z")
            },
            backend = BB,
            n = 2000,
            xscale = "log",
            xlabel = "Frequency, omega, [rad/s]",
            ylabel = "Magnitude [dB]",
-           use_latex = True,
        )
 
     A polar line plot. Note:
 
     1. when using Matplotlib, the ``%matplotlib widget`` must be executed at
        the top of the notebook.
     2. the two ways to create a integer sliders.
@@ -388,15 +407,16 @@
 
        plot_polar(
            (r1, (t, 0, 2*pi)),
            params = {
                p1: (0.035, -0.035, 0.035, 50),
                p2: (0.005, -0.02, 0.02, 50),
                # integer parameter created with ipywidgets
-               r: ipywidgets.BoundedIntText(value=2, min=2, max=5, description="r"),
+               r: ipywidgets.BoundedIntText(value=2, min=2, max=5,
+                   description="r"),
                # integer parameter created with usual syntax
                c: (3, 1, 5, 4)
            },
            backend = MB,
            aspect = "equal",
            n = 5000,
            name = "Non Circular Planetary Drive - Ring Profile"
@@ -416,28 +436,12 @@
            line(cos(u * x), (x, -5, 5), params=params),
            line(sin(u * x), (x, -5, 5), params=params),
            line(
                sin(x)*cos(x), (x, -5, 5),
                rendering_kw={"marker": "^", "linestyle": ":"}, n=50),
        )
 
-    Notes
-    =====
-
-    1. This function is specifically designed to work within Jupyter Notebook
-       and requires the ``ipywidgets`` module [#fna]_ .
-
-    2. To update Matplotlib plots, the ``%matplotlib widget`` command must be
-       executed at the top of the Jupyter Notebook. It requires the
-       installation of the ``ipympl`` module [#fnb]_ .
-
-    References
-    ==========
-
-    .. [#fna] https://ipywidgets.readthedocs.io
-    .. [#fnb] https://github.com/matplotlib/ipympl
-
     """
     i = InteractivePlot(*series, **kwargs)
     if show:
         return i.show()
     return i
```

### Comparing `sympy_plot_backends-3.2.0/spb/interactive/panel.py` & `sympy_plot_backends-3.3.0/spb/interactive/panel.py`

 * *Files 18% similar despite different names*

```diff
@@ -1,12 +1,18 @@
+"""
+Implements interactive-widgets plotting with Holoviz Panel using
+`pn.bind`, which binds a function or method to the values of widgets.
+"""
+
 from spb.defaults import TWO_D_B, THREE_D_B, cfg
 from spb.utils import _validate_kwargs
-from spb.interactive import _tuple_to_dict, IPlot
+from spb.interactive import _tuple_to_dict, IPlot, _aggregate_parameters
 from spb.interactive.bootstrap_spb import SymPyBootstrapTemplate
 from spb.plotgrid import PlotGrid
+from sympy import latex
 from sympy.external import import_module
 import warnings
 
 param = import_module(
     'param',
     min_module_version='1.11.0',
     warn_not_installed=True)
@@ -14,337 +20,259 @@
     'panel',
     min_module_version='0.12.0',
     warn_not_installed=True)
 
 pn.extension("mathjax", "plotly", sizing_mode="stretch_width")
 
 
-class MyList(param.ObjectSelector):
-    """Represent a list of numbers discretizing a log-spaced slider.
-    This parameter will be rendered by pn.widgets.DiscreteSlider
-    """
-    pass
-
-
-# explicitely ask panel to use DiscreteSlider when it encounters a
-# MyList object
-pn.Param.mapping[MyList] = pn.widgets.DiscreteSlider
+def _dict_to_slider(d):
+    if d["type"] == "linear":
+        return pn.widgets.FloatSlider(
+            start=d["min"], end=d["max"], value=d["value"],
+            step=d["step"], name=d["description"], format=d["formatter"]
+        )
+    else:
+        np = import_module("numpy")
+        _min, _max, step, value = d["min"], d["max"], d["step"], d["value"]
+        N = int((_max - _min) / step)
+        # divide the range in N steps evenly spaced in a log scale
+        options = np.geomspace(_min, _max, N)
+        # the provided default value may not be in the computed options.
+        # If that's the case, I chose the closest value
+        if value not in options:
+            value = min(options, key=lambda x: abs(x - value))
+
+        kwargs = dict(
+            options=options.tolist(), value=value, name=d["description"])
+        if d["formatter"]:
+            kwargs["formatter"] = d["formatter"]
+        return pn.widgets.DiscreteSlider(**kwargs)
 
 
 class DynamicParam(param.Parameterized):
-    """Dynamically add parameters based on the user-provided dictionary.
-    """
+    """This class is used to convert a parameter from the ``param`` module to
+    a widget from ``panel``.
 
-    # NOTE: why DynamicParam is a child class of param.Parameterized?
-    # param is a full-python library, doesn't depend on anything else.
-    # In theory, by using a parameterized class it should be possible to
-    # create an InteractivePlotGUI class targeting a specific GUI.
-    # At this moment, InteractivePlot is built on top of 'panel', so it only
-    # works inside a Jupyter Notebook. Maybe it's possible to use PyQt or Tk.
-
-    # Each one of the dynamically added parameters (widgets) will execute a
-    # function that modify this parameter, which in turns will trigger an
-    # overall update.
-    check_val = param.Integer(default=0)
-
-    def _dict_to_panel_dict(self, d):
-        np = import_module('numpy')
-        _min, _max, default = d["min"], d["max"], d["value"]
-        step, label, _type = d["step"], d["description"], d["type"]
-
-        if _type == "log":
-            # In case of a logarithm slider, we need to instantiate the
-            # custom parameter MyList.
-            N = int((_max - _min) / step)
-
-            # divide the range in N steps evenly spaced in a log scale
-            options = np.geomspace(_min, _max, N)
-            # the provided default value may not be in the computed options.
-            # If that's the case, I chose the closest value
-            if default not in options:
-                default = min(options, key=lambda x: abs(x - default))
-            return MyList(
-                default=default, objects=list(options),
-                label=label)
-
-        defaults_keys = ["default", "softbounds", "step", "label", "type"]
-        values = [default, (_min, _max), step, label, _type]
-        return {k: v for k, v in zip(defaults_keys, values)}
-
-    def __init__(self, *args, name="", params=None, **kwargs):
-        bokeh = import_module(
-            'bokeh',
-            import_kwargs={'fromlist': ['models']},
-            min_module_version='2.3.0',
-            warn_not_installed=True)
-        TickFormatter = bokeh.models.formatters.TickFormatter
+    Examples
+    ========
 
-        # use latex on control labels and legends
-        self._use_latex = kwargs.pop("use_latex", True)
-        self._name = name
+    >>> import param
+    >>> import panel as pn
+    >>> p = param.Number(default=0, bounds=(0, 5))
+    >>> dyn_param = DynamicParam(p)
+    >>> tmp_panel = pn.Param(dyn_param)
+    >>> widget = tmp_panel.widget("dyn_param_0")
+    >>> type(widget)
+    panel.widgets.slider.FloatSlider
 
+    """
+    def __init__(self, current_param, **kwargs):
         # remove the previous class attributes added by the previous instances
         prev_params = [k for k in type(self).__dict__.keys() if "dyn_param_" in k]
         for p in prev_params:
             delattr(type(self), p)
 
         # this must be present in order to assure correct behaviour
-        super().__init__(name=name, **kwargs)
-        if not params:
-            raise ValueError("`params` must be provided.")
-        self._original_params = params
+        super().__init__(name="", **kwargs)
 
-        # The following dictionary will be used to create the appropriate
-        # lambda function arguments:
-        #    key: the provided symbol
-        #    val: name of the associated parameter
-        self.mapping = {}
+        self.param.add_parameter("dyn_param_0", current_param)
 
-        # NOTE: unfortunately, parameters from the param library do not
-        # provide a keyword argument to set a formatter for the slider's tick
-        # value. As a workaround, the user can provide a formatter for each
-        # parameter, which will be stored in the following dictionary and
-        # later used in the instantiation of the widgets.
-        self.formatters = {}
-
-        # create and attach the params to the class
-        for i, (k, v) in enumerate(params.items()):
-            # store the formatter
-            self.formatters[k] = None
-
-            if not isinstance(v, param.parameterized.Parameter):
-                d = _tuple_to_dict(k, v, self._use_latex, "$$%s$$")
-                if (
-                    (d["formatter"] is not None) and
-                    (not isinstance(d["formatter"], TickFormatter))
-                ):
-                    raise TypeError(
-                        "To format the tick value of the widget associated "
-                        "to the symbol %s, an instance of "
-                        "bokeh.models.formatters.TickFormatter is expected. "
-                        "Instead, an instance of %s was given." % (
-                            k, type(d["formatter"])))
-                self.formatters[k] = d["formatter"]
-                v = self._dict_to_panel_dict(d)
-
-                # at this stage, v could be a dictionary representing a number,
-                # or a MyList parameter, representing a log slider
-                if not isinstance(v, param.parameterized.Parameter):
-                    v.pop("type", None)
-                    v = param.Number(**v)
-
-            param_name = "dyn_param_{}".format(i)
-            self.param.add_parameter(param_name, v)
-            self.param.watch(self._increment_val, param_name)
-            self.mapping[k] = param_name
 
-    def _increment_val(self, *depends):
-        self.check_val += 1
+class InteractivePlot(IPlot):
 
-    def read_parameters(self):
-        # TODO: check if param is still available, otherwise raise error
-        readout = dict()
-        for k, v in self.mapping.items():
-            readout[k] = getattr(self, v)
-        return readout
-
-    @param.depends("check_val", watch=True)
-    def update(self):
-        params = self.read_parameters()
-        # NOTE: in case _backend is not an attribute, it means that this
-        # class has been instantiated by create_widgets
-        if hasattr(self, "_backend"):
-            self._backend.update_interactive(params)
-            self._action_post_update()
-
-
-def _new_class(cls, **kwargs):
-    "Creates a new class which overrides parameter defaults."
-    return type(type(cls).__name__, (cls,), kwargs)
-
-
-class PanelLayout:
-    """Mixin class to group together the layout functionalities related to
-    the library panel.
-    """
+    def __new__(cls, *args, **kwargs):
+        return object.__new__(cls)
 
-    def __init__(self, layout, ncols, throttled=False, servable=False,
-        custom_css="", pane_kw=None, template=None):
+    def __init__(self, *series, name="", params=None, **kwargs):
         """
         Parameters
         ==========
-            layout : str
-                The layout for the controls/plot. Possible values:
-                    'tb': controls in the top bar.
-                    'bb': controls in the bottom bar.
-                    'sbl': controls in the left side bar.
-                    'sbr': controls in the right side bar.
-                Default layout to 'tb'.
-
-            ncols : int
-                Number of columns to lay out the widgets. Default to 2.
-
-            throttled : boolean, optional
-                Default to False. If True the recompute will be done at
-                mouse-up event on sliders. If False, every slider tick will
-                force a recompute.
-
-            servable : boolean, optional
-                Default to False. If True the application will be served on
-                a new browser window and a template will be applied to it.
-
-            custom_css : str, optional
-                This functionality is not yet fully implemented, please don't
-                use it.
-
-            pane_kw : dict, optional
-                A dictionary of keyword arguments that are going to be passed
-                to the pane containing the chart.
-
-            template : optional
-                Specify the template to be used to build the interactive
-                application. It can be one of the following options:
-
-                * None: the default template will be used.
-                * dictionary of keyword arguments to customize the default
-                  template.
-                * an instance of pn.template.base.BasicTemplate
-                * a subclass of pn.template.base.BasicTemplate
+            args : tuple
+                The usual plot arguments
+            name : str
+                Name of the interactive application
+            params : dict
+                In the keys there will be the symbols, in the values there
+                will be parameters to create the slider associated to
+                a symbol.
+            kwargs : dict
+                Usual keyword arguments to be used by the backends and series.
         """
-        # NOTE: More often than not, the numerical evaluation is going to be
-        # resource-intensive. By default, panel's sliders will force a
-        # recompute at every step change. As a consequence, the user
-        # experience will be laggy. To solve this problem, the update must
-        # be triggered on mouse-up event, which is set using throttled=True.
-        #
-        # https://panel.holoviz.org/reference/panes/Param.html#disabling-continuous-updates-for-slider-widgets
-
+        original_kwargs = kwargs.copy()
         mergedeep = import_module('mergedeep')
         self.merge = mergedeep.merge
 
-        layouts = ["tb", "bb", "sbl", "sbr"]
-        layout = layout.lower()
-        if layout not in layouts:
+        layout = kwargs.pop("layout", "tb").lower()
+        available_layouts = ["tb", "bb", "sbl", "sbr"]
+        if layout not in available_layouts:
             warnings.warn(
-                "`layout` must be one of the following: {}\n".format(layouts)
-                + "Falling back to layout='tb'."
+                "`layout` must be one of the following: %s\n"
+                "Falling back to layout='tb'." % available_layouts
             )
             layout = "tb"
         self._layout = layout
-        self._ncols = ncols
-        self._throttled = throttled
-        self._servable = servable
-        self._custom_css = custom_css
-        self._pane_kw = pane_kw
-        self._template = template
-
-        # NOTE: here I create a temporary panel.Param object in order to
-        # reuse the code from the pn.Param.widget method, which returns the
-        # correct widget associated to a given parameter's type.
-        # Alternatively, I would need to copy parts of that method in order
-        # to deal with the different representations of param.Integer and
-        # param.Number depending if the bounds are None values.
-        # Note that I'm only interested in the widget type: panel is then
-        # going to recreate the widgets and setting the proper throttled
-        # value. This is definitely not an optimal procedure, as we are
-        # creating the "same" widget two times, but it works :)
-        tmp_panel = pn.Param(self)
-        widgets = {}
-        for k, v in self.mapping.items():
-            widgets[v] = {"type": type(tmp_panel.widget(v))}
-            t = getattr(self.param, v)
-            if isinstance(t, param.Number):
-                if self.formatters[k] is not None:
-                    widgets[v]["format"] = self.formatters[k]
-
-        # turn on/off throttling according to:
-        # https://panel.holoviz.org/how_to/performance/throttling.html
-        pn.config.throttled = throttled
-
-        self.controls = pn.Param(
-            self,
-            parameters=list(self.mapping.values()),
-            widgets=widgets,
-            default_layout=_new_class(pn.GridBox, ncols=ncols),
-            show_name=False,
-            sizing_mode="stretch_width",
-        )
+        self._ncols = kwargs.pop("ncols", 2)
+        self._throttled = kwargs.pop("throttled", cfg["interactive"]["throttled"])
+        self._servable = kwargs.pop("servable", cfg["interactive"]["servable"])
+        self._use_latex = kwargs.pop("use_latex", cfg["interactive"]["use_latex"])
+        self._pane_kw = kwargs.pop("pane_kw", dict())
+        self._custom_css = kwargs.pop("custom_css", "")
+        self._template = kwargs.pop("template", None)
+        self._name = name
+
+        params = _aggregate_parameters(params, series)
+        self._original_params = params
+
+        # The following dictionary will be used to create the appropriate
+        # lambda function arguments:
+        #    key: the provided symbol
+        #    val: widget
+        self.mapping = create_widgets(params, self._use_latex)
+
+        plotgrid = kwargs.get("plotgrid", None)
+        if plotgrid:
+            self._backend = plotgrid
+            self._binding = pn.bind(self._update, *self._widgets_for_binding())
+        else:
+            # assure that each series has the correct values associated
+            # to parameters
+            series = list(series)
+            for s in series:
+                if s.is_interactive:
+                    s.params = self.read_parameters()
+
+            is_3D = all([s.is_3D for s in series])
+            Backend = kwargs.pop("backend", THREE_D_B if is_3D else TWO_D_B)
+            kwargs["is_iplot"] = True
+            kwargs["imodule"] = "panel"
+            self._backend = Backend(*series, **kwargs)
+            _validate_kwargs(self._backend, **original_kwargs)
+
+            from spb import PB
+            if Backend is PB:
+                self._binding = pn.bind(
+                    self._update_plotly, *self._widgets_for_binding())
+            else:
+                self._binding = pn.bind(
+                    self._update, *self._widgets_for_binding())
+
+    def _widgets_for_binding(self):
+        """Select the appropriate things to return for the `pn.bind` function.
+        """
+        widgets = list(self.mapping.values())
+        if self._throttled:
+            def is_panel_slider(t):
+                if not isinstance(t, pn.widgets.base.Widget):
+                    return False
+                if "Slider" in type(t).__name__:
+                    return True
+                return False
+            widgets = [
+                w if not is_panel_slider(w) else w.param.value_throttled
+                for w in widgets
+            ]
+        return widgets
+
+    def read_parameters(self):
+        return {symb: widget.value for symb, widget in self.mapping.items()}
+
+    def _update(self, *values):
+        d = {symb: v for symb, v in zip(list(self.mapping.keys()), values)}
+        self.backend.update_interactive(d)
+        return self.fig
+
+    def _update_plotly(self, *values):
+        d = {symb: v for symb, v in zip(list(self.mapping.keys()), values)}
+        self.backend.update_interactive(d)
+        # NOTE: while pn.pane.Plotly can receive an instance of go.Figure,
+        # the update will be extremely slow, because after each trace
+        # is updated with new data, it will trigger an update event on the
+        # javascript side. Instead, by providing the following dictionary,
+        # first the traces are updated, then the pane creates the figure
+        # (with only one single javascript update).
+        # TODO: can the backend be modified by adding data and layout
+        # attributes, avoiding the creation of the figure? The figure could
+        # be created inside the fig getter.
+        return self.fig.to_dict()
+
+    @property
+    def pane_kw(self):
+        """Return the keyword arguments used to customize the wrapper to the
+        plot.
+        """
+        return self._pane_kw
+
+    def _get_iplot_kw(self):
+        return {
+            "backend": type(self._backend),
+            "layout": self._layout,
+            "template": self._template,
+            "ncols": self._ncols,
+            "throttled": self._throttled,
+            "use_latex": self._use_latex,
+            "params": self._original_params,
+            "pane_kw": self._pane_kw
+        }
 
     def _init_pane(self):
         """Here we wrap the figure exposed by the backend with a Pane, which
         allows to set useful properties.
         """
-
         # NOTE: If the following import statement was located at the
         # beginning of the file, there would be a circular import.
-        from spb import KB, MB
+        from spb import KB, MB, BB, PB
 
-        default_kw = dict()
-        if isinstance(self._backend, KB):
-            # TODO: for some reason, panel is going to set width=0
-            # if K3D-Jupyter is used.
-            # Temporary workaround: create a Pane with a default width.
-            # Long term solution: create a PR on panel to create a K3DPane
-            # so that panel will automatically deal with K3D, in the same
-            # way it does with Bokeh, Plotly, Matplotlib, ...
-            default_kw["width"] = 800
-        elif isinstance(self._backend, MB):
+        default_kw = {}
+        if isinstance(self._backend, PB):
+            pane_func = pn.pane.Plotly
+        elif (
+            isinstance(self._backend, MB) or        # vanilla MB
+            (
+                hasattr(self._backend, "is_matplotlib_fig") and
+                self._backend.is_matplotlib_fig     # plotgrid with all MBs
+            )
+        ):
             # since we are using Jupyter and interactivity, it is useful to
             # activate ipympl interactive frame, as well as setting a lower
             # dpi resolution of the matplotlib image
             default_kw["dpi"] = 96
             # NOTE: the following must be set to False in order for the
             # example outputs to become visible on Sphinx.
             default_kw["interactive"] = False
-
-        # merge = self._backend.merge
-        kw = self.merge({}, default_kw, self._pane_kw)
-        # NOTE: If the following import statement was located at the
-        # beginning of the file, there would be a circular import.
-        from spb import PB
-        if isinstance(self._backend, PB):
-            # NOTE: while pn.pane.Plotly can receive an instance of go.Figure,
-            # the update will be extremely slow, because after each trace
-            # is updated it will trigger an update event on the javascript
-            # side. Instead, by providing the following dictionary, first the
-            # traces are updated, then the pane creates the figure.
-            # TODO: can the backend be modified by adding data and layout
-            # attributes, avoiding the creation of the figure? The figure could
-            # be created inside the fig getter.
-            self.pane = pn.pane.Plotly(self.fig.to_dict(), **kw)
+            pane_func = pn.pane.Matplotlib
+        elif isinstance(self._backend, BB):
+            pane_func = pn.pane.Bokeh
+        elif isinstance(self._backend, KB):
+            # TODO: for some reason, panel is going to set width=0
+            # if K3D-Jupyter is used.
+            # Temporary workaround: create a Pane with a default width.
+            # Long term solution: create a PR on panel to create a K3DPane
+            # so that panel will automatically deal with K3D, in the same
+            # way it does with Bokeh, Plotly, Matplotlib, ...
+            default_kw["width"] = 800
+            pane_func = pn.pane.panel
         else:
-            self.pane = pn.pane.panel(self.fig, **kw)
+            # here we are dealing with plotgrid of BB/PB/or mixed backend...
+            # but not with plotgrids of MB
+            # First, set the necessary data to create bindings for each
+            # subplot
+            self._backend.pre_set_bindings(
+                list(self.mapping.keys()),
+                self._widgets_for_binding()
+            )
+            # Then, create the pn.GridSpec figure
+            self.pane = self._backend.fig
+            return
+        kw = self.merge({}, default_kw, self._pane_kw)
+        self.pane = pane_func(self._binding, **kw)
 
+    @property
     def layout_controls(self):
-        return self.controls
-
-    def _action_post_update(self):
-        # NOTE: If the following import statement was located at the
-        # beginning of the file, there would be a circular import.
-        from spb import KB, PB
-
-        if isinstance(self._backend, PlotGrid):
-            self._backend._action_post_update()
-
-        elif not isinstance(self._backend, KB):
-            # KB exhibits a strange behavior when executing the following
-            # lines. For the moment, do not execute them with KB
-            # if isinstance(self._backend, PlotGrid):
-            #     pass
-            # else:
-            self.pane.param.trigger("object")
-            # self.pane.object = self.fig
-            if not isinstance(self._backend, PB):
-                self.pane.object = self.fig
-            else:
-                # NOTE: sadly, there is a bug with Panel and Plotly: if the
-                # user modifies the layout of the chart (for example zoom or
-                # rotate the view), the next update will reset them.
-                # https://github.com/holoviz/panel/issues/1801
-                self.pane.object = self.fig.to_dict()
+        widgets = list(self.mapping.values())
+        return pn.GridBox(*widgets, ncols=self._ncols)
 
     def show(self):
         self._init_pane()
 
         if not self._servable:
             if self._layout == "tb":
                 content = pn.Column(self.layout_controls, self.pane)
@@ -408,96 +336,14 @@
         template.sidebar.append(self.layout_controls)
 
         if show:
             return template.servable().show()
         return template
 
 
-class InteractivePlot(DynamicParam, PanelLayout, IPlot):
-
-    def __new__(cls, *args, **kwargs):
-        return object.__new__(cls)
-
-    def __init__(self, *series, name="", params=None, **kwargs):
-        """
-        Parameters
-        ==========
-            args : tuple
-                The usual plot arguments
-            name : str
-                Name of the interactive application
-            params : dict
-                In the keys there will be the symbols, in the values there
-                will be parameters to create the slider associated to
-                a symbol.
-            kwargs : dict
-                Usual keyword arguments to be used by the backends and series.
-        """
-        original_kwargs = kwargs.copy()
-
-        layout = kwargs.pop("layout", "tb")
-        ncols = kwargs.pop("ncols", 2)
-        throttled = kwargs.pop("throttled", cfg["interactive"]["throttled"])
-        servable = kwargs.pop("servable", cfg["interactive"]["servable"])
-        use_latex = kwargs.pop("use_latex", cfg["interactive"]["use_latex"])
-        pane_kw = kwargs.pop("pane_kw", dict())
-        custom_css = kwargs.pop("custom_css", "")
-        template = kwargs.pop("template", None)
-
-        self._name = name
-        if params is None:
-            params = {}
-        if len(params) == 0:
-            # this is the case when an interactive widget plot is build with
-            # the `graphics` interface.
-            for s in series:
-                if s.is_interactive:
-                    params.update(s.params)
-        super().__init__(name=self._name, params=params, use_latex=use_latex)
-        PanelLayout.__init__(self, layout, ncols, throttled, servable,
-            custom_css, pane_kw, template)
-
-        plotgrid = kwargs.get("plotgrid", None)
-        if plotgrid:
-            self._backend = plotgrid
-        else:
-            # assure that each series has the correct values associated
-            # to parameters
-            series = list(series)
-            for s in series:
-                if s.is_interactive:
-                    s.params = self.read_parameters()
-
-            is_3D = all([s.is_3D for s in series])
-            Backend = kwargs.pop("backend", THREE_D_B if is_3D else TWO_D_B)
-            kwargs["is_iplot"] = True
-            kwargs["imodule"] = "panel"
-            self._backend = Backend(*series, **kwargs)
-            _validate_kwargs(self._backend, **original_kwargs)
-
-    @property
-    def pane_kw(self):
-        """Return the keyword arguments used to customize the wrapper to the
-        plot.
-        """
-        return self._pane_kw
-
-    def _get_iplot_kw(self):
-        return {
-            "backend": type(self._backend),
-            "layout": self._layout,
-            "template": self._template,
-            "ncols": self._ncols,
-            "throttled": self._throttled,
-            "use_latex": self._use_latex,
-            "params": self._original_params,
-            "pane_kw": self._pane_kw
-        }
-
-
 def iplot(*series, show=True, **kwargs):
     """Create an interactive application containing widgets and charts in order
     to study symbolic expressions, using Holoviz's Panel for the user interace.
 
     This function is already integrated with many of the usual
     plotting functions: since their documentation is more specific, it is
     highly recommended to use those instead.
@@ -506,35 +352,41 @@
     exposed by the interactive module, which might not be included on the
     documentation of those other functions.
 
     Parameters
     ==========
 
     series : BaseSeries
-        Instances of BaseSeries, representing the symbolic expression to be
-        plotted.
+        Instances of :py:class:`spb.series.BaseSeries`, representing the
+        symbolic expression to be plotted.
 
     params : dict
         A dictionary mapping the symbols to a parameter. The parameter can be:
 
-        1. an instance of `param.parameterized.Parameter`.
-        2. a tuple of the form:
-           `(default, min, max, N, tick_format, label, spacing)`
-           where:
+        1. An instance of :py:class:`panel.widgets.base.Widget`, something like
+           :py:class:`panel.widgets.FloatSlider`.
+        2. An instance of :py:class:`param.parameterized.Parameter`.
+        3. A tuple with the form:
+           `(default, min, max, N, tick_format, label, spacing)`,
+           which will instantiate a :py:class:`panel.widgets.FloatSlider` or
+           a :py:class:`panel.widgets.DiscreteSlider`, depending on the
+           spacing strategy. In particular:
 
            - default, min, max : float
                 Default value, minimum value and maximum value of the slider,
-                respectively. Must be finite numbers.
+                respectively. Must be finite numbers. The order of these 3
+                numbers is not important: the module will figure it out
+                which is what.
            - N : int, optional
                 Number of steps of the slider.
            - tick_format : TickFormatter or None, optional
                 Provide a formatter for the tick value of the slider. If None,
                 `panel` will automatically apply a default formatter.
                 Alternatively, an instance of
-                `bokeh.models.formatters.TickFormatter` can be used.
+                :py:class:`bokeh.models.formatters.TickFormatter` can be used.
                 Default to None.
            - label: str, optional
                 Custom text associated to the slider.
            - spacing : str, optional
                 Specify the discretization spacing. Default to ``"linear"``,
                 can be changed to ``"log"``.
 
@@ -564,33 +416,37 @@
 
     pane_kw : dict, optional
         A dictionary of keyword/values which is passed to the pane containing
         the chart in order to further customize the output (read the Notes
         section to understand how the interactive plot is built).
         The following web pages shows the available options:
 
-        * Refer to [#fn2]_ for ``MatplotlibBackend``. Two interesting options
-          are:
+        * If Matplotlib is used, the figure is wrapped by
+          :py:class:`panel.pane.plot.Matplotlib`. Two interesting options are:
 
           * ``interactive``: wheter to activate the ipympl interactive backend.
           * ``dpi``: set the dots per inch of the output png. Default to 96.
 
-        * Refer to [#fn3]_ for ``PlotlyBackend``.
+        * If Plotly is used, the figure is wrapped by
+          :py:class:`panel.pane.plotly.Plotly`.
+
+        * If Bokeh is used, the figure is wrapped by
+          :py:class:`panel.pane.plot.Bokeh`.
 
     servable : bool, optional
         Default to False, which will show the interactive application on the
         output cell of a Jupyter Notebook. If True, the application will be
         served on a new browser window.
 
     show : bool, optional
         Default to True.
         If True, it will return an object that will be rendered on the
         output cell of a Jupyter Notebook. If False, it returns an instance
         of ``InteractivePlot``, which can later be be shown by calling the
-        `show()` method.
+        ``show()`` method.
 
     template : optional
         Specify the template to be used to build the interactive application
         when ``servable=True``. It can be one of the following options:
 
         * None: the default template will be used.
         * dictionary of keyword arguments to customize the default template.
@@ -600,16 +456,16 @@
             Default to True.
           * ``sidebar_width`` (str): CSS value of the width of the sidebar
             in pixel or %. Applicable only when ``layout='sbl'`` or
             ``layout='sbr'``.
           * ``show_header`` (boolean): wheter to show the header of the
             application. Default to True.
 
-        * an instance of ``pn.template.base.BasicTemplate``
-        * a subclass of ``pn.template.base.BasicTemplate``
+        * an instance of :py:class:`panel.template.base.BasicTemplate`.
+        * a subclass of :py:class:`panel.template.base.BasicTemplate`.
 
     title : str or tuple
         The title to be shown on top of the figure. To specify a parametric
         title, write a tuple of the form:``(title_str, param_symbol1, ...)``,
         where:
 
         * ``title_str`` must be a formatted string, for example:
@@ -624,23 +480,68 @@
     use_latex : bool, optional
         Default to True.
         If True, the latex representation of the symbols will be used in the
         labels of the parameter-controls. If False, the string
         representation will be used instead.
 
 
+    See also
+    ========
+
+    create_widgets
+
+
+    Notes
+    =====
+
+    1. This function is specifically designed to work within Jupyter Notebook.
+       It is also possible to use it from a regular Python console,
+       by executing: ``iplot(..., servable=True)``, which will create a server
+       process loading the interactive plot on the browser.
+       However, :py:class:`spb.backends.k3d.K3DBackend` is not supported
+       in this mode of operation.
+
+    2. The interactive application consists of two main containers:
+
+       * a pane containing the widgets.
+       * a pane containing the chart, which can be further customize
+         by setting the ``pane_kw`` dictionary. Please, read its documentation
+         to understand the available options.
+
+    3. Some examples use an instance of
+       :py:class:`bokeh.models.PrintfTickFormatter` to format the
+       value shown by a slider. This class is exposed by Bokeh, but can be
+       used in interactive plots with any backend.
+
+    4. It has been observed that Dark Reader (or other night-mode-enabling
+       browser extensions) might interfere with the correct behaviour of
+       the output of  interactive plots. Please, consider adding ``localhost``
+       to the exclusion list of such browser extensions.
+
+    5. :py:class:`spb.backends.matplotlib.MatplotlibBackend` can be used,
+       but the resulting figure is just a PNG image without any interactive
+       frame. Thus, data exploration is not great. Therefore, the use of
+       :py:class:`spb.backends.plotly.PlotlyBackend` or
+       :py:class:`spb.backends.bokeh.BokehBackend` is encouraged.
+
+    6. When ``BokehBackend`` is used:
+
+       * rendering of gradient lines is slow.
+       * color bars might not update their ranges.
+
+
     Examples
     ========
 
     NOTE: the following examples use the ordinary plotting function because
     ``iplot`` is already integrated with them.
 
-    Surface plot between -10 <= x, y <= 10 with a damping parameter varying
-    from 0 to 1, with a default value of 0.15, discretized with 50 points
-    on both directions.
+    Surface plot between -10 <= x, y <= 10 discretized with 50 points
+    on both directions, with a damping parameter varying from 0 to 1, and a
+    default value of 0.15:
 
     .. panel-screenshot::
 
        from sympy import *
        from spb import *
        x, y, z = symbols("x, y, z")
        r = sqrt(x**2 + y**2)
@@ -653,87 +554,86 @@
                wireframe = True, wf_n1=15, wf_n2=15,
                wf_rendering_kw={"line_color": "#003428", "line_width": 0.75}
            ),
            title = "My Title",
            xlabel = "x axis",
            ylabel = "y axis",
            zlabel = "z axis",
-           backend = PB,
-           use_latex=False
+           backend = PB
        )
 
     A line plot of the magnitude of a transfer function, illustrating the use
     of multiple expressions and:
 
     1. some expression may not use all the parameters.
     2. custom labeling of the expressions.
     3. custom rendering of the expressions.
-    4. custom number of steps in the slider.
+    4. different ways to create sliders.
     5. custom format of the value shown on the slider. This might be useful to
        correctly visualize very small or very big numbers.
-    6. custom labeling of the parameter-sliders.
+    6. custom labeling of the sliders.
 
     .. panel-screenshot::
 
        from sympy import (symbols, sqrt, cos, exp, sin, pi, re, im,
            Matrix, Plane, Polygon, I, log)
        from spb import *
        from bokeh.models.formatters import PrintfTickFormatter
+       import panel as pn
+       import param
        formatter = PrintfTickFormatter(format="%.3f")
-       kp, t, z, o = symbols("k_P, tau, zeta, omega")
-       G = kp / (I**2 * t**2 * o**2 + 2 * z * t * o * I + 1)
+       kp, t, xi, o = symbols("k_P, tau, xi, omega")
+       G = kp / (I**2 * t**2 * o**2 + 2 * xi * t * o * I + 1)
        mod = lambda x: 20 * log(sqrt(re(x)**2 + im(x)**2), 10)
        plot(
-           (mod(G.subs(z, 0)), (o, 0.1, 100), "G(z=0)", {"line_dash": "dotted"}),
-           (mod(G.subs(z, 1)), (o, 0.1, 100), "G(z=1)", {"line_dash": "dotted"}),
+           (mod(G.subs(xi, 0)), (o, 0.1, 100), "G(xi=0)", {"line_dash": "dotted"}),
+           (mod(G.subs(xi, 1)), (o, 0.1, 100), "G(xi=1)", {"line_dash": "dotted"}),
            (mod(G), (o, 0.1, 100), "G"),
            params = {
                kp: (1, 0, 3),
-               t: (1, 0, 3),
-               z: (0.2, 0, 1, 200, formatter, "z")
+               t: param.Number(default=1, bounds=(0, 3), label="Time constant"),
+               xi: pn.widgets.FloatSlider(value=0.2, start=0, end=1,
+                   step=0.005, format=formatter, name="Damping ratio")
            },
            backend = BB,
            n = 2000,
            xscale = "log",
            xlabel = "Frequency, omega, [rad/s]",
            ylabel = "Magnitude [dB]",
-           use_latex = False,
        )
 
     A line plot illustrating the Fouries series approximation of a saw tooth
     wave and:
 
     1. custom format of the value shown on the slider.
-    2. creation of an integer spinner widget. This is achieved by setting
-       ``None`` as one of the bounds of the integer parameter.
+    2. creation of an integer spinner widget.
 
     .. panel-screenshot::
 
        from sympy import *
        from spb import *
-       import param
+       import panel as pn
        from bokeh.models.formatters import PrintfTickFormatter
 
        x, T, n, m = symbols("x, T, n, m")
        sawtooth = frac(x / T)
        # Fourier Series of a sawtooth wave
        fs = S(1) / 2 - (1 / pi) * Sum(sin(2 * n * pi * x / T) / n, (n, 1, m))
 
        formatter = PrintfTickFormatter(format="%.3f")
        plot(
            (sawtooth, (x, 0, 10), "f", {"line_dash": "dotted"}),
            (fs, (x, 0, 10), "approx"),
            params = {
                T: (4, 0, 10, 80, formatter),
-               m: param.Integer(4, bounds=(1, None), label="Sum up to n ")
+               m: pn.widgets.IntInput(value=4, start=1, name="Sum up to n ")
            },
            xlabel = "x",
            ylabel = "y",
-           backend = BB,
-           use_latex = False
+           backend = BB
        )
 
     A line plot with a parameter representing an angle in radians, but
     showing the value in degrees on its label:
 
     .. panel-screenshot::
        :small-size: 800, 570
@@ -748,16 +648,15 @@
        plot(
            (1 + x * sin(t), (x, -5, 5)),
            params = {
                t: (1, -2 * pi, 2 * pi, 100, formatter, "theta [deg]")
            },
            backend = MB,
            xlabel = "x", ylabel = "y",
-           ylim = (-3, 4),
-           use_latex = False,
+           ylim = (-3, 4)
        )
 
     Combine together interactive and non interactive plots:
 
     .. panel-screenshot::
        :small-size: 800, 570
 
@@ -772,23 +671,24 @@
            line(sin(u * x), (x, -5, 5), params=params),
            line(
                sin(x)*cos(x), (x, -5, 5),
                rendering_kw={"marker": "^", "linestyle": ":"}, n=50),
        )
 
     Serves the interactive plot to a separate browser window. Note that
-    ``K3DBackend`` is not supported for this operation mode. Also note the
-    two ways to create a integer sliders.
+    :py:class:`spb.backends.k3d.K3DBackend` is not supported for this
+    operation mode. Also note the two ways to create a integer sliders.
 
     .. panel-screenshot::
        :small-size: 800, 500
 
        from sympy import *
        from spb import *
        import param
+       import panel as pn
        from bokeh.models.formatters import PrintfTickFormatter
        formatter = PrintfTickFormatter(format='%.4f')
 
        p1, p2, t, r, c = symbols("p1, p2, t, r, c")
        phi = - (r * t + p1 * sin(c * r * t) + p2 * sin(2 * c * r * t))
        phip = phi.diff(t)
        r1 = phip / (1 + phip)
@@ -796,136 +696,66 @@
        plot_polar(
            (r1, (t, 0, 2*pi)),
            params = {
                p1: (0.035, -0.035, 0.035, 50, formatter),
                p2: (0.005, -0.02, 0.02, 50, formatter),
                # integer parameter created with param
                r: param.Integer(2, softbounds=(2, 5), label="r"),
-               # integer parameter created with usual syntax
-               c: (3, 1, 5, 4)
+               # integer parameter created with widgets
+               c: pn.widgets.IntSlider(value=3, start=1, end=5, name="c")
            },
-           use_latex = False,
            backend = BB,
            aspect = "equal",
            n = 5000,
            layout = "sbl",
            ncols = 1,
            servable = True,
            name = "Non Circular Planetary Drive - Ring Profile"
        )
 
-    Notes
-    =====
-
-    1. This function is specifically designed to work within Jupyter Notebook.
-       It is also possible to use it from a regular Python console,
-       by executing: ``iplot(..., servable=True)``, which will create a server
-       process loading the interactive plot on the browser.
-       However, ``K3DBackend`` is not supported in this mode of operation.
-
-    2. The interactive application consists of two main containers:
-
-       * a pane containing the widgets.
-       * a pane containing the chart. We can further customize this container
-         by setting the ``pane_kw`` dictionary. Please, read its documentation
-         to understand the available options.
-
-    3. Some examples use an instance of ``PrintfTickFormatter`` to format the
-       value shown by a slider. This class is exposed by Bokeh, but can be
-       used in interactive plots with any backend. Refer to [#fn1]_ for more
-       information about tick formatting.
-
-    4. It has been observed that Dark Reader (or other night-mode-enabling
-       browser extensions) might interfere with the correct behaviour of
-       the output of  interactive plots. Please, consider adding ``localhost``
-       to the exclusion list of such browser extensions.
-
-    5. Say we are creating two different interactive plots and capturing
-       their output on two variables, using ``show=False``. For example,
-       ``p1 = plot(..., params={a:(...), b:(...), ...}, show=False)`` and
-       ``p2 = plot(..., params={a:(...), b:(...), ...}, show=False)``.
-       Then, running ``p1.show()`` on the screen will result in an error.
-       This is standard behaviour that can't be changed, as `panel's`
-       parameters are class attributes that gets deleted each time a new
-       instance is created.
-
-    6. ``MatplotlibBackend`` can be used, but the resulting figure is just a
-       PNG image without any interactive frame. Thus, data exploration is not
-       great. Therefore, the use of ``PlotlyBackend`` or ``BokehBackend`` is
-       encouraged.
-
-    7. When ``BokehBackend`` is used:
-
-       * rendering of gradient lines is slow.
-       * color bars might not update their ranges.
-
-    8. Once this module has been loaded and executed, the safest procedure
-       to restart Jupyter Notebook's kernel is the following:
-
-       * save the current notebook.
-       * close the notebook and Jupyter server.
-       * restart Jupyter server and open the notebook.
-       * reload the cells.
-
-       Failing to follow this procedure might results in the notebook to
-       become  unresponsive once the module has been reloaded, with several
-       errors appearing on the output cell.
-
-
-    References
-    ==========
-
-    .. [#fn1] https://docs.bokeh.org/en/latest/docs/user_guide/styling.html#tick-label-formats
-    .. [#fn2] https://panel.holoviz.org/reference/panes/Matplotlib.html
-    .. [#fn3] https://panel.holoviz.org/reference/panes/Plotly.html
-
-
-    See also
-    ========
-
-    create_widgets
-
     """
     i = InteractivePlot(*series, **kwargs)
     if show:
         return i.show()
     return i
 
 
-def create_widgets(params, **kwargs):
+def create_widgets(params, use_latex=True, **kwargs):
     """ Create panel's widgets starting from parameters.
 
     Parameters
     ==========
 
     params : dict
         A dictionary mapping the symbols to a parameter. The parameter can be:
 
-        1. an instance of `param.parameterized.Parameter`. Refer to [#fn5]_
-           for a list of available parameters.
-        2. a tuple of the form:
-           `(default, min, max, N, tick_format, label, spacing)`
-           where:
+        1. an instance of :py:class:`param.parameterized.Parameter`.
+           Refer to [#fn5]_ for a list of available parameters.
+        2. A tuple with the form:
+           `(default, min, max, N, tick_format, label, spacing)`,
+           which will instantiate a :py:class:`panel.widgets.FloatSlider` or
+           a :py:class:`panel.widgets.DiscreteSlider`, depending on the
+           spacing strategy. In particular:
 
            - default, min, max : float
                 Default value, minimum value and maximum value of the slider,
                 respectively. Must be finite numbers.
            - N : int, optional
                 Number of steps of the slider.
            - tick_format : TickFormatter or None, optional
                 Provide a formatter for the tick value of the slider. If None,
                 `panel` will automatically apply a default formatter.
                 Alternatively, an instance of
-                `bokeh.models.formatters.TickFormatter` can be used.
+                :py:class:`bokeh.models.formatters.TickFormatter` can be used.
                 Default to None.
            - label: str, optional
                 Custom text associated to the slider.
            - spacing : str, optional
-                Specify the discretization spacing. Default to `"linear"`,
-                can be changed to `"log"`.
+                Specify the discretization spacing. Default to ``"linear"``,
+                can be changed to ``"log"``.
 
         Note that the parameters cannot be linked together (ie, one parameter
         cannot depend on another one).
 
     use_latex : bool, optional
         Default to True.
         If True, the latex representation of the symbols will be used in the
@@ -963,19 +793,33 @@
 
     .. [#fn5] https://panel.holoviz.org/user_guide/Param.html
 
 
     See also
     ========
 
-    iplot, create_series
+    iplot
 
     """
-    dp = DynamicParam(params=params, **kwargs)
-    tmp_panel = pn.Param(dp)
-
     results = dict()
-    for k, v in dp.mapping.items():
-        results[k] = tmp_panel.widget(v)
-        if dp.formatters[k] is not None:
-            results[k].format = dp.formatters[k]
+    for symb, v in params.items():
+        if isinstance(v, (pn.widgets.base.Widget)):
+            if hasattr(v, "name") and len(v.name) == 0:
+                # show the symbol if no label was set to the widget
+                wrapper = "$$%s$$" if use_latex else "%s"
+                func = latex if use_latex else str
+                v.name = wrapper % func(symb)
+            results[symb] = v
+        elif isinstance(v, param.parameterized.Parameter):
+            dyn_param = DynamicParam(v)
+            tmp_panel = pn.Param(dyn_param)
+            results[symb] = tmp_panel.widget("dyn_param_0")
+        elif isinstance(v, (list, tuple)):
+            d = _tuple_to_dict(symb, v, use_latex, "$$%s$$")
+            results[symb] = _dict_to_slider(d)
+        else:
+            raise TypeError(
+                "Parameter type not recognized. Expected list/tuple/"
+                "param.Parameter/pn.widgets. Received: %s "
+                "of type %s" % (v, type(v))
+            )
     return results
```

### Comparing `sympy_plot_backends-3.2.0/spb/plot_functions/__init__.py` & `sympy_plot_backends-3.3.0/spb/plot_functions/__init__.py`

 * *Files identical despite different names*

### Comparing `sympy_plot_backends-3.2.0/spb/plot_functions/complex_analysis.py` & `sympy_plot_backends-3.3.0/spb/plot_functions/complex_analysis.py`

 * *Files identical despite different names*

### Comparing `sympy_plot_backends-3.2.0/spb/plot_functions/control.py` & `sympy_plot_backends-3.3.0/spb/plot_functions/control.py`

 * *Files 3% similar despite different names*

```diff
@@ -1,21 +1,22 @@
 from spb.defaults import TWO_D_B, cfg
 from spb.graphics.control import (
     _preprocess_system, pole_zero,
     nichols, nyquist, step_response,
     ramp_response, impulse_response,
     bode_magnitude, bode_phase,
     control_axis, root_locus, ngrid as ngrid_function,
-    _get_grid_series
+    _get_grid_series, _ideal_tfinal_and_dt
 )
 from spb.interactive import create_interactive_plot
 from spb.plotgrid import plotgrid
 from spb.series import HVLineSeries
-from spb.utils import _instantiate_backend
+from spb.utils import _instantiate_backend, is_siso, tf_to_sympy, tf_to_control
 from sympy import exp, latex, sympify, Expr
+from sympy.external import import_module
 
 
 __all__ = [
     'pole_zero_plot', 'plot_pole_zero',
     'step_response_plot', 'plot_step_response',
     'impulse_response_plot', 'plot_impulse_response',
     'ramp_response_plot', 'plot_ramp_response',
@@ -64,15 +65,22 @@
                 ns if not isinstance(s[-1], str) else (ns, s[-1]))
         systems = new_systems.copy()
     if not isinstance(systems[0], (list, tuple)):
         provided_label = kwargs.get("label", None)
         if isinstance(provided_label, str):
             labels = [provided_label] * len(systems)
         else:
-            labels = [f"System {i+1}" for i in range(len(systems))]
+            # add "System #num" only if multiple mimo systems are plotted
+            # at the same time
+            n = len(systems)
+            if (n == 1) and (not is_siso(systems[0])):
+                labels = [""]
+            else:
+                labels = [f"System {i+1}" for i in range(n)]
+
         systems = [(system, label) for system, label in zip(systems, labels)]
     return systems
 
 
 def plot_pole_zero(
     *systems, pole_markersize=10, zero_markersize=7, show_axes=False,
     sgrid=False, zgrid=False, control=True, input=None, output=None, **kwargs
@@ -222,16 +230,43 @@
     kwargs.setdefault("title", "Poles and Zeros")
     return _create_plot_helper(grid + series, show_axes, **kwargs)
 
 
 pole_zero_plot = plot_pole_zero
 
 
+def _set_upper_limits(systems, upper_limit, is_step=True, **kwargs):
+    """If user didn't set upper time limit, compute the appropriate
+    value.
+    """
+    if (not upper_limit) and (not kwargs.get("params", None)):
+        sm = import_module("sympy.physics", import_kwargs={'fromlist':['control']})
+        TransferFunctionMatrix = sm.control.lti.TransferFunctionMatrix
+        sympy_systems = [tf_to_sympy(s) for s in systems]
+        # if multiple mimo systems are being plotted, unpack them
+        all_sympy_systems = []
+        for s in sympy_systems:
+            if isinstance(s, TransferFunctionMatrix):
+                for t in s.args[0]:
+                    all_sympy_systems.extend(t)
+            else:
+                all_sympy_systems.append(s)
+        # I want all systems to use the same upper time limit.
+        # So, build a temporary MIMO transfer function including all systems
+        # in order to compute an appropriate maximum time for the simulation.
+        sympy_mimo_sys = TransferFunctionMatrix([all_sympy_systems])
+        control_mimo_sys = tf_to_control(sympy_mimo_sys)
+        tfinal, _ = _ideal_tfinal_and_dt(control_mimo_sys)
+        if tfinal:
+            upper_limit = tfinal
+    return upper_limit
+
+
 def plot_step_response(
-    *systems, lower_limit=0, upper_limit=10,
+    *systems, lower_limit=None, upper_limit=None,
     prec=8, show_axes=False, control=True,
     input=None, output=None, **kwargs
 ):
     """
     Returns the unit step response of a continuous-time system. It is
     the response of the system when the input signal is a step function.
 
@@ -251,20 +286,22 @@
           :py:class:`sympy.physics.control.lti.TransferFunction`.
         * a tuple of two or three elements: ``(num, den, generator [opt])``,
           which will be converted to an object of type
           :py:class:`sympy.physics.control.lti.TransferFunction`.
         * a sequence of LTI systems.
         * a sequence of 2-tuples ``(LTI system, label)``.
         * a dict mapping LTI systems to labels.
-    lower_limit : Number, optional
-        The lower limit of the plot range. Defaults to 0. If a different value
-        is to be used, also set ``control=False`` (see examples in order to
-        understand why).
-    upper_limit : Number, optional
-        The upper limit of the plot range. Defaults to 10.
+    lower_limit : Number or None, optional
+        The lower time limit of the plot range. Defaults to 0. If a different
+        value  is to be used, also set ``control=False`` (see examples in
+        order to understand why).
+    upper_limit : Number or None, optional
+        The upper time limit of the plot range. If not provided, an
+        appropriate value will be computed. If a interactive widget plot is
+        being created, it defaults to 10.
     prec : int, optional
         The decimal point precision for the point coordinate values.
         Defaults to 8.
     show_axes : boolean, optional
         If ``True``, the coordinate axes will be shown. Defaults to False.
     control : bool
         If True, computes the step response with the ``control``
@@ -365,14 +402,17 @@
 
     References
     ==========
 
     .. [1] https://www.mathworks.com/help/control/ref/lti.step.html
 
     """
+
+    upper_limit = _set_upper_limits(
+        systems, upper_limit, is_step=True, **kwargs)
     systems = _unpack_systems(systems, **kwargs)
     series = []
     for s, l in systems:
         kw = kwargs.copy()
         kw["label"] = l
         series.extend(
             step_response(
@@ -387,16 +427,16 @@
     return _create_plot_helper(series, show_axes, **kwargs)
 
 
 step_response_plot = plot_step_response
 
 
 def plot_impulse_response(
-    *systems, prec=8, lower_limit=0,
-    upper_limit=10, show_axes=False, control=True,
+    *systems, prec=8, lower_limit=None,
+    upper_limit=None, show_axes=False, control=True,
     input=None, output=None, **kwargs
 ):
     """
     Returns the unit impulse response (Input is the Dirac-Delta Function) of a
     continuous-time system.
 
     Parameters
@@ -415,20 +455,22 @@
           :py:class:`sympy.physics.control.lti.TransferFunction`.
         * a tuple of two or three elements: ``(num, den, generator [opt])``,
           which will be converted to an object of type
           :py:class:`sympy.physics.control.lti.TransferFunction`.
         * a sequence of LTI systems.
         * a sequence of 2-tuples ``(LTI system, label)``.
         * a dict mapping LTI systems to labels.
-    lower_limit : Number, optional
-        The lower limit of the plot range. Defaults to 0. If a different value
-        is to be used, also set ``control=False`` (see examples in order to
-        understand why).
-    upper_limit : Number, optional
-        The upper limit of the plot range. Defaults to 10.
+    lower_limit : Number or None, optional
+        The lower time limit of the plot range. Defaults to 0. If a different
+        value  is to be used, also set ``control=False`` (see examples in
+        order to understand why).
+    upper_limit : Number or None, optional
+        The upper time limit of the plot range. If not provided, an
+        appropriate value will be computed. If a interactive widget plot is
+        being created, it defaults to 10.
     prec : int, optional
         The decimal point precision for the point coordinate values.
         Defaults to 8.
     show_axes : boolean, optional
         If ``True``, the coordinate axes will be shown. Defaults to False.
     control : bool
         If True, computes the step response with the ``control``
@@ -532,14 +574,16 @@
 
     References
     ==========
 
     .. [1] https://www.mathworks.com/help/control/ref/lti.impulse.html
 
     """
+    upper_limit = _set_upper_limits(
+        systems, upper_limit, is_step=False, **kwargs)
     systems = _unpack_systems(systems, **kwargs)
     series = []
     for s, l in systems:
         kw = kwargs.copy()
         kw["label"] = l
         series.extend(
             impulse_response(
@@ -555,15 +599,15 @@
 
 
 impulse_response_plot = plot_impulse_response
 
 
 def plot_ramp_response(
     *systems, slope=1, prec=8,
-    lower_limit=0, upper_limit=10, show_axes=False, control=True,
+    lower_limit=None, upper_limit=None, show_axes=False, control=True,
     input=None, output=None, **kwargs
 ):
     """
     Returns the ramp response of a continuous-time system.
 
     Ramp function is defined as the straight line passing through origin
     ($f(x) = mx$). The slope of the ramp function can be varied by the user
@@ -587,20 +631,22 @@
           which will be converted to an object of type
           :py:class:`sympy.physics.control.lti.TransferFunction`.
         * a sequence of LTI systems.
         * a sequence of 2-tuples ``(LTI system, label)``.
         * a dict mapping LTI systems to labels.
     slope : Number, optional
         The slope of the input ramp function. Defaults to 1.
-    lower_limit : Number, optional
-        The lower limit of the plot range. Defaults to 0. If a different value
-        is to be used, also set ``control=False`` (see examples in order to
-        understand why).
-    upper_limit : Number, optional
-        The upper limit of the plot range. Defaults to 10.
+    lower_limit : Number or None, optional
+        The lower time limit of the plot range. Defaults to 0. If a different
+        value  is to be used, also set ``control=False`` (see examples in
+        order to understand why).
+    upper_limit : Number or None, optional
+        The upper time limit of the plot range. If not provided, an
+        appropriate value will be computed. If a interactive widget plot is
+        being created, it defaults to 10.
     prec : int, optional
         The decimal point precision for the point coordinate values.
         Defaults to 8.
     show_axes : boolean, optional
         If ``True``, the coordinate axes will be shown. Defaults to False.
     control : bool
         If True, computes the step response with the ``control``
@@ -702,14 +748,16 @@
 
     References
     ==========
 
     .. [1] https://en.wikipedia.org/wiki/Ramp_function
 
     """
+    upper_limit = _set_upper_limits(
+        systems, upper_limit, is_step=True, **kwargs)
     systems = _unpack_systems(systems, **kwargs)
     series = []
     for s, l in systems:
         kw = kwargs.copy()
         kw["label"] = l
         series.extend(
                 ramp_response(
@@ -1379,16 +1427,23 @@
        plot_root_locus(G, params=params, xlim=(-4, 1))
 
     """
     systems = _unpack_systems(systems)
     kwargs.setdefault("grid", False)
     kwargs.setdefault("xlabel", "Real")
     kwargs.setdefault("ylabel", "Imaginary")
-    rls = [root_locus(s, l, sgrid=False, zgrid=False, **kwargs)[0]
-        for s, l in systems]
+    kwargs.setdefault("title", "Root Locus")
+
+    series = []
+    for s, l in systems:
+        kw = kwargs.copy()
+        kw["label"] = l
+        series.extend(
+            root_locus(s, sgrid=False, zgrid=False, **kw)
+        )
     if sgrid and zgrid:
-        # user has explicetly types zgrid=True. Disable sgrid.
+        # user has explicetly typed zgrid=True. Disable sgrid.
         sgrid = False
     grid = _get_grid_series(sgrid, zgrid)
     if sgrid or zgrid:
         kwargs.setdefault("grid", False)
-    return _create_plot_helper(grid + rls, False, **kwargs)
+    return _create_plot_helper(grid + series, False, **kwargs)
```

### Comparing `sympy_plot_backends-3.2.0/spb/plot_functions/functions_2d.py` & `sympy_plot_backends-3.3.0/spb/plot_functions/functions_2d.py`

 * *Files 3% similar despite different names*

```diff
@@ -292,41 +292,45 @@
     This plot illustrates:
 
     * plotting multiple expressions, each one with its own label and
       rendering options.
     * the use of ``prange`` (parametric plotting range).
     * the use of the ``params`` dictionary to specify sliders in
       their basic form: (default, min, max).
+    * the use of :py:class:`panel.widgets.slider.RangeSlider`, which is a
+      2-values widget. In this case it is used to enforce the condition
+      `f1 < f2`.
     * the use of a parametric title, specified with a tuple of the form:
       ``(title_str, param_symbol1, ...)``, where:
 
       * ``title_str`` must be a formatted string, for example:
         ``"test = {:.2f}"``.
       * ``param_symbol1, ...`` must be a symbol or a symbolic expression
         whose free symbols are contained in the ``params`` dictionary.
 
     .. panel-screenshot::
        :small-size: 800, 625
 
        from sympy import *
        from spb import *
-       x, a, b, c, n = symbols("x, a, b, c, n")
+       import panel as pn
+       x, y, f1, f2, d, n = symbols("x, y, f_1, f_2, d, n")
        plot(
-           (cos(a * x + b) * exp(-c * x), "oscillator"),
-           (exp(-c * x), "upper limit", {"linestyle": ":"}),
-           (-exp(-c * x), "lower limit", {"linestyle": ":"}),
+           (cos(f1 * x) * exp(-d * x), "oscillator 1"),
+           (cos(f2 * x) * exp(-d * x), "oscillator 2"),
+           (exp(-d * x), "upper limit", {"linestyle": ":"}),
+           (-exp(-d * x), "lower limit", {"linestyle": ":"}),
            prange(x, 0, n * pi),
            params={
-               a: (1, 0, 10),     # frequency
-               b: (0, 0, 2 * pi), # phase
-               c: (0.25, 0, 1),   # damping
+               (f1, f2): pn.widgets.RangeSlider(value=(1, 2), start=0, end=10, step=0.1),     # frequency
+               d: (0.25, 0, 1),   # damping
                n: (2, 0, 4)       # multiple of pi
            },
            ylim=(-1.25, 1.25),
-           title=("Frequency = {:.2f} Hz", a)
+           title=("$f_1$ = {:.2f} Hz", f1),
        )
 
     See Also
     ========
 
     plot_implicit, plot_polar, plot_parametric, plot_list, plot_contour,
     plot_geometry, plot_piecewise
@@ -834,24 +838,36 @@
 
     Interactive-widget plot. Refer to the interactive sub-module documentation
     to learn more about the ``params`` dictionary. This plot illustrates:
 
     * the use of ``prange`` (parametric plotting range).
     * the use of the ``params`` dictionary to specify sliders in
       their basic form: (default, min, max).
+    * the use of :py:class:`panel.widgets.slider.RangeSlider`, which is a
+      2-values widget.
 
     .. panel-screenshot::
        :small-size: 800, 600
 
        from sympy import *
        from spb import *
-       x, y, a, b, xp, yp = symbols("x y a b x_p y_p")
+       import panel as pn
+       x, y, a, b = symbols("x y a b")
+       x_min, x_max, y_min, y_max = symbols("x_min x_max y_min y_max")
        expr = (cos(x) + a * sin(x) * sin(y) - b * sin(x) * cos(y))**2
-       plot_contour(expr, prange(x, 0, xp*pi), prange(y, 0, yp * pi),
-           params={a: (1, 0, 2), b: (1, 0, 2), xp: (1, 0, 2), yp: (2, 0, 2)},
+       plot_contour(
+           expr, prange(x, x_min*pi, x_max*pi), prange(y, y_min*pi, y_max*pi),
+           params={
+               a: (1, 0, 2),
+               b: (1, 0, 2),
+               (x_min, x_max): pn.widgets.RangeSlider(
+                   value=(-1, 1), start=-3, end=3, step=0.1),
+               (y_min, y_max): pn.widgets.RangeSlider(
+                   value=(-1, 1), start=-3, end=3, step=0.1),
+           },
            grid=False)
 
     See Also
     ========
 
     plot, plot_implicit, plot_polar, plot_parametric, plot_list, plot3d,
     plot_geometry, plot_piecewise
@@ -1055,29 +1071,34 @@
     Interactive-widget implicit plot. Refer to the interactive sub-module
     documentation to learn more about the ``params`` dictionary.
     This plot illustrates:
 
     * the use of ``prange`` (parametric plotting range).
     * the use of the ``params`` dictionary to specify sliders in
       their basic form: (default, min, max).
+    * the use of :py:class:`panel.widgets.slider.RangeSlider`, which is a
+      2-values widget.
 
     .. panel-screenshot::
        :small-size: 800, 700
 
        from sympy import *
        from spb import *
-       x, y, a, b, c, d, e = symbols("x, y, a, b, c, d, e")
+       import panel as pn
+       x, y, a, b, c, d = symbols("x, y, a, b, c, d")
+       y_min, y_max = symbols("y_min, y_max")
        expr = Eq(a * x**2 - b * x + c, d * y + y**2)
-       plot_implicit(expr, (x, -2, 2), prange(y, -e, e),
+       plot_implicit(expr, (x, -2, 2), prange(y, y_min, y_max),
            params={
                a: (10, -15, 15),
                b: (7, -15, 15),
                c: (3, -15, 15),
                d: (2, -15, 15),
-               e: (10, 1, 15),
+               (y_min, y_max): pn.widgets.RangeSlider(
+                   value=(-10, 10), start=-15, end=15, step=0.1)
            }, n=150, ylim=(-10, 10))
 
     See Also
     ========
 
     plot, plot_polar, plot_parametric, plot_list, plot_contour,
     plot_geometry, plot_piecewise
@@ -1218,29 +1239,29 @@
     * the use of the ``params`` dictionary to specify the widgets to be
       created by Holoviz's Panel.
 
     .. panel-screenshot::
 
        from sympy import *
        from spb import *
-       import param
+       import panel as pn
        a, b, c, d, e, f, theta, tp = symbols("a:f theta tp")
        def func(n):
            t1 = (c + sin(a * theta + d))
            t2 = ((b + sin(b * theta + e)) - (c + sin(a * theta + d)))
            t3 = (f + sin(a * theta + n / pi))
            return t1 + t2 * t3 / 2
        exprs = [func(n) for n in range(20)]
        plot_polar(
            *exprs, prange(theta, 0, tp*pi),
            {"line_color": "black", "line_width": 0.5},
            params={
-               a: param.Integer(6, label="a"),
-               b: param.Integer(12, label="b"),
-               c: param.Integer(18, label="c"),
+               a: pn.widgets.IntInput(value=6, name="a"),
+               b: pn.widgets.IntInput(value=12, name="b"),
+               c: pn.widgets.IntInput(value=18, name="c"),
                d: (4.7, 0, 2*pi),
                e: (1.8, 0, 2*pi),
                f: (3, 0, 5),
                tp: (2, 0, 2)
            },
            layout = "sbl",
            ncols = 1,
@@ -1434,24 +1455,24 @@
     to learn more about the ``params`` dictionary.
 
     .. panel-screenshot::
        :small-size: 800, 625
 
        from sympy import *
        from spb import *
-       import param
+       import panel as pn
        a, b, c, d = symbols("a, b, c, d")
        plot_geometry(
            (Polygon((a, b), c, n=d), "a"),
            (Polygon((a + 2, b + 3), c, n=d + 1), "b"),
            params = {
                a: (0, -1, 1),
                b: (1, -1, 1),
                c: (2, 1, 2),
-               d: param.Integer(3, softbounds=(3, 8), label="n")
+               d: pn.widgets.IntInput(value=3, start=3, end=8, name="n")
            },
            aspect="equal", is_filled=False,
            xlim=(-2.5, 5.5), ylim=(-3, 6.5), imodule="panel")
 
     See Also
     ========
```

### Comparing `sympy_plot_backends-3.2.0/spb/plot_functions/functions_3d.py` & `sympy_plot_backends-3.3.0/spb/plot_functions/functions_3d.py`

 * *Files 2% similar despite different names*

```diff
@@ -362,28 +362,33 @@
 
     Interactive-widget plot. Refer to the interactive sub-module documentation
     to learn more about the ``params`` dictionary. This plot illustrates:
 
     * the use of ``prange`` (parametric plotting range).
     * the use of the ``params`` dictionary to specify sliders in
       their basic form: (default, min, max).
+    * the use of :py:class:`panel.widgets.slider.RangeSlider`, which is a
+      2-values widget.
 
     .. panel-screenshot::
        :small-size: 800, 600
 
        from sympy import *
        from spb import *
-       x, y, a, b, d = symbols("x y a b d")
+       import panel as pn
+       x, y, a, b, c, d, e = symbols("x y a b c d e")
        plot3d(
-           cos(x**2 + y**2) * exp(-(x**2 + y**2) * d),
-           prange(x, -2*a, 2*a), prange(y, -2*b, 2*b),
+           cos(x**2 + y**2) * exp(-(x**2 + y**2) * a),
+           prange(x, b, c), prange(y, d, e),
            params={
-               a: (1, 0, 3),
-               b: (1, 0, 3),
-               d: (0.25, 0, 1),
+               a: (0.25, 0, 1),
+               (b, c): pn.widgets.RangeSlider(
+                   value=(-2, 2), start=-4, end=4, step=0.1),
+               (d, e): pn.widgets.RangeSlider(
+                   value=(-2, 2), start=-4, end=4, step=0.1),
            },
            backend=PB, use_cm=True, n=100, aspect=dict(x=1.5, y=1.5, z=0.75),
            wireframe=True, wf_n1=15, wf_n2=15, throttled=True)
 
     See Also
     ========
 
@@ -569,23 +574,23 @@
     to learn more about the ``params`` dictionary. Note that the plot's
     creation might be slow due to the wireframe lines.
 
     .. panel-screenshot::
 
        from sympy import *
        from spb import *
-       import param
+       import panel as pn
        n, u, v = symbols("n, u, v")
        x = v * cos(u)
        y = v * sin(u)
        z = sin(n * u)
        plot3d_parametric_surface(
            (x, y, z, (u, 0, 2*pi), (v, -1, 0)),
            params = {
-               n: param.Integer(3, label="n")
+               n: pn.widgets.IntInput(value=3, name="n")
            },
            backend=KB,
            use_cm=True,
            title=r"Plücker's \, conoid",
            wireframe=True,
            wf_rendering_kw={"width": 0.004},
            wf_n1=75, wf_n2=6, imodule="panel"
@@ -727,23 +732,23 @@
     Refer to the interactive sub-module documentation to learn more about the
     ``params`` dictionary.
 
     .. panel-screenshot::
 
        from sympy import *
        from spb import *
-       import param
+       import panel as pn
        n, m = symbols("n, m")
        phi, theta = symbols("phi, theta", real=True)
        r = re(Ynm(n, m, theta, phi).expand(func=True).rewrite(sin).expand())
        plot3d_spherical(
            abs(r), (theta, 0, pi), (phi, 0, 2*pi),
            params = {
-               n: param.Integer(2, label="n"),
-               m: param.Integer(0, label="m"),
+               n: pn.widgets.IntInput(value=2, name="n"),
+               m: pn.widgets.IntInput(value=0, name="m"),
            },
            force_real_eval=True,
            use_cm=True, color_func=r,
            backend=KB, imodule="panel")
 
     See Also
     ========
```

### Comparing `sympy_plot_backends-3.2.0/spb/plot_functions/vectors.py` & `sympy_plot_backends-3.3.0/spb/plot_functions/vectors.py`

 * *Files 2% similar despite different names*

```diff
@@ -193,31 +193,38 @@
     sub-module documentation to learn more about the ``params`` dictionary.
     This plot illustrates:
 
     * customizing the appearance of quivers and countour.
     * the use of ``prange`` (parametric plotting range).
     * the use of the ``params`` dictionary to specify sliders in
       their basic form: (default, min, max).
+    * the use of :py:class:`panel.widgets.slider.RangeSlider`, which is a
+      2-values widget.
 
     .. panel-screenshot::
        :small-size: 800, 610
 
        from sympy import *
        from spb import *
-       x, y, a, b, c, d = symbols("x, y, a, b, c, d")
+       import panel as pn
+       x, y, a, b, c, d, e = symbols("x, y, a, b, c, d, e")
        v = [-sin(a * y), cos(b * x)]
        plot_vector(
-           v, prange(x, -3*c, 3*c), prange(y, -3*d, 3*d),
+           v, prange(x, -3*c, 3*c), prange(y, d, e),
            params={
                a: (1, -2, 2), b: (1, -2, 2),
-               c: (1, 0, 2), d: (1, 0, 2),
+               c: (1, 0, 2),
+               (d, e): pn.widgets.RangeSlider(
+                   value=(-3, 3), start=-9, end=9, step=0.1)
            },
            quiver_kw=dict(color="black", scale=30, headwidth=5),
            contour_kw={"cmap": "Blues_r", "levels": 15},
-           grid=False, xlabel="x", ylabel="y")
+           grid=False, xlabel="x", ylabel="y",
+           imodule="panel", servable=True
+       )
 
     3D vector field.
 
     .. k3d-screenshot::
 
        from sympy import *
        from spb import *
```

### Comparing `sympy_plot_backends-3.2.0/spb/plotgrid.py` & `sympy_plot_backends-3.3.0/spb/plotgrid.py`

 * *Files 1% similar despite different names*

```diff
@@ -55,25 +55,14 @@
         catch=(RuntimeError,))
     mpl_toolkits = import_module(
         'mpl_toolkits',
         import_kwargs={'fromlist': ['axes_grid1']},
         catch=(RuntimeError,))
     plt = matplotlib.pyplot
 
-    def get_fig_panes_plots(fig):
-        panes_plots = {}
-        if is_iplot_panel:
-            pn = import_module(
-                'panel',
-                min_module_version='0.12.0')
-            pane = pn.pane.Matplotlib(fig, dpi=96)
-            panes_plots[pane] = fig
-            return pane, panes_plots
-        return fig, panes_plots
-
     kw = {} if not size else {"figsize": size}
     if is_iplot_panel:
         fig = matplotlib.figure.Figure(**kw)
     else:
         fig = plt.figure(**kw)
 
     new_plots = []
@@ -96,16 +85,15 @@
             cpa = p._copy_kwargs()
             cpa["fig"] = fig
             cpa["ax"] = ax
             cpa["imagegrid"] = True
             p = MB(*p.series, **cpa)
             p.draw()
             new_plots.append(p)
-        fig, panes_plots = get_fig_panes_plots(fig)
-        return fig, new_plots, panes_plots
+        return fig, new_plots
 
     for spec, p in mapping.items():
         if isinstance(p, IPlot):
             p = p.backend
         kw = {"projection": "3d"} if (len(p.series) > 0 and
             p.series[0].is_3D) else ({"projection": "polar"} if p.polar_axis
             else {})
@@ -115,43 +103,15 @@
         cpa["fig"] = fig
         cpa["ax"] = cur_ax
         p = MB(*p.series, **cpa)
         p.draw()
         new_plots.append(p)
 
     fig.tight_layout()
-    fig, panes_plots = get_fig_panes_plots(fig)
-    return fig, new_plots, panes_plots
-
-
-def _create_panel_figure(mapping, panel_kw):
-    pn = import_module(
-        'panel',
-        min_module_version='0.12.0')
-    pn.extension("plotly")
-
-    panes_plots = {}
-    fig = pn.GridSpec(**panel_kw)
-    for spec, p in mapping.items():
-        rs = spec.rowspan
-        cs = spec.colspan
-        if isinstance(p, IPlot):
-            # a panel's `pane` must receive a figure of some kind, not another
-            # panel's object, otherwise there will be performance penalty,
-            # especially noticeable with Plotly and Bokeh
-            p = p.backend
-        _fig = p.fig
-        if isinstance(p, PB):
-            pane = pn.pane.Plotly(_fig.to_dict())
-            fig[slice(rs.start, rs.stop), slice(cs.start, cs.stop)] = pane
-        else:
-            pane = pn.pane.panel(_fig)
-            fig[slice(rs.start, rs.stop), slice(cs.start, cs.stop)] = pane
-        panes_plots[pane] = p
-    return fig, panes_plots
+    return fig, new_plots
 
 
 def _create_ipywidgets_figure(mapping, panel_kw):
     ipy = import_module('ipywidgets')
     plotly = import_module(
         'plotly',
         import_kwargs={'fromlist': ['graph_objects']},
@@ -211,15 +171,14 @@
 def _get_all_parameters(plots):
     """Loop over the provided plots and extract the original parameters.
     """
     all_parameters, all_plots = {}, []
     for plot in plots:
         if isinstance(plot, IPlot):
             all_plots.append(plot.backend)
-            # all_plots.append(plot)
             all_parameters.update(plot._original_params)
         else:
             all_plots.append(plot)
 
     return all_parameters, all_plots
 
 
@@ -484,14 +443,17 @@
         self._bokeh_outputs_plots = []
         # the following is used when imodule="panel". It maps plots to panes,
         # so that panel can update what is shown on the pane after the plots
         # have updated their data.
         self._panes_plots = {}
         self._is_iplot = kwargs.get("is_iplot", False)
         self._imodule = kwargs.get("imodule", cfg["interactive"]["module"])
+        # those are set by spb.interactive.panel, they allow binding widgets
+        # to appropriate update functions.
+        self._params_symbols, self._params_widgets = None, None
 
         # validate GridSpec, if provided
         self.gs = kwargs.get("gs", None)
         if self.gs:
             _check_gs(self.gs)
             self.is_matplotlib_fig = _are_all_plots_instances_of(
                 self.gs.values(), MB)
@@ -569,31 +531,31 @@
             for i in range(nr):
                 for j in range(nc):
                     if c < len(self.args):
                         mapping[gs[i, j]] = self.args[c]
                     c += 1
 
             if self.is_matplotlib_fig:
-                self._fig, self._new_plots, self._panes_plots = _create_mpl_figure(
+                self._fig, self._new_plots = _create_mpl_figure(
                     mapping, self.imagegrid, self.size, is_iplot_panel)
             else:
                 size = self.size
 
                 # NOTE: assumimg all plots are of the same backend
                 self._new_plots = self.args
 
                 if self._imodule == "panel":
                     self.panel_kw.setdefault(
                         "width", 800 if not size else size[0])
                     self.panel_kw.setdefault(
                         "height",
                         nr * self._panel_row_height if not size else size[1]
                     )
-                    self._fig, self._panes_plots = _create_panel_figure(
-                        mapping, self.panel_kw)
+                    self._fig, self._panes_plots = self._create_panel_figure(
+                        mapping)
                 else:
                     get_size = lambda t: str(t) + "px" if isinstance(t, int) else t
                     self.panel_kw.setdefault("width", "800px" if not size else get_size(size[0]))
                     if not self.is_bokeh_fig:
                         # NOTE: this doesn't work well with bokeh
                         self.panel_kw.setdefault("height",
                             str(nr * self._panel_row_height) + "px" if not size else get_size(size[1]))
@@ -601,48 +563,93 @@
                     self.panel_kw["n_columns"] = nc
                     self._fig, self._bokeh_outputs_plots = _create_ipywidgets_figure(
                         mapping, self.panel_kw)
 
         else:
             # Second mode of operation
             if self.is_matplotlib_fig:
-                self._fig, self._new_plots, self._panes_plots = _create_mpl_figure(
+                self._fig, self._new_plots = _create_mpl_figure(
                     gs, self.imagegrid, self.size, is_iplot_panel)
             else:
                 for plot in gs.values():
                     if isinstance(plot, IPlot):
                         self._new_plots.append(plot.backend)
                     else:
                         self._new_plots.append(plot)
 
                 if self._imodule == "panel":
-                    self._fig, self._panes_plots = _create_panel_figure(
-                        gs, self.panel_kw)
+                    self._fig, self._panes_plots = self._create_panel_figure(
+                        gs)
                 else:
                     first_element = list(gs.keys())[0]
                     mpl_gs = first_element.get_gridspec()
                     self.panel_kw = {
                         "n_rows": mpl_gs.nrows, "n_columns": mpl_gs.ncols}
                     self._fig, self._bokeh_outputs_plots = _create_ipywidgets_figure(
                         gs, self.panel_kw)
 
-    def _action_post_update(self):
-        """With Holoviz's Panel, plots are contained into `panes`: they are
-        ultimately responsible to update what is shown on the screen.
-        This method is executed by the interactive widget plot after all
-        subplots have updated their data.
-        """
-        for pane, plot in self._panes_plots.items():
-            pane.param.trigger("object")
-            if isinstance(plot, PB):
-                pane.object = plot.fig.to_dict()
-            elif isinstance(plot, self.matplotlib.figure.Figure):
-                pane.object = plot
+
+    def _create_panel_figure(self, mapping):
+        pn = import_module(
+            'panel',
+            min_module_version='0.12.0')
+        pn.extension("plotly")
+
+        panes_plots = {}
+        fig = pn.GridSpec(**self.panel_kw)
+        create_binding = self._params_symbols is not None
+        for i, (spec, p) in enumerate(mapping.items()):
+            rs = spec.rowspan
+            cs = spec.colspan
+            if isinstance(p, IPlot):
+                # a panel's `pane` must receive a figure of some kind, not another
+                # panel's object, otherwise there will be performance penalty,
+                # especially noticeable with Plotly and Bokeh
+                p = p.backend
+            _fig = p.fig
+            if isinstance(p, PB):
+                pane = pn.pane.Plotly(
+                    _fig.to_dict() if not create_binding else
+                    pn.bind(self._update_plotly, p, *self._params_widgets)
+                )
+            elif isinstance(p, MB):
+                pane = pn.pane.Matplotlib(
+                    _fig if not create_binding else
+                    pn.bind(self._update_plot, p, *self._params_widgets)
+                )
+            elif isinstance(p, BB):
+                pane = pn.pane.Bokeh(
+                    _fig if not create_binding else
+                    pn.bind(self._update_plot, p, *self._params_widgets)
+                )
             else:
-                pane.object = plot.fig
+                pane = pn.pane.panel(
+                    _fig if not create_binding else
+                    pn.bind(self._update_plot, p, *self._params_widgets)
+                )
+            fig[slice(rs.start, rs.stop), slice(cs.start, cs.stop)] = pane
+            panes_plots[pane] = p
+        return fig, panes_plots
+
+    def pre_set_bindings(self, symbols, widgets):
+        """Set the necessary data to create bindings for interactive widgets
+        plots with panel.
+        """
+        self._params_symbols = symbols
+        self._params_widgets = widgets
+
+    def _update_plot(self, p, *values):
+        d = {symb: v for symb, v in zip(self._params_symbols, values)}
+        p.update_interactive(d)
+        return p.fig
+
+    def _update_plotly(self, p, *values):
+        d = {symb: v for symb, v in zip(self._params_symbols, values)}
+        p.update_interactive(d)
+        return p.fig.to_dict()
 
     def update_interactive(self, params):
         """Implement the logic to update the data generated by
         interactive-widget plots.
 
         Parameters
         ==========
```

### Comparing `sympy_plot_backends-3.2.0/spb/series.py` & `sympy_plot_backends-3.3.0/spb/series.py`

 * *Files 1% similar despite different names*

```diff
@@ -876,10642 +876,10613 @@
 000036b0: 2020 2020 2020 2020 2020 2020 6b77 6172              kwar
 000036c0: 6773 2e67 6574 2822 7973 6361 6c65 222c  gs.get("yscale",
 000036d0: 2022 6c69 6e65 6172 2229 2c0a 2020 2020   "linear"),.    
 000036e0: 2020 2020 2020 2020 6b77 6172 6773 2e67          kwargs.g
 000036f0: 6574 2822 7a73 6361 6c65 222c 2022 6c69  et("zscale", "li
 00003700: 6e65 6172 2229 0a20 2020 2020 2020 205d  near").        ]
 00003710: 0a0a 2020 2020 2020 2020 7365 6c66 2e5f  ..        self._
-00003720: 7061 7261 6d73 203d 206b 7761 7267 732e  params = kwargs.
-00003730: 6765 7428 2270 6172 616d 7322 2c20 6469  get("params", di
-00003740: 6374 2829 290a 2020 2020 2020 2020 6966  ct()).        if
-00003750: 206e 6f74 2069 7369 6e73 7461 6e63 6528   not isinstance(
-00003760: 7365 6c66 2e5f 7061 7261 6d73 2c20 6469  self._params, di
-00003770: 6374 293a 0a20 2020 2020 2020 2020 2020  ct):.           
-00003780: 2072 6169 7365 2054 7970 6545 7272 6f72   raise TypeError
-00003790: 280a 2020 2020 2020 2020 2020 2020 2020  (.              
-000037a0: 2020 2260 7061 7261 6d73 6020 6d75 7374    "`params` must
-000037b0: 2062 6520 6120 6469 6374 696f 6e61 7279   be a dictionary
-000037c0: 206d 6170 7069 6e67 2073 796d 626f 6c73   mapping symbols
-000037d0: 2022 0a20 2020 2020 2020 2020 2020 2020   ".             
-000037e0: 2020 2022 746f 206e 756d 6572 6963 2076     "to numeric v
-000037f0: 616c 7565 732e 2229 0a20 2020 2020 2020  alues.").       
-00003800: 2069 6620 6c65 6e28 7365 6c66 2e5f 7061   if len(self._pa
-00003810: 7261 6d73 2920 3e20 303a 0a20 2020 2020  rams) > 0:.     
-00003820: 2020 2020 2020 2073 656c 662e 6973 5f69         self.is_i
-00003830: 6e74 6572 6163 7469 7665 203d 2054 7275  nteractive = Tru
-00003840: 650a 0a20 2020 2020 2020 2073 656c 662e  e..        self.
-00003850: 7265 6e64 6572 696e 675f 6b77 203d 206b  rendering_kw = k
-00003860: 7761 7267 732e 6765 7428 2272 656e 6465  wargs.get("rende
-00003870: 7269 6e67 5f6b 7722 2c20 6469 6374 2829  ring_kw", dict()
-00003880: 290a 0a20 2020 2020 2020 2023 206e 756d  )..        # num
-00003890: 6572 6963 616c 2074 7261 6e73 666f 726d  erical transform
-000038a0: 6174 696f 6e20 6675 6e63 7469 6f6e 7320  ation functions 
-000038b0: 746f 2062 6520 6170 706c 6965 6420 746f  to be applied to
-000038c0: 2074 6865 206f 7574 7075 7420 6461 7461   the output data
-000038d0: 0a20 2020 2020 2020 2073 656c 662e 5f74  .        self._t
-000038e0: 7820 3d20 6b77 6172 6773 2e67 6574 2822  x = kwargs.get("
-000038f0: 7478 222c 204e 6f6e 6529 0a20 2020 2020  tx", None).     
-00003900: 2020 2073 656c 662e 5f74 7920 3d20 6b77     self._ty = kw
-00003910: 6172 6773 2e67 6574 2822 7479 222c 204e  args.get("ty", N
-00003920: 6f6e 6529 0a20 2020 2020 2020 2073 656c  one).        sel
-00003930: 662e 5f74 7a20 3d20 6b77 6172 6773 2e67  f._tz = kwargs.g
-00003940: 6574 2822 747a 222c 204e 6f6e 6529 0a20  et("tz", None). 
-00003950: 2020 2020 2020 2073 656c 662e 5f74 7020         self._tp 
-00003960: 3d20 6b77 6172 6773 2e67 6574 2822 7470  = kwargs.get("tp
-00003970: 222c 204e 6f6e 6529 0a20 2020 2020 2020  ", None).       
-00003980: 2069 6620 6e6f 7420 616c 6c28 0a20 2020   if not all(.   
-00003990: 2020 2020 2020 2020 2063 616c 6c61 626c           callabl
-000039a0: 6528 7429 206f 7220 2874 2069 7320 4e6f  e(t) or (t is No
-000039b0: 6e65 2920 666f 7220 7420 696e 0a20 2020  ne) for t in.   
-000039c0: 2020 2020 2020 2020 205b 7365 6c66 2e5f           [self._
-000039d0: 7478 2c20 7365 6c66 2e5f 7479 2c20 7365  tx, self._ty, se
-000039e0: 6c66 2e5f 747a 2c20 7365 6c66 2e5f 7470  lf._tz, self._tp
-000039f0: 5d0a 2020 2020 2020 2020 293a 0a20 2020  ].        ):.   
-00003a00: 2020 2020 2020 2020 2072 6169 7365 2054           raise T
-00003a10: 7970 6545 7272 6f72 2822 6074 7860 2c20  ypeError("`tx`, 
-00003a20: 6074 7960 2c20 6074 7a60 2c20 6074 7060  `ty`, `tz`, `tp`
-00003a30: 206d 7573 7420 6265 2066 756e 6374 696f   must be functio
-00003a40: 6e73 2e22 290a 0a20 2020 2020 2020 2023  ns.")..        #
-00003a50: 2077 6865 7468 6572 2074 6865 2073 6572   whether the ser
-00003a60: 6965 7320 636f 6e74 6169 6e73 2061 6e79  ies contains any
-00003a70: 2069 6e74 6572 6163 7469 7665 2072 616e   interactive ran
-00003a80: 6765 0a20 2020 2020 2020 2073 656c 662e  ge.        self.
-00003a90: 5f69 6e74 6572 6163 7469 7665 5f72 616e  _interactive_ran
-00003aa0: 6765 7320 3d20 4661 6c73 650a 2020 2020  ges = False.    
-00003ab0: 2020 2020 2320 7768 6574 6865 7220 736f      # whether so
-00003ac0: 6d65 2063 6f6c 6f72 2066 756e 6374 696f  me color functio
-00003ad0: 6e20 7368 6f75 6c64 2062 6520 6170 706c  n should be appl
-00003ae0: 6965 6420 746f 2074 6865 206e 756d 6572  ied to the numer
-00003af0: 6963 616c 2064 6174 610a 2020 2020 2020  ical data.      
-00003b00: 2020 7365 6c66 2e63 6f6c 6f72 5f66 756e    self.color_fun
-00003b10: 6320 3d20 6b77 6172 6773 2e67 6574 2822  c = kwargs.get("
-00003b20: 636f 6c6f 725f 6675 6e63 222c 204e 6f6e  color_func", Non
-00003b30: 6529 0a20 2020 2020 2020 2023 204e 4f54  e).        # NOT
-00003b40: 453a 2063 6f6c 6f72 5f66 756e 6320 7573  E: color_func us
-00003b50: 7561 6c6c 7920 7265 6365 6976 6573 206e  ually receives n
-00003b60: 756d 6572 6963 616c 2066 756e 6374 696f  umerical functio
-00003b70: 6e73 2074 6861 7420 6172 6520 676f 696e  ns that are goin
-00003b80: 670a 2020 2020 2020 2020 2320 746f 2062  g.        # to b
-00003b90: 6520 6576 616c 7561 7465 6420 6f76 6572  e evaluated over
-00003ba0: 2074 6865 2063 6f6f 7264 696e 6174 6573   the coordinates
-00003bb0: 206f 6620 7468 6520 636f 6d70 7574 6564   of the computed
-00003bc0: 2070 6f69 6e74 7320 286f 7220 7468 650a   points (or the.
-00003bd0: 2020 2020 2020 2020 2320 6469 7363 7265          # discre
-00003be0: 7469 7a65 6420 6d65 7368 6573 292e 0a20  tized meshes).. 
-00003bf0: 2020 2020 2020 2023 2048 6f77 6576 6572         # However
-00003c00: 2c20 6966 2061 6e20 6578 7072 6573 7369  , if an expressi
-00003c10: 6f6e 2069 7320 6769 7665 6e20 746f 2063  on is given to c
-00003c20: 6f6c 6f72 5f66 756e 632c 2074 6865 6e20  olor_func, then 
-00003c30: 6974 2077 696c 6c20 6265 0a20 2020 2020  it will be.     
-00003c40: 2020 2023 206c 616d 6264 6966 6965 6420     # lambdified 
-00003c50: 7769 7468 2073 796d 626f 6c73 2069 6e20  with symbols in 
-00003c60: 7365 6c66 2e5f 7369 676e 6174 7572 652c  self._signature,
-00003c70: 2061 6e64 2069 7420 7769 6c6c 2062 6520   and it will be 
-00003c80: 6576 616c 7561 7465 640a 2020 2020 2020  evaluated.      
-00003c90: 2020 2320 7769 7468 2074 6865 2073 616d    # with the sam
-00003ca0: 6520 6461 7461 2075 7365 6420 746f 2065  e data used to e
-00003cb0: 7661 6c75 6174 6520 7468 6520 706c 6f74  valuate the plot
-00003cc0: 7465 6420 6578 7072 6573 7369 6f6e 2e0a  ted expression..
-00003cd0: 2020 2020 2020 2020 7365 6c66 2e5f 6576          self._ev
-00003ce0: 616c 5f63 6f6c 6f72 5f66 756e 635f 7769  al_color_func_wi
-00003cf0: 7468 5f73 6967 6e61 7475 7265 203d 2046  th_signature = F
-00003d00: 616c 7365 0a0a 2020 2020 6465 6620 5f62  alse..    def _b
-00003d10: 6c6f 636b 5f6c 616d 6264 615f 6675 6e63  lock_lambda_func
-00003d20: 7469 6f6e 7328 7365 6c66 2c20 2a65 7870  tions(self, *exp
-00003d30: 7273 293a 0a20 2020 2020 2020 2069 6620  rs):.        if 
-00003d40: 616e 7928 6361 6c6c 6162 6c65 2865 2920  any(callable(e) 
-00003d50: 666f 7220 6520 696e 2065 7870 7273 293a  for e in exprs):
-00003d60: 0a20 2020 2020 2020 2020 2020 2072 6169  .            rai
-00003d70: 7365 2054 7970 6545 7272 6f72 2874 7970  se TypeError(typ
-00003d80: 6528 7365 6c66 292e 5f5f 6e61 6d65 5f5f  e(self).__name__
-00003d90: 202b 2022 2072 6571 7569 7265 7320 6120   + " requires a 
-00003da0: 7379 6d62 6f6c 6963 2022 0a20 2020 2020  symbolic ".     
-00003db0: 2020 2020 2020 2020 2020 2022 6578 7072             "expr
-00003dc0: 6573 7369 6f6e 2e22 290a 0a20 2020 2064  ession.")..    d
-00003dd0: 6566 205f 6368 6563 6b5f 6673 2873 656c  ef _check_fs(sel
-00003de0: 6629 3a0a 2020 2020 2020 2020 2222 2220  f):.        """ 
-00003df0: 4368 6563 6b73 2069 6620 7468 6572 6520  Checks if there 
-00003e00: 6172 6520 656e 6f67 6820 7061 7261 6d65  are enogh parame
-00003e10: 7465 7273 2061 6e64 2066 7265 6520 7379  ters and free sy
-00003e20: 6d62 6f6c 732e 0a20 2020 2020 2020 2022  mbols..        "
-00003e30: 2222 0a20 2020 2020 2020 2065 7870 7273  "".        exprs
-00003e40: 2c20 7261 6e67 6573 203d 2073 656c 662e  , ranges = self.
-00003e50: 6578 7072 2c20 7365 6c66 2e72 616e 6765  expr, self.range
-00003e60: 730a 2020 2020 2020 2020 7061 7261 6d73  s.        params
-00003e70: 2c20 6c61 6265 6c20 3d20 7365 6c66 2e70  , label = self.p
-00003e80: 6172 616d 732c 2073 656c 662e 6c61 6265  arams, self.labe
-00003e90: 6c0a 2020 2020 2020 2020 6578 7072 7320  l.        exprs 
-00003ea0: 3d20 6578 7072 7320 6966 2068 6173 6174  = exprs if hasat
-00003eb0: 7472 2865 7870 7273 2c20 225f 5f69 7465  tr(exprs, "__ite
-00003ec0: 725f 5f22 2920 656c 7365 205b 6578 7072  r__") else [expr
-00003ed0: 735d 0a20 2020 2020 2020 2069 6620 616e  s].        if an
-00003ee0: 7928 6361 6c6c 6162 6c65 2865 2920 666f  y(callable(e) fo
-00003ef0: 7220 6520 696e 2065 7870 7273 293a 0a20  r e in exprs):. 
-00003f00: 2020 2020 2020 2020 2020 2072 6574 7572             retur
-00003f10: 6e0a 0a20 2020 2020 2020 2023 2066 726f  n..        # fro
-00003f20: 6d20 7468 6520 6578 7072 6573 7369 6f6e  m the expression
-00003f30: 2773 2066 7265 6520 7379 6d62 6f6c 732c  's free symbols,
-00003f40: 2072 656d 6f76 6520 7468 6520 6f6e 6573   remove the ones
-00003f50: 2075 7365 6420 696e 0a20 2020 2020 2020   used in.       
-00003f60: 2023 2074 6865 2070 6172 616d 6574 6572   # the parameter
-00003f70: 7320 616e 6420 7468 6520 7261 6e67 6573  s and the ranges
-00003f80: 0a20 2020 2020 2020 2066 7320 3d20 5f67  .        fs = _g
-00003f90: 6574 5f66 7265 655f 7379 6d62 6f6c 7328  et_free_symbols(
-00003fa0: 6578 7072 7329 0a20 2020 2020 2020 2066  exprs).        f
-00003fb0: 7320 3d20 6673 2e64 6966 6665 7265 6e63  s = fs.differenc
-00003fc0: 6528 7061 7261 6d73 2e6b 6579 7328 2929  e(params.keys())
-00003fd0: 0a20 2020 2020 2020 2069 6620 7261 6e67  .        if rang
-00003fe0: 6573 2069 7320 6e6f 7420 4e6f 6e65 3a0a  es is not None:.
-00003ff0: 2020 2020 2020 2020 2020 2020 6673 203d              fs =
-00004000: 2066 732e 6469 6666 6572 656e 6365 285b   fs.difference([
-00004010: 725b 305d 2066 6f72 2072 2069 6e20 7261  r[0] for r in ra
-00004020: 6e67 6573 5d29 0a0a 2020 2020 2020 2020  nges])..        
-00004030: 6966 206c 656e 2866 7329 203e 2030 3a0a  if len(fs) > 0:.
-00004040: 2020 2020 2020 2020 2020 2020 6966 2028              if (
-00004050: 7261 6e67 6573 2069 7320 6e6f 7420 4e6f  ranges is not No
-00004060: 6e65 2920 616e 6420 6c65 6e28 7261 6e67  ne) and len(rang
-00004070: 6573 2920 3e20 303a 0a20 2020 2020 2020  es) > 0:.       
-00004080: 2020 2020 2020 2020 2065 726c 203d 2022           erl = "
-00004090: 4578 7072 6573 7369 6f6e 3a20 2573 5c6e  Expression: %s\n
-000040a0: 5261 6e67 6573 3a20 2573 5c6e 4c61 6265  Ranges: %s\nLabe
-000040b0: 6c3a 2025 735c 6e22 2025 2028 0a20 2020  l: %s\n" % (.   
-000040c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000040d0: 2065 7870 7273 2c20 7261 6e67 6573 2c20   exprs, ranges, 
-000040e0: 6c61 6265 6c29 0a20 2020 2020 2020 2020  label).         
-000040f0: 2020 2065 6c73 653a 0a20 2020 2020 2020     else:.       
-00004100: 2020 2020 2020 2020 2065 726c 203d 2022           erl = "
-00004110: 4578 7072 6573 7369 6f6e 3a20 2573 5c6e  Expression: %s\n
-00004120: 4c61 6265 6c3a 2025 735c 6e22 2025 2028  Label: %s\n" % (
-00004130: 6578 7072 732c 206c 6162 656c 290a 2020  exprs, label).  
-00004140: 2020 2020 2020 2020 2020 7261 6973 6520            raise 
-00004150: 5661 6c75 6545 7272 6f72 280a 2020 2020  ValueError(.    
-00004160: 2020 2020 2020 2020 2020 2020 2249 6e63              "Inc
-00004170: 6f6d 7061 7469 626c 6520 6578 7072 6573  ompatible expres
-00004180: 7369 6f6e 2061 6e64 2070 6172 616d 6574  sion and paramet
-00004190: 6572 732e 5c6e 2573 220a 2020 2020 2020  ers.\n%s".      
-000041a0: 2020 2020 2020 2020 2020 2270 6172 616d            "param
-000041b0: 733a 2025 735c 6e22 0a20 2020 2020 2020  s: %s\n".       
-000041c0: 2020 2020 2020 2020 2022 5370 6563 6966           "Specif
-000041d0: 7920 7768 6174 2074 6865 7365 2073 796d  y what these sym
-000041e0: 626f 6c73 2072 6570 7265 7365 6e74 3a20  bols represent: 
-000041f0: 2573 5c6e 220a 2020 2020 2020 2020 2020  %s\n".          
-00004200: 2020 2020 2020 2241 7265 2074 6865 7920        "Are they 
-00004210: 7261 6e67 6573 206f 7220 7061 7261 6d65  ranges or parame
-00004220: 7465 7273 3f22 2025 2028 6572 6c2c 2070  ters?" % (erl, p
-00004230: 6172 616d 732c 2066 7329 0a20 2020 2020  arams, fs).     
-00004240: 2020 2020 2020 2029 0a0a 2020 2020 2020         )..      
-00004250: 2020 2320 7665 7269 6679 2074 6861 7420    # verify that 
-00004260: 616c 6c20 7379 6d62 6f6c 7320 6172 6520  all symbols are 
-00004270: 6b6e 6f77 6e20 2874 6865 7920 6569 7468  known (they eith
-00004280: 6572 2072 6570 7265 7365 6e74 2070 6c6f  er represent plo
-00004290: 7474 696e 670a 2020 2020 2020 2020 2320  tting.        # 
-000042a0: 7261 6e67 6573 206f 7220 7061 7261 6d65  ranges or parame
-000042b0: 7465 7273 290a 2020 2020 2020 2020 7261  ters).        ra
-000042c0: 6e67 655f 7379 6d62 6f6c 7320 3d20 5b72  nge_symbols = [r
-000042d0: 5b30 5d20 666f 7220 7220 696e 2072 616e  [0] for r in ran
-000042e0: 6765 735d 0a20 2020 2020 2020 2066 6f72  ges].        for
-000042f0: 2072 2069 6e20 7261 6e67 6573 3a0a 2020   r in ranges:.  
-00004300: 2020 2020 2020 2020 2020 6673 203d 2073            fs = s
-00004310: 6574 2829 2e75 6e69 6f6e 282a 5b65 2e66  et().union(*[e.f
-00004320: 7265 655f 7379 6d62 6f6c 7320 666f 7220  ree_symbols for 
-00004330: 6520 696e 2072 5b31 3a5d 5d29 0a20 2020  e in r[1:]]).   
-00004340: 2020 2020 2020 2020 2069 6620 616e 7928           if any(
-00004350: 7420 696e 2066 7320 666f 7220 7420 696e  t in fs for t in
-00004360: 2072 616e 6765 5f73 796d 626f 6c73 293a   range_symbols):
-00004370: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00004380: 2072 6169 7365 2056 616c 7565 4572 726f   raise ValueErro
-00004390: 7228 2252 616e 6765 2073 796d 626f 6c73  r("Range symbols
-000043a0: 2063 616e 2774 2062 6520 696e 636c 7564   can't be includ
-000043b0: 6564 2069 6e74 6f20 220a 2020 2020 2020  ed into ".      
-000043c0: 2020 2020 2020 2020 2020 2020 2020 226d                "m
-000043d0: 696e 696d 756d 2061 6e64 206d 6178 696d  inimum and maxim
-000043e0: 756d 206f 6620 6120 7261 6e67 652e 2022  um of a range. "
-000043f0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00004400: 2020 2020 2022 5265 6365 6976 6564 2072       "Received r
-00004410: 616e 6765 3a20 2573 2220 2520 7374 7228  ange: %s" % str(
-00004420: 7229 290a 2020 2020 2020 2020 2020 2020  r)).            
-00004430: 7265 6d61 696e 696e 675f 6673 203d 2066  remaining_fs = f
-00004440: 732e 6469 6666 6572 656e 6365 2870 6172  s.difference(par
-00004450: 616d 732e 6b65 7973 2829 290a 2020 2020  ams.keys()).    
-00004460: 2020 2020 2020 2020 6966 206c 656e 2872          if len(r
-00004470: 656d 6169 6e69 6e67 5f66 7329 203e 2030  emaining_fs) > 0
-00004480: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-00004490: 2020 7261 6973 6520 5661 6c75 6545 7272    raise ValueErr
-000044a0: 6f72 280a 2020 2020 2020 2020 2020 2020  or(.            
-000044b0: 2020 2020 2020 2020 2255 6e6b 6f77 6e20          "Unkown 
-000044c0: 7379 6d62 6f6c 7320 666f 756e 6420 696e  symbols found in
-000044d0: 2070 6c6f 7474 696e 6720 7261 6e67 653a   plotting range:
-000044e0: 2025 732e 2022 2025 2028 722c 2920 2b0a   %s. " % (r,) +.
-000044f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00004500: 2020 2020 2241 7265 2074 6865 2066 6f6c      "Are the fol
-00004510: 6c6f 7769 6e67 2070 6172 616d 6574 6572  lowing parameter
-00004520: 733f 2025 7322 2025 2072 656d 6169 6e69  s? %s" % remaini
-00004530: 6e67 5f66 7329 0a0a 2020 2020 6465 6620  ng_fs)..    def 
-00004540: 5f75 7064 6174 655f 7261 6e67 655f 7661  _update_range_va
-00004550: 6c75 6528 7365 6c66 2c20 7429 3a0a 2020  lue(self, t):.  
-00004560: 2020 2020 2020 2222 2247 6976 656e 2061        """Given a
-00004570: 2073 796d 626f 6c69 6320 6578 7072 6573   symbolic expres
-00004580: 7369 6f6e 2c20 6074 602c 2073 7562 7374  sion, `t`, subst
-00004590: 6974 7574 6573 2074 6865 2070 6172 616d  itutes the param
-000045a0: 6574 6572 7320 6966 0a20 2020 2020 2020  eters if.       
-000045b0: 2074 6869 7320 7365 7269 6573 2069 7320   this series is 
-000045c0: 696e 7465 7261 6374 6976 652e 0a20 2020  interactive..   
-000045d0: 2020 2020 2022 2222 0a20 2020 2020 2020       """.       
-000045e0: 2069 6620 6e6f 7420 7365 6c66 2e5f 696e   if not self._in
-000045f0: 7465 7261 6374 6976 655f 7261 6e67 6573  teractive_ranges
-00004600: 3a0a 2020 2020 2020 2020 2020 2020 7265  :.            re
-00004610: 7475 726e 2063 6f6d 706c 6578 2874 290a  turn complex(t).
-00004620: 2020 2020 2020 2020 7265 7475 726e 2063          return c
-00004630: 6f6d 706c 6578 2874 2e73 7562 7328 7365  omplex(t.subs(se
-00004640: 6c66 2e70 6172 616d 7329 290a 0a20 2020  lf.params))..   
-00004650: 2040 7072 6f70 6572 7479 0a20 2020 2064   @property.    d
-00004660: 6566 2065 7870 7228 7365 6c66 293a 0a20  ef expr(self):. 
-00004670: 2020 2020 2020 2022 2222 5265 7475 726e         """Return
-00004680: 2074 6865 2065 7870 7265 7373 696f 6e20   the expression 
-00004690: 286f 7220 6578 7072 6573 7369 6f6e 7329  (or expressions)
-000046a0: 206f 6620 7468 6520 7365 7269 6573 2e22   of the series."
-000046b0: 2222 0a20 2020 2020 2020 2072 6574 7572  "".        retur
-000046c0: 6e20 7365 6c66 2e5f 6578 7072 0a0a 2020  n self._expr..  
-000046d0: 2020 4065 7870 722e 7365 7474 6572 0a20    @expr.setter. 
-000046e0: 2020 2064 6566 2065 7870 7228 7365 6c66     def expr(self
-000046f0: 2c20 7629 3a0a 2020 2020 2020 2020 7365  , v):.        se
-00004700: 6c66 2e5f 6578 7072 203d 2076 0a0a 2020  lf._expr = v..  
-00004710: 2020 4070 726f 7065 7274 790a 2020 2020    @property.    
-00004720: 6465 6620 6973 5f33 4428 7365 6c66 293a  def is_3D(self):
-00004730: 0a20 2020 2020 2020 2066 6c61 6773 3344  .        flags3D
-00004740: 203d 205b 7365 6c66 2e69 735f 3344 6c69   = [self.is_3Dli
-00004750: 6e65 2c20 7365 6c66 2e69 735f 3344 7375  ne, self.is_3Dsu
-00004760: 7266 6163 652c 2073 656c 662e 6973 5f33  rface, self.is_3
-00004770: 4476 6563 746f 725d 0a20 2020 2020 2020  Dvector].       
-00004780: 2072 6574 7572 6e20 616e 7928 666c 6167   return any(flag
-00004790: 7333 4429 0a0a 2020 2020 4070 726f 7065  s3D)..    @prope
-000047a0: 7274 790a 2020 2020 6465 6620 6973 5f6c  rty.    def is_l
-000047b0: 696e 6528 7365 6c66 293a 0a20 2020 2020  ine(self):.     
-000047c0: 2020 2066 6c61 6773 6c69 6e65 7320 3d20     flagslines = 
-000047d0: 5b73 656c 662e 6973 5f32 446c 696e 652c  [self.is_2Dline,
-000047e0: 2073 656c 662e 6973 5f33 446c 696e 655d   self.is_3Dline]
-000047f0: 0a20 2020 2020 2020 2072 6574 7572 6e20  .        return 
-00004800: 616e 7928 666c 6167 736c 696e 6573 290a  any(flagslines).
-00004810: 0a20 2020 2064 6566 205f 6c69 6e65 5f73  .    def _line_s
-00004820: 7572 6661 6365 5f63 6f6c 6f72 2873 656c  urface_color(sel
-00004830: 662c 2070 726f 702c 2076 616c 293a 0a20  f, prop, val):. 
-00004840: 2020 2020 2020 2022 2222 5468 6973 206d         """This m
-00004850: 6574 686f 6420 656e 6162 6c65 7320 6261  ethod enables ba
-00004860: 636b 2d63 6f6d 7061 7469 6269 6c69 7479  ck-compatibility
-00004870: 2077 6974 6820 6f6c 6420 7379 6d70 792e   with old sympy.
-00004880: 706c 6f74 7469 6e67 2222 220a 2020 2020  plotting""".    
-00004890: 2020 2020 2320 4e4f 5445 3a20 636f 6c6f      # NOTE: colo
-000048a0: 725f 6675 6e63 2069 7320 7365 7420 696e  r_func is set in
-000048b0: 7369 6465 2074 6865 2069 6e69 7420 6d65  side the init me
-000048c0: 7468 6f64 206f 6620 7468 6520 7365 7269  thod of the seri
-000048d0: 6573 2e0a 2020 2020 2020 2020 2320 4966  es..        # If
-000048e0: 206c 696e 655f 636f 6c6f 722f 7375 7266   line_color/surf
-000048f0: 6163 655f 636f 6c6f 7220 6973 206e 6f74  ace_color is not
-00004900: 2061 2063 616c 6c61 626c 652c 2074 6865   a callable, the
-00004910: 6e20 636f 6c6f 725f 6675 6e63 2077 696c  n color_func wil
-00004920: 6c0a 2020 2020 2020 2020 2320 6265 2073  l.        # be s
-00004930: 6574 2074 6f20 4e6f 6e65 2e0a 2020 2020  et to None..    
-00004940: 2020 2020 7365 7461 7474 7228 7365 6c66      setattr(self
-00004950: 2c20 7072 6f70 2c20 7661 6c29 0a20 2020  , prop, val).   
-00004960: 2020 2020 2069 6620 6361 6c6c 6162 6c65       if callable
-00004970: 2876 616c 2920 6f72 2069 7369 6e73 7461  (val) or isinsta
-00004980: 6e63 6528 7661 6c2c 2045 7870 7229 3a0a  nce(val, Expr):.
-00004990: 2020 2020 2020 2020 2020 2020 7365 6c66              self
-000049a0: 2e63 6f6c 6f72 5f66 756e 6320 3d20 7661  .color_func = va
-000049b0: 6c0a 2020 2020 2020 2020 2020 2020 7365  l.            se
-000049c0: 7461 7474 7228 7365 6c66 2c20 7072 6f70  tattr(self, prop
-000049d0: 2c20 4e6f 6e65 290a 2020 2020 2020 2020  , None).        
-000049e0: 656c 6966 2076 616c 2069 7320 6e6f 7420  elif val is not 
-000049f0: 4e6f 6e65 3a0a 2020 2020 2020 2020 2020  None:.          
-00004a00: 2020 7365 6c66 2e63 6f6c 6f72 5f66 756e    self.color_fun
-00004a10: 6320 3d20 4e6f 6e65 0a0a 2020 2020 4070  c = None..    @p
-00004a20: 726f 7065 7274 790a 2020 2020 6465 6620  roperty.    def 
-00004a30: 6e28 7365 6c66 293a 0a20 2020 2020 2020  n(self):.       
-00004a40: 2022 2222 5265 7475 726e 7320 6120 6c69   """Returns a li
-00004a50: 7374 205b 6e31 2c20 6e32 2c20 6e33 5d20  st [n1, n2, n3] 
-00004a60: 6f66 206e 756d 6265 7273 206f 6620 6469  of numbers of di
-00004a70: 7363 7261 7469 7a61 7469 6f6e 2070 6f69  scratization poi
-00004a80: 6e74 732e 0a20 2020 2020 2020 2022 2222  nts..        """
-00004a90: 0a20 2020 2020 2020 2072 6574 7572 6e20  .        return 
-00004aa0: 7365 6c66 2e5f 6e0a 0a20 2020 2040 6e2e  self._n..    @n.
-00004ab0: 7365 7474 6572 0a20 2020 2064 6566 206e  setter.    def n
-00004ac0: 2873 656c 662c 2076 293a 0a20 2020 2020  (self, v):.     
-00004ad0: 2020 2022 2222 5365 7420 7468 6520 6e75     """Set the nu
-00004ae0: 6d62 6572 7320 6f66 2064 6973 6372 6574  mbers of discret
-00004af0: 697a 6174 696f 6e20 706f 696e 7473 2e20  ization points. 
-00004b00: 6060 7660 6020 6d75 7374 2062 6520 616e  ``v`` must be an
-00004b10: 2069 6e74 206f 720a 2020 2020 2020 2020   int or.        
-00004b20: 6120 6c69 7374 2e0a 0a20 2020 2020 2020  a list...       
-00004b30: 204c 6574 2060 6073 6060 2062 6520 6120   Let ``s`` be a 
-00004b40: 7365 7269 6573 2e20 5468 656e 3a0a 0a20  series. Then:.. 
-00004b50: 2020 2020 2020 202a 2074 6f20 7365 7420         * to set 
-00004b60: 7468 6520 6e75 6d62 6572 206f 6620 6469  the number of di
-00004b70: 7363 7265 7469 7a61 7469 6f6e 2070 6f69  scretization poi
-00004b80: 6e74 7320 616c 6f6e 6720 7468 6520 7820  nts along the x 
-00004b90: 6469 7265 6374 696f 6e20 286f 720a 2020  direction (or.  
-00004ba0: 2020 2020 2020 2020 6669 7273 7420 7061          first pa
-00004bb0: 7261 6d65 7465 7229 3a20 6060 732e 6e20  rameter): ``s.n 
-00004bc0: 3d20 3130 6060 0a20 2020 2020 2020 202a  = 10``.        *
-00004bd0: 2074 6f20 7365 7420 7468 6520 6e75 6d62   to set the numb
-00004be0: 6572 206f 6620 6469 7363 7265 7469 7a61  er of discretiza
-00004bf0: 7469 6f6e 2070 6f69 6e74 7320 616c 6f6e  tion points alon
-00004c00: 6720 7468 6520 7820 616e 6420 790a 2020  g the x and y.  
-00004c10: 2020 2020 2020 2020 6469 7265 6374 696f          directio
-00004c20: 6e73 2028 6f72 2066 6972 7374 2061 6e64  ns (or first and
-00004c30: 2073 6563 6f6e 6420 7061 7261 6d65 7465   second paramete
-00004c40: 7273 293a 2060 6073 2e6e 203d 205b 3130  rs): ``s.n = [10
-00004c50: 2c20 3135 5d60 600a 2020 2020 2020 2020  , 15]``.        
-00004c60: 2a20 746f 2073 6574 2074 6865 206e 756d  * to set the num
-00004c70: 6265 7220 6f66 2064 6973 6372 6574 697a  ber of discretiz
-00004c80: 6174 696f 6e20 706f 696e 7473 2061 6c6f  ation points alo
-00004c90: 6e67 2074 6865 2078 2c20 7920 616e 6420  ng the x, y and 
-00004ca0: 7a0a 2020 2020 2020 2020 2020 6469 7265  z.          dire
-00004cb0: 6374 696f 6e73 3a20 6060 732e 6e20 3d20  ctions: ``s.n = 
-00004cc0: 5b31 302c 2031 352c 2032 305d 6060 0a0a  [10, 15, 20]``..
-00004cd0: 2020 2020 2020 2020 4e6f 7465 2074 6861          Note tha
-00004ce0: 7420 7468 6520 666f 6c6c 6f77 696e 6720  t the following 
-00004cf0: 6973 2068 6967 686c 7920 756e 7265 6363  is highly unrecc
-00004d00: 6f6d 656e 6465 642c 2062 6563 6175 7365  omended, because
-00004d10: 2069 7420 7072 6576 656e 7473 0a20 2020   it prevents.   
-00004d20: 2020 2020 2074 6865 2065 7865 6375 7469       the executi
-00004d30: 6f6e 206f 6620 6e65 6365 7373 6172 7920  on of necessary 
-00004d40: 636f 6465 2069 6e20 6f72 6465 7220 746f  code in order to
-00004d50: 206b 6565 7020 7570 6461 7465 6420 6461   keep updated da
-00004d60: 7461 3a0a 2020 2020 2020 2020 6060 732e  ta:.        ``s.
-00004d70: 6e5b 315d 203d 2031 3560 600a 2020 2020  n[1] = 15``.    
-00004d80: 2020 2020 2222 220a 2020 2020 2020 2020      """.        
-00004d90: 6966 206e 6f74 2068 6173 6174 7472 2876  if not hasattr(v
-00004da0: 2c20 225f 5f69 7465 725f 5f22 293a 0a20  , "__iter__"):. 
-00004db0: 2020 2020 2020 2020 2020 2073 656c 662e             self.
-00004dc0: 5f6e 5b30 5d20 3d20 760a 2020 2020 2020  _n[0] = v.      
-00004dd0: 2020 656c 7365 3a0a 2020 2020 2020 2020    else:.        
-00004de0: 2020 2020 7365 6c66 2e5f 6e5b 3a6c 656e      self._n[:len
-00004df0: 2876 295d 203d 2076 0a0a 2020 2020 4070  (v)] = v..    @p
-00004e00: 726f 7065 7274 790a 2020 2020 6465 6620  roperty.    def 
-00004e10: 7061 7261 6d73 2873 656c 6629 3a0a 2020  params(self):.  
-00004e20: 2020 2020 2020 2222 2247 6574 206f 7220        """Get or 
-00004e30: 7365 7420 7468 6520 6375 7272 656e 7420  set the current 
-00004e40: 7061 7261 6d65 7465 7273 2064 6963 7469  parameters dicti
-00004e50: 6f6e 6172 792e 0a0a 2020 2020 2020 2020  onary...        
-00004e60: 5061 7261 6d65 7465 7273 0a20 2020 2020  Parameters.     
-00004e70: 2020 203d 3d3d 3d3d 3d3d 3d3d 3d0a 0a20     ==========.. 
-00004e80: 2020 2020 2020 2070 203a 2064 6963 740a         p : dict.
-00004e90: 0a20 2020 2020 2020 2020 2020 202a 206b  .            * k
-00004ea0: 6579 3a20 7379 6d62 6f6c 2061 7373 6f63  ey: symbol assoc
-00004eb0: 6961 7465 6420 746f 2074 6865 2070 6172  iated to the par
-00004ec0: 616d 6574 6572 0a20 2020 2020 2020 2020  ameter.         
-00004ed0: 2020 202a 2076 616c 3a20 7468 6520 6e75     * val: the nu
-00004ee0: 6d65 7269 6320 7661 6c75 650a 2020 2020  meric value.    
-00004ef0: 2020 2020 2222 220a 2020 2020 2020 2020      """.        
-00004f00: 7265 7475 726e 2073 656c 662e 5f70 6172  return self._par
-00004f10: 616d 730a 0a20 2020 2040 7061 7261 6d73  ams..    @params
-00004f20: 2e73 6574 7465 720a 2020 2020 6465 6620  .setter.    def 
-00004f30: 7061 7261 6d73 2873 656c 662c 2070 293a  params(self, p):
-00004f40: 0a20 2020 2020 2020 2073 656c 662e 5f70  .        self._p
-00004f50: 6172 616d 7320 3d20 700a 0a20 2020 2040  arams = p..    @
-00004f60: 7072 6f70 6572 7479 0a20 2020 2064 6566  property.    def
-00004f70: 2073 6361 6c65 7328 7365 6c66 293a 0a20   scales(self):. 
-00004f80: 2020 2020 2020 2072 6574 7572 6e20 7365         return se
-00004f90: 6c66 2e5f 7363 616c 6573 0a0a 2020 2020  lf._scales..    
-00004fa0: 4073 6361 6c65 732e 7365 7474 6572 0a20  @scales.setter. 
-00004fb0: 2020 2064 6566 2073 6361 6c65 7328 7365     def scales(se
-00004fc0: 6c66 2c20 7629 3a0a 2020 2020 2020 2020  lf, v):.        
-00004fd0: 6966 2069 7369 6e73 7461 6e63 6528 762c  if isinstance(v,
-00004fe0: 2073 7472 293a 0a20 2020 2020 2020 2020   str):.         
-00004ff0: 2020 2073 656c 662e 5f73 6361 6c65 735b     self._scales[
-00005000: 305d 203d 2076 0a20 2020 2020 2020 2065  0] = v.        e
-00005010: 6c73 653a 0a20 2020 2020 2020 2020 2020  lse:.           
-00005020: 2073 656c 662e 5f73 6361 6c65 735b 3a6c   self._scales[:l
-00005030: 656e 2876 295d 203d 2076 0a0a 2020 2020  en(v)] = v..    
-00005040: 4070 726f 7065 7274 790a 2020 2020 6465  @property.    de
-00005050: 6620 7265 6e64 6572 696e 675f 6b77 2873  f rendering_kw(s
-00005060: 656c 6629 3a0a 2020 2020 2020 2020 7265  elf):.        re
-00005070: 7475 726e 2073 656c 662e 5f72 656e 6465  turn self._rende
-00005080: 7269 6e67 5f6b 770a 0a20 2020 2040 7265  ring_kw..    @re
-00005090: 6e64 6572 696e 675f 6b77 2e73 6574 7465  ndering_kw.sette
-000050a0: 720a 2020 2020 6465 6620 7265 6e64 6572  r.    def render
-000050b0: 696e 675f 6b77 2873 656c 662c 206b 7761  ing_kw(self, kwa
-000050c0: 7267 7329 3a0a 2020 2020 2020 2020 6966  rgs):.        if
-000050d0: 2069 7369 6e73 7461 6e63 6528 6b77 6172   isinstance(kwar
-000050e0: 6773 2c20 6469 6374 293a 0a20 2020 2020  gs, dict):.     
-000050f0: 2020 2020 2020 2073 656c 662e 5f72 656e         self._ren
-00005100: 6465 7269 6e67 5f6b 7720 3d20 6b77 6172  dering_kw = kwar
-00005110: 6773 0a20 2020 2020 2020 2065 6c73 653a  gs.        else:
-00005120: 0a20 2020 2020 2020 2020 2020 2073 656c  .            sel
-00005130: 662e 5f72 656e 6465 7269 6e67 5f6b 7720  f._rendering_kw 
-00005140: 3d20 6469 6374 2829 0a20 2020 2020 2020  = dict().       
-00005150: 2020 2020 2069 6620 6b77 6172 6773 2069       if kwargs i
-00005160: 7320 6e6f 7420 4e6f 6e65 3a0a 2020 2020  s not None:.    
-00005170: 2020 2020 2020 2020 2020 2020 7761 726e              warn
-00005180: 696e 6773 2e77 6172 6e28 0a20 2020 2020  ings.warn(.     
-00005190: 2020 2020 2020 2020 2020 2020 2020 2022                 "
-000051a0: 6072 656e 6465 7269 6e67 5f6b 7760 206d  `rendering_kw` m
-000051b0: 7573 7420 6265 2061 2064 6963 7469 6f6e  ust be a diction
-000051c0: 6172 792c 2069 6e73 7465 6164 2061 6e20  ary, instead an 
-000051d0: 220a 2020 2020 2020 2020 2020 2020 2020  ".              
-000051e0: 2020 2020 2020 226f 626a 6563 7420 6f66        "object of
-000051f0: 2074 7970 6520 2573 2077 6173 2072 6563   type %s was rec
-00005200: 6569 7665 642e 2022 2025 2074 7970 6528  eived. " % type(
-00005210: 6b77 6172 6773 2920 2b0a 2020 2020 2020  kwargs) +.      
-00005220: 2020 2020 2020 2020 2020 2020 2020 2241                "A
-00005230: 7574 6f6d 6174 6963 616c 6c79 2073 6574  utomatically set
-00005240: 7469 6e67 2060 7265 6e64 6572 696e 675f  ting `rendering_
-00005250: 6b77 6020 746f 2061 6e20 656d 7074 7920  kw` to an empty 
-00005260: 220a 2020 2020 2020 2020 2020 2020 2020  ".              
-00005270: 2020 2020 2020 2264 6963 7469 6f6e 6172        "dictionar
-00005280: 7922 290a 0a20 2020 2040 7374 6174 6963  y")..    @static
-00005290: 6d65 7468 6f64 0a20 2020 2064 6566 205f  method.    def _
-000052a0: 6469 7363 7265 7469 7a65 2873 7461 7274  discretize(start
-000052b0: 2c20 656e 642c 204e 2c20 7363 616c 653d  , end, N, scale=
-000052c0: 226c 696e 6561 7222 2c20 6f6e 6c79 5f69  "linear", only_i
-000052d0: 6e74 6567 6572 733d 4661 6c73 6529 3a0a  ntegers=False):.
-000052e0: 2020 2020 2020 2020 2222 2244 6973 6372          """Discr
-000052f0: 6574 697a 6520 6120 3144 2064 6f6d 6169  etize a 1D domai
-00005300: 6e2e 0a0a 2020 2020 2020 2020 5265 7475  n...        Retu
-00005310: 726e 730a 2020 2020 2020 2020 3d3d 3d3d  rns.        ====
-00005320: 3d3d 3d0a 0a20 2020 2020 2020 2064 6f6d  ===..        dom
-00005330: 6169 6e20 3a20 6e70 2e6e 6461 7272 6179  ain : np.ndarray
-00005340: 2077 6974 6820 6474 7970 653d 666c 6f61   with dtype=floa
-00005350: 7420 6f72 2063 6f6d 706c 6578 0a20 2020  t or complex.   
-00005360: 2020 2020 2020 2020 2054 6865 2064 6f6d           The dom
-00005370: 6169 6e27 7320 6474 7970 6520 7769 6c6c  ain's dtype will
-00005380: 2062 6520 666c 6f61 7420 6f72 2063 6f6d   be float or com
-00005390: 706c 6578 2028 6465 7065 6e64 696e 6720  plex (depending 
-000053a0: 6f6e 2074 6865 0a20 2020 2020 2020 2020  on the.         
-000053b0: 2020 2074 7970 6520 6f66 2073 7461 7274     type of start
-000053c0: 2f65 6e64 2920 6576 656e 2069 6620 6f6e  /end) even if on
-000053d0: 6c79 5f69 6e74 6567 6572 733d 5472 7565  ly_integers=True
-000053e0: 2e20 4974 2069 7320 6c65 6674 2066 6f72  . It is left for
-000053f0: 0a20 2020 2020 2020 2020 2020 2074 6865  .            the
-00005400: 2064 6f77 6e73 7472 6561 6d20 636f 6465   downstream code
-00005410: 2074 6f20 7065 7266 6f72 6d20 6675 7274   to perform furt
-00005420: 6865 7220 6361 7374 696e 672c 2069 6620  her casting, if 
-00005430: 6e65 6365 7373 6172 792e 0a20 2020 2020  necessary..     
-00005440: 2020 2022 2222 0a20 2020 2020 2020 206e     """.        n
-00005450: 7020 3d20 696d 706f 7274 5f6d 6f64 756c  p = import_modul
-00005460: 6528 276e 756d 7079 2729 0a0a 2020 2020  e('numpy')..    
-00005470: 2020 2020 6966 206f 6e6c 795f 696e 7465      if only_inte
-00005480: 6765 7273 2069 7320 5472 7565 3a0a 2020  gers is True:.  
-00005490: 2020 2020 2020 2020 2020 7374 6172 742c            start,
-000054a0: 2065 6e64 203d 2069 6e74 2873 7461 7274   end = int(start
-000054b0: 292c 2069 6e74 2865 6e64 290a 2020 2020  ), int(end).    
-000054c0: 2020 2020 2020 2020 4e20 3d20 656e 6420          N = end 
-000054d0: 2d20 7374 6172 7420 2b20 310a 0a20 2020  - start + 1..   
-000054e0: 2020 2020 2069 6620 7363 616c 6520 3d3d       if scale ==
-000054f0: 2022 6c69 6e65 6172 223a 0a20 2020 2020   "linear":.     
-00005500: 2020 2020 2020 2072 6574 7572 6e20 6e70         return np
-00005510: 2e6c 696e 7370 6163 6528 7374 6172 742c  .linspace(start,
-00005520: 2065 6e64 2c20 4e29 0a20 2020 2020 2020   end, N).       
-00005530: 2072 6574 7572 6e20 6e70 2e67 656f 6d73   return np.geoms
-00005540: 7061 6365 2873 7461 7274 2c20 656e 642c  pace(start, end,
-00005550: 204e 290a 0a20 2020 2040 7374 6174 6963   N)..    @static
-00005560: 6d65 7468 6f64 0a20 2020 2064 6566 205f  method.    def _
-00005570: 636f 7272 6563 745f 7368 6170 6528 612c  correct_shape(a,
-00005580: 2062 293a 0a20 2020 2020 2020 2022 2222   b):.        """
-00005590: 436f 6e76 6572 7420 6060 6160 6020 746f  Convert ``a`` to
-000055a0: 2061 206e 702e 6e64 6172 7261 7920 6f66   a np.ndarray of
-000055b0: 2074 6865 2073 616d 6520 7368 6170 6520   the same shape 
-000055c0: 6f66 2060 6062 6060 2e0a 0a20 2020 2020  of ``b``...     
-000055d0: 2020 2050 6172 616d 6574 6572 730a 2020     Parameters.  
-000055e0: 2020 2020 2020 3d3d 3d3d 3d3d 3d3d 3d3d        ==========
-000055f0: 0a0a 2020 2020 2020 2020 6120 3a20 696e  ..        a : in
-00005600: 742c 2066 6c6f 6174 2c20 636f 6d70 6c65  t, float, comple
-00005610: 782c 206e 702e 6e64 6172 7261 790a 2020  x, np.ndarray.  
-00005620: 2020 2020 2020 2020 2020 5573 7561 6c6c            Usuall
-00005630: 792c 2074 6869 7320 6973 2074 6865 2072  y, this is the r
-00005640: 6573 756c 7420 6f66 2061 206e 756d 6572  esult of a numer
-00005650: 6963 616c 2065 7661 6c75 6174 696f 6e20  ical evaluation 
-00005660: 6f66 2061 0a20 2020 2020 2020 2020 2020  of a.           
-00005670: 2073 796d 626f 6c69 6320 6578 7072 6573   symbolic expres
-00005680: 7369 6f6e 2e20 4576 656e 2069 6620 6120  sion. Even if a 
-00005690: 6469 7363 7265 7469 7a65 6420 646f 6d61  discretized doma
-000056a0: 696e 2077 6173 2075 7365 6420 746f 0a20  in was used to. 
-000056b0: 2020 2020 2020 2020 2020 2065 7661 6c75             evalu
-000056c0: 6174 6520 7468 6520 6675 6e63 7469 6f6e  ate the function
-000056d0: 2c20 7468 6520 7265 7375 6c74 2063 616e  , the result can
-000056e0: 2062 6520 6120 7363 616c 6172 2028 696e   be a scalar (in
-000056f0: 742c 2066 6c6f 6174 2c0a 2020 2020 2020  t, float,.      
-00005700: 2020 2020 2020 636f 6d70 6c65 7829 2e0a        complex)..
-00005710: 0a20 2020 2020 2020 2062 203a 206e 702e  .        b : np.
-00005720: 6e64 6172 7261 790a 2020 2020 2020 2020  ndarray.        
-00005730: 2020 2020 4974 2072 6570 7265 7365 6e74      It represent
-00005740: 7320 7468 6520 636f 7272 6563 7420 7368  s the correct sh
-00005750: 6170 6520 7468 6174 2060 6061 6060 2073  ape that ``a`` s
-00005760: 686f 756c 6420 6861 7665 2e0a 0a20 2020  hould have...   
-00005770: 2020 2020 2052 6574 7572 6e73 0a20 2020       Returns.   
-00005780: 2020 2020 203d 3d3d 3d3d 3d3d 0a20 2020       =======.   
-00005790: 2020 2020 206e 6577 5f61 203a 206e 702e       new_a : np.
-000057a0: 6e64 6172 7261 790a 2020 2020 2020 2020  ndarray.        
-000057b0: 2020 2020 416e 2061 7272 6179 2077 6974      An array wit
-000057c0: 6820 7468 6520 636f 7272 6563 7420 7368  h the correct sh
-000057d0: 6170 652e 0a20 2020 2020 2020 2022 2222  ape..        """
-000057e0: 0a20 2020 2020 2020 206e 7020 3d20 696d  .        np = im
-000057f0: 706f 7274 5f6d 6f64 756c 6528 276e 756d  port_module('num
-00005800: 7079 2729 0a0a 2020 2020 2020 2020 6966  py')..        if
-00005810: 206e 6f74 2069 7369 6e73 7461 6e63 6528   not isinstance(
-00005820: 612c 206e 702e 6e64 6172 7261 7929 3a0a  a, np.ndarray):.
-00005830: 2020 2020 2020 2020 2020 2020 6120 3d20              a = 
-00005840: 6e70 2e61 7272 6179 2861 290a 2020 2020  np.array(a).    
-00005850: 2020 2020 6966 2061 2e73 6861 7065 2021      if a.shape !
-00005860: 3d20 622e 7368 6170 653a 0a20 2020 2020  = b.shape:.     
-00005870: 2020 2020 2020 2069 6620 612e 7368 6170         if a.shap
-00005880: 6520 3d3d 2028 293a 0a20 2020 2020 2020  e == ():.       
-00005890: 2020 2020 2020 2020 2061 203d 2061 202a           a = a *
-000058a0: 206e 702e 6f6e 6573 5f6c 696b 6528 6229   np.ones_like(b)
-000058b0: 0a20 2020 2020 2020 2020 2020 2065 6c73  .            els
-000058c0: 653a 0a20 2020 2020 2020 2020 2020 2020  e:.             
-000058d0: 2020 2061 203d 2061 2e72 6573 6861 7065     a = a.reshape
-000058e0: 2862 2e73 6861 7065 290a 2020 2020 2020  (b.shape).      
-000058f0: 2020 7265 7475 726e 2061 0a0a 2020 2020    return a..    
-00005900: 6465 6620 6576 616c 5f63 6f6c 6f72 5f66  def eval_color_f
-00005910: 756e 6328 7365 6c66 2c20 2a61 7267 7329  unc(self, *args)
-00005920: 3a0a 2020 2020 2020 2020 2222 2245 7661  :.        """Eva
-00005930: 6c75 6174 6520 7468 6520 636f 6c6f 7220  luate the color 
-00005940: 6675 6e63 7469 6f6e 2e0a 0a20 2020 2020  function...     
-00005950: 2020 2050 6172 616d 6574 6572 730a 2020     Parameters.  
-00005960: 2020 2020 2020 3d3d 3d3d 3d3d 3d3d 3d3d        ==========
-00005970: 0a0a 2020 2020 2020 2020 6172 6773 203a  ..        args :
-00005980: 2074 7570 6c65 0a20 2020 2020 2020 2020   tuple.         
-00005990: 2020 2041 7267 756d 656e 7473 2074 6f20     Arguments to 
-000059a0: 6265 2070 6173 7365 6420 746f 2074 6865  be passed to the
-000059b0: 2063 6f6c 6f72 696e 6720 6675 6e63 7469   coloring functi
-000059c0: 6f6e 2e20 4361 6e20 6265 2063 6f6f 7264  on. Can be coord
-000059d0: 696e 6174 6573 0a20 2020 2020 2020 2020  inates.         
-000059e0: 2020 206f 7220 7061 7261 6d65 7465 7273     or parameters
-000059f0: 206f 7220 626f 7468 2e0a 0a20 2020 2020   or both...     
-00005a00: 2020 204e 6f74 6573 0a20 2020 2020 2020     Notes.       
-00005a10: 203d 3d3d 3d3d 0a0a 2020 2020 2020 2020   =====..        
-00005a20: 5468 6520 6261 636b 656e 6420 7769 6c6c  The backend will
-00005a30: 2072 6571 7565 7374 2074 6865 2064 6174   request the dat
-00005a40: 6120 7365 7269 6573 2074 6f20 6765 6e65  a series to gene
-00005a50: 7261 7465 2074 6865 206e 756d 6572 6963  rate the numeric
-00005a60: 616c 0a20 2020 2020 2020 2064 6174 612e  al.        data.
-00005a70: 2044 6570 656e 6469 6e67 206f 6e20 7468   Depending on th
-00005a80: 6520 6461 7461 2073 6572 6965 732c 2065  e data series, e
-00005a90: 6974 6865 7220 7468 6520 6461 7461 2073  ither the data s
-00005aa0: 6572 6965 7320 6974 7365 6c66 206f 720a  eries itself or.
-00005ab0: 2020 2020 2020 2020 7468 6520 6261 636b          the back
-00005ac0: 656e 6420 7769 6c6c 2065 7665 6e74 7561  end will eventua
-00005ad0: 6c6c 7920 6578 6563 7574 6520 7468 6973  lly execute this
-00005ae0: 2066 756e 6374 696f 6e20 746f 2067 656e   function to gen
-00005af0: 6572 6174 6520 7468 650a 2020 2020 2020  erate the.      
-00005b00: 2020 6170 7072 6f70 7269 6174 6520 636f    appropriate co
-00005b10: 6c6f 7269 6e67 2076 616c 7565 2e0a 2020  loring value..  
-00005b20: 2020 2020 2020 2222 220a 2020 2020 2020        """.      
-00005b30: 2020 6e70 203d 2069 6d70 6f72 745f 6d6f    np = import_mo
-00005b40: 6475 6c65 2827 6e75 6d70 7927 290a 2020  dule('numpy').  
-00005b50: 2020 2020 2020 6966 2073 656c 662e 636f        if self.co
-00005b60: 6c6f 725f 6675 6e63 2069 7320 4e6f 6e65  lor_func is None
-00005b70: 3a0a 2020 2020 2020 2020 2020 2020 2320  :.            # 
-00005b80: 4e4f 5445 3a20 7769 7468 2074 6865 206c  NOTE: with the l
-00005b90: 696e 655f 636f 6c6f 7220 616e 6420 7375  ine_color and su
-00005ba0: 7266 6163 655f 636f 6c6f 7220 6174 7472  rface_color attr
-00005bb0: 6962 7574 6573 0a20 2020 2020 2020 2020  ibutes.         
-00005bc0: 2020 2023 2028 6261 636b 2d63 6f6d 7061     # (back-compa
-00005bd0: 7469 6269 6c69 7479 2077 6974 6820 7468  tibility with th
-00005be0: 6520 6f6c 6420 7379 6d70 792e 706c 6f74  e old sympy.plot
-00005bf0: 7469 6e67 206d 6f64 756c 6529 2069 7420  ting module) it 
-00005c00: 6973 0a20 2020 2020 2020 2020 2020 2023  is.            #
-00005c10: 2070 6f73 7369 626c 6520 746f 2063 7265   possible to cre
-00005c20: 6174 6520 6120 706c 6f74 2077 6974 6820  ate a plot with 
-00005c30: 6120 6361 6c6c 6162 6c65 206c 696e 655f  a callable line_
-00005c40: 636f 6c6f 7220 286f 720a 2020 2020 2020  color (or.      
-00005c50: 2020 2020 2020 2320 7375 7266 6163 655f        # surface_
-00005c60: 636f 6c6f 7229 2e20 466f 7220 6578 616d  color). For exam
-00005c70: 706c 653a 0a20 2020 2020 2020 2020 2020  ple:.           
-00005c80: 2023 2070 203d 2070 6c6f 7428 7369 6e28   # p = plot(sin(
-00005c90: 7829 2c20 6c69 6e65 5f63 6f6c 6f72 3d6c  x), line_color=l
-00005ca0: 616d 6264 6120 782c 2079 3a20 2d79 290a  ambda x, y: -y).
-00005cb0: 2020 2020 2020 2020 2020 2020 2320 5468              # Th
-00005cc0: 6973 2077 696c 6c20 6372 6561 7465 2061  is will create a
-00005cd0: 2043 6f6c 6f72 6564 4c69 6e65 4f76 6572   ColoredLineOver
-00005ce0: 3144 5261 6e67 6553 6572 6965 732c 2077  1DRangeSeries, w
-00005cf0: 6869 6368 0a20 2020 2020 2020 2020 2020  hich.           
-00005d00: 2023 2065 6666 6665 6374 6976 656c 7920   # efffectively 
-00005d10: 6973 2061 2070 6172 616d 6574 7269 6320  is a parametric 
-00005d20: 7365 7269 6573 2e20 4c61 7465 7220 7765  series. Later we
-00005d30: 2063 6f75 6c64 2063 6861 6e67 650a 2020   could change.  
-00005d40: 2020 2020 2020 2020 2020 2320 6974 2074            # it t
-00005d50: 6f20 6120 7374 7269 6e67 2076 616c 7565  o a string value
-00005d60: 3a0a 2020 2020 2020 2020 2020 2020 2320  :.            # 
-00005d70: 705b 305d 2e6c 696e 655f 636f 6c6f 7220  p[0].line_color 
-00005d80: 3d20 2272 6564 220a 2020 2020 2020 2020  = "red".        
-00005d90: 2020 2020 2320 486f 7765 7665 722c 2074      # However, t
-00005da0: 6869 7320 776f 6e27 7420 6170 706c 7920  his won't apply 
-00005db0: 7468 6520 7265 6420 636f 6c6f 722c 2062  the red color, b
-00005dc0: 6563 6175 7365 2077 6520 6361 6e27 7420  ecause we can't 
-00005dd0: 6173 6b0a 2020 2020 2020 2020 2020 2020  ask.            
-00005de0: 2320 6120 7061 7261 6d65 7472 6963 2073  # a parametric s
-00005df0: 6572 6965 7320 746f 2062 6520 6e6f 6e2d  eries to be non-
-00005e00: 7061 7261 6d65 7472 6963 210a 2020 2020  parametric!.    
-00005e10: 2020 2020 2020 2020 7761 726e 696e 6773          warnings
-00005e20: 2e77 6172 6e28 0a20 2020 2020 2020 2020  .warn(.         
-00005e30: 2020 2020 2020 2022 5468 6973 2069 7320         "This is 
-00005e40: 6c69 6b65 6c79 206e 6f74 2074 6865 2072  likely not the r
-00005e50: 6573 756c 7420 796f 7520 7765 7265 2020  esult you were  
-00005e60: 6c6f 6f6b 696e 6720 666f 722e 2022 0a20  looking for. ". 
-00005e70: 2020 2020 2020 2020 2020 2020 2020 2022                 "
-00005e80: 506c 6561 7365 2c20 7265 2d65 7865 6375  Please, re-execu
-00005e90: 7465 2074 6865 2070 6c6f 7420 636f 6d6d  te the plot comm
-00005ea0: 616e 642c 2074 6869 7320 7469 6d65 2022  and, this time "
-00005eb0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00005ec0: 2022 7769 7468 2074 6865 2061 7070 726f   "with the appro
-00005ed0: 7072 6961 7465 206c 696e 655f 636f 6c6f  priate line_colo
-00005ee0: 7220 6f72 2073 7572 6661 6365 5f63 6f6c  r or surface_col
-00005ef0: 6f72 2229 0a20 2020 2020 2020 2020 2020  or").           
-00005f00: 2072 6574 7572 6e20 6e70 2e6f 6e65 735f   return np.ones_
-00005f10: 6c69 6b65 2861 7267 735b 305d 290a 0a20  like(args[0]).. 
-00005f20: 2020 2020 2020 2069 6620 7365 6c66 2e5f         if self._
-00005f30: 6576 616c 5f63 6f6c 6f72 5f66 756e 635f  eval_color_func_
-00005f40: 7769 7468 5f73 6967 6e61 7475 7265 3a0a  with_signature:.
-00005f50: 2020 2020 2020 2020 2020 2020 6172 6773              args
-00005f60: 203d 2073 656c 662e 5f61 6767 7265 6761   = self._aggrega
-00005f70: 7465 5f61 7267 7328 290a 2020 2020 2020  te_args().      
-00005f80: 2020 2020 2020 636f 6c6f 7220 3d20 7365        color = se
-00005f90: 6c66 2e63 6f6c 6f72 5f66 756e 6328 2a61  lf.color_func(*a
-00005fa0: 7267 7329 0a20 2020 2020 2020 2020 2020  rgs).           
-00005fb0: 205f 7265 2c20 5f69 6d20 3d20 6e70 2e72   _re, _im = np.r
-00005fc0: 6561 6c28 636f 6c6f 7229 2c20 6e70 2e69  eal(color), np.i
-00005fd0: 6d61 6728 636f 6c6f 7229 0a20 2020 2020  mag(color).     
-00005fe0: 2020 2020 2020 205f 7265 5b6e 702e 696e         _re[np.in
-00005ff0: 7665 7274 286e 702e 6973 636c 6f73 6528  vert(np.isclose(
-00006000: 5f69 6d2c 206e 702e 7a65 726f 735f 6c69  _im, np.zeros_li
-00006010: 6b65 285f 696d 2929 295d 203d 206e 702e  ke(_im)))] = np.
-00006020: 6e61 6e0a 2020 2020 2020 2020 2020 2020  nan.            
-00006030: 7265 7475 726e 205f 7265 0a0a 2020 2020  return _re..    
-00006040: 2020 2020 6e61 7267 7320 3d20 6172 6974      nargs = arit
-00006050: 7928 7365 6c66 2e63 6f6c 6f72 5f66 756e  y(self.color_fun
-00006060: 6329 0a20 2020 2020 2020 2069 6620 6e61  c).        if na
-00006070: 7267 7320 3d3d 2031 3a0a 2020 2020 2020  rgs == 1:.      
-00006080: 2020 2020 2020 6966 2073 656c 662e 6973        if self.is
-00006090: 5f32 446c 696e 6520 616e 6420 7365 6c66  _2Dline and self
-000060a0: 2e69 735f 7061 7261 6d65 7472 6963 3a0a  .is_parametric:.
-000060b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000060c0: 6966 206c 656e 2861 7267 7329 203d 3d20  if len(args) == 
-000060d0: 323a 0a20 2020 2020 2020 2020 2020 2020  2:.             
-000060e0: 2020 2020 2020 2023 2043 6f6c 6f72 6564         # Colored
-000060f0: 4c69 6e65 4f76 6572 3144 5261 6e67 6553  LineOver1DRangeS
-00006100: 6572 6965 730a 2020 2020 2020 2020 2020  eries.          
-00006110: 2020 2020 2020 2020 2020 7265 7475 726e            return
-00006120: 2073 656c 662e 5f63 6f72 7265 6374 5f73   self._correct_s
-00006130: 6861 7065 280a 2020 2020 2020 2020 2020  hape(.          
-00006140: 2020 2020 2020 2020 2020 2020 2020 7365                se
-00006150: 6c66 2e63 6f6c 6f72 5f66 756e 6328 6172  lf.color_func(ar
-00006160: 6773 5b30 5d29 2c20 6172 6773 5b30 5d29  gs[0]), args[0])
-00006170: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00006180: 2023 2050 6172 616d 6574 7269 6332 444c   # Parametric2DL
-00006190: 696e 6553 6572 6965 730a 2020 2020 2020  ineSeries.      
-000061a0: 2020 2020 2020 2020 2020 7265 7475 726e            return
-000061b0: 2073 656c 662e 5f63 6f72 7265 6374 5f73   self._correct_s
-000061c0: 6861 7065 2873 656c 662e 636f 6c6f 725f  hape(self.color_
-000061d0: 6675 6e63 2861 7267 735b 325d 292c 2061  func(args[2]), a
-000061e0: 7267 735b 325d 290a 2020 2020 2020 2020  rgs[2]).        
-000061f0: 2020 2020 656c 6966 2073 656c 662e 6973      elif self.is
-00006200: 5f33 446c 696e 6520 616e 6420 7365 6c66  _3Dline and self
-00006210: 2e69 735f 7061 7261 6d65 7472 6963 3a0a  .is_parametric:.
-00006220: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00006230: 7265 7475 726e 2073 656c 662e 5f63 6f72  return self._cor
-00006240: 7265 6374 5f73 6861 7065 2873 656c 662e  rect_shape(self.
-00006250: 636f 6c6f 725f 6675 6e63 2861 7267 735b  color_func(args[
-00006260: 335d 292c 2061 7267 735b 335d 290a 2020  3]), args[3]).  
-00006270: 2020 2020 2020 2020 2020 656c 6966 2073            elif s
-00006280: 656c 662e 6973 5f33 4473 7572 6661 6365  elf.is_3Dsurface
-00006290: 2061 6e64 2073 656c 662e 6973 5f70 6172   and self.is_par
-000062a0: 616d 6574 7269 633a 0a20 2020 2020 2020  ametric:.       
-000062b0: 2020 2020 2020 2020 2072 6574 7572 6e20           return 
-000062c0: 7365 6c66 2e5f 636f 7272 6563 745f 7368  self._correct_sh
-000062d0: 6170 6528 7365 6c66 2e63 6f6c 6f72 5f66  ape(self.color_f
-000062e0: 756e 6328 6172 6773 5b33 5d29 2c20 6172  unc(args[3]), ar
-000062f0: 6773 5b33 5d29 0a20 2020 2020 2020 2020  gs[3]).         
-00006300: 2020 2072 6574 7572 6e20 7365 6c66 2e5f     return self._
-00006310: 636f 7272 6563 745f 7368 6170 6528 7365  correct_shape(se
-00006320: 6c66 2e63 6f6c 6f72 5f66 756e 6328 6172  lf.color_func(ar
-00006330: 6773 5b30 5d29 2c20 6172 6773 5b30 5d29  gs[0]), args[0])
-00006340: 0a20 2020 2020 2020 2065 6c69 6620 6e61  .        elif na
-00006350: 7267 7320 3d3d 2032 3a0a 2020 2020 2020  rgs == 2:.      
-00006360: 2020 2020 2020 6966 2073 656c 662e 6973        if self.is
-00006370: 5f33 4473 7572 6661 6365 2061 6e64 2073  _3Dsurface and s
-00006380: 656c 662e 6973 5f70 6172 616d 6574 7269  elf.is_parametri
-00006390: 633a 0a20 2020 2020 2020 2020 2020 2020  c:.             
-000063a0: 2020 2072 6574 7572 6e20 7365 6c66 2e5f     return self._
-000063b0: 636f 7272 6563 745f 7368 6170 6528 7365  correct_shape(se
-000063c0: 6c66 2e63 6f6c 6f72 5f66 756e 6328 2a61  lf.color_func(*a
-000063d0: 7267 735b 333a 5d29 2c20 6172 6773 5b33  rgs[3:]), args[3
-000063e0: 5d29 0a20 2020 2020 2020 2020 2020 2072  ]).            r
-000063f0: 6574 7572 6e20 7365 6c66 2e5f 636f 7272  eturn self._corr
-00006400: 6563 745f 7368 6170 6528 7365 6c66 2e63  ect_shape(self.c
-00006410: 6f6c 6f72 5f66 756e 6328 2a61 7267 735b  olor_func(*args[
-00006420: 3a32 5d29 2c20 6172 6773 5b30 5d29 0a20  :2]), args[0]). 
-00006430: 2020 2020 2020 2072 6574 7572 6e20 7365         return se
-00006440: 6c66 2e5f 636f 7272 6563 745f 7368 6170  lf._correct_shap
-00006450: 6528 7365 6c66 2e63 6f6c 6f72 5f66 756e  e(self.color_fun
-00006460: 6328 2a61 7267 735b 3a6e 6172 6773 5d29  c(*args[:nargs])
-00006470: 2c20 6172 6773 5b30 5d29 0a0a 2020 2020  , args[0])..    
-00006480: 6465 6620 6765 745f 6461 7461 2873 656c  def get_data(sel
-00006490: 6629 3a0a 2020 2020 2020 2020 2222 2243  f):.        """C
-000064a0: 6f6d 7075 7465 2061 6e64 2072 6574 7572  ompute and retur
-000064b0: 6e73 2074 6865 206e 756d 6572 6963 616c  ns the numerical
-000064c0: 2064 6174 612e 0a0a 2020 2020 2020 2020   data...        
-000064d0: 5468 6520 6e75 6d62 6572 206f 6620 6172  The number of ar
-000064e0: 7261 7973 2072 6574 7572 6e65 6420 6279  rays returned by
-000064f0: 2074 6869 7320 6d65 7468 6f64 2064 6570   this method dep
-00006500: 656e 6473 206f 6e20 7468 650a 2020 2020  ends on the.    
-00006510: 2020 2020 7370 6563 6966 6963 2069 6e73      specific ins
-00006520: 7461 6e63 652e 204c 6574 2060 6073 6060  tance. Let ``s``
-00006530: 2062 6520 616e 2069 6e73 7461 6e63 6520   be an instance 
-00006540: 6f66 2060 6042 6173 6553 6572 6965 7360  of ``BaseSeries`
-00006550: 602e 0a20 2020 2020 2020 204d 616b 6520  `..        Make 
-00006560: 7375 7265 2074 6f20 7265 6164 2060 6068  sure to read ``h
-00006570: 656c 7028 732e 6765 745f 6461 7461 2960  elp(s.get_data)`
-00006580: 6020 746f 2075 6e64 6572 7374 616e 6420  ` to understand 
-00006590: 7768 6174 2069 7420 7265 7475 726e 732e  what it returns.
-000065a0: 0a20 2020 2020 2020 2022 2222 0a20 2020  .        """.   
-000065b0: 2020 2020 2072 6169 7365 204e 6f74 496d       raise NotIm
-000065c0: 706c 656d 656e 7465 6445 7272 6f72 0a0a  plementedError..
-000065d0: 2020 2020 6465 6620 5f67 6574 5f77 7261      def _get_wra
-000065e0: 7070 6564 5f6c 6162 656c 2873 656c 662c  pped_label(self,
-000065f0: 206c 6162 656c 2c20 7772 6170 7065 7229   label, wrapper)
-00006600: 3a0a 2020 2020 2020 2020 2222 2247 6976  :.        """Giv
-00006610: 656e 2061 206c 6174 6578 2072 6570 7265  en a latex repre
-00006620: 7365 6e74 6174 696f 6e20 6f66 2061 6e20  sentation of an 
-00006630: 6578 7072 6573 7369 6f6e 2c20 7772 6170  expression, wrap
-00006640: 2069 7420 696e 7369 6465 0a20 2020 2020   it inside.     
-00006650: 2020 2073 6f6d 6520 6368 6172 6163 7465     some characte
-00006660: 7273 2e20 4d61 7470 6c6f 746c 6962 206e  rs. Matplotlib n
-00006670: 6565 6473 2022 2425 7325 2422 2c20 4b33  eeds "$%s%$", K3
-00006680: 442d 4a75 7079 7465 7220 6e65 6564 7320  D-Jupyter needs 
-00006690: 2225 7322 2e0a 2020 2020 2020 2020 2222  "%s"..        ""
-000066a0: 220a 2020 2020 2020 2020 7265 7475 726e  ".        return
-000066b0: 2077 7261 7070 6572 2025 206c 6162 656c   wrapper % label
-000066c0: 0a0a 2020 2020 6465 6620 6765 745f 6c61  ..    def get_la
-000066d0: 6265 6c28 7365 6c66 2c20 7573 655f 6c61  bel(self, use_la
-000066e0: 7465 783d 4661 6c73 652c 2077 7261 7070  tex=False, wrapp
-000066f0: 6572 3d22 2425 7324 2229 3a0a 2020 2020  er="$%s$"):.    
-00006700: 2020 2020 2222 2252 6574 7572 6e20 7468      """Return th
-00006710: 6520 6c61 6265 6c20 746f 2062 6520 7573  e label to be us
-00006720: 6564 2074 6f20 6469 7370 6c61 7920 7468  ed to display th
-00006730: 6520 6578 7072 6573 7369 6f6e 2e0a 0a20  e expression... 
-00006740: 2020 2020 2020 2050 6172 616d 6574 6572         Parameter
-00006750: 730a 2020 2020 2020 2020 3d3d 3d3d 3d3d  s.        ======
-00006760: 3d3d 3d3d 0a20 2020 2020 2020 2075 7365  ====.        use
-00006770: 5f6c 6174 6578 203a 2062 6f6f 6c0a 2020  _latex : bool.  
-00006780: 2020 2020 2020 2020 2020 4966 2046 616c            If Fal
-00006790: 7365 2c20 7468 6520 7374 7269 6e67 2072  se, the string r
-000067a0: 6570 7265 7365 6e74 6174 696f 6e20 6f66  epresentation of
-000067b0: 2074 6865 2065 7870 7265 7373 696f 6e20   the expression 
-000067c0: 6973 2072 6574 7572 6e65 642e 0a20 2020  is returned..   
-000067d0: 2020 2020 2020 2020 2049 6620 5472 7565           If True
-000067e0: 2c20 7468 6520 6c61 7465 7820 7265 7072  , the latex repr
-000067f0: 6573 656e 7461 7469 6f6e 2069 7320 7265  esentation is re
-00006800: 7475 726e 6564 2e0a 2020 2020 2020 2020  turned..        
-00006810: 7772 6170 7065 7220 3a20 7374 720a 2020  wrapper : str.  
-00006820: 2020 2020 2020 2020 2020 5468 6520 6261            The ba
-00006830: 636b 656e 6420 6d69 6768 7420 6e65 6564  ckend might need
-00006840: 2074 6865 206c 6174 6578 2072 6570 7265   the latex repre
-00006850: 7365 6e74 6174 696f 6e20 746f 2062 6520  sentation to be 
-00006860: 7772 6170 7065 6420 6279 0a20 2020 2020  wrapped by.     
-00006870: 2020 2020 2020 2073 6f6d 6520 6368 6172         some char
-00006880: 6163 7465 7273 2e20 4465 6661 756c 7420  acters. Default 
-00006890: 746f 2060 6022 2425 7324 2260 602e 0a0a  to ``"$%s$"``...
-000068a0: 2020 2020 2020 2020 5265 7475 726e 730a          Returns.
-000068b0: 2020 2020 2020 2020 3d3d 3d3d 3d3d 3d0a          =======.
-000068c0: 2020 2020 2020 2020 6c61 6265 6c20 3a20          label : 
-000068d0: 7374 720a 2020 2020 2020 2020 2222 220a  str.        """.
-000068e0: 2020 2020 2020 2020 6966 2075 7365 5f6c          if use_l
-000068f0: 6174 6578 2069 7320 4661 6c73 653a 0a20  atex is False:. 
-00006900: 2020 2020 2020 2020 2020 2072 6574 7572             retur
-00006910: 6e20 7365 6c66 2e5f 6c61 6265 6c0a 2020  n self._label.  
-00006920: 2020 2020 2020 6966 2073 656c 662e 5f6c        if self._l
-00006930: 6162 656c 203d 3d20 7374 7228 7365 6c66  abel == str(self
-00006940: 2e65 7870 7229 3a0a 2020 2020 2020 2020  .expr):.        
-00006950: 2020 2020 7265 7475 726e 2073 656c 662e      return self.
-00006960: 5f67 6574 5f77 7261 7070 6564 5f6c 6162  _get_wrapped_lab
-00006970: 656c 2873 656c 662e 5f6c 6174 6578 5f6c  el(self._latex_l
-00006980: 6162 656c 2c20 7772 6170 7065 7229 0a20  abel, wrapper). 
-00006990: 2020 2020 2020 2072 6574 7572 6e20 7365         return se
-000069a0: 6c66 2e5f 6c61 7465 785f 6c61 6265 6c0a  lf._latex_label.
-000069b0: 0a20 2020 2040 7072 6f70 6572 7479 0a20  .    @property. 
-000069c0: 2020 2064 6566 206c 6162 656c 2873 656c     def label(sel
-000069d0: 6629 3a0a 2020 2020 2020 2020 7265 7475  f):.        retu
-000069e0: 726e 2073 656c 662e 6765 745f 6c61 6265  rn self.get_labe
-000069f0: 6c28 290a 0a20 2020 2040 6c61 6265 6c2e  l()..    @label.
-00006a00: 7365 7474 6572 0a20 2020 2064 6566 206c  setter.    def l
-00006a10: 6162 656c 2873 656c 662c 2076 616c 293a  abel(self, val):
-00006a20: 0a20 2020 2020 2020 2022 2222 5365 7420  .        """Set 
-00006a30: 7468 6520 6c61 6265 6c73 2061 7373 6f63  the labels assoc
-00006a40: 6961 7465 6420 746f 2074 6869 7320 7365  iated to this se
-00006a50: 7269 6573 2e22 2222 0a20 2020 2020 2020  ries.""".       
-00006a60: 2023 204e 4f54 453a 2074 6865 2069 6e69   # NOTE: the ini
-00006a70: 7420 6d65 7468 6f64 206f 6620 616e 7920  t method of any 
-00006a80: 7365 7269 6573 2072 6571 7569 7265 7320  series requires 
-00006a90: 6120 6c61 6265 6c2e 2049 6620 7468 6520  a label. If the 
-00006aa0: 7573 6572 2064 6f0a 2020 2020 2020 2020  user do.        
-00006ab0: 2320 6e6f 7420 7072 6f76 6964 6520 6974  # not provide it
-00006ac0: 2c20 7468 6520 7072 6570 726f 6365 7373  , the preprocess
-00006ad0: 696e 6720 6675 6e63 7469 6f6e 2077 696c  ing function wil
-00006ae0: 6c20 7365 7420 6c61 6265 6c3d 4e6f 6e65  l set label=None
-00006af0: 2c20 7768 6963 680a 2020 2020 2020 2020  , which.        
-00006b00: 2320 696e 666f 726d 7320 7468 6520 7365  # informs the se
-00006b10: 7269 6573 2074 6f20 696e 6974 6961 6c69  ries to initiali
-00006b20: 7a65 2074 776f 2061 7474 7269 6275 7465  ze two attribute
-00006b30: 733a 0a20 2020 2020 2020 2023 205f 6c61  s:.        # _la
-00006b40: 6265 6c20 636f 6e74 6169 6e73 2074 6865  bel contains the
-00006b50: 2073 7472 696e 6720 7265 7072 6573 656e   string represen
-00006b60: 7461 7469 6f6e 206f 6620 7468 6520 6578  tation of the ex
-00006b70: 7072 6573 7369 6f6e 2e0a 2020 2020 2020  pression..      
-00006b80: 2020 2320 5f6c 6174 6578 5f6c 6162 656c    # _latex_label
-00006b90: 2063 6f6e 7461 696e 7320 7468 6520 6c61   contains the la
-00006ba0: 7465 7820 7265 7072 6573 656e 7461 7469  tex representati
-00006bb0: 6f6e 206f 6620 7468 6520 6578 7072 6573  on of the expres
-00006bc0: 7369 6f6e 2e0a 2020 2020 2020 2020 7365  sion..        se
-00006bd0: 6c66 2e5f 6c61 6265 6c20 3d20 7365 6c66  lf._label = self
-00006be0: 2e5f 6c61 7465 785f 6c61 6265 6c20 3d20  ._latex_label = 
-00006bf0: 7661 6c0a 0a20 2020 2040 7072 6f70 6572  val..    @proper
-00006c00: 7479 0a20 2020 2064 6566 2072 616e 6765  ty.    def range
-00006c10: 7328 7365 6c66 293a 0a20 2020 2020 2020  s(self):.       
-00006c20: 2072 6574 7572 6e20 7365 6c66 2e5f 7261   return self._ra
-00006c30: 6e67 6573 0a0a 2020 2020 4072 616e 6765  nges..    @range
-00006c40: 732e 7365 7474 6572 0a20 2020 2064 6566  s.setter.    def
-00006c50: 2072 616e 6765 7328 7365 6c66 2c20 7661   ranges(self, va
-00006c60: 6c29 3a0a 2020 2020 2020 2020 6e65 775f  l):.        new_
-00006c70: 7661 6c73 203d 205b 5d0a 2020 2020 2020  vals = [].      
-00006c80: 2020 666f 7220 7620 696e 2076 616c 3a0a    for v in val:.
-00006c90: 2020 2020 2020 2020 2020 2020 6966 2076              if v
-00006ca0: 2069 7320 6e6f 7420 4e6f 6e65 3a0a 2020   is not None:.  
-00006cb0: 2020 2020 2020 2020 2020 2020 2020 6e65                ne
-00006cc0: 775f 7661 6c73 2e61 7070 656e 6428 7475  w_vals.append(tu
-00006cd0: 706c 6528 6d61 7028 7379 6d70 6966 792c  ple(map(sympify,
-00006ce0: 2076 2929 290a 0a20 2020 2020 2020 206e   v)))..        n
-00006cf0: 756d 6265 7273 5f6f 725f 6578 7072 6573  umbers_or_expres
-00006d00: 7369 6f6e 7320 3d20 7365 7428 292e 756e  sions = set().un
-00006d10: 696f 6e28 2a5b 6e76 5b31 3a5d 2066 6f72  ion(*[nv[1:] for
-00006d20: 206e 7620 696e 206e 6577 5f76 616c 735d   nv in new_vals]
-00006d30: 290a 2020 2020 2020 2020 6673 203d 2073  ).        fs = s
-00006d40: 6574 2829 2e75 6e69 6f6e 282a 5b65 2e66  et().union(*[e.f
-00006d50: 7265 655f 7379 6d62 6f6c 7320 666f 7220  ree_symbols for 
-00006d60: 6520 696e 206e 756d 6265 7273 5f6f 725f  e in numbers_or_
-00006d70: 6578 7072 6573 7369 6f6e 735d 290a 2020  expressions]).  
-00006d80: 2020 2020 2020 6966 206c 656e 2866 7329        if len(fs)
-00006d90: 203e 2030 3a0a 2020 2020 2020 2020 2020   > 0:.          
-00006da0: 2020 7365 6c66 2e5f 696e 7465 7261 6374    self._interact
-00006db0: 6976 655f 7261 6e67 6573 203d 2054 7275  ive_ranges = Tru
-00006dc0: 650a 2020 2020 2020 2020 7365 6c66 2e5f  e.        self._
-00006dd0: 7261 6e67 6573 203d 206e 6577 5f76 616c  ranges = new_val
-00006de0: 730a 0a20 2020 2064 6566 205f 6170 706c  s..    def _appl
-00006df0: 795f 7472 616e 7366 6f72 6d28 7365 6c66  y_transform(self
-00006e00: 2c20 2a61 7267 7329 3a0a 2020 2020 2020  , *args):.      
-00006e10: 2020 2222 2241 7070 6c79 2074 7261 6e73    """Apply trans
-00006e20: 666f 726d 6174 696f 6e73 2074 6f20 7468  formations to th
-00006e30: 6520 7265 7375 6c74 7320 6f66 206e 756d  e results of num
-00006e40: 6572 6963 616c 2065 7661 6c75 6174 696f  erical evaluatio
-00006e50: 6e2e 0a0a 2020 2020 2020 2020 5061 7261  n...        Para
-00006e60: 6d65 7465 7273 0a20 2020 2020 2020 203d  meters.        =
-00006e70: 3d3d 3d3d 3d3d 3d3d 3d0a 2020 2020 2020  =========.      
-00006e80: 2020 6172 6773 203a 2074 7570 6c65 0a20    args : tuple. 
-00006e90: 2020 2020 2020 2020 2020 2052 6573 756c             Resul
-00006ea0: 7473 206f 6620 6e75 6d65 7269 6361 6c20  ts of numerical 
-00006eb0: 6576 616c 7561 7469 6f6e 2e0a 0a20 2020  evaluation...   
-00006ec0: 2020 2020 2052 6574 7572 6e73 0a20 2020       Returns.   
-00006ed0: 2020 2020 203d 3d3d 3d3d 3d3d 0a20 2020       =======.   
-00006ee0: 2020 2020 2074 7261 6e73 666f 726d 6564       transformed
-00006ef0: 5f61 7267 7320 3a20 7475 706c 650a 2020  _args : tuple.  
-00006f00: 2020 2020 2020 2020 2020 5475 706c 6520            Tuple 
-00006f10: 636f 6e74 6169 6e69 6e67 2074 6865 2074  containing the t
-00006f20: 7261 6e73 666f 726d 6564 2072 6573 756c  ransformed resul
-00006f30: 7473 2e0a 2020 2020 2020 2020 2222 220a  ts..        """.
-00006f40: 2020 2020 2020 2020 7420 3d20 6c61 6d62          t = lamb
-00006f50: 6461 2078 2c20 7472 616e 7366 6f72 6d3a  da x, transform:
-00006f60: 2078 2069 6620 7472 616e 7366 6f72 6d20   x if transform 
-00006f70: 6973 204e 6f6e 6520 656c 7365 2074 7261  is None else tra
-00006f80: 6e73 666f 726d 2878 290a 2020 2020 2020  nsform(x).      
-00006f90: 2020 782c 2079 2c20 7a20 3d20 4e6f 6e65    x, y, z = None
-00006fa0: 2c20 4e6f 6e65 2c20 4e6f 6e65 0a20 2020  , None, None.   
-00006fb0: 2020 2020 2069 6620 6c65 6e28 6172 6773       if len(args
-00006fc0: 2920 3d3d 2032 3a0a 2020 2020 2020 2020  ) == 2:.        
-00006fd0: 2020 2020 782c 2079 203d 2061 7267 730a      x, y = args.
-00006fe0: 2020 2020 2020 2020 2020 2020 7265 7475              retu
-00006ff0: 726e 2074 2878 2c20 7365 6c66 2e5f 7478  rn t(x, self._tx
-00007000: 292c 2074 2879 2c20 7365 6c66 2e5f 7479  ), t(y, self._ty
-00007010: 290a 2020 2020 2020 2020 656c 6966 2028  ).        elif (
-00007020: 0a20 2020 2020 2020 2020 2020 2028 6c65  .            (le
-00007030: 6e28 6172 6773 2920 3d3d 2033 2920 616e  n(args) == 3) an
-00007040: 6420 6973 696e 7374 616e 6365 2873 656c  d isinstance(sel
-00007050: 662c 2028 0a20 2020 2020 2020 2020 2020  f, (.           
-00007060: 2020 2020 2050 6172 616d 6574 7269 6332       Parametric2
-00007070: 444c 696e 6553 6572 6965 732c 2043 6f6c  DLineSeries, Col
-00007080: 6f72 6564 4c69 6e65 4f76 6572 3144 5261  oredLineOver1DRa
-00007090: 6e67 6553 6572 6965 732c 0a20 2020 2020  ngeSeries,.     
-000070a0: 2020 2020 2020 2020 2020 2043 6f6c 6f72             Color
-000070b0: 6564 5379 7374 656d 5265 7370 6f6e 7365  edSystemResponse
-000070c0: 5365 7269 6573 2929 0a20 2020 2020 2020  Series)).       
-000070d0: 2029 3a0a 2020 2020 2020 2020 2020 2020   ):.            
-000070e0: 782c 2079 2c20 7520 3d20 6172 6773 0a20  x, y, u = args. 
-000070f0: 2020 2020 2020 2020 2020 2072 6574 7572             retur
-00007100: 6e20 2874 2878 2c20 7365 6c66 2e5f 7478  n (t(x, self._tx
-00007110: 292c 2074 2879 2c20 7365 6c66 2e5f 7479  ), t(y, self._ty
-00007120: 292c 2074 2875 2c20 7365 6c66 2e5f 7470  ), t(u, self._tp
-00007130: 2929 0a20 2020 2020 2020 2065 6c69 6620  )).        elif 
-00007140: 6c65 6e28 6172 6773 2920 3d3d 2033 3a0a  len(args) == 3:.
-00007150: 2020 2020 2020 2020 2020 2020 782c 2079              x, y
-00007160: 2c20 7a20 3d20 6172 6773 0a20 2020 2020  , z = args.     
-00007170: 2020 2020 2020 2072 6574 7572 6e20 7428         return t(
-00007180: 782c 2073 656c 662e 5f74 7829 2c20 7428  x, self._tx), t(
-00007190: 792c 2073 656c 662e 5f74 7929 2c20 7428  y, self._ty), t(
-000071a0: 7a2c 2073 656c 662e 5f74 7a29 0a20 2020  z, self._tz).   
-000071b0: 2020 2020 2065 6c69 6620 286c 656e 2861       elif (len(a
-000071c0: 7267 7329 203d 3d20 3429 2061 6e64 2069  rgs) == 4) and i
-000071d0: 7369 6e73 7461 6e63 6528 7365 6c66 2c20  sinstance(self, 
-000071e0: 5061 7261 6d65 7472 6963 3344 4c69 6e65  Parametric3DLine
-000071f0: 5365 7269 6573 293a 0a20 2020 2020 2020  Series):.       
-00007200: 2020 2020 2078 2c20 792c 207a 2c20 7520       x, y, z, u 
-00007210: 3d20 6172 6773 0a20 2020 2020 2020 2020  = args.         
-00007220: 2020 2072 6574 7572 6e20 2874 2878 2c20     return (t(x, 
-00007230: 7365 6c66 2e5f 7478 292c 2074 2879 2c20  self._tx), t(y, 
-00007240: 7365 6c66 2e5f 7479 292c 2074 287a 2c20  self._ty), t(z, 
-00007250: 7365 6c66 2e5f 747a 292c 2074 2875 2c20  self._tz), t(u, 
-00007260: 7365 6c66 2e5f 7470 2929 0a20 2020 2020  self._tp)).     
-00007270: 2020 2065 6c69 6620 6c65 6e28 6172 6773     elif len(args
-00007280: 2920 3d3d 2034 3a20 2023 2032 4420 7665  ) == 4:  # 2D ve
-00007290: 6374 6f72 2070 6c6f 740a 2020 2020 2020  ctor plot.      
-000072a0: 2020 2020 2020 782c 2079 2c20 752c 2076        x, y, u, v
-000072b0: 203d 2061 7267 730a 2020 2020 2020 2020   = args.        
-000072c0: 2020 2020 7265 7475 726e 2028 0a20 2020      return (.   
-000072d0: 2020 2020 2020 2020 2020 2020 2074 2878               t(x
-000072e0: 2c20 7365 6c66 2e5f 7478 292c 2074 2879  , self._tx), t(y
-000072f0: 2c20 7365 6c66 2e5f 7479 292c 0a20 2020  , self._ty),.   
-00007300: 2020 2020 2020 2020 2020 2020 2074 2875               t(u
-00007310: 2c20 7365 6c66 2e5f 7478 292c 2074 2876  , self._tx), t(v
-00007320: 2c20 7365 6c66 2e5f 7479 290a 2020 2020  , self._ty).    
-00007330: 2020 2020 2020 2020 290a 2020 2020 2020          ).      
-00007340: 2020 656c 6966 2028 6c65 6e28 6172 6773    elif (len(args
-00007350: 2920 3d3d 2035 2920 616e 6420 6973 696e  ) == 5) and isin
-00007360: 7374 616e 6365 2873 656c 662c 2050 6172  stance(self, Par
-00007370: 616d 6574 7269 6353 7572 6661 6365 5365  ametricSurfaceSe
-00007380: 7269 6573 293a 0a20 2020 2020 2020 2020  ries):.         
-00007390: 2020 2078 2c20 792c 207a 2c20 752c 2076     x, y, z, u, v
-000073a0: 203d 2061 7267 730a 2020 2020 2020 2020   = args.        
-000073b0: 2020 2020 7265 7475 726e 2028 7428 782c      return (t(x,
-000073c0: 2073 656c 662e 5f74 7829 2c20 7428 792c   self._tx), t(y,
-000073d0: 2073 656c 662e 5f74 7929 2c20 7428 7a2c   self._ty), t(z,
-000073e0: 2073 656c 662e 5f74 7a29 2c20 752c 2076   self._tz), u, v
-000073f0: 290a 2020 2020 2020 2020 656c 6966 2028  ).        elif (
-00007400: 6c65 6e28 6172 6773 2920 3d3d 2036 2920  len(args) == 6) 
-00007410: 616e 6420 7365 6c66 2e69 735f 3344 7665  and self.is_3Dve
-00007420: 6374 6f72 3a20 2023 2033 4420 7665 6374  ctor:  # 3D vect
-00007430: 6f72 2070 6c6f 740a 2020 2020 2020 2020  or plot.        
-00007440: 2020 2020 782c 2079 2c20 7a2c 2075 2c20      x, y, z, u, 
-00007450: 762c 2077 203d 2061 7267 730a 2020 2020  v, w = args.    
-00007460: 2020 2020 2020 2020 7265 7475 726e 2028          return (
-00007470: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00007480: 2074 2878 2c20 7365 6c66 2e5f 7478 292c   t(x, self._tx),
-00007490: 2074 2879 2c20 7365 6c66 2e5f 7479 292c   t(y, self._ty),
-000074a0: 2074 287a 2c20 7365 6c66 2e5f 747a 292c   t(z, self._tz),
-000074b0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-000074c0: 2074 2875 2c20 7365 6c66 2e5f 7478 292c   t(u, self._tx),
-000074d0: 2074 2876 2c20 7365 6c66 2e5f 7479 292c   t(v, self._ty),
-000074e0: 2074 2877 2c20 7365 6c66 2e5f 747a 290a   t(w, self._tz).
-000074f0: 2020 2020 2020 2020 2020 2020 290a 2020              ).  
-00007500: 2020 2020 2020 656c 6966 206c 656e 2861        elif len(a
-00007510: 7267 7329 203d 3d20 363a 2020 2320 636f  rgs) == 6:  # co
-00007520: 6d70 6c65 7820 706c 6f74 0a20 2020 2020  mplex plot.     
-00007530: 2020 2020 2020 2078 2c20 792c 205f 6162         x, y, _ab
-00007540: 732c 205f 6172 672c 2069 6d67 2c20 636f  s, _arg, img, co
-00007550: 6c6f 7273 203d 2061 7267 730a 2020 2020  lors = args.    
-00007560: 2020 2020 2020 2020 7265 7475 726e 2028          return (
-00007570: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00007580: 2074 2878 2c20 7365 6c66 2e5f 7478 292c   t(x, self._tx),
-00007590: 2074 2879 2c20 7365 6c66 2e5f 7479 292c   t(y, self._ty),
-000075a0: 2074 285f 6162 732c 2073 656c 662e 5f74   t(_abs, self._t
-000075b0: 7a29 2c0a 2020 2020 2020 2020 2020 2020  z),.            
-000075c0: 2020 2020 5f61 7267 2c20 696d 672c 2063      _arg, img, c
-000075d0: 6f6c 6f72 730a 2020 2020 2020 2020 2020  olors.          
-000075e0: 2020 290a 2020 2020 2020 2020 7265 7475    ).        retu
-000075f0: 726e 2061 7267 730a 0a20 2020 2064 6566  rn args..    def
-00007600: 205f 7374 725f 6865 6c70 6572 2873 656c   _str_helper(sel
-00007610: 662c 2073 293a 0a20 2020 2020 2020 2070  f, s):.        p
-00007620: 7265 2c20 706f 7374 203d 2022 222c 2022  re, post = "", "
-00007630: 220a 2020 2020 2020 2020 6966 2073 656c  ".        if sel
-00007640: 662e 6973 5f69 6e74 6572 6163 7469 7665  f.is_interactive
-00007650: 3a0a 2020 2020 2020 2020 2020 2020 7072  :.            pr
-00007660: 6520 3d20 2269 6e74 6572 6163 7469 7665  e = "interactive
-00007670: 2022 0a20 2020 2020 2020 2020 2020 2070   ".            p
-00007680: 6f73 7420 3d20 2220 616e 6420 7061 7261  ost = " and para
-00007690: 6d65 7465 7273 2022 202b 2073 7472 2874  meters " + str(t
-000076a0: 7570 6c65 2873 656c 662e 7061 7261 6d73  uple(self.params
-000076b0: 2e6b 6579 7328 2929 290a 2020 2020 2020  .keys())).      
-000076c0: 2020 7265 7475 726e 2070 7265 202b 2073    return pre + s
-000076d0: 202b 2070 6f73 740a 0a0a 636c 6173 7320   + post...class 
-000076e0: 436f 6d6d 6f6e 4164 6170 7469 7665 4576  CommonAdaptiveEv
-000076f0: 616c 7561 7469 6f6e 3a0a 2020 2020 2222  aluation:.    ""
-00007700: 2249 6620 6120 6461 7461 2073 6572 6965  "If a data serie
-00007710: 7320 7573 6573 2074 6865 2070 7974 686f  s uses the pytho
-00007720: 6e2d 6164 6170 7469 7665 206d 6f64 756c  n-adaptive modul
-00007730: 652c 2069 7420 7368 6f75 6c64 0a20 2020  e, it should.   
-00007740: 2069 6e68 6572 6974 6820 6672 6f6d 2074   inherith from t
-00007750: 6869 7320 6d69 7869 6e2e 0a20 2020 2022  his mixin..    "
-00007760: 2222 0a20 2020 205f 616c 6c6f 7765 645f  "".    _allowed_
-00007770: 6b65 7973 203d 205b 0a20 2020 2020 2020  keys = [.       
-00007780: 2022 6164 6170 7469 7665 222c 2022 6164   "adaptive", "ad
-00007790: 6170 7469 7665 5f67 6f61 6c22 2c20 226c  aptive_goal", "l
-000077a0: 6f73 735f 666e 220a 2020 2020 5d0a 0a20  oss_fn".    ].. 
-000077b0: 2020 2064 6566 205f 5f69 6e69 745f 5f28     def __init__(
-000077c0: 7365 6c66 2c20 2a61 7267 732c 202a 2a6b  self, *args, **k
-000077d0: 7761 7267 7329 3a0a 2020 2020 2020 2020  wargs):.        
-000077e0: 7375 7065 7228 292e 5f5f 696e 6974 5f5f  super().__init__
-000077f0: 282a 6172 6773 2c20 2a2a 6b77 6172 6773  (*args, **kwargs
-00007800: 290a 2020 2020 2020 2020 7365 6c66 2e61  ).        self.a
-00007810: 6461 7074 6976 6520 3d20 6b77 6172 6773  daptive = kwargs
-00007820: 2e67 6574 280a 2020 2020 2020 2020 2020  .get(.          
-00007830: 2020 2261 6461 7074 6976 6522 2c20 6366    "adaptive", cf
-00007840: 675b 2261 6461 7074 6976 6522 5d5b 2275  g["adaptive"]["u
-00007850: 7365 645f 6279 5f64 6566 6175 6c74 225d  sed_by_default"]
-00007860: 290a 2020 2020 2020 2020 7365 6c66 2e61  ).        self.a
-00007870: 6461 7074 6976 655f 676f 616c 203d 206b  daptive_goal = k
-00007880: 7761 7267 732e 6765 7428 0a20 2020 2020  wargs.get(.     
-00007890: 2020 2020 2020 2022 6164 6170 7469 7665         "adaptive
-000078a0: 5f67 6f61 6c22 2c20 6366 675b 2261 6461  _goal", cfg["ada
-000078b0: 7074 6976 6522 5d5b 2267 6f61 6c22 5d29  ptive"]["goal"])
-000078c0: 0a20 2020 2020 2020 2073 656c 662e 6c6f  .        self.lo
-000078d0: 7373 5f66 6e20 3d20 6b77 6172 6773 2e67  ss_fn = kwargs.g
-000078e0: 6574 2822 6c6f 7373 5f66 6e22 2c20 4e6f  et("loss_fn", No
-000078f0: 6e65 290a 0a0a 636c 6173 7320 436f 6d6d  ne)...class Comm
-00007900: 6f6e 556e 6966 6f72 6d45 7661 6c75 6174  onUniformEvaluat
-00007910: 696f 6e3a 0a20 2020 2022 2222 4d61 6e79  ion:.    """Many
-00007920: 2070 6c6f 7474 696e 6720 6675 6e63 7469   plotting functi
-00007930: 6f6e 7320 7265 7365 6d62 6c65 2074 6869  ons resemble thi
-00007940: 7320 666f 726d 3a0a 0a20 2020 202e 2e20  s form:..    .. 
-00007950: 636f 6465 2d62 6c6f 636b 3a3a 2070 7974  code-block:: pyt
-00007960: 686f 6e0a 0a20 2020 2020 2020 706c 6f74  hon..       plot
-00007970: 5f66 756e 6374 696f 6e28 0a20 2020 2020  _function(.     
-00007980: 2020 2020 2020 6578 7072 312c 2065 7870        expr1, exp
-00007990: 7232 205b 6f70 745d 2c20 2e2e 2e2c 0a20  r2 [opt], ...,. 
-000079a0: 2020 2020 2020 2020 2020 7261 6e67 6531            range1
-000079b0: 2c20 7261 6e67 6532 205b 6f70 745d 2c20  , range2 [opt], 
-000079c0: 2e2e 2e2c 0a20 2020 2020 2020 2020 2020  ...,.           
-000079d0: 7061 7261 6d73 3d64 6963 7428 290a 2020  params=dict().  
-000079e0: 2020 2020 2029 0a0a 2020 2020 4e61 6d65       )..    Name
-000079f0: 6c79 2c20 7468 6572 6520 6172 6520 6f6e  ly, there are on
-00007a00: 6520 6f72 206d 6f72 6520 7379 6d62 6f6c  e or more symbol
-00007a10: 6963 2065 7870 7265 7373 696f 6e73 2074  ic expressions t
-00007a20: 6f20 7265 7072 6573 656e 7420 6120 6375  o represent a cu
-00007a30: 7276 650a 2020 2020 6f72 2073 7572 6661  rve.    or surfa
-00007a40: 6365 2c20 7468 6174 2073 686f 756c 6420  ce, that should 
-00007a50: 6265 2065 7661 6c75 6174 6564 206f 7665  be evaluated ove
-00007a60: 7220 6f6e 6520 6f72 206d 6f72 6520 7261  r one or more ra
-00007a70: 6e67 6573 2c20 7769 7468 207a 6572 6f0a  nges, with zero.
-00007a80: 2020 2020 6f72 206d 6f72 6520 7061 7261      or more para
-00007a90: 6d65 7465 7273 2028 7768 6f73 6520 7661  meters (whose va
-00007aa0: 6c75 6573 2063 6f6d 6520 6672 6f6d 2069  lues come from i
-00007ab0: 6e74 6572 6163 7469 7665 2077 6964 6765  nteractive widge
-00007ac0: 7473 292e 0a0a 2020 2020 5468 6973 2063  ts)...    This c
-00007ad0: 6c61 7373 2061 7574 6f6d 6174 6573 2074  lass automates t
-00007ae0: 6865 2066 6f6c 6c6f 7769 6e67 2070 726f  he following pro
-00007af0: 6365 7373 6573 3a0a 0a20 2020 2031 2e20  cesses:..    1. 
-00007b00: 4372 6561 7465 206c 616d 6264 6120 6675  Create lambda fu
-00007b10: 6e63 7469 6f6e 7320 6672 6f6d 2073 796d  nctions from sym
-00007b20: 626f 6c69 6320 6578 7072 6573 7369 6f6e  bolic expression
-00007b30: 732e 2049 6e20 7061 7274 6963 756c 6172  s. In particular
-00007b40: 2c20 6974 0a20 2020 2020 2020 6372 6561  , it.       crea
-00007b50: 7465 7320 6f6e 6520 6c61 6d62 6461 2066  tes one lambda f
-00007b60: 756e 6374 696f 6e20 746f 2062 6520 6576  unction to be ev
-00007b70: 616c 7561 7465 6420 7769 7468 2074 6865  aluated with the
-00007b80: 2073 7065 6369 6669 6564 206d 6f64 756c   specified modul
-00007b90: 650a 2020 2020 2020 2028 7573 7561 6c6c  e.       (usuall
-00007ba0: 7920 4e75 6d50 7929 2c20 616e 6420 616e  y NumPy), and an
-00007bb0: 6f74 6865 7220 6c61 6d62 6461 2066 756e  other lambda fun
-00007bc0: 6374 696f 6e20 746f 2062 6520 6576 616c  ction to be eval
-00007bd0: 7561 7465 6420 7769 7468 0a20 2020 2020  uated with.     
-00007be0: 2020 5379 6d50 792c 2069 6e20 6361 7365    SymPy, in case
-00007bf0: 2074 6865 7265 2061 7265 2061 6e79 2065   there are any e
-00007c00: 7272 6f72 7320 7769 7468 2074 6865 2066  rrors with the f
-00007c10: 6972 7374 2e0a 2020 2020 322e 2043 7265  irst..    2. Cre
-00007c20: 6174 6520 6e75 6d65 7269 6361 6c20 6172  ate numerical ar
-00007c30: 7261 7973 2072 6570 7265 7365 6e74 696e  rays representin
-00007c40: 6720 7261 6e67 6573 2c20 6163 636f 7264  g ranges, accord
-00007c50: 696e 6720 746f 2074 6865 2073 7065 6369  ing to the speci
-00007c60: 6669 6564 0a20 2020 2020 2020 6469 7363  fied.       disc
-00007c70: 7265 7469 7a61 7469 6f6e 2073 7472 6174  retization strat
-00007c80: 6567 7920 286c 696e 6561 7220 6f72 206c  egy (linear or l
-00007c90: 6f67 6172 6974 686d 6963 292e 2055 7375  ogarithmic). Usu
-00007ca0: 616c 6c79 2c20 7468 6573 6520 6172 7261  ally, these arra
-00007cb0: 7973 0a20 2020 2020 2020 6172 6520 6f66  ys.       are of
-00007cc0: 2074 7970 6520 636f 6d70 6c65 782c 2075   type complex, u
-00007cd0: 6e6c 6573 7320 6060 666f 7263 655f 7265  nless ``force_re
-00007ce0: 616c 5f65 7661 6c3d 5472 7565 6060 2069  al_eval=True`` i
-00007cf0: 7320 7072 6f76 6964 6564 2069 6e20 7468  s provided in th
-00007d00: 650a 2020 2020 2020 2060 6070 6c6f 745f  e.       ``plot_
-00007d10: 6675 6e63 7469 6f6e 6060 2063 616c 6c2e  function`` call.
-00007d20: 0a20 2020 2033 2e20 4576 616c 7561 7465  .    3. Evaluate
-00007d30: 2065 6163 6820 6c61 6d62 6461 2066 756e   each lambda fun
-00007d40: 6374 696f 6e20 7769 7468 2074 6865 2061  ction with the a
-00007d50: 7070 726f 7072 6961 7465 2061 7272 6179  ppropriate array
-00007d60: 7320 616e 640a 2020 2020 2020 2070 6172  s and.       par
-00007d70: 616d 6574 6572 732e 0a0a 2020 2020 4368  ameters...    Ch
-00007d80: 696c 6420 7365 7269 6573 2073 686f 756c  ild series shoul
-00007d90: 6420 6361 6c6c 2060 6073 656c 662e 5f65  d call ``self._e
-00007da0: 7661 6c75 6174 6528 2960 6020 696e 206f  valuate()`` in o
-00007db0: 7264 6572 2074 6f20 6765 740a 2020 2020  rder to get.    
-00007dc0: 6e75 6d65 7269 6361 6c20 6461 7461 2c20  numerical data, 
-00007dd0: 7768 6963 6820 7368 6f75 6c64 2074 6865  which should the
-00007de0: 6e20 6265 2070 6f73 742d 7072 6f63 6573  n be post-proces
-00007df0: 7365 642e 0a0a 2020 2020 4e6f 7465 3a20  sed...    Note: 
-00007e00: 6974 2773 206e 6f74 206d 616e 6461 746f  it's not mandato
-00007e10: 7279 2074 6f20 7573 6520 7468 6973 2063  ry to use this c
-00007e20: 6c61 7373 2e20 466f 7220 6578 616d 706c  lass. For exampl
-00007e30: 652c 2063 6f6e 7472 6f6c 2073 7973 7465  e, control syste
-00007e40: 6d0a 2020 2020 7265 6c61 7465 6420 6461  m.    related da
-00007e50: 7461 2073 6572 6965 7320 646f 6e27 7420  ta series don't 
-00007e60: 6e65 6564 2074 6869 7320 6d61 6368 696e  need this machin
-00007e70: 6572 792e 0a20 2020 2022 2222 0a0a 2020  ery..    """..  
-00007e80: 2020 5f61 6c6c 6f77 6564 5f6b 6579 7320    _allowed_keys 
-00007e90: 3d20 5b0a 2020 2020 2020 2020 2266 6f72  = [.        "for
-00007ea0: 6365 5f72 6561 6c5f 6576 616c 222c 2022  ce_real_eval", "
-00007eb0: 6f6e 6c79 5f69 6e74 6567 6572 7322 2c20  only_integers", 
-00007ec0: 226d 6f64 756c 6573 222c 2022 6973 5f70  "modules", "is_p
-00007ed0: 6f6c 6172 220a 2020 2020 5d0a 0a20 2020  olar".    ]..   
-00007ee0: 2064 6566 205f 5f69 6e69 745f 5f28 7365   def __init__(se
-00007ef0: 6c66 2c20 2a61 7267 732c 202a 2a6b 7761  lf, *args, **kwa
-00007f00: 7267 7329 3a0a 2020 2020 2020 2020 7375  rgs):.        su
-00007f10: 7065 7228 292e 5f5f 696e 6974 5f5f 282a  per().__init__(*
-00007f20: 6172 6773 2c20 2a2a 6b77 6172 6773 290a  args, **kwargs).
-00007f30: 2020 2020 2020 2020 2320 6c69 7374 206f          # list o
-00007f40: 6620 6e75 6d65 7269 6361 6c20 6675 6e63  f numerical func
-00007f50: 7469 6f6e 7320 7265 7072 6573 656e 7469  tions representi
-00007f60: 6e67 2074 6865 2065 7870 7265 7373 696f  ng the expressio
-00007f70: 6e73 2074 6f20 6576 616c 7561 7465 0a20  ns to evaluate. 
-00007f80: 2020 2020 2020 2073 656c 662e 5f66 756e         self._fun
-00007f90: 6374 696f 6e73 203d 205b 5d0a 2020 2020  ctions = [].    
-00007fa0: 2020 2020 2320 7369 676e 6174 7572 6520      # signature 
-00007fb0: 6f66 2066 6f72 2074 6865 206e 756d 6572  of for the numer
-00007fc0: 6963 616c 2066 756e 6374 696f 6e73 0a20  ical functions. 
-00007fd0: 2020 2020 2020 2073 656c 662e 5f73 6967         self._sig
-00007fe0: 6e61 7475 7265 203d 205b 5d0a 2020 2020  nature = [].    
-00007ff0: 2020 2020 2320 736f 6d65 2065 7870 7265      # some expre
-00008000: 7373 696f 6e73 2064 6f6e 2774 206c 696b  ssions don't lik
-00008010: 6520 746f 2062 6520 6576 616c 7561 7465  e to be evaluate
-00008020: 6420 6f76 6572 2063 6f6d 706c 6578 2064  d over complex d
-00008030: 6174 612e 0a20 2020 2020 2020 2023 2069  ata..        # i
-00008040: 6620 7468 6174 2773 2074 6865 2063 6173  f that's the cas
-00008050: 652c 2073 6574 2074 6869 7320 746f 2054  e, set this to T
-00008060: 7275 650a 2020 2020 2020 2020 7365 6c66  rue.        self
-00008070: 2e5f 666f 7263 655f 7265 616c 5f65 7661  ._force_real_eva
-00008080: 6c20 3d20 6b77 6172 6773 2e67 6574 2822  l = kwargs.get("
-00008090: 666f 7263 655f 7265 616c 5f65 7661 6c22  force_real_eval"
-000080a0: 2c20 4e6f 6e65 290a 2020 2020 2020 2020  , None).        
-000080b0: 2320 6576 656e 7475 616c 6c79 2069 7420  # eventually it 
-000080c0: 7769 6c6c 2063 6f6e 7461 696e 2061 2064  will contain a d
-000080d0: 6963 7469 6f6e 6172 7920 7769 7468 2074  ictionary with t
-000080e0: 6865 2064 6973 6372 6574 697a 6564 2072  he discretized r
-000080f0: 616e 6765 730a 2020 2020 2020 2020 7365  anges.        se
-00008100: 6c66 2e5f 6469 7363 7265 7469 7a65 645f  lf._discretized_
-00008110: 646f 6d61 696e 203d 204e 6f6e 650a 2020  domain = None.  
-00008120: 2020 2020 2020 2320 4e4f 5445 3a20 636f        # NOTE: co
-00008130: 6e73 6964 6572 2061 2067 656e 6572 6963  nsider a generic
-00008140: 2073 756d 6d61 7469 6f6e 2c20 666f 7220   summation, for 
-00008150: 6578 616d 706c 653a 0a20 2020 2020 2020  example:.       
-00008160: 2023 2020 2073 203d 2053 756d 2863 6f73   #   s = Sum(cos
-00008170: 2870 6920 2a20 7829 2c20 2878 2c20 312c  (pi * x), (x, 1,
-00008180: 2079 2929 0a20 2020 2020 2020 2023 2054   y)).        # T
-00008190: 6869 7320 6765 7473 206c 616d 6264 6966  his gets lambdif
-000081a0: 6965 6420 746f 2073 6f6d 6574 6869 6e67  ied to something
-000081b0: 3a0a 2020 2020 2020 2020 2320 2020 7375  :.        #   su
-000081c0: 6d28 636f 7328 7069 2a78 2920 666f 7220  m(cos(pi*x) for 
-000081d0: 7820 696e 2072 616e 6765 2831 2c20 792b  x in range(1, y+
-000081e0: 3129 290a 2020 2020 2020 2020 2320 4865  1)).        # He
-000081f0: 6e63 652c 2079 206e 6565 6473 2074 6f20  nce, y needs to 
-00008200: 6265 2061 6e20 696e 7465 6765 722c 206f  be an integer, o
-00008210: 7468 6572 7769 7365 2069 7420 7261 6973  therwise it rais
-00008220: 6573 3a0a 2020 2020 2020 2020 2320 2020  es:.        #   
-00008230: 5479 7065 4572 726f 723a 2027 636f 6d70  TypeError: 'comp
-00008240: 6c65 7827 206f 626a 6563 7420 6361 6e6e  lex' object cann
-00008250: 6f74 2062 6520 696e 7465 7270 7265 7465  ot be interprete
-00008260: 6420 6173 2061 6e20 696e 7465 6765 720a  d as an integer.
-00008270: 2020 2020 2020 2020 2320 5468 6973 206c          # This l
-00008280: 6973 7420 7769 6c6c 2063 6f6e 7461 696e  ist will contain
-00008290: 7320 7379 6d62 6f6c 7320 7468 6174 2061  s symbols that a
-000082a0: 7265 2075 7070 6572 2062 6f75 6e64 2074  re upper bound t
-000082b0: 6f20 7375 6d6d 6174 696f 6e73 0a20 2020  o summations.   
-000082c0: 2020 2020 2023 206f 7220 7072 6f64 7563       # or produc
-000082d0: 7473 0a20 2020 2020 2020 2073 656c 662e  ts.        self.
-000082e0: 5f6e 6565 6473 5f74 6f5f 6265 5f69 6e74  _needs_to_be_int
-000082f0: 203d 205b 5d0a 2020 2020 2020 2020 2320   = [].        # 
-00008300: 6469 7363 7265 7469 7a65 2074 6865 2064  discretize the d
-00008310: 6f6d 6169 6e20 7573 696e 6720 6f6e 6c79  omain using only
-00008320: 2069 6e74 6567 6572 206e 756d 6265 7273   integer numbers
-00008330: 0a20 2020 2020 2020 2073 656c 662e 6f6e  .        self.on
-00008340: 6c79 5f69 6e74 6567 6572 7320 3d20 6b77  ly_integers = kw
-00008350: 6172 6773 2e67 6574 2822 6f6e 6c79 5f69  args.get("only_i
-00008360: 6e74 6567 6572 7322 2c20 4661 6c73 6529  ntegers", False)
-00008370: 0a20 2020 2020 2020 2069 6620 6861 7361  .        if hasa
-00008380: 7474 7228 7365 6c66 2c20 2261 6461 7074  ttr(self, "adapt
-00008390: 6976 6522 2920 616e 6420 7365 6c66 2e61  ive") and self.a
-000083a0: 6461 7074 6976 6520 616e 6420 7365 6c66  daptive and self
-000083b0: 2e6f 6e6c 795f 696e 7465 6765 7273 3a0a  .only_integers:.
-000083c0: 2020 2020 2020 2020 2020 2020 7761 726e              warn
-000083d0: 696e 6773 2e77 6172 6e28 0a20 2020 2020  ings.warn(.     
-000083e0: 2020 2020 2020 2020 2020 2022 6060 6f6e             "``on
-000083f0: 6c79 5f69 6e74 6567 6572 733d 5472 7565  ly_integers=True
-00008400: 6060 2069 7320 6e6f 7420 7375 7070 6f72  `` is not suppor
-00008410: 7465 6420 6279 2074 6865 2061 6461 7074  ted by the adapt
-00008420: 6976 6520 220a 2020 2020 2020 2020 2020  ive ".          
-00008430: 2020 2020 2020 2261 6c67 6f72 6974 686d        "algorithm
-00008440: 2e20 4175 746f 6d61 7469 6361 6c6c 7920  . Automatically 
-00008450: 7365 7474 696e 6720 6060 6164 6170 7469  setting ``adapti
-00008460: 7665 3d46 616c 7365 6060 2e22 0a20 2020  ve=False``.".   
-00008470: 2020 2020 2020 2020 2029 0a20 2020 2020           ).     
-00008480: 2020 2020 2020 2073 656c 662e 6164 6170         self.adap
-00008490: 7469 7665 203d 2046 616c 7365 0a20 2020  tive = False.   
-000084a0: 2020 2020 2023 2072 6570 7265 7365 6e74       # represent
-000084b0: 7320 7468 6520 6576 616c 7561 7469 6f6e  s the evaluation
-000084c0: 206d 6f64 756c 6573 2074 6f20 6265 2075   modules to be u
-000084d0: 7365 6420 6279 206c 616d 6264 6966 790a  sed by lambdify.
-000084e0: 2020 2020 2020 2020 7365 6c66 2e6d 6f64          self.mod
-000084f0: 756c 6573 203d 206b 7761 7267 732e 6765  ules = kwargs.ge
-00008500: 7428 226d 6f64 756c 6573 222c 204e 6f6e  t("modules", Non
-00008510: 6529 0a20 2020 2020 2020 2023 2049 6620  e).        # If 
-00008520: 5472 7565 2c20 7468 6520 6261 636b 656e  True, the backen
-00008530: 6420 7769 6c6c 2061 7474 656d 7074 2074  d will attempt t
-00008540: 6f20 7265 6e64 6572 2069 7420 6f6e 2061  o render it on a
-00008550: 2070 6f6c 6172 2d70 726f 6a65 6374 696f   polar-projectio
-00008560: 6e0a 2020 2020 2020 2020 2320 6178 6973  n.        # axis
-00008570: 2c20 6f72 2075 7369 6e67 2061 2070 6f6c  , or using a pol
-00008580: 6172 2064 6973 6372 6574 697a 6174 696f  ar discretizatio
-00008590: 6e20 6966 2061 2033 4420 706c 6f74 2069  n if a 3D plot i
-000085a0: 7320 7265 7175 6573 7465 640a 2020 2020  s requested.    
-000085b0: 2020 2020 7365 6c66 2e69 735f 706f 6c61      self.is_pola
-000085c0: 7220 3d20 6b77 6172 6773 2e67 6574 2822  r = kwargs.get("
-000085d0: 6973 5f70 6f6c 6172 222c 2046 616c 7365  is_polar", False
-000085e0: 290a 0a20 2020 2064 6566 205f 6372 6561  )..    def _crea
-000085f0: 7465 5f6c 616d 6264 615f 6675 6e63 2873  te_lambda_func(s
-00008600: 656c 6629 3a0a 2020 2020 2020 2020 2222  elf):.        ""
-00008610: 2243 7265 6174 6520 7468 6520 6c61 6d62  "Create the lamb
-00008620: 6461 2066 756e 6374 696f 6e73 2074 6f20  da functions to 
-00008630: 6265 2075 7365 6420 6279 2074 6865 2075  be used by the u
-00008640: 6e69 666f 726d 206d 6573 6869 6e67 0a20  niform meshing. 
-00008650: 2020 2020 2020 2073 7472 6174 6567 792e         strategy.
-00008660: 0a20 2020 2020 2020 2022 2222 0a20 2020  .        """.   
-00008670: 2020 2020 2065 7870 7273 203d 2073 656c       exprs = sel
-00008680: 662e 6578 7072 2069 6620 6861 7361 7474  f.expr if hasatt
-00008690: 7228 7365 6c66 2e65 7870 722c 2022 5f5f  r(self.expr, "__
-000086a0: 6974 6572 5f5f 2229 2065 6c73 6520 5b73  iter__") else [s
-000086b0: 656c 662e 6578 7072 5d0a 2020 2020 2020  elf.expr].      
-000086c0: 2020 6966 206e 6f74 2061 6e79 2863 616c    if not any(cal
-000086d0: 6c61 626c 6528 6529 2066 6f72 2065 2069  lable(e) for e i
-000086e0: 6e20 6578 7072 7329 3a0a 2020 2020 2020  n exprs):.      
-000086f0: 2020 2020 2020 6673 203d 205f 6765 745f        fs = _get_
-00008700: 6672 6565 5f73 796d 626f 6c73 2865 7870  free_symbols(exp
-00008710: 7273 290a 2020 2020 2020 2020 2020 2020  rs).            
-00008720: 7365 6c66 2e5f 7369 676e 6174 7572 6520  self._signature 
-00008730: 3d20 736f 7274 6564 2866 732c 206b 6579  = sorted(fs, key
-00008740: 3d6c 616d 6264 6120 743a 2074 2e6e 616d  =lambda t: t.nam
-00008750: 6529 0a0a 2020 2020 2020 2020 2020 2020  e)..            
-00008760: 2320 4765 6e65 7261 7465 2061 206c 6973  # Generate a lis
-00008770: 7420 6f66 206c 616d 6264 6120 6675 6e63  t of lambda func
-00008780: 7469 6f6e 732c 2074 776f 2066 6f72 2065  tions, two for e
-00008790: 6163 6820 6578 7072 6573 7369 6f6e 3a0a  ach expression:.
-000087a0: 2020 2020 2020 2020 2020 2020 2320 312e              # 1.
-000087b0: 2074 6865 2064 6566 6175 6c74 206f 6e65   the default one
-000087c0: 2e0a 2020 2020 2020 2020 2020 2020 2320  ..            # 
-000087d0: 322e 2074 6865 2062 6163 6b75 7020 6f6e  2. the backup on
-000087e0: 652c 2069 6e20 6361 7365 206f 6620 6661  e, in case of fa
-000087f0: 696c 7572 6573 2077 6974 6820 7468 6520  ilures with the 
-00008800: 6465 6661 756c 7420 6f6e 652e 0a20 2020  default one..   
-00008810: 2020 2020 2020 2020 2073 656c 662e 5f66           self._f
-00008820: 756e 6374 696f 6e73 203d 205b 5d0a 2020  unctions = [].  
-00008830: 2020 2020 2020 2020 2020 666f 7220 6520            for e 
-00008840: 696e 2065 7870 7273 3a0a 2020 2020 2020  in exprs:.      
-00008850: 2020 2020 2020 2020 2020 2320 544f 444f            # TODO
-00008860: 3a20 7365 7420 6373 653d 5472 7565 206f  : set cse=True o
-00008870: 6e63 6520 7468 6973 2069 7373 7565 2069  nce this issue i
-00008880: 7320 736f 6c76 6564 3a0a 2020 2020 2020  s solved:.      
-00008890: 2020 2020 2020 2020 2020 2320 6874 7470            # http
-000088a0: 733a 2f2f 6769 7468 7562 2e63 6f6d 2f73  s://github.com/s
-000088b0: 796d 7079 2f73 796d 7079 2f69 7373 7565  ympy/sympy/issue
-000088c0: 732f 3234 3234 360a 2020 2020 2020 2020  s/24246.        
-000088d0: 2020 2020 2020 2020 7365 6c66 2e5f 6675          self._fu
-000088e0: 6e63 7469 6f6e 732e 6170 7065 6e64 285b  nctions.append([
-000088f0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00008900: 2020 2020 206c 616d 6264 6966 7928 7365       lambdify(se
-00008910: 6c66 2e5f 7369 676e 6174 7572 652c 2065  lf._signature, e
-00008920: 2c20 6d6f 6475 6c65 733d 7365 6c66 2e6d  , modules=self.m
-00008930: 6f64 756c 6573 292c 0a20 2020 2020 2020  odules),.       
-00008940: 2020 2020 2020 2020 2020 2020 206c 616d               lam
-00008950: 6264 6966 7928 7365 6c66 2e5f 7369 676e  bdify(self._sign
-00008960: 6174 7572 652c 2065 2c20 6d6f 6475 6c65  ature, e, module
-00008970: 733d 2273 796d 7079 222c 2064 756d 6d69  s="sympy", dummi
-00008980: 6679 3d54 7275 6529 2c0a 2020 2020 2020  fy=True),.      
-00008990: 2020 2020 2020 2020 2020 5d29 0a20 2020            ]).   
-000089a0: 2020 2020 2065 6c73 653a 0a20 2020 2020       else:.     
-000089b0: 2020 2020 2020 2073 656c 662e 5f73 6967         self._sig
-000089c0: 6e61 7475 7265 203d 2073 6f72 7465 6428  nature = sorted(
-000089d0: 5b72 5b30 5d20 666f 7220 7220 696e 2073  [r[0] for r in s
-000089e0: 656c 662e 7261 6e67 6573 5d2c 206b 6579  elf.ranges], key
-000089f0: 3d6c 616d 6264 6120 743a 2074 2e6e 616d  =lambda t: t.nam
-00008a00: 6529 0a20 2020 2020 2020 2020 2020 2073  e).            s
-00008a10: 656c 662e 5f66 756e 6374 696f 6e73 203d  elf._functions =
-00008a20: 205b 2865 2c20 4e6f 6e65 2920 666f 7220   [(e, None) for 
-00008a30: 6520 696e 2065 7870 7273 5d0a 0a20 2020  e in exprs]..   
-00008a40: 2020 2020 2023 2064 6561 6c20 7769 7468       # deal with
-00008a50: 2073 796d 626f 6c69 6320 636f 6c6f 725f   symbolic color_
-00008a60: 6675 6e63 0a20 2020 2020 2020 2069 6620  func.        if 
-00008a70: 6973 696e 7374 616e 6365 2873 656c 662e  isinstance(self.
-00008a80: 636f 6c6f 725f 6675 6e63 2c20 4578 7072  color_func, Expr
-00008a90: 293a 0a20 2020 2020 2020 2020 2020 2073  ):.            s
-00008aa0: 656c 662e 636f 6c6f 725f 6675 6e63 203d  elf.color_func =
-00008ab0: 206c 616d 6264 6966 7928 7365 6c66 2e5f   lambdify(self._
-00008ac0: 7369 676e 6174 7572 652c 2073 656c 662e  signature, self.
-00008ad0: 636f 6c6f 725f 6675 6e63 290a 2020 2020  color_func).    
-00008ae0: 2020 2020 2020 2020 7365 6c66 2e5f 6576          self._ev
-00008af0: 616c 5f63 6f6c 6f72 5f66 756e 635f 7769  al_color_func_wi
-00008b00: 7468 5f73 6967 6e61 7475 7265 203d 2054  th_signature = T
-00008b10: 7275 650a 0a20 2020 2064 6566 205f 6372  rue..    def _cr
-00008b20: 6561 7465 5f64 6973 6372 6574 697a 6564  eate_discretized
-00008b30: 5f64 6f6d 6169 6e28 7365 6c66 293a 0a20  _domain(self):. 
-00008b40: 2020 2020 2020 2022 2222 4469 7363 7265         """Discre
-00008b50: 7469 7a65 2074 6865 2072 616e 6765 7320  tize the ranges 
-00008b60: 666f 7220 756e 6966 6f72 6d20 6d65 7368  for uniform mesh
-00008b70: 696e 6720 7374 7261 7465 6779 2e0a 2020  ing strategy..  
-00008b80: 2020 2020 2020 2222 220a 2020 2020 2020        """.      
-00008b90: 2020 2320 4e4f 5445 3a20 7468 6520 676f    # NOTE: the go
-00008ba0: 616c 2069 7320 746f 2063 7265 6174 6520  al is to create 
-00008bb0: 6120 6469 6374 696f 6e61 7279 2073 746f  a dictionary sto
-00008bc0: 7265 6420 696e 0a20 2020 2020 2020 2023  red in.        #
-00008bd0: 2073 656c 662e 5f64 6973 6372 6574 697a   self._discretiz
-00008be0: 6564 5f64 6f6d 6169 6e2c 206d 6170 7069  ed_domain, mappi
-00008bf0: 6e67 2073 796d 626f 6c73 2074 6f20 6120  ng symbols to a 
-00008c00: 6e75 6d70 7920 6172 7261 790a 2020 2020  numpy array.    
-00008c10: 2020 2020 2320 7265 7072 6573 656e 7469      # representi
-00008c20: 6e67 2074 6865 2064 6973 6372 6574 697a  ng the discretiz
-00008c30: 6174 696f 6e0a 2020 2020 2020 2020 6469  ation.        di
-00008c40: 7363 725f 7379 6d62 6f6c 7320 3d20 5b5d  scr_symbols = []
-00008c50: 0a20 2020 2020 2020 2064 6973 6372 6574  .        discret
-00008c60: 697a 6174 696f 6e73 203d 205b 5d0a 0a20  izations = [].. 
-00008c70: 2020 2020 2020 2023 2063 7265 6174 6520         # create 
-00008c80: 6120 3144 2064 6973 6372 6574 697a 6174  a 1D discretizat
-00008c90: 696f 6e0a 2020 2020 2020 2020 666f 7220  ion.        for 
-00008ca0: 692c 2072 2069 6e20 656e 756d 6572 6174  i, r in enumerat
-00008cb0: 6528 7365 6c66 2e72 616e 6765 7329 3a0a  e(self.ranges):.
-00008cc0: 2020 2020 2020 2020 2020 2020 6469 7363              disc
-00008cd0: 725f 7379 6d62 6f6c 732e 6170 7065 6e64  r_symbols.append
-00008ce0: 2872 5b30 5d29 0a20 2020 2020 2020 2020  (r[0]).         
-00008cf0: 2020 2063 5f73 7461 7274 203d 2073 656c     c_start = sel
-00008d00: 662e 5f75 7064 6174 655f 7261 6e67 655f  f._update_range_
-00008d10: 7661 6c75 6528 725b 315d 290a 2020 2020  value(r[1]).    
-00008d20: 2020 2020 2020 2020 635f 656e 6420 3d20          c_end = 
-00008d30: 7365 6c66 2e5f 7570 6461 7465 5f72 616e  self._update_ran
-00008d40: 6765 5f76 616c 7565 2872 5b32 5d29 0a20  ge_value(r[2]). 
-00008d50: 2020 2020 2020 2020 2020 2073 7461 7274             start
-00008d60: 203d 2063 5f73 7461 7274 2e72 6561 6c20   = c_start.real 
-00008d70: 6966 2063 5f73 7461 7274 2e69 6d61 6720  if c_start.imag 
-00008d80: 3d3d 2063 5f65 6e64 2e69 6d61 6720 3d3d  == c_end.imag ==
-00008d90: 2030 2065 6c73 6520 635f 7374 6172 740a   0 else c_start.
-00008da0: 2020 2020 2020 2020 2020 2020 656e 6420              end 
-00008db0: 3d20 635f 656e 642e 7265 616c 2069 6620  = c_end.real if 
-00008dc0: 635f 7374 6172 742e 696d 6167 203d 3d20  c_start.imag == 
-00008dd0: 635f 656e 642e 696d 6167 203d 3d20 3020  c_end.imag == 0 
-00008de0: 656c 7365 2063 5f65 6e64 0a20 2020 2020  else c_end.     
-00008df0: 2020 2020 2020 206e 6565 6473 5f69 6e74         needs_int
-00008e00: 6567 6572 5f64 6973 6372 203d 2073 656c  eger_discr = sel
-00008e10: 662e 6f6e 6c79 5f69 6e74 6567 6572 7320  f.only_integers 
-00008e20: 6f72 2028 725b 305d 2069 6e20 7365 6c66  or (r[0] in self
-00008e30: 2e5f 6e65 6564 735f 746f 5f62 655f 696e  ._needs_to_be_in
-00008e40: 7429 0a20 2020 2020 2020 2020 2020 2064  t).            d
-00008e50: 203d 2042 6173 6553 6572 6965 732e 5f64   = BaseSeries._d
-00008e60: 6973 6372 6574 697a 6528 0a20 2020 2020  iscretize(.     
-00008e70: 2020 2020 2020 2020 2020 2073 7461 7274             start
-00008e80: 2c20 656e 642c 2073 656c 662e 6e5b 695d  , end, self.n[i]
-00008e90: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
-00008ea0: 2020 7363 616c 653d 7365 6c66 2e73 6361    scale=self.sca
-00008eb0: 6c65 735b 695d 2c0a 2020 2020 2020 2020  les[i],.        
-00008ec0: 2020 2020 2020 2020 6f6e 6c79 5f69 6e74          only_int
-00008ed0: 6567 6572 733d 6e65 6564 735f 696e 7465  egers=needs_inte
-00008ee0: 6765 725f 6469 7363 720a 2020 2020 2020  ger_discr.      
-00008ef0: 2020 2020 2020 290a 0a20 2020 2020 2020        )..       
-00008f00: 2020 2020 2069 6620 280a 2020 2020 2020       if (.      
-00008f10: 2020 2020 2020 2020 2020 286e 6f74 2073            (not s
-00008f20: 656c 662e 5f66 6f72 6365 5f72 6561 6c5f  elf._force_real_
-00008f30: 6576 616c 2920 616e 640a 2020 2020 2020  eval) and.      
-00008f40: 2020 2020 2020 2020 2020 286e 6f74 206e            (not n
-00008f50: 6565 6473 5f69 6e74 6567 6572 5f64 6973  eeds_integer_dis
-00008f60: 6372 2920 616e 640a 2020 2020 2020 2020  cr) and.        
-00008f70: 2020 2020 2020 2020 2864 2e64 7479 7065          (d.dtype
-00008f80: 2021 3d20 2263 6f6d 706c 6578 2229 0a20   != "complex"). 
-00008f90: 2020 2020 2020 2020 2020 2029 3a0a 2020             ):.  
-00008fa0: 2020 2020 2020 2020 2020 2020 2020 6420                d 
-00008fb0: 3d20 6420 2b20 316a 202a 2063 5f73 7461  = d + 1j * c_sta
-00008fc0: 7274 2e69 6d61 670a 0a20 2020 2020 2020  rt.imag..       
-00008fd0: 2020 2020 2069 6620 6e65 6564 735f 696e       if needs_in
-00008fe0: 7465 6765 725f 6469 7363 723a 0a20 2020  teger_discr:.   
-00008ff0: 2020 2020 2020 2020 2020 2020 2064 203d               d =
-00009000: 2064 2e61 7374 7970 6528 696e 7429 0a0a   d.astype(int)..
-00009010: 2020 2020 2020 2020 2020 2020 6469 7363              disc
-00009020: 7265 7469 7a61 7469 6f6e 732e 6170 7065  retizations.appe
-00009030: 6e64 2864 290a 0a20 2020 2020 2020 2023  nd(d)..        #
-00009040: 2063 7265 6174 6520 3244 206f 7220 3344   create 2D or 3D
-00009050: 0a20 2020 2020 2020 2073 656c 662e 5f63  .        self._c
-00009060: 7265 6174 655f 6469 7363 7265 7469 7a65  reate_discretize
-00009070: 645f 646f 6d61 696e 5f68 656c 7065 7228  d_domain_helper(
-00009080: 6469 7363 725f 7379 6d62 6f6c 732c 2064  discr_symbols, d
-00009090: 6973 6372 6574 697a 6174 696f 6e73 290a  iscretizations).
-000090a0: 0a20 2020 2064 6566 205f 6372 6561 7465  .    def _create
-000090b0: 5f64 6973 6372 6574 697a 6564 5f64 6f6d  _discretized_dom
-000090c0: 6169 6e5f 6865 6c70 6572 2873 656c 662c  ain_helper(self,
-000090d0: 2064 6973 6372 5f73 796d 626f 6c73 2c20   discr_symbols, 
-000090e0: 6469 7363 7265 7469 7a61 7469 6f6e 7329  discretizations)
-000090f0: 3a0a 2020 2020 2020 2020 2222 2243 7265  :.        """Cre
-00009100: 6174 6520 3244 206f 7220 3344 2064 6973  ate 2D or 3D dis
-00009110: 6372 6574 697a 6564 2067 7269 6473 2e0a  cretized grids..
-00009120: 0a20 2020 2020 2020 2053 7562 636c 6173  .        Subclas
-00009130: 7365 7320 7368 6f75 6c64 206f 7665 7272  ses should overr
-00009140: 6964 6520 7468 6973 206d 6574 686f 6420  ide this method 
-00009150: 696e 206f 7264 6572 2074 6f20 696d 706c  in order to impl
-00009160: 656d 656e 7420 610a 2020 2020 2020 2020  ement a.        
-00009170: 6469 6666 6572 656e 7420 6265 6861 7669  different behavi
-00009180: 6f75 722e 0a20 2020 2020 2020 2022 2222  our..        """
-00009190: 0a20 2020 2020 2020 206e 7020 3d20 696d  .        np = im
-000091a0: 706f 7274 5f6d 6f64 756c 6528 276e 756d  port_module('num
-000091b0: 7079 2729 0a0a 2020 2020 2020 2020 2320  py')..        # 
-000091c0: 6469 7363 7265 7469 7a61 7469 6f6e 2073  discretization s
-000091d0: 7569 7461 626c 6520 666f 7220 3244 206c  uitable for 2D l
-000091e0: 696e 6520 706c 6f74 732c 2033 4420 7375  ine plots, 3D su
-000091f0: 7266 6163 6520 706c 6f74 732c 0a20 2020  rface plots,.   
-00009200: 2020 2020 2023 2063 6f6e 746f 7572 7320       # contours 
-00009210: 706c 6f74 732c 2076 6563 746f 7220 706c  plots, vector pl
-00009220: 6f74 730a 2020 2020 2020 2020 2320 4e4f  ots.        # NO
-00009230: 5445 3a20 7768 7920 696e 6465 7869 6e67  TE: why indexing
-00009240: 3d27 696a 273f 2042 6563 6175 7365 2069  ='ij'? Because i
-00009250: 7420 7072 6f64 7563 6573 2063 6f6e 7369  t produces consi
-00009260: 7374 656e 7420 7265 7375 6c74 7320 7769  stent results wi
-00009270: 7468 0a20 2020 2020 2020 2023 206e 702e  th.        # np.
-00009280: 6d67 7269 642e 2054 6869 7320 6973 2069  mgrid. This is i
-00009290: 6d70 6f72 7461 6e74 2061 7320 4d61 7961  mportant as Maya
-000092a0: 7669 2072 6571 7569 7265 7320 7468 6973  vi requires this
-000092b0: 2069 6e64 6578 696e 670a 2020 2020 2020   indexing.      
-000092c0: 2020 2320 746f 2063 6f72 7265 6374 6c79    # to correctly
-000092d0: 2063 6f6d 7075 7465 2033 4420 7374 7265   compute 3D stre
-000092e0: 616d 6c69 6e65 732e 2056 544b 2069 7320  amlines. VTK is 
-000092f0: 6162 6c65 2074 6f20 636f 6d70 7574 6520  able to compute 
-00009300: 7468 656d 0a20 2020 2020 2020 2023 206e  them.        # n
-00009310: 6f6e 6574 6865 6c65 7373 2c20 6275 7420  onetheless, but 
-00009320: 6974 2070 726f 6475 6365 7320 2273 7472  it produces "str
-00009330: 616e 6765 2220 7265 7375 6c74 7320 7769  ange" results wi
-00009340: 7468 2022 766f 6964 7322 2069 6e74 6f20  th "voids" into 
-00009350: 7468 650a 2020 2020 2020 2020 2320 6469  the.        # di
-00009360: 7363 7265 7469 7a61 7469 6f6e 2076 6f6c  scretization vol
-00009370: 756d 652e 2054 6869 7320 696e 6465 7869  ume. This indexi
-00009380: 6e67 2073 6f6c 7665 7320 7468 6520 7072  ng solves the pr
-00009390: 6f62 6c65 6d2e 0a20 2020 2020 2020 2023  oblem..        #
-000093a0: 2041 6c73 6f20 6e6f 7465 2074 6861 7420   Also note that 
-000093b0: 6d61 7470 6c6f 746c 6962 2032 4420 7374  matplotlib 2D st
-000093c0: 7265 616d 6c69 6e65 7320 7265 7175 6972  reamlines requir
-000093d0: 6573 2069 6e64 6578 696e 673d 2778 7927  es indexing='xy'
-000093e0: 2e0a 2020 2020 2020 2020 696e 6465 7869  ..        indexi
-000093f0: 6e67 203d 2022 7879 220a 2020 2020 2020  ng = "xy".      
-00009400: 2020 6966 2073 656c 662e 6973 5f33 4476    if self.is_3Dv
-00009410: 6563 746f 7220 6f72 2028 7365 6c66 2e69  ector or (self.i
-00009420: 735f 3344 7375 7266 6163 6520 616e 6420  s_3Dsurface and 
-00009430: 7365 6c66 2e69 735f 696d 706c 6963 6974  self.is_implicit
-00009440: 293a 0a20 2020 2020 2020 2020 2020 2069  ):.            i
-00009450: 6e64 6578 696e 6720 3d20 2269 6a22 0a20  ndexing = "ij". 
-00009460: 2020 2020 2020 206d 6573 6865 7320 3d20         meshes = 
-00009470: 6e70 2e6d 6573 6867 7269 6428 2a64 6973  np.meshgrid(*dis
-00009480: 6372 6574 697a 6174 696f 6e73 2c20 696e  cretizations, in
-00009490: 6465 7869 6e67 3d69 6e64 6578 696e 6729  dexing=indexing)
-000094a0: 0a20 2020 2020 2020 2073 656c 662e 5f64  .        self._d
-000094b0: 6973 6372 6574 697a 6564 5f64 6f6d 6169  iscretized_domai
-000094c0: 6e20 3d20 7b0a 2020 2020 2020 2020 2020  n = {.          
-000094d0: 2020 6b3a 2076 2066 6f72 206b 2c20 7620    k: v for k, v 
-000094e0: 696e 207a 6970 2864 6973 6372 5f73 796d  in zip(discr_sym
-000094f0: 626f 6c73 2c20 6d65 7368 6573 297d 0a0a  bols, meshes)}..
-00009500: 2020 2020 6465 6620 5f65 7661 6c75 6174      def _evaluat
-00009510: 6528 7365 6c66 2c20 6361 7374 5f74 6f5f  e(self, cast_to_
-00009520: 7265 616c 3d54 7275 6529 3a0a 2020 2020  real=True):.    
-00009530: 2020 2020 2222 2245 7661 6c75 6174 696f      """Evaluatio
-00009540: 6e20 6f66 2074 6865 2073 796d 626f 6c69  n of the symboli
-00009550: 6320 6578 7072 6573 7369 6f6e 2028 6f72  c expression (or
-00009560: 2065 7870 7265 7373 696f 6e73 2920 7769   expressions) wi
-00009570: 7468 2074 6865 0a20 2020 2020 2020 2075  th the.        u
-00009580: 6e69 666f 726d 206d 6573 6869 6e67 2073  niform meshing s
-00009590: 7472 6174 6567 792c 2062 6173 6564 206f  trategy, based o
-000095a0: 6e20 6375 7272 656e 7420 7661 6c75 6573  n current values
-000095b0: 206f 6620 7468 6520 7061 7261 6d65 7465   of the paramete
-000095c0: 7273 2e0a 2020 2020 2020 2020 2222 220a  rs..        """.
-000095d0: 2020 2020 2020 2020 6e70 203d 2069 6d70          np = imp
-000095e0: 6f72 745f 6d6f 6475 6c65 2827 6e75 6d70  ort_module('nump
-000095f0: 7927 290a 0a20 2020 2020 2020 2023 2063  y')..        # c
-00009600: 7265 6174 6520 6c61 6d62 6461 2066 756e  reate lambda fun
-00009610: 6374 696f 6e73 0a20 2020 2020 2020 2069  ctions.        i
-00009620: 6620 6e6f 7420 7365 6c66 2e5f 6675 6e63  f not self._func
-00009630: 7469 6f6e 733a 0a20 2020 2020 2020 2020  tions:.         
-00009640: 2020 2073 656c 662e 5f63 7265 6174 655f     self._create_
-00009650: 6c61 6d62 6461 5f66 756e 6328 290a 2020  lambda_func().  
-00009660: 2020 2020 2020 2320 6372 6561 7465 2028        # create (
-00009670: 6f72 2075 7064 6174 6529 2074 6865 2064  or update) the d
-00009680: 6973 6372 6574 697a 6564 2064 6f6d 6169  iscretized domai
-00009690: 6e0a 2020 2020 2020 2020 6966 2028 6e6f  n.        if (no
-000096a0: 7420 7365 6c66 2e5f 6469 7363 7265 7469  t self._discreti
-000096b0: 7a65 645f 646f 6d61 696e 2920 6f72 2073  zed_domain) or s
-000096c0: 656c 662e 5f69 6e74 6572 6163 7469 7665  elf._interactive
-000096d0: 5f72 616e 6765 733a 0a20 2020 2020 2020  _ranges:.       
-000096e0: 2020 2020 2073 656c 662e 5f63 7265 6174       self._creat
-000096f0: 655f 6469 7363 7265 7469 7a65 645f 646f  e_discretized_do
-00009700: 6d61 696e 2829 0a20 2020 2020 2020 2023  main().        #
-00009710: 2065 6e73 7572 6520 7468 6174 2064 6973   ensure that dis
-00009720: 6372 6574 697a 6564 2064 6f6d 6169 6e73  cretized domains
-00009730: 2061 7265 2072 6574 7572 6e65 6420 7769   are returned wi
-00009740: 7468 2074 6865 2070 726f 7065 7220 6f72  th the proper or
-00009750: 6465 720a 2020 2020 2020 2020 6469 7363  der.        disc
-00009760: 7220 3d20 5b73 656c 662e 5f64 6973 6372  r = [self._discr
-00009770: 6574 697a 6564 5f64 6f6d 6169 6e5b 735b  etized_domain[s[
-00009780: 305d 5d20 666f 7220 7320 696e 2073 656c  0]] for s in sel
-00009790: 662e 7261 6e67 6573 5d0a 0a20 2020 2020  f.ranges]..     
-000097a0: 2020 2061 7267 7320 3d20 7365 6c66 2e5f     args = self._
-000097b0: 6167 6772 6567 6174 655f 6172 6773 2829  aggregate_args()
-000097c0: 0a0a 2020 2020 2020 2020 7265 7375 6c74  ..        result
-000097d0: 7320 3d20 5b5d 0a20 2020 2020 2020 2066  s = [].        f
-000097e0: 6f72 2066 2069 6e20 7365 6c66 2e5f 6675  or f in self._fu
-000097f0: 6e63 7469 6f6e 733a 0a20 2020 2020 2020  nctions:.       
-00009800: 2020 2020 2072 203d 205f 756e 6966 6f72       r = _unifor
-00009810: 6d5f 6576 616c 282a 662c 202a 6172 6773  m_eval(*f, *args
-00009820: 2c20 6d6f 6475 6c65 733d 7365 6c66 2e6d  , modules=self.m
-00009830: 6f64 756c 6573 290a 2020 2020 2020 2020  odules).        
-00009840: 2020 2020 2320 7468 6520 6576 616c 7561      # the evalua
-00009850: 7469 6f6e 206d 6967 6874 2070 726f 6475  tion might produ
-00009860: 6365 2061 6e20 696e 742f 666c 6f61 742e  ce an int/float.
-00009870: 204e 6565 6420 7468 6973 2063 6f72 7265   Need this corre
-00009880: 6374 696f 6e2e 0a20 2020 2020 2020 2020  ction..         
-00009890: 2020 2072 203d 2073 656c 662e 5f63 6f72     r = self._cor
-000098a0: 7265 6374 5f73 6861 7065 286e 702e 6172  rect_shape(np.ar
-000098b0: 7261 7928 7229 2c20 6469 7363 725b 305d  ray(r), discr[0]
-000098c0: 290a 2020 2020 2020 2020 2020 2020 2320  ).            # 
-000098d0: 736f 6d65 7469 6d65 2074 6865 2065 7661  sometime the eva
-000098e0: 6c75 6174 696f 6e20 6973 2070 6572 666f  luation is perfo
-000098f0: 726d 6564 206f 7665 7220 6172 7261 7973  rmed over arrays
-00009900: 206f 6620 7479 7065 206f 626a 6563 742e   of type object.
-00009910: 0a20 2020 2020 2020 2020 2020 2023 2068  .            # h
-00009920: 656e 6365 2c20 6072 6573 756c 7460 206d  ence, `result` m
-00009930: 6967 6874 2062 6520 6f66 2074 7970 6520  ight be of type 
-00009940: 6f62 6a65 6374 2c20 7768 6963 6820 646f  object, which do
-00009950: 6e27 7420 776f 726b 2077 656c 6c0a 2020  n't work well.  
-00009960: 2020 2020 2020 2020 2020 2320 7769 7468            # with
-00009970: 206e 756d 7079 2072 6561 6c20 616e 6420   numpy real and 
-00009980: 696d 6167 2066 756e 6374 696f 6e73 2e0a  imag functions..
-00009990: 2020 2020 2020 2020 2020 2020 7220 3d20              r = 
-000099a0: 722e 6173 7479 7065 2863 6f6d 706c 6578  r.astype(complex
-000099b0: 290a 2020 2020 2020 2020 2020 2020 7265  ).            re
-000099c0: 7375 6c74 732e 6170 7065 6e64 2872 290a  sults.append(r).
-000099d0: 0a20 2020 2020 2020 2069 6620 6361 7374  .        if cast
-000099e0: 5f74 6f5f 7265 616c 3a0a 2020 2020 2020  _to_real:.      
-000099f0: 2020 2020 2020 6469 7363 7220 3d20 5b6e        discr = [n
-00009a00: 702e 7265 616c 2864 2e61 7374 7970 6528  p.real(d.astype(
-00009a10: 636f 6d70 6c65 7829 2920 666f 7220 6420  complex)) for d 
-00009a20: 696e 2064 6973 6372 5d0a 2020 2020 2020  in discr].      
-00009a30: 2020 7265 7475 726e 205b 2a64 6973 6372    return [*discr
-00009a40: 2c20 2a72 6573 756c 7473 5d0a 0a20 2020  , *results]..   
-00009a50: 2064 6566 205f 6167 6772 6567 6174 655f   def _aggregate_
-00009a60: 6172 6773 2873 656c 6629 3a0a 2020 2020  args(self):.    
-00009a70: 2020 2020 6172 6773 203d 205b 5d0a 2020      args = [].  
-00009a80: 2020 2020 2020 666f 7220 7320 696e 2073        for s in s
-00009a90: 656c 662e 5f73 6967 6e61 7475 7265 3a0a  elf._signature:.
-00009aa0: 2020 2020 2020 2020 2020 2020 6966 2073              if s
-00009ab0: 2069 6e20 7365 6c66 2e5f 7061 7261 6d73   in self._params
-00009ac0: 2e6b 6579 7328 293a 0a20 2020 2020 2020  .keys():.       
-00009ad0: 2020 2020 2020 2020 2061 7267 732e 6170           args.ap
-00009ae0: 7065 6e64 280a 2020 2020 2020 2020 2020  pend(.          
-00009af0: 2020 2020 2020 2020 2020 696e 7428 7365            int(se
-00009b00: 6c66 2e5f 7061 7261 6d73 5b73 5d29 2069  lf._params[s]) i
-00009b10: 6620 7320 696e 2073 656c 662e 5f6e 6565  f s in self._nee
-00009b20: 6473 5f74 6f5f 6265 5f69 6e74 2065 6c73  ds_to_be_int els
-00009b30: 650a 2020 2020 2020 2020 2020 2020 2020  e.              
-00009b40: 2020 2020 2020 7365 6c66 2e5f 7061 7261        self._para
-00009b50: 6d73 5b73 5d20 6966 2073 656c 662e 5f66  ms[s] if self._f
-00009b60: 6f72 6365 5f72 6561 6c5f 6576 616c 0a20  orce_real_eval. 
-00009b70: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00009b80: 2020 2065 6c73 6520 636f 6d70 6c65 7828     else complex(
-00009b90: 7365 6c66 2e5f 7061 7261 6d73 5b73 5d29  self._params[s])
-00009ba0: 290a 2020 2020 2020 2020 2020 2020 656c  ).            el
-00009bb0: 7365 3a0a 2020 2020 2020 2020 2020 2020  se:.            
-00009bc0: 2020 2020 6172 6773 2e61 7070 656e 6428      args.append(
-00009bd0: 7365 6c66 2e5f 6469 7363 7265 7469 7a65  self._discretize
-00009be0: 645f 646f 6d61 696e 5b73 5d29 0a20 2020  d_domain[s]).   
-00009bf0: 2020 2020 2072 6574 7572 6e20 6172 6773       return args
-00009c00: 0a0a 2020 2020 4070 726f 7065 7274 790a  ..    @property.
-00009c10: 2020 2020 6465 6620 6578 7072 2873 656c      def expr(sel
-00009c20: 6629 3a0a 2020 2020 2020 2020 2222 2252  f):.        """R
-00009c30: 6574 7572 6e20 7468 6520 6578 7072 6573  eturn the expres
-00009c40: 7369 6f6e 2028 6f72 2065 7870 7265 7373  sion (or express
-00009c50: 696f 6e73 2920 6f66 2074 6865 2073 6572  ions) of the ser
-00009c60: 6965 732e 2222 220a 2020 2020 2020 2020  ies.""".        
-00009c70: 7265 7475 726e 2073 656c 662e 5f65 7870  return self._exp
-00009c80: 720a 0a20 2020 2040 6578 7072 2e73 6574  r..    @expr.set
-00009c90: 7465 720a 2020 2020 6465 6620 6578 7072  ter.    def expr
-00009ca0: 2873 656c 662c 2065 293a 0a20 2020 2020  (self, e):.     
-00009cb0: 2020 2022 2222 5365 7420 7468 6520 6578     """Set the ex
-00009cc0: 7072 6573 7369 6f6e 2028 6f72 2065 7870  pression (or exp
-00009cd0: 7265 7373 696f 6e73 2920 6f66 2074 6865  ressions) of the
-00009ce0: 2073 6572 6965 732e 2222 220a 2020 2020   series.""".    
-00009cf0: 2020 2020 6973 5f69 7465 7220 3d20 6861      is_iter = ha
-00009d00: 7361 7474 7228 652c 2022 5f5f 6974 6572  sattr(e, "__iter
-00009d10: 5f5f 2229 0a20 2020 2020 2020 2069 735f  __").        is_
-00009d20: 6361 6c6c 6162 6c65 203d 2063 616c 6c61  callable = calla
-00009d30: 626c 6528 6529 2069 6620 6e6f 7420 6973  ble(e) if not is
-00009d40: 5f69 7465 7220 656c 7365 2061 6e79 2863  _iter else any(c
-00009d50: 616c 6c61 626c 6528 7429 2066 6f72 2074  allable(t) for t
-00009d60: 2069 6e20 6529 0a20 2020 2020 2020 2069   in e).        i
-00009d70: 6620 6973 5f63 616c 6c61 626c 653a 0a20  f is_callable:. 
-00009d80: 2020 2020 2020 2020 2020 2073 656c 662e             self.
-00009d90: 5f65 7870 7220 3d20 650a 2020 2020 2020  _expr = e.      
-00009da0: 2020 656c 7365 3a0a 2020 2020 2020 2020    else:.        
-00009db0: 2020 2020 7365 6c66 2e5f 6578 7072 203d      self._expr =
-00009dc0: 2073 796d 7069 6679 2865 2920 6966 206e   sympify(e) if n
-00009dd0: 6f74 2069 735f 6974 6572 2065 6c73 6520  ot is_iter else 
-00009de0: 5475 706c 6528 2a65 290a 2020 2020 2020  Tuple(*e).      
-00009df0: 2020 2020 2020 7320 3d20 7365 7428 290a        s = set().
-00009e00: 2020 2020 2020 2020 2020 2020 666f 7220              for 
-00009e10: 6520 696e 2073 656c 662e 5f65 7870 722e  e in self._expr.
-00009e20: 6174 6f6d 7328 5375 6d2c 2050 726f 6475  atoms(Sum, Produ
-00009e30: 6374 293a 0a20 2020 2020 2020 2020 2020  ct):.           
-00009e40: 2020 2020 2066 6f72 2061 2069 6e20 652e       for a in e.
-00009e50: 6172 6773 5b31 3a5d 3a0a 2020 2020 2020  args[1:]:.      
-00009e60: 2020 2020 2020 2020 2020 2020 2020 6966                if
-00009e70: 2069 7369 6e73 7461 6e63 6528 615b 2d31   isinstance(a[-1
-00009e80: 5d2c 2053 796d 626f 6c29 3a0a 2020 2020  ], Symbol):.    
-00009e90: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00009ea0: 2020 2020 732e 6164 6428 615b 2d31 5d29      s.add(a[-1])
-00009eb0: 0a20 2020 2020 2020 2020 2020 2073 656c  .            sel
-00009ec0: 662e 5f6e 6565 6473 5f74 6f5f 6265 5f69  f._needs_to_be_i
-00009ed0: 6e74 203d 206c 6973 7428 7329 0a0a 2020  nt = list(s)..  
-00009ee0: 2020 2020 2020 2020 2020 2320 6c69 7374            # list
-00009ef0: 206f 6620 7379 6d70 7920 6675 6e63 7469   of sympy functi
-00009f00: 6f6e 7320 7468 6174 2077 6865 6e20 6c61  ons that when la
-00009f10: 6d62 6469 6669 6564 2c20 7468 6520 636f  mbdified, the co
-00009f20: 7272 6573 706f 6e64 696e 670a 2020 2020  rresponding.    
-00009f30: 2020 2020 2020 2020 2320 6e75 6d70 7920          # numpy 
-00009f40: 6675 6e63 7469 6f6e 7320 646f 6e27 7420  functions don't 
-00009f50: 6c69 6b65 2063 6f6d 706c 6578 2d74 7970  like complex-typ
-00009f60: 6520 6172 6775 6d65 6e74 730a 2020 2020  e arguments.    
-00009f70: 2020 2020 2020 2020 7066 203d 205b 6365          pf = [ce
-00009f80: 696c 696e 672c 2066 6c6f 6f72 2c20 6174  iling, floor, at
-00009f90: 616e 322c 2066 7261 632c 207a 6574 612c  an2, frac, zeta,
-00009fa0: 2049 6e74 6567 7261 6c2c 2068 7970 6572   Integral, hyper
-00009fb0: 5d0a 2020 2020 2020 2020 2020 2020 6966  ].            if
-00009fc0: 2073 656c 662e 5f66 6f72 6365 5f72 6561   self._force_rea
-00009fd0: 6c5f 6576 616c 2069 7320 6e6f 7420 5472  l_eval is not Tr
-00009fe0: 7565 3a0a 2020 2020 2020 2020 2020 2020  ue:.            
-00009ff0: 2020 2020 6368 6563 6b5f 7265 7320 3d20      check_res = 
-0000a000: 5b73 656c 662e 5f65 7870 722e 6861 7328  [self._expr.has(
-0000a010: 6629 2066 6f72 2066 2069 6e20 7066 5d0a  f) for f in pf].
-0000a020: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000a030: 7365 6c66 2e5f 666f 7263 655f 7265 616c  self._force_real
-0000a040: 5f65 7661 6c20 3d20 616e 7928 6368 6563  _eval = any(chec
-0000a050: 6b5f 7265 7329 0a20 2020 2020 2020 2020  k_res).         
-0000a060: 2020 2020 2020 2069 6620 7365 6c66 2e5f         if self._
-0000a070: 666f 7263 655f 7265 616c 5f65 7661 6c20  force_real_eval 
-0000a080: 616e 6420 280a 2020 2020 2020 2020 2020  and (.          
-0000a090: 2020 2020 2020 2020 2020 2873 656c 662e            (self.
-0000a0a0: 6d6f 6475 6c65 7320 6973 204e 6f6e 6529  modules is None)
-0000a0b0: 206f 720a 2020 2020 2020 2020 2020 2020   or.            
-0000a0c0: 2020 2020 2020 2020 2869 7369 6e73 7461          (isinsta
-0000a0d0: 6e63 6528 7365 6c66 2e6d 6f64 756c 6573  nce(self.modules
-0000a0e0: 2c20 7374 7229 2061 6e64 2022 6e75 6d70  , str) and "nump
-0000a0f0: 7922 2069 6e20 7365 6c66 2e6d 6f64 756c  y" in self.modul
-0000a100: 6573 290a 2020 2020 2020 2020 2020 2020  es).            
-0000a110: 2020 2020 293a 0a20 2020 2020 2020 2020      ):.         
-0000a120: 2020 2020 2020 2020 2020 2066 756e 6373             funcs
-0000a130: 203d 205b 6620 666f 7220 662c 2063 2069   = [f for f, c i
-0000a140: 6e20 7a69 7028 7066 2c20 6368 6563 6b5f  n zip(pf, check_
-0000a150: 7265 7329 2069 6620 635d 0a20 2020 2020  res) if c].     
-0000a160: 2020 2020 2020 2020 2020 2020 2020 2077                 w
-0000a170: 6172 6e69 6e67 732e 7761 726e 280a 2020  arnings.warn(.  
-0000a180: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000a190: 2020 2020 2020 224e 756d 5079 2069 7320        "NumPy is 
-0000a1a0: 756e 6162 6c65 2074 6f20 6576 616c 7561  unable to evalua
-0000a1b0: 7465 2077 6974 6820 636f 6d70 6c65 7820  te with complex 
-0000a1c0: 220a 2020 2020 2020 2020 2020 2020 2020  ".              
-0000a1d0: 2020 2020 2020 2020 2020 226e 756d 6265            "numbe
-0000a1e0: 7273 2073 6f6d 6520 6f66 2074 6865 2066  rs some of the f
-0000a1f0: 756e 6374 696f 6e73 2069 6e63 6c75 6465  unctions include
-0000a200: 6420 696e 2074 6869 7320 220a 2020 2020  d in this ".    
-0000a210: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000a220: 2020 2020 2273 796d 626f 6c69 6320 6578      "symbolic ex
-0000a230: 7072 6573 7369 6f6e 3a20 2573 2e20 2220  pression: %s. " 
-0000a240: 2520 6675 6e63 7320 2b0a 2020 2020 2020  % funcs +.      
-0000a250: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000a260: 2020 2248 656e 6365 2c20 7468 6520 6576    "Hence, the ev
-0000a270: 616c 7561 7469 6f6e 2077 696c 6c20 7573  aluation will us
-0000a280: 6520 7265 616c 206e 756d 6265 7273 2e20  e real numbers. 
-0000a290: 220a 2020 2020 2020 2020 2020 2020 2020  ".              
-0000a2a0: 2020 2020 2020 2020 2020 2249 6620 796f            "If yo
-0000a2b0: 7520 6265 6c69 6576 6520 7468 6520 7265  u believe the re
-0000a2c0: 7375 6c74 696e 6720 706c 6f74 2069 7320  sulting plot is 
-0000a2d0: 696e 636f 7272 6563 742c 2022 0a20 2020  incorrect, ".   
-0000a2e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000a2f0: 2020 2020 2022 6368 616e 6765 2074 6865       "change the
-0000a300: 2065 7661 6c75 6174 696f 6e20 6d6f 6475   evaluation modu
-0000a310: 6c65 2062 7920 7365 7474 696e 6720 7468  le by setting th
-0000a320: 6520 220a 2020 2020 2020 2020 2020 2020  e ".            
-0000a330: 2020 2020 2020 2020 2020 2020 2260 6d6f              "`mo
-0000a340: 6475 6c65 7360 206b 6579 776f 7264 2061  dules` keyword a
-0000a350: 7267 756d 656e 742e 2229 0a20 2020 2020  rgument.").     
-0000a360: 2020 2020 2020 2069 6620 7365 6c66 2e5f         if self._
-0000a370: 6675 6e63 7469 6f6e 733a 0a20 2020 2020  functions:.     
-0000a380: 2020 2020 2020 2020 2020 2023 2075 7064             # upd
-0000a390: 6174 6520 6c61 6d62 6461 2066 756e 6374  ate lambda funct
-0000a3a0: 696f 6e73 0a20 2020 2020 2020 2020 2020  ions.           
-0000a3b0: 2020 2020 2073 656c 662e 5f63 7265 6174       self._creat
-0000a3c0: 655f 6c61 6d62 6461 5f66 756e 6328 290a  e_lambda_func().
-0000a3d0: 0a20 2020 2040 7072 6f70 6572 7479 0a20  .    @property. 
-0000a3e0: 2020 2064 6566 206e 2873 656c 6629 3a0a     def n(self):.
-0000a3f0: 2020 2020 2020 2020 2222 2252 6574 7572          """Retur
-0000a400: 6e73 2061 206c 6973 7420 5b6e 312c 206e  ns a list [n1, n
-0000a410: 322c 206e 335d 206f 6620 6e75 6d62 6572  2, n3] of number
-0000a420: 7320 6f66 2064 6973 6372 6174 697a 6174  s of discratizat
-0000a430: 696f 6e20 706f 696e 7473 2e0a 2020 2020  ion points..    
-0000a440: 2020 2020 2222 220a 2020 2020 2020 2020      """.        
-0000a450: 7265 7475 726e 2073 656c 662e 5f6e 0a0a  return self._n..
-0000a460: 2020 2020 406e 2e73 6574 7465 720a 2020      @n.setter.  
-0000a470: 2020 6465 6620 6e28 7365 6c66 2c20 7629    def n(self, v)
-0000a480: 3a0a 2020 2020 2020 2020 7375 7065 7228  :.        super(
-0000a490: 292e 6e20 3d20 760a 2020 2020 2020 2020  ).n = v.        
-0000a4a0: 6966 2073 656c 662e 5f64 6973 6372 6574  if self._discret
-0000a4b0: 697a 6564 5f64 6f6d 6169 6e3a 0a20 2020  ized_domain:.   
-0000a4c0: 2020 2020 2020 2020 2023 2075 7064 6174           # updat
-0000a4d0: 6520 7468 6520 6469 7363 7265 7469 7a65  e the discretize
-0000a4e0: 6420 646f 6d61 696e 0a20 2020 2020 2020  d domain.       
-0000a4f0: 2020 2020 2073 656c 662e 5f63 7265 6174       self._creat
-0000a500: 655f 6469 7363 7265 7469 7a65 645f 646f  e_discretized_do
-0000a510: 6d61 696e 2829 0a0a 2020 2020 6465 6620  main()..    def 
-0000a520: 5f70 6f73 745f 696e 6974 2873 656c 6629  _post_init(self)
-0000a530: 3a0a 2020 2020 2020 2020 6578 7072 7320  :.        exprs 
-0000a540: 3d20 7365 6c66 2e65 7870 7220 6966 2068  = self.expr if h
-0000a550: 6173 6174 7472 2873 656c 662e 6578 7072  asattr(self.expr
-0000a560: 2c20 225f 5f69 7465 725f 5f22 2920 656c  , "__iter__") el
-0000a570: 7365 205b 7365 6c66 2e65 7870 725d 0a20  se [self.expr]. 
-0000a580: 2020 2020 2020 2069 6620 616e 7928 6361         if any(ca
-0000a590: 6c6c 6162 6c65 2865 2920 666f 7220 6520  llable(e) for e 
-0000a5a0: 696e 2065 7870 7273 2920 616e 6420 7365  in exprs) and se
-0000a5b0: 6c66 2e70 6172 616d 733a 0a20 2020 2020  lf.params:.     
-0000a5c0: 2020 2020 2020 2072 6169 7365 2054 7970         raise Typ
-0000a5d0: 6545 7272 6f72 280a 2020 2020 2020 2020  eError(.        
-0000a5e0: 2020 2020 2020 2020 2260 7061 7261 6d73          "`params
-0000a5f0: 6020 7761 7320 7072 6f76 6964 6564 2c20  ` was provided, 
-0000a600: 6865 6e63 6520 616e 2069 6e74 6572 6163  hence an interac
-0000a610: 7469 7665 2070 6c6f 7420 220a 2020 2020  tive plot ".    
-0000a620: 2020 2020 2020 2020 2020 2020 2269 7320              "is 
-0000a630: 6578 7065 6374 6564 2e20 486f 7765 7665  expected. Howeve
-0000a640: 722c 2069 6e74 6572 6163 7469 7665 2070  r, interactive p
-0000a650: 6c6f 7473 2064 6f20 6e6f 7420 7375 7070  lots do not supp
-0000a660: 6f72 7420 220a 2020 2020 2020 2020 2020  ort ".          
-0000a670: 2020 2020 2020 2275 7365 722d 7072 6f76        "user-prov
-0000a680: 6964 6564 206e 756d 6572 6963 616c 2066  ided numerical f
-0000a690: 756e 6374 696f 6e73 2e22 290a 0a20 2020  unctions.")..   
-0000a6a0: 2020 2020 2023 2069 6620 7468 6520 6578       # if the ex
-0000a6b0: 7072 6573 7369 6f6e 7320 6973 2061 206c  pressions is a l
-0000a6c0: 616d 6264 6120 6675 6e63 7469 6f6e 2061  ambda function a
-0000a6d0: 6e64 206e 6f20 6c61 6265 6c20 6861 7320  nd no label has 
-0000a6e0: 6265 656e 0a20 2020 2020 2020 2023 2070  been.        # p
-0000a6f0: 726f 7669 6465 642c 2074 6865 6e20 6974  rovided, then it
-0000a700: 7320 6265 7474 6572 2074 6f20 646f 2074  s better to do t
-0000a710: 6865 2066 6f6c 6c6f 7769 6e67 2069 6e20  he following in 
-0000a720: 6f72 6465 7220 746f 2061 766f 6964 0a20  order to avoid. 
-0000a730: 2020 2020 2020 2023 2073 7570 7269 7365         # suprise
-0000a740: 7320 6f6e 2074 6865 2062 6163 6b65 6e64  s on the backend
-0000a750: 0a20 2020 2020 2020 2069 6620 616e 7928  .        if any(
-0000a760: 6361 6c6c 6162 6c65 2865 2920 666f 7220  callable(e) for 
-0000a770: 6520 696e 2065 7870 7273 293a 0a20 2020  e in exprs):.   
-0000a780: 2020 2020 2020 2020 2069 6620 7365 6c66           if self
-0000a790: 2e5f 6c61 6265 6c20 3d3d 2073 7472 2873  ._label == str(s
-0000a7a0: 656c 662e 6578 7072 293a 0a20 2020 2020  elf.expr):.     
-0000a7b0: 2020 2020 2020 2020 2020 2073 656c 662e             self.
-0000a7c0: 6c61 6265 6c20 3d20 2222 0a0a 2020 2020  label = ""..    
-0000a7d0: 2020 2020 7365 6c66 2e5f 6368 6563 6b5f      self._check_
-0000a7e0: 6673 2829 0a0a 2020 2020 2020 2020 6966  fs()..        if
-0000a7f0: 2068 6173 6174 7472 2873 656c 662c 2022   hasattr(self, "
-0000a800: 6164 6170 7469 7665 2229 2061 6e64 2073  adaptive") and s
-0000a810: 656c 662e 6164 6170 7469 7665 2061 6e64  elf.adaptive and
-0000a820: 2073 656c 662e 7061 7261 6d73 3a0a 2020   self.params:.  
-0000a830: 2020 2020 2020 2020 2020 7761 726e 696e            warnin
-0000a840: 6773 2e77 6172 6e28 0a20 2020 2020 2020  gs.warn(.       
-0000a850: 2020 2020 2020 2020 2022 6070 6172 616d           "`param
-0000a860: 7360 2077 6173 2070 726f 7669 6465 642c  s` was provided,
-0000a870: 2068 656e 6365 2061 6e20 696e 7465 7261   hence an intera
-0000a880: 6374 6976 6520 706c 6f74 2022 0a20 2020  ctive plot ".   
-0000a890: 2020 2020 2020 2020 2020 2020 2022 6973               "is
-0000a8a0: 2065 7870 6563 7465 642e 2048 6f77 6576   expected. Howev
-0000a8b0: 6572 2c20 696e 7465 7261 6374 6976 6520  er, interactive 
-0000a8c0: 706c 6f74 7320 646f 206e 6f74 2073 7570  plots do not sup
-0000a8d0: 706f 7274 2022 0a20 2020 2020 2020 2020  port ".         
-0000a8e0: 2020 2020 2020 2022 6164 6170 7469 7665         "adaptive
-0000a8f0: 2065 7661 6c75 6174 696f 6e2e 2041 7574   evaluation. Aut
-0000a900: 6f6d 6174 6963 616c 6c79 2073 7769 7463  omatically switc
-0000a910: 6865 6420 746f 2022 0a20 2020 2020 2020  hed to ".       
-0000a920: 2020 2020 2020 2020 2022 6164 6170 7469           "adapti
-0000a930: 7665 3d46 616c 7365 2e22 290a 2020 2020  ve=False.").    
-0000a940: 2020 2020 2020 2020 7365 6c66 2e61 6461          self.ada
-0000a950: 7074 6976 6520 3d20 4661 6c73 650a 0a0a  ptive = False...
-0000a960: 6465 6620 5f64 6574 6563 745f 706f 6c65  def _detect_pole
-0000a970: 735f 6e75 6d65 7269 6361 6c5f 6865 6c70  s_numerical_help
-0000a980: 6572 280a 2020 2020 782c 2079 2c20 6570  er(.    x, y, ep
-0000a990: 733d 302e 3031 2c20 6578 7072 3d4e 6f6e  s=0.01, expr=Non
-0000a9a0: 652c 2073 796d 623d 4e6f 6e65 2c20 7379  e, symb=None, sy
-0000a9b0: 6d62 6f6c 6963 3d46 616c 7365 0a29 3a0a  mbolic=False.):.
-0000a9c0: 2020 2020 2222 2243 6f6d 7075 7465 2074      """Compute t
-0000a9d0: 6865 2073 7465 6570 6e65 7373 206f 6620  he steepness of 
-0000a9e0: 6561 6368 2073 6567 6d65 6e74 2e20 4966  each segment. If
-0000a9f0: 2069 7427 7320 6772 6561 7465 7220 7468   it's greater th
-0000aa00: 616e 2061 0a20 2020 2074 6872 6573 686f  an a.    thresho
-0000aa10: 6c64 2c20 7365 7420 7468 6520 7269 6768  ld, set the righ
-0000aa20: 742d 706f 696e 7420 792d 7661 6c75 6520  t-point y-value 
-0000aa30: 6e6f 6e20 4e61 4e20 616e 6420 7265 636f  non NaN and reco
-0000aa40: 7264 2074 6865 0a20 2020 2063 6f72 7265  rd the.    corre
-0000aa50: 7370 6f6e 6469 6e67 2078 2d6c 6f63 6174  sponding x-locat
-0000aa60: 696f 6e20 666f 7220 6675 7274 6865 7220  ion for further 
-0000aa70: 7072 6f63 6573 7369 6e67 2e0a 0a20 2020  processing...   
-0000aa80: 2052 6574 7572 6e73 0a20 2020 203d 3d3d   Returns.    ===
-0000aa90: 3d3d 3d3d 0a20 2020 2078 203a 206e 702e  ====.    x : np.
-0000aaa0: 6e64 6172 7261 790a 2020 2020 2020 2020  ndarray.        
-0000aab0: 556e 6368 616e 6765 6420 782d 6461 7461  Unchanged x-data
-0000aac0: 2e0a 2020 2020 7979 203a 206e 702e 6e64  ..    yy : np.nd
-0000aad0: 6172 7261 790a 2020 2020 2020 2020 4d6f  array.        Mo
-0000aae0: 6469 6669 6564 2079 2d64 6174 6120 7769  dified y-data wi
-0000aaf0: 7468 204e 614e 2076 616c 7565 732e 0a20  th NaN values.. 
-0000ab00: 2020 2022 2222 0a20 2020 206e 7020 3d20     """.    np = 
-0000ab10: 696d 706f 7274 5f6d 6f64 756c 6528 276e  import_module('n
-0000ab20: 756d 7079 2729 0a0a 2020 2020 7979 203d  umpy')..    yy =
-0000ab30: 2079 2e63 6f70 7928 290a 2020 2020 7468   y.copy().    th
-0000ab40: 7265 7368 6f6c 6420 3d20 6e70 2e70 6920  reshold = np.pi 
-0000ab50: 2f20 3220 2d20 6570 730a 2020 2020 666f  / 2 - eps.    fo
-0000ab60: 7220 6920 696e 2072 616e 6765 286c 656e  r i in range(len
-0000ab70: 2878 2920 2d20 3129 3a0a 2020 2020 2020  (x) - 1):.      
-0000ab80: 2020 6478 203d 2078 5b69 202b 2031 5d20    dx = x[i + 1] 
-0000ab90: 2d20 785b 695d 0a20 2020 2020 2020 2064  - x[i].        d
-0000aba0: 7920 3d20 6162 7328 795b 6920 2b20 315d  y = abs(y[i + 1]
-0000abb0: 202d 2079 5b69 5d29 0a20 2020 2020 2020   - y[i]).       
-0000abc0: 2061 6e67 6c65 203d 206e 702e 6172 6374   angle = np.arct
-0000abd0: 616e 2864 7920 2f20 6478 290a 2020 2020  an(dy / dx).    
-0000abe0: 2020 2020 6966 2061 6273 2861 6e67 6c65      if abs(angle
-0000abf0: 2920 3e3d 2074 6872 6573 686f 6c64 3a0a  ) >= threshold:.
-0000ac00: 2020 2020 2020 2020 2020 2020 7979 5b69              yy[i
-0000ac10: 202b 2031 5d20 3d20 6e70 2e6e 616e 0a0a   + 1] = np.nan..
-0000ac20: 2020 2020 7265 7475 726e 2078 2c20 7979      return x, yy
-0000ac30: 0a0a 0a64 6566 205f 6465 7465 6374 5f70  ...def _detect_p
-0000ac40: 6f6c 6573 5f73 796d 626f 6c69 635f 6865  oles_symbolic_he
-0000ac50: 6c70 6572 2865 7870 722c 2073 796d 622c  lper(expr, symb,
-0000ac60: 2073 7461 7274 2c20 656e 6429 3a0a 2020   start, end):.  
-0000ac70: 2020 2222 2241 7474 656d 7074 7320 746f    """Attempts to
-0000ac80: 2063 6f6d 7075 7465 2073 796d 626f 6c69   compute symboli
-0000ac90: 6320 6469 7363 6f6e 7469 6e75 6974 6965  c discontinuitie
-0000aca0: 732e 0a0a 2020 2020 5265 7475 726e 730a  s...    Returns.
-0000acb0: 2020 2020 3d3d 3d3d 3d3d 3d0a 2020 2020      =======.    
-0000acc0: 706f 6c65 203a 206c 6973 740a 2020 2020  pole : list.    
-0000acd0: 2020 2020 4c69 7374 206f 6620 7379 6d62      List of symb
-0000ace0: 6f6c 6963 2070 6f6c 6573 2c20 706f 7373  olic poles, poss
-0000acf0: 6962 696c 7920 656d 7074 792e 0a20 2020  ibily empty..   
-0000ad00: 2022 2222 0a20 2020 2070 6f6c 6573 203d   """.    poles =
-0000ad10: 205b 5d0a 2020 2020 696e 7465 7276 616c   [].    interval
-0000ad20: 203d 2049 6e74 6572 7661 6c28 6e73 696d   = Interval(nsim
-0000ad30: 706c 6966 7928 7374 6172 7429 2c20 6e73  plify(start), ns
-0000ad40: 696d 706c 6966 7928 656e 6429 290a 2020  implify(end)).  
-0000ad50: 2020 7265 7320 3d20 636f 6e74 696e 756f    res = continuo
-0000ad60: 7573 5f64 6f6d 6169 6e28 6578 7072 2c20  us_domain(expr, 
-0000ad70: 7379 6d62 2c20 696e 7465 7276 616c 290a  symb, interval).
-0000ad80: 2020 2020 7265 7320 3d20 7265 732e 7369      res = res.si
-0000ad90: 6d70 6c69 6679 2829 0a20 2020 2069 6620  mplify().    if 
-0000ada0: 7265 7320 3d3d 2069 6e74 6572 7661 6c3a  res == interval:
-0000adb0: 0a20 2020 2020 2020 2070 6173 730a 2020  .        pass.  
-0000adc0: 2020 656c 6966 2028 6973 696e 7374 616e    elif (isinstan
-0000add0: 6365 2872 6573 2c20 556e 696f 6e29 2061  ce(res, Union) a
-0000ade0: 6e64 0a20 2020 2020 2020 2061 6c6c 2869  nd.        all(i
-0000adf0: 7369 6e73 7461 6e63 6528 742c 2049 6e74  sinstance(t, Int
-0000ae00: 6572 7661 6c29 2066 6f72 2074 2069 6e20  erval) for t in 
-0000ae10: 7265 732e 6172 6773 2929 3a0a 2020 2020  res.args)):.    
-0000ae20: 2020 2020 706f 6c65 7320 3d20 5b5d 0a20      poles = []. 
-0000ae30: 2020 2020 2020 2066 6f72 2073 2069 6e20         for s in 
-0000ae40: 7265 732e 6172 6773 3a0a 2020 2020 2020  res.args:.      
-0000ae50: 2020 2020 2020 6966 2073 2e6c 6566 745f        if s.left_
-0000ae60: 6f70 656e 3a0a 2020 2020 2020 2020 2020  open:.          
-0000ae70: 2020 2020 2020 706f 6c65 732e 6170 7065        poles.appe
-0000ae80: 6e64 2873 2e6c 6566 7429 0a20 2020 2020  nd(s.left).     
-0000ae90: 2020 2020 2020 2069 6620 732e 7269 6768         if s.righ
-0000aea0: 745f 6f70 656e 3a0a 2020 2020 2020 2020  t_open:.        
-0000aeb0: 2020 2020 2020 2020 706f 6c65 732e 6170          poles.ap
-0000aec0: 7065 6e64 2873 2e72 6967 6874 290a 2020  pend(s.right).  
-0000aed0: 2020 2020 2020 706f 6c65 7320 3d20 6c69        poles = li
-0000aee0: 7374 2873 6574 2870 6f6c 6573 2929 0a20  st(set(poles)). 
-0000aef0: 2020 2065 6c73 653a 0a20 2020 2020 2020     else:.       
-0000af00: 2072 6169 7365 2056 616c 7565 4572 726f   raise ValueErro
-0000af10: 7228 0a20 2020 2020 2020 2020 2020 2066  r(.            f
-0000af20: 2243 6f75 6c64 206e 6f74 2070 6172 7365  "Could not parse
-0000af30: 2074 6865 2066 6f6c 6c6f 7769 6e67 206f   the following o
-0000af40: 626a 6563 743a 207b 7265 737d 202e 5c6e  bject: {res} .\n
-0000af50: 220a 2020 2020 2020 2020 2020 2020 2250  ".            "P
-0000af60: 6c65 6173 652c 2073 7562 6d69 7420 7468  lease, submit th
-0000af70: 6973 2061 7320 6120 6275 672e 2043 6f6e  is as a bug. Con
-0000af80: 7369 6465 7220 616c 736f 2074 6f20 7365  sider also to se
-0000af90: 7420 220a 2020 2020 2020 2020 2020 2020  t ".            
-0000afa0: 2260 6465 7465 6374 5f70 6f6c 6573 3d54  "`detect_poles=T
-0000afb0: 7275 6560 2e22 0a20 2020 2020 2020 2029  rue`.".        )
-0000afc0: 0a20 2020 2072 6574 7572 6e20 706f 6c65  .    return pole
-0000afd0: 730a 0a0a 6465 6620 5f63 6865 636b 5f73  s...def _check_s
-0000afe0: 7465 7073 2873 7465 7073 293a 0a20 2020  teps(steps):.   
-0000aff0: 2069 6620 6973 696e 7374 616e 6365 2873   if isinstance(s
-0000b000: 7465 7073 2c20 7374 7229 3a0a 2020 2020  teps, str):.    
-0000b010: 2020 2020 7374 6570 7320 3d20 7374 6570      steps = step
-0000b020: 732e 6c6f 7765 7228 290a 2020 2020 706f  s.lower().    po
-0000b030: 7373 6962 6c65 5f76 616c 7565 7320 3d20  ssible_values = 
-0000b040: 5b22 7072 6522 2c20 2270 6f73 7422 2c20  ["pre", "post", 
-0000b050: 226d 6964 222c 2054 7275 652c 2046 616c  "mid", True, Fal
-0000b060: 7365 2c20 4e6f 6e65 5d0a 2020 2020 6966  se, None].    if
-0000b070: 206e 6f74 2028 7374 6570 7320 696e 2070   not (steps in p
-0000b080: 6f73 7369 626c 655f 7661 6c75 6573 293a  ossible_values):
-0000b090: 0a20 2020 2020 2020 2077 6172 6e69 6e67  .        warning
-0000b0a0: 732e 7761 726e 280a 2020 2020 2020 2020  s.warn(.        
-0000b0b0: 2020 2020 2260 6073 7465 7073 6060 206e      "``steps`` n
-0000b0c0: 6f74 2072 6563 6f67 6e69 7a65 642e 2050  ot recognized. P
-0000b0d0: 6f73 7369 626c 6520 7661 6c75 6573 2061  ossible values a
-0000b0e0: 7265 3a20 2220 2520 706f 7373 6962 6c65  re: " % possible
-0000b0f0: 5f76 616c 7565 730a 2020 2020 2020 2020  _values.        
-0000b100: 290a 2020 2020 7265 7475 726e 2073 7465  ).    return ste
-0000b110: 7073 0a0a 0a63 6c61 7373 204c 696e 6532  ps...class Line2
-0000b120: 4442 6173 6553 6572 6965 7328 4261 7365  DBaseSeries(Base
-0000b130: 5365 7269 6573 293a 0a20 2020 2022 2222  Series):.    """
-0000b140: 4120 6261 7365 2063 6c61 7373 2066 6f72  A base class for
-0000b150: 2032 4420 6c69 6e65 732e 2222 220a 0a20   2D lines.""".. 
-0000b160: 2020 2069 735f 3244 6c69 6e65 203d 2054     is_2Dline = T
-0000b170: 7275 650a 2020 2020 5f4e 203d 2031 3030  rue.    _N = 100
-0000b180: 300a 2020 2020 5f61 6c6c 6f77 6564 5f6b  0.    _allowed_k
-0000b190: 6579 7320 3d20 5b0a 2020 2020 2020 2020  eys = [.        
-0000b1a0: 2273 7465 7073 222c 2022 7363 6174 7465  "steps", "scatte
-0000b1b0: 7222 2c20 2269 735f 6669 6c6c 6564 222c  r", "is_filled",
-0000b1c0: 2022 6669 6c6c 222c 2022 6c69 6e65 5f63   "fill", "line_c
-0000b1d0: 6f6c 6f72 222c 2022 6465 7465 6374 5f70  olor", "detect_p
-0000b1e0: 6f6c 6573 222c 0a20 2020 2020 2020 2022  oles",.        "
-0000b1f0: 6570 7322 2c20 2269 735f 706f 6c61 7222  eps", "is_polar"
-0000b200: 2c20 2275 6e77 7261 7022 2c20 2265 7863  , "unwrap", "exc
-0000b210: 6c75 6465 222c 0a20 2020 205d 0a0a 2020  lude",.    ]..  
-0000b220: 2020 6465 6620 5f5f 696e 6974 5f5f 2873    def __init__(s
-0000b230: 656c 662c 202a 6172 6773 2c20 2a2a 6b77  elf, *args, **kw
-0000b240: 6172 6773 293a 0a20 2020 2020 2020 2073  args):.        s
-0000b250: 7570 6572 2829 2e5f 5f69 6e69 745f 5f28  uper().__init__(
-0000b260: 2a61 7267 732c 202a 2a6b 7761 7267 7329  *args, **kwargs)
-0000b270: 0a20 2020 2020 2020 2023 206d 6f64 6966  .        # modif
-0000b280: 7920 7468 6520 636f 6d70 7574 6564 2063  y the computed c
-0000b290: 6f6f 7264 696e 6174 6573 2069 6e20 6f72  oordinates in or
-0000b2a0: 6465 7220 746f 206f 6274 6169 6e20 6120  der to obtain a 
-0000b2b0: 7374 6570 2d6c 696b 6520 706c 6f74 0a20  step-like plot. 
-0000b2c0: 2020 2020 2020 2073 656c 662e 7374 6570         self.step
-0000b2d0: 7320 3d20 5f63 6865 636b 5f73 7465 7073  s = _check_steps
-0000b2e0: 286b 7761 7267 732e 6765 7428 2273 7465  (kwargs.get("ste
-0000b2f0: 7073 222c 2046 616c 7365 2929 0a20 2020  ps", False)).   
-0000b300: 2020 2020 2023 2077 6865 7468 6572 2074       # whether t
-0000b310: 6f20 6372 6561 7465 2073 6361 7474 6572  o create scatter
-0000b320: 206f 7220 6120 636f 6e74 696e 756f 7573   or a continuous
-0000b330: 206c 696e 650a 2020 2020 2020 2020 7365   line.        se
-0000b340: 6c66 2e69 735f 706f 696e 7420 3d20 6b77  lf.is_point = kw
-0000b350: 6172 6773 2e67 6574 2822 7363 6174 7465  args.get("scatte
-0000b360: 7222 2c20 6b77 6172 6773 2e67 6574 2822  r", kwargs.get("
-0000b370: 6973 5f70 6f69 6e74 222c 2046 616c 7365  is_point", False
-0000b380: 2929 0a20 2020 2020 2020 2023 2077 6865  )).        # whe
-0000b390: 7468 6572 2073 6361 7474 6572 2773 206d  ther scatter's m
-0000b3a0: 6172 6b65 7273 2061 7265 2066 696c 6c65  arkers are fille
-0000b3b0: 6420 6f72 2076 6f69 640a 2020 2020 2020  d or void.      
-0000b3c0: 2020 7365 6c66 2e69 735f 6669 6c6c 6564    self.is_filled
-0000b3d0: 203d 206b 7761 7267 732e 6765 7428 2269   = kwargs.get("i
-0000b3e0: 735f 6669 6c6c 6564 222c 206b 7761 7267  s_filled", kwarg
-0000b3f0: 732e 6765 7428 2266 696c 6c22 2c20 5472  s.get("fill", Tr
-0000b400: 7565 2929 0a20 2020 2020 2020 2023 2077  ue)).        # w
-0000b410: 6865 7468 6572 2074 6f20 7573 6520 6120  hether to use a 
-0000b420: 636f 6c6f 726d 6170 206f 7220 6120 736f  colormap or a so
-0000b430: 6c69 6420 6c69 6e65 2063 6f6c 6f72 0a20  lid line color. 
-0000b440: 2020 2020 2020 2073 656c 662e 7573 655f         self.use_
-0000b450: 636d 203d 206b 7761 7267 732e 6765 7428  cm = kwargs.get(
-0000b460: 2275 7365 5f63 6d22 2c20 4661 6c73 6529  "use_cm", False)
-0000b470: 0a20 2020 2020 2020 2023 2066 6f72 2062  .        # for b
-0000b480: 6163 6b2d 636f 6d70 6174 6962 696c 6974  ack-compatibilit
-0000b490: 7920 7769 7468 206f 6c64 2073 796d 7079  y with old sympy
-0000b4a0: 2e70 6c6f 7474 696e 670a 2020 2020 2020  .plotting.      
-0000b4b0: 2020 7365 6c66 2e6c 696e 655f 636f 6c6f    self.line_colo
-0000b4c0: 7220 3d20 6b77 6172 6773 2e67 6574 2822  r = kwargs.get("
-0000b4d0: 6c69 6e65 5f63 6f6c 6f72 222c 204e 6f6e  line_color", Non
-0000b4e0: 6529 0a20 2020 2020 2020 2023 2077 6865  e).        # whe
-0000b4f0: 7468 6572 2074 6f20 6465 7465 6374 2072  ther to detect r
-0000b500: 6f6f 7473 206f 6620 6465 6e6f 6d69 6e61  oots of denomina
-0000b510: 746f 720a 2020 2020 2020 2020 7365 6c66  tor.        self
-0000b520: 2e64 6574 6563 745f 706f 6c65 7320 3d20  .detect_poles = 
-0000b530: 6b77 6172 6773 2e67 6574 2822 6465 7465  kwargs.get("dete
-0000b540: 6374 5f70 6f6c 6573 222c 2046 616c 7365  ct_poles", False
-0000b550: 290a 2020 2020 2020 2020 2320 6120 7061  ).        # a pa
-0000b560: 7261 6d65 7465 7220 746f 2063 6f6e 7472  rameter to contr
-0000b570: 6f6c 2074 6865 2064 6574 6563 745f 706f  ol the detect_po
-0000b580: 6c65 7320 616c 676f 7269 7468 6d0a 2020  les algorithm.  
-0000b590: 2020 2020 2020 7365 6c66 2e65 7073 203d        self.eps =
-0000b5a0: 206b 7761 7267 732e 6765 7428 2265 7073   kwargs.get("eps
-0000b5b0: 222c 2030 2e30 3129 0a20 2020 2020 2020  ", 0.01).       
-0000b5c0: 2023 2077 6865 6e20 6465 7465 6374 5f70   # when detect_p
-0000b5d0: 6f6c 6573 3d22 7379 6d62 6f6c 6963 222c  oles="symbolic",
-0000b5e0: 2073 746f 7265 7320 7468 6520 6c6f 6361   stores the loca
-0000b5f0: 7469 6f6e 206f 6620 706f 6c65 7320 736f  tion of poles so
-0000b600: 2074 6861 740a 2020 2020 2020 2020 2320   that.        # 
-0000b610: 7468 6579 2063 616e 2062 6520 6170 7072  they can be appr
-0000b620: 6f70 7269 6174 656c 7920 7265 6e64 6572  opriately render
-0000b630: 6564 0a20 2020 2020 2020 2073 656c 662e  ed.        self.
-0000b640: 706f 6c65 735f 6c6f 6361 7469 6f6e 7320  poles_locations 
-0000b650: 3d20 5b5d 0a20 2020 2020 2020 2023 2077  = [].        # w
-0000b660: 6865 7468 6572 2074 6f20 636f 6e76 6572  hether to conver
-0000b670: 2074 6865 2063 6f6d 7075 7465 6420 636f   the computed co
-0000b680: 6f72 6469 6e61 7465 7320 746f 2070 6f6c  ordinates to pol
-0000b690: 6172 2063 6f6f 7264 696e 6174 6573 0a20  ar coordinates. 
-0000b6a0: 2020 2020 2020 2073 656c 662e 6973 5f70         self.is_p
-0000b6b0: 6f6c 6172 203d 206b 7761 7267 732e 6765  olar = kwargs.ge
-0000b6c0: 7428 2269 735f 706f 6c61 7222 2c20 4661  t("is_polar", Fa
-0000b6d0: 6c73 6529 0a20 2020 2020 2020 2023 2077  lse).        # w
-0000b6e0: 6865 7468 6572 2074 6f20 7573 6520 6e75  hether to use nu
-0000b6f0: 6d70 792e 756e 7772 6170 2829 0a20 2020  mpy.unwrap().   
-0000b700: 2020 2020 2073 656c 662e 756e 7772 6170       self.unwrap
-0000b710: 203d 206b 7761 7267 732e 6765 7428 2275   = kwargs.get("u
-0000b720: 6e77 7261 7022 2c20 4661 6c73 6529 0a20  nwrap", False). 
-0000b730: 2020 2020 2020 2023 206c 6973 7420 6f66         # list of
-0000b740: 2078 2d63 6f6f 7264 696e 6174 6573 2074   x-coordinates t
-0000b750: 6f20 6265 2065 7863 6c75 6465 6420 6672  o be excluded fr
-0000b760: 6f6d 2065 7661 6c75 6174 696f 6e0a 2020  om evaluation.  
-0000b770: 2020 2020 2020 6578 636c 7564 6520 3d20        exclude = 
-0000b780: 6b77 6172 6773 2e67 6574 2822 6578 636c  kwargs.get("excl
-0000b790: 7564 6522 2c20 5b5d 290a 2020 2020 2020  ude", []).      
-0000b7a0: 2020 6966 2069 7369 6e73 7461 6e63 6528    if isinstance(
-0000b7b0: 6578 636c 7564 652c 2053 6574 293a 0a20  exclude, Set):. 
-0000b7c0: 2020 2020 2020 2020 2020 2065 7863 6c75             exclu
-0000b7d0: 6465 203d 206c 6973 7428 6578 7472 6163  de = list(extrac
-0000b7e0: 745f 736f 6c75 7469 6f6e 2865 7863 6c75  t_solution(exclu
-0000b7f0: 6465 2c20 6e3d 3130 3029 290a 2020 2020  de, n=100)).    
-0000b800: 2020 2020 6966 206e 6f74 2068 6173 6174      if not hasat
-0000b810: 7472 2865 7863 6c75 6465 2c20 225f 5f69  tr(exclude, "__i
-0000b820: 7465 725f 5f22 293a 0a20 2020 2020 2020  ter__"):.       
-0000b830: 2020 2020 2065 7863 6c75 6465 203d 205b       exclude = [
-0000b840: 6578 636c 7564 655d 0a20 2020 2020 2020  exclude].       
-0000b850: 2065 7863 6c75 6465 203d 205b 666c 6f61   exclude = [floa
-0000b860: 7428 6529 2066 6f72 2065 2069 6e20 6578  t(e) for e in ex
-0000b870: 636c 7564 655d 0a20 2020 2020 2020 2073  clude].        s
-0000b880: 656c 662e 6578 636c 7564 6520 3d20 736f  elf.exclude = so
-0000b890: 7274 6564 2865 7863 6c75 6465 290a 0a20  rted(exclude).. 
-0000b8a0: 2020 2064 6566 2067 6574 5f64 6174 6128     def get_data(
-0000b8b0: 7365 6c66 293a 0a20 2020 2020 2020 2022  self):.        "
-0000b8c0: 2222 5265 7475 726e 2063 6f6f 7264 696e  ""Return coordin
-0000b8d0: 6174 6573 2066 6f72 2070 6c6f 7474 696e  ates for plottin
-0000b8e0: 6720 7468 6520 6c69 6e65 2e0a 0a20 2020  g the line...   
-0000b8f0: 2020 2020 2052 6574 7572 6e73 0a20 2020       Returns.   
-0000b900: 2020 2020 203d 3d3d 3d3d 3d3d 0a0a 2020       =======..  
-0000b910: 2020 2020 2020 783a 206e 702e 6e64 6172        x: np.ndar
-0000b920: 7261 790a 2020 2020 2020 2020 2020 2020  ray.            
-0000b930: 782d 636f 6f72 6469 6e61 7465 730a 2020  x-coordinates.  
-0000b940: 2020 2020 2020 793a 206e 702e 6e64 6172        y: np.ndar
-0000b950: 7261 790a 2020 2020 2020 2020 2020 2020  ray.            
-0000b960: 792d 636f 6f72 6469 6e61 7465 730a 2020  y-coordinates.  
-0000b970: 2020 2020 2020 7a3a 206e 702e 6e64 6172        z: np.ndar
-0000b980: 7261 7920 286f 7074 696f 6e61 6c29 0a20  ray (optional). 
-0000b990: 2020 2020 2020 2020 2020 207a 2d63 6f6f             z-coo
-0000b9a0: 7264 696e 6174 6573 2069 6e20 6361 7365  rdinates in case
-0000b9b0: 206f 6620 5061 7261 6d65 7472 6963 3344   of Parametric3D
-0000b9c0: 4c69 6e65 5365 7269 6573 0a20 2020 2020  LineSeries.     
-0000b9d0: 2020 2070 6172 616d 203a 206e 702e 6e64     param : np.nd
-0000b9e0: 6172 7261 7920 286f 7074 696f 6e61 6c29  array (optional)
-0000b9f0: 0a20 2020 2020 2020 2020 2020 2054 6865  .            The
-0000ba00: 2070 6172 616d 6574 6572 2069 6e20 6361   parameter in ca
-0000ba10: 7365 206f 6620 5061 7261 6d65 7472 6963  se of Parametric
-0000ba20: 3244 4c69 6e65 5365 7269 6573 2c0a 2020  2DLineSeries,.  
-0000ba30: 2020 2020 2020 2020 2020 5061 7261 6d65            Parame
-0000ba40: 7472 6963 3344 4c69 6e65 5365 7269 6573  tric3DLineSeries
-0000ba50: 206f 7220 4162 7341 7267 4c69 6e65 5365   or AbsArgLineSe
-0000ba60: 7269 6573 2e0a 2020 2020 2020 2020 2222  ries..        ""
-0000ba70: 220a 2020 2020 2020 2020 6e70 203d 2069  ".        np = i
-0000ba80: 6d70 6f72 745f 6d6f 6475 6c65 2827 6e75  mport_module('nu
-0000ba90: 6d70 7927 290a 2020 2020 2020 2020 706f  mpy').        po
-0000baa0: 696e 7473 203d 2073 656c 662e 5f67 6574  ints = self._get
-0000bab0: 5f64 6174 615f 6865 6c70 6572 2829 0a0a  _data_helper()..
-0000bac0: 2020 2020 2020 2020 6966 2028 0a20 2020          if (.   
-0000bad0: 2020 2020 2020 2020 2069 7369 6e73 7461           isinsta
-0000bae0: 6e63 6528 7365 6c66 2c20 4c69 6e65 4f76  nce(self, LineOv
-0000baf0: 6572 3144 5261 6e67 6553 6572 6965 7329  er1DRangeSeries)
-0000bb00: 2061 6e64 0a20 2020 2020 2020 2020 2020   and.           
-0000bb10: 2028 7365 6c66 2e64 6574 6563 745f 706f   (self.detect_po
-0000bb20: 6c65 7320 3d3d 2022 7379 6d62 6f6c 6963  les == "symbolic
-0000bb30: 2229 0a20 2020 2020 2020 2029 3a0a 2020  ").        ):.  
-0000bb40: 2020 2020 2020 2020 2020 706f 6c65 7320            poles 
-0000bb50: 3d20 5f64 6574 6563 745f 706f 6c65 735f  = _detect_poles_
-0000bb60: 7379 6d62 6f6c 6963 5f68 656c 7065 7228  symbolic_helper(
-0000bb70: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0000bb80: 2073 656c 662e 6578 7072 2e73 7562 7328   self.expr.subs(
-0000bb90: 7365 6c66 2e70 6172 616d 7329 2c20 2a73  self.params), *s
-0000bba0: 656c 662e 7261 6e67 6573 5b30 5d29 0a20  elf.ranges[0]). 
-0000bbb0: 2020 2020 2020 2020 2020 2070 6f6c 6573             poles
-0000bbc0: 203d 206e 702e 6172 7261 7928 5b66 6c6f   = np.array([flo
-0000bbd0: 6174 2874 2920 666f 7220 7420 696e 2070  at(t) for t in p
-0000bbe0: 6f6c 6573 5d29 0a20 2020 2020 2020 2020  oles]).         
-0000bbf0: 2020 2074 203d 206c 616d 6264 6120 782c     t = lambda x,
-0000bc00: 2074 7261 6e73 666f 726d 3a20 7820 6966   transform: x if
-0000bc10: 2074 7261 6e73 666f 726d 2069 7320 4e6f   transform is No
-0000bc20: 6e65 2065 6c73 6520 7472 616e 7366 6f72  ne else transfor
-0000bc30: 6d28 7829 0a20 2020 2020 2020 2020 2020  m(x).           
-0000bc40: 2073 656c 662e 706f 6c65 735f 6c6f 6361   self.poles_loca
-0000bc50: 7469 6f6e 7320 3d20 7428 6e70 2e61 7272  tions = t(np.arr
-0000bc60: 6179 2870 6f6c 6573 292c 2073 656c 662e  ay(poles), self.
-0000bc70: 5f74 7829 0a0a 2020 2020 2020 2020 2320  _tx)..        # 
-0000bc80: 706f 7374 7072 6f63 6573 7369 6e67 0a20  postprocessing. 
-0000bc90: 2020 2020 2020 2070 6f69 6e74 7320 3d20         points = 
-0000bca0: 7365 6c66 2e5f 6170 706c 795f 7472 616e  self._apply_tran
-0000bcb0: 7366 6f72 6d28 2a70 6f69 6e74 7329 0a0a  sform(*points)..
-0000bcc0: 2020 2020 2020 2020 6966 2073 656c 662e          if self.
-0000bcd0: 6973 5f32 446c 696e 6520 616e 6420 7365  is_2Dline and se
-0000bce0: 6c66 2e64 6574 6563 745f 706f 6c65 733a  lf.detect_poles:
-0000bcf0: 0a20 2020 2020 2020 2020 2020 2069 6620  .            if 
-0000bd00: 6c65 6e28 706f 696e 7473 2920 3d3d 2032  len(points) == 2
-0000bd10: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-0000bd20: 2020 782c 2079 203d 2070 6f69 6e74 730a    x, y = points.
-0000bd30: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000bd40: 782c 2079 203d 205f 6465 7465 6374 5f70  x, y = _detect_p
-0000bd50: 6f6c 6573 5f6e 756d 6572 6963 616c 5f68  oles_numerical_h
-0000bd60: 656c 7065 7228 0a20 2020 2020 2020 2020  elper(.         
-0000bd70: 2020 2020 2020 2020 2020 2078 2c20 792c             x, y,
-0000bd80: 2073 656c 662e 6570 7329 0a20 2020 2020   self.eps).     
-0000bd90: 2020 2020 2020 2020 2020 2070 6f69 6e74             point
-0000bda0: 7320 3d20 2878 2c20 7929 0a20 2020 2020  s = (x, y).     
-0000bdb0: 2020 2020 2020 2065 6c73 653a 0a20 2020         else:.   
-0000bdc0: 2020 2020 2020 2020 2020 2020 2078 2c20               x, 
-0000bdd0: 792c 2070 203d 2070 6f69 6e74 730a 2020  y, p = points.  
-0000bde0: 2020 2020 2020 2020 2020 2020 2020 782c                x,
-0000bdf0: 2079 203d 205f 6465 7465 6374 5f70 6f6c   y = _detect_pol
-0000be00: 6573 5f6e 756d 6572 6963 616c 5f68 656c  es_numerical_hel
-0000be10: 7065 7228 782c 2079 2c20 7365 6c66 2e65  per(x, y, self.e
-0000be20: 7073 290a 2020 2020 2020 2020 2020 2020  ps).            
-0000be30: 2020 2020 706f 696e 7473 203d 2028 782c      points = (x,
-0000be40: 2079 2c20 7029 0a0a 2020 2020 2020 2020   y, p)..        
-0000be50: 6966 2073 656c 662e 756e 7772 6170 3a0a  if self.unwrap:.
-0000be60: 2020 2020 2020 2020 2020 2020 6b77 203d              kw =
-0000be70: 207b 7d0a 2020 2020 2020 2020 2020 2020   {}.            
-0000be80: 6966 2073 656c 662e 756e 7772 6170 2069  if self.unwrap i
-0000be90: 7320 6e6f 7420 5472 7565 3a0a 2020 2020  s not True:.    
-0000bea0: 2020 2020 2020 2020 2020 2020 6b77 203d              kw =
-0000beb0: 2073 656c 662e 756e 7772 6170 0a20 2020   self.unwrap.   
-0000bec0: 2020 2020 2020 2020 2069 6620 7365 6c66           if self
-0000bed0: 2e69 735f 3244 6c69 6e65 3a0a 2020 2020  .is_2Dline:.    
-0000bee0: 2020 2020 2020 2020 2020 2020 6966 206c              if l
-0000bef0: 656e 2870 6f69 6e74 7329 203d 3d20 323a  en(points) == 2:
-0000bf00: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0000bf10: 2020 2020 2078 2c20 7920 3d20 706f 696e       x, y = poin
-0000bf20: 7473 0a20 2020 2020 2020 2020 2020 2020  ts.             
-0000bf30: 2020 2020 2020 2079 203d 206e 702e 756e         y = np.un
-0000bf40: 7772 6170 2879 2c20 2a2a 6b77 290a 2020  wrap(y, **kw).  
-0000bf50: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000bf60: 2020 706f 696e 7473 203d 2028 782c 2079    points = (x, y
-0000bf70: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
-0000bf80: 2020 656c 7365 3a0a 2020 2020 2020 2020    else:.        
-0000bf90: 2020 2020 2020 2020 2020 2020 782c 2079              x, y
-0000bfa0: 2c20 7020 3d20 706f 696e 7473 0a20 2020  , p = points.   
-0000bfb0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000bfc0: 2079 203d 206e 702e 756e 7772 6170 2879   y = np.unwrap(y
-0000bfd0: 2c20 2a2a 6b77 290a 2020 2020 2020 2020  , **kw).        
-0000bfe0: 2020 2020 2020 2020 2020 2020 706f 696e              poin
-0000bff0: 7473 203d 2028 782c 2079 2c20 7029 0a0a  ts = (x, y, p)..
-0000c000: 2020 2020 2020 2020 6966 2028 7365 6c66          if (self
-0000c010: 2e73 7465 7073 2069 7320 5472 7565 2920  .steps is True) 
-0000c020: 6f72 2028 7365 6c66 2e73 7465 7073 203d  or (self.steps =
-0000c030: 3d20 2270 7265 2229 3a0a 2020 2020 2020  = "pre"):.      
-0000c040: 2020 2020 2020 706f 696e 7473 203d 2070        points = p
-0000c050: 7473 5f74 6f5f 7072 6573 7465 7028 2a70  ts_to_prestep(*p
-0000c060: 6f69 6e74 7329 0a20 2020 2020 2020 2065  oints).        e
-0000c070: 6c69 6620 7365 6c66 2e73 7465 7073 203d  lif self.steps =
-0000c080: 3d20 2270 6f73 7422 3a0a 2020 2020 2020  = "post":.      
-0000c090: 2020 2020 2020 706f 696e 7473 203d 2070        points = p
-0000c0a0: 7473 5f74 6f5f 706f 7374 7374 6570 282a  ts_to_poststep(*
-0000c0b0: 706f 696e 7473 290a 2020 2020 2020 2020  points).        
-0000c0c0: 656c 6966 2073 656c 662e 7374 6570 7320  elif self.steps 
-0000c0d0: 3d3d 2022 6d69 6422 3a0a 2020 2020 2020  == "mid":.      
-0000c0e0: 2020 2020 2020 706f 696e 7473 203d 2070        points = p
-0000c0f0: 7473 5f74 6f5f 6d69 6473 7465 7028 2a70  ts_to_midstep(*p
-0000c100: 6f69 6e74 7329 0a0a 2020 2020 2020 2020  oints)..        
-0000c110: 706f 696e 7473 203d 2073 656c 662e 5f69  points = self._i
-0000c120: 6e73 6572 745f 6578 636c 7573 696f 6e73  nsert_exclusions
-0000c130: 2870 6f69 6e74 7329 0a20 2020 2020 2020  (points).       
-0000c140: 2072 6574 7572 6e20 706f 696e 7473 0a0a   return points..
-0000c150: 2020 2020 6465 6620 5f69 6e73 6572 745f      def _insert_
-0000c160: 6578 636c 7573 696f 6e73 2873 656c 662c  exclusions(self,
-0000c170: 2070 6f69 6e74 7329 3a0a 2020 2020 2020   points):.      
-0000c180: 2020 2222 2241 6464 204e 614e 2074 6f20    """Add NaN to 
-0000c190: 6561 6368 206f 6620 7468 6520 6578 636c  each of the excl
-0000c1a0: 7573 696f 6e20 706f 696e 742e 2050 7261  usion point. Pra
-0000c1b0: 6374 6963 616c 6c79 2c20 7468 6973 2061  ctically, this a
-0000c1c0: 6464 7320 610a 2020 2020 2020 2020 4e61  dds a.        Na
-0000c1d0: 4e20 746f 2074 6865 2065 786c 7573 696f  N to the exlusio
-0000c1e0: 6e20 706f 696e 742c 2070 6c75 7320 7477  n point, plus tw
-0000c1f0: 6f20 6f74 6865 7220 6e65 6172 6279 2070  o other nearby p
-0000c200: 6f69 6e74 7320 6576 616c 7561 7465 6420  oints evaluated 
-0000c210: 7769 7468 0a20 2020 2020 2020 2074 6865  with.        the
-0000c220: 206e 756d 6572 6963 616c 2066 756e 6374   numerical funct
-0000c230: 696f 6e73 2061 7373 6f63 6961 7465 6420  ions associated 
-0000c240: 746f 2074 6869 7320 6461 7461 2073 6572  to this data ser
-0000c250: 6965 732e 0a20 2020 2020 2020 2054 6865  ies..        The
-0000c260: 7365 206e 6561 7262 7920 706f 696e 7473  se nearby points
-0000c270: 2061 7265 2069 6d70 6f72 7461 6e74 2077   are important w
-0000c280: 6865 6e20 7468 6520 6e75 6d62 6572 206f  hen the number o
-0000c290: 6620 6469 7363 7265 7469 7a61 7469 6f6e  f discretization
-0000c2a0: 0a20 2020 2020 2020 2070 6f69 6e74 7320  .        points 
-0000c2b0: 6973 206c 6f77 2c20 6f72 2074 6865 2073  is low, or the s
-0000c2c0: 6361 6c65 2069 7320 6c6f 6761 7269 7468  cale is logarith
-0000c2d0: 6d2e 0a0a 2020 2020 2020 2020 4e4f 5445  m...        NOTE
-0000c2e0: 3a20 6974 2077 6f75 6c64 2062 6520 6561  : it would be ea
-0000c2f0: 7369 6572 2074 6f20 6a75 7374 2061 6464  sier to just add
-0000c300: 2065 7863 6c75 7369 6f6e 2070 6f69 6e74   exclusion point
-0000c310: 7320 746f 2074 6865 0a20 2020 2020 2020  s to the.       
-0000c320: 2064 6973 6372 6574 697a 6564 2064 6f6d   discretized dom
-0000c330: 6169 6e20 6265 666f 7265 2065 7661 6c75  ain before evalu
-0000c340: 6174 696f 6e2c 2074 6865 6e20 6166 7465  ation, then afte
-0000c350: 7220 6576 616c 7561 7469 6f6e 2061 6464  r evaluation add
-0000c360: 204e 614e 0a20 2020 2020 2020 2074 6f20   NaN.        to 
-0000c370: 7468 6520 6578 636c 7573 696f 6e20 706f  the exclusion po
-0000c380: 696e 7473 2e20 4275 7420 7468 6174 2773  ints. But that's
-0000c390: 206f 6e6c 7920 776f 726b 2077 6974 6820   only work with 
-0000c3a0: 6164 6170 7469 7665 3d46 616c 7365 2e0a  adaptive=False..
-0000c3b0: 2020 2020 2020 2020 5468 6520 666f 6c6c          The foll
-0000c3c0: 6f77 696e 6720 6170 7072 6f61 6368 2077  owing approach w
-0000c3d0: 6f72 6b20 6576 656e 2077 6974 6820 6164  ork even with ad
-0000c3e0: 6170 7469 7665 3d54 7275 652e 0a20 2020  aptive=True..   
-0000c3f0: 2020 2020 2022 2222 0a20 2020 2020 2020       """.       
-0000c400: 2069 6620 6c65 6e28 7365 6c66 2e65 7863   if len(self.exc
-0000c410: 6c75 6465 2920 3d3d 2030 3a0a 2020 2020  lude) == 0:.    
-0000c420: 2020 2020 2020 2020 7265 7475 726e 2070          return p
-0000c430: 6f69 6e74 730a 0a20 2020 2020 2020 206e  oints..        n
-0000c440: 7020 3d20 696d 706f 7274 5f6d 6f64 756c  p = import_modul
-0000c450: 6528 226e 756d 7079 2229 0a20 2020 2020  e("numpy").     
-0000c460: 2020 2070 6f69 6e74 7320 3d20 6c69 7374     points = list
-0000c470: 2870 6f69 6e74 7329 0a20 2020 2020 2020  (points).       
-0000c480: 206e 203d 206c 656e 2870 6f69 6e74 7329   n = len(points)
-0000c490: 0a20 2020 2020 2020 2023 2069 6e64 6578  .        # index
-0000c4a0: 206f 6620 7468 6520 782d 636f 6f72 6469   of the x-coordi
-0000c4b0: 6e61 7465 2028 666f 7220 3264 2070 6c6f  nate (for 2d plo
-0000c4c0: 7473 2920 6f72 2070 6172 616d 6574 6572  ts) or parameter
-0000c4d0: 2028 666f 7220 3264 2f33 640a 2020 2020   (for 2d/3d.    
-0000c4e0: 2020 2020 2320 7061 7261 6d65 7472 6963      # parametric
-0000c4f0: 2070 6c6f 7473 290a 2020 2020 2020 2020   plots).        
-0000c500: 6b20 3d20 6e20 2d20 310a 2020 2020 2020  k = n - 1.      
-0000c510: 2020 6966 206e 203d 3d20 323a 0a20 2020    if n == 2:.   
-0000c520: 2020 2020 2020 2020 206b 203d 2030 0a20           k = 0. 
-0000c530: 2020 2020 2020 2023 2069 6e64 6563 6573         # indeces
-0000c540: 206f 6620 7468 6520 6f74 6865 7220 636f   of the other co
-0000c550: 6f72 6469 6e61 7465 730a 2020 2020 2020  ordinates.      
-0000c560: 2020 6a5f 696e 6465 6365 7320 3d20 736f    j_indeces = so
-0000c570: 7274 6564 2873 6574 2872 616e 6765 286e  rted(set(range(n
-0000c580: 2929 2e64 6966 6665 7265 6e63 6528 5b6b  )).difference([k
-0000c590: 5d29 290a 2020 2020 2020 2020 2320 544f  ])).        # TO
-0000c5a0: 444f 3a20 666f 7220 6e6f 772c 2049 2061  DO: for now, I a
-0000c5b0: 7373 756d 6520 7468 6174 206e 756d 7079  ssume that numpy
-0000c5c0: 2066 756e 6374 696f 6e73 2061 7265 2067   functions are g
-0000c5d0: 6f69 6e67 2074 6f20 7375 6363 6565 640a  oing to succeed.
-0000c5e0: 2020 2020 2020 2020 6675 6e63 7320 3d20          funcs = 
-0000c5f0: 5b66 5b30 5d20 666f 7220 6620 696e 2073  [f[0] for f in s
-0000c600: 656c 662e 5f66 756e 6374 696f 6e73 5d0a  elf._functions].
-0000c610: 0a20 2020 2020 2020 2066 6f72 2065 2069  .        for e i
-0000c620: 6e20 7365 6c66 2e65 7863 6c75 6465 3a0a  n self.exclude:.
-0000c630: 2020 2020 2020 2020 2020 2020 7265 7320              res 
-0000c640: 3d20 706f 696e 7473 5b6b 5d20 2d20 6520  = points[k] - e 
-0000c650: 3e3d 2030 0a20 2020 2020 2020 2020 2020  >= 0.           
-0000c660: 2023 2069 6620 7265 7320 636f 6e74 6169   # if res contai
-0000c670: 6e73 2062 6f74 6820 5472 7565 2061 6e64  ns both True and
-0000c680: 2046 616c 7365 2c20 6965 2c20 6966 2065   False, ie, if e
-0000c690: 2069 7320 666f 756e 640a 2020 2020 2020   is found.      
-0000c6a0: 2020 2020 2020 6966 2061 6e79 2872 6573        if any(res
-0000c6b0: 2920 616e 6420 616e 7928 7e72 6573 293a  ) and any(~res):
-0000c6c0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0000c6d0: 2069 6478 203d 206e 702e 6e61 6e61 7267   idx = np.nanarg
-0000c6e0: 6d61 7828 7265 7329 0a20 2020 2020 2020  max(res).       
-0000c6f0: 2020 2020 2020 2020 2023 2073 656c 6563           # selec
-0000c700: 7420 7468 6520 7072 6576 696f 7573 2070  t the previous p
-0000c710: 6f69 6e74 2077 6974 6820 7265 7370 6563  oint with respec
-0000c720: 7420 746f 2065 0a20 2020 2020 2020 2020  t to e.         
-0000c730: 2020 2020 2020 2069 6478 202d 3d20 310a         idx -= 1.
-0000c740: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000c750: 2320 544f 444f 3a20 7768 6174 2069 6620  # TODO: what if 
-0000c760: 706f 696e 7473 5b6b 5d5b 6964 785d 3d3d  points[k][idx]==
-0000c770: 6520 6f72 2070 6f69 6e74 735b 6b5d 5b69  e or points[k][i
-0000c780: 6478 2b31 5d3d 3d65 3f0a 0a20 2020 2020  dx+1]==e?..     
-0000c790: 2020 2020 2020 2020 2020 2069 6620 6964             if id
-0000c7a0: 7820 3e20 3020 616e 6420 6964 7820 3c20  x > 0 and idx < 
-0000c7b0: 6c65 6e28 706f 696e 7473 5b6b 5d29 202d  len(points[k]) -
-0000c7c0: 2031 3a0a 2020 2020 2020 2020 2020 2020   1:.            
-0000c7d0: 2020 2020 2020 2020 6465 6c74 615f 7072          delta_pr
-0000c7e0: 6576 203d 2061 6273 2865 202d 2070 6f69  ev = abs(e - poi
-0000c7f0: 6e74 735b 6b5d 5b69 6478 5d29 0a20 2020  nts[k][idx]).   
-0000c800: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000c810: 2064 656c 7461 5f70 6f73 7420 3d20 6162   delta_post = ab
-0000c820: 7328 6520 2d20 706f 696e 7473 5b6b 5d5b  s(e - points[k][
-0000c830: 6964 7820 2b20 315d 290a 2020 2020 2020  idx + 1]).      
-0000c840: 2020 2020 2020 2020 2020 2020 2020 6465                de
-0000c850: 6c74 6120 3d20 6d69 6e28 6465 6c74 615f  lta = min(delta_
-0000c860: 7072 6576 2c20 6465 6c74 615f 706f 7374  prev, delta_post
-0000c870: 2920 2f20 3130 300a 2020 2020 2020 2020  ) / 100.        
-0000c880: 2020 2020 2020 2020 2020 2020 7072 6576              prev
-0000c890: 203d 2065 202d 2064 656c 7461 0a20 2020   = e - delta.   
-0000c8a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000c8b0: 2070 6f73 7420 3d20 6520 2b20 6465 6c74   post = e + delt
-0000c8c0: 610a 0a20 2020 2020 2020 2020 2020 2020  a..             
-0000c8d0: 2020 2020 2020 2023 2061 6464 2070 6f69         # add poi
-0000c8e0: 6e74 7320 746f 2074 6865 2078 2d63 6f6f  nts to the x-coo
-0000c8f0: 7264 206f 7220 7468 6520 7061 7261 6d65  rd or the parame
-0000c900: 7465 720a 2020 2020 2020 2020 2020 2020  ter.            
-0000c910: 2020 2020 2020 2020 706f 696e 7473 5b6b          points[k
-0000c920: 5d20 3d20 6e70 2e63 6f6e 6361 7465 6e61  ] = np.concatena
-0000c930: 7465 280a 2020 2020 2020 2020 2020 2020  te(.            
-0000c940: 2020 2020 2020 2020 2020 2020 2870 6f69              (poi
-0000c950: 6e74 735b 6b5d 5b3a 6964 785d 2c20 5b70  nts[k][:idx], [p
-0000c960: 7265 762c 2065 2c20 706f 7374 5d2c 2070  rev, e, post], p
-0000c970: 6f69 6e74 735b 6b5d 5b69 6478 2b31 3a5d  oints[k][idx+1:]
-0000c980: 2929 0a0a 2020 2020 2020 2020 2020 2020  ))..            
-0000c990: 2020 2020 2020 2020 2320 6164 6420 706f          # add po
-0000c9a0: 696e 7473 2074 6f20 7468 6520 6f74 6865  ints to the othe
-0000c9b0: 7220 636f 6f72 6469 6e61 7465 730a 2020  r coordinates.  
-0000c9c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000c9d0: 2020 6320 3d20 300a 2020 2020 2020 2020    c = 0.        
-0000c9e0: 2020 2020 2020 2020 2020 2020 666f 7220              for 
-0000c9f0: 6a20 696e 206a 5f69 6e64 6563 6573 3a0a  j in j_indeces:.
-0000ca00: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000ca10: 2020 2020 2020 2020 7661 6c75 6573 203d          values =
-0000ca20: 2066 756e 6373 5b63 5d28 6e70 2e61 7272   funcs[c](np.arr
-0000ca30: 6179 285b 7072 6576 2c20 706f 7374 5d29  ay([prev, post])
-0000ca40: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
-0000ca50: 2020 2020 2020 2020 2020 6320 2b3d 2031            c += 1
-0000ca60: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0000ca70: 2020 2020 2020 2020 2070 6f69 6e74 735b           points[
-0000ca80: 6a5d 203d 206e 702e 636f 6e63 6174 656e  j] = np.concaten
-0000ca90: 6174 6528 0a20 2020 2020 2020 2020 2020  ate(.           
-0000caa0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000cab0: 2028 706f 696e 7473 5b6a 5d5b 3a69 6478   (points[j][:idx
-0000cac0: 5d2c 205b 7661 6c75 6573 5b30 5d2c 206e  ], [values[0], n
-0000cad0: 702e 6e61 6e2c 2076 616c 7565 735b 315d  p.nan, values[1]
-0000cae0: 5d2c 2070 6f69 6e74 735b 6a5d 5b69 6478  ], points[j][idx
-0000caf0: 2b31 3a5d 2929 0a20 2020 2020 2020 2072  +1:])).        r
-0000cb00: 6574 7572 6e20 706f 696e 7473 0a0a 2020  eturn points..  
-0000cb10: 2020 4070 726f 7065 7274 790a 2020 2020    @property.    
-0000cb20: 6465 6620 7661 7228 7365 6c66 293a 0a20  def var(self):. 
-0000cb30: 2020 2020 2020 2072 6574 7572 6e20 4e6f         return No
-0000cb40: 6e65 2069 6620 6e6f 7420 7365 6c66 2e72  ne if not self.r
-0000cb50: 616e 6765 7320 656c 7365 2073 656c 662e  anges else self.
-0000cb60: 7261 6e67 6573 5b30 5d5b 305d 0a0a 2020  ranges[0][0]..  
-0000cb70: 2020 4070 726f 7065 7274 790a 2020 2020    @property.    
-0000cb80: 6465 6620 7374 6172 7428 7365 6c66 293a  def start(self):
-0000cb90: 0a20 2020 2020 2020 2069 6620 6e6f 7420  .        if not 
-0000cba0: 7365 6c66 2e72 616e 6765 733a 0a20 2020  self.ranges:.   
-0000cbb0: 2020 2020 2020 2020 2072 6574 7572 6e20           return 
-0000cbc0: 4e6f 6e65 0a20 2020 2020 2020 2074 7279  None.        try
-0000cbd0: 3a0a 2020 2020 2020 2020 2020 2020 7265  :.            re
-0000cbe0: 7475 726e 2073 656c 662e 5f63 6173 7428  turn self._cast(
-0000cbf0: 7365 6c66 2e72 616e 6765 735b 305d 5b31  self.ranges[0][1
-0000cc00: 5d29 0a20 2020 2020 2020 2065 7863 6570  ]).        excep
-0000cc10: 7420 4578 6365 7074 696f 6e3a 0a20 2020  t Exception:.   
-0000cc20: 2020 2020 2020 2020 2072 6574 7572 6e20           return 
-0000cc30: 7365 6c66 2e72 616e 6765 735b 305d 5b31  self.ranges[0][1
-0000cc40: 5d0a 0a20 2020 2040 7072 6f70 6572 7479  ]..    @property
-0000cc50: 0a20 2020 2064 6566 2065 6e64 2873 656c  .    def end(sel
-0000cc60: 6629 3a0a 2020 2020 2020 2020 6966 206e  f):.        if n
-0000cc70: 6f74 2073 656c 662e 7261 6e67 6573 3a0a  ot self.ranges:.
-0000cc80: 2020 2020 2020 2020 2020 2020 7265 7475              retu
-0000cc90: 726e 204e 6f6e 650a 2020 2020 2020 2020  rn None.        
-0000cca0: 7472 793a 0a20 2020 2020 2020 2020 2020  try:.           
-0000ccb0: 2072 6574 7572 6e20 7365 6c66 2e5f 6361   return self._ca
-0000ccc0: 7374 2873 656c 662e 7261 6e67 6573 5b30  st(self.ranges[0
-0000ccd0: 5d5b 325d 290a 2020 2020 2020 2020 6578  ][2]).        ex
-0000cce0: 6365 7074 2045 7863 6570 7469 6f6e 3a0a  cept Exception:.
-0000ccf0: 2020 2020 2020 2020 2020 2020 7265 7475              retu
-0000cd00: 726e 2073 656c 662e 7261 6e67 6573 5b30  rn self.ranges[0
-0000cd10: 5d5b 325d 0a0a 2020 2020 4070 726f 7065  ][2]..    @prope
-0000cd20: 7274 790a 2020 2020 6465 6620 6c69 6e65  rty.    def line
-0000cd30: 5f63 6f6c 6f72 2873 656c 6629 3a0a 2020  _color(self):.  
-0000cd40: 2020 2020 2020 7265 7475 726e 2073 656c        return sel
-0000cd50: 662e 5f6c 696e 655f 636f 6c6f 720a 0a20  f._line_color.. 
-0000cd60: 2020 2040 6c69 6e65 5f63 6f6c 6f72 2e73     @line_color.s
-0000cd70: 6574 7465 720a 2020 2020 6465 6620 6c69  etter.    def li
-0000cd80: 6e65 5f63 6f6c 6f72 2873 656c 662c 2076  ne_color(self, v
-0000cd90: 616c 293a 0a20 2020 2020 2020 2073 656c  al):.        sel
-0000cda0: 662e 5f6c 696e 655f 7375 7266 6163 655f  f._line_surface_
-0000cdb0: 636f 6c6f 7228 225f 6c69 6e65 5f63 6f6c  color("_line_col
-0000cdc0: 6f72 222c 2076 616c 290a 0a0a 636c 6173  or", val)...clas
-0000cdd0: 7320 4c69 7374 3244 5365 7269 6573 284c  s List2DSeries(L
-0000cde0: 696e 6532 4442 6173 6553 6572 6965 7329  ine2DBaseSeries)
-0000cdf0: 3a0a 2020 2020 2222 2252 6570 7265 7365  :.    """Represe
-0000ce00: 6e74 6174 696f 6e20 666f 7220 6120 6c69  ntation for a li
-0000ce10: 6e65 2063 6f6e 7369 7374 696e 6720 6f66  ne consisting of
-0000ce20: 206c 6973 7420 6f66 2070 6f69 6e74 732e   list of points.
-0000ce30: 2222 220a 0a20 2020 2064 6566 205f 5f69  """..    def __i
-0000ce40: 6e69 745f 5f28 7365 6c66 2c20 6c69 7374  nit__(self, list
-0000ce50: 5f78 2c20 6c69 7374 5f79 2c20 6c61 6265  _x, list_y, labe
-0000ce60: 6c3d 2222 2c20 2a2a 6b77 6172 6773 293a  l="", **kwargs):
-0000ce70: 0a20 2020 2020 2020 2073 7570 6572 2829  .        super()
-0000ce80: 2e5f 5f69 6e69 745f 5f28 6c61 6265 6c3d  .__init__(label=
-0000ce90: 6c61 6265 6c2c 202a 2a6b 7761 7267 7329  label, **kwargs)
-0000cea0: 0a20 2020 2020 2020 206e 7020 3d20 696d  .        np = im
-0000ceb0: 706f 7274 5f6d 6f64 756c 6528 276e 756d  port_module('num
-0000cec0: 7079 2729 0a20 2020 2020 2020 2069 6620  py').        if 
-0000ced0: 6c65 6e28 6c69 7374 5f78 2920 213d 206c  len(list_x) != l
-0000cee0: 656e 286c 6973 745f 7929 3a0a 2020 2020  en(list_y):.    
-0000cef0: 2020 2020 2020 2020 7261 6973 6520 5661          raise Va
-0000cf00: 6c75 6545 7272 6f72 280a 2020 2020 2020  lueError(.      
-0000cf10: 2020 2020 2020 2020 2020 2254 6865 2074            "The t
-0000cf20: 776f 206c 6973 7473 206f 6620 636f 6f72  wo lists of coor
-0000cf30: 6469 6e61 7465 7320 6d75 7374 2068 6176  dinates must hav
-0000cf40: 6520 7468 6520 7361 6d65 2022 0a20 2020  e the same ".   
-0000cf50: 2020 2020 2020 2020 2020 2020 2022 6e75               "nu
-0000cf60: 6d62 6572 206f 6620 656c 656d 656e 7473  mber of elements
-0000cf70: 2e5c 6e52 6563 6569 7665 643a 206c 656e  .\nReceived: len
-0000cf80: 286c 6973 745f 7829 203d 2025 7320 220a  (list_x) = %s ".
-0000cf90: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000cfa0: 2261 6e64 206c 656e 286c 6973 745f 7929  "and len(list_y)
-0000cfb0: 203d 2025 7322 2025 2028 6c65 6e28 6c69   = %s" % (len(li
-0000cfc0: 7374 5f78 292c 206c 656e 286c 6973 745f  st_x), len(list_
-0000cfd0: 7929 290a 2020 2020 2020 2020 2020 2020  y)).            
-0000cfe0: 290a 2020 2020 2020 2020 7365 6c66 2e5f  ).        self._
-0000cff0: 626c 6f63 6b5f 6c61 6d62 6461 5f66 756e  block_lambda_fun
-0000d000: 6374 696f 6e73 286c 6973 745f 782c 206c  ctions(list_x, l
-0000d010: 6973 745f 7929 0a20 2020 2020 2020 2063  ist_y).        c
-0000d020: 6865 636b 203d 206c 616d 6264 6120 6c3a  heck = lambda l:
-0000d030: 205b 6973 696e 7374 616e 6365 2874 2c20   [isinstance(t, 
-0000d040: 4578 7072 2920 616e 6420 286e 6f74 2074  Expr) and (not t
-0000d050: 2e69 735f 6e75 6d62 6572 2920 666f 7220  .is_number) for 
-0000d060: 7420 696e 206c 5d0a 2020 2020 2020 2020  t in l].        
-0000d070: 6966 2061 6e79 2863 6865 636b 286c 6973  if any(check(lis
-0000d080: 745f 7829 202b 2063 6865 636b 286c 6973  t_x) + check(lis
-0000d090: 745f 7929 2920 6f72 2073 656c 662e 7061  t_y)) or self.pa
-0000d0a0: 7261 6d73 3a0a 2020 2020 2020 2020 2020  rams:.          
-0000d0b0: 2020 6966 206e 6f74 2073 656c 662e 7061    if not self.pa
-0000d0c0: 7261 6d73 3a0a 2020 2020 2020 2020 2020  rams:.          
-0000d0d0: 2020 2020 2020 7261 6973 6520 5661 6c75        raise Valu
-0000d0e0: 6545 7272 6f72 280a 2020 2020 2020 2020  eError(.        
-0000d0f0: 2020 2020 2020 2020 2020 2020 2253 6f6d              "Som
-0000d100: 6520 6f72 2061 6c6c 2065 6c65 6d65 6e74  e or all element
-0000d110: 7320 6f66 2074 6865 2070 726f 7669 6465  s of the provide
-0000d120: 6420 6c69 7374 7320 220a 2020 2020 2020  d lists ".      
-0000d130: 2020 2020 2020 2020 2020 2020 2020 2261                "a
-0000d140: 7265 2073 796d 626f 6c69 6320 6578 7072  re symbolic expr
-0000d150: 6573 7369 6f6e 732c 2062 7574 2074 6865  essions, but the
-0000d160: 2060 6070 6172 616d 7360 6020 6469 6374   ``params`` dict
-0000d170: 696f 6e61 7279 2022 0a20 2020 2020 2020  ionary ".       
-0000d180: 2020 2020 2020 2020 2020 2020 2022 7761               "wa
-0000d190: 7320 6e6f 7420 7072 6f76 6964 6564 3a20  s not provided: 
-0000d1a0: 7468 6f73 6520 656c 656d 656e 7473 2063  those elements c
-0000d1b0: 616e 2774 2062 6520 6576 616c 7561 7465  an't be evaluate
-0000d1c0: 642e 2229 0a20 2020 2020 2020 2020 2020  d.").           
-0000d1d0: 2073 656c 662e 6c69 7374 5f78 203d 2054   self.list_x = T
-0000d1e0: 7570 6c65 282a 6c69 7374 5f78 290a 2020  uple(*list_x).  
-0000d1f0: 2020 2020 2020 2020 2020 7365 6c66 2e6c            self.l
-0000d200: 6973 745f 7920 3d20 5475 706c 6528 2a6c  ist_y = Tuple(*l
-0000d210: 6973 745f 7929 0a20 2020 2020 2020 2065  ist_y).        e
-0000d220: 6c73 653a 0a20 2020 2020 2020 2020 2020  lse:.           
-0000d230: 2073 656c 662e 6c69 7374 5f78 203d 206e   self.list_x = n
-0000d240: 702e 6172 7261 7928 6c69 7374 5f78 2c20  p.array(list_x, 
-0000d250: 6474 7970 653d 6e70 2e66 6c6f 6174 3634  dtype=np.float64
-0000d260: 290a 2020 2020 2020 2020 2020 2020 7365  ).            se
-0000d270: 6c66 2e6c 6973 745f 7920 3d20 6e70 2e61  lf.list_y = np.a
-0000d280: 7272 6179 286c 6973 745f 792c 2064 7479  rray(list_y, dty
-0000d290: 7065 3d6e 702e 666c 6f61 7436 3429 0a0a  pe=np.float64)..
-0000d2a0: 2020 2020 2020 2020 7365 6c66 2e5f 6578          self._ex
-0000d2b0: 7072 203d 2028 7365 6c66 2e6c 6973 745f  pr = (self.list_
-0000d2c0: 782c 2073 656c 662e 6c69 7374 5f79 290a  x, self.list_y).
-0000d2d0: 2020 2020 2020 2020 6966 206e 6f74 2061          if not a
-0000d2e0: 6e79 2869 7369 6e73 7461 6e63 6528 742c  ny(isinstance(t,
-0000d2f0: 206e 702e 6e64 6172 7261 7929 2066 6f72   np.ndarray) for
-0000d300: 2074 2069 6e20 5b73 656c 662e 6c69 7374   t in [self.list
-0000d310: 5f78 2c20 7365 6c66 2e6c 6973 745f 795d  _x, self.list_y]
-0000d320: 293a 0a20 2020 2020 2020 2020 2020 2073  ):.            s
-0000d330: 656c 662e 5f63 6865 636b 5f66 7328 290a  elf._check_fs().
-0000d340: 0a20 2020 2020 2020 2069 6620 7365 6c66  .        if self
-0000d350: 2e75 7365 5f63 6d20 616e 6420 7365 6c66  .use_cm and self
-0000d360: 2e63 6f6c 6f72 5f66 756e 633a 0a20 2020  .color_func:.   
-0000d370: 2020 2020 2020 2020 2073 656c 662e 6973           self.is
-0000d380: 5f70 6172 616d 6574 7269 6320 3d20 5472  _parametric = Tr
-0000d390: 7565 0a20 2020 2020 2020 2020 2020 2069  ue.            i
-0000d3a0: 6620 6973 696e 7374 616e 6365 2873 656c  f isinstance(sel
-0000d3b0: 662e 636f 6c6f 725f 6675 6e63 2c20 4578  f.color_func, Ex
-0000d3c0: 7072 293a 0a20 2020 2020 2020 2020 2020  pr):.           
-0000d3d0: 2020 2020 2072 6169 7365 2054 7970 6545       raise TypeE
-0000d3e0: 7272 6f72 280a 2020 2020 2020 2020 2020  rror(.          
-0000d3f0: 2020 2020 2020 2020 2020 2225 7320 646f            "%s do
-0000d400: 6e27 7420 7375 7070 6f72 7420 7379 6d62  n't support symb
-0000d410: 6f6c 6963 2022 2025 2073 656c 662e 5f5f  olic " % self.__
-0000d420: 636c 6173 735f 5f2e 5f5f 6e61 6d65 5f5f  class__.__name__
-0000d430: 202b 0a20 2020 2020 2020 2020 2020 2020   +.             
-0000d440: 2020 2020 2020 2022 6578 7072 6573 7369         "expressi
-0000d450: 6f6e 2066 6f72 2060 636f 6c6f 725f 6675  on for `color_fu
-0000d460: 6e63 602e 2229 0a0a 2020 2020 6465 6620  nc`.")..    def 
-0000d470: 5f5f 7374 725f 5f28 7365 6c66 293a 0a20  __str__(self):. 
-0000d480: 2020 2020 2020 2070 7265 203d 2022 3244         pre = "2D
-0000d490: 2220 6966 2073 656c 662e 6973 5f32 446c  " if self.is_2Dl
-0000d4a0: 696e 6520 656c 7365 2022 3344 220a 2020  ine else "3D".  
-0000d4b0: 2020 2020 2020 7265 7475 726e 2070 7265        return pre
-0000d4c0: 202b 2022 206c 6973 7420 706c 6f74 220a   + " list plot".
-0000d4d0: 0a20 2020 2064 6566 205f 6765 745f 6461  .    def _get_da
-0000d4e0: 7461 5f68 656c 7065 7228 7365 6c66 293a  ta_helper(self):
-0000d4f0: 0a20 2020 2020 2020 2022 2222 5265 7475  .        """Retu
-0000d500: 726e 7320 636f 6f72 6469 6e61 7465 7320  rns coordinates 
-0000d510: 7468 6174 206e 6565 6473 2074 6f20 6265  that needs to be
-0000d520: 2070 6f73 7470 726f 6365 7373 6564 2e22   postprocessed."
-0000d530: 2222 0a20 2020 2020 2020 206c 782c 206c  "".        lx, l
-0000d540: 7920 3d20 7365 6c66 2e6c 6973 745f 782c  y = self.list_x,
-0000d550: 2073 656c 662e 6c69 7374 5f79 0a0a 2020   self.list_y..  
-0000d560: 2020 2020 2020 6966 206e 6f74 2073 656c        if not sel
-0000d570: 662e 6973 5f69 6e74 6572 6163 7469 7665  f.is_interactive
-0000d580: 3a0a 2020 2020 2020 2020 2020 2020 7265  :.            re
-0000d590: 7475 726e 2073 656c 662e 5f65 7661 6c5f  turn self._eval_
-0000d5a0: 636f 6c6f 725f 6675 6e63 5f61 6e64 5f72  color_func_and_r
-0000d5b0: 6574 7572 6e28 6c78 2c20 6c79 290a 0a20  eturn(lx, ly).. 
-0000d5c0: 2020 2020 2020 206e 7020 3d20 696d 706f         np = impo
-0000d5d0: 7274 5f6d 6f64 756c 6528 276e 756d 7079  rt_module('numpy
-0000d5e0: 2729 0a20 2020 2020 2020 206c 7820 3d20  ').        lx = 
-0000d5f0: 6e70 2e61 7272 6179 285b 742e 6576 616c  np.array([t.eval
-0000d600: 6628 7375 6273 3d73 656c 662e 7061 7261  f(subs=self.para
-0000d610: 6d73 2920 666f 7220 7420 696e 206c 785d  ms) for t in lx]
-0000d620: 2c20 6474 7970 653d 666c 6f61 7429 0a20  , dtype=float). 
-0000d630: 2020 2020 2020 206c 7920 3d20 6e70 2e61         ly = np.a
-0000d640: 7272 6179 285b 742e 6576 616c 6628 7375  rray([t.evalf(su
-0000d650: 6273 3d73 656c 662e 7061 7261 6d73 2920  bs=self.params) 
-0000d660: 666f 7220 7420 696e 206c 795d 2c20 6474  for t in ly], dt
-0000d670: 7970 653d 666c 6f61 7429 0a20 2020 2020  ype=float).     
-0000d680: 2020 2072 6574 7572 6e20 7365 6c66 2e5f     return self._
-0000d690: 6576 616c 5f63 6f6c 6f72 5f66 756e 635f  eval_color_func_
-0000d6a0: 616e 645f 7265 7475 726e 286c 782c 206c  and_return(lx, l
-0000d6b0: 7929 0a0a 2020 2020 6465 6620 5f65 7661  y)..    def _eva
-0000d6c0: 6c5f 636f 6c6f 725f 6675 6e63 5f61 6e64  l_color_func_and
-0000d6d0: 5f72 6574 7572 6e28 7365 6c66 2c20 2a64  _return(self, *d
-0000d6e0: 6174 6129 3a0a 2020 2020 2020 2020 6966  ata):.        if
-0000d6f0: 2073 656c 662e 7573 655f 636d 2061 6e64   self.use_cm and
-0000d700: 2063 616c 6c61 626c 6528 7365 6c66 2e63   callable(self.c
-0000d710: 6f6c 6f72 5f66 756e 6329 3a0a 2020 2020  olor_func):.    
-0000d720: 2020 2020 2020 2020 7265 7475 726e 205b          return [
-0000d730: 2a64 6174 612c 2073 656c 662e 6576 616c  *data, self.eval
-0000d740: 5f63 6f6c 6f72 5f66 756e 6328 2a64 6174  _color_func(*dat
-0000d750: 6129 5d0a 2020 2020 2020 2020 7265 7475  a)].        retu
-0000d760: 726e 2064 6174 610a 0a0a 636c 6173 7320  rn data...class 
-0000d770: 4c69 7374 3344 5365 7269 6573 284c 6973  List3DSeries(Lis
-0000d780: 7432 4453 6572 6965 7329 3a0a 2020 2020  t2DSeries):.    
-0000d790: 6973 5f32 446c 696e 6520 3d20 4661 6c73  is_2Dline = Fals
-0000d7a0: 650a 2020 2020 6973 5f33 446c 696e 6520  e.    is_3Dline 
-0000d7b0: 3d20 5472 7565 0a0a 2020 2020 6465 6620  = True..    def 
-0000d7c0: 5f5f 696e 6974 5f5f 2873 656c 662c 206c  __init__(self, l
-0000d7d0: 6973 745f 782c 206c 6973 745f 792c 206c  ist_x, list_y, l
-0000d7e0: 6973 745f 7a2c 206c 6162 656c 3d22 222c  ist_z, label="",
-0000d7f0: 202a 2a6b 7761 7267 7329 3a0a 2020 2020   **kwargs):.    
-0000d800: 2020 2020 2320 544f 444f 3a20 7468 6973      # TODO: this
-0000d810: 2063 616e 2064 6566 696e 6974 656c 7920   can definitely 
-0000d820: 6265 2064 6f6e 6520 6265 7474 6572 0a20  be done better. 
-0000d830: 2020 2020 2020 2073 7570 6572 2829 2e5f         super()._
-0000d840: 5f69 6e69 745f 5f28 6c69 7374 5f78 2c20  _init__(list_x, 
-0000d850: 6c69 7374 5f79 2c20 6c61 6265 6c2c 202a  list_y, label, *
-0000d860: 2a6b 7761 7267 7329 0a20 2020 2020 2020  *kwargs).       
-0000d870: 206e 7020 3d20 696d 706f 7274 5f6d 6f64   np = import_mod
-0000d880: 756c 6528 276e 756d 7079 2729 0a20 2020  ule('numpy').   
-0000d890: 2020 2020 2069 6620 6c65 6e28 6c69 7374       if len(list
-0000d8a0: 5f7a 2920 213d 206c 656e 286c 6973 745f  _z) != len(list_
-0000d8b0: 7829 3a0a 2020 2020 2020 2020 2020 2020  x):.            
-0000d8c0: 7261 6973 6520 5661 6c75 6545 7272 6f72  raise ValueError
-0000d8d0: 280a 2020 2020 2020 2020 2020 2020 2020  (.              
-0000d8e0: 2020 2254 6865 2074 6872 6565 206c 6973    "The three lis
-0000d8f0: 7473 206f 6620 636f 6f72 6469 6e61 7465  ts of coordinate
-0000d900: 7320 6d75 7374 2068 6176 6520 7468 6520  s must have the 
-0000d910: 7361 6d65 2022 0a20 2020 2020 2020 2020  same ".         
-0000d920: 2020 2020 2020 2022 6e75 6d62 6572 206f         "number o
-0000d930: 6620 656c 656d 656e 7473 2e5c 6e22 0a20  f elements.\n". 
-0000d940: 2020 2020 2020 2020 2020 2020 2020 2022                 "
-0000d950: 5265 6365 6976 6564 3a20 6c65 6e28 6c69  Received: len(li
-0000d960: 7374 5f78 2920 3d20 6c65 6e28 6c69 7374  st_x) = len(list
-0000d970: 5f79 2920 3d20 7b7d 2022 2e66 6f72 6d61  _y) = {} ".forma
-0000d980: 7428 6c65 6e28 6c69 7374 5f78 2929 202b  t(len(list_x)) +
-0000d990: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0000d9a0: 2022 616e 6420 6c65 6e28 6c69 7374 5f7a   "and len(list_z
-0000d9b0: 2920 3d20 7b7d 222e 666f 726d 6174 286c  ) = {}".format(l
-0000d9c0: 656e 286c 6973 745f 7a29 290a 2020 2020  en(list_z)).    
-0000d9d0: 2020 2020 2020 2020 290a 2020 2020 2020          ).      
-0000d9e0: 2020 7365 6c66 2e5f 626c 6f63 6b5f 6c61    self._block_la
-0000d9f0: 6d62 6461 5f66 756e 6374 696f 6e73 286c  mbda_functions(l
-0000da00: 6973 745f 7a29 0a20 2020 2020 2020 2063  ist_z).        c
-0000da10: 6865 636b 203d 206c 616d 6264 6120 6c3a  heck = lambda l:
-0000da20: 205b 6973 696e 7374 616e 6365 2874 2c20   [isinstance(t, 
-0000da30: 4578 7072 2920 616e 6420 286e 6f74 2074  Expr) and (not t
-0000da40: 2e69 735f 6e75 6d62 6572 2920 666f 7220  .is_number) for 
-0000da50: 7420 696e 206c 5d0a 2020 2020 2020 2020  t in l].        
-0000da60: 6966 2061 6e79 2863 6865 636b 286c 6973  if any(check(lis
-0000da70: 745f 7a29 293a 0a20 2020 2020 2020 2020  t_z)):.         
-0000da80: 2020 2069 6620 6e6f 7420 7365 6c66 2e70     if not self.p
-0000da90: 6172 616d 733a 0a20 2020 2020 2020 2020  arams:.         
-0000daa0: 2020 2020 2020 2072 6169 7365 2056 616c         raise Val
-0000dab0: 7565 4572 726f 7228 0a20 2020 2020 2020  ueError(.       
-0000dac0: 2020 2020 2020 2020 2020 2020 2022 536f               "So
-0000dad0: 6d65 206f 7220 616c 6c20 656c 656d 656e  me or all elemen
-0000dae0: 7473 206f 6620 7468 6520 7072 6f76 6964  ts of the provid
-0000daf0: 6564 206c 6973 7473 2022 0a20 2020 2020  ed lists ".     
-0000db00: 2020 2020 2020 2020 2020 2020 2020 2022                 "
-0000db10: 6172 6520 7379 6d62 6f6c 6963 2065 7870  are symbolic exp
-0000db20: 7265 7373 696f 6e73 2c20 6275 7420 7468  ressions, but th
-0000db30: 6520 6060 7061 7261 6d73 6060 2064 6963  e ``params`` dic
-0000db40: 7469 6f6e 6172 7920 220a 2020 2020 2020  tionary ".      
-0000db50: 2020 2020 2020 2020 2020 2020 2020 2277                "w
-0000db60: 6173 206e 6f74 2070 726f 7669 6465 643a  as not provided:
-0000db70: 2074 686f 7365 2065 6c65 6d65 6e74 7320   those elements 
-0000db80: 6361 6e27 7420 6265 2065 7661 6c75 6174  can't be evaluat
-0000db90: 6564 2e22 290a 2020 2020 2020 2020 2020  ed.").          
-0000dba0: 2020 7365 6c66 2e6c 6973 745f 7a20 3d20    self.list_z = 
-0000dbb0: 5475 706c 6528 2a6c 6973 745f 7a29 0a20  Tuple(*list_z). 
-0000dbc0: 2020 2020 2020 2020 2020 2073 656c 662e             self.
-0000dbd0: 5f63 6865 636b 5f66 7328 290a 2020 2020  _check_fs().    
-0000dbe0: 2020 2020 656c 7365 3a0a 2020 2020 2020      else:.      
-0000dbf0: 2020 2020 2020 7365 6c66 2e6c 6973 745f        self.list_
-0000dc00: 7a20 3d20 6e70 2e61 7272 6179 286c 6973  z = np.array(lis
-0000dc10: 745f 7a2c 2064 7479 7065 3d6e 702e 666c  t_z, dtype=np.fl
-0000dc20: 6f61 7436 3429 0a0a 2020 2020 2020 2020  oat64)..        
-0000dc30: 7365 6c66 2e5f 6578 7072 203d 2028 7365  self._expr = (se
-0000dc40: 6c66 2e6c 6973 745f 782c 2073 656c 662e  lf.list_x, self.
-0000dc50: 6c69 7374 5f79 2c20 7365 6c66 2e6c 6973  list_y, self.lis
-0000dc60: 745f 7a29 0a0a 2020 2020 6465 6620 5f67  t_z)..    def _g
-0000dc70: 6574 5f64 6174 615f 6865 6c70 6572 2873  et_data_helper(s
-0000dc80: 656c 6629 3a0a 2020 2020 2020 2020 2222  elf):.        ""
-0000dc90: 2252 6574 7572 6e73 2063 6f6f 7264 696e  "Returns coordin
-0000dca0: 6174 6573 2074 6861 7420 6e65 6564 7320  ates that needs 
-0000dcb0: 746f 2062 6520 706f 7374 7072 6f63 6573  to be postproces
-0000dcc0: 7365 642e 2222 220a 2020 2020 2020 2020  sed.""".        
-0000dcd0: 6c78 2c20 6c79 2c20 6c7a 203d 2073 656c  lx, ly, lz = sel
-0000dce0: 662e 6c69 7374 5f78 2c20 7365 6c66 2e6c  f.list_x, self.l
-0000dcf0: 6973 745f 792c 2073 656c 662e 6c69 7374  ist_y, self.list
-0000dd00: 5f7a 0a0a 2020 2020 2020 2020 6966 206e  _z..        if n
-0000dd10: 6f74 2073 656c 662e 6973 5f69 6e74 6572  ot self.is_inter
-0000dd20: 6163 7469 7665 3a0a 2020 2020 2020 2020  active:.        
-0000dd30: 2020 2020 7265 7475 726e 2073 656c 662e      return self.
-0000dd40: 5f65 7661 6c5f 636f 6c6f 725f 6675 6e63  _eval_color_func
-0000dd50: 5f61 6e64 5f72 6574 7572 6e28 6c78 2c20  _and_return(lx, 
-0000dd60: 6c79 2c20 6c7a 290a 0a20 2020 2020 2020  ly, lz)..       
-0000dd70: 206e 7020 3d20 696d 706f 7274 5f6d 6f64   np = import_mod
-0000dd80: 756c 6528 276e 756d 7079 2729 0a20 2020  ule('numpy').   
-0000dd90: 2020 2020 206c 7820 3d20 6e70 2e61 7272       lx = np.arr
-0000dda0: 6179 285b 742e 6576 616c 6628 7375 6273  ay([t.evalf(subs
-0000ddb0: 3d73 656c 662e 7061 7261 6d73 2920 666f  =self.params) fo
-0000ddc0: 7220 7420 696e 206c 785d 2c20 6474 7970  r t in lx], dtyp
-0000ddd0: 653d 666c 6f61 7429 0a20 2020 2020 2020  e=float).       
-0000dde0: 206c 7920 3d20 6e70 2e61 7272 6179 285b   ly = np.array([
-0000ddf0: 742e 6576 616c 6628 7375 6273 3d73 656c  t.evalf(subs=sel
-0000de00: 662e 7061 7261 6d73 2920 666f 7220 7420  f.params) for t 
-0000de10: 696e 206c 795d 2c20 6474 7970 653d 666c  in ly], dtype=fl
-0000de20: 6f61 7429 0a20 2020 2020 2020 206c 7a20  oat).        lz 
-0000de30: 3d20 6e70 2e61 7272 6179 285b 742e 6576  = np.array([t.ev
-0000de40: 616c 6628 7375 6273 3d73 656c 662e 7061  alf(subs=self.pa
-0000de50: 7261 6d73 2920 666f 7220 7420 696e 206c  rams) for t in l
-0000de60: 7a5d 2c20 6474 7970 653d 666c 6f61 7429  z], dtype=float)
-0000de70: 0a20 2020 2020 2020 2072 6574 7572 6e20  .        return 
-0000de80: 7365 6c66 2e5f 6576 616c 5f63 6f6c 6f72  self._eval_color
-0000de90: 5f66 756e 635f 616e 645f 7265 7475 726e  _func_and_return
-0000dea0: 286c 782c 206c 792c 206c 7a29 0a0a 0a63  (lx, ly, lz)...c
-0000deb0: 6c61 7373 204c 696e 654f 7665 7231 4452  lass LineOver1DR
-0000dec0: 616e 6765 5365 7269 6573 280a 2020 2020  angeSeries(.    
-0000ded0: 436f 6d6d 6f6e 4164 6170 7469 7665 4576  CommonAdaptiveEv
-0000dee0: 616c 7561 7469 6f6e 2c20 436f 6d6d 6f6e  aluation, Common
-0000def0: 556e 6966 6f72 6d45 7661 6c75 6174 696f  UniformEvaluatio
-0000df00: 6e2c 204c 696e 6532 4442 6173 6553 6572  n, Line2DBaseSer
-0000df10: 6965 730a 293a 0a20 2020 2022 2222 5265  ies.):.    """Re
-0000df20: 7072 6573 656e 7461 7469 6f6e 2066 6f72  presentation for
-0000df30: 2061 206c 696e 6520 636f 6e73 6973 7469   a line consisti
-0000df40: 6e67 206f 6620 6120 5379 6d50 7920 6578  ng of a SymPy ex
-0000df50: 7072 6573 7369 6f6e 206f 7665 7220 610a  pression over a.
-0000df60: 2020 2020 7265 616c 2072 616e 6765 2e22      real range."
-0000df70: 2222 0a0a 2020 2020 5f61 6c6c 6f77 6564  ""..    _allowed
-0000df80: 5f6b 6579 7320 3d20 5b0a 2020 2020 2020  _keys = [.      
-0000df90: 2020 2261 6273 6172 6722 2c20 2269 735f    "absarg", "is_
-0000dfa0: 636f 6d70 6c65 7822 2c20 2269 735f 706f  complex", "is_po
-0000dfb0: 6c61 7222 0a20 2020 205d 0a0a 2020 2020  lar".    ]..    
-0000dfc0: 6465 6620 5f5f 6e65 775f 5f28 636c 732c  def __new__(cls,
-0000dfd0: 202a 6172 6773 2c20 2a2a 6b77 6172 6773   *args, **kwargs
-0000dfe0: 293a 0a20 2020 2020 2020 2069 6620 6b77  ):.        if kw
-0000dff0: 6172 6773 2e67 6574 2822 6162 7361 7267  args.get("absarg
-0000e000: 222c 2046 616c 7365 293a 0a20 2020 2020  ", False):.     
-0000e010: 2020 2020 2020 2072 6574 7572 6e20 7375         return su
-0000e020: 7065 7228 292e 5f5f 6e65 775f 5f28 4162  per().__new__(Ab
-0000e030: 7341 7267 4c69 6e65 5365 7269 6573 290a  sArgLineSeries).
-0000e040: 2020 2020 2020 2020 6366 203d 206b 7761          cf = kwa
-0000e050: 7267 732e 6765 7428 2263 6f6c 6f72 5f66  rgs.get("color_f
-0000e060: 756e 6322 2c20 4e6f 6e65 290a 2020 2020  unc", None).    
-0000e070: 2020 2020 6c63 203d 206b 7761 7267 732e      lc = kwargs.
-0000e080: 6765 7428 226c 696e 655f 636f 6c6f 7222  get("line_color"
-0000e090: 2c20 4e6f 6e65 290a 2020 2020 2020 2020  , None).        
-0000e0a0: 6966 2028 6361 6c6c 6162 6c65 2863 6629  if (callable(cf)
-0000e0b0: 206f 7220 6361 6c6c 6162 6c65 286c 6329   or callable(lc)
-0000e0c0: 206f 7220 6973 696e 7374 616e 6365 2863   or isinstance(c
-0000e0d0: 662c 2045 7870 7229 293a 0a20 2020 2020  f, Expr)):.     
-0000e0e0: 2020 2020 2020 2072 6574 7572 6e20 7375         return su
-0000e0f0: 7065 7228 292e 5f5f 6e65 775f 5f28 436f  per().__new__(Co
-0000e100: 6c6f 7265 644c 696e 654f 7665 7231 4452  loredLineOver1DR
-0000e110: 616e 6765 5365 7269 6573 290a 2020 2020  angeSeries).    
-0000e120: 2020 2020 7265 7475 726e 206f 626a 6563      return objec
-0000e130: 742e 5f5f 6e65 775f 5f28 636c 7329 0a0a  t.__new__(cls)..
-0000e140: 2020 2020 6465 6620 5f5f 696e 6974 5f5f      def __init__
-0000e150: 2873 656c 662c 2065 7870 722c 2076 6172  (self, expr, var
-0000e160: 5f73 7461 7274 5f65 6e64 2c20 6c61 6265  _start_end, labe
-0000e170: 6c3d 2222 2c20 2a2a 6b77 6172 6773 293a  l="", **kwargs):
-0000e180: 0a20 2020 2020 2020 2073 7570 6572 2829  .        super()
-0000e190: 2e5f 5f69 6e69 745f 5f28 2a2a 6b77 6172  .__init__(**kwar
-0000e1a0: 6773 290a 2020 2020 2020 2020 7365 6c66  gs).        self
-0000e1b0: 2e65 7870 7220 3d20 6578 7072 2069 6620  .expr = expr if 
-0000e1c0: 6361 6c6c 6162 6c65 2865 7870 7229 2065  callable(expr) e
-0000e1d0: 6c73 6520 7379 6d70 6966 7928 6578 7072  lse sympify(expr
-0000e1e0: 290a 2020 2020 2020 2020 7365 6c66 2e5f  ).        self._
-0000e1f0: 6c61 6265 6c20 3d20 7374 7228 7365 6c66  label = str(self
-0000e200: 2e65 7870 7229 2069 6620 6c61 6265 6c20  .expr) if label 
-0000e210: 6973 204e 6f6e 6520 656c 7365 206c 6162  is None else lab
-0000e220: 656c 0a20 2020 2020 2020 2073 656c 662e  el.        self.
-0000e230: 5f6c 6174 6578 5f6c 6162 656c 203d 206c  _latex_label = l
-0000e240: 6174 6578 2873 656c 662e 6578 7072 2920  atex(self.expr) 
-0000e250: 6966 206c 6162 656c 2069 7320 4e6f 6e65  if label is None
-0000e260: 2065 6c73 6520 6c61 6265 6c0a 2020 2020   else label.    
-0000e270: 2020 2020 7365 6c66 2e72 616e 6765 7320      self.ranges 
-0000e280: 3d20 5b76 6172 5f73 7461 7274 5f65 6e64  = [var_start_end
-0000e290: 5d0a 2020 2020 2020 2020 2320 7468 6973  ].        # this
-0000e2a0: 2069 7320 7573 6564 2074 6f20 6361 7374   is used to cast
-0000e2b0: 2074 6865 2076 616c 7565 7320 6f66 2072   the values of r
-0000e2c0: 616e 6765 7320 7768 656e 2073 656c 662e  anges when self.
-0000e2d0: 7374 6172 742f 7365 6c66 2e65 6e64 0a20  start/self.end. 
-0000e2e0: 2020 2020 2020 2023 2061 7265 2063 616c         # are cal
-0000e2f0: 6c65 642e 2055 7365 6420 666f 7220 6261  led. Used for ba
-0000e300: 636b 2d63 6f6d 7061 7469 6269 6c69 7479  ck-compatibility
-0000e310: 2077 6974 6820 6f6c 6420 7379 6d70 792e   with old sympy.
-0000e320: 706c 6f74 7469 6e67 2c0a 2020 2020 2020  plotting,.      
-0000e330: 2020 2320 6974 2069 7320 6e6f 7720 6469    # it is now di
-0000e340: 6666 6963 756c 7420 746f 2072 656d 6f76  fficult to remov
-0000e350: 652e 0a20 2020 2020 2020 2073 656c 662e  e..        self.
-0000e360: 5f63 6173 7420 3d20 636f 6d70 6c65 780a  _cast = complex.
-0000e370: 2020 2020 2020 2020 2320 666f 7220 636f          # for co
-0000e380: 6d70 6c65 782d 7265 6c61 7465 6420 6461  mplex-related da
-0000e390: 7461 2073 6572 6965 732c 2074 6869 7320  ta series, this 
-0000e3a0: 6465 7465 726d 696e 6573 2077 6861 7420  determines what 
-0000e3b0: 6461 7461 2074 6f20 7265 7475 726e 0a20  data to return. 
-0000e3c0: 2020 2020 2020 2023 206f 6e20 7468 6520         # on the 
-0000e3d0: 792d 6178 6973 0a20 2020 2020 2020 2073  y-axis.        s
-0000e3e0: 656c 662e 5f72 6574 7572 6e20 3d20 6b77  elf._return = kw
-0000e3f0: 6172 6773 2e67 6574 2822 7265 7475 726e  args.get("return
-0000e400: 222c 204e 6f6e 6529 0a20 2020 2020 2020  ", None).       
-0000e410: 2073 656c 662e 5f70 6f73 745f 696e 6974   self._post_init
-0000e420: 2829 0a0a 2020 2020 2020 2020 6966 206e  ()..        if n
-0000e430: 6f74 2073 656c 662e 5f69 6e74 6572 6163  ot self._interac
-0000e440: 7469 7665 5f72 616e 6765 733a 0a20 2020  tive_ranges:.   
-0000e450: 2020 2020 2020 2020 2023 204e 4f54 453a           # NOTE:
-0000e460: 2074 6865 2066 6f6c 6c6f 7769 6e67 2063   the following c
-0000e470: 6865 636b 2069 7320 6f6e 6c79 2070 6f73  heck is only pos
-0000e480: 7369 626c 6520 7768 656e 2074 6865 206d  sible when the m
-0000e490: 696e 696d 756d 2061 6e64 0a20 2020 2020  inimum and.     
-0000e4a0: 2020 2020 2020 2023 206d 6178 696d 756d         # maximum
-0000e4b0: 2076 616c 7565 7320 6f66 2061 2070 6c6f   values of a plo
-0000e4c0: 7474 696e 6720 7261 6e67 6520 6172 6520  tting range are 
-0000e4d0: 6e75 6d65 7269 630a 2020 2020 2020 2020  numeric.        
-0000e4e0: 2020 2020 7374 6172 742c 2065 6e64 203d      start, end =
-0000e4f0: 205b 636f 6d70 6c65 7828 7429 2066 6f72   [complex(t) for
-0000e500: 2074 2069 6e20 7365 6c66 2e72 616e 6765   t in self.range
-0000e510: 735b 305d 5b31 3a5d 5d0a 2020 2020 2020  s[0][1:]].      
-0000e520: 2020 2020 2020 6966 2069 6d28 7374 6172        if im(star
-0000e530: 7429 2021 3d20 696d 2865 6e64 293a 0a20  t) != im(end):. 
-0000e540: 2020 2020 2020 2020 2020 2020 2020 2072                 r
-0000e550: 6169 7365 2056 616c 7565 4572 726f 7228  aise ValueError(
-0000e560: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0000e570: 2020 2020 2022 2573 2072 6571 7569 7265       "%s require
-0000e580: 7320 7468 6520 696d 6167 696e 6172 7920  s the imaginary 
-0000e590: 2220 2520 7365 6c66 2e5f 5f63 6c61 7373  " % self.__class
-0000e5a0: 5f5f 2e5f 5f6e 616d 655f 5f20 2b0a 2020  __.__name__ +.  
-0000e5b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000e5c0: 2020 2270 6172 7420 6f66 2074 6865 2073    "part of the s
-0000e5d0: 7461 7274 2061 6e64 2065 6e64 2076 616c  tart and end val
-0000e5e0: 7565 7320 6f66 2074 6865 2072 616e 6765  ues of the range
-0000e5f0: 2022 0a20 2020 2020 2020 2020 2020 2020   ".             
-0000e600: 2020 2020 2020 2022 746f 2062 6520 7468         "to be th
-0000e610: 6520 7361 6d65 2e22 290a 0a20 2020 2064  e same.")..    d
-0000e620: 6566 205f 5f73 7472 5f5f 2873 656c 6629  ef __str__(self)
-0000e630: 3a0a 2020 2020 2020 2020 6465 6620 6628  :.        def f(
-0000e640: 7429 3a0a 2020 2020 2020 2020 2020 2020  t):.            
-0000e650: 6966 2069 7369 6e73 7461 6e63 6528 742c  if isinstance(t,
-0000e660: 2063 6f6d 706c 6578 293a 0a20 2020 2020   complex):.     
-0000e670: 2020 2020 2020 2020 2020 2069 6620 742e             if t.
-0000e680: 696d 6167 2021 3d20 303a 0a20 2020 2020  imag != 0:.     
-0000e690: 2020 2020 2020 2020 2020 2020 2020 2072                 r
-0000e6a0: 6574 7572 6e20 740a 2020 2020 2020 2020  eturn t.        
-0000e6b0: 2020 2020 2020 2020 7265 7475 726e 2074          return t
-0000e6c0: 2e72 6561 6c0a 2020 2020 2020 2020 2020  .real.          
-0000e6d0: 2020 7265 7475 726e 2074 0a20 2020 2020    return t.     
-0000e6e0: 2020 2070 7265 203d 2022 696e 7465 7261     pre = "intera
-0000e6f0: 6374 6976 6520 2220 6966 2073 656c 662e  ctive " if self.
-0000e700: 6973 5f69 6e74 6572 6163 7469 7665 2065  is_interactive e
-0000e710: 6c73 6520 2222 0a20 2020 2020 2020 2070  lse "".        p
-0000e720: 6f73 7420 3d20 2222 0a20 2020 2020 2020  ost = "".       
-0000e730: 2069 6620 7365 6c66 2e69 735f 696e 7465   if self.is_inte
-0000e740: 7261 6374 6976 653a 0a20 2020 2020 2020  ractive:.       
-0000e750: 2020 2020 2070 6f73 7420 3d20 2220 616e       post = " an
-0000e760: 6420 7061 7261 6d65 7465 7273 2022 202b  d parameters " +
-0000e770: 2073 7472 2874 7570 6c65 2873 656c 662e   str(tuple(self.
-0000e780: 7061 7261 6d73 2e6b 6579 7328 2929 290a  params.keys())).
-0000e790: 2020 2020 2020 2020 7772 6170 7065 7220          wrapper 
-0000e7a0: 3d20 5f67 6574 5f77 7261 7070 6572 5f66  = _get_wrapper_f
-0000e7b0: 6f72 5f65 7870 7228 7365 6c66 2e5f 7265  or_expr(self._re
-0000e7c0: 7475 726e 290a 2020 2020 2020 2020 7265  turn).        re
-0000e7d0: 7475 726e 2070 7265 202b 2022 6361 7274  turn pre + "cart
-0000e7e0: 6573 6961 6e20 6c69 6e65 3a20 2573 2066  esian line: %s f
-0000e7f0: 6f72 2025 7320 6f76 6572 2025 7322 2025  or %s over %s" %
-0000e800: 2028 0a20 2020 2020 2020 2020 2020 2077   (.            w
-0000e810: 7261 7070 6572 2025 2073 656c 662e 6578  rapper % self.ex
-0000e820: 7072 2c0a 2020 2020 2020 2020 2020 2020  pr,.            
-0000e830: 7374 7228 7365 6c66 2e76 6172 292c 0a20  str(self.var),. 
-0000e840: 2020 2020 2020 2020 2020 2073 7472 2828             str((
-0000e850: 6628 7365 6c66 2e73 7461 7274 292c 2066  f(self.start), f
-0000e860: 2873 656c 662e 656e 6429 2929 2c0a 2020  (self.end))),.  
-0000e870: 2020 2020 2020 2920 2b20 706f 7374 0a0a        ) + post..
-0000e880: 2020 2020 6465 6620 5f61 6461 7074 6976      def _adaptiv
-0000e890: 655f 7361 6d70 6c69 6e67 2873 656c 6629  e_sampling(self)
-0000e8a0: 3a0a 2020 2020 2020 2020 6e70 203d 2069  :.        np = i
-0000e8b0: 6d70 6f72 745f 6d6f 6475 6c65 2827 6e75  mport_module('nu
-0000e8c0: 6d70 7927 290a 0a20 2020 2020 2020 2064  mpy')..        d
-0000e8d0: 6566 2066 756e 6328 662c 2069 6d61 672c  ef func(f, imag,
-0000e8e0: 2078 293a 0a20 2020 2020 2020 2020 2020   x):.           
-0000e8f0: 2074 7279 3a0a 2020 2020 2020 2020 2020   try:.          
-0000e900: 2020 2020 2020 7720 3d20 636f 6d70 6c65        w = comple
-0000e910: 7828 6628 7820 2b20 316a 202a 2069 6d61  x(f(x + 1j * ima
-0000e920: 6729 290a 2020 2020 2020 2020 2020 2020  g)).            
-0000e930: 2020 2020 7265 7475 726e 2077 2e72 6561      return w.rea
-0000e940: 6c2c 2077 2e69 6d61 670a 2020 2020 2020  l, w.imag.      
-0000e950: 2020 2020 2020 6578 6365 7074 2028 5a65        except (Ze
-0000e960: 726f 4469 7669 7369 6f6e 4572 726f 722c  roDivisionError,
-0000e970: 204f 7665 7266 6c6f 7745 7272 6f72 293a   OverflowError):
-0000e980: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0000e990: 2072 6574 7572 6e20 6e70 2e6e 616e 2c20   return np.nan, 
-0000e9a0: 6e70 2e6e 616e 0a0a 2020 2020 2020 2020  np.nan..        
-0000e9b0: 6461 7461 203d 205f 6164 6170 7469 7665  data = _adaptive
-0000e9c0: 5f65 7661 6c28 0a20 2020 2020 2020 2020  _eval(.         
-0000e9d0: 2020 2066 756e 632c 205b 7365 6c66 2e76     func, [self.v
-0000e9e0: 6172 5d2c 2073 656c 662e 6578 7072 2c0a  ar], self.expr,.
-0000e9f0: 2020 2020 2020 2020 2020 2020 5b63 6f6d              [com
-0000ea00: 706c 6578 2873 656c 662e 7374 6172 7429  plex(self.start)
-0000ea10: 2e72 6561 6c2c 2063 6f6d 706c 6578 2873  .real, complex(s
-0000ea20: 656c 662e 656e 6429 2e72 6561 6c5d 2c0a  elf.end).real],.
-0000ea30: 2020 2020 2020 2020 2020 2020 636f 6d70              comp
-0000ea40: 6c65 7828 7365 6c66 2e73 7461 7274 292e  lex(self.start).
-0000ea50: 696d 6167 2c0a 2020 2020 2020 2020 2020  imag,.          
-0000ea60: 2020 6d6f 6475 6c65 733d 7365 6c66 2e6d    modules=self.m
-0000ea70: 6f64 756c 6573 2c0a 2020 2020 2020 2020  odules,.        
-0000ea80: 2020 2020 6164 6170 7469 7665 5f67 6f61      adaptive_goa
-0000ea90: 6c3d 7365 6c66 2e61 6461 7074 6976 655f  l=self.adaptive_
-0000eaa0: 676f 616c 2c0a 2020 2020 2020 2020 2020  goal,.          
-0000eab0: 2020 6c6f 7373 5f66 6e3d 7365 6c66 2e6c    loss_fn=self.l
-0000eac0: 6f73 735f 666e 290a 2020 2020 2020 2020  oss_fn).        
-0000ead0: 7265 7475 726e 2064 6174 615b 3a2c 2030  return data[:, 0
-0000eae0: 5d2c 2064 6174 615b 3a2c 2031 5d2c 2064  ], data[:, 1], d
-0000eaf0: 6174 615b 3a2c 2032 5d0a 0a20 2020 2064  ata[:, 2]..    d
-0000eb00: 6566 205f 756e 6966 6f72 6d5f 7361 6d70  ef _uniform_samp
-0000eb10: 6c69 6e67 2873 656c 6629 3a0a 2020 2020  ling(self):.    
-0000eb20: 2020 2020 6e70 203d 2069 6d70 6f72 745f      np = import_
-0000eb30: 6d6f 6475 6c65 2827 6e75 6d70 7927 290a  module('numpy').
-0000eb40: 0a20 2020 2020 2020 2078 2c20 7265 7375  .        x, resu
-0000eb50: 6c74 203d 2073 656c 662e 5f65 7661 6c75  lt = self._evalu
-0000eb60: 6174 6528 290a 2020 2020 2020 2020 5f72  ate().        _r
-0000eb70: 652c 205f 696d 203d 206e 702e 7265 616c  e, _im = np.real
-0000eb80: 2872 6573 756c 7429 2c20 6e70 2e69 6d61  (result), np.ima
-0000eb90: 6728 7265 7375 6c74 290a 2020 2020 2020  g(result).      
-0000eba0: 2020 5f72 6520 3d20 7365 6c66 2e5f 636f    _re = self._co
-0000ebb0: 7272 6563 745f 7368 6170 6528 5f72 652c  rrect_shape(_re,
-0000ebc0: 2078 290a 2020 2020 2020 2020 5f69 6d20   x).        _im 
-0000ebd0: 3d20 7365 6c66 2e5f 636f 7272 6563 745f  = self._correct_
-0000ebe0: 7368 6170 6528 5f69 6d2c 2078 290a 2020  shape(_im, x).  
-0000ebf0: 2020 2020 2020 7265 7475 726e 2078 2c20        return x, 
-0000ec00: 5f72 652c 205f 696d 0a0a 2020 2020 6465  _re, _im..    de
-0000ec10: 6620 5f67 6574 5f72 6561 6c5f 696d 6167  f _get_real_imag
-0000ec20: 2873 656c 6629 3a0a 2020 2020 2020 2020  (self):.        
-0000ec30: 2222 2220 4279 2065 7661 6c75 6174 696e  """ By evaluatin
-0000ec40: 6720 7468 6520 6675 6e63 7469 6f6e 206f  g the function o
-0000ec50: 7665 7220 6120 636f 6d70 6c65 7820 7261  ver a complex ra
-0000ec60: 6e67 6520 6974 2073 686f 756c 640a 2020  nge it should.  
-0000ec70: 2020 2020 2020 7265 7475 726e 2063 6f6d        return com
-0000ec80: 706c 6578 2076 616c 7565 732e 2054 6865  plex values. The
-0000ec90: 2069 6d61 6769 6e61 7279 2070 6172 7420   imaginary part 
-0000eca0: 6361 6e20 6265 2075 7365 6420 746f 206d  can be used to m
-0000ecb0: 6173 6b20 6f75 7420 7468 650a 2020 2020  ask out the.    
-0000ecc0: 2020 2020 756e 7761 6e74 6564 2076 616c      unwanted val
-0000ecd0: 7565 732e 0a20 2020 2020 2020 2022 2222  ues..        """
-0000ece0: 0a20 2020 2020 2020 2069 6620 7365 6c66  .        if self
-0000ecf0: 2e61 6461 7074 6976 653a 0a20 2020 2020  .adaptive:.     
-0000ed00: 2020 2020 2020 2072 6574 7572 6e20 7365         return se
-0000ed10: 6c66 2e5f 6164 6170 7469 7665 5f73 616d  lf._adaptive_sam
-0000ed20: 706c 696e 6728 290a 2020 2020 2020 2020  pling().        
-0000ed30: 7265 7475 726e 2073 656c 662e 5f75 6e69  return self._uni
-0000ed40: 666f 726d 5f73 616d 706c 696e 6728 290a  form_sampling().
-0000ed50: 0a20 2020 2064 6566 205f 6765 745f 6461  .    def _get_da
-0000ed60: 7461 5f68 656c 7065 7228 7365 6c66 293a  ta_helper(self):
-0000ed70: 0a20 2020 2020 2020 2022 2222 5265 7475  .        """Retu
-0000ed80: 726e 7320 636f 6f72 6469 6e61 7465 7320  rns coordinates 
-0000ed90: 7468 6174 206e 6565 6473 2074 6f20 6265  that needs to be
-0000eda0: 2070 6f73 7470 726f 6365 7373 6564 2e0a   postprocessed..
-0000edb0: 2020 2020 2020 2020 2222 220a 2020 2020          """.    
-0000edc0: 2020 2020 6e70 203d 2069 6d70 6f72 745f      np = import_
-0000edd0: 6d6f 6475 6c65 2827 6e75 6d70 7927 290a  module('numpy').
-0000ede0: 0a20 2020 2020 2020 2078 2c20 5f72 652c  .        x, _re,
-0000edf0: 205f 696d 203d 2073 656c 662e 5f67 6574   _im = self._get
-0000ee00: 5f72 6561 6c5f 696d 6167 2829 0a0a 2020  _real_imag()..  
-0000ee10: 2020 2020 2020 6966 2073 656c 662e 5f72        if self._r
-0000ee20: 6574 7572 6e20 6973 204e 6f6e 653a 0a20  eturn is None:. 
-0000ee30: 2020 2020 2020 2020 2020 2023 2054 6865             # The
-0000ee40: 2065 7661 6c75 6174 696f 6e20 636f 756c   evaluation coul
-0000ee50: 6420 7072 6f64 7563 6520 636f 6d70 6c65  d produce comple
-0000ee60: 7820 6e75 6d62 6572 732e 2053 6574 2072  x numbers. Set r
-0000ee70: 6561 6c20 656c 656d 656e 7473 0a20 2020  eal elements.   
-0000ee80: 2020 2020 2020 2020 2023 2074 6f20 4e61           # to Na
-0000ee90: 4e20 7768 6572 6520 7468 6572 6520 6172  N where there ar
-0000eea0: 6520 6e6f 6e2d 7a65 726f 2069 6d61 6769  e non-zero imagi
-0000eeb0: 6e61 7279 2065 6c65 6d65 6e74 730a 2020  nary elements.  
-0000eec0: 2020 2020 2020 2020 2020 5f72 655b 6e70            _re[np
-0000eed0: 2e69 6e76 6572 7428 6e70 2e69 7363 6c6f  .invert(np.isclo
-0000eee0: 7365 285f 696d 2c20 6e70 2e7a 6572 6f73  se(_im, np.zeros
-0000eef0: 5f6c 696b 6528 5f69 6d29 2929 5d20 3d20  _like(_im)))] = 
-0000ef00: 6e70 2e6e 616e 0a20 2020 2020 2020 2065  np.nan.        e
-0000ef10: 6c69 6620 7365 6c66 2e5f 7265 7475 726e  lif self._return
-0000ef20: 203d 3d20 2272 6561 6c22 3a0a 2020 2020   == "real":.    
-0000ef30: 2020 2020 2020 2020 7061 7373 0a20 2020          pass.   
-0000ef40: 2020 2020 2065 6c69 6620 7365 6c66 2e5f       elif self._
-0000ef50: 7265 7475 726e 203d 3d20 2269 6d61 6722  return == "imag"
-0000ef60: 3a0a 2020 2020 2020 2020 2020 2020 5f72  :.            _r
-0000ef70: 6520 3d20 5f69 6d0a 2020 2020 2020 2020  e = _im.        
-0000ef80: 656c 6966 2073 656c 662e 5f72 6574 7572  elif self._retur
-0000ef90: 6e20 3d3d 2022 6162 7322 3a0a 2020 2020  n == "abs":.    
-0000efa0: 2020 2020 2020 2020 5f72 6520 3d20 6e70          _re = np
-0000efb0: 2e73 7172 7428 5f72 652a 2a32 202b 205f  .sqrt(_re**2 + _
-0000efc0: 696d 2a2a 3229 0a20 2020 2020 2020 2065  im**2).        e
-0000efd0: 6c69 6620 7365 6c66 2e5f 7265 7475 726e  lif self._return
-0000efe0: 203d 3d20 2261 7267 223a 0a20 2020 2020   == "arg":.     
-0000eff0: 2020 2020 2020 205f 7265 203d 206e 702e         _re = np.
-0000f000: 6172 6374 616e 3228 5f69 6d2c 205f 7265  arctan2(_im, _re
-0000f010: 290a 2020 2020 2020 2020 656c 7365 3a0a  ).        else:.
-0000f020: 2020 2020 2020 2020 2020 2020 7261 6973              rais
-0000f030: 6520 5661 6c75 6545 7272 6f72 280a 2020  e ValueError(.  
-0000f040: 2020 2020 2020 2020 2020 2020 2020 2260                "`
-0000f050: 5f72 6574 7572 6e60 206e 6f74 2072 6563  _return` not rec
-0000f060: 6f67 6e69 7a65 642e 2052 6563 6569 7665  ognized. Receive
-0000f070: 643a 2025 7322 2025 2073 656c 662e 5f72  d: %s" % self._r
-0000f080: 6574 7572 6e29 0a0a 2020 2020 2020 2020  eturn)..        
-0000f090: 7265 7475 726e 2078 2c20 5f72 650a 0a0a  return x, _re...
-0000f0a0: 636c 6173 7320 436f 6c6f 7265 644c 696e  class ColoredLin
-0000f0b0: 654f 7665 7231 4452 616e 6765 5365 7269  eOver1DRangeSeri
-0000f0c0: 6573 284c 696e 654f 7665 7231 4452 616e  es(LineOver1DRan
-0000f0d0: 6765 5365 7269 6573 293a 0a20 2020 2022  geSeries):.    "
-0000f0e0: 2222 5265 7072 6573 656e 7473 2061 2032  ""Represents a 2
-0000f0f0: 4420 6c69 6e65 2073 6572 6965 7320 696e  D line series in
-0000f100: 2077 6869 6368 2060 636f 6c6f 725f 6675   which `color_fu
-0000f110: 6e63 6020 6973 2061 2063 616c 6c61 626c  nc` is a callabl
-0000f120: 652e 0a20 2020 2022 2222 0a20 2020 2069  e..    """.    i
-0000f130: 735f 7061 7261 6d65 7472 6963 203d 2054  s_parametric = T
-0000f140: 7275 650a 0a20 2020 2064 6566 205f 5f69  rue..    def __i
-0000f150: 6e69 745f 5f28 7365 6c66 2c20 2a61 7267  nit__(self, *arg
-0000f160: 732c 202a 2a6b 7761 7267 7329 3a0a 2020  s, **kwargs):.  
-0000f170: 2020 2020 2020 7375 7065 7228 292e 5f5f        super().__
-0000f180: 696e 6974 5f5f 282a 6172 6773 2c20 2a2a  init__(*args, **
-0000f190: 6b77 6172 6773 290a 2020 2020 2020 2020  kwargs).        
-0000f1a0: 7365 6c66 2e75 7365 5f63 6d20 3d20 6b77  self.use_cm = kw
-0000f1b0: 6172 6773 2e67 6574 2822 7573 655f 636d  args.get("use_cm
-0000f1c0: 222c 2054 7275 6529 0a0a 2020 2020 6465  ", True)..    de
-0000f1d0: 6620 5f67 6574 5f64 6174 615f 6865 6c70  f _get_data_help
-0000f1e0: 6572 2873 656c 6629 3a0a 2020 2020 2020  er(self):.      
-0000f1f0: 2020 2222 2252 6574 7572 6e73 2063 6f6f    """Returns coo
-0000f200: 7264 696e 6174 6573 2074 6861 7420 6e65  rdinates that ne
-0000f210: 6564 7320 746f 2062 6520 706f 7374 7072  eds to be postpr
-0000f220: 6f63 6573 7365 642e 0a20 2020 2020 2020  ocessed..       
-0000f230: 2044 6570 656e 6469 6e67 206f 6e20 7468   Depending on th
-0000f240: 6520 6061 6461 7074 6976 6560 206f 7074  e `adaptive` opt
-0000f250: 696f 6e2c 2074 6869 7320 6675 6e63 7469  ion, this functi
-0000f260: 6f6e 2077 696c 6c20 6569 7468 6572 2075  on will either u
-0000f270: 7365 2061 6e0a 2020 2020 2020 2020 6164  se an.        ad
-0000f280: 6170 7469 7665 2061 6c67 6f72 6974 686d  aptive algorithm
-0000f290: 206f 7220 6974 2077 696c 6c20 756e 6966   or it will unif
-0000f2a0: 6f72 6d6c 7920 7361 6d70 6c65 2074 6865  ormly sample the
-0000f2b0: 2065 7870 7265 7373 696f 6e20 6f76 6572   expression over
-0000f2c0: 2074 6865 0a20 2020 2020 2020 2070 726f   the.        pro
-0000f2d0: 7669 6465 6420 7261 6e67 652e 0a20 2020  vided range..   
-0000f2e0: 2020 2020 2022 2222 0a20 2020 2020 2020       """.       
-0000f2f0: 2078 2c20 7920 3d20 7375 7065 7228 292e   x, y = super().
-0000f300: 5f67 6574 5f64 6174 615f 6865 6c70 6572  _get_data_helper
-0000f310: 2829 0a20 2020 2020 2020 2072 6574 7572  ().        retur
-0000f320: 6e20 782c 2079 2c20 7365 6c66 2e65 7661  n x, y, self.eva
-0000f330: 6c5f 636f 6c6f 725f 6675 6e63 2878 2c20  l_color_func(x, 
-0000f340: 7929 0a0a 0a63 6c61 7373 2041 6273 4172  y)...class AbsAr
-0000f350: 674c 696e 6553 6572 6965 7328 4c69 6e65  gLineSeries(Line
-0000f360: 4f76 6572 3144 5261 6e67 6553 6572 6965  Over1DRangeSerie
-0000f370: 7329 3a0a 2020 2020 2222 2252 6570 7265  s):.    """Repre
-0000f380: 7365 6e74 7320 7468 6520 6162 736f 6c75  sents the absolu
-0000f390: 7465 2076 616c 7565 206f 6620 6120 636f  te value of a co
-0000f3a0: 6d70 6c65 7820 6675 6e63 7469 6f6e 2063  mplex function c
-0000f3b0: 6f6c 6f72 6564 2062 7920 6974 730a 2020  olored by its.  
-0000f3c0: 2020 6172 6775 6d65 6e74 206f 7665 7220    argument over 
-0000f3d0: 6120 636f 6d70 6c65 7820 7261 6e67 6520  a complex range 
-0000f3e0: 2861 202b 2049 2a62 2c20 6320 2b20 4920  (a + I*b, c + I 
-0000f3f0: 2a20 6229 2e0a 2020 2020 4e6f 7465 2074  * b)..    Note t
-0000f400: 6861 7420 7468 6520 696d 6167 696e 6172  hat the imaginar
-0000f410: 7920 7061 7274 206f 6620 7468 6520 7374  y part of the st
-0000f420: 6172 7420 616e 6420 656e 6420 6d75 7374  art and end must
-0000f430: 2062 6520 7468 6520 7361 6d65 2e0a 2020   be the same..  
-0000f440: 2020 2222 220a 0a20 2020 2069 735f 7061    """..    is_pa
-0000f450: 7261 6d65 7472 6963 203d 2054 7275 650a  rametric = True.
-0000f460: 2020 2020 6973 5f63 6f6d 706c 6578 203d      is_complex =
-0000f470: 2054 7275 650a 0a20 2020 2064 6566 205f   True..    def _
-0000f480: 5f6e 6577 5f5f 2863 6c73 2c20 2a61 7267  _new__(cls, *arg
-0000f490: 732c 202a 2a6b 7761 7267 7329 3a0a 2020  s, **kwargs):.  
-0000f4a0: 2020 2020 2020 7265 7475 726e 206f 626a        return obj
-0000f4b0: 6563 742e 5f5f 6e65 775f 5f28 636c 7329  ect.__new__(cls)
-0000f4c0: 0a0a 2020 2020 6465 6620 5f5f 696e 6974  ..    def __init
-0000f4d0: 5f5f 2873 656c 662c 202a 6172 6773 2c20  __(self, *args, 
-0000f4e0: 2a2a 6b77 6172 6773 293a 0a20 2020 2020  **kwargs):.     
-0000f4f0: 2020 2073 7570 6572 2829 2e5f 5f69 6e69     super().__ini
-0000f500: 745f 5f28 2a61 7267 732c 202a 2a6b 7761  t__(*args, **kwa
-0000f510: 7267 7329 0a20 2020 2020 2020 2073 656c  rgs).        sel
-0000f520: 662e 7573 655f 636d 203d 206b 7761 7267  f.use_cm = kwarg
-0000f530: 732e 6765 7428 2275 7365 5f63 6d22 2c20  s.get("use_cm", 
-0000f540: 5472 7565 290a 0a20 2020 2064 6566 205f  True)..    def _
-0000f550: 5f73 7472 5f5f 2873 656c 6629 3a0a 2020  _str__(self):.  
-0000f560: 2020 2020 2020 7265 7475 726e 2073 656c        return sel
-0000f570: 662e 5f73 7472 5f68 656c 7065 7228 2263  f._str_helper("c
-0000f580: 6172 7465 7369 616e 2061 6273 2d61 7267  artesian abs-arg
-0000f590: 206c 696e 653a 2025 7320 666f 7220 2573   line: %s for %s
-0000f5a0: 206f 7665 7220 2573 2220 2520 280a 2020   over %s" % (.  
-0000f5b0: 2020 2020 2020 2020 2020 7374 7228 7365            str(se
-0000f5c0: 6c66 2e65 7870 7229 2c0a 2020 2020 2020  lf.expr),.      
-0000f5d0: 2020 2020 2020 7374 7228 7365 6c66 2e76        str(self.v
-0000f5e0: 6172 292c 0a20 2020 2020 2020 2020 2020  ar),.           
-0000f5f0: 2073 7472 2828 7365 6c66 2e73 7461 7274   str((self.start
-0000f600: 2c20 7365 6c66 2e65 6e64 2929 2929 0a0a  , self.end))))..
-0000f610: 2020 2020 6465 6620 5f67 6574 5f64 6174      def _get_dat
-0000f620: 615f 6865 6c70 6572 2873 656c 6629 3a0a  a_helper(self):.
-0000f630: 2020 2020 2020 2020 2222 2252 6574 7572          """Retur
-0000f640: 6e73 2063 6f6f 7264 696e 6174 6573 2074  ns coordinates t
-0000f650: 6861 7420 6e65 6564 7320 746f 2062 6520  hat needs to be 
-0000f660: 706f 7374 7072 6f63 6573 7365 642e 0a20  postprocessed.. 
-0000f670: 2020 2020 2020 2044 6570 656e 6469 6e67         Depending
-0000f680: 206f 6e20 7468 6520 6061 6461 7074 6976   on the `adaptiv
-0000f690: 6560 206f 7074 696f 6e2c 2074 6869 7320  e` option, this 
-0000f6a0: 6675 6e63 7469 6f6e 2077 696c 6c20 6569  function will ei
-0000f6b0: 7468 6572 2075 7365 2061 6e0a 2020 2020  ther use an.    
-0000f6c0: 2020 2020 6164 6170 7469 7665 2061 6c67      adaptive alg
-0000f6d0: 6f72 6974 686d 206f 7220 6974 2077 696c  orithm or it wil
-0000f6e0: 6c20 756e 6966 6f72 6d6c 7920 7361 6d70  l uniformly samp
-0000f6f0: 6c65 2074 6865 2065 7870 7265 7373 696f  le the expressio
-0000f700: 6e20 6f76 6572 2074 6865 0a20 2020 2020  n over the.     
-0000f710: 2020 2070 726f 7669 6465 6420 7261 6e67     provided rang
-0000f720: 652e 0a20 2020 2020 2020 2022 2222 0a20  e..        """. 
-0000f730: 2020 2020 2020 206e 7020 3d20 696d 706f         np = impo
-0000f740: 7274 5f6d 6f64 756c 6528 276e 756d 7079  rt_module('numpy
-0000f750: 2729 0a0a 2020 2020 2020 2020 782c 205f  ')..        x, _
-0000f760: 7265 2c20 5f69 6d20 3d20 7365 6c66 2e5f  re, _im = self._
-0000f770: 6765 745f 7265 616c 5f69 6d61 6728 290a  get_real_imag().
-0000f780: 2020 2020 2020 2020 5f61 6273 203d 206e          _abs = n
-0000f790: 702e 7371 7274 285f 7265 2a2a 3220 2b20  p.sqrt(_re**2 + 
-0000f7a0: 5f69 6d2a 2a32 290a 2020 2020 2020 2020  _im**2).        
-0000f7b0: 5f61 6e67 6c65 203d 206e 702e 6172 6374  _angle = np.arct
-0000f7c0: 616e 3228 5f69 6d2c 205f 7265 290a 2020  an2(_im, _re).  
-0000f7d0: 2020 2020 2020 7265 7475 726e 2078 2c20        return x, 
-0000f7e0: 5f61 6273 2c20 5f61 6e67 6c65 0a0a 0a63  _abs, _angle...c
-0000f7f0: 6c61 7373 2050 6172 616d 6574 7269 634c  lass ParametricL
-0000f800: 696e 6542 6173 6553 6572 6965 7328 0a20  ineBaseSeries(. 
-0000f810: 2020 2043 6f6d 6d6f 6e41 6461 7074 6976     CommonAdaptiv
-0000f820: 6545 7661 6c75 6174 696f 6e2c 2043 6f6d  eEvaluation, Com
-0000f830: 6d6f 6e55 6e69 666f 726d 4576 616c 7561  monUniformEvalua
-0000f840: 7469 6f6e 2c20 4c69 6e65 3244 4261 7365  tion, Line2DBase
-0000f850: 5365 7269 6573 0a29 3a0a 2020 2020 6973  Series.):.    is
-0000f860: 5f70 6172 616d 6574 7269 6320 3d20 5472  _parametric = Tr
-0000f870: 7565 0a0a 2020 2020 6465 6620 5f73 6574  ue..    def _set
-0000f880: 5f70 6172 616d 6574 7269 635f 6c69 6e65  _parametric_line
-0000f890: 5f6c 6162 656c 2873 656c 662c 206c 6162  _label(self, lab
-0000f8a0: 656c 293a 0a20 2020 2020 2020 2022 2222  el):.        """
-0000f8b0: 4c6f 6769 6320 746f 2073 6574 2074 6865  Logic to set the
-0000f8c0: 2063 6f72 7265 6374 206c 6162 656c 2074   correct label t
-0000f8d0: 6f20 6265 2073 686f 776e 206f 6e20 7468  o be shown on th
-0000f8e0: 6520 706c 6f74 2e0a 2020 2020 2020 2020  e plot..        
-0000f8f0: 4966 2060 7573 655f 636d 3d54 7275 6560  If `use_cm=True`
-0000f900: 2074 6865 7265 2077 696c 6c20 6265 2061   there will be a
-0000f910: 2063 6f6c 6f72 6261 722c 2073 6f20 7765   colorbar, so we
-0000f920: 2073 686f 7720 7468 6520 7061 7261 6d65   show the parame
-0000f930: 7465 722e 0a20 2020 2020 2020 2049 6620  ter..        If 
-0000f940: 6075 7365 5f63 6d3d 4661 6c73 6560 2c20  `use_cm=False`, 
-0000f950: 7468 6572 6520 6d69 6768 7420 6265 2061  there might be a
-0000f960: 206c 6567 656e 642c 2073 6f20 7765 2073   legend, so we s
-0000f970: 686f 7720 7468 6520 6578 7072 6573 7369  how the expressi
-0000f980: 6f6e 732e 0a0a 2020 2020 2020 2020 5061  ons...        Pa
-0000f990: 7261 6d65 7465 7273 0a20 2020 2020 2020  rameters.       
-0000f9a0: 203d 3d3d 3d3d 3d3d 3d3d 3d0a 2020 2020   ==========.    
-0000f9b0: 2020 2020 6c61 6265 6c20 3a20 7374 720a      label : str.
-0000f9c0: 2020 2020 2020 2020 2020 2020 6c61 6265              labe
-0000f9d0: 6c20 7061 7373 6564 2069 6e20 6279 2074  l passed in by t
-0000f9e0: 6865 2070 7265 2d70 726f 6365 7373 6f72  he pre-processor
-0000f9f0: 206f 7220 7468 6520 7573 6572 0a20 2020   or the user.   
-0000fa00: 2020 2020 2022 2222 0a20 2020 2020 2020       """.       
-0000fa10: 2073 656c 662e 5f6c 6162 656c 203d 2073   self._label = s
-0000fa20: 7472 2873 656c 662e 7661 7229 2069 6620  tr(self.var) if 
-0000fa30: 6c61 6265 6c20 6973 204e 6f6e 6520 656c  label is None el
-0000fa40: 7365 206c 6162 656c 0a20 2020 2020 2020  se label.       
-0000fa50: 2073 656c 662e 5f6c 6174 6578 5f6c 6162   self._latex_lab
-0000fa60: 656c 203d 206c 6174 6578 2873 656c 662e  el = latex(self.
-0000fa70: 7661 7229 2069 6620 6c61 6265 6c20 6973  var) if label is
-0000fa80: 204e 6f6e 6520 656c 7365 206c 6162 656c   None else label
-0000fa90: 0a20 2020 2020 2020 2069 6620 2873 656c  .        if (sel
-0000faa0: 662e 7573 655f 636d 2069 7320 4661 6c73  f.use_cm is Fals
-0000fab0: 6529 2061 6e64 2028 7365 6c66 2e5f 6c61  e) and (self._la
-0000fac0: 6265 6c20 3d3d 2073 7472 2873 656c 662e  bel == str(self.
-0000fad0: 7661 7229 293a 0a20 2020 2020 2020 2020  var)):.         
-0000fae0: 2020 2073 656c 662e 5f6c 6162 656c 203d     self._label =
-0000faf0: 2073 7472 2873 656c 662e 6578 7072 290a   str(self.expr).
-0000fb00: 2020 2020 2020 2020 2020 2020 7365 6c66              self
-0000fb10: 2e5f 6c61 7465 785f 6c61 6265 6c20 3d20  ._latex_label = 
-0000fb20: 6c61 7465 7828 7365 6c66 2e65 7870 7229  latex(self.expr)
-0000fb30: 0a20 2020 2020 2020 2023 2069 6620 7468  .        # if th
-0000fb40: 6520 6578 7072 6573 7369 6f6e 7320 6973  e expressions is
-0000fb50: 2061 206c 616d 6264 6120 6675 6e63 7469   a lambda functi
-0000fb60: 6f6e 2061 6e64 2075 7365 5f63 6d3d 4661  on and use_cm=Fa
-0000fb70: 6c73 6520 616e 6420 6e6f 206c 6162 656c  lse and no label
-0000fb80: 0a20 2020 2020 2020 2023 2068 6173 2062  .        # has b
-0000fb90: 6565 6e20 7072 6f76 6964 6564 2c20 7468  een provided, th
-0000fba0: 656e 2069 7473 2062 6574 7465 7220 746f  en its better to
-0000fbb0: 2064 6f20 7468 6520 666f 6c6c 6f77 696e   do the followin
-0000fbc0: 6720 696e 206f 7264 6572 2074 6f0a 2020  g in order to.  
-0000fbd0: 2020 2020 2020 2320 6176 6f69 6420 7375        # avoid su
-0000fbe0: 7072 6973 6573 206f 6e20 7468 6520 6261  prises on the ba
-0000fbf0: 636b 656e 640a 2020 2020 2020 2020 6966  ckend.        if
-0000fc00: 2061 6e79 2863 616c 6c61 626c 6528 6529   any(callable(e)
-0000fc10: 2066 6f72 2065 2069 6e20 7365 6c66 2e65   for e in self.e
-0000fc20: 7870 7229 2061 6e64 2028 6e6f 7420 7365  xpr) and (not se
-0000fc30: 6c66 2e75 7365 5f63 6d29 3a0a 2020 2020  lf.use_cm):.    
-0000fc40: 2020 2020 2020 2020 6966 2073 656c 662e          if self.
-0000fc50: 5f6c 6162 656c 203d 3d20 7374 7228 7365  _label == str(se
-0000fc60: 6c66 2e65 7870 7229 3a0a 2020 2020 2020  lf.expr):.      
-0000fc70: 2020 2020 2020 2020 2020 7365 6c66 2e5f            self._
-0000fc80: 6c61 6265 6c20 3d20 2222 0a0a 2020 2020  label = ""..    
-0000fc90: 6465 6620 5f61 6461 7074 6976 655f 7361  def _adaptive_sa
-0000fca0: 6d70 6c69 6e67 2873 656c 6629 3a0a 2020  mpling(self):.  
-0000fcb0: 2020 2020 2020 6e70 203d 2069 6d70 6f72        np = impor
-0000fcc0: 745f 6d6f 6475 6c65 2827 6e75 6d70 7927  t_module('numpy'
-0000fcd0: 290a 0a20 2020 2020 2020 2064 6566 2066  )..        def f
-0000fce0: 756e 6328 662c 2069 735f 3244 6c69 6e65  unc(f, is_2Dline
-0000fcf0: 2c20 7829 3a0a 2020 2020 2020 2020 2020  , x):.          
-0000fd00: 2020 7472 793a 0a20 2020 2020 2020 2020    try:.         
-0000fd10: 2020 2020 2020 2077 203d 205b 636f 6d70         w = [comp
-0000fd20: 6c65 7828 7429 2066 6f72 2074 2069 6e20  lex(t) for t in 
-0000fd30: 6628 636f 6d70 6c65 7828 7829 295d 0a20  f(complex(x))]. 
-0000fd40: 2020 2020 2020 2020 2020 2020 2020 2072                 r
-0000fd50: 6574 7572 6e20 5b74 2e72 6561 6c20 6966  eturn [t.real if
-0000fd60: 206e 702e 6973 636c 6f73 6528 742e 696d   np.isclose(t.im
-0000fd70: 6167 2c20 3029 2065 6c73 6520 6e70 2e6e  ag, 0) else np.n
-0000fd80: 616e 2066 6f72 2074 2069 6e20 775d 0a20  an for t in w]. 
-0000fd90: 2020 2020 2020 2020 2020 2065 7863 6570             excep
-0000fda0: 7420 285a 6572 6f44 6976 6973 696f 6e45  t (ZeroDivisionE
-0000fdb0: 7272 6f72 2c20 4f76 6572 666c 6f77 4572  rror, OverflowEr
-0000fdc0: 726f 7229 3a0a 2020 2020 2020 2020 2020  ror):.          
-0000fdd0: 2020 2020 2020 7265 7475 726e 205b 6e70        return [np
-0000fde0: 2e6e 616e 2066 6f72 2074 2069 6e20 7261  .nan for t in ra
-0000fdf0: 6e67 6528 3220 6966 2069 735f 3244 6c69  nge(2 if is_2Dli
-0000fe00: 6e65 2065 6c73 6520 3329 5d0a 0a20 2020  ne else 3)]..   
-0000fe10: 2020 2020 2069 6620 616c 6c28 6e6f 7420       if all(not 
-0000fe20: 6361 6c6c 6162 6c65 2865 2920 666f 7220  callable(e) for 
-0000fe30: 6520 696e 2073 656c 662e 6578 7072 293a  e in self.expr):
-0000fe40: 0a20 2020 2020 2020 2020 2020 2065 7870  .            exp
-0000fe50: 7220 3d20 5475 706c 6528 7365 6c66 2e65  r = Tuple(self.e
-0000fe60: 7870 725f 782c 2073 656c 662e 6578 7072  xpr_x, self.expr
-0000fe70: 5f79 290a 2020 2020 2020 2020 2020 2020  _y).            
-0000fe80: 6966 206e 6f74 2073 656c 662e 6973 5f32  if not self.is_2
-0000fe90: 446c 696e 653a 0a20 2020 2020 2020 2020  Dline:.         
-0000fea0: 2020 2020 2020 2065 7870 7220 3d20 5475         expr = Tu
-0000feb0: 706c 6528 7365 6c66 2e65 7870 725f 782c  ple(self.expr_x,
-0000fec0: 2073 656c 662e 6578 7072 5f79 2c20 7365   self.expr_y, se
-0000fed0: 6c66 2e65 7870 725f 7a29 0a20 2020 2020  lf.expr_z).     
-0000fee0: 2020 2065 6c73 653a 0a20 2020 2020 2020     else:.       
-0000fef0: 2020 2020 2023 2065 7870 7220 6973 2075       # expr is u
-0000ff00: 7365 722d 7072 6f76 6964 6564 206c 616d  ser-provided lam
-0000ff10: 6264 6120 6675 6e63 7469 6f6e 730a 2020  bda functions.  
-0000ff20: 2020 2020 2020 2020 2020 6578 7072 203d            expr =
-0000ff30: 206c 616d 6264 6120 783a 2028 7365 6c66   lambda x: (self
-0000ff40: 2e65 7870 725f 7828 7829 2c20 7365 6c66  .expr_x(x), self
-0000ff50: 2e65 7870 725f 7928 7829 290a 2020 2020  .expr_y(x)).    
-0000ff60: 2020 2020 2020 2020 6966 206e 6f74 2073          if not s
-0000ff70: 656c 662e 6973 5f32 446c 696e 653a 0a20  elf.is_2Dline:. 
-0000ff80: 2020 2020 2020 2020 2020 2020 2020 2065                 e
-0000ff90: 7870 7220 3d20 6c61 6d62 6461 2078 3a20  xpr = lambda x: 
-0000ffa0: 280a 2020 2020 2020 2020 2020 2020 2020  (.              
-0000ffb0: 2020 2020 2020 7365 6c66 2e65 7870 725f        self.expr_
-0000ffc0: 7828 7829 2c20 7365 6c66 2e65 7870 725f  x(x), self.expr_
-0000ffd0: 7928 7829 2c20 7365 6c66 2e65 7870 725f  y(x), self.expr_
-0000ffe0: 7a28 7829 290a 0a20 2020 2020 2020 2064  z(x))..        d
-0000fff0: 6174 6120 3d20 5f61 6461 7074 6976 655f  ata = _adaptive_
-00010000: 6576 616c 280a 2020 2020 2020 2020 2020  eval(.          
-00010010: 2020 6675 6e63 2c20 5b73 656c 662e 7661    func, [self.va
-00010020: 725d 2c20 6578 7072 2c0a 2020 2020 2020  r], expr,.      
-00010030: 2020 2020 2020 5b66 6c6f 6174 2873 656c        [float(sel
-00010040: 662e 7374 6172 7429 2c20 666c 6f61 7428  f.start), float(
-00010050: 7365 6c66 2e65 6e64 295d 2c0a 2020 2020  self.end)],.    
-00010060: 2020 2020 2020 2020 7365 6c66 2e69 735f          self.is_
-00010070: 3244 6c69 6e65 2c0a 2020 2020 2020 2020  2Dline,.        
-00010080: 2020 2020 6d6f 6475 6c65 733d 7365 6c66      modules=self
-00010090: 2e6d 6f64 756c 6573 2c0a 2020 2020 2020  .modules,.      
-000100a0: 2020 2020 2020 6164 6170 7469 7665 5f67        adaptive_g
-000100b0: 6f61 6c3d 7365 6c66 2e61 6461 7074 6976  oal=self.adaptiv
-000100c0: 655f 676f 616c 2c0a 2020 2020 2020 2020  e_goal,.        
-000100d0: 2020 2020 6c6f 7373 5f66 6e3d 7365 6c66      loss_fn=self
-000100e0: 2e6c 6f73 735f 666e 290a 0a20 2020 2020  .loss_fn)..     
-000100f0: 2020 2069 6620 7365 6c66 2e69 735f 3244     if self.is_2D
-00010100: 6c69 6e65 3a0a 2020 2020 2020 2020 2020  line:.          
-00010110: 2020 7265 7475 726e 2064 6174 615b 3a2c    return data[:,
-00010120: 2031 5d2c 2064 6174 615b 3a2c 2032 5d2c   1], data[:, 2],
-00010130: 2064 6174 615b 3a2c 2030 5d0a 2020 2020   data[:, 0].    
-00010140: 2020 2020 7265 7475 726e 2064 6174 615b      return data[
-00010150: 3a2c 2031 5d2c 2064 6174 615b 3a2c 2032  :, 1], data[:, 2
-00010160: 5d2c 2064 6174 615b 3a2c 2033 5d2c 2064  ], data[:, 3], d
-00010170: 6174 615b 3a2c 2030 5d0a 0a20 2020 2064  ata[:, 0]..    d
-00010180: 6566 2067 6574 5f6c 6162 656c 2873 656c  ef get_label(sel
-00010190: 662c 2075 7365 5f6c 6174 6578 3d46 616c  f, use_latex=Fal
-000101a0: 7365 2c20 7772 6170 7065 723d 2224 2573  se, wrapper="$%s
-000101b0: 2422 293a 0a20 2020 2020 2020 2023 2070  $"):.        # p
-000101c0: 6172 616d 6574 7269 6320 6c69 6e65 7320  arametric lines 
-000101d0: 7265 7475 726e 7320 7468 6520 7265 7072  returns the repr
-000101e0: 6573 656e 7461 7469 6f6e 206f 6620 7468  esentation of th
-000101f0: 6520 7061 7261 6d65 7465 7220 746f 2062  e parameter to b
-00010200: 650a 2020 2020 2020 2020 2320 7368 6f77  e.        # show
-00010210: 6e20 6f6e 2074 6865 2063 6f6c 6f72 6261  n on the colorba
-00010220: 7220 6966 2060 7573 655f 636d 3d54 7275  r if `use_cm=Tru
-00010230: 6560 2c20 6f74 6865 7277 6973 6520 6974  e`, otherwise it
-00010240: 2072 6574 7572 6e73 2074 6865 0a20 2020   returns the.   
-00010250: 2020 2020 2023 2072 6570 7265 7365 6e74       # represent
-00010260: 6174 696f 6e20 6f66 2074 6865 2065 7870  ation of the exp
-00010270: 7265 7373 696f 6e20 746f 2062 6520 706c  ression to be pl
-00010280: 6163 6564 206f 6e20 7468 6520 6c65 6765  aced on the lege
-00010290: 6e64 2e0a 2020 2020 2020 2020 6966 2073  nd..        if s
-000102a0: 656c 662e 7573 655f 636d 3a0a 2020 2020  elf.use_cm:.    
-000102b0: 2020 2020 2020 2020 6966 2073 7472 2873          if str(s
-000102c0: 656c 662e 7661 7229 203d 3d20 7365 6c66  elf.var) == self
-000102d0: 2e5f 6c61 6265 6c3a 0a20 2020 2020 2020  ._label:.       
-000102e0: 2020 2020 2020 2020 2069 6620 7573 655f           if use_
-000102f0: 6c61 7465 783a 0a20 2020 2020 2020 2020  latex:.         
-00010300: 2020 2020 2020 2020 2020 2072 6574 7572             retur
-00010310: 6e20 7365 6c66 2e5f 6765 745f 7772 6170  n self._get_wrap
-00010320: 7065 645f 6c61 6265 6c28 6c61 7465 7828  ped_label(latex(
-00010330: 7365 6c66 2e76 6172 292c 2077 7261 7070  self.var), wrapp
-00010340: 6572 290a 2020 2020 2020 2020 2020 2020  er).            
-00010350: 2020 2020 7265 7475 726e 2073 7472 2873      return str(s
-00010360: 656c 662e 7661 7229 0a20 2020 2020 2020  elf.var).       
-00010370: 2020 2020 2023 2068 6572 6520 7468 6520       # here the 
-00010380: 7573 6572 2068 6173 2070 726f 7669 6465  user has provide
-00010390: 6420 6120 6375 7374 6f6d 206c 6162 656c  d a custom label
-000103a0: 0a20 2020 2020 2020 2020 2020 2072 6574  .            ret
-000103b0: 7572 6e20 7365 6c66 2e5f 6c61 6265 6c0a  urn self._label.
-000103c0: 2020 2020 2020 2020 6966 2075 7365 5f6c          if use_l
-000103d0: 6174 6578 3a0a 2020 2020 2020 2020 2020  atex:.          
-000103e0: 2020 6966 2073 656c 662e 5f6c 6162 656c    if self._label
-000103f0: 2021 3d20 7374 7228 7365 6c66 2e65 7870   != str(self.exp
-00010400: 7229 3a0a 2020 2020 2020 2020 2020 2020  r):.            
-00010410: 2020 2020 7265 7475 726e 2073 656c 662e      return self.
-00010420: 5f6c 6174 6578 5f6c 6162 656c 0a20 2020  _latex_label.   
-00010430: 2020 2020 2020 2020 2072 6574 7572 6e20           return 
-00010440: 7365 6c66 2e5f 6765 745f 7772 6170 7065  self._get_wrappe
-00010450: 645f 6c61 6265 6c28 7365 6c66 2e5f 6c61  d_label(self._la
-00010460: 7465 785f 6c61 6265 6c2c 2077 7261 7070  tex_label, wrapp
-00010470: 6572 290a 2020 2020 2020 2020 7265 7475  er).        retu
-00010480: 726e 2073 656c 662e 5f6c 6162 656c 0a0a  rn self._label..
-00010490: 2020 2020 6465 6620 5f67 6574 5f64 6174      def _get_dat
-000104a0: 615f 6865 6c70 6572 2873 656c 6629 3a0a  a_helper(self):.
-000104b0: 2020 2020 2020 2020 2222 2252 6574 7572          """Retur
-000104c0: 6e73 2063 6f6f 7264 696e 6174 6573 2074  ns coordinates t
-000104d0: 6861 7420 6e65 6564 7320 746f 2062 6520  hat needs to be 
-000104e0: 706f 7374 7072 6f63 6573 7365 642e 0a20  postprocessed.. 
-000104f0: 2020 2020 2020 2044 6570 656e 6469 6e67         Depending
-00010500: 206f 6e20 7468 6520 6061 6461 7074 6976   on the `adaptiv
-00010510: 6560 206f 7074 696f 6e2c 2074 6869 7320  e` option, this 
-00010520: 6675 6e63 7469 6f6e 2077 696c 6c20 6569  function will ei
-00010530: 7468 6572 2075 7365 2061 6e0a 2020 2020  ther use an.    
-00010540: 2020 2020 6164 6170 7469 7665 2061 6c67      adaptive alg
-00010550: 6f72 6974 686d 206f 7220 6974 2077 696c  orithm or it wil
-00010560: 6c20 756e 6966 6f72 6d6c 7920 7361 6d70  l uniformly samp
-00010570: 6c65 2074 6865 2065 7870 7265 7373 696f  le the expressio
-00010580: 6e20 6f76 6572 2074 6865 0a20 2020 2020  n over the.     
-00010590: 2020 2070 726f 7669 6465 6420 7261 6e67     provided rang
-000105a0: 652e 0a20 2020 2020 2020 2022 2222 0a20  e..        """. 
-000105b0: 2020 2020 2020 2069 6620 7365 6c66 2e61         if self.a
-000105c0: 6461 7074 6976 653a 0a20 2020 2020 2020  daptive:.       
-000105d0: 2020 2020 2063 6f6f 7264 7320 3d20 7365       coords = se
-000105e0: 6c66 2e5f 6164 6170 7469 7665 5f73 616d  lf._adaptive_sam
-000105f0: 706c 696e 6728 290a 2020 2020 2020 2020  pling().        
-00010600: 656c 7365 3a0a 2020 2020 2020 2020 2020  else:.          
-00010610: 2020 636f 6f72 6473 203d 2073 656c 662e    coords = self.
-00010620: 5f75 6e69 666f 726d 5f73 616d 706c 696e  _uniform_samplin
-00010630: 6728 290a 0a20 2020 2020 2020 2069 6620  g()..        if 
-00010640: 7365 6c66 2e69 735f 3244 6c69 6e65 2061  self.is_2Dline a
-00010650: 6e64 2073 656c 662e 6973 5f70 6f6c 6172  nd self.is_polar
-00010660: 3a0a 2020 2020 2020 2020 2020 2020 2320  :.            # 
-00010670: 7768 656e 2070 6c6f 745f 706f 6c61 7220  when plot_polar 
-00010680: 6973 2065 7865 6375 7465 6420 7769 7468  is executed with
-00010690: 2070 6f6c 6172 5f61 7869 733d 5472 7565   polar_axis=True
-000106a0: 0a20 2020 2020 2020 2020 2020 206e 7020  .            np 
-000106b0: 3d20 696d 706f 7274 5f6d 6f64 756c 6528  = import_module(
-000106c0: 276e 756d 7079 2729 0a20 2020 2020 2020  'numpy').       
-000106d0: 2020 2020 2078 2c20 792c 205f 203d 2063       x, y, _ = c
-000106e0: 6f6f 7264 730a 2020 2020 2020 2020 2020  oords.          
-000106f0: 2020 7220 3d20 6e70 2e73 7172 7428 782a    r = np.sqrt(x*
-00010700: 2a32 202b 2079 2a2a 3229 0a20 2020 2020  *2 + y**2).     
-00010710: 2020 2020 2020 2074 203d 206e 702e 6172         t = np.ar
-00010720: 6374 616e 3228 792c 2078 290a 2020 2020  ctan2(y, x).    
-00010730: 2020 2020 2020 2020 636f 6f72 6473 203d          coords =
-00010740: 205b 742c 2072 2c20 636f 6f72 6473 5b2d   [t, r, coords[-
-00010750: 315d 5d0a 0a20 2020 2020 2020 2069 6620  1]]..        if 
-00010760: 6361 6c6c 6162 6c65 2873 656c 662e 636f  callable(self.co
-00010770: 6c6f 725f 6675 6e63 293a 0a20 2020 2020  lor_func):.     
-00010780: 2020 2020 2020 2063 6f6f 7264 7320 3d20         coords = 
-00010790: 6c69 7374 2863 6f6f 7264 7329 0a20 2020  list(coords).   
-000107a0: 2020 2020 2020 2020 2063 6f6f 7264 735b           coords[
-000107b0: 2d31 5d20 3d20 7365 6c66 2e65 7661 6c5f  -1] = self.eval_
-000107c0: 636f 6c6f 725f 6675 6e63 282a 636f 6f72  color_func(*coor
-000107d0: 6473 290a 0a20 2020 2020 2020 2072 6574  ds)..        ret
-000107e0: 7572 6e20 636f 6f72 6473 0a0a 2020 2020  urn coords..    
-000107f0: 6465 6620 5f75 6e69 666f 726d 5f73 616d  def _uniform_sam
-00010800: 706c 696e 6728 7365 6c66 293a 0a20 2020  pling(self):.   
-00010810: 2020 2020 2022 2222 5265 7475 726e 7320       """Returns 
-00010820: 636f 6f72 6469 6e61 7465 7320 7468 6174  coordinates that
-00010830: 206e 6565 6473 2074 6f20 6265 2070 6f73   needs to be pos
-00010840: 7470 726f 6365 7373 6564 2e22 2222 0a20  tprocessed.""". 
-00010850: 2020 2020 2020 206e 7020 3d20 696d 706f         np = impo
-00010860: 7274 5f6d 6f64 756c 6528 276e 756d 7079  rt_module('numpy
-00010870: 2729 0a0a 2020 2020 2020 2020 7265 7375  ')..        resu
-00010880: 6c74 7320 3d20 7365 6c66 2e5f 6576 616c  lts = self._eval
-00010890: 7561 7465 2829 0a20 2020 2020 2020 2066  uate().        f
-000108a0: 6f72 2069 2c20 7220 696e 2065 6e75 6d65  or i, r in enume
-000108b0: 7261 7465 2872 6573 756c 7473 293a 0a20  rate(results):. 
-000108c0: 2020 2020 2020 2020 2020 205f 7265 2c20             _re, 
-000108d0: 5f69 6d20 3d20 6e70 2e72 6561 6c28 7229  _im = np.real(r)
-000108e0: 2c20 6e70 2e69 6d61 6728 7229 0a20 2020  , np.imag(r).   
-000108f0: 2020 2020 2020 2020 205f 7265 5b6e 702e           _re[np.
-00010900: 696e 7665 7274 286e 702e 6973 636c 6f73  invert(np.isclos
-00010910: 6528 5f69 6d2c 206e 702e 7a65 726f 735f  e(_im, np.zeros_
-00010920: 6c69 6b65 285f 696d 2929 295d 203d 206e  like(_im)))] = n
-00010930: 702e 6e61 6e0a 2020 2020 2020 2020 2020  p.nan.          
-00010940: 2020 7265 7375 6c74 735b 695d 203d 205f    results[i] = _
-00010950: 7265 0a0a 2020 2020 2020 2020 7265 7475  re..        retu
-00010960: 726e 205b 2a72 6573 756c 7473 5b31 3a5d  rn [*results[1:]
-00010970: 2c20 7265 7375 6c74 735b 305d 5d0a 0a0a  , results[0]]...
-00010980: 636c 6173 7320 5061 7261 6d65 7472 6963  class Parametric
-00010990: 3244 4c69 6e65 5365 7269 6573 2850 6172  2DLineSeries(Par
-000109a0: 616d 6574 7269 634c 696e 6542 6173 6553  ametricLineBaseS
-000109b0: 6572 6965 7329 3a0a 2020 2020 2222 2252  eries):.    """R
-000109c0: 6570 7265 7365 6e74 6174 696f 6e20 666f  epresentation fo
-000109d0: 7220 6120 6c69 6e65 2063 6f6e 7369 7374  r a line consist
-000109e0: 696e 6720 6f66 2074 776f 2070 6172 616d  ing of two param
-000109f0: 6574 7269 6320 7379 6d70 7920 6578 7072  etric sympy expr
-00010a00: 6573 7369 6f6e 730a 2020 2020 6f76 6572  essions.    over
-00010a10: 2061 2072 616e 6765 2e22 2222 0a0a 2020   a range."""..  
-00010a20: 2020 6973 5f70 6172 616d 6574 7269 6320    is_parametric 
-00010a30: 3d20 5472 7565 0a0a 2020 2020 6465 6620  = True..    def 
-00010a40: 5f5f 696e 6974 5f5f 2873 656c 662c 2065  __init__(self, e
-00010a50: 7870 725f 782c 2065 7870 725f 792c 2076  xpr_x, expr_y, v
-00010a60: 6172 5f73 7461 7274 5f65 6e64 2c20 6c61  ar_start_end, la
-00010a70: 6265 6c3d 2222 2c20 2a2a 6b77 6172 6773  bel="", **kwargs
-00010a80: 293a 0a20 2020 2020 2020 2073 7570 6572  ):.        super
-00010a90: 2829 2e5f 5f69 6e69 745f 5f28 2a2a 6b77  ().__init__(**kw
-00010aa0: 6172 6773 290a 2020 2020 2020 2020 7365  args).        se
-00010ab0: 6c66 2e65 7870 725f 7820 3d20 6578 7072  lf.expr_x = expr
-00010ac0: 5f78 2069 6620 6361 6c6c 6162 6c65 2865  _x if callable(e
-00010ad0: 7870 725f 7829 2065 6c73 6520 7379 6d70  xpr_x) else symp
-00010ae0: 6966 7928 6578 7072 5f78 290a 2020 2020  ify(expr_x).    
-00010af0: 2020 2020 7365 6c66 2e65 7870 725f 7920      self.expr_y 
-00010b00: 3d20 6578 7072 5f79 2069 6620 6361 6c6c  = expr_y if call
-00010b10: 6162 6c65 2865 7870 725f 7929 2065 6c73  able(expr_y) els
-00010b20: 6520 7379 6d70 6966 7928 6578 7072 5f79  e sympify(expr_y
-00010b30: 290a 2020 2020 2020 2020 7365 6c66 2e65  ).        self.e
-00010b40: 7870 7220 3d20 2873 656c 662e 6578 7072  xpr = (self.expr
-00010b50: 5f78 2c20 7365 6c66 2e65 7870 725f 7929  _x, self.expr_y)
-00010b60: 0a20 2020 2020 2020 2073 656c 662e 7261  .        self.ra
-00010b70: 6e67 6573 203d 205b 7661 725f 7374 6172  nges = [var_star
-00010b80: 745f 656e 645d 0a20 2020 2020 2020 2073  t_end].        s
-00010b90: 656c 662e 5f63 6173 7420 3d20 666c 6f61  elf._cast = floa
-00010ba0: 740a 2020 2020 2020 2020 7365 6c66 2e75  t.        self.u
-00010bb0: 7365 5f63 6d20 3d20 6b77 6172 6773 2e67  se_cm = kwargs.g
-00010bc0: 6574 2822 7573 655f 636d 222c 2054 7275  et("use_cm", Tru
-00010bd0: 6529 0a20 2020 2020 2020 2073 656c 662e  e).        self.
-00010be0: 5f73 6574 5f70 6172 616d 6574 7269 635f  _set_parametric_
-00010bf0: 6c69 6e65 5f6c 6162 656c 286c 6162 656c  line_label(label
-00010c00: 290a 2020 2020 2020 2020 7365 6c66 2e5f  ).        self._
-00010c10: 706f 7374 5f69 6e69 7428 290a 0a20 2020  post_init()..   
-00010c20: 2064 6566 205f 5f73 7472 5f5f 2873 656c   def __str__(sel
-00010c30: 6629 3a0a 2020 2020 2020 2020 7265 7475  f):.        retu
-00010c40: 726e 2073 656c 662e 5f73 7472 5f68 656c  rn self._str_hel
-00010c50: 7065 7228 0a20 2020 2020 2020 2020 2020  per(.           
-00010c60: 2022 7061 7261 6d65 7472 6963 2063 6172   "parametric car
-00010c70: 7465 7369 616e 206c 696e 653a 2028 2573  tesian line: (%s
-00010c80: 2c20 2573 2920 666f 7220 2573 206f 7665  , %s) for %s ove
-00010c90: 7220 2573 2220 2520 280a 2020 2020 2020  r %s" % (.      
-00010ca0: 2020 2020 2020 2020 2020 7374 7228 7365            str(se
-00010cb0: 6c66 2e65 7870 725f 7829 2c0a 2020 2020  lf.expr_x),.    
-00010cc0: 2020 2020 2020 2020 2020 2020 7374 7228              str(
-00010cd0: 7365 6c66 2e65 7870 725f 7929 2c0a 2020  self.expr_y),.  
-00010ce0: 2020 2020 2020 2020 2020 2020 2020 7374                st
-00010cf0: 7228 7365 6c66 2e76 6172 292c 0a20 2020  r(self.var),.   
-00010d00: 2020 2020 2020 2020 2020 2020 2073 7472               str
-00010d10: 2828 7365 6c66 2e73 7461 7274 2c20 7365  ((self.start, se
-00010d20: 6c66 2e65 6e64 2929 0a20 2020 2020 2020  lf.end)).       
-00010d30: 2020 2020 2029 0a20 2020 2020 2020 2029       ).        )
-00010d40: 0a0a 0a63 6c61 7373 2050 6172 616d 6574  ...class Paramet
-00010d50: 7269 6333 444c 696e 6553 6572 6965 7328  ric3DLineSeries(
-00010d60: 5061 7261 6d65 7472 6963 4c69 6e65 4261  ParametricLineBa
-00010d70: 7365 5365 7269 6573 293a 0a20 2020 2022  seSeries):.    "
-00010d80: 2222 5265 7072 6573 656e 7461 7469 6f6e  ""Representation
-00010d90: 2066 6f72 2061 2033 4420 6c69 6e65 2063   for a 3D line c
-00010da0: 6f6e 7369 7374 696e 6720 6f66 2074 6872  onsisting of thr
-00010db0: 6565 2070 6172 616d 6574 7269 6320 7379  ee parametric sy
-00010dc0: 6d70 790a 2020 2020 6578 7072 6573 7369  mpy.    expressi
-00010dd0: 6f6e 7320 616e 6420 6120 7261 6e67 652e  ons and a range.
-00010de0: 2222 220a 0a20 2020 2069 735f 3244 6c69  """..    is_2Dli
-00010df0: 6e65 203d 2046 616c 7365 0a20 2020 2069  ne = False.    i
-00010e00: 735f 3344 6c69 6e65 203d 2054 7275 650a  s_3Dline = True.
-00010e10: 0a20 2020 2064 6566 205f 5f69 6e69 745f  .    def __init_
-00010e20: 5f28 0a20 2020 2020 2020 2073 656c 662c  _(.        self,
-00010e30: 2065 7870 725f 782c 2065 7870 725f 792c   expr_x, expr_y,
-00010e40: 2065 7870 725f 7a2c 2076 6172 5f73 7461   expr_z, var_sta
-00010e50: 7274 5f65 6e64 2c20 6c61 6265 6c3d 2222  rt_end, label=""
-00010e60: 2c20 2a2a 6b77 6172 6773 0a20 2020 2029  , **kwargs.    )
-00010e70: 3a0a 2020 2020 2020 2020 7375 7065 7228  :.        super(
-00010e80: 292e 5f5f 696e 6974 5f5f 282a 2a6b 7761  ).__init__(**kwa
-00010e90: 7267 7329 0a20 2020 2020 2020 2073 656c  rgs).        sel
-00010ea0: 662e 6578 7072 5f78 203d 2065 7870 725f  f.expr_x = expr_
-00010eb0: 7820 6966 2063 616c 6c61 626c 6528 6578  x if callable(ex
-00010ec0: 7072 5f78 2920 656c 7365 2073 796d 7069  pr_x) else sympi
-00010ed0: 6679 2865 7870 725f 7829 0a20 2020 2020  fy(expr_x).     
-00010ee0: 2020 2073 656c 662e 6578 7072 5f79 203d     self.expr_y =
-00010ef0: 2065 7870 725f 7920 6966 2063 616c 6c61   expr_y if calla
-00010f00: 626c 6528 6578 7072 5f79 2920 656c 7365  ble(expr_y) else
-00010f10: 2073 796d 7069 6679 2865 7870 725f 7929   sympify(expr_y)
-00010f20: 0a20 2020 2020 2020 2073 656c 662e 6578  .        self.ex
-00010f30: 7072 5f7a 203d 2065 7870 725f 7a20 6966  pr_z = expr_z if
-00010f40: 2063 616c 6c61 626c 6528 6578 7072 5f7a   callable(expr_z
-00010f50: 2920 656c 7365 2073 796d 7069 6679 2865  ) else sympify(e
-00010f60: 7870 725f 7a29 0a20 2020 2020 2020 2073  xpr_z).        s
-00010f70: 656c 662e 6578 7072 203d 2028 7365 6c66  elf.expr = (self
-00010f80: 2e65 7870 725f 782c 2073 656c 662e 6578  .expr_x, self.ex
-00010f90: 7072 5f79 2c20 7365 6c66 2e65 7870 725f  pr_y, self.expr_
-00010fa0: 7a29 0a20 2020 2020 2020 2073 656c 662e  z).        self.
-00010fb0: 7261 6e67 6573 203d 205b 7661 725f 7374  ranges = [var_st
-00010fc0: 6172 745f 656e 645d 0a20 2020 2020 2020  art_end].       
-00010fd0: 2073 656c 662e 5f63 6173 7420 3d20 666c   self._cast = fl
-00010fe0: 6f61 740a 2020 2020 2020 2020 7365 6c66  oat.        self
-00010ff0: 2e75 7365 5f63 6d20 3d20 6b77 6172 6773  .use_cm = kwargs
-00011000: 2e67 6574 2822 7573 655f 636d 222c 2054  .get("use_cm", T
-00011010: 7275 6529 0a20 2020 2020 2020 2073 656c  rue).        sel
-00011020: 662e 5f73 6574 5f70 6172 616d 6574 7269  f._set_parametri
-00011030: 635f 6c69 6e65 5f6c 6162 656c 286c 6162  c_line_label(lab
-00011040: 656c 290a 2020 2020 2020 2020 7365 6c66  el).        self
-00011050: 2e5f 706f 7374 5f69 6e69 7428 290a 0a20  ._post_init().. 
-00011060: 2020 2064 6566 205f 5f73 7472 5f5f 2873     def __str__(s
-00011070: 656c 6629 3a0a 2020 2020 2020 2020 7265  elf):.        re
-00011080: 7475 726e 2073 656c 662e 5f73 7472 5f68  turn self._str_h
-00011090: 656c 7065 7228 0a20 2020 2020 2020 2020  elper(.         
-000110a0: 2020 2022 3344 2070 6172 616d 6574 7269     "3D parametri
-000110b0: 6320 6361 7274 6573 6961 6e20 6c69 6e65  c cartesian line
-000110c0: 3a20 2825 732c 2025 732c 2025 7329 2066  : (%s, %s, %s) f
-000110d0: 6f72 2025 7320 6f76 6572 2025 7322 2025  or %s over %s" %
-000110e0: 2028 0a20 2020 2020 2020 2020 2020 2073   (.            s
-000110f0: 7472 2873 656c 662e 6578 7072 5f78 292c  tr(self.expr_x),
-00011100: 0a20 2020 2020 2020 2020 2020 2073 7472  .            str
-00011110: 2873 656c 662e 6578 7072 5f79 292c 0a20  (self.expr_y),. 
-00011120: 2020 2020 2020 2020 2020 2073 7472 2873             str(s
-00011130: 656c 662e 6578 7072 5f7a 292c 0a20 2020  elf.expr_z),.   
-00011140: 2020 2020 2020 2020 2073 7472 2873 656c           str(sel
-00011150: 662e 7661 7229 2c0a 2020 2020 2020 2020  f.var),.        
-00011160: 2020 2020 7374 7228 2873 656c 662e 7374      str((self.st
-00011170: 6172 742c 2073 656c 662e 656e 6429 290a  art, self.end)).
-00011180: 2020 2020 2020 2020 2929 0a0a 0a63 6c61          ))...cla
-00011190: 7373 2053 7572 6661 6365 4261 7365 5365  ss SurfaceBaseSe
-000111a0: 7269 6573 2842 6173 6553 6572 6965 7329  ries(BaseSeries)
-000111b0: 3a0a 2020 2020 2222 2241 2062 6173 6520  :.    """A base 
-000111c0: 636c 6173 7320 666f 7220 3344 2073 7572  class for 3D sur
-000111d0: 6661 6365 732e 2222 220a 0a20 2020 2069  faces."""..    i
-000111e0: 735f 3344 7375 7266 6163 6520 3d20 5472  s_3Dsurface = Tr
-000111f0: 7565 0a20 2020 205f 616c 6c6f 7765 645f  ue.    _allowed_
-00011200: 6b65 7973 203d 205b 2273 7572 6661 6365  keys = ["surface
-00011210: 5f63 6f6c 6f72 222c 2022 6973 5f70 6f6c  _color", "is_pol
-00011220: 6172 225d 0a0a 2020 2020 6465 6620 5f5f  ar"]..    def __
-00011230: 696e 6974 5f5f 2873 656c 662c 202a 6172  init__(self, *ar
-00011240: 6773 2c20 2a2a 6b77 6172 6773 293a 0a20  gs, **kwargs):. 
-00011250: 2020 2020 2020 2073 7570 6572 2829 2e5f         super()._
-00011260: 5f69 6e69 745f 5f28 2a2a 6b77 6172 6773  _init__(**kwargs
-00011270: 290a 2020 2020 2020 2020 2320 4e4f 5445  ).        # NOTE
-00011280: 3a20 7768 7920 7368 6f75 6c64 2053 7572  : why should Sur
-00011290: 6661 6365 4f76 6572 3244 5261 6e67 6553  faceOver2DRangeS
-000112a0: 6572 6965 7320 7375 7070 6f72 7420 6973  eries support is
-000112b0: 2070 6f6c 6172 3f0a 2020 2020 2020 2020   polar?.        
-000112c0: 2320 4166 7465 7220 616c 6c2c 2074 6865  # After all, the
-000112d0: 2073 616d 6520 7265 7375 6c74 2063 616e   same result can
-000112e0: 2062 6520 6163 6869 6576 6520 7769 7468   be achieve with
-000112f0: 0a20 2020 2020 2020 2023 2050 6172 616d  .        # Param
-00011300: 6574 7269 6353 7572 6661 6365 5365 7269  etricSurfaceSeri
-00011310: 6573 2e20 466f 7220 6578 616d 706c 653a  es. For example:
-00011320: 0a20 2020 2020 2020 2023 2073 696e 2872  .        # sin(r
-00011330: 2920 666f 7220 2872 2c20 302c 2032 202a  ) for (r, 0, 2 *
-00011340: 2070 6929 2061 6e64 2028 7468 6574 612c   pi) and (theta,
-00011350: 2030 2c20 7069 2f32 2920 6361 6e20 6265   0, pi/2) can be
-00011360: 2070 6172 616d 6574 6572 697a 6564 0a20   parameterized. 
-00011370: 2020 2020 2020 2023 2061 7320 2872 202a         # as (r *
-00011380: 2063 6f73 2874 6865 7461 292c 2072 202a   cos(theta), r *
-00011390: 2073 696e 2874 6865 7461 292c 2073 696e   sin(theta), sin
-000113a0: 2874 2929 2066 6f72 2028 722c 2030 2c20  (t)) for (r, 0, 
-000113b0: 3220 2a20 7069 2920 616e 640a 2020 2020  2 * pi) and.    
-000113c0: 2020 2020 2320 2874 6865 7461 2c20 302c      # (theta, 0,
-000113d0: 2070 692f 3229 2e0a 2020 2020 2020 2020   pi/2)..        
-000113e0: 2320 4265 6361 7573 6520 6974 2069 7320  # Because it is 
-000113f0: 6661 7374 6572 2074 6f20 6576 616c 7561  faster to evalua
-00011400: 7465 2028 696d 706f 7274 616e 7420 666f  te (important fo
-00011410: 7220 696e 7465 7261 6374 6976 6520 706c  r interactive pl
-00011420: 6f74 7329 2e0a 2020 2020 2020 2020 7365  ots)..        se
-00011430: 6c66 2e69 735f 706f 6c61 7220 3d20 6b77  lf.is_polar = kw
-00011440: 6172 6773 2e67 6574 2822 6973 5f70 6f6c  args.get("is_pol
-00011450: 6172 222c 2046 616c 7365 290a 2020 2020  ar", False).    
-00011460: 2020 2020 7365 6c66 2e73 7572 6661 6365      self.surface
-00011470: 5f63 6f6c 6f72 203d 206b 7761 7267 732e  _color = kwargs.
-00011480: 6765 7428 2273 7572 6661 6365 5f63 6f6c  get("surface_col
-00011490: 6f72 222c 204e 6f6e 6529 0a20 2020 2020  or", None).     
-000114a0: 2020 2073 656c 662e 636f 6c6f 725f 6675     self.color_fu
-000114b0: 6e63 203d 206b 7761 7267 732e 6765 7428  nc = kwargs.get(
-000114c0: 2263 6f6c 6f72 5f66 756e 6322 2c20 6c61  "color_func", la
-000114d0: 6d62 6461 2078 2c20 792c 207a 3a20 7a29  mbda x, y, z: z)
-000114e0: 0a20 2020 2020 2020 2069 6620 6361 6c6c  .        if call
-000114f0: 6162 6c65 2873 656c 662e 7375 7266 6163  able(self.surfac
-00011500: 655f 636f 6c6f 7229 3a0a 2020 2020 2020  e_color):.      
-00011510: 2020 2020 2020 7365 6c66 2e63 6f6c 6f72        self.color
-00011520: 5f66 756e 6320 3d20 7365 6c66 2e73 7572  _func = self.sur
-00011530: 6661 6365 5f63 6f6c 6f72 0a20 2020 2020  face_color.     
-00011540: 2020 2020 2020 2073 656c 662e 7375 7266         self.surf
-00011550: 6163 655f 636f 6c6f 7220 3d20 4e6f 6e65  ace_color = None
-00011560: 0a0a 2020 2020 6465 6620 5f73 6574 5f73  ..    def _set_s
-00011570: 7572 6661 6365 5f6c 6162 656c 2873 656c  urface_label(sel
-00011580: 662c 206c 6162 656c 293a 0a20 2020 2020  f, label):.     
-00011590: 2020 2065 7870 7273 203d 2073 656c 662e     exprs = self.
-000115a0: 6578 7072 0a20 2020 2020 2020 2073 656c  expr.        sel
-000115b0: 662e 5f6c 6162 656c 203d 2073 7472 2865  f._label = str(e
-000115c0: 7870 7273 2920 6966 206c 6162 656c 2069  xprs) if label i
-000115d0: 7320 4e6f 6e65 2065 6c73 6520 6c61 6265  s None else labe
-000115e0: 6c0a 2020 2020 2020 2020 7365 6c66 2e5f  l.        self._
-000115f0: 6c61 7465 785f 6c61 6265 6c20 3d20 6c61  latex_label = la
-00011600: 7465 7828 6578 7072 7329 2069 6620 6c61  tex(exprs) if la
-00011610: 6265 6c20 6973 204e 6f6e 6520 656c 7365  bel is None else
-00011620: 206c 6162 656c 0a20 2020 2020 2020 2023   label.        #
-00011630: 2069 6620 7468 6520 6578 7072 6573 7369   if the expressi
-00011640: 6f6e 7320 6973 2061 206c 616d 6264 6120  ons is a lambda 
-00011650: 6675 6e63 7469 6f6e 2061 6e64 206e 6f20  function and no 
-00011660: 6c61 6265 6c0a 2020 2020 2020 2020 2320  label.        # 
-00011670: 6861 7320 6265 656e 2070 726f 7669 6465  has been provide
-00011680: 642c 2074 6865 6e20 6974 7320 6265 7474  d, then its bett
-00011690: 6572 2074 6f20 646f 2074 6865 2066 6f6c  er to do the fol
-000116a0: 6c6f 7769 6e67 2074 6f20 6176 6f69 640a  lowing to avoid.
-000116b0: 2020 2020 2020 2020 2320 7375 7072 6973          # supris
-000116c0: 6573 206f 6e20 7468 6520 6261 636b 656e  es on the backen
-000116d0: 640a 2020 2020 2020 2020 6973 5f6c 616d  d.        is_lam
-000116e0: 6264 6120 3d20 2863 616c 6c61 626c 6528  bda = (callable(
-000116f0: 6578 7072 7329 2069 6620 6e6f 7420 6861  exprs) if not ha
-00011700: 7361 7474 7228 6578 7072 732c 2022 5f5f  sattr(exprs, "__
-00011710: 6974 6572 5f5f 2229 0a20 2020 2020 2020  iter__").       
-00011720: 2020 2020 2065 6c73 6520 616e 7928 6361       else any(ca
-00011730: 6c6c 6162 6c65 2865 2920 666f 7220 6520  llable(e) for e 
-00011740: 696e 2065 7870 7273 2929 0a20 2020 2020  in exprs)).     
-00011750: 2020 2069 6620 6973 5f6c 616d 6264 6120     if is_lambda 
-00011760: 616e 6420 2873 656c 662e 5f6c 6162 656c  and (self._label
-00011770: 203d 3d20 7374 7228 6578 7072 7329 293a   == str(exprs)):
-00011780: 0a20 2020 2020 2020 2020 2020 2073 656c  .            sel
-00011790: 662e 5f6c 6162 656c 203d 2022 220a 2020  f._label = "".  
-000117a0: 2020 2020 2020 2020 2020 7365 6c66 2e5f            self._
-000117b0: 6c61 7465 785f 6c61 6265 6c20 3d20 2222  latex_label = ""
-000117c0: 0a0a 2020 2020 4070 726f 7065 7274 790a  ..    @property.
-000117d0: 2020 2020 6465 6620 7375 7266 6163 655f      def surface_
-000117e0: 636f 6c6f 7228 7365 6c66 293a 0a20 2020  color(self):.   
-000117f0: 2020 2020 2072 6574 7572 6e20 7365 6c66       return self
-00011800: 2e5f 7375 7266 6163 655f 636f 6c6f 720a  ._surface_color.
-00011810: 0a20 2020 2040 7375 7266 6163 655f 636f  .    @surface_co
-00011820: 6c6f 722e 7365 7474 6572 0a20 2020 2064  lor.setter.    d
-00011830: 6566 2073 7572 6661 6365 5f63 6f6c 6f72  ef surface_color
-00011840: 2873 656c 662c 2076 616c 293a 0a20 2020  (self, val):.   
-00011850: 2020 2020 2073 656c 662e 5f6c 696e 655f       self._line_
-00011860: 7375 7266 6163 655f 636f 6c6f 7228 225f  surface_color("_
-00011870: 7375 7266 6163 655f 636f 6c6f 7222 2c20  surface_color", 
-00011880: 7661 6c29 0a0a 0a63 6c61 7373 2053 7572  val)...class Sur
-00011890: 6661 6365 4f76 6572 3244 5261 6e67 6553  faceOver2DRangeS
-000118a0: 6572 6965 7328 0a20 2020 2043 6f6d 6d6f  eries(.    Commo
-000118b0: 6e41 6461 7074 6976 6545 7661 6c75 6174  nAdaptiveEvaluat
-000118c0: 696f 6e2c 2043 6f6d 6d6f 6e55 6e69 666f  ion, CommonUnifo
-000118d0: 726d 4576 616c 7561 7469 6f6e 2c20 5375  rmEvaluation, Su
-000118e0: 7266 6163 6542 6173 6553 6572 6965 730a  rfaceBaseSeries.
-000118f0: 293a 0a20 2020 2022 2222 5265 7072 6573  ):.    """Repres
-00011900: 656e 7461 7469 6f6e 2066 6f72 2061 2033  entation for a 3
-00011910: 4420 7375 7266 6163 6520 636f 6e73 6973  D surface consis
-00011920: 7469 6e67 206f 6620 6120 7379 6d70 7920  ting of a sympy 
-00011930: 6578 7072 6573 7369 6f6e 2061 6e64 2032  expression and 2
-00011940: 440a 2020 2020 7261 6e67 652e 2222 220a  D.    range.""".
-00011950: 0a20 2020 2064 6566 205f 5f69 6e69 745f  .    def __init_
-00011960: 5f28 0a20 2020 2020 2020 2073 656c 662c  _(.        self,
-00011970: 2065 7870 722c 2076 6172 5f73 7461 7274   expr, var_start
-00011980: 5f65 6e64 5f78 2c20 7661 725f 7374 6172  _end_x, var_star
-00011990: 745f 656e 645f 792c 206c 6162 656c 3d22  t_end_y, label="
-000119a0: 222c 202a 2a6b 7761 7267 730a 2020 2020  ", **kwargs.    
-000119b0: 293a 0a20 2020 2020 2020 2073 7570 6572  ):.        super
-000119c0: 2829 2e5f 5f69 6e69 745f 5f28 2a2a 6b77  ().__init__(**kw
-000119d0: 6172 6773 290a 2020 2020 2020 2020 7365  args).        se
-000119e0: 6c66 2e65 7870 7220 3d20 6578 7072 2069  lf.expr = expr i
-000119f0: 6620 6361 6c6c 6162 6c65 2865 7870 7229  f callable(expr)
-00011a00: 2065 6c73 6520 7379 6d70 6966 7928 6578   else sympify(ex
-00011a10: 7072 290a 2020 2020 2020 2020 7365 6c66  pr).        self
-00011a20: 2e72 616e 6765 7320 3d20 5b76 6172 5f73  .ranges = [var_s
-00011a30: 7461 7274 5f65 6e64 5f78 2c20 7661 725f  tart_end_x, var_
-00011a40: 7374 6172 745f 656e 645f 795d 0a20 2020  start_end_y].   
-00011a50: 2020 2020 2073 656c 662e 5f73 6574 5f73       self._set_s
-00011a60: 7572 6661 6365 5f6c 6162 656c 286c 6162  urface_label(lab
-00011a70: 656c 290a 2020 2020 2020 2020 7365 6c66  el).        self
-00011a80: 2e5f 706f 7374 5f69 6e69 7428 290a 0a20  ._post_init().. 
-00011a90: 2020 2040 7072 6f70 6572 7479 0a20 2020     @property.   
-00011aa0: 2064 6566 2076 6172 5f78 2873 656c 6629   def var_x(self)
-00011ab0: 3a0a 2020 2020 2020 2020 7265 7475 726e  :.        return
-00011ac0: 2073 656c 662e 7261 6e67 6573 5b30 5d5b   self.ranges[0][
-00011ad0: 305d 0a0a 2020 2020 4070 726f 7065 7274  0]..    @propert
-00011ae0: 790a 2020 2020 6465 6620 7661 725f 7928  y.    def var_y(
-00011af0: 7365 6c66 293a 0a20 2020 2020 2020 2072  self):.        r
-00011b00: 6574 7572 6e20 7365 6c66 2e72 616e 6765  eturn self.range
-00011b10: 735b 315d 5b30 5d0a 0a20 2020 2040 7072  s[1][0]..    @pr
-00011b20: 6f70 6572 7479 0a20 2020 2064 6566 2073  operty.    def s
-00011b30: 7461 7274 5f78 2873 656c 6629 3a0a 2020  tart_x(self):.  
-00011b40: 2020 2020 2020 7472 793a 0a20 2020 2020        try:.     
-00011b50: 2020 2020 2020 2072 6574 7572 6e20 666c         return fl
-00011b60: 6f61 7428 7365 6c66 2e72 616e 6765 735b  oat(self.ranges[
-00011b70: 305d 5b31 5d29 0a20 2020 2020 2020 2065  0][1]).        e
-00011b80: 7863 6570 7420 4578 6365 7074 696f 6e3a  xcept Exception:
-00011b90: 0a20 2020 2020 2020 2020 2020 2072 6574  .            ret
-00011ba0: 7572 6e20 7365 6c66 2e72 616e 6765 735b  urn self.ranges[
-00011bb0: 305d 5b31 5d0a 0a20 2020 2040 7072 6f70  0][1]..    @prop
-00011bc0: 6572 7479 0a20 2020 2064 6566 2065 6e64  erty.    def end
-00011bd0: 5f78 2873 656c 6629 3a0a 2020 2020 2020  _x(self):.      
-00011be0: 2020 7472 793a 0a20 2020 2020 2020 2020    try:.         
-00011bf0: 2020 2072 6574 7572 6e20 666c 6f61 7428     return float(
-00011c00: 7365 6c66 2e72 616e 6765 735b 305d 5b32  self.ranges[0][2
-00011c10: 5d29 0a20 2020 2020 2020 2065 7863 6570  ]).        excep
-00011c20: 7420 4578 6365 7074 696f 6e3a 0a20 2020  t Exception:.   
-00011c30: 2020 2020 2020 2020 2072 6574 7572 6e20           return 
-00011c40: 7365 6c66 2e72 616e 6765 735b 305d 5b32  self.ranges[0][2
-00011c50: 5d0a 0a20 2020 2040 7072 6f70 6572 7479  ]..    @property
-00011c60: 0a20 2020 2064 6566 2073 7461 7274 5f79  .    def start_y
-00011c70: 2873 656c 6629 3a0a 2020 2020 2020 2020  (self):.        
-00011c80: 7472 793a 0a20 2020 2020 2020 2020 2020  try:.           
-00011c90: 2072 6574 7572 6e20 666c 6f61 7428 7365   return float(se
-00011ca0: 6c66 2e72 616e 6765 735b 315d 5b31 5d29  lf.ranges[1][1])
-00011cb0: 0a20 2020 2020 2020 2065 7863 6570 7420  .        except 
-00011cc0: 4578 6365 7074 696f 6e3a 0a20 2020 2020  Exception:.     
-00011cd0: 2020 2020 2020 2072 6574 7572 6e20 7365         return se
-00011ce0: 6c66 2e72 616e 6765 735b 315d 5b31 5d0a  lf.ranges[1][1].
-00011cf0: 0a20 2020 2040 7072 6f70 6572 7479 0a20  .    @property. 
-00011d00: 2020 2064 6566 2065 6e64 5f79 2873 656c     def end_y(sel
-00011d10: 6629 3a0a 2020 2020 2020 2020 7472 793a  f):.        try:
-00011d20: 0a20 2020 2020 2020 2020 2020 2072 6574  .            ret
-00011d30: 7572 6e20 666c 6f61 7428 7365 6c66 2e72  urn float(self.r
-00011d40: 616e 6765 735b 315d 5b32 5d29 0a20 2020  anges[1][2]).   
-00011d50: 2020 2020 2065 7863 6570 7420 4578 6365       except Exce
-00011d60: 7074 696f 6e3a 0a20 2020 2020 2020 2020  ption:.         
-00011d70: 2020 2072 6574 7572 6e20 7365 6c66 2e72     return self.r
-00011d80: 616e 6765 735b 315d 5b32 5d0a 0a20 2020  anges[1][2]..   
-00011d90: 2064 6566 205f 5f73 7472 5f5f 2873 656c   def __str__(sel
-00011da0: 6629 3a0a 2020 2020 2020 2020 7365 7269  f):.        seri
-00011db0: 6573 5f74 7970 6520 3d20 2263 6172 7465  es_type = "carte
-00011dc0: 7369 616e 2073 7572 6661 6365 2220 6966  sian surface" if
-00011dd0: 2073 656c 662e 6973 5f33 4473 7572 6661   self.is_3Dsurfa
-00011de0: 6365 2065 6c73 6520 2263 6f6e 746f 7572  ce else "contour
-00011df0: 220a 2020 2020 2020 2020 7265 7475 726e  ".        return
-00011e00: 2073 656c 662e 5f73 7472 5f68 656c 7065   self._str_helpe
-00011e10: 7228 0a20 2020 2020 2020 2020 2020 2073  r(.            s
-00011e20: 6572 6965 735f 7479 7065 202b 2022 3a20  eries_type + ": 
-00011e30: 2573 2066 6f72 2220 2220 2573 206f 7665  %s for" " %s ove
-00011e40: 7220 2573 2061 6e64 2025 7320 6f76 6572  r %s and %s over
-00011e50: 2025 7322 2025 2028 0a20 2020 2020 2020   %s" % (.       
-00011e60: 2020 2020 2020 2020 2073 7472 2873 656c           str(sel
-00011e70: 662e 6578 7072 292c 0a20 2020 2020 2020  f.expr),.       
-00011e80: 2020 2020 2020 2020 2073 7472 2873 656c           str(sel
-00011e90: 662e 7661 725f 7829 2c20 7374 7228 2873  f.var_x), str((s
-00011ea0: 656c 662e 7374 6172 745f 782c 2073 656c  elf.start_x, sel
-00011eb0: 662e 656e 645f 7829 292c 0a20 2020 2020  f.end_x)),.     
-00011ec0: 2020 2020 2020 2020 2020 2073 7472 2873             str(s
-00011ed0: 656c 662e 7661 725f 7929 2c20 7374 7228  elf.var_y), str(
-00011ee0: 2873 656c 662e 7374 6172 745f 792c 2073  (self.start_y, s
-00011ef0: 656c 662e 656e 645f 7929 292c 0a20 2020  elf.end_y)),.   
-00011f00: 2020 2020 2020 2020 2029 0a20 2020 2020           ).     
-00011f10: 2020 2029 0a0a 2020 2020 6465 6620 5f61     )..    def _a
-00011f20: 6461 7074 6976 655f 7361 6d70 6c69 6e67  daptive_sampling
-00011f30: 2873 656c 6629 3a0a 2020 2020 2020 2020  (self):.        
-00011f40: 6e70 203d 2069 6d70 6f72 745f 6d6f 6475  np = import_modu
-00011f50: 6c65 2827 6e75 6d70 7927 290a 0a20 2020  le('numpy')..   
-00011f60: 2020 2020 2064 6566 2066 756e 6328 662c       def func(f,
-00011f70: 2078 7929 3a0a 2020 2020 2020 2020 2020   xy):.          
-00011f80: 2020 7472 793a 0a20 2020 2020 2020 2020    try:.         
-00011f90: 2020 2020 2020 2077 203d 2066 282a 5b63         w = f(*[c
-00011fa0: 6f6d 706c 6578 2874 2920 666f 7220 7420  omplex(t) for t 
-00011fb0: 696e 2078 795d 290a 2020 2020 2020 2020  in xy]).        
-00011fc0: 2020 2020 2020 2020 7265 7475 726e 2077          return w
-00011fd0: 2e72 6561 6c20 6966 206e 702e 6973 636c  .real if np.iscl
-00011fe0: 6f73 6528 772e 696d 6167 2c20 3029 2065  ose(w.imag, 0) e
-00011ff0: 6c73 6520 6e70 2e6e 616e 0a20 2020 2020  lse np.nan.     
-00012000: 2020 2020 2020 2065 7863 6570 7420 285a         except (Z
-00012010: 6572 6f44 6976 6973 696f 6e45 7272 6f72  eroDivisionError
-00012020: 2c20 4f76 6572 666c 6f77 4572 726f 7229  , OverflowError)
-00012030: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-00012040: 2020 7265 7475 726e 206e 702e 6e61 6e0a    return np.nan.
-00012050: 0a20 2020 2020 2020 2072 6574 7572 6e20  .        return 
-00012060: 5f61 6461 7074 6976 655f 6576 616c 280a  _adaptive_eval(.
-00012070: 2020 2020 2020 2020 2020 2020 6675 6e63              func
-00012080: 2c20 5b73 656c 662e 7661 725f 782c 2073  , [self.var_x, s
-00012090: 656c 662e 7661 725f 795d 2c20 7365 6c66  elf.var_y], self
-000120a0: 2e65 7870 722c 0a20 2020 2020 2020 2020  .expr,.         
-000120b0: 2020 205b 2873 656c 662e 7374 6172 745f     [(self.start_
-000120c0: 782c 2073 656c 662e 656e 645f 7829 2c20  x, self.end_x), 
-000120d0: 2873 656c 662e 7374 6172 745f 792c 2073  (self.start_y, s
-000120e0: 656c 662e 656e 645f 7929 5d2c 0a20 2020  elf.end_y)],.   
-000120f0: 2020 2020 2020 2020 206d 6f64 756c 6573           modules
-00012100: 3d73 656c 662e 6d6f 6475 6c65 732c 0a20  =self.modules,. 
-00012110: 2020 2020 2020 2020 2020 2061 6461 7074             adapt
-00012120: 6976 655f 676f 616c 3d73 656c 662e 6164  ive_goal=self.ad
-00012130: 6170 7469 7665 5f67 6f61 6c2c 0a20 2020  aptive_goal,.   
-00012140: 2020 2020 2020 2020 206c 6f73 735f 666e           loss_fn
-00012150: 3d73 656c 662e 6c6f 7373 5f66 6e29 0a0a  =self.loss_fn)..
-00012160: 2020 2020 6465 6620 5f75 6e69 666f 726d      def _uniform
-00012170: 5f73 616d 706c 696e 6728 7365 6c66 293a  _sampling(self):
-00012180: 0a20 2020 2020 2020 206e 7020 3d20 696d  .        np = im
-00012190: 706f 7274 5f6d 6f64 756c 6528 276e 756d  port_module('num
-000121a0: 7079 2729 0a0a 2020 2020 2020 2020 7265  py')..        re
-000121b0: 7375 6c74 7320 3d20 7365 6c66 2e5f 6576  sults = self._ev
-000121c0: 616c 7561 7465 2829 0a20 2020 2020 2020  aluate().       
-000121d0: 2066 6f72 2069 2c20 7220 696e 2065 6e75   for i, r in enu
-000121e0: 6d65 7261 7465 2872 6573 756c 7473 293a  merate(results):
-000121f0: 0a20 2020 2020 2020 2020 2020 205f 7265  .            _re
-00012200: 2c20 5f69 6d20 3d20 6e70 2e72 6561 6c28  , _im = np.real(
-00012210: 7229 2c20 6e70 2e69 6d61 6728 7229 0a20  r), np.imag(r). 
-00012220: 2020 2020 2020 2020 2020 205f 7265 5b6e             _re[n
-00012230: 702e 696e 7665 7274 286e 702e 6973 636c  p.invert(np.iscl
-00012240: 6f73 6528 5f69 6d2c 206e 702e 7a65 726f  ose(_im, np.zero
-00012250: 735f 6c69 6b65 285f 696d 2929 295d 203d  s_like(_im)))] =
-00012260: 206e 702e 6e61 6e0a 2020 2020 2020 2020   np.nan.        
-00012270: 2020 2020 7265 7375 6c74 735b 695d 203d      results[i] =
-00012280: 205f 7265 0a0a 2020 2020 2020 2020 7265   _re..        re
-00012290: 7475 726e 2072 6573 756c 7473 0a0a 2020  turn results..  
-000122a0: 2020 6465 6620 6765 745f 6461 7461 2873    def get_data(s
-000122b0: 656c 6629 3a0a 2020 2020 2020 2020 2222  elf):.        ""
-000122c0: 2252 6574 7572 6e20 6172 7261 7973 206f  "Return arrays o
-000122d0: 6620 636f 6f72 6469 6e61 7465 7320 666f  f coordinates fo
-000122e0: 7220 706c 6f74 7469 6e67 2e20 4465 7065  r plotting. Depe
-000122f0: 6e64 696e 6720 6f6e 2074 6865 0a20 2020  nding on the.   
-00012300: 2020 2020 2060 6164 6170 7469 7665 6020       `adaptive` 
-00012310: 6f70 7469 6f6e 2c20 7468 6973 2066 756e  option, this fun
-00012320: 6374 696f 6e20 7769 6c6c 2065 6974 6865  ction will eithe
-00012330: 7220 7573 6520 616e 2061 6461 7074 6976  r use an adaptiv
-00012340: 6520 616c 676f 7269 7468 6d0a 2020 2020  e algorithm.    
-00012350: 2020 2020 6f72 2069 7420 7769 6c6c 2075      or it will u
-00012360: 6e69 666f 726d 6c79 2073 616d 706c 6520  niformly sample 
-00012370: 7468 6520 6578 7072 6573 7369 6f6e 206f  the expression o
-00012380: 7665 7220 7468 6520 7072 6f76 6964 6564  ver the provided
-00012390: 2072 616e 6765 2e0a 0a20 2020 2020 2020   range...       
-000123a0: 2052 6574 7572 6e73 0a20 2020 2020 2020   Returns.       
-000123b0: 203d 3d3d 3d3d 3d3d 0a0a 2020 2020 2020   =======..      
-000123c0: 2020 6d65 7368 5f78 203a 206e 702e 6e64    mesh_x : np.nd
-000123d0: 6172 7261 7920 5b6e 3220 7820 6e31 5d0a  array [n2 x n1].
-000123e0: 2020 2020 2020 2020 2020 2020 5265 616c              Real
-000123f0: 2044 6973 6372 6574 697a 6564 2078 2d64   Discretized x-d
-00012400: 6f6d 6169 6e2e 0a0a 2020 2020 2020 2020  omain...        
-00012410: 6d65 7368 5f79 203a 206e 702e 6e64 6172  mesh_y : np.ndar
-00012420: 7261 7920 5b6e 3220 7820 6e31 5d0a 2020  ray [n2 x n1].  
-00012430: 2020 2020 2020 2020 2020 5265 616c 2044            Real D
-00012440: 6973 6372 6574 697a 6564 2079 2d64 6f6d  iscretized y-dom
-00012450: 6169 6e2e 0a0a 2020 2020 2020 2020 7a20  ain...        z 
-00012460: 3a20 6e70 2e6e 6461 7272 6179 205b 6e32  : np.ndarray [n2
-00012470: 2078 206e 315d 0a20 2020 2020 2020 2020   x n1].         
-00012480: 2020 2052 6573 756c 7473 206f 6620 7468     Results of th
-00012490: 6520 6576 616c 7561 7469 6f6e 2e0a 2020  e evaluation..  
-000124a0: 2020 2020 2020 2222 220a 2020 2020 2020        """.      
-000124b0: 2020 6e70 203d 2069 6d70 6f72 745f 6d6f    np = import_mo
-000124c0: 6475 6c65 2827 6e75 6d70 7927 290a 0a20  dule('numpy').. 
-000124d0: 2020 2020 2020 2069 6620 7365 6c66 2e61         if self.a
-000124e0: 6461 7074 6976 653a 0a20 2020 2020 2020  daptive:.       
-000124f0: 2020 2020 2072 6573 203d 2073 656c 662e       res = self.
-00012500: 5f61 6461 7074 6976 655f 7361 6d70 6c69  _adaptive_sampli
-00012510: 6e67 2829 0a20 2020 2020 2020 2065 6c73  ng().        els
-00012520: 653a 0a20 2020 2020 2020 2020 2020 2072  e:.            r
-00012530: 6573 203d 2073 656c 662e 5f75 6e69 666f  es = self._unifo
-00012540: 726d 5f73 616d 706c 696e 6728 290a 0a20  rm_sampling().. 
-00012550: 2020 2020 2020 2078 2c20 792c 207a 203d         x, y, z =
-00012560: 2072 6573 0a20 2020 2020 2020 2069 6620   res.        if 
-00012570: 7365 6c66 2e69 735f 706f 6c61 7220 616e  self.is_polar an
-00012580: 6420 7365 6c66 2e69 735f 3344 7375 7266  d self.is_3Dsurf
-00012590: 6163 653a 0a20 2020 2020 2020 2020 2020  ace:.           
-000125a0: 2072 203d 2078 2e63 6f70 7928 290a 2020   r = x.copy().  
-000125b0: 2020 2020 2020 2020 2020 7820 3d20 7220            x = r 
-000125c0: 2a20 6e70 2e63 6f73 2879 290a 2020 2020  * np.cos(y).    
-000125d0: 2020 2020 2020 2020 7920 3d20 7220 2a20          y = r * 
-000125e0: 6e70 2e73 696e 2879 290a 0a20 2020 2020  np.sin(y)..     
-000125f0: 2020 2072 6574 7572 6e20 7365 6c66 2e5f     return self._
-00012600: 6170 706c 795f 7472 616e 7366 6f72 6d28  apply_transform(
-00012610: 782c 2079 2c20 7a29 0a0a 0a63 6c61 7373  x, y, z)...class
-00012620: 2050 6172 616d 6574 7269 6353 7572 6661   ParametricSurfa
-00012630: 6365 5365 7269 6573 280a 2020 2020 436f  ceSeries(.    Co
-00012640: 6d6d 6f6e 556e 6966 6f72 6d45 7661 6c75  mmonUniformEvalu
-00012650: 6174 696f 6e2c 2053 7572 6661 6365 4261  ation, SurfaceBa
-00012660: 7365 5365 7269 6573 0a29 3a0a 2020 2020  seSeries.):.    
-00012670: 2222 2252 6570 7265 7365 6e74 6174 696f  """Representatio
-00012680: 6e20 666f 7220 6120 3344 2073 7572 6661  n for a 3D surfa
-00012690: 6365 2063 6f6e 7369 7374 696e 6720 6f66  ce consisting of
-000126a0: 2074 6872 6565 2070 6172 616d 6574 7269   three parametri
-000126b0: 6320 7379 6d70 790a 2020 2020 6578 7072  c sympy.    expr
-000126c0: 6573 7369 6f6e 7320 616e 6420 6120 7261  essions and a ra
-000126d0: 6e67 652e 2222 220a 0a20 2020 2069 735f  nge."""..    is_
-000126e0: 7061 7261 6d65 7472 6963 203d 2054 7275  parametric = Tru
-000126f0: 650a 0a20 2020 2064 6566 205f 5f69 6e69  e..    def __ini
-00012700: 745f 5f28 0a20 2020 2020 2020 2073 656c  t__(.        sel
-00012710: 662c 2065 7870 725f 782c 2065 7870 725f  f, expr_x, expr_
-00012720: 792c 2065 7870 725f 7a2c 0a20 2020 2020  y, expr_z,.     
-00012730: 2020 2076 6172 5f73 7461 7274 5f65 6e64     var_start_end
-00012740: 5f75 2c20 7661 725f 7374 6172 745f 656e  _u, var_start_en
-00012750: 645f 762c 206c 6162 656c 3d22 222c 202a  d_v, label="", *
-00012760: 2a6b 7761 7267 730a 2020 2020 293a 0a20  *kwargs.    ):. 
-00012770: 2020 2020 2020 2073 7570 6572 2829 2e5f         super()._
-00012780: 5f69 6e69 745f 5f28 2a2a 6b77 6172 6773  _init__(**kwargs
-00012790: 290a 2020 2020 2020 2020 7365 6c66 2e65  ).        self.e
-000127a0: 7870 725f 7820 3d20 6578 7072 5f78 2069  xpr_x = expr_x i
-000127b0: 6620 6361 6c6c 6162 6c65 2865 7870 725f  f callable(expr_
-000127c0: 7829 2065 6c73 6520 7379 6d70 6966 7928  x) else sympify(
-000127d0: 6578 7072 5f78 290a 2020 2020 2020 2020  expr_x).        
-000127e0: 7365 6c66 2e65 7870 725f 7920 3d20 6578  self.expr_y = ex
-000127f0: 7072 5f79 2069 6620 6361 6c6c 6162 6c65  pr_y if callable
-00012800: 2865 7870 725f 7929 2065 6c73 6520 7379  (expr_y) else sy
-00012810: 6d70 6966 7928 6578 7072 5f79 290a 2020  mpify(expr_y).  
-00012820: 2020 2020 2020 7365 6c66 2e65 7870 725f        self.expr_
-00012830: 7a20 3d20 6578 7072 5f7a 2069 6620 6361  z = expr_z if ca
-00012840: 6c6c 6162 6c65 2865 7870 725f 7a29 2065  llable(expr_z) e
-00012850: 6c73 6520 7379 6d70 6966 7928 6578 7072  lse sympify(expr
-00012860: 5f7a 290a 2020 2020 2020 2020 7365 6c66  _z).        self
-00012870: 2e65 7870 7220 3d20 2873 656c 662e 6578  .expr = (self.ex
-00012880: 7072 5f78 2c20 7365 6c66 2e65 7870 725f  pr_x, self.expr_
-00012890: 792c 2073 656c 662e 6578 7072 5f7a 290a  y, self.expr_z).
-000128a0: 2020 2020 2020 2020 7365 6c66 2e72 616e          self.ran
-000128b0: 6765 7320 3d20 5b76 6172 5f73 7461 7274  ges = [var_start
-000128c0: 5f65 6e64 5f75 2c20 7661 725f 7374 6172  _end_u, var_star
-000128d0: 745f 656e 645f 765d 0a20 2020 2020 2020  t_end_v].       
-000128e0: 2073 656c 662e 636f 6c6f 725f 6675 6e63   self.color_func
-000128f0: 203d 206b 7761 7267 732e 6765 7428 2263   = kwargs.get("c
-00012900: 6f6c 6f72 5f66 756e 6322 2c20 6c61 6d62  olor_func", lamb
-00012910: 6461 2078 2c20 792c 207a 2c20 752c 2076  da x, y, z, u, v
-00012920: 3a20 7a29 0a20 2020 2020 2020 2073 656c  : z).        sel
-00012930: 662e 5f73 6574 5f73 7572 6661 6365 5f6c  f._set_surface_l
-00012940: 6162 656c 286c 6162 656c 290a 2020 2020  abel(label).    
-00012950: 2020 2020 7365 6c66 2e5f 706f 7374 5f69      self._post_i
-00012960: 6e69 7428 290a 0a20 2020 2040 7072 6f70  nit()..    @prop
-00012970: 6572 7479 0a20 2020 2064 6566 2076 6172  erty.    def var
-00012980: 5f75 2873 656c 6629 3a0a 2020 2020 2020  _u(self):.      
-00012990: 2020 7265 7475 726e 2073 656c 662e 7261    return self.ra
-000129a0: 6e67 6573 5b30 5d5b 305d 0a0a 2020 2020  nges[0][0]..    
-000129b0: 4070 726f 7065 7274 790a 2020 2020 6465  @property.    de
-000129c0: 6620 7661 725f 7628 7365 6c66 293a 0a20  f var_v(self):. 
-000129d0: 2020 2020 2020 2072 6574 7572 6e20 7365         return se
-000129e0: 6c66 2e72 616e 6765 735b 315d 5b30 5d0a  lf.ranges[1][0].
-000129f0: 0a20 2020 2040 7072 6f70 6572 7479 0a20  .    @property. 
-00012a00: 2020 2064 6566 2073 7461 7274 5f75 2873     def start_u(s
-00012a10: 656c 6629 3a0a 2020 2020 2020 2020 7472  elf):.        tr
-00012a20: 793a 0a20 2020 2020 2020 2020 2020 2072  y:.            r
-00012a30: 6574 7572 6e20 666c 6f61 7428 7365 6c66  eturn float(self
-00012a40: 2e72 616e 6765 735b 305d 5b31 5d29 0a20  .ranges[0][1]). 
-00012a50: 2020 2020 2020 2065 7863 6570 7420 4578         except Ex
-00012a60: 6365 7074 696f 6e3a 0a20 2020 2020 2020  ception:.       
-00012a70: 2020 2020 2072 6574 7572 6e20 7365 6c66       return self
-00012a80: 2e72 616e 6765 735b 305d 5b31 5d0a 0a20  .ranges[0][1].. 
-00012a90: 2020 2040 7072 6f70 6572 7479 0a20 2020     @property.   
-00012aa0: 2064 6566 2065 6e64 5f75 2873 656c 6629   def end_u(self)
-00012ab0: 3a0a 2020 2020 2020 2020 7472 793a 0a20  :.        try:. 
-00012ac0: 2020 2020 2020 2020 2020 2072 6574 7572             retur
-00012ad0: 6e20 666c 6f61 7428 7365 6c66 2e72 616e  n float(self.ran
-00012ae0: 6765 735b 305d 5b32 5d29 0a20 2020 2020  ges[0][2]).     
-00012af0: 2020 2065 7863 6570 7420 4578 6365 7074     except Except
-00012b00: 696f 6e3a 0a20 2020 2020 2020 2020 2020  ion:.           
-00012b10: 2072 6574 7572 6e20 7365 6c66 2e72 616e   return self.ran
-00012b20: 6765 735b 305d 5b32 5d0a 0a20 2020 2040  ges[0][2]..    @
-00012b30: 7072 6f70 6572 7479 0a20 2020 2064 6566  property.    def
-00012b40: 2073 7461 7274 5f76 2873 656c 6629 3a0a   start_v(self):.
-00012b50: 2020 2020 2020 2020 7472 793a 0a20 2020          try:.   
-00012b60: 2020 2020 2020 2020 2072 6574 7572 6e20           return 
-00012b70: 666c 6f61 7428 7365 6c66 2e72 616e 6765  float(self.range
-00012b80: 735b 315d 5b31 5d29 0a20 2020 2020 2020  s[1][1]).       
-00012b90: 2065 7863 6570 7420 4578 6365 7074 696f   except Exceptio
-00012ba0: 6e3a 0a20 2020 2020 2020 2020 2020 2072  n:.            r
-00012bb0: 6574 7572 6e20 7365 6c66 2e72 616e 6765  eturn self.range
-00012bc0: 735b 315d 5b31 5d0a 0a20 2020 2040 7072  s[1][1]..    @pr
-00012bd0: 6f70 6572 7479 0a20 2020 2064 6566 2065  operty.    def e
-00012be0: 6e64 5f76 2873 656c 6629 3a0a 2020 2020  nd_v(self):.    
-00012bf0: 2020 2020 7472 793a 0a20 2020 2020 2020      try:.       
-00012c00: 2020 2020 2072 6574 7572 6e20 666c 6f61       return floa
-00012c10: 7428 7365 6c66 2e72 616e 6765 735b 315d  t(self.ranges[1]
-00012c20: 5b32 5d29 0a20 2020 2020 2020 2065 7863  [2]).        exc
-00012c30: 6570 7420 4578 6365 7074 696f 6e3a 0a20  ept Exception:. 
-00012c40: 2020 2020 2020 2020 2020 2072 6574 7572             retur
-00012c50: 6e20 7365 6c66 2e72 616e 6765 735b 315d  n self.ranges[1]
-00012c60: 5b32 5d0a 0a20 2020 2064 6566 205f 5f73  [2]..    def __s
-00012c70: 7472 5f5f 2873 656c 6629 3a0a 2020 2020  tr__(self):.    
-00012c80: 2020 2020 7265 7475 726e 2073 656c 662e      return self.
-00012c90: 5f73 7472 5f68 656c 7065 7228 0a20 2020  _str_helper(.   
-00012ca0: 2020 2020 2020 2020 2022 7061 7261 6d65           "parame
-00012cb0: 7472 6963 2063 6172 7465 7369 616e 2073  tric cartesian s
-00012cc0: 7572 6661 6365 3a20 2825 732c 2025 732c  urface: (%s, %s,
-00012cd0: 2025 7329 2066 6f72 220a 2020 2020 2020   %s) for".      
-00012ce0: 2020 2020 2020 2220 2573 206f 7665 7220        " %s over 
-00012cf0: 2573 2061 6e64 2025 7320 6f76 6572 2025  %s and %s over %
-00012d00: 7322 2025 2028 0a20 2020 2020 2020 2020  s" % (.         
-00012d10: 2020 2020 2020 2073 7472 2873 656c 662e         str(self.
-00012d20: 6578 7072 5f78 292c 2073 7472 2873 656c  expr_x), str(sel
-00012d30: 662e 6578 7072 5f79 292c 2073 7472 2873  f.expr_y), str(s
-00012d40: 656c 662e 6578 7072 5f7a 292c 0a20 2020  elf.expr_z),.   
-00012d50: 2020 2020 2020 2020 2020 2020 2073 7472               str
-00012d60: 2873 656c 662e 7661 725f 7529 2c20 7374  (self.var_u), st
-00012d70: 7228 2873 656c 662e 7374 6172 745f 752c  r((self.start_u,
-00012d80: 2073 656c 662e 656e 645f 7529 292c 0a20   self.end_u)),. 
-00012d90: 2020 2020 2020 2020 2020 2020 2020 2073                 s
-00012da0: 7472 2873 656c 662e 7661 725f 7629 2c20  tr(self.var_v), 
-00012db0: 7374 7228 2873 656c 662e 7374 6172 745f  str((self.start_
-00012dc0: 762c 2073 656c 662e 656e 645f 7629 292c  v, self.end_v)),
-00012dd0: 0a20 2020 2020 2020 2020 2020 2029 0a20  .            ). 
-00012de0: 2020 2020 2020 2029 0a0a 2020 2020 6465         )..    de
-00012df0: 6620 6765 745f 6461 7461 2873 656c 6629  f get_data(self)
-00012e00: 3a0a 2020 2020 2020 2020 2222 2252 6574  :.        """Ret
-00012e10: 7572 6e20 6172 7261 7973 206f 6620 636f  urn arrays of co
-00012e20: 6f72 6469 6e61 7465 7320 666f 7220 706c  ordinates for pl
-00012e30: 6f74 7469 6e67 2e20 4465 7065 6e64 696e  otting. Dependin
-00012e40: 6720 6f6e 2074 6865 0a20 2020 2020 2020  g on the.       
-00012e50: 2060 6164 6170 7469 7665 6020 6f70 7469   `adaptive` opti
-00012e60: 6f6e 2c20 7468 6973 2066 756e 6374 696f  on, this functio
-00012e70: 6e20 7769 6c6c 2065 6974 6865 7220 7573  n will either us
-00012e80: 6520 616e 2061 6461 7074 6976 6520 616c  e an adaptive al
-00012e90: 676f 7269 7468 6d0a 2020 2020 2020 2020  gorithm.        
-00012ea0: 6f72 2069 7420 7769 6c6c 2075 6e69 666f  or it will unifo
-00012eb0: 726d 6c79 2073 616d 706c 6520 7468 6520  rmly sample the 
-00012ec0: 6578 7072 6573 7369 6f6e 206f 7665 7220  expression over 
-00012ed0: 7468 6520 7072 6f76 6964 6564 2072 616e  the provided ran
-00012ee0: 6765 2e0a 0a20 2020 2020 2020 2052 6574  ge...        Ret
-00012ef0: 7572 6e73 0a20 2020 2020 2020 203d 3d3d  urns.        ===
-00012f00: 3d3d 3d3d 0a0a 2020 2020 2020 2020 7820  ====..        x 
-00012f10: 3a20 6e70 2e6e 6461 7272 6179 205b 6e32  : np.ndarray [n2
-00012f20: 2078 206e 315d 0a20 2020 2020 2020 2020   x n1].         
-00012f30: 2020 2078 2d63 6f6f 7264 696e 6174 6573     x-coordinates
-00012f40: 2e0a 2020 2020 2020 2020 7920 3a20 6e70  ..        y : np
-00012f50: 2e6e 6461 7272 6179 205b 6e32 2078 206e  .ndarray [n2 x n
-00012f60: 315d 0a20 2020 2020 2020 2020 2020 2079  1].            y
-00012f70: 2d63 6f6f 7264 696e 6174 6573 2e0a 2020  -coordinates..  
-00012f80: 2020 2020 2020 7a20 3a20 6e70 2e6e 6461        z : np.nda
-00012f90: 7272 6179 205b 6e32 2078 206e 315d 0a20  rray [n2 x n1]. 
-00012fa0: 2020 2020 2020 2020 2020 207a 2d63 6f6f             z-coo
-00012fb0: 7264 696e 6174 6573 2e0a 2020 2020 2020  rdinates..      
-00012fc0: 2020 6d65 7368 5f75 203a 206e 702e 6e64    mesh_u : np.nd
-00012fd0: 6172 7261 7920 5b6e 3220 7820 6e31 5d0a  array [n2 x n1].
-00012fe0: 2020 2020 2020 2020 2020 2020 4469 7363              Disc
-00012ff0: 7265 7469 7a65 6420 7520 7261 6e67 652e  retized u range.
-00013000: 0a20 2020 2020 2020 206d 6573 685f 7620  .        mesh_v 
-00013010: 3a20 6e70 2e6e 6461 7272 6179 205b 6e32  : np.ndarray [n2
-00013020: 2078 206e 315d 0a20 2020 2020 2020 2020   x n1].         
-00013030: 2020 2044 6973 6372 6574 697a 6564 2076     Discretized v
-00013040: 2072 616e 6765 2e0a 2020 2020 2020 2020   range..        
-00013050: 2222 220a 2020 2020 2020 2020 6e70 203d  """.        np =
-00013060: 2069 6d70 6f72 745f 6d6f 6475 6c65 2827   import_module('
-00013070: 6e75 6d70 7927 290a 0a20 2020 2020 2020  numpy')..       
-00013080: 2072 6573 756c 7473 203d 2073 656c 662e   results = self.
-00013090: 5f65 7661 6c75 6174 6528 290a 2020 2020  _evaluate().    
-000130a0: 2020 2020 666f 7220 692c 2072 2069 6e20      for i, r in 
-000130b0: 656e 756d 6572 6174 6528 7265 7375 6c74  enumerate(result
-000130c0: 7329 3a0a 2020 2020 2020 2020 2020 2020  s):.            
-000130d0: 5f72 652c 205f 696d 203d 206e 702e 7265  _re, _im = np.re
-000130e0: 616c 2872 292c 206e 702e 696d 6167 2872  al(r), np.imag(r
-000130f0: 290a 2020 2020 2020 2020 2020 2020 5f72  ).            _r
-00013100: 655b 6e70 2e69 6e76 6572 7428 6e70 2e69  e[np.invert(np.i
-00013110: 7363 6c6f 7365 285f 696d 2c20 6e70 2e7a  sclose(_im, np.z
-00013120: 6572 6f73 5f6c 696b 6528 5f69 6d29 2929  eros_like(_im)))
-00013130: 5d20 3d20 6e70 2e6e 616e 0a20 2020 2020  ] = np.nan.     
-00013140: 2020 2020 2020 2072 6573 756c 7473 5b69         results[i
-00013150: 5d20 3d20 5f72 650a 0a20 2020 2020 2020  ] = _re..       
-00013160: 2072 6574 7572 6e20 7365 6c66 2e5f 6170   return self._ap
-00013170: 706c 795f 7472 616e 7366 6f72 6d28 2a72  ply_transform(*r
-00013180: 6573 756c 7473 5b32 3a5d 2c20 2a72 6573  esults[2:], *res
-00013190: 756c 7473 5b3a 325d 290a 0a0a 636c 6173  ults[:2])...clas
-000131a0: 7320 436f 6e74 6f75 7253 6572 6965 7328  s ContourSeries(
-000131b0: 5375 7266 6163 654f 7665 7232 4452 616e  SurfaceOver2DRan
-000131c0: 6765 5365 7269 6573 293a 0a20 2020 2022  geSeries):.    "
-000131d0: 2222 5265 7072 6573 656e 7461 7469 6f6e  ""Representation
-000131e0: 2066 6f72 2061 2063 6f6e 746f 7572 2070   for a contour p
-000131f0: 6c6f 742e 2222 220a 0a20 2020 2069 735f  lot."""..    is_
-00013200: 3344 7375 7266 6163 6520 3d20 4661 6c73  3Dsurface = Fals
-00013210: 650a 2020 2020 6973 5f63 6f6e 746f 7572  e.    is_contour
-00013220: 203d 2054 7275 650a 2020 2020 5f61 6c6c   = True.    _all
-00013230: 6f77 6564 5f6b 6579 7320 3d20 5b0a 2020  owed_keys = [.  
-00013240: 2020 2020 2020 2263 6f6e 746f 7572 5f6b        "contour_k
-00013250: 7722 2c20 2269 735f 6669 6c6c 6564 222c  w", "is_filled",
-00013260: 2022 6669 6c6c 222c 2022 636c 6162 656c   "fill", "clabel
-00013270: 7322 5d0a 0a20 2020 2064 6566 205f 5f69  s"]..    def __i
-00013280: 6e69 745f 5f28 7365 6c66 2c20 2a61 7267  nit__(self, *arg
-00013290: 732c 202a 2a6b 7761 7267 7329 3a0a 2020  s, **kwargs):.  
-000132a0: 2020 2020 2020 7375 7065 7228 292e 5f5f        super().__
-000132b0: 696e 6974 5f5f 282a 6172 6773 2c20 2a2a  init__(*args, **
-000132c0: 6b77 6172 6773 290a 2020 2020 2020 2020  kwargs).        
-000132d0: 7365 6c66 2e69 735f 6669 6c6c 6564 203d  self.is_filled =
-000132e0: 206b 7761 7267 732e 6765 7428 2269 735f   kwargs.get("is_
-000132f0: 6669 6c6c 6564 222c 206b 7761 7267 732e  filled", kwargs.
-00013300: 6765 7428 2266 696c 6c22 2c20 5472 7565  get("fill", True
-00013310: 2929 0a20 2020 2020 2020 2073 656c 662e  )).        self.
-00013320: 7368 6f77 5f63 6c61 6265 6c73 203d 206b  show_clabels = k
-00013330: 7761 7267 732e 6765 7428 2263 6c61 6265  wargs.get("clabe
-00013340: 6c73 222c 2054 7275 6529 0a0a 2020 2020  ls", True)..    
-00013350: 2020 2020 2320 4e4f 5445 3a20 636f 6e74      # NOTE: cont
-00013360: 6f75 7220 706c 6f74 7320 6172 6520 7573  our plots are us
-00013370: 6564 2062 7920 706c 6f74 5f63 6f6e 746f  ed by plot_conto
-00013380: 7572 2c20 706c 6f74 5f76 6563 746f 7220  ur, plot_vector 
-00013390: 616e 640a 2020 2020 2020 2020 2320 706c  and.        # pl
-000133a0: 6f74 5f63 6f6d 706c 6578 5f76 6563 746f  ot_complex_vecto
-000133b0: 722e 2042 7920 696d 706c 656d 656e 7469  r. By implementi
-000133c0: 6e67 2063 6f6e 746f 7572 5f6b 7720 7765  ng contour_kw we
-000133d0: 2061 7265 2061 626c 6520 746f 0a20 2020   are able to.   
-000133e0: 2020 2020 2023 2071 7569 636b 6c79 2074       # quickly t
-000133f0: 6172 6765 7420 7468 6520 636f 6e74 6f75  arget the contou
-00013400: 7220 706c 6f74 2e0a 2020 2020 2020 2020  r plot..        
-00013410: 7365 6c66 2e72 656e 6465 7269 6e67 5f6b  self.rendering_k
-00013420: 7720 3d20 6b77 6172 6773 2e67 6574 280a  w = kwargs.get(.
-00013430: 2020 2020 2020 2020 2020 2020 2263 6f6e              "con
-00013440: 746f 7572 5f6b 7722 2c20 6b77 6172 6773  tour_kw", kwargs
-00013450: 2e67 6574 2822 7265 6e64 6572 696e 675f  .get("rendering_
-00013460: 6b77 222c 2064 6963 7428 2929 290a 0a0a  kw", dict()))...
-00013470: 636c 6173 7320 496d 706c 6963 6974 5365  class ImplicitSe
-00013480: 7269 6573 280a 2020 2020 436f 6d6d 6f6e  ries(.    Common
-00013490: 556e 6966 6f72 6d45 7661 6c75 6174 696f  UniformEvaluatio
-000134a0: 6e2c 2042 6173 6553 6572 6965 730a 293a  n, BaseSeries.):
-000134b0: 0a20 2020 2022 2222 5265 7072 6573 656e  .    """Represen
-000134c0: 7461 7469 6f6e 2066 6f72 2049 6d70 6c69  tation for Impli
-000134d0: 6369 7420 706c 6f74 0a0a 2020 2020 5265  cit plot..    Re
-000134e0: 6665 7265 6e63 6573 0a20 2020 203d 3d3d  ferences.    ===
-000134f0: 3d3d 3d3d 3d3d 3d0a 0a20 2020 202e 2e20  =======..    .. 
-00013500: 5b31 5d20 4a65 6666 7265 7920 416c 6c65  [1] Jeffrey Alle
-00013510: 6e20 5475 7070 6572 2e20 5265 6c69 6162  n Tupper. Reliab
-00013520: 6c65 2054 776f 2d44 696d 656e 7369 6f6e  le Two-Dimension
-00013530: 616c 2047 7261 7068 696e 6720 4d65 7468  al Graphing Meth
-00013540: 6f64 7320 666f 720a 2020 2020 4d61 7468  ods for.    Math
-00013550: 656d 6174 6963 616c 2046 6f72 6d75 6c61  ematical Formula
-00013560: 6520 7769 7468 2054 776f 2046 7265 6520  e with Two Free 
-00013570: 5661 7269 6162 6c65 732e 0a0a 2020 2020  Variables...    
-00013580: 2e2e 205b 325d 204a 6566 6672 6579 2041  .. [2] Jeffrey A
-00013590: 6c6c 656e 2054 7570 7065 722e 2047 7261  llen Tupper. Gra
-000135a0: 7068 696e 6720 4571 7561 7469 6f6e 7320  phing Equations 
-000135b0: 7769 7468 2047 656e 6572 616c 697a 6564  with Generalized
-000135c0: 2049 6e74 6572 7661 6c0a 2020 2020 4172   Interval.    Ar
-000135d0: 6974 686d 6574 6963 2e20 4d61 7374 6572  ithmetic. Master
-000135e0: 2773 2074 6865 7369 732e 2055 6e69 7665  's thesis. Unive
-000135f0: 7273 6974 7920 6f66 2054 6f72 6f6e 746f  rsity of Toronto
-00013600: 2c20 3139 3936 0a20 2020 2022 2222 0a0a  , 1996.    """..
-00013610: 2020 2020 6973 5f69 6d70 6c69 6369 7420      is_implicit 
-00013620: 3d20 5472 7565 0a20 2020 2075 7365 5f63  = True.    use_c
-00013630: 6d20 3d20 4661 6c73 650a 2020 2020 5f61  m = False.    _a
-00013640: 6c6c 6f77 6564 5f6b 6579 7320 3d20 5b22  llowed_keys = ["
-00013650: 6164 6170 7469 7665 222c 2022 6465 7074  adaptive", "dept
-00013660: 6822 2c20 2263 6f6c 6f72 225d 0a20 2020  h", "color"].   
-00013670: 205f 4e20 3d20 3130 300a 0a20 2020 2064   _N = 100..    d
-00013680: 6566 205f 5f69 6e69 745f 5f28 7365 6c66  ef __init__(self
-00013690: 2c20 6578 7072 2c20 7661 725f 7374 6172  , expr, var_star
-000136a0: 745f 656e 645f 782c 2076 6172 5f73 7461  t_end_x, var_sta
-000136b0: 7274 5f65 6e64 5f79 2c20 6c61 6265 6c3d  rt_end_y, label=
-000136c0: 2222 2c20 2a2a 6b77 6172 6773 293a 0a20  "", **kwargs):. 
-000136d0: 2020 2020 2020 2073 7570 6572 2829 2e5f         super()._
-000136e0: 5f69 6e69 745f 5f28 2a2a 6b77 6172 6773  _init__(**kwargs
-000136f0: 290a 2020 2020 2020 2020 7365 6c66 2e61  ).        self.a
-00013700: 6461 7074 6976 6520 3d20 6b77 6172 6773  daptive = kwargs
-00013710: 2e67 6574 2822 6164 6170 7469 7665 222c  .get("adaptive",
-00013720: 2046 616c 7365 290a 2020 2020 2020 2020   False).        
-00013730: 7365 6c66 2e65 7870 7220 3d20 6578 7072  self.expr = expr
-00013740: 0a20 2020 2020 2020 2073 656c 662e 5f6c  .        self._l
-00013750: 6162 656c 203d 2073 7472 2865 7870 7229  abel = str(expr)
-00013760: 2069 6620 6c61 6265 6c20 6973 204e 6f6e   if label is Non
-00013770: 6520 656c 7365 206c 6162 656c 0a20 2020  e else label.   
-00013780: 2020 2020 2073 656c 662e 5f6c 6174 6578       self._latex
-00013790: 5f6c 6162 656c 203d 206c 6174 6578 2865  _label = latex(e
-000137a0: 7870 7229 2069 6620 6c61 6265 6c20 6973  xpr) if label is
-000137b0: 204e 6f6e 6520 656c 7365 206c 6162 656c   None else label
-000137c0: 0a20 2020 2020 2020 2073 656c 662e 7261  .        self.ra
-000137d0: 6e67 6573 203d 205b 7661 725f 7374 6172  nges = [var_star
-000137e0: 745f 656e 645f 782c 2076 6172 5f73 7461  t_end_x, var_sta
-000137f0: 7274 5f65 6e64 5f79 5d0a 2020 2020 2020  rt_end_y].      
-00013800: 2020 7365 6c66 2e76 6172 5f78 2c20 7365    self.var_x, se
-00013810: 6c66 2e73 7461 7274 5f78 2c20 7365 6c66  lf.start_x, self
-00013820: 2e65 6e64 5f78 203d 2073 656c 662e 7261  .end_x = self.ra
-00013830: 6e67 6573 5b30 5d0a 2020 2020 2020 2020  nges[0].        
-00013840: 7365 6c66 2e76 6172 5f79 2c20 7365 6c66  self.var_y, self
-00013850: 2e73 7461 7274 5f79 2c20 7365 6c66 2e65  .start_y, self.e
-00013860: 6e64 5f79 203d 2073 656c 662e 7261 6e67  nd_y = self.rang
-00013870: 6573 5b31 5d0a 2020 2020 2020 2020 7365  es[1].        se
-00013880: 6c66 2e5f 636f 6c6f 7220 3d20 6b77 6172  lf._color = kwar
-00013890: 6773 2e67 6574 2822 636f 6c6f 7222 2c20  gs.get("color", 
-000138a0: 6b77 6172 6773 2e67 6574 2822 6c69 6e65  kwargs.get("line
-000138b0: 5f63 6f6c 6f72 222c 204e 6f6e 6529 290a  _color", None)).
-000138c0: 0a20 2020 2020 2020 2069 6620 7365 6c66  .        if self
-000138d0: 2e69 735f 696e 7465 7261 6374 6976 6520  .is_interactive 
-000138e0: 616e 6420 7365 6c66 2e61 6461 7074 6976  and self.adaptiv
-000138f0: 653a 0a20 2020 2020 2020 2020 2020 2072  e:.            r
-00013900: 6169 7365 204e 6f74 496d 706c 656d 656e  aise NotImplemen
-00013910: 7465 6445 7272 6f72 2822 496e 7465 7261  tedError("Intera
-00013920: 6374 6976 6520 706c 6f74 2077 6974 6820  ctive plot with 
-00013930: 6061 6461 7074 6976 653d 5472 7565 6020  `adaptive=True` 
-00013940: 220a 2020 2020 2020 2020 2020 2020 2020  ".              
-00013950: 2020 2269 7320 6e6f 7420 7375 7070 6f72    "is not suppor
-00013960: 7465 642e 2229 0a0a 2020 2020 2020 2020  ted.")..        
-00013970: 2320 4368 6563 6b20 7768 6574 6865 7220  # Check whether 
-00013980: 7468 6520 6465 7074 6820 6973 2067 7265  the depth is gre
-00013990: 6174 6572 2074 6861 6e20 3420 6f72 206c  ater than 4 or l
-000139a0: 6573 7320 7468 616e 2030 2e0a 2020 2020  ess than 0..    
-000139b0: 2020 2020 6465 7074 6820 3d20 6b77 6172      depth = kwar
-000139c0: 6773 2e67 6574 2822 6465 7074 6822 2c20  gs.get("depth", 
-000139d0: 3029 0a20 2020 2020 2020 2069 6620 6465  0).        if de
-000139e0: 7074 6820 3e20 343a 0a20 2020 2020 2020  pth > 4:.       
-000139f0: 2020 2020 2064 6570 7468 203d 2034 0a20       depth = 4. 
-00013a00: 2020 2020 2020 2065 6c69 6620 6465 7074         elif dept
-00013a10: 6820 3c20 303a 0a20 2020 2020 2020 2020  h < 0:.         
-00013a20: 2020 2064 6570 7468 203d 2030 0a20 2020     depth = 0.   
-00013a30: 2020 2020 2073 656c 662e 6465 7074 6820       self.depth 
-00013a40: 3d20 3420 2b20 6465 7074 680a 2020 2020  = 4 + depth.    
-00013a50: 2020 2020 7365 6c66 2e5f 706f 7374 5f69      self._post_i
-00013a60: 6e69 7428 290a 0a20 2020 2040 7072 6f70  nit()..    @prop
-00013a70: 6572 7479 0a20 2020 2064 6566 2065 7870  erty.    def exp
-00013a80: 7228 7365 6c66 293a 0a20 2020 2020 2020  r(self):.       
-00013a90: 2069 6620 7365 6c66 2e61 6461 7074 6976   if self.adaptiv
-00013aa0: 653a 0a20 2020 2020 2020 2020 2020 2072  e:.            r
-00013ab0: 6574 7572 6e20 7365 6c66 2e5f 6164 6170  eturn self._adap
-00013ac0: 7469 7665 5f65 7870 720a 2020 2020 2020  tive_expr.      
-00013ad0: 2020 7265 7475 726e 2073 656c 662e 5f6e    return self._n
-00013ae0: 6f6e 5f61 6461 7074 6976 655f 6578 7072  on_adaptive_expr
-00013af0: 0a0a 2020 2020 4065 7870 722e 7365 7474  ..    @expr.sett
-00013b00: 6572 0a20 2020 2064 6566 2065 7870 7228  er.    def expr(
-00013b10: 7365 6c66 2c20 6578 7072 293a 0a20 2020  self, expr):.   
-00013b20: 2020 2020 2073 656c 662e 5f62 6c6f 636b       self._block
-00013b30: 5f6c 616d 6264 615f 6675 6e63 7469 6f6e  _lambda_function
-00013b40: 7328 6578 7072 290a 2020 2020 2020 2020  s(expr).        
-00013b50: 2320 7468 6573 6520 6172 6520 6e65 6564  # these are need
-00013b60: 6564 2066 6f72 2061 6461 7074 6976 6520  ed for adaptive 
-00013b70: 6576 616c 7561 7469 6f6e 0a20 2020 2020  evaluation.     
-00013b80: 2020 2065 7870 722c 2068 6173 5f65 7175     expr, has_equ
-00013b90: 616c 6974 7920 3d20 7365 6c66 2e5f 6861  ality = self._ha
-00013ba0: 735f 6571 7561 6c69 7479 2873 796d 7069  s_equality(sympi
-00013bb0: 6679 2865 7870 7229 290a 2020 2020 2020  fy(expr)).      
-00013bc0: 2020 7365 6c66 2e5f 6164 6170 7469 7665    self._adaptive
-00013bd0: 5f65 7870 7220 3d20 6578 7072 0a20 2020  _expr = expr.   
-00013be0: 2020 2020 2073 656c 662e 6861 735f 6571       self.has_eq
-00013bf0: 7561 6c69 7479 203d 2068 6173 5f65 7175  uality = has_equ
-00013c00: 616c 6974 790a 2020 2020 2020 2020 7365  ality.        se
-00013c10: 6c66 2e5f 6c61 6265 6c20 3d20 7374 7228  lf._label = str(
-00013c20: 6578 7072 290a 2020 2020 2020 2020 7365  expr).        se
-00013c30: 6c66 2e5f 6c61 7465 785f 6c61 6265 6c20  lf._latex_label 
-00013c40: 3d20 6c61 7465 7828 6578 7072 290a 0a20  = latex(expr).. 
-00013c50: 2020 2020 2020 2069 6620 6973 696e 7374         if isinst
-00013c60: 616e 6365 2865 7870 722c 2028 426f 6f6c  ance(expr, (Bool
-00013c70: 6561 6e46 756e 6374 696f 6e2c 204e 6529  eanFunction, Ne)
-00013c80: 2920 616e 6420 286e 6f74 2073 656c 662e  ) and (not self.
-00013c90: 6164 6170 7469 7665 293a 0a20 2020 2020  adaptive):.     
-00013ca0: 2020 2020 2020 2073 656c 662e 6164 6170         self.adap
-00013cb0: 7469 7665 203d 2054 7275 650a 2020 2020  tive = True.    
-00013cc0: 2020 2020 2020 2020 6d73 6720 3d20 2263          msg = "c
-00013cd0: 6f6e 7461 696e 7320 426f 6f6c 6561 6e20  ontains Boolean 
-00013ce0: 6675 6e63 7469 6f6e 732e 2022 0a20 2020  functions. ".   
-00013cf0: 2020 2020 2020 2020 2069 6620 6973 696e           if isin
-00013d00: 7374 616e 6365 2865 7870 722c 204e 6529  stance(expr, Ne)
-00013d10: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-00013d20: 2020 6d73 6720 3d20 2269 7320 616e 2075    msg = "is an u
-00013d30: 6e65 7175 616c 6974 792e 2022 0a20 2020  nequality. ".   
-00013d40: 2020 2020 2020 2020 2077 6172 6e69 6e67           warning
-00013d50: 732e 7761 726e 2866 2254 6865 2070 726f  s.warn(f"The pro
-00013d60: 7669 6465 6420 6578 7072 6573 7369 6f6e  vided expression
-00013d70: 207b 6d73 677d 220a 2020 2020 2020 2020   {msg}".        
-00013d80: 2020 2020 2020 2020 2249 6e20 6f72 6465          "In orde
-00013d90: 7220 746f 2070 6c6f 7420 7468 6520 6578  r to plot the ex
-00013da0: 7072 6573 7369 6f6e 2c20 7468 6520 616c  pression, the al
-00013db0: 676f 7269 7468 6d20 220a 2020 2020 2020  gorithm ".      
-00013dc0: 2020 2020 2020 2020 2020 2261 7574 6f6d            "autom
-00013dd0: 6174 6963 616c 6c79 2073 7769 7463 6865  atically switche
-00013de0: 6420 746f 2061 6e20 6164 6170 7469 7665  d to an adaptive
-00013df0: 2073 616d 706c 696e 672e 222c 0a20 2020   sampling.",.   
-00013e00: 2020 2020 2020 2020 2020 2020 2073 7461               sta
-00013e10: 636b 6c65 7665 6c3d 3129 0a0a 2020 2020  cklevel=1)..    
-00013e20: 2020 2020 6966 2069 7369 6e73 7461 6e63      if isinstanc
-00013e30: 6528 6578 7072 2c20 426f 6f6c 6561 6e46  e(expr, BooleanF
-00013e40: 756e 6374 696f 6e29 3a0a 2020 2020 2020  unction):.      
-00013e50: 2020 2020 2020 7365 6c66 2e5f 6e6f 6e5f        self._non_
-00013e60: 6164 6170 7469 7665 5f65 7870 7220 3d20  adaptive_expr = 
-00013e70: 4e6f 6e65 0a20 2020 2020 2020 2020 2020  None.           
-00013e80: 2073 656c 662e 5f69 735f 6571 7561 6c69   self._is_equali
-00013e90: 7479 203d 2046 616c 7365 0a20 2020 2020  ty = False.     
-00013ea0: 2020 2065 6c73 653a 0a20 2020 2020 2020     else:.       
-00013eb0: 2020 2020 2023 2074 6865 7365 2061 7265       # these are
-00013ec0: 206e 6565 6465 6420 666f 7220 756e 6966   needed for unif
-00013ed0: 6f72 6d20 6d65 7368 696e 6720 6576 616c  orm meshing eval
-00013ee0: 7561 7469 6f6e 0a20 2020 2020 2020 2020  uation.         
-00013ef0: 2020 2065 7870 722c 2069 735f 6571 7561     expr, is_equa
-00013f00: 6c69 7479 203d 2073 656c 662e 5f70 7265  lity = self._pre
-00013f10: 7072 6f63 6573 735f 6d65 7368 6772 6964  process_meshgrid
-00013f20: 5f65 7870 7265 7373 696f 6e28 0a20 2020  _expression(.   
-00013f30: 2020 2020 2020 2020 2020 2020 2065 7870               exp
-00013f40: 722c 2073 656c 662e 6164 6170 7469 7665  r, self.adaptive
-00013f50: 290a 2020 2020 2020 2020 2020 2020 7365  ).            se
-00013f60: 6c66 2e5f 6e6f 6e5f 6164 6170 7469 7665  lf._non_adaptive
-00013f70: 5f65 7870 7220 3d20 6578 7072 0a20 2020  _expr = expr.   
-00013f80: 2020 2020 2020 2020 2073 656c 662e 5f69           self._i
-00013f90: 735f 6571 7561 6c69 7479 203d 2069 735f  s_equality = is_
-00013fa0: 6571 7561 6c69 7479 0a0a 2020 2020 4070  equality..    @p
-00013fb0: 726f 7065 7274 790a 2020 2020 6465 6620  roperty.    def 
-00013fc0: 6c69 6e65 5f63 6f6c 6f72 2873 656c 6629  line_color(self)
-00013fd0: 3a0a 2020 2020 2020 2020 7265 7475 726e  :.        return
-00013fe0: 2073 656c 662e 5f63 6f6c 6f72 0a0a 2020   self._color..  
-00013ff0: 2020 406c 696e 655f 636f 6c6f 722e 7365    @line_color.se
-00014000: 7474 6572 0a20 2020 2064 6566 206c 696e  tter.    def lin
-00014010: 655f 636f 6c6f 7228 7365 6c66 2c20 7629  e_color(self, v)
-00014020: 3a0a 2020 2020 2020 2020 7365 6c66 2e5f  :.        self._
-00014030: 636f 6c6f 7220 3d20 760a 0a20 2020 2063  color = v..    c
-00014040: 6f6c 6f72 203d 206c 696e 655f 636f 6c6f  olor = line_colo
-00014050: 720a 0a20 2020 2064 6566 205f 6861 735f  r..    def _has_
-00014060: 6571 7561 6c69 7479 2873 656c 662c 2065  equality(self, e
-00014070: 7870 7229 3a0a 2020 2020 2020 2020 2320  xpr):.        # 
-00014080: 5265 7072 6573 656e 7473 2077 6865 7468  Represents wheth
-00014090: 6572 2074 6865 2065 7870 7265 7373 696f  er the expressio
-000140a0: 6e20 636f 6e74 6169 6e73 2061 6e20 4571  n contains an Eq
-000140b0: 7561 6c69 7479 2c20 4772 6561 7465 7254  uality, GreaterT
-000140c0: 6861 6e0a 2020 2020 2020 2020 2320 6f72  han.        # or
-000140d0: 204c 6573 7354 6861 6e0a 2020 2020 2020   LessThan.      
-000140e0: 2020 6861 735f 6571 7561 6c69 7479 203d    has_equality =
-000140f0: 2046 616c 7365 0a0a 2020 2020 2020 2020   False..        
-00014100: 6465 6620 6172 675f 6578 7061 6e64 2862  def arg_expand(b
-00014110: 6f6f 6c5f 6578 7072 293a 0a20 2020 2020  ool_expr):.     
-00014120: 2020 2020 2020 2022 2222 5265 6375 7273         """Recurs
-00014130: 6976 656c 7920 6578 7061 6e64 7320 7468  ively expands th
-00014140: 6520 6172 6775 6d65 6e74 7320 6f66 2061  e arguments of a
-00014150: 6e20 426f 6f6c 6561 6e20 4675 6e63 7469  n Boolean Functi
-00014160: 6f6e 2222 220a 2020 2020 2020 2020 2020  on""".          
-00014170: 2020 666f 7220 6172 6720 696e 2062 6f6f    for arg in boo
-00014180: 6c5f 6578 7072 2e61 7267 733a 0a20 2020  l_expr.args:.   
-00014190: 2020 2020 2020 2020 2020 2020 2069 6620               if 
-000141a0: 6973 696e 7374 616e 6365 2861 7267 2c20  isinstance(arg, 
-000141b0: 426f 6f6c 6561 6e46 756e 6374 696f 6e29  BooleanFunction)
-000141c0: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-000141d0: 2020 2020 2020 6172 675f 6578 7061 6e64        arg_expand
-000141e0: 2861 7267 290a 2020 2020 2020 2020 2020  (arg).          
-000141f0: 2020 2020 2020 656c 6966 2069 7369 6e73        elif isins
-00014200: 7461 6e63 6528 6172 672c 2052 656c 6174  tance(arg, Relat
-00014210: 696f 6e61 6c29 3a0a 2020 2020 2020 2020  ional):.        
-00014220: 2020 2020 2020 2020 2020 2020 6172 675f              arg_
-00014230: 6c69 7374 2e61 7070 656e 6428 6172 6729  list.append(arg)
-00014240: 0a0a 2020 2020 2020 2020 6172 675f 6c69  ..        arg_li
-00014250: 7374 203d 205b 5d0a 2020 2020 2020 2020  st = [].        
-00014260: 6966 2069 7369 6e73 7461 6e63 6528 6578  if isinstance(ex
-00014270: 7072 2c20 426f 6f6c 6561 6e46 756e 6374  pr, BooleanFunct
-00014280: 696f 6e29 3a0a 2020 2020 2020 2020 2020  ion):.          
-00014290: 2020 6172 675f 6578 7061 6e64 2865 7870    arg_expand(exp
-000142a0: 7229 0a20 2020 2020 2020 2020 2020 2023  r).            #
-000142b0: 2043 6865 636b 2077 6865 7468 6572 2074   Check whether t
-000142c0: 6865 7265 2069 7320 616e 2065 7175 616c  here is an equal
-000142d0: 6974 7920 696e 2074 6865 2065 7870 7265  ity in the expre
-000142e0: 7373 696f 6e20 7072 6f76 6964 6564 2e0a  ssion provided..
-000142f0: 2020 2020 2020 2020 2020 2020 6966 2061              if a
-00014300: 6e79 2869 7369 6e73 7461 6e63 6528 652c  ny(isinstance(e,
-00014310: 2028 4571 7561 6c69 7479 2c20 4772 6561   (Equality, Grea
-00014320: 7465 7254 6861 6e2c 204c 6573 7354 6861  terThan, LessTha
-00014330: 6e29 2920 666f 7220 6520 696e 2061 7267  n)) for e in arg
-00014340: 5f6c 6973 7429 3a0a 2020 2020 2020 2020  _list):.        
-00014350: 2020 2020 2020 2020 6861 735f 6571 7561          has_equa
-00014360: 6c69 7479 203d 2054 7275 650a 2020 2020  lity = True.    
-00014370: 2020 2020 656c 6966 206e 6f74 2069 7369      elif not isi
-00014380: 6e73 7461 6e63 6528 6578 7072 2c20 5265  nstance(expr, Re
-00014390: 6c61 7469 6f6e 616c 293a 0a20 2020 2020  lational):.     
-000143a0: 2020 2020 2020 2065 7870 7220 3d20 4571         expr = Eq
-000143b0: 7561 6c69 7479 2865 7870 722c 2030 290a  uality(expr, 0).
-000143c0: 2020 2020 2020 2020 2020 2020 6861 735f              has_
-000143d0: 6571 7561 6c69 7479 203d 2054 7275 650a  equality = True.
-000143e0: 2020 2020 2020 2020 656c 6966 2069 7369          elif isi
-000143f0: 6e73 7461 6e63 6528 6578 7072 2c20 2845  nstance(expr, (E
-00014400: 7175 616c 6974 792c 2047 7265 6174 6572  quality, Greater
-00014410: 5468 616e 2c20 4c65 7373 5468 616e 2929  Than, LessThan))
-00014420: 3a0a 2020 2020 2020 2020 2020 2020 6861  :.            ha
-00014430: 735f 6571 7561 6c69 7479 203d 2054 7275  s_equality = Tru
-00014440: 650a 0a20 2020 2020 2020 2072 6574 7572  e..        retur
-00014450: 6e20 6578 7072 2c20 6861 735f 6571 7561  n expr, has_equa
-00014460: 6c69 7479 0a0a 2020 2020 6465 6620 5f5f  lity..    def __
-00014470: 7374 725f 5f28 7365 6c66 293a 0a20 2020  str__(self):.   
-00014480: 2020 2020 2066 203d 206c 616d 6264 6120       f = lambda 
-00014490: 743a 2066 6c6f 6174 2874 2920 6966 206c  t: float(t) if l
-000144a0: 656e 2874 2e66 7265 655f 7379 6d62 6f6c  en(t.free_symbol
-000144b0: 7329 203d 3d20 3020 656c 7365 2074 0a0a  s) == 0 else t..
-000144c0: 2020 2020 2020 2020 7265 7475 726e 2073          return s
-000144d0: 656c 662e 5f73 7472 5f68 656c 7065 7228  elf._str_helper(
-000144e0: 0a20 2020 2020 2020 2020 2020 2022 496d  .            "Im
-000144f0: 706c 6963 6974 2065 7870 7265 7373 696f  plicit expressio
-00014500: 6e3a 2025 7320 666f 7220 2573 206f 7665  n: %s for %s ove
-00014510: 7220 2573 2061 6e64 2025 7320 6f76 6572  r %s and %s over
-00014520: 2025 7322 2920 2520 280a 2020 2020 2020   %s") % (.      
-00014530: 2020 2020 2020 7374 7228 7365 6c66 2e5f        str(self._
-00014540: 6164 6170 7469 7665 5f65 7870 7229 2c0a  adaptive_expr),.
-00014550: 2020 2020 2020 2020 2020 2020 7374 7228              str(
-00014560: 7365 6c66 2e76 6172 5f78 292c 0a20 2020  self.var_x),.   
-00014570: 2020 2020 2020 2020 2073 7472 2828 6628           str((f(
-00014580: 7365 6c66 2e73 7461 7274 5f78 292c 2066  self.start_x), f
-00014590: 2873 656c 662e 656e 645f 7829 2929 2c0a  (self.end_x))),.
-000145a0: 2020 2020 2020 2020 2020 2020 7374 7228              str(
-000145b0: 7365 6c66 2e76 6172 5f79 292c 0a20 2020  self.var_y),.   
-000145c0: 2020 2020 2020 2020 2073 7472 2828 6628           str((f(
-000145d0: 7365 6c66 2e73 7461 7274 5f79 292c 2066  self.start_y), f
-000145e0: 2873 656c 662e 656e 645f 7929 2929 2c0a  (self.end_y))),.
-000145f0: 2020 2020 2020 2020 290a 0a20 2020 2064          )..    d
-00014600: 6566 2067 6574 5f64 6174 6128 7365 6c66  ef get_data(self
-00014610: 293a 0a20 2020 2020 2020 2022 2222 5265  ):.        """Re
-00014620: 7475 726e 7320 6e75 6d65 7269 6361 6c20  turns numerical 
-00014630: 6461 7461 2e0a 0a20 2020 2020 2020 2052  data...        R
-00014640: 6574 7572 6e73 0a20 2020 2020 2020 203d  eturns.        =
-00014650: 3d3d 3d3d 3d3d 0a0a 2020 2020 2020 2020  ======..        
-00014660: 4966 2074 6865 2073 6572 6965 7320 6973  If the series is
-00014670: 2065 7661 6c75 6174 6564 2077 6974 6820   evaluated with 
-00014680: 7468 6520 6061 6461 7074 6976 653d 5472  the `adaptive=Tr
-00014690: 7565 6020 6974 2072 6574 7572 6e73 3a0a  ue` it returns:.
-000146a0: 0a20 2020 2020 2020 2069 6e74 6572 7661  .        interva
-000146b0: 6c5f 6c69 7374 203a 206c 6973 740a 2020  l_list : list.  
-000146c0: 2020 2020 2020 2020 2020 4c69 7374 206f            List o
-000146d0: 6620 626f 756e 6469 6e67 2072 6563 7461  f bounding recta
-000146e0: 6e67 756c 6172 2069 6e74 6572 7661 6c73  ngular intervals
-000146f0: 2074 6f20 6265 2070 6f73 7470 726f 6365   to be postproce
-00014700: 7373 6564 2061 6e64 0a20 2020 2020 2020  ssed and.       
-00014710: 2020 2020 2065 7665 6e74 7561 6c6c 7920       eventually 
-00014720: 7573 6564 2077 6974 6820 4d61 7470 6c6f  used with Matplo
-00014730: 746c 6962 2773 2060 6066 696c 6c60 6020  tlib's ``fill`` 
-00014740: 636f 6d6d 616e 642e 0a20 2020 2020 2020  command..       
-00014750: 2064 756d 6d79 203a 2073 7472 0a20 2020   dummy : str.   
-00014760: 2020 2020 2020 2020 2041 2073 7472 696e           A strin
-00014770: 6720 636f 6e74 6169 6e69 6e67 2060 6022  g containing ``"
-00014780: 6669 6c6c 2260 602e 0a0a 2020 2020 2020  fill"``...      
-00014790: 2020 4f74 6865 7277 6973 652c 2069 7420    Otherwise, it 
-000147a0: 7265 7475 726e 7320 3244 206e 756d 7079  returns 2D numpy
-000147b0: 2061 7272 6179 7320 746f 2062 6520 7573   arrays to be us
-000147c0: 6564 2077 6974 6820 4d61 7470 6c6f 746c  ed with Matplotl
-000147d0: 6962 2773 0a20 2020 2020 2020 2060 6063  ib's.        ``c
-000147e0: 6f6e 746f 7572 6060 206f 7220 6060 636f  ontour`` or ``co
-000147f0: 6e74 6f75 7266 6060 2063 6f6d 6d61 6e64  ntourf`` command
-00014800: 733a 0a0a 2020 2020 2020 2020 785f 6172  s:..        x_ar
-00014810: 7261 7920 3a20 6e70 2e6e 6461 7272 6179  ray : np.ndarray
-00014820: 0a20 2020 2020 2020 2079 5f61 7272 6179  .        y_array
-00014830: 203a 206e 702e 6e64 6172 7261 790a 2020   : np.ndarray.  
-00014840: 2020 2020 2020 7a5f 6172 7261 7920 3a20        z_array : 
-00014850: 6e70 2e6e 6461 7272 6179 0a20 2020 2020  np.ndarray.     
-00014860: 2020 2070 6c6f 745f 7479 7065 203a 2073     plot_type : s
-00014870: 7472 0a20 2020 2020 2020 2020 2020 2041  tr.            A
-00014880: 2073 7472 696e 6720 7370 6563 6966 7969   string specifyi
-00014890: 6e67 2077 6869 6368 2070 6c6f 7420 636f  ng which plot co
-000148a0: 6d6d 616e 6420 746f 2075 7365 2c20 6060  mmand to use, ``
-000148b0: 2263 6f6e 746f 7572 2260 600a 2020 2020  "contour"``.    
-000148c0: 2020 2020 2020 2020 6f72 2060 6022 636f          or ``"co
-000148d0: 6e74 6f75 7266 2260 602e 0a20 2020 2020  ntourf"``..     
-000148e0: 2020 2022 2222 0a20 2020 2020 2020 2069     """.        i
-000148f0: 6620 7365 6c66 2e61 6461 7074 6976 653a  f self.adaptive:
-00014900: 0a20 2020 2020 2020 2020 2020 2064 6174  .            dat
-00014910: 6120 3d20 7365 6c66 2e5f 6164 6170 7469  a = self._adapti
-00014920: 7665 5f65 7661 6c28 290a 2020 2020 2020  ve_eval().      
-00014930: 2020 2020 2020 6966 2064 6174 6120 6973        if data is
-00014940: 206e 6f74 204e 6f6e 653a 0a20 2020 2020   not None:.     
-00014950: 2020 2020 2020 2020 2020 2072 6574 7572             retur
-00014960: 6e20 6461 7461 0a20 2020 2020 2020 2072  n data.        r
-00014970: 6574 7572 6e20 7365 6c66 2e5f 6765 745f  eturn self._get_
-00014980: 6d65 7368 6573 5f67 7269 6428 290a 0a20  meshes_grid().. 
-00014990: 2020 2064 6566 205f 6164 6170 7469 7665     def _adaptive
-000149a0: 5f65 7661 6c28 7365 6c66 293a 0a20 2020  _eval(self):.   
-000149b0: 2020 2020 2069 6d70 6f72 7420 7379 6d70       import symp
-000149c0: 792e 706c 6f74 7469 6e67 2e69 6e74 6572  y.plotting.inter
-000149d0: 7661 6c6d 6174 682e 6c69 625f 696e 7465  valmath.lib_inte
-000149e0: 7276 616c 2061 7320 6c69 0a0a 2020 2020  rval as li..    
-000149f0: 2020 2020 7573 6572 5f66 756e 6374 696f      user_functio
-00014a00: 6e73 203d 207b 7d0a 2020 2020 2020 2020  ns = {}.        
-00014a10: 7072 696e 7465 7220 3d20 496e 7465 7276  printer = Interv
-00014a20: 616c 4d61 7468 5072 696e 7465 7228 7b0a  alMathPrinter({.
-00014a30: 2020 2020 2020 2020 2020 2020 2766 756c              'ful
-00014a40: 6c79 5f71 7561 6c69 6669 6564 5f6d 6f64  ly_qualified_mod
-00014a50: 756c 6573 273a 2046 616c 7365 2c20 2769  ules': False, 'i
-00014a60: 6e6c 696e 6527 3a20 5472 7565 2c0a 2020  nline': True,.  
-00014a70: 2020 2020 2020 2020 2020 2761 6c6c 6f77            'allow
-00014a80: 5f75 6e6b 6e6f 776e 5f66 756e 6374 696f  _unknown_functio
-00014a90: 6e73 273a 2054 7275 652c 0a20 2020 2020  ns': True,.     
-00014aa0: 2020 2020 2020 2027 7573 6572 5f66 756e         'user_fun
-00014ab0: 6374 696f 6e73 273a 2075 7365 725f 6675  ctions': user_fu
-00014ac0: 6e63 7469 6f6e 737d 290a 0a20 2020 2020  nctions})..     
-00014ad0: 2020 206b 6579 7320 3d20 5b74 2066 6f72     keys = [t for
-00014ae0: 2074 2069 6e20 6469 7228 6c69 2920 6966   t in dir(li) if
-00014af0: 2028 225f 5f22 206e 6f74 2069 6e20 7429   ("__" not in t)
-00014b00: 2061 6e64 2028 7420 6e6f 7420 696e 205b   and (t not in [
-00014b10: 2269 6d70 6f72 745f 6d6f 6475 6c65 222c  "import_module",
-00014b20: 2022 696e 7465 7276 616c 225d 295d 0a20   "interval"])]. 
-00014b30: 2020 2020 2020 2076 616c 7320 3d20 5b67         vals = [g
-00014b40: 6574 6174 7472 286c 692c 206b 2920 666f  etattr(li, k) fo
-00014b50: 7220 6b20 696e 206b 6579 735d 0a20 2020  r k in keys].   
-00014b60: 2020 2020 2064 203d 207b 6b3a 2076 2066       d = {k: v f
-00014b70: 6f72 206b 2c20 7620 696e 207a 6970 286b  or k, v in zip(k
-00014b80: 6579 732c 2076 616c 7329 7d0a 2020 2020  eys, vals)}.    
-00014b90: 2020 2020 6675 6e63 203d 206c 616d 6264      func = lambd
-00014ba0: 6966 7928 2873 656c 662e 7661 725f 782c  ify((self.var_x,
-00014bb0: 2073 656c 662e 7661 725f 7929 2c20 7365   self.var_y), se
-00014bc0: 6c66 2e65 7870 722c 206d 6f64 756c 6573  lf.expr, modules
-00014bd0: 3d5b 645d 2c20 7072 696e 7465 723d 7072  =[d], printer=pr
-00014be0: 696e 7465 7229 0a20 2020 2020 2020 2064  inter).        d
-00014bf0: 6174 6120 3d20 4e6f 6e65 0a0a 2020 2020  ata = None..    
-00014c00: 2020 2020 7472 793a 0a20 2020 2020 2020      try:.       
-00014c10: 2020 2020 2064 6174 6120 3d20 7365 6c66       data = self
-00014c20: 2e5f 6765 745f 7261 7374 6572 5f69 6e74  ._get_raster_int
-00014c30: 6572 7661 6c28 6675 6e63 290a 2020 2020  erval(func).    
-00014c40: 2020 2020 6578 6365 7074 204e 616d 6545      except NameE
-00014c50: 7272 6f72 2061 7320 6572 723a 0a20 2020  rror as err:.   
-00014c60: 2020 2020 2020 2020 2077 6172 6e69 6e67           warning
-00014c70: 732e 7761 726e 280a 2020 2020 2020 2020  s.warn(.        
-00014c80: 2020 2020 2020 2020 2241 6461 7074 6976          "Adaptiv
-00014c90: 6520 6d65 7368 696e 6720 636f 756c 6420  e meshing could 
-00014ca0: 6e6f 7420 6265 2061 7070 6c69 6564 2074  not be applied t
-00014cb0: 6f20 7468 6522 0a20 2020 2020 2020 2020  o the".         
-00014cc0: 2020 2020 2020 2022 2065 7870 7265 7373         " express
-00014cd0: 696f 6e2c 2061 7320 736f 6d65 2066 756e  ion, as some fun
-00014ce0: 6374 696f 6e73 2061 7265 206e 6f74 2079  ctions are not y
-00014cf0: 6574 2069 6d70 6c65 6d65 6e74 6564 220a  et implemented".
-00014d00: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00014d10: 2220 696e 2074 6865 2069 6e74 6572 7661  " in the interva
-00014d20: 6c20 6d61 7468 206d 6f64 756c 653a 5c6e  l math module:\n
-00014d30: 5c6e 220a 2020 2020 2020 2020 2020 2020  \n".            
-00014d40: 2020 2020 224e 616d 6545 7272 6f72 3a20      "NameError: 
-00014d50: 2573 5c6e 5c6e 2220 2520 6572 7220 2b0a  %s\n\n" % err +.
-00014d60: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00014d70: 2250 726f 6365 6564 696e 6720 7769 7468  "Proceeding with
-00014d80: 2075 6e69 666f 726d 206d 6573 6869 6e67   uniform meshing
-00014d90: 2e22 0a20 2020 2020 2020 2020 2020 2020  .".             
-00014da0: 2020 2029 0a20 2020 2020 2020 2020 2020     ).           
-00014db0: 2073 656c 662e 6164 6170 7469 7665 203d   self.adaptive =
-00014dc0: 2046 616c 7365 0a20 2020 2020 2020 2065   False.        e
-00014dd0: 7863 6570 7420 2841 7474 7269 6275 7465  xcept (Attribute
-00014de0: 4572 726f 722c 2054 7970 6545 7272 6f72  Error, TypeError
-00014df0: 293a 0a20 2020 2020 2020 2020 2020 2023  ):.            #
-00014e00: 2058 5858 3a20 4174 7472 6962 7574 6545   XXX: AttributeE
-00014e10: 7272 6f72 2822 276c 6973 7427 206f 626a  rror("'list' obj
-00014e20: 6563 7420 6861 7320 6e6f 2061 7474 7269  ect has no attri
-00014e30: 6275 7465 2027 6973 5f72 6561 6c27 2229  bute 'is_real'")
-00014e40: 0a20 2020 2020 2020 2020 2020 2023 2054  .            # T
-00014e50: 6861 7420 6e65 6564 7320 6669 7869 6e67  hat needs fixing
-00014e60: 2073 6f6d 6568 6f77 202d 2077 6520 7368   somehow - we sh
-00014e70: 6f75 6c64 6e27 7420 6265 2063 6174 6368  ouldn't be catch
-00014e80: 696e 670a 2020 2020 2020 2020 2020 2020  ing.            
-00014e90: 2320 4174 7472 6962 7574 6545 7272 6f72  # AttributeError
-00014ea0: 2068 6572 652e 0a20 2020 2020 2020 2020   here..         
-00014eb0: 2020 2077 6172 6e69 6e67 732e 7761 726e     warnings.warn
-00014ec0: 280a 2020 2020 2020 2020 2020 2020 2020  (.              
-00014ed0: 2020 2241 6461 7074 6976 6520 6d65 7368    "Adaptive mesh
-00014ee0: 696e 6720 636f 756c 6420 6e6f 7420 6265  ing could not be
-00014ef0: 2061 7070 6c69 6564 2074 6f20 7468 6522   applied to the"
-00014f00: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00014f10: 2022 2065 7870 7265 7373 696f 6e2e 2055   " expression. U
-00014f20: 7369 6e67 2075 6e69 666f 726d 206d 6573  sing uniform mes
-00014f30: 6869 6e67 2e22 290a 2020 2020 2020 2020  hing.").        
-00014f40: 2020 2020 7365 6c66 2e61 6461 7074 6976      self.adaptiv
-00014f50: 6520 3d20 4661 6c73 650a 0a20 2020 2020  e = False..     
-00014f60: 2020 2072 6574 7572 6e20 6461 7461 0a0a     return data..
-00014f70: 2020 2020 6465 6620 5f67 6574 5f72 6173      def _get_ras
-00014f80: 7465 725f 696e 7465 7276 616c 2873 656c  ter_interval(sel
-00014f90: 662c 2066 756e 6329 3a0a 2020 2020 2020  f, func):.      
-00014fa0: 2020 2222 2255 7365 7320 696e 7465 7276    """Uses interv
-00014fb0: 616c 206d 6174 6820 746f 2061 6461 7074  al math to adapt
-00014fc0: 6976 656c 7920 6d65 7368 2061 6e64 206f  ively mesh and o
-00014fd0: 6274 6169 6e20 7468 6520 706c 6f74 2222  btain the plot""
-00014fe0: 220a 2020 2020 2020 2020 6e70 203d 2069  ".        np = i
-00014ff0: 6d70 6f72 745f 6d6f 6475 6c65 2827 6e75  mport_module('nu
-00015000: 6d70 7927 290a 0a20 2020 2020 2020 206b  mpy')..        k
-00015010: 203d 2073 656c 662e 6465 7074 680a 2020   = self.depth.  
-00015020: 2020 2020 2020 696e 7465 7276 616c 5f6c        interval_l
-00015030: 6973 7420 3d20 5b5d 0a20 2020 2020 2020  ist = [].       
-00015040: 2073 782c 2073 7920 3d20 5b66 6c6f 6174   sx, sy = [float
-00015050: 2874 2920 666f 7220 7420 696e 205b 7365  (t) for t in [se
-00015060: 6c66 2e73 7461 7274 5f78 2c20 7365 6c66  lf.start_x, self
-00015070: 2e73 7461 7274 5f79 5d5d 0a20 2020 2020  .start_y]].     
-00015080: 2020 2065 782c 2065 7920 3d20 5b66 6c6f     ex, ey = [flo
-00015090: 6174 2874 2920 666f 7220 7420 696e 205b  at(t) for t in [
-000150a0: 7365 6c66 2e65 6e64 5f78 2c20 7365 6c66  self.end_x, self
-000150b0: 2e65 6e64 5f79 5d5d 0a20 2020 2020 2020  .end_y]].       
-000150c0: 2023 2043 7265 6174 6520 696e 6974 6961   # Create initia
-000150d0: 6c20 3332 2064 6976 6973 696f 6e73 0a20  l 32 divisions. 
-000150e0: 2020 2020 2020 2078 7361 6d70 6c65 203d         xsample =
-000150f0: 206e 702e 6c69 6e73 7061 6365 2873 782c   np.linspace(sx,
-00015100: 2065 782c 2033 3329 0a20 2020 2020 2020   ex, 33).       
-00015110: 2079 7361 6d70 6c65 203d 206e 702e 6c69   ysample = np.li
-00015120: 6e73 7061 6365 2873 792c 2065 792c 2033  nspace(sy, ey, 3
-00015130: 3329 0a0a 2020 2020 2020 2020 2320 4164  3)..        # Ad
-00015140: 6420 6120 736d 616c 6c20 6a69 7474 6572  d a small jitter
-00015150: 2073 6f20 7468 6174 2074 6865 7265 2061   so that there a
-00015160: 7265 206e 6f20 6661 6c73 6520 706f 7369  re no false posi
-00015170: 7469 7665 7320 666f 7220 6571 7561 6c69  tives for equali
-00015180: 7479 2e0a 2020 2020 2020 2020 2320 4578  ty..        # Ex
-00015190: 3a20 793d 3d78 2062 6563 6f6d 6573 2054  : y==x becomes T
-000151a0: 7275 6520 666f 7220 7820 696e 7465 7276  rue for x interv
-000151b0: 616c 2831 2c20 3229 2061 6e64 2079 2069  al(1, 2) and y i
-000151c0: 6e74 6572 7661 6c28 312c 2032 290a 2020  nterval(1, 2).  
-000151d0: 2020 2020 2020 2320 7768 6963 6820 7769        # which wi
-000151e0: 6c6c 2064 7261 7720 6120 7265 6374 616e  ll draw a rectan
-000151f0: 676c 652e 0a20 2020 2020 2020 206a 6974  gle..        jit
-00015200: 7465 7278 203d 2028 0a20 2020 2020 2020  terx = (.       
-00015210: 2020 2020 2028 6e70 2e72 616e 646f 6d2e       (np.random.
-00015220: 7261 6e64 286c 656e 2878 7361 6d70 6c65  rand(len(xsample
-00015230: 2929 202a 2032 202d 2031 290a 2020 2020  )) * 2 - 1).    
-00015240: 2020 2020 2020 2020 2a20 2865 7820 2d20          * (ex - 
-00015250: 7378 290a 2020 2020 2020 2020 2020 2020  sx).            
-00015260: 2f20 3220 2a2a 2032 300a 2020 2020 2020  / 2 ** 20.      
-00015270: 2020 290a 2020 2020 2020 2020 6a69 7474    ).        jitt
-00015280: 6572 7920 3d20 280a 2020 2020 2020 2020  ery = (.        
-00015290: 2020 2020 286e 702e 7261 6e64 6f6d 2e72      (np.random.r
-000152a0: 616e 6428 6c65 6e28 7973 616d 706c 6529  and(len(ysample)
-000152b0: 2920 2a20 3220 2d20 3129 0a20 2020 2020  ) * 2 - 1).     
-000152c0: 2020 2020 2020 202a 2028 6579 202d 2073         * (ey - s
-000152d0: 7929 0a20 2020 2020 2020 2020 2020 202f  y).            /
-000152e0: 2032 202a 2a20 3230 0a20 2020 2020 2020   2 ** 20.       
-000152f0: 2029 0a20 2020 2020 2020 2078 7361 6d70   ).        xsamp
-00015300: 6c65 202b 3d20 6a69 7474 6572 780a 2020  le += jitterx.  
-00015310: 2020 2020 2020 7973 616d 706c 6520 2b3d        ysample +=
-00015320: 206a 6974 7465 7279 0a0a 2020 2020 2020   jittery..      
-00015330: 2020 7869 6e74 6572 203d 205b 696e 7465    xinter = [inte
-00015340: 7276 616c 2878 312c 2078 3229 2066 6f72  rval(x1, x2) for
-00015350: 2078 312c 2078 3220 696e 207a 6970 2878   x1, x2 in zip(x
-00015360: 7361 6d70 6c65 5b3a 2d31 5d2c 2078 7361  sample[:-1], xsa
-00015370: 6d70 6c65 5b31 3a5d 295d 0a20 2020 2020  mple[1:])].     
-00015380: 2020 2079 696e 7465 7220 3d20 5b69 6e74     yinter = [int
-00015390: 6572 7661 6c28 7931 2c20 7932 2920 666f  erval(y1, y2) fo
-000153a0: 7220 7931 2c20 7932 2069 6e20 7a69 7028  r y1, y2 in zip(
-000153b0: 7973 616d 706c 655b 3a2d 315d 2c20 7973  ysample[:-1], ys
-000153c0: 616d 706c 655b 313a 5d29 5d0a 2020 2020  ample[1:])].    
-000153d0: 2020 2020 696e 7465 7276 616c 5f6c 6973      interval_lis
-000153e0: 7420 3d20 5b5b 782c 2079 5d20 666f 7220  t = [[x, y] for 
-000153f0: 7820 696e 2078 696e 7465 7220 666f 7220  x in xinter for 
-00015400: 7920 696e 2079 696e 7465 725d 0a20 2020  y in yinter].   
-00015410: 2020 2020 2070 6c6f 745f 6c69 7374 203d       plot_list =
-00015420: 205b 5d0a 0a20 2020 2020 2020 2023 2072   []..        # r
-00015430: 6563 7572 7369 7665 2063 616c 6c20 7265  ecursive call re
-00015440: 6669 6e65 7069 7865 6c73 2077 6869 6368  finepixels which
-00015450: 2073 7562 6469 7669 6465 7320 7468 6520   subdivides the 
-00015460: 696e 7465 7276 616c 7320 7768 6963 6820  intervals which 
-00015470: 6172 650a 2020 2020 2020 2020 2320 6e65  are.        # ne
-00015480: 6974 6865 7220 5472 7565 206e 6f72 2046  ither True nor F
-00015490: 616c 7365 2061 6363 6f72 6469 6e67 2074  alse according t
-000154a0: 6f20 7468 6520 6578 7072 6573 7369 6f6e  o the expression
-000154b0: 2e0a 2020 2020 2020 2020 6465 6620 7265  ..        def re
-000154c0: 6669 6e65 5f70 6978 656c 7328 696e 7465  fine_pixels(inte
-000154d0: 7276 616c 5f6c 6973 7429 3a0a 2020 2020  rval_list):.    
-000154e0: 2020 2020 2020 2020 2222 2245 7661 6c75          """Evalu
-000154f0: 6174 6573 2074 6865 2069 6e74 6572 7661  ates the interva
-00015500: 6c73 2061 6e64 2073 7562 6469 7669 6465  ls and subdivide
-00015510: 7320 7468 6520 696e 7465 7276 616c 2069  s the interval i
-00015520: 6620 7468 650a 2020 2020 2020 2020 2020  f the.          
-00015530: 2020 6578 7072 6573 7369 6f6e 2069 7320    expression is 
-00015540: 7061 7274 6961 6c6c 7920 7361 7469 7366  partially satisf
-00015550: 6965 642e 2222 220a 2020 2020 2020 2020  ied.""".        
-00015560: 2020 2020 7465 6d70 5f69 6e74 6572 7661      temp_interva
-00015570: 6c5f 6c69 7374 203d 205b 5d0a 2020 2020  l_list = [].    
-00015580: 2020 2020 2020 2020 706c 6f74 5f6c 6973          plot_lis
-00015590: 7420 3d20 5b5d 0a20 2020 2020 2020 2020  t = [].         
-000155a0: 2020 2066 6f72 2069 6e74 6572 7661 6c73     for intervals
-000155b0: 2069 6e20 696e 7465 7276 616c 5f6c 6973   in interval_lis
-000155c0: 743a 0a0a 2020 2020 2020 2020 2020 2020  t:..            
-000155d0: 2020 2020 2320 436f 6e76 6572 7420 7468      # Convert th
-000155e0: 6520 6172 7261 7920 696e 6469 6365 7320  e array indices 
-000155f0: 746f 2078 2061 6e64 2079 2076 616c 7565  to x and y value
-00015600: 730a 2020 2020 2020 2020 2020 2020 2020  s.              
-00015610: 2020 696e 7465 7276 616c 7820 3d20 696e    intervalx = in
-00015620: 7465 7276 616c 735b 305d 0a20 2020 2020  tervals[0].     
-00015630: 2020 2020 2020 2020 2020 2069 6e74 6572             inter
-00015640: 7661 6c79 203d 2069 6e74 6572 7661 6c73  valy = intervals
-00015650: 5b31 5d0a 2020 2020 2020 2020 2020 2020  [1].            
-00015660: 2020 2020 6675 6e63 5f65 7661 6c20 3d20      func_eval = 
-00015670: 6675 6e63 2869 6e74 6572 7661 6c78 2c20  func(intervalx, 
-00015680: 696e 7465 7276 616c 7929 0a20 2020 2020  intervaly).     
-00015690: 2020 2020 2020 2020 2020 2023 2054 6865             # The
-000156a0: 2065 7870 7265 7373 696f 6e20 6973 2076   expression is v
-000156b0: 616c 6964 2069 6e20 7468 6520 696e 7465  alid in the inte
-000156c0: 7276 616c 2e20 4368 616e 6765 2074 6865  rval. Change the
-000156d0: 2063 6f6e 746f 7572 0a20 2020 2020 2020   contour.       
-000156e0: 2020 2020 2020 2020 2023 2061 7272 6179           # array
-000156f0: 2076 616c 7565 7320 746f 2031 2e0a 2020   values to 1..  
-00015700: 2020 2020 2020 2020 2020 2020 2020 6966                if
-00015710: 2066 756e 635f 6576 616c 5b31 5d20 6973   func_eval[1] is
-00015720: 2046 616c 7365 206f 7220 6675 6e63 5f65   False or func_e
-00015730: 7661 6c5b 305d 2069 7320 4661 6c73 653a  val[0] is False:
-00015740: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00015750: 2020 2020 2070 6173 730a 2020 2020 2020       pass.      
-00015760: 2020 2020 2020 2020 2020 656c 6966 2066            elif f
-00015770: 756e 635f 6576 616c 203d 3d20 2854 7275  unc_eval == (Tru
-00015780: 652c 2054 7275 6529 3a0a 2020 2020 2020  e, True):.      
-00015790: 2020 2020 2020 2020 2020 2020 2020 706c                pl
-000157a0: 6f74 5f6c 6973 742e 6170 7065 6e64 285b  ot_list.append([
-000157b0: 696e 7465 7276 616c 782c 2069 6e74 6572  intervalx, inter
-000157c0: 7661 6c79 5d29 0a20 2020 2020 2020 2020  valy]).         
-000157d0: 2020 2020 2020 2065 6c69 6620 6675 6e63         elif func
-000157e0: 5f65 7661 6c5b 315d 2069 7320 4e6f 6e65  _eval[1] is None
-000157f0: 206f 7220 6675 6e63 5f65 7661 6c5b 305d   or func_eval[0]
-00015800: 2069 7320 4e6f 6e65 3a0a 2020 2020 2020   is None:.      
-00015810: 2020 2020 2020 2020 2020 2020 2020 2320                # 
-00015820: 5375 6264 6976 6964 650a 2020 2020 2020  Subdivide.      
-00015830: 2020 2020 2020 2020 2020 2020 2020 6176                av
-00015840: 6778 203d 2069 6e74 6572 7661 6c78 2e6d  gx = intervalx.m
-00015850: 6964 0a20 2020 2020 2020 2020 2020 2020  id.             
-00015860: 2020 2020 2020 2061 7667 7920 3d20 696e         avgy = in
-00015870: 7465 7276 616c 792e 6d69 640a 2020 2020  tervaly.mid.    
-00015880: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00015890: 6120 3d20 696e 7465 7276 616c 2869 6e74  a = interval(int
-000158a0: 6572 7661 6c78 2e73 7461 7274 2c20 6176  ervalx.start, av
-000158b0: 6778 290a 2020 2020 2020 2020 2020 2020  gx).            
-000158c0: 2020 2020 2020 2020 6220 3d20 696e 7465          b = inte
-000158d0: 7276 616c 2861 7667 782c 2069 6e74 6572  rval(avgx, inter
-000158e0: 7661 6c78 2e65 6e64 290a 2020 2020 2020  valx.end).      
-000158f0: 2020 2020 2020 2020 2020 2020 2020 6320                c 
-00015900: 3d20 696e 7465 7276 616c 2869 6e74 6572  = interval(inter
-00015910: 7661 6c79 2e73 7461 7274 2c20 6176 6779  valy.start, avgy
-00015920: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
-00015930: 2020 2020 2020 6420 3d20 696e 7465 7276        d = interv
-00015940: 616c 2861 7667 792c 2069 6e74 6572 7661  al(avgy, interva
-00015950: 6c79 2e65 6e64 290a 2020 2020 2020 2020  ly.end).        
-00015960: 2020 2020 2020 2020 2020 2020 7465 6d70              temp
-00015970: 5f69 6e74 6572 7661 6c5f 6c69 7374 2e61  _interval_list.a
-00015980: 7070 656e 6428 5b61 2c20 635d 290a 2020  ppend([a, c]).  
-00015990: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000159a0: 2020 7465 6d70 5f69 6e74 6572 7661 6c5f    temp_interval_
-000159b0: 6c69 7374 2e61 7070 656e 6428 5b61 2c20  list.append([a, 
-000159c0: 645d 290a 2020 2020 2020 2020 2020 2020  d]).            
-000159d0: 2020 2020 2020 2020 7465 6d70 5f69 6e74          temp_int
-000159e0: 6572 7661 6c5f 6c69 7374 2e61 7070 656e  erval_list.appen
-000159f0: 6428 5b62 2c20 635d 290a 2020 2020 2020  d([b, c]).      
-00015a00: 2020 2020 2020 2020 2020 2020 2020 7465                te
-00015a10: 6d70 5f69 6e74 6572 7661 6c5f 6c69 7374  mp_interval_list
-00015a20: 2e61 7070 656e 6428 5b62 2c20 645d 290a  .append([b, d]).
-00015a30: 2020 2020 2020 2020 2020 2020 7265 7475              retu
-00015a40: 726e 2074 656d 705f 696e 7465 7276 616c  rn temp_interval
-00015a50: 5f6c 6973 742c 2070 6c6f 745f 6c69 7374  _list, plot_list
-00015a60: 0a0a 2020 2020 2020 2020 7768 696c 6520  ..        while 
-00015a70: 6b20 3e3d 2030 2061 6e64 206c 656e 2869  k >= 0 and len(i
-00015a80: 6e74 6572 7661 6c5f 6c69 7374 293a 0a20  nterval_list):. 
-00015a90: 2020 2020 2020 2020 2020 2069 6e74 6572             inter
-00015aa0: 7661 6c5f 6c69 7374 2c20 706c 6f74 5f6c  val_list, plot_l
-00015ab0: 6973 745f 7465 6d70 203d 2072 6566 696e  ist_temp = refin
-00015ac0: 655f 7069 7865 6c73 2869 6e74 6572 7661  e_pixels(interva
-00015ad0: 6c5f 6c69 7374 290a 2020 2020 2020 2020  l_list).        
-00015ae0: 2020 2020 706c 6f74 5f6c 6973 742e 6578      plot_list.ex
-00015af0: 7465 6e64 2870 6c6f 745f 6c69 7374 5f74  tend(plot_list_t
-00015b00: 656d 7029 0a20 2020 2020 2020 2020 2020  emp).           
-00015b10: 206b 203d 206b 202d 2031 0a20 2020 2020   k = k - 1.     
-00015b20: 2020 2023 2043 6865 636b 2077 6865 7468     # Check wheth
-00015b30: 6572 2074 6865 2065 7870 7265 7373 696f  er the expressio
-00015b40: 6e20 7265 7072 6573 656e 7473 2061 6e20  n represents an 
-00015b50: 6571 7561 6c69 7479 0a20 2020 2020 2020  equality.       
-00015b60: 2023 2049 6620 6974 2072 6570 7265 7365   # If it represe
-00015b70: 6e74 7320 616e 2065 7175 616c 6974 792c  nts an equality,
-00015b80: 2074 6865 6e20 6e6f 6e65 206f 6620 7468   then none of th
-00015b90: 6520 696e 7465 7276 616c 730a 2020 2020  e intervals.    
-00015ba0: 2020 2020 2320 776f 756c 6420 6861 7665      # would have
-00015bb0: 2073 6174 6973 6669 6564 2074 6865 2065   satisfied the e
-00015bc0: 7870 7265 7373 696f 6e20 6475 6520 746f  xpression due to
-00015bd0: 2066 6c6f 6174 696e 6720 706f 696e 740a   floating point.
-00015be0: 2020 2020 2020 2020 2320 6469 6666 6572          # differ
-00015bf0: 656e 6365 732e 2041 6464 2061 6c6c 2074  ences. Add all t
-00015c00: 6865 2075 6e64 6563 6964 6564 2076 616c  he undecided val
-00015c10: 7565 7320 746f 2074 6865 2070 6c6f 742e  ues to the plot.
-00015c20: 0a20 2020 2020 2020 2069 6620 7365 6c66  .        if self
-00015c30: 2e68 6173 5f65 7175 616c 6974 793a 0a20  .has_equality:. 
-00015c40: 2020 2020 2020 2020 2020 2066 6f72 2069             for i
-00015c50: 6e74 6572 7661 6c73 2069 6e20 696e 7465  ntervals in inte
-00015c60: 7276 616c 5f6c 6973 743a 0a20 2020 2020  rval_list:.     
-00015c70: 2020 2020 2020 2020 2020 2069 6e74 6572             inter
-00015c80: 7661 6c78 203d 2069 6e74 6572 7661 6c73  valx = intervals
-00015c90: 5b30 5d0a 2020 2020 2020 2020 2020 2020  [0].            
-00015ca0: 2020 2020 696e 7465 7276 616c 7920 3d20      intervaly = 
-00015cb0: 696e 7465 7276 616c 735b 315d 0a20 2020  intervals[1].   
-00015cc0: 2020 2020 2020 2020 2020 2020 2066 756e               fun
-00015cd0: 635f 6576 616c 203d 2066 756e 6328 696e  c_eval = func(in
-00015ce0: 7465 7276 616c 782c 2069 6e74 6572 7661  tervalx, interva
-00015cf0: 6c79 290a 2020 2020 2020 2020 2020 2020  ly).            
-00015d00: 2020 2020 6966 2066 756e 635f 6576 616c      if func_eval
-00015d10: 5b31 5d20 616e 6420 6675 6e63 5f65 7661  [1] and func_eva
-00015d20: 6c5b 305d 2069 7320 6e6f 7420 4661 6c73  l[0] is not Fals
-00015d30: 653a 0a20 2020 2020 2020 2020 2020 2020  e:.             
-00015d40: 2020 2020 2020 2070 6c6f 745f 6c69 7374         plot_list
-00015d50: 2e61 7070 656e 6428 5b69 6e74 6572 7661  .append([interva
-00015d60: 6c78 2c20 696e 7465 7276 616c 795d 290a  lx, intervaly]).
-00015d70: 2020 2020 2020 2020 7265 7475 726e 2070          return p
-00015d80: 6c6f 745f 6c69 7374 2c20 2266 696c 6c22  lot_list, "fill"
-00015d90: 0a0a 2020 2020 6465 6620 5f67 6574 5f6d  ..    def _get_m
-00015da0: 6573 6865 735f 6772 6964 2873 656c 6629  eshes_grid(self)
-00015db0: 3a0a 2020 2020 2020 2020 2222 2247 656e  :.        """Gen
-00015dc0: 6572 6174 6573 2074 6865 206d 6573 6820  erates the mesh 
-00015dd0: 666f 7220 6765 6e65 7261 7469 6e67 2061  for generating a
-00015de0: 2063 6f6e 746f 7572 2e0a 0a20 2020 2020   contour...     
-00015df0: 2020 2049 6e20 7468 6520 6361 7365 206f     In the case o
-00015e00: 6620 6571 7561 6c69 7479 2c20 6060 636f  f equality, ``co
-00015e10: 6e74 6f75 7260 6020 6675 6e63 7469 6f6e  ntour`` function
-00015e20: 206f 6620 6d61 7470 6c6f 746c 6962 2063   of matplotlib c
-00015e30: 616e 0a20 2020 2020 2020 2062 6520 7573  an.        be us
-00015e40: 6564 2e20 496e 206f 7468 6572 2063 6173  ed. In other cas
-00015e50: 6573 2c20 6d61 7470 6c6f 746c 6962 2773  es, matplotlib's
-00015e60: 2060 6063 6f6e 746f 7572 6660 6020 6973   ``contourf`` is
-00015e70: 2075 7365 642e 0a20 2020 2020 2020 2022   used..        "
-00015e80: 2222 0a20 2020 2020 2020 206e 7020 3d20  "".        np = 
-00015e90: 696d 706f 7274 5f6d 6f64 756c 6528 276e  import_module('n
-00015ea0: 756d 7079 2729 0a0a 2020 2020 2020 2020  umpy')..        
-00015eb0: 7861 7272 6179 2c20 7961 7272 6179 2c20  xarray, yarray, 
-00015ec0: 7a5f 6772 6964 203d 2073 656c 662e 5f65  z_grid = self._e
-00015ed0: 7661 6c75 6174 6528 290a 2020 2020 2020  valuate().      
-00015ee0: 2020 5f72 652c 205f 696d 203d 206e 702e    _re, _im = np.
-00015ef0: 7265 616c 287a 5f67 7269 6429 2c20 6e70  real(z_grid), np
-00015f00: 2e69 6d61 6728 7a5f 6772 6964 290a 2020  .imag(z_grid).  
-00015f10: 2020 2020 2020 5f72 655b 6e70 2e69 6e76        _re[np.inv
-00015f20: 6572 7428 6e70 2e69 7363 6c6f 7365 285f  ert(np.isclose(_
-00015f30: 696d 2c20 6e70 2e7a 6572 6f73 5f6c 696b  im, np.zeros_lik
-00015f40: 6528 5f69 6d29 2929 5d20 3d20 6e70 2e6e  e(_im)))] = np.n
-00015f50: 616e 0a20 2020 2020 2020 2069 6620 7365  an.        if se
-00015f60: 6c66 2e5f 6973 5f65 7175 616c 6974 793a  lf._is_equality:
-00015f70: 0a20 2020 2020 2020 2020 2020 2072 6574  .            ret
-00015f80: 7572 6e20 7861 7272 6179 2c20 7961 7272  urn xarray, yarr
-00015f90: 6179 2c20 5f72 652c 2027 636f 6e74 6f75  ay, _re, 'contou
-00015fa0: 7227 0a20 2020 2020 2020 2072 6574 7572  r'.        retur
-00015fb0: 6e20 7861 7272 6179 2c20 7961 7272 6179  n xarray, yarray
-00015fc0: 2c20 5f72 652c 2027 636f 6e74 6f75 7266  , _re, 'contourf
-00015fd0: 270a 0a20 2020 2040 7374 6174 6963 6d65  '..    @staticme
-00015fe0: 7468 6f64 0a20 2020 2064 6566 205f 7072  thod.    def _pr
-00015ff0: 6570 726f 6365 7373 5f6d 6573 6867 7269  eprocess_meshgri
-00016000: 645f 6578 7072 6573 7369 6f6e 2865 7870  d_expression(exp
-00016010: 722c 2061 6461 7074 6976 6529 3a0a 2020  r, adaptive):.  
-00016020: 2020 2020 2020 2222 2249 6620 7468 6520        """If the 
-00016030: 6578 7072 6573 7369 6f6e 2069 7320 6120  expression is a 
-00016040: 5265 6c61 7469 6f6e 616c 2c20 7265 7772  Relational, rewr
-00016050: 6974 6520 6974 2061 7320 6120 7369 6e67  ite it as a sing
-00016060: 6c65 0a20 2020 2020 2020 2065 7870 7265  le.        expre
-00016070: 7373 696f 6e2e 0a0a 2020 2020 2020 2020  ssion...        
-00016080: 5265 7475 726e 730a 2020 2020 2020 2020  Returns.        
-00016090: 3d3d 3d3d 3d3d 3d0a 0a20 2020 2020 2020  =======..       
-000160a0: 2065 7870 7220 3a20 4578 7072 0a20 2020   expr : Expr.   
-000160b0: 2020 2020 2020 2020 2054 6865 2072 6577           The rew
-000160c0: 7269 7474 656e 2065 7870 7265 7373 696f  ritten expressio
-000160d0: 6e0a 0a20 2020 2020 2020 2065 7175 616c  n..        equal
-000160e0: 6974 7920 3a20 426f 6f6c 6561 6e0a 2020  ity : Boolean.  
-000160f0: 2020 2020 2020 2020 2020 5768 6574 6572            Wheter
-00016100: 2074 6865 206f 7269 6769 6e61 6c20 6578   the original ex
-00016110: 7072 6573 7369 6f6e 2077 6173 2061 6e20  pression was an 
-00016120: 4571 7561 6c69 7479 206f 7220 6e6f 742e  Equality or not.
-00016130: 0a20 2020 2020 2020 2022 2222 0a20 2020  .        """.   
-00016140: 2020 2020 2065 7175 616c 6974 7920 3d20       equality = 
-00016150: 4661 6c73 650a 2020 2020 2020 2020 6966  False.        if
-00016160: 2069 7369 6e73 7461 6e63 6528 6578 7072   isinstance(expr
-00016170: 2c20 4571 7561 6c69 7479 293a 0a20 2020  , Equality):.   
-00016180: 2020 2020 2020 2020 2065 7870 7220 3d20           expr = 
-00016190: 6578 7072 2e6c 6873 202d 2065 7870 722e  expr.lhs - expr.
-000161a0: 7268 730a 2020 2020 2020 2020 2020 2020  rhs.            
-000161b0: 6571 7561 6c69 7479 203d 2054 7275 650a  equality = True.
-000161c0: 2020 2020 2020 2020 656c 6966 2069 7369          elif isi
-000161d0: 6e73 7461 6e63 6528 6578 7072 2c20 2847  nstance(expr, (G
-000161e0: 7265 6174 6572 5468 616e 2c20 5374 7269  reaterThan, Stri
-000161f0: 6374 4772 6561 7465 7254 6861 6e29 293a  ctGreaterThan)):
-00016200: 0a20 2020 2020 2020 2020 2020 2065 7870  .            exp
-00016210: 7220 3d20 6578 7072 2e6c 6873 202d 2065  r = expr.lhs - e
-00016220: 7870 722e 7268 730a 2020 2020 2020 2020  xpr.rhs.        
-00016230: 656c 6966 2069 7369 6e73 7461 6e63 6528  elif isinstance(
-00016240: 6578 7072 2c20 284c 6573 7354 6861 6e2c  expr, (LessThan,
-00016250: 2053 7472 6963 744c 6573 7354 6861 6e29   StrictLessThan)
-00016260: 293a 0a20 2020 2020 2020 2020 2020 2065  ):.            e
-00016270: 7870 7220 3d20 6578 7072 2e72 6873 202d  xpr = expr.rhs -
-00016280: 2065 7870 722e 6c68 730a 2020 2020 2020   expr.lhs.      
-00016290: 2020 656c 6966 206e 6f74 2061 6461 7074    elif not adapt
-000162a0: 6976 653a 0a20 2020 2020 2020 2020 2020  ive:.           
-000162b0: 2072 6169 7365 204e 6f74 496d 706c 656d   raise NotImplem
-000162c0: 656e 7465 6445 7272 6f72 280a 2020 2020  entedError(.    
-000162d0: 2020 2020 2020 2020 2020 2020 2254 6865              "The
-000162e0: 2065 7870 7265 7373 696f 6e20 6973 206e   expression is n
-000162f0: 6f74 2073 7570 706f 7274 6564 2066 6f72  ot supported for
-00016300: 2022 0a20 2020 2020 2020 2020 2020 2020   ".             
-00016310: 2020 2022 706c 6f74 7469 6e67 2069 6e20     "plotting in 
-00016320: 756e 6966 6f72 6d20 6d65 7368 6564 2070  uniform meshed p
-00016330: 6c6f 742e 220a 2020 2020 2020 2020 2020  lot.".          
-00016340: 2020 290a 2020 2020 2020 2020 7265 7475    ).        retu
-00016350: 726e 2065 7870 722c 2065 7175 616c 6974  rn expr, equalit
-00016360: 790a 0a20 2020 2064 6566 2067 6574 5f6c  y..    def get_l
-00016370: 6162 656c 2873 656c 662c 2075 7365 5f6c  abel(self, use_l
-00016380: 6174 6578 3d46 616c 7365 2c20 7772 6170  atex=False, wrap
-00016390: 7065 723d 2224 2573 2422 293a 0a20 2020  per="$%s$"):.   
-000163a0: 2020 2020 2022 2222 5265 7475 726e 2074       """Return t
-000163b0: 6865 206c 6162 656c 2074 6f20 6265 2075  he label to be u
-000163c0: 7365 6420 746f 2064 6973 706c 6179 2074  sed to display t
-000163d0: 6865 2065 7870 7265 7373 696f 6e2e 0a0a  he expression...
-000163e0: 2020 2020 2020 2020 5061 7261 6d65 7465          Paramete
-000163f0: 7273 0a20 2020 2020 2020 203d 3d3d 3d3d  rs.        =====
-00016400: 3d3d 3d3d 3d0a 2020 2020 2020 2020 7573  =====.        us
-00016410: 655f 6c61 7465 7820 3a20 626f 6f6c 0a20  e_latex : bool. 
-00016420: 2020 2020 2020 2020 2020 2049 6620 4661             If Fa
-00016430: 6c73 652c 2074 6865 2073 7472 696e 6720  lse, the string 
-00016440: 7265 7072 6573 656e 7461 7469 6f6e 206f  representation o
-00016450: 6620 7468 6520 6578 7072 6573 7369 6f6e  f the expression
-00016460: 2069 7320 7265 7475 726e 6564 2e0a 2020   is returned..  
-00016470: 2020 2020 2020 2020 2020 4966 2054 7275            If Tru
-00016480: 652c 2074 6865 206c 6174 6578 2072 6570  e, the latex rep
-00016490: 7265 7365 6e74 6174 696f 6e20 6973 2072  resentation is r
-000164a0: 6574 7572 6e65 642e 0a20 2020 2020 2020  eturned..       
-000164b0: 2077 7261 7070 6572 203a 2073 7472 0a20   wrapper : str. 
-000164c0: 2020 2020 2020 2020 2020 2054 6865 2062             The b
-000164d0: 6163 6b65 6e64 206d 6967 6874 206e 6565  ackend might nee
-000164e0: 6420 7468 6520 6c61 7465 7820 7265 7072  d the latex repr
-000164f0: 6573 656e 7461 7469 6f6e 2074 6f20 6265  esentation to be
-00016500: 2077 7261 7070 6564 2062 790a 2020 2020   wrapped by.    
-00016510: 2020 2020 2020 2020 736f 6d65 2063 6861          some cha
-00016520: 7261 6374 6572 732e 2044 6566 6175 6c74  racters. Default
-00016530: 2074 6f20 6060 2224 2573 2422 6060 2e0a   to ``"$%s$"``..
-00016540: 0a20 2020 2020 2020 2052 6574 7572 6e73  .        Returns
-00016550: 0a20 2020 2020 2020 203d 3d3d 3d3d 3d3d  .        =======
-00016560: 0a20 2020 2020 2020 206c 6162 656c 203a  .        label :
-00016570: 2073 7472 0a20 2020 2020 2020 2022 2222   str.        """
-00016580: 0a20 2020 2020 2020 2069 6620 7573 655f  .        if use_
-00016590: 6c61 7465 7820 6973 2046 616c 7365 3a0a  latex is False:.
-000165a0: 2020 2020 2020 2020 2020 2020 7265 7475              retu
-000165b0: 726e 2073 656c 662e 5f6c 6162 656c 0a20  rn self._label. 
-000165c0: 2020 2020 2020 2069 6620 280a 2020 2020         if (.    
-000165d0: 2020 2020 2020 2020 2873 656c 662e 5f6c          (self._l
-000165e0: 6162 656c 203d 3d20 7374 7228 7365 6c66  abel == str(self
-000165f0: 2e5f 6164 6170 7469 7665 5f65 7870 7229  ._adaptive_expr)
-00016600: 2920 6f72 0a20 2020 2020 2020 2020 2020  ) or.           
-00016610: 2028 2245 7128 2573 2c20 3029 2220 2520   ("Eq(%s, 0)" % 
-00016620: 7365 6c66 2e5f 6c61 6265 6c20 3d3d 2073  self._label == s
-00016630: 7472 2873 656c 662e 5f61 6461 7074 6976  tr(self._adaptiv
-00016640: 655f 6578 7072 2929 0a20 2020 2020 2020  e_expr)).       
-00016650: 2029 3a0a 2020 2020 2020 2020 2020 2020   ):.            
-00016660: 7265 7475 726e 2073 656c 662e 5f67 6574  return self._get
-00016670: 5f77 7261 7070 6564 5f6c 6162 656c 2873  _wrapped_label(s
-00016680: 656c 662e 5f6c 6174 6578 5f6c 6162 656c  elf._latex_label
-00016690: 2c20 7772 6170 7065 7229 0a20 2020 2020  , wrapper).     
-000166a0: 2020 2072 6574 7572 6e20 7365 6c66 2e5f     return self._
-000166b0: 6c61 7465 785f 6c61 6265 6c0a 0a0a 636c  latex_label...cl
-000166c0: 6173 7320 496d 706c 6963 6974 3344 5365  ass Implicit3DSe
-000166d0: 7269 6573 280a 2020 2020 436f 6d6d 6f6e  ries(.    Common
-000166e0: 556e 6966 6f72 6d45 7661 6c75 6174 696f  UniformEvaluatio
-000166f0: 6e2c 2053 7572 6661 6365 4261 7365 5365  n, SurfaceBaseSe
-00016700: 7269 6573 0a29 3a0a 2020 2020 6973 5f69  ries.):.    is_i
-00016710: 6d70 6c69 6369 7420 3d20 5472 7565 0a20  mplicit = True. 
-00016720: 2020 205f 4e20 3d20 3630 0a0a 2020 2020     _N = 60..    
-00016730: 6465 6620 5f5f 696e 6974 5f5f 2873 656c  def __init__(sel
-00016740: 662c 2065 7870 722c 2072 616e 6765 5f78  f, expr, range_x
-00016750: 2c20 7261 6e67 655f 792c 2072 616e 6765  , range_y, range
-00016760: 5f7a 2c20 6c61 6265 6c3d 2222 2c20 2a2a  _z, label="", **
-00016770: 6b77 6172 6773 293a 0a20 2020 2020 2020  kwargs):.       
-00016780: 2073 7570 6572 2829 2e5f 5f69 6e69 745f   super().__init_
-00016790: 5f28 2a2a 6b77 6172 6773 290a 2020 2020  _(**kwargs).    
-000167a0: 2020 2020 7365 6c66 2e65 7870 7220 3d20      self.expr = 
-000167b0: 6578 7072 2069 6620 6361 6c6c 6162 6c65  expr if callable
-000167c0: 2865 7870 7229 2065 6c73 6520 7379 6d70  (expr) else symp
-000167d0: 6966 7928 6578 7072 290a 2020 2020 2020  ify(expr).      
-000167e0: 2020 7365 6c66 2e72 616e 6765 7320 3d20    self.ranges = 
-000167f0: 5b72 616e 6765 5f78 2c20 7261 6e67 655f  [range_x, range_
-00016800: 792c 2072 616e 6765 5f7a 5d0a 2020 2020  y, range_z].    
-00016810: 2020 2020 7365 6c66 2e76 6172 5f78 2c20      self.var_x, 
-00016820: 7365 6c66 2e73 7461 7274 5f78 2c20 7365  self.start_x, se
-00016830: 6c66 2e65 6e64 5f78 203d 2073 656c 662e  lf.end_x = self.
-00016840: 7261 6e67 6573 5b30 5d0a 2020 2020 2020  ranges[0].      
-00016850: 2020 7365 6c66 2e76 6172 5f79 2c20 7365    self.var_y, se
-00016860: 6c66 2e73 7461 7274 5f79 2c20 7365 6c66  lf.start_y, self
-00016870: 2e65 6e64 5f79 203d 2073 656c 662e 7261  .end_y = self.ra
-00016880: 6e67 6573 5b31 5d0a 2020 2020 2020 2020  nges[1].        
-00016890: 7365 6c66 2e76 6172 5f7a 2c20 7365 6c66  self.var_z, self
-000168a0: 2e73 7461 7274 5f7a 2c20 7365 6c66 2e65  .start_z, self.e
-000168b0: 6e64 5f7a 203d 2073 656c 662e 7261 6e67  nd_z = self.rang
-000168c0: 6573 5b32 5d0a 2020 2020 2020 2020 6966  es[2].        if
-000168d0: 2069 7369 6e73 7461 6e63 6528 7365 6c66   isinstance(self
-000168e0: 2e65 7870 722c 2050 6c61 6e65 293a 0a20  .expr, Plane):. 
-000168f0: 2020 2020 2020 2020 2020 2073 656c 662e             self.
-00016900: 6578 7072 203d 2073 656c 662e 6578 7072  expr = self.expr
-00016910: 2e65 7175 6174 696f 6e28 7365 6c66 2e76  .equation(self.v
-00016920: 6172 5f78 2c20 7365 6c66 2e76 6172 5f79  ar_x, self.var_y
-00016930: 2c20 7365 6c66 2e76 6172 5f7a 290a 2020  , self.var_z).  
-00016940: 2020 2020 2020 7365 6c66 2e5f 7365 745f        self._set_
-00016950: 7375 7266 6163 655f 6c61 6265 6c28 6c61  surface_label(la
-00016960: 6265 6c29 0a0a 2020 2020 6465 6620 5f5f  bel)..    def __
-00016970: 7374 725f 5f28 7365 6c66 293a 0a20 2020  str__(self):.   
-00016980: 2020 2020 2076 6172 5f78 2c20 7374 6172       var_x, star
-00016990: 745f 782c 2065 6e64 5f78 203d 2073 656c  t_x, end_x = sel
-000169a0: 662e 7261 6e67 6573 5b30 5d0a 2020 2020  f.ranges[0].    
-000169b0: 2020 2020 7661 725f 792c 2073 7461 7274      var_y, start
-000169c0: 5f79 2c20 656e 645f 7920 3d20 7365 6c66  _y, end_y = self
-000169d0: 2e72 616e 6765 735b 315d 0a20 2020 2020  .ranges[1].     
-000169e0: 2020 2076 6172 5f7a 2c20 7374 6172 745f     var_z, start_
-000169f0: 7a2c 2065 6e64 5f7a 203d 2073 656c 662e  z, end_z = self.
-00016a00: 7261 6e67 6573 5b32 5d0a 2020 2020 2020  ranges[2].      
-00016a10: 2020 7265 7475 726e 2028 0a20 2020 2020    return (.     
-00016a20: 2020 2020 2020 2022 696d 706c 6963 6974         "implicit
-00016a30: 2073 7572 6661 6365 2073 6572 6965 733a   surface series:
-00016a40: 2025 7320 666f 7220 2573 206f 7665 7220   %s for %s over 
-00016a50: 2573 2061 6e64 2025 7320 6f76 6572 2025  %s and %s over %
-00016a60: 7322 0a20 2020 2020 2020 2020 2020 2022  s".            "
-00016a70: 2061 6e64 2025 7320 6f76 6572 2025 7322   and %s over %s"
-00016a80: 2920 2520 280a 2020 2020 2020 2020 2020  ) % (.          
-00016a90: 2020 2020 2020 7374 7228 7365 6c66 2e65        str(self.e
-00016aa0: 7870 7229 2c0a 2020 2020 2020 2020 2020  xpr),.          
-00016ab0: 2020 2020 2020 7374 7228 7661 725f 7829        str(var_x)
-00016ac0: 2c20 7374 7228 2866 6c6f 6174 2873 7461  , str((float(sta
-00016ad0: 7274 5f78 292c 2066 6c6f 6174 2865 6e64  rt_x), float(end
-00016ae0: 5f78 2929 292c 0a20 2020 2020 2020 2020  _x))),.         
-00016af0: 2020 2020 2020 2073 7472 2876 6172 5f79         str(var_y
-00016b00: 292c 2073 7472 2828 666c 6f61 7428 7374  ), str((float(st
-00016b10: 6172 745f 7929 2c20 666c 6f61 7428 656e  art_y), float(en
-00016b20: 645f 7929 2929 2c0a 2020 2020 2020 2020  d_y))),.        
-00016b30: 2020 2020 2020 2020 7374 7228 7661 725f          str(var_
-00016b40: 7a29 2c20 7374 7228 2866 6c6f 6174 2873  z), str((float(s
-00016b50: 7461 7274 5f7a 292c 2066 6c6f 6174 2865  tart_z), float(e
-00016b60: 6e64 5f7a 2929 290a 2020 2020 2020 2020  nd_z))).        
-00016b70: 2020 2020 290a 0a20 2020 2064 6566 2067      )..    def g
-00016b80: 6574 5f64 6174 6128 7365 6c66 293a 0a20  et_data(self):. 
-00016b90: 2020 2020 2020 2022 2222 4576 616c 7561         """Evalua
-00016ba0: 7465 2074 6865 2065 7870 7265 7373 696f  te the expressio
-00016bb0: 6e20 6f76 6572 2074 6865 2070 726f 7669  n over the provi
-00016bc0: 6465 6420 646f 6d61 696e 2e20 5468 6520  ded domain. The 
-00016bd0: 6261 636b 656e 6420 7769 6c6c 0a20 2020  backend will.   
-00016be0: 2020 2020 2074 6865 6e20 7472 7920 746f       then try to
-00016bf0: 2063 6f6d 7075 7465 2061 6e64 2076 6973   compute and vis
-00016c00: 7561 6c69 7a65 2074 6865 2066 696e 616c  ualize the final
-00016c10: 2072 6573 756c 742c 2069 6620 6974 2073   result, if it s
-00016c20: 7570 706f 7274 2074 6869 730a 2020 2020  upport this.    
-00016c30: 2020 2020 6461 7461 2073 6572 6965 732e      data series.
-00016c40: 0a0a 2020 2020 2020 2020 5265 7475 726e  ..        Return
-00016c50: 730a 2020 2020 2020 2020 3d3d 3d3d 3d3d  s.        ======
-00016c60: 3d0a 2020 2020 2020 2020 6d65 7368 5f78  =.        mesh_x
-00016c70: 203a 206e 702e 6e64 6172 7261 7920 5b6e   : np.ndarray [n
-00016c80: 3120 7820 6e32 2078 206e 335d 0a20 2020  1 x n2 x n3].   
-00016c90: 2020 2020 206d 6573 685f 7920 3a20 6e70       mesh_y : np
-00016ca0: 2e6e 6461 7272 6179 205b 6e31 2078 206e  .ndarray [n1 x n
-00016cb0: 3220 7820 6e33 5d0a 2020 2020 2020 2020  2 x n3].        
-00016cc0: 6d65 7368 5f7a 203a 206e 702e 6e64 6172  mesh_z : np.ndar
-00016cd0: 7261 7920 5b6e 3120 7820 6e32 2078 206e  ray [n1 x n2 x n
-00016ce0: 335d 0a20 2020 2020 2020 2066 203a 206e  3].        f : n
-00016cf0: 702e 6e64 6172 7261 7920 5b6e 3120 7820  p.ndarray [n1 x 
-00016d00: 6e32 2078 206e 335d 0a20 2020 2020 2020  n2 x n3].       
-00016d10: 2022 2222 0a20 2020 2020 2020 206e 7020   """.        np 
-00016d20: 3d20 696d 706f 7274 5f6d 6f64 756c 6528  = import_module(
-00016d30: 276e 756d 7079 2729 0a0a 2020 2020 2020  'numpy')..      
-00016d40: 2020 7265 7375 6c74 7320 3d20 7365 6c66    results = self
-00016d50: 2e5f 6576 616c 7561 7465 2829 0a20 2020  ._evaluate().   
-00016d60: 2020 2020 2066 6f72 2069 2c20 7220 696e       for i, r in
-00016d70: 2065 6e75 6d65 7261 7465 2872 6573 756c   enumerate(resul
-00016d80: 7473 293a 0a20 2020 2020 2020 2020 2020  ts):.           
-00016d90: 2072 655f 762c 2069 6d5f 7620 3d20 6e70   re_v, im_v = np
-00016da0: 2e72 6561 6c28 7229 2c20 6e70 2e69 6d61  .real(r), np.ima
-00016db0: 6728 7229 0a20 2020 2020 2020 2020 2020  g(r).           
-00016dc0: 2072 655f 765b 6e70 2e69 6e76 6572 7428   re_v[np.invert(
-00016dd0: 6e70 2e69 7363 6c6f 7365 2869 6d5f 762c  np.isclose(im_v,
-00016de0: 206e 702e 7a65 726f 735f 6c69 6b65 2869   np.zeros_like(i
-00016df0: 6d5f 7629 2929 5d20 3d20 6e70 2e6e 616e  m_v)))] = np.nan
-00016e00: 0a20 2020 2020 2020 2020 2020 2072 6573  .            res
-00016e10: 756c 7473 5b69 5d20 3d20 7265 5f76 0a0a  ults[i] = re_v..
-00016e20: 2020 2020 2020 2020 7265 7475 726e 2073          return s
-00016e30: 656c 662e 5f61 7070 6c79 5f74 7261 6e73  elf._apply_trans
-00016e40: 666f 726d 282a 7265 7375 6c74 7329 0a0a  form(*results)..
-00016e50: 0a63 6c61 7373 2043 6f6d 706c 6578 506f  .class ComplexPo
-00016e60: 696e 7453 6572 6965 7328 4c69 6e65 3244  intSeries(Line2D
-00016e70: 4261 7365 5365 7269 6573 293a 0a20 2020  BaseSeries):.   
-00016e80: 2022 2222 5265 7072 6573 656e 7461 7469   """Representati
-00016e90: 6f6e 2066 6f72 2061 206c 696e 6520 696e  on for a line in
-00016ea0: 2074 6865 2063 6f6d 706c 6578 2070 6c61   the complex pla
-00016eb0: 6e65 2063 6f6e 7369 7374 696e 6720 6f66  ne consisting of
-00016ec0: 0a20 2020 206c 6973 7420 6f66 2070 6f69  .    list of poi
-00016ed0: 6e74 732e 2222 220a 0a20 2020 2064 6566  nts."""..    def
-00016ee0: 205f 5f69 6e69 745f 5f28 7365 6c66 2c20   __init__(self, 
-00016ef0: 6578 7072 2c20 6c61 6265 6c3d 2222 2c20  expr, label="", 
-00016f00: 2a2a 6b77 6172 6773 293a 0a20 2020 2020  **kwargs):.     
-00016f10: 2020 2073 7570 6572 2829 2e5f 5f69 6e69     super().__ini
-00016f20: 745f 5f28 6c61 6265 6c3d 6c61 6265 6c2c  t__(label=label,
-00016f30: 202a 2a6b 7761 7267 7329 0a20 2020 2020   **kwargs).     
-00016f40: 2020 2069 6620 6973 696e 7374 616e 6365     if isinstance
-00016f50: 2865 7870 722c 2028 6c69 7374 2c20 7475  (expr, (list, tu
-00016f60: 706c 6529 293a 0a20 2020 2020 2020 2020  ple)):.         
-00016f70: 2020 2073 656c 662e 6578 7072 203d 2054     self.expr = T
-00016f80: 7570 6c65 282a 6578 7072 290a 2020 2020  uple(*expr).    
-00016f90: 2020 2020 656c 6966 2069 7369 6e73 7461      elif isinsta
-00016fa0: 6e63 6528 6578 7072 2c20 4578 7072 293a  nce(expr, Expr):
-00016fb0: 0a20 2020 2020 2020 2020 2020 2073 656c  .            sel
-00016fc0: 662e 6578 7072 203d 2054 7570 6c65 2865  f.expr = Tuple(e
-00016fd0: 7870 7229 0a20 2020 2020 2020 2065 6c73  xpr).        els
-00016fe0: 653a 0a20 2020 2020 2020 2020 2020 2073  e:.            s
-00016ff0: 656c 662e 6578 7072 203d 2065 7870 720a  elf.expr = expr.
-00017000: 0a20 2020 2020 2020 2073 656c 662e 5f62  .        self._b
-00017010: 6c6f 636b 5f6c 616d 6264 615f 6675 6e63  lock_lambda_func
-00017020: 7469 6f6e 7328 2a73 656c 662e 6578 7072  tions(*self.expr
-00017030: 290a 0a20 2020 2020 2020 2073 656c 662e  )..        self.
-00017040: 6973 5f70 6f69 6e74 203d 206b 7761 7267  is_point = kwarg
-00017050: 732e 6765 7428 2273 6361 7474 6572 222c  s.get("scatter",
-00017060: 206b 7761 7267 732e 6765 7428 2269 735f   kwargs.get("is_
-00017070: 706f 696e 7422 2c20 5472 7565 2929 0a20  point", True)). 
-00017080: 2020 2020 2020 2069 6620 7365 6c66 2e75         if self.u
-00017090: 7365 5f63 6d20 616e 6420 7365 6c66 2e63  se_cm and self.c
-000170a0: 6f6c 6f72 5f66 756e 633a 0a20 2020 2020  olor_func:.     
-000170b0: 2020 2020 2020 2073 656c 662e 6973 5f70         self.is_p
-000170c0: 6172 616d 6574 7269 6320 3d20 5472 7565  arametric = True
-000170d0: 0a0a 2020 2020 6465 6620 5f67 6574 5f64  ..    def _get_d
-000170e0: 6174 615f 6865 6c70 6572 2873 656c 6629  ata_helper(self)
-000170f0: 3a0a 2020 2020 2020 2020 2222 2252 6574  :.        """Ret
-00017100: 7572 6e73 2063 6f6f 7264 696e 6174 6573  urns coordinates
-00017110: 2074 6861 7420 6e65 6564 7320 746f 2062   that needs to b
-00017120: 6520 706f 7374 7072 6f63 6573 7365 642e  e postprocessed.
-00017130: 2222 220a 2020 2020 2020 2020 6e70 203d  """.        np =
-00017140: 2069 6d70 6f72 745f 6d6f 6475 6c65 2827   import_module('
-00017150: 6e75 6d70 7927 290a 2020 2020 2020 2020  numpy').        
-00017160: 706f 696e 7473 203d 205b 636f 6d70 6c65  points = [comple
-00017170: 7828 702e 6576 616c 6628 7375 6273 3d73  x(p.evalf(subs=s
-00017180: 656c 662e 7061 7261 6d73 2929 2066 6f72  elf.params)) for
-00017190: 2070 2069 6e20 7365 6c66 2e65 7870 725d   p in self.expr]
-000171a0: 0a20 2020 2020 2020 2070 6f69 6e74 7320  .        points 
-000171b0: 3d20 6e70 2e61 7272 6179 2870 6f69 6e74  = np.array(point
-000171c0: 7329 0a20 2020 2020 2020 2072 2c20 6920  s).        r, i 
-000171d0: 3d20 6e70 2e72 6561 6c28 706f 696e 7473  = np.real(points
-000171e0: 292c 206e 702e 696d 6167 2870 6f69 6e74  ), np.imag(point
-000171f0: 7329 0a20 2020 2020 2020 2069 6620 7365  s).        if se
-00017200: 6c66 2e75 7365 5f63 6d20 616e 6420 6361  lf.use_cm and ca
-00017210: 6c6c 6162 6c65 2873 656c 662e 636f 6c6f  llable(self.colo
-00017220: 725f 6675 6e63 293a 0a20 2020 2020 2020  r_func):.       
-00017230: 2020 2020 2072 6574 7572 6e20 722c 2069       return r, i
-00017240: 2c20 7365 6c66 2e65 7661 6c5f 636f 6c6f  , self.eval_colo
-00017250: 725f 6675 6e63 2872 2c20 6929 0a20 2020  r_func(r, i).   
-00017260: 2020 2020 2072 6574 7572 6e20 722c 2069       return r, i
-00017270: 0a0a 2020 2020 6465 6620 5f5f 7374 725f  ..    def __str_
-00017280: 5f28 7365 6c66 293a 0a20 2020 2020 2020  _(self):.       
-00017290: 2072 6574 7572 6e20 7365 6c66 2e5f 7374   return self._st
-000172a0: 725f 6865 6c70 6572 2822 636f 6d70 6c65  r_helper("comple
-000172b0: 7820 706f 696e 7473 3a20 2573 2220 2520  x points: %s" % 
-000172c0: 7365 6c66 2e65 7870 7229 0a0a 0a63 6c61  self.expr)...cla
-000172d0: 7373 2043 6f6d 706c 6578 5375 7266 6163  ss ComplexSurfac
-000172e0: 6542 6173 6553 6572 6965 7328 5375 7266  eBaseSeries(Surf
-000172f0: 6163 6542 6173 6553 6572 6965 7329 3a0a  aceBaseSeries):.
-00017300: 2020 2020 2222 2252 6570 7265 7365 6e74      """Represent
-00017310: 2061 2063 6f6d 706c 6578 2066 756e 6374   a complex funct
-00017320: 696f 6e2e 2222 220a 2020 2020 6973 5f63  ion.""".    is_c
-00017330: 6f6d 706c 6578 203d 2054 7275 650a 2020  omplex = True.  
-00017340: 2020 5f4e 203d 2033 3030 0a0a 2020 2020    _N = 300..    
-00017350: 6465 6620 5f5f 696e 6974 5f5f 2873 656c  def __init__(sel
-00017360: 662c 2065 7870 722c 2072 2c20 6c61 6265  f, expr, r, labe
-00017370: 6c3d 2222 2c20 2a2a 6b77 6172 6773 293a  l="", **kwargs):
-00017380: 0a20 2020 2020 2020 2073 7570 6572 2829  .        super()
-00017390: 2e5f 5f69 6e69 745f 5f28 2a2a 6b77 6172  .__init__(**kwar
-000173a0: 6773 290a 2020 2020 2020 2020 7365 6c66  gs).        self
-000173b0: 2e72 616e 6765 7320 3d20 5b72 5d0a 2020  .ranges = [r].  
-000173c0: 2020 2020 2020 7365 6c66 2e5f 6c61 6265        self._labe
-000173d0: 6c20 3d20 7374 7228 6578 7072 2920 6966  l = str(expr) if
-000173e0: 206c 6162 656c 2069 7320 4e6f 6e65 2065   label is None e
-000173f0: 6c73 6520 6c61 6265 6c0a 2020 2020 2020  lse label.      
-00017400: 2020 7365 6c66 2e5f 6c61 7465 785f 6c61    self._latex_la
-00017410: 6265 6c20 3d20 6c61 7465 7828 6578 7072  bel = latex(expr
-00017420: 2920 6966 206c 6162 656c 2069 7320 4e6f  ) if label is No
-00017430: 6e65 2065 6c73 6520 6c61 6265 6c0a 2020  ne else label.  
-00017440: 2020 2020 2020 2320 6465 7465 726d 696e        # determin
-00017450: 6573 2077 6861 7420 6461 7461 2074 6f20  es what data to 
-00017460: 7265 7475 726e 206f 6e20 7468 6520 7a2d  return on the z-
-00017470: 6178 6973 0a20 2020 2020 2020 2073 656c  axis.        sel
-00017480: 662e 5f72 6574 7572 6e20 3d20 6b77 6172  f._return = kwar
-00017490: 6773 2e67 6574 2822 7265 7475 726e 222c  gs.get("return",
-000174a0: 204e 6f6e 6529 0a0a 2020 2020 4070 726f   None)..    @pro
-000174b0: 7065 7274 790a 2020 2020 6465 6620 7661  perty.    def va
-000174c0: 7228 7365 6c66 293a 0a20 2020 2020 2020  r(self):.       
-000174d0: 2072 6574 7572 6e20 7365 6c66 2e72 616e   return self.ran
-000174e0: 6765 735b 305d 5b30 5d0a 0a20 2020 2040  ges[0][0]..    @
-000174f0: 7072 6f70 6572 7479 0a20 2020 2064 6566  property.    def
-00017500: 2073 7461 7274 2873 656c 6629 3a0a 2020   start(self):.  
-00017510: 2020 2020 2020 7265 7475 726e 2073 656c        return sel
-00017520: 662e 7261 6e67 6573 5b30 5d5b 315d 0a0a  f.ranges[0][1]..
-00017530: 2020 2020 4070 726f 7065 7274 790a 2020      @property.  
-00017540: 2020 6465 6620 656e 6428 7365 6c66 293a    def end(self):
-00017550: 0a20 2020 2020 2020 2072 6574 7572 6e20  .        return 
-00017560: 7365 6c66 2e72 616e 6765 735b 305d 5b32  self.ranges[0][2
-00017570: 5d0a 0a20 2020 2064 6566 205f 5f73 7472  ]..    def __str
-00017580: 5f5f 2873 656c 6629 3a0a 2020 2020 2020  __(self):.      
-00017590: 2020 6966 2073 656c 662e 6973 5f64 6f6d    if self.is_dom
-000175a0: 6169 6e5f 636f 6c6f 7269 6e67 3a0a 2020  ain_coloring:.  
-000175b0: 2020 2020 2020 2020 2020 7072 6566 6978            prefix
-000175c0: 203d 2022 636f 6d70 6c65 7820 646f 6d61   = "complex doma
-000175d0: 696e 2063 6f6c 6f72 696e 6722 0a20 2020  in coloring".   
-000175e0: 2020 2020 2020 2020 2069 6620 7365 6c66           if self
-000175f0: 2e69 735f 3344 7375 7266 6163 653a 0a20  .is_3Dsurface:. 
-00017600: 2020 2020 2020 2020 2020 2020 2020 2070                 p
-00017610: 7265 6669 7820 3d20 2263 6f6d 706c 6578  refix = "complex
-00017620: 2033 4420 646f 6d61 696e 2063 6f6c 6f72   3D domain color
-00017630: 696e 6722 0a20 2020 2020 2020 2065 6c73  ing".        els
-00017640: 653a 0a20 2020 2020 2020 2020 2020 2070  e:.            p
-00017650: 7265 6669 7820 3d20 2263 6f6d 706c 6578  refix = "complex
-00017660: 2063 6172 7465 7369 616e 2073 7572 6661   cartesian surfa
-00017670: 6365 220a 2020 2020 2020 2020 2020 2020  ce".            
-00017680: 6966 2073 656c 662e 6973 5f63 6f6e 746f  if self.is_conto
-00017690: 7572 3a0a 2020 2020 2020 2020 2020 2020  ur:.            
-000176a0: 2020 2020 7072 6566 6978 203d 2022 636f      prefix = "co
-000176b0: 6d70 6c65 7820 636f 6e74 6f75 7222 0a0a  mplex contour"..
-000176c0: 2020 2020 2020 2020 7772 6170 7065 7220          wrapper 
-000176d0: 3d20 5f67 6574 5f77 7261 7070 6572 5f66  = _get_wrapper_f
-000176e0: 6f72 5f65 7870 7228 7365 6c66 2e5f 7265  or_expr(self._re
-000176f0: 7475 726e 290a 2020 2020 2020 2020 7265  turn).        re
-00017700: 732c 2072 6565 203d 2072 6528 7365 6c66  s, ree = re(self
-00017710: 2e73 7461 7274 292c 2072 6528 7365 6c66  .start), re(self
-00017720: 2e65 6e64 290a 2020 2020 2020 2020 696d  .end).        im
-00017730: 732c 2069 6d65 203d 2069 6d28 7365 6c66  s, ime = im(self
-00017740: 2e73 7461 7274 292c 2069 6d28 7365 6c66  .start), im(self
-00017750: 2e65 6e64 290a 2020 2020 2020 2020 6620  .end).        f 
-00017760: 3d20 6c61 6d62 6461 2074 3a20 666c 6f61  = lambda t: floa
-00017770: 7428 7429 2069 6620 6c65 6e28 742e 6672  t(t) if len(t.fr
-00017780: 6565 5f73 796d 626f 6c73 2920 3d3d 2030  ee_symbols) == 0
-00017790: 2065 6c73 6520 740a 0a20 2020 2020 2020   else t..       
-000177a0: 2072 6574 7572 6e20 7365 6c66 2e5f 7374   return self._st
-000177b0: 725f 6865 6c70 6572 280a 2020 2020 2020  r_helper(.      
-000177c0: 2020 2020 2020 7072 6566 6978 202b 2022        prefix + "
-000177d0: 3a20 2573 2066 6f72 2220 2220 7265 2825  : %s for" " re(%
-000177e0: 7329 206f 7665 7220 2573 2061 6e64 2069  s) over %s and i
-000177f0: 6d28 2573 2920 6f76 6572 2025 7322 2025  m(%s) over %s" %
-00017800: 2028 0a20 2020 2020 2020 2020 2020 2020   (.             
-00017810: 2020 2077 7261 7070 6572 2025 2073 656c     wrapper % sel
-00017820: 662e 6578 7072 2c0a 2020 2020 2020 2020  f.expr,.        
-00017830: 2020 2020 2020 2020 7374 7228 7365 6c66          str(self
-00017840: 2e76 6172 292c 0a20 2020 2020 2020 2020  .var),.         
-00017850: 2020 2020 2020 2073 7472 2828 6628 7265         str((f(re
-00017860: 7329 2c20 6628 7265 6529 2929 2c0a 2020  s), f(ree))),.  
-00017870: 2020 2020 2020 2020 2020 2020 2020 7374                st
-00017880: 7228 7365 6c66 2e76 6172 292c 0a20 2020  r(self.var),.   
-00017890: 2020 2020 2020 2020 2020 2020 2073 7472               str
-000178a0: 2828 6628 696d 7329 2c20 6628 696d 6529  ((f(ims), f(ime)
-000178b0: 2929 2c0a 2020 2020 2020 2020 2020 2020  )),.            
-000178c0: 290a 2020 2020 2020 2020 290a 0a20 2020  ).        )..   
-000178d0: 2064 6566 205f 6372 6561 7465 5f64 6973   def _create_dis
-000178e0: 6372 6574 697a 6564 5f64 6f6d 6169 6e28  cretized_domain(
-000178f0: 7365 6c66 293a 0a20 2020 2020 2020 2022  self):.        "
-00017900: 2222 4469 7363 7265 7469 7a65 2074 6865  ""Discretize the
-00017910: 2072 616e 6765 7320 696e 2063 6173 6520   ranges in case 
-00017920: 6f66 2075 6e69 666f 726d 206d 6573 6869  of uniform meshi
-00017930: 6e67 2073 7472 6174 6567 792e 0a20 2020  ng strategy..   
-00017940: 2020 2020 2022 2222 0a20 2020 2020 2020       """.       
-00017950: 206e 7020 3d20 696d 706f 7274 5f6d 6f64   np = import_mod
-00017960: 756c 6528 276e 756d 7079 2729 0a20 2020  ule('numpy').   
-00017970: 2020 2020 2073 7461 7274 5f78 203d 2073       start_x = s
-00017980: 656c 662e 5f75 7064 6174 655f 7261 6e67  elf._update_rang
-00017990: 655f 7661 6c75 6528 7365 6c66 2e73 7461  e_value(self.sta
-000179a0: 7274 292e 7265 616c 0a20 2020 2020 2020  rt).real.       
-000179b0: 2065 6e64 5f78 203d 2073 656c 662e 5f75   end_x = self._u
-000179c0: 7064 6174 655f 7261 6e67 655f 7661 6c75  pdate_range_valu
-000179d0: 6528 7365 6c66 2e65 6e64 292e 7265 616c  e(self.end).real
-000179e0: 0a20 2020 2020 2020 2073 7461 7274 5f79  .        start_y
-000179f0: 203d 2073 656c 662e 5f75 7064 6174 655f   = self._update_
-00017a00: 7261 6e67 655f 7661 6c75 6528 7365 6c66  range_value(self
-00017a10: 2e73 7461 7274 292e 696d 6167 0a20 2020  .start).imag.   
-00017a20: 2020 2020 2065 6e64 5f79 203d 2073 656c       end_y = sel
-00017a30: 662e 5f75 7064 6174 655f 7261 6e67 655f  f._update_range_
-00017a40: 7661 6c75 6528 7365 6c66 2e65 6e64 292e  value(self.end).
-00017a50: 696d 6167 0a20 2020 2020 2020 2078 203d  imag.        x =
-00017a60: 2073 656c 662e 5f64 6973 6372 6574 697a   self._discretiz
-00017a70: 6528 0a20 2020 2020 2020 2020 2020 2073  e(.            s
-00017a80: 7461 7274 5f78 2c20 656e 645f 782c 2073  tart_x, end_x, s
-00017a90: 656c 662e 6e5b 305d 2c20 7365 6c66 2e73  elf.n[0], self.s
-00017aa0: 6361 6c65 735b 305d 2c20 7365 6c66 2e6f  cales[0], self.o
-00017ab0: 6e6c 795f 696e 7465 6765 7273 290a 2020  nly_integers).  
-00017ac0: 2020 2020 2020 7920 3d20 7365 6c66 2e5f        y = self._
-00017ad0: 6469 7363 7265 7469 7a65 280a 2020 2020  discretize(.    
-00017ae0: 2020 2020 2020 2020 7374 6172 745f 792c          start_y,
-00017af0: 2065 6e64 5f79 2c20 7365 6c66 2e6e 5b31   end_y, self.n[1
-00017b00: 5d2c 2073 656c 662e 7363 616c 6573 5b31  ], self.scales[1
-00017b10: 5d2c 2073 656c 662e 6f6e 6c79 5f69 6e74  ], self.only_int
-00017b20: 6567 6572 7329 0a20 2020 2020 2020 2078  egers).        x
-00017b30: 782c 2079 7920 3d20 6e70 2e6d 6573 6867  x, yy = np.meshg
-00017b40: 7269 6428 782c 2079 290a 2020 2020 2020  rid(x, y).      
-00017b50: 2020 646f 6d61 696e 203d 2078 7820 2b20    domain = xx + 
-00017b60: 316a 202a 2079 790a 2020 2020 2020 2020  1j * yy.        
-00017b70: 7365 6c66 2e5f 6469 7363 7265 7469 7a65  self._discretize
-00017b80: 645f 646f 6d61 696e 203d 207b 7365 6c66  d_domain = {self
-00017b90: 2e76 6172 3a20 646f 6d61 696e 7d0a 0a0a  .var: domain}...
-00017ba0: 636c 6173 7320 436f 6d70 6c65 7853 7572  class ComplexSur
-00017bb0: 6661 6365 5365 7269 6573 280a 2020 2020  faceSeries(.    
-00017bc0: 436f 6d6d 6f6e 556e 6966 6f72 6d45 7661  CommonUniformEva
-00017bd0: 6c75 6174 696f 6e2c 2043 6f6d 706c 6578  luation, Complex
-00017be0: 5375 7266 6163 6542 6173 6553 6572 6965  SurfaceBaseSerie
-00017bf0: 730a 293a 0a20 2020 2022 2222 5265 7072  s.):.    """Repr
-00017c00: 6573 656e 7473 2061 2033 4420 7375 7266  esents a 3D surf
-00017c10: 6163 6520 6f72 2063 6f6e 746f 7572 2070  ace or contour p
-00017c20: 6c6f 7420 6f66 2061 2063 6f6d 706c 6578  lot of a complex
-00017c30: 2066 756e 6374 696f 6e20 6f76 6572 0a20   function over. 
-00017c40: 2020 2074 6865 2063 6f6d 706c 6578 2070     the complex p
-00017c50: 6c61 6e65 2e0a 2020 2020 2222 220a 2020  lane..    """.  
-00017c60: 2020 6973 5f33 4473 7572 6661 6365 203d    is_3Dsurface =
-00017c70: 2054 7275 650a 2020 2020 6973 5f63 6f6e   True.    is_con
-00017c80: 746f 7572 203d 2046 616c 7365 0a20 2020  tour = False.   
-00017c90: 2069 735f 646f 6d61 696e 5f63 6f6c 6f72   is_domain_color
-00017ca0: 696e 6720 3d20 4661 6c73 650a 2020 2020  ing = False.    
-00017cb0: 5f61 6c6c 6f77 6564 5f6b 6579 7320 3d20  _allowed_keys = 
-00017cc0: 5b22 7468 7265 6564 222c 2022 6973 5f66  ["threed", "is_f
-00017cd0: 696c 6c65 6422 2c20 2263 6c61 6265 6c73  illed", "clabels
-00017ce0: 225d 0a0a 2020 2020 6465 6620 5f5f 696e  "]..    def __in
-00017cf0: 6974 5f5f 2873 656c 662c 2065 7870 722c  it__(self, expr,
-00017d00: 2072 2c20 6c61 6265 6c3d 2222 2c20 2a2a   r, label="", **
-00017d10: 6b77 6172 6773 293a 0a20 2020 2020 2020  kwargs):.       
-00017d20: 2073 7570 6572 2829 2e5f 5f69 6e69 745f   super().__init_
-00017d30: 5f28 6578 7072 2c20 722c 206c 6162 656c  _(expr, r, label
-00017d40: 2c20 2a2a 6b77 6172 6773 290a 0a20 2020  , **kwargs)..   
-00017d50: 2020 2020 2073 656c 662e 6578 7072 203d       self.expr =
-00017d60: 2065 7870 7220 6966 2063 616c 6c61 626c   expr if callabl
-00017d70: 6528 6578 7072 2920 656c 7365 2073 796d  e(expr) else sym
-00017d80: 7069 6679 2865 7870 7229 0a20 2020 2020  pify(expr).     
-00017d90: 2020 2069 6620 6973 696e 7374 616e 6365     if isinstance
-00017da0: 2873 656c 662c 2043 6f6d 706c 6578 5375  (self, ComplexSu
-00017db0: 7266 6163 6553 6572 6965 7329 3a0a 2020  rfaceSeries):.  
-00017dc0: 2020 2020 2020 2020 2020 7365 6c66 2e5f            self._
-00017dd0: 626c 6f63 6b5f 6c61 6d62 6461 5f66 756e  block_lambda_fun
-00017de0: 6374 696f 6e73 2873 656c 662e 6578 7072  ctions(self.expr
-00017df0: 290a 0a20 2020 2020 2020 2069 6620 6e6f  )..        if no
-00017e00: 7420 6b77 6172 6773 2e67 6574 2822 7468  t kwargs.get("th
-00017e10: 7265 6564 222c 2046 616c 7365 293a 0a20  reed", False):. 
-00017e20: 2020 2020 2020 2020 2020 2073 656c 662e             self.
-00017e30: 6973 5f63 6f6e 746f 7572 203d 2054 7275  is_contour = Tru
-00017e40: 650a 2020 2020 2020 2020 2020 2020 7365  e.            se
-00017e50: 6c66 2e69 735f 3344 7375 7266 6163 6520  lf.is_3Dsurface 
-00017e60: 3d20 4661 6c73 650a 2020 2020 2020 2020  = False.        
-00017e70: 7365 6c66 2e69 735f 6669 6c6c 6564 203d  self.is_filled =
-00017e80: 206b 7761 7267 732e 6765 7428 2269 735f   kwargs.get("is_
-00017e90: 6669 6c6c 6564 222c 206b 7761 7267 732e  filled", kwargs.
-00017ea0: 6765 7428 2266 696c 6c22 2c20 5472 7565  get("fill", True
-00017eb0: 2929 0a20 2020 2020 2020 2073 656c 662e  )).        self.
-00017ec0: 7368 6f77 5f63 6c61 6265 6c73 203d 206b  show_clabels = k
-00017ed0: 7761 7267 732e 6765 7428 2263 6c61 6265  wargs.get("clabe
-00017ee0: 6c73 222c 2054 7275 6529 0a20 2020 2020  ls", True).     
-00017ef0: 2020 2073 656c 662e 5f70 6f73 745f 696e     self._post_in
-00017f00: 6974 2829 0a0a 2020 2020 6465 6620 5f63  it()..    def _c
-00017f10: 7265 6174 655f 6469 7363 7265 7469 7a65  reate_discretize
-00017f20: 645f 646f 6d61 696e 2873 656c 6629 3a0a  d_domain(self):.
-00017f30: 2020 2020 2020 2020 7265 7475 726e 2043          return C
-00017f40: 6f6d 706c 6578 5375 7266 6163 6542 6173  omplexSurfaceBas
-00017f50: 6553 6572 6965 732e 5f63 7265 6174 655f  eSeries._create_
-00017f60: 6469 7363 7265 7469 7a65 645f 646f 6d61  discretized_doma
-00017f70: 696e 2873 656c 6629 0a0a 2020 2020 6465  in(self)..    de
-00017f80: 6620 6765 745f 6461 7461 2873 656c 6629  f get_data(self)
-00017f90: 3a0a 2020 2020 2020 2020 2222 2252 6574  :.        """Ret
-00017fa0: 7572 6e20 6172 7261 7973 206f 6620 636f  urn arrays of co
-00017fb0: 6f72 6469 6e61 7465 7320 666f 7220 706c  ordinates for pl
-00017fc0: 6f74 7469 6e67 2e0a 0a20 2020 2020 2020  otting...       
-00017fd0: 2052 6574 7572 6e73 0a20 2020 2020 2020   Returns.       
-00017fe0: 203d 3d3d 3d3d 3d3d 0a0a 2020 2020 2020   =======..      
-00017ff0: 2020 6d65 7368 5f78 203a 206e 702e 6e64    mesh_x : np.nd
-00018000: 6172 7261 7920 5b6e 3220 7820 6e31 5d0a  array [n2 x n1].
-00018010: 2020 2020 2020 2020 2020 2020 5265 616c              Real
-00018020: 2064 6973 6372 6574 697a 6564 2064 6f6d   discretized dom
-00018030: 6169 6e2e 0a0a 2020 2020 2020 2020 6d65  ain...        me
-00018040: 7368 5f79 203a 206e 702e 6e64 6172 7261  sh_y : np.ndarra
-00018050: 7920 5b6e 3220 7820 6e31 5d0a 2020 2020  y [n2 x n1].    
-00018060: 2020 2020 2020 2020 496d 6167 696e 6172          Imaginar
-00018070: 7920 6469 7363 7265 7469 7a65 6420 646f  y discretized do
-00018080: 6d61 696e 2e0a 0a20 2020 2020 2020 207a  main...        z
-00018090: 203a 206e 702e 6e64 6172 7261 7920 5b6e   : np.ndarray [n
-000180a0: 3220 7820 6e31 5d0a 2020 2020 2020 2020  2 x n1].        
-000180b0: 2020 2020 5265 7375 6c74 7320 6f66 2074      Results of t
-000180c0: 6865 2065 7661 6c75 6174 696f 6e2e 0a20  he evaluation.. 
-000180d0: 2020 2020 2020 2022 2222 0a20 2020 2020         """.     
-000180e0: 2020 206e 7020 3d20 696d 706f 7274 5f6d     np = import_m
-000180f0: 6f64 756c 6528 276e 756d 7079 2729 0a0a  odule('numpy')..
-00018100: 2020 2020 2020 2020 646f 6d61 696e 2c20          domain, 
-00018110: 7a20 3d20 7365 6c66 2e5f 6576 616c 7561  z = self._evalua
-00018120: 7465 2846 616c 7365 290a 2020 2020 2020  te(False).      
-00018130: 2020 6966 2073 656c 662e 5f72 6574 7572    if self._retur
-00018140: 6e20 6973 204e 6f6e 653a 0a20 2020 2020  n is None:.     
-00018150: 2020 2020 2020 2070 6173 730a 2020 2020         pass.    
-00018160: 2020 2020 656c 6966 2073 656c 662e 5f72      elif self._r
-00018170: 6574 7572 6e20 3d3d 2022 7265 616c 223a  eturn == "real":
-00018180: 0a20 2020 2020 2020 2020 2020 207a 203d  .            z =
-00018190: 206e 702e 7265 616c 287a 290a 2020 2020   np.real(z).    
-000181a0: 2020 2020 656c 6966 2073 656c 662e 5f72      elif self._r
-000181b0: 6574 7572 6e20 3d3d 2022 696d 6167 223a  eturn == "imag":
-000181c0: 0a20 2020 2020 2020 2020 2020 207a 203d  .            z =
-000181d0: 206e 702e 696d 6167 287a 290a 2020 2020   np.imag(z).    
-000181e0: 2020 2020 656c 6966 2073 656c 662e 5f72      elif self._r
-000181f0: 6574 7572 6e20 3d3d 2022 6162 7322 3a0a  eturn == "abs":.
-00018200: 2020 2020 2020 2020 2020 2020 7a20 3d20              z = 
-00018210: 6e70 2e61 6273 6f6c 7574 6528 7a29 0a20  np.absolute(z). 
-00018220: 2020 2020 2020 2065 6c69 6620 7365 6c66         elif self
-00018230: 2e5f 7265 7475 726e 203d 3d20 2261 7267  ._return == "arg
-00018240: 223a 0a20 2020 2020 2020 2020 2020 207a  ":.            z
-00018250: 203d 206e 702e 616e 676c 6528 7a29 0a20   = np.angle(z). 
-00018260: 2020 2020 2020 2065 6c73 653a 0a20 2020         else:.   
-00018270: 2020 2020 2020 2020 2072 6169 7365 2056           raise V
-00018280: 616c 7565 4572 726f 7228 0a20 2020 2020  alueError(.     
-00018290: 2020 2020 2020 2020 2020 2022 605f 7265             "`_re
-000182a0: 7475 726e 6020 6e6f 7420 7265 636f 676e  turn` not recogn
-000182b0: 697a 6564 2e20 5265 6365 6976 6564 3a20  ized. Received: 
-000182c0: 2573 2220 2520 7365 6c66 2e5f 7265 7475  %s" % self._retu
-000182d0: 726e 290a 0a20 2020 2020 2020 2072 6574  rn)..        ret
-000182e0: 7572 6e20 7365 6c66 2e5f 6170 706c 795f  urn self._apply_
-000182f0: 7472 616e 7366 6f72 6d28 6e70 2e72 6561  transform(np.rea
-00018300: 6c28 646f 6d61 696e 292c 206e 702e 696d  l(domain), np.im
-00018310: 6167 2864 6f6d 6169 6e29 2c20 7a29 0a0a  ag(domain), z)..
-00018320: 0a63 6c61 7373 2043 6f6d 706c 6578 446f  .class ComplexDo
-00018330: 6d61 696e 436f 6c6f 7269 6e67 5365 7269  mainColoringSeri
-00018340: 6573 280a 2020 2020 436f 6d6d 6f6e 556e  es(.    CommonUn
-00018350: 6966 6f72 6d45 7661 6c75 6174 696f 6e2c  iformEvaluation,
-00018360: 2043 6f6d 706c 6578 5375 7266 6163 6542   ComplexSurfaceB
-00018370: 6173 6553 6572 6965 730a 293a 0a20 2020  aseSeries.):.   
-00018380: 2022 2222 5265 7072 6573 656e 7473 2061   """Represents a
-00018390: 2032 442f 3344 2064 6f6d 6169 6e20 636f   2D/3D domain co
-000183a0: 6c6f 7269 6e67 2070 6c6f 7420 6f66 2061  loring plot of a
-000183b0: 2063 6f6d 706c 6578 2066 756e 6374 696f   complex functio
-000183c0: 6e20 6f76 6572 0a20 2020 2074 6865 2063  n over.    the c
-000183d0: 6f6d 706c 6578 2070 6c61 6e65 2e0a 2020  omplex plane..  
-000183e0: 2020 2222 220a 2020 2020 6973 5f33 4473    """.    is_3Ds
-000183f0: 7572 6661 6365 203d 2046 616c 7365 0a20  urface = False. 
-00018400: 2020 2069 735f 646f 6d61 696e 5f63 6f6c     is_domain_col
-00018410: 6f72 696e 6720 3d20 5472 7565 0a20 2020  oring = True.   
-00018420: 205f 616c 6c6f 7765 645f 6b65 7973 203d   _allowed_keys =
-00018430: 205b 0a20 2020 2020 2020 2022 7468 7265   [.        "thre
-00018440: 6564 222c 2022 636f 6c6f 7269 6e67 222c  ed", "coloring",
-00018450: 2022 7068 6173 6572 6573 222c 2022 636d   "phaseres", "cm
-00018460: 6170 222c 2022 626c 6576 656c 222c 2022  ap", "blevel", "
-00018470: 7068 6173 656f 6666 7365 7422 2c0a 2020  phaseoffset",.  
-00018480: 2020 2020 2020 2263 6f6c 6f72 6261 7222        "colorbar"
-00018490: 2c20 2261 745f 696e 6669 6e69 7479 222c  , "at_infinity",
-000184a0: 2022 7269 656d 616e 6e5f 6d61 736b 222c   "riemann_mask",
-000184b0: 2022 616e 6e6f 7461 7465 220a 2020 2020   "annotate".    
-000184c0: 5d0a 0a20 2020 2064 6566 205f 5f69 6e69  ]..    def __ini
-000184d0: 745f 5f28 7365 6c66 2c20 6578 7072 2c20  t__(self, expr, 
-000184e0: 722c 206c 6162 656c 3d22 222c 202a 2a6b  r, label="", **k
-000184f0: 7761 7267 7329 3a0a 2020 2020 2020 2020  wargs):.        
-00018500: 7375 7065 7228 292e 5f5f 696e 6974 5f5f  super().__init__
-00018510: 2865 7870 722c 2072 2c20 6c61 6265 6c2c  (expr, r, label,
-00018520: 202a 2a6b 7761 7267 7329 0a20 2020 2020   **kwargs).     
-00018530: 2020 2069 6620 6b77 6172 6773 2e67 6574     if kwargs.get
-00018540: 2822 7468 7265 6564 222c 2046 616c 7365  ("threed", False
-00018550: 293a 0a20 2020 2020 2020 2020 2020 2073  ):.            s
-00018560: 656c 662e 6973 5f33 4473 7572 6661 6365  elf.is_3Dsurface
-00018570: 203d 2054 7275 650a 2020 2020 2020 2020   = True.        
-00018580: 2020 2020 7365 6c66 2e75 7365 5f63 6d20      self.use_cm 
-00018590: 3d20 6b77 6172 6773 2e67 6574 2822 7573  = kwargs.get("us
-000185a0: 655f 636d 222c 2054 7275 6529 0a0a 2020  e_cm", True)..  
-000185b0: 2020 2020 2020 7365 6c66 2e65 7870 7220        self.expr 
-000185c0: 3d20 6578 7072 2069 6620 6361 6c6c 6162  = expr if callab
-000185d0: 6c65 2865 7870 7229 2065 6c73 6520 7379  le(expr) else sy
-000185e0: 6d70 6966 7928 6578 7072 290a 2020 2020  mpify(expr).    
-000185f0: 2020 2020 2320 6170 706c 7920 7468 6520      # apply the 
-00018600: 7472 616e 7366 6f72 6d61 7469 6f6e 207a  transformation z
-00018610: 202d 3e20 312f 7a20 696e 206f 7264 6572   -> 1/z in order
-00018620: 2074 6f20 7374 7564 7920 7468 6520 6265   to study the be
-00018630: 6861 7669 6f72 0a20 2020 2020 2020 2023  havior.        #
-00018640: 206f 6620 7468 6520 6675 6e63 7469 6f6e   of the function
-00018650: 2061 7420 7a3d 696e 6669 6e69 7479 0a20   at z=infinity. 
-00018660: 2020 2020 2020 2073 656c 662e 6174 5f69         self.at_i
-00018670: 6e66 696e 6974 7920 3d20 6b77 6172 6773  nfinity = kwargs
-00018680: 2e67 6574 2822 6174 5f69 6e66 696e 6974  .get("at_infinit
-00018690: 7922 2c20 4661 6c73 6529 0a20 2020 2020  y", False).     
-000186a0: 2020 2069 6620 7365 6c66 2e61 745f 696e     if self.at_in
-000186b0: 6669 6e69 7479 3a0a 2020 2020 2020 2020  finity:.        
-000186c0: 2020 2020 6966 2063 616c 6c61 626c 6528      if callable(
-000186d0: 7365 6c66 2e65 7870 7229 3a0a 2020 2020  self.expr):.    
-000186e0: 2020 2020 2020 2020 2020 2020 7261 6973              rais
-000186f0: 6520 5661 6c75 6545 7272 6f72 280a 2020  e ValueError(.  
-00018700: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00018710: 2020 2260 6061 745f 696e 6669 6e69 7479    "``at_infinity
-00018720: 3d54 7275 6560 6020 6973 206f 6e6c 7920  =True`` is only 
-00018730: 7375 7070 6f72 7465 6420 666f 7220 7379  supported for sy
-00018740: 6d62 6f6c 6963 2022 0a20 2020 2020 2020  mbolic ".       
-00018750: 2020 2020 2020 2020 2020 2020 2022 6578               "ex
-00018760: 7072 6573 7369 6f6e 732e 2049 6e73 7465  pressions. Inste
-00018770: 6164 2c20 6120 6361 6c6c 6162 6c65 2077  ad, a callable w
-00018780: 6173 2070 726f 7669 6465 642e 2229 0a20  as provided."). 
-00018790: 2020 2020 2020 2020 2020 207a 203d 2073             z = s
-000187a0: 656c 662e 7261 6e67 6573 5b30 5d5b 305d  elf.ranges[0][0]
-000187b0: 0a20 2020 2020 2020 2020 2020 2074 6d70  .            tmp
-000187c0: 203d 2073 656c 662e 6578 7072 2e73 7562   = self.expr.sub
-000187d0: 7328 7a2c 2031 202f 207a 290a 2020 2020  s(z, 1 / z).    
-000187e0: 2020 2020 2020 2020 6966 2073 656c 662e          if self.
-000187f0: 5f6c 6162 656c 203d 3d20 7374 7228 7365  _label == str(se
-00018800: 6c66 2e65 7870 7229 3a0a 2020 2020 2020  lf.expr):.      
-00018810: 2020 2020 2020 2020 2020 2320 6164 6a75            # adju
-00018820: 7374 206c 6162 656c 7320 746f 2070 7265  st labels to pre
-00018830: 7665 6e74 2074 6865 2077 726f 6e67 206f  vent the wrong o
-00018840: 6e65 2074 6f20 6265 2073 6565 6e20 6f6e  ne to be seen on
-00018850: 2063 6f6c 6f72 6261 720a 2020 2020 2020   colorbar.      
-00018860: 2020 2020 2020 2020 2020 7365 6c66 2e5f            self._
-00018870: 6c61 6265 6c20 3d20 7374 7228 746d 7029  label = str(tmp)
-00018880: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00018890: 2073 656c 662e 5f6c 6174 6578 5f6c 6162   self._latex_lab
-000188a0: 656c 203d 206c 6174 6578 2874 6d70 290a  el = latex(tmp).
-000188b0: 2020 2020 2020 2020 2020 2020 7365 6c66              self
-000188c0: 2e65 7870 7220 3d20 746d 700a 0a20 2020  .expr = tmp..   
-000188d0: 2020 2020 2023 2064 6f6d 6169 6e20 636f       # domain co
-000188e0: 6c6f 7269 6e67 206d 6f64 650a 2020 2020  loring mode.    
-000188f0: 2020 2020 7365 6c66 2e5f 696e 6974 5f64      self._init_d
-00018900: 6f6d 6169 6e5f 636f 6c6f 7269 6e67 5f6b  omain_coloring_k
-00018910: 7728 2a2a 6b77 6172 6773 290a 0a20 2020  w(**kwargs)..   
-00018920: 2020 2020 2073 656c 662e 616e 6e6f 7461       self.annota
-00018930: 7465 203d 206b 7761 7267 732e 6765 7428  te = kwargs.get(
-00018940: 2261 6e6e 6f74 6174 6522 2c20 5472 7565  "annotate", True
-00018950: 290a 2020 2020 2020 2020 7365 6c66 2e72  ).        self.r
-00018960: 6965 6d61 6e6e 5f6d 6173 6b20 3d20 6b77  iemann_mask = kw
-00018970: 6172 6773 2e67 6574 2822 7269 656d 616e  args.get("rieman
-00018980: 6e5f 6d61 736b 222c 2046 616c 7365 290a  n_mask", False).
-00018990: 2020 2020 2020 2020 7365 6c66 2e5f 706f          self._po
-000189a0: 7374 5f69 6e69 7428 290a 0a20 2020 2064  st_init()..    d
-000189b0: 6566 205f 696e 6974 5f64 6f6d 6169 6e5f  ef _init_domain_
-000189c0: 636f 6c6f 7269 6e67 5f6b 7728 7365 6c66  coloring_kw(self
-000189d0: 2c20 2a2a 6b77 6172 6773 293a 0a20 2020  , **kwargs):.   
-000189e0: 2020 2020 2073 656c 662e 636f 6c6f 7269       self.colori
-000189f0: 6e67 203d 206b 7761 7267 732e 6765 7428  ng = kwargs.get(
-00018a00: 2263 6f6c 6f72 696e 6722 2c20 2261 2229  "coloring", "a")
-00018a10: 0a20 2020 2020 2020 2069 6620 6973 696e  .        if isin
-00018a20: 7374 616e 6365 2873 656c 662e 636f 6c6f  stance(self.colo
-00018a30: 7269 6e67 2c20 7374 7229 3a0a 2020 2020  ring, str):.    
-00018a40: 2020 2020 2020 2020 7365 6c66 2e63 6f6c          self.col
-00018a50: 6f72 696e 6720 3d20 7365 6c66 2e63 6f6c  oring = self.col
-00018a60: 6f72 696e 672e 6c6f 7765 7228 290a 2020  oring.lower().  
-00018a70: 2020 2020 2020 656c 6966 206e 6f74 2063        elif not c
-00018a80: 616c 6c61 626c 6528 7365 6c66 2e63 6f6c  allable(self.col
-00018a90: 6f72 696e 6729 3a0a 2020 2020 2020 2020  oring):.        
-00018aa0: 2020 2020 7261 6973 6520 5479 7065 4572      raise TypeEr
-00018ab0: 726f 7228 0a20 2020 2020 2020 2020 2020  ror(.           
-00018ac0: 2020 2020 2022 6063 6f6c 6f72 696e 6760       "`coloring`
-00018ad0: 206d 7573 7420 6265 2061 2063 6861 7261   must be a chara
-00018ae0: 6374 6572 2066 726f 6d20 2761 2720 746f  cter from 'a' to
-00018af0: 2027 6a27 206f 7220 220a 2020 2020 2020   'j' or ".      
-00018b00: 2020 2020 2020 2020 2020 2261 2063 616c            "a cal
-00018b10: 6c61 626c 652e 2229 0a20 2020 2020 2020  lable.").       
-00018b20: 2073 656c 662e 7068 6173 6572 6573 203d   self.phaseres =
-00018b30: 206b 7761 7267 732e 6765 7428 2270 6861   kwargs.get("pha
-00018b40: 7365 7265 7322 2c20 3230 290a 2020 2020  seres", 20).    
-00018b50: 2020 2020 7365 6c66 2e63 6d61 7020 3d20      self.cmap = 
-00018b60: 6b77 6172 6773 2e67 6574 2822 636d 6170  kwargs.get("cmap
-00018b70: 222c 204e 6f6e 6529 0a20 2020 2020 2020  ", None).       
-00018b80: 2073 656c 662e 626c 6576 656c 203d 2066   self.blevel = f
-00018b90: 6c6f 6174 286b 7761 7267 732e 6765 7428  loat(kwargs.get(
-00018ba0: 2262 6c65 7665 6c22 2c20 302e 3735 2929  "blevel", 0.75))
-00018bb0: 0a20 2020 2020 2020 2069 6620 7365 6c66  .        if self
-00018bc0: 2e62 6c65 7665 6c20 3c20 303a 0a20 2020  .blevel < 0:.   
-00018bd0: 2020 2020 2020 2020 2077 6172 6e69 6e67           warning
-00018be0: 732e 7761 726e 280a 2020 2020 2020 2020  s.warn(.        
-00018bf0: 2020 2020 2020 2020 2249 7420 6d75 7374          "It must
-00018c00: 2062 6520 3020 3c3d 2062 6c65 7665 6c20   be 0 <= blevel 
-00018c10: 3c3d 2031 2e20 4175 746f 6d61 7469 6361  <= 1. Automatica
-00018c20: 6c6c 7920 220a 2020 2020 2020 2020 2020  lly ".          
-00018c30: 2020 2020 2020 2273 6574 7469 6e67 2062        "setting b
-00018c40: 6c65 7665 6c20 3d20 302e 2229 0a20 2020  level = 0.").   
-00018c50: 2020 2020 2020 2020 2073 656c 662e 626c           self.bl
-00018c60: 6576 656c 203d 2030 0a20 2020 2020 2020  evel = 0.       
-00018c70: 2069 6620 7365 6c66 2e62 6c65 7665 6c20   if self.blevel 
-00018c80: 3e20 313a 0a20 2020 2020 2020 2020 2020  > 1:.           
-00018c90: 2077 6172 6e69 6e67 732e 7761 726e 280a   warnings.warn(.
-00018ca0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00018cb0: 2249 7420 6d75 7374 2062 6520 3020 3c3d  "It must be 0 <=
-00018cc0: 2062 6c65 7665 6c20 3c3d 2031 2e20 4175   blevel <= 1. Au
-00018cd0: 746f 6d61 7469 6361 6c6c 7920 220a 2020  tomatically ".  
-00018ce0: 2020 2020 2020 2020 2020 2020 2020 2273                "s
-00018cf0: 6574 7469 6e67 2062 6c65 7665 6c20 3d20  etting blevel = 
-00018d00: 312e 2229 0a20 2020 2020 2020 2020 2020  1.").           
-00018d10: 2073 656c 662e 626c 6576 656c 203d 2031   self.blevel = 1
-00018d20: 0a20 2020 2020 2020 2073 656c 662e 7068  .        self.ph
-00018d30: 6173 656f 6666 7365 7420 3d20 666c 6f61  aseoffset = floa
-00018d40: 7428 6b77 6172 6773 2e67 6574 2822 7068  t(kwargs.get("ph
-00018d50: 6173 656f 6666 7365 7422 2c20 3029 290a  aseoffset", 0)).
-00018d60: 0a20 2020 2064 6566 205f 6372 6561 7465  .    def _create
-00018d70: 5f64 6973 6372 6574 697a 6564 5f64 6f6d  _discretized_dom
-00018d80: 6169 6e28 7365 6c66 293a 0a20 2020 2020  ain(self):.     
-00018d90: 2020 2072 6574 7572 6e20 436f 6d70 6c65     return Comple
-00018da0: 7853 7572 6661 6365 4261 7365 5365 7269  xSurfaceBaseSeri
-00018db0: 6573 2e5f 6372 6561 7465 5f64 6973 6372  es._create_discr
-00018dc0: 6574 697a 6564 5f64 6f6d 6169 6e28 7365  etized_domain(se
-00018dd0: 6c66 290a 0a20 2020 2064 6566 205f 646f  lf)..    def _do
-00018de0: 6d61 696e 5f63 6f6c 6f72 696e 6728 7365  main_coloring(se
-00018df0: 6c66 2c20 646f 6d61 696e 2c20 7729 3a0a  lf, domain, w):.
-00018e00: 2020 2020 2020 2020 6966 2069 7369 6e73          if isins
-00018e10: 7461 6e63 6528 7365 6c66 2e63 6f6c 6f72  tance(self.color
-00018e20: 696e 672c 2073 7472 293a 0a20 2020 2020  ing, str):.     
-00018e30: 2020 2020 2020 2073 656c 662e 636f 6c6f         self.colo
-00018e40: 7269 6e67 203d 2073 656c 662e 636f 6c6f  ring = self.colo
-00018e50: 7269 6e67 2e6c 6f77 6572 2829 0a20 2020  ring.lower().   
-00018e60: 2020 2020 2020 2020 2072 6574 7572 6e20           return 
-00018e70: 7765 6765 7274 280a 2020 2020 2020 2020  wegert(.        
-00018e80: 2020 2020 2020 2020 7365 6c66 2e63 6f6c          self.col
-00018e90: 6f72 696e 672c 2077 2c20 7365 6c66 2e70  oring, w, self.p
-00018ea0: 6861 7365 7265 732c 2073 656c 662e 636d  haseres, self.cm
-00018eb0: 6170 2c0a 2020 2020 2020 2020 2020 2020  ap,.            
-00018ec0: 2020 2020 7365 6c66 2e62 6c65 7665 6c2c      self.blevel,
-00018ed0: 2073 656c 662e 7068 6173 656f 6666 7365   self.phaseoffse
-00018ee0: 742c 0a20 2020 2020 2020 2020 2020 2020  t,.             
-00018ef0: 2020 2073 656c 662e 6174 5f69 6e66 696e     self.at_infin
-00018f00: 6974 792c 2073 656c 662e 7269 656d 616e  ity, self.rieman
-00018f10: 6e5f 6d61 736b 2c0a 2020 2020 2020 2020  n_mask,.        
-00018f20: 2020 2020 2020 2020 646f 6d61 696e 3d5b          domain=[
-00018f30: 646f 6d61 696e 5b30 2c20 305d 2c20 646f  domain[0, 0], do
-00018f40: 6d61 696e 5b2d 312c 202d 315d 5d29 0a20  main[-1, -1]]). 
-00018f50: 2020 2020 2020 2072 6574 7572 6e20 7365         return se
-00018f60: 6c66 2e63 6f6c 6f72 696e 6728 7729 0a0a  lf.coloring(w)..
-00018f70: 2020 2020 6465 6620 6765 745f 6461 7461      def get_data
-00018f80: 2873 656c 6629 3a0a 2020 2020 2020 2020  (self):.        
-00018f90: 2222 2252 6574 7572 6e20 6172 7261 7973  """Return arrays
-00018fa0: 206f 6620 636f 6f72 6469 6e61 7465 7320   of coordinates 
-00018fb0: 666f 7220 706c 6f74 7469 6e67 2e0a 0a20  for plotting... 
-00018fc0: 2020 2020 2020 2052 6574 7572 6e73 0a20         Returns. 
-00018fd0: 2020 2020 2020 203d 3d3d 3d3d 3d3d 0a0a         =======..
-00018fe0: 2020 2020 2020 2020 6d65 7368 5f78 203a          mesh_x :
-00018ff0: 206e 702e 6e64 6172 7261 7920 5b6e 3220   np.ndarray [n2 
-00019000: 7820 6e31 5d0a 2020 2020 2020 2020 2020  x n1].          
-00019010: 2020 5265 616c 2064 6973 6372 6574 697a    Real discretiz
-00019020: 6564 2064 6f6d 6169 6e2e 0a0a 2020 2020  ed domain...    
-00019030: 2020 2020 6d65 7368 5f79 203a 206e 702e      mesh_y : np.
-00019040: 6e64 6172 7261 7920 5b6e 3220 7820 6e31  ndarray [n2 x n1
-00019050: 5d0a 2020 2020 2020 2020 2020 2020 496d  ].            Im
-00019060: 6167 696e 6172 7920 6469 7363 7265 7469  aginary discreti
-00019070: 7a65 6420 646f 6d61 696e 2e0a 0a20 2020  zed domain...   
-00019080: 2020 2020 2061 6273 203a 206e 702e 6e64       abs : np.nd
-00019090: 6172 7261 7920 5b6e 3220 7820 6e31 5d0a  array [n2 x n1].
-000190a0: 2020 2020 2020 2020 2020 2020 4162 736f              Abso
-000190b0: 6c75 7465 2076 616c 7565 206f 6620 7468  lute value of th
-000190c0: 6520 6675 6e63 7469 6f6e 2e0a 0a20 2020  e function...   
-000190d0: 2020 2020 2061 7267 203a 206e 702e 6e64       arg : np.nd
-000190e0: 6172 7261 7920 5b6e 3220 7820 6e31 5d0a  array [n2 x n1].
-000190f0: 2020 2020 2020 2020 2020 2020 4172 6775              Argu
-00019100: 6d65 6e74 206f 6620 7468 6520 6675 6e63  ment of the func
-00019110: 7469 6f6e 2e0a 0a20 2020 2020 2020 2069  tion...        i
-00019120: 6d67 203a 206e 702e 6e64 6172 7261 7920  mg : np.ndarray 
-00019130: 5b6e 3220 7820 6e31 2078 2033 5d0a 2020  [n2 x n1 x 3].  
-00019140: 2020 2020 2020 2020 2020 5247 4220 696d            RGB im
-00019150: 6167 6520 7661 6c75 6573 2063 6f6d 7075  age values compu
-00019160: 7465 6420 6672 6f6d 2074 6865 2061 7267  ted from the arg
-00019170: 756d 656e 7420 6f66 2074 6865 2066 756e  ument of the fun
-00019180: 6374 696f 6e2e 0a20 2020 2020 2020 2020  ction..         
-00019190: 2020 2030 203c 3d20 522c 2047 2c20 4220     0 <= R, G, B 
-000191a0: 3c3d 2032 3535 0a0a 2020 2020 2020 2020  <= 255..        
-000191b0: 636f 6c6f 7273 203a 206e 702e 6e64 6172  colors : np.ndar
-000191c0: 7261 7920 5b32 3536 2078 2033 5d0a 2020  ray [256 x 3].  
-000191d0: 2020 2020 2020 2020 2020 436f 6c6f 7220            Color 
-000191e0: 7363 616c 6520 6173 736f 6369 6174 6564  scale associated
-000191f0: 2074 6f20 6069 6d67 602e 0a20 2020 2020   to `img`..     
-00019200: 2020 2022 2222 0a20 2020 2020 2020 206e     """.        n
-00019210: 7020 3d20 696d 706f 7274 5f6d 6f64 756c  p = import_modul
-00019220: 6528 276e 756d 7079 2729 0a0a 2020 2020  e('numpy')..    
-00019230: 2020 2020 646f 6d61 696e 2c20 7a20 3d20      domain, z = 
-00019240: 7365 6c66 2e5f 6576 616c 7561 7465 2846  self._evaluate(F
-00019250: 616c 7365 290a 2020 2020 2020 2020 7265  alse).        re
-00019260: 7475 726e 2073 656c 662e 5f61 7070 6c79  turn self._apply
-00019270: 5f74 7261 6e73 666f 726d 280a 2020 2020  _transform(.    
-00019280: 2020 2020 2020 2020 6e70 2e72 6561 6c28          np.real(
-00019290: 646f 6d61 696e 292c 206e 702e 696d 6167  domain), np.imag
-000192a0: 2864 6f6d 6169 6e29 2c0a 2020 2020 2020  (domain),.      
-000192b0: 2020 2020 2020 6e70 2e61 6273 6f6c 7574        np.absolut
-000192c0: 6528 7a29 2c20 6e70 2e61 6e67 6c65 287a  e(z), np.angle(z
-000192d0: 292c 0a20 2020 2020 2020 2020 2020 202a  ),.            *
-000192e0: 7365 6c66 2e5f 646f 6d61 696e 5f63 6f6c  self._domain_col
-000192f0: 6f72 696e 6728 646f 6d61 696e 2c20 7a29  oring(domain, z)
-00019300: 2c0a 2020 2020 2020 2020 290a 0a0a 636c  ,.        )...cl
-00019310: 6173 7320 436f 6d70 6c65 7850 6172 616d  ass ComplexParam
-00019320: 6574 7269 6333 444c 696e 6553 6572 6965  etric3DLineSerie
-00019330: 7328 5061 7261 6d65 7472 6963 3344 4c69  s(Parametric3DLi
-00019340: 6e65 5365 7269 6573 293a 0a20 2020 2022  neSeries):.    "
-00019350: 2222 5265 7072 6573 656e 7420 6120 6d65  ""Represent a me
-00019360: 7368 2f77 6972 6566 7261 6d65 206c 696e  sh/wireframe lin
-00019370: 6520 6f66 2061 2063 6f6d 706c 6578 2073  e of a complex s
-00019380: 7572 6661 6365 2073 6572 6965 732e 0a20  urface series.. 
-00019390: 2020 2022 2222 0a0a 2020 2020 6465 6620     """..    def 
-000193a0: 5f5f 696e 6974 5f5f 2873 656c 662c 202a  __init__(self, *
-000193b0: 6172 6773 2c20 2a2a 6b77 6172 6773 293a  args, **kwargs):
-000193c0: 0a20 2020 2020 2020 2073 7570 6572 2829  .        super()
-000193d0: 2e5f 5f69 6e69 745f 5f28 2a61 7267 732c  .__init__(*args,
-000193e0: 202a 2a6b 7761 7267 7329 0a20 2020 2020   **kwargs).     
-000193f0: 2020 2023 2064 6574 6572 6d69 6e65 7320     # determines 
-00019400: 7768 6174 2064 6174 6120 746f 2072 6574  what data to ret
-00019410: 7572 6e20 6f6e 2074 6865 207a 2d61 7869  urn on the z-axi
-00019420: 730a 2020 2020 2020 2020 7365 6c66 2e5f  s.        self._
-00019430: 7265 7475 726e 203d 206b 7761 7267 732e  return = kwargs.
-00019440: 6765 7428 2272 6574 7572 6e22 2c20 4e6f  get("return", No
-00019450: 6e65 290a 0a20 2020 2064 6566 205f 6164  ne)..    def _ad
-00019460: 6170 7469 7665 5f73 616d 706c 696e 6728  aptive_sampling(
-00019470: 7365 6c66 293a 0a20 2020 2020 2020 2072  self):.        r
-00019480: 6169 7365 204e 6f74 496d 706c 656d 656e  aise NotImplemen
-00019490: 7465 6445 7272 6f72 0a0a 2020 2020 6465  tedError..    de
-000194a0: 6620 5f75 6e69 666f 726d 5f73 616d 706c  f _uniform_sampl
-000194b0: 696e 6728 7365 6c66 293a 0a20 2020 2020  ing(self):.     
-000194c0: 2020 2022 2222 5265 7475 726e 7320 636f     """Returns co
-000194d0: 6f72 6469 6e61 7465 7320 7468 6174 206e  ordinates that n
-000194e0: 6565 6473 2074 6f20 6265 2070 6f73 7470  eeds to be postp
-000194f0: 726f 6365 7373 6564 2e22 2222 0a20 2020  rocessed.""".   
-00019500: 2020 2020 206e 7020 3d20 696d 706f 7274       np = import
-00019510: 5f6d 6f64 756c 6528 276e 756d 7079 2729  _module('numpy')
-00019520: 0a0a 2020 2020 2020 2020 7265 7375 6c74  ..        result
-00019530: 7320 3d20 7365 6c66 2e5f 6576 616c 7561  s = self._evalua
-00019540: 7465 2829 0a20 2020 2020 2020 2066 6f72  te().        for
-00019550: 2069 2069 6e20 7261 6e67 6528 6c65 6e28   i in range(len(
-00019560: 7265 7375 6c74 7329 202d 2031 293a 0a20  results) - 1):. 
-00019570: 2020 2020 2020 2020 2020 205f 7265 2c20             _re, 
-00019580: 5f69 6d20 3d20 6e70 2e72 6561 6c28 7265  _im = np.real(re
-00019590: 7375 6c74 735b 695d 292c 206e 702e 696d  sults[i]), np.im
-000195a0: 6167 2872 6573 756c 7473 5b69 5d29 0a20  ag(results[i]). 
-000195b0: 2020 2020 2020 2020 2020 205f 7265 5b6e             _re[n
-000195c0: 702e 696e 7665 7274 286e 702e 6973 636c  p.invert(np.iscl
-000195d0: 6f73 6528 5f69 6d2c 206e 702e 7a65 726f  ose(_im, np.zero
-000195e0: 735f 6c69 6b65 285f 696d 2929 295d 203d  s_like(_im)))] =
-000195f0: 206e 702e 6e61 6e0a 2020 2020 2020 2020   np.nan.        
-00019600: 2020 2020 7265 7375 6c74 735b 695d 203d      results[i] =
-00019610: 205f 7265 0a0a 2020 2020 2020 2020 6966   _re..        if
-00019620: 2073 656c 662e 5f72 6574 7572 6e20 6973   self._return is
-00019630: 204e 6f6e 653a 0a20 2020 2020 2020 2020   None:.         
-00019640: 2020 2070 6173 730a 2020 2020 2020 2020     pass.        
-00019650: 656c 6966 2073 656c 662e 5f72 6574 7572  elif self._retur
-00019660: 6e20 3d3d 2022 7265 616c 223a 0a20 2020  n == "real":.   
-00019670: 2020 2020 2020 2020 2072 6573 756c 7473           results
-00019680: 5b2d 315d 203d 206e 702e 7265 616c 2872  [-1] = np.real(r
-00019690: 6573 756c 7473 5b2d 315d 290a 2020 2020  esults[-1]).    
-000196a0: 2020 2020 656c 6966 2073 656c 662e 5f72      elif self._r
-000196b0: 6574 7572 6e20 3d3d 2022 696d 6167 223a  eturn == "imag":
-000196c0: 0a20 2020 2020 2020 2020 2020 2072 6573  .            res
-000196d0: 756c 7473 5b2d 315d 203d 206e 702e 696d  ults[-1] = np.im
-000196e0: 6167 2872 6573 756c 7473 5b2d 315d 290a  ag(results[-1]).
-000196f0: 2020 2020 2020 2020 656c 6966 2073 656c          elif sel
-00019700: 662e 5f72 6574 7572 6e20 3d3d 2022 6162  f._return == "ab
-00019710: 7322 206f 7220 7365 6c66 2e5f 7265 7475  s" or self._retu
-00019720: 726e 203d 3d20 2261 6273 6172 6722 3a0a  rn == "absarg":.
-00019730: 2020 2020 2020 2020 2020 2020 7265 7375              resu
-00019740: 6c74 735b 2d31 5d20 3d20 6e70 2e61 6273  lts[-1] = np.abs
-00019750: 6f6c 7574 6528 7265 7375 6c74 735b 2d31  olute(results[-1
-00019760: 5d29 0a20 2020 2020 2020 2065 6c69 6620  ]).        elif 
-00019770: 7365 6c66 2e5f 7265 7475 726e 203d 3d20  self._return == 
-00019780: 2261 7267 223a 0a20 2020 2020 2020 2020  "arg":.         
-00019790: 2020 2072 6573 756c 7473 5b2d 315d 203d     results[-1] =
-000197a0: 206e 702e 616e 676c 6528 7265 7375 6c74   np.angle(result
-000197b0: 735b 2d31 5d29 0a20 2020 2020 2020 2065  s[-1]).        e
-000197c0: 6c73 653a 0a20 2020 2020 2020 2020 2020  lse:.           
-000197d0: 2072 6169 7365 2056 616c 7565 4572 726f   raise ValueErro
-000197e0: 7228 0a20 2020 2020 2020 2020 2020 2020  r(.             
-000197f0: 2020 2022 605f 7265 7475 726e 6020 6e6f     "`_return` no
-00019800: 7420 7265 636f 676e 697a 6564 2e20 5265  t recognized. Re
-00019810: 6365 6976 6564 3a20 2573 2220 2520 7365  ceived: %s" % se
-00019820: 6c66 2e5f 7265 7475 726e 290a 0a20 2020  lf._return)..   
-00019830: 2020 2020 2072 6574 7572 6e20 5b2a 7265       return [*re
-00019840: 7375 6c74 735b 313a 5d2c 2072 6573 756c  sults[1:], resul
-00019850: 7473 5b30 5d5d 0a0a 0a64 6566 205f 7365  ts[0]]...def _se
-00019860: 745f 6469 7363 7265 7469 7a61 7469 6f6e  t_discretization
-00019870: 5f70 6f69 6e74 7328 6b77 6172 6773 2c20  _points(kwargs, 
-00019880: 7074 293a 0a20 2020 2022 2222 416c 6c6f  pt):.    """Allo
-00019890: 7720 7468 6520 7573 6520 6f66 2074 6865  w the use of the
-000198a0: 206b 6579 776f 7264 2061 7267 756d 656e   keyword argumen
-000198b0: 7473 206e 2c20 6e31 2061 6e64 206e 3220  ts n, n1 and n2 
-000198c0: 2861 6e64 206e 3329 2074 6f0a 2020 2020  (and n3) to.    
-000198d0: 7370 6563 6966 7920 7468 6520 6e75 6d62  specify the numb
-000198e0: 6572 206f 6620 6469 7363 7265 7469 7a61  er of discretiza
-000198f0: 7469 6f6e 2070 6f69 6e74 7320 696e 2074  tion points in t
-00019900: 776f 2028 6f72 2074 6872 6565 2920 6469  wo (or three) di
-00019910: 7265 6374 696f 6e73 2e0a 0a20 2020 2050  rections...    P
-00019920: 6172 616d 6574 6572 730a 2020 2020 3d3d  arameters.    ==
-00019930: 3d3d 3d3d 3d3d 3d3d 0a0a 2020 2020 6b77  ========..    kw
-00019940: 6172 6773 203a 2064 6963 740a 0a20 2020  args : dict..   
-00019950: 2070 7420 3a20 7479 7065 0a20 2020 2020   pt : type.     
-00019960: 2020 2054 6865 2074 7970 6520 6f66 2074     The type of t
-00019970: 6865 2073 6572 6965 732c 2077 6869 6368  he series, which
-00019980: 2069 6e64 6963 6174 6573 2074 6865 206b   indicates the k
-00019990: 696e 6420 6f66 2070 6c6f 7420 7765 2061  ind of plot we a
-000199a0: 7265 0a20 2020 2020 2020 2074 7279 696e  re.        tryin
-000199b0: 6720 746f 2063 7265 6174 652e 0a0a 2020  g to create...  
-000199c0: 2020 5265 7475 726e 730a 2020 2020 3d3d    Returns.    ==
-000199d0: 3d3d 3d3d 3d0a 0a20 2020 206b 7761 7267  =====..    kwarg
-000199e0: 7320 3a20 6469 6374 0a20 2020 2022 2222  s : dict.    """
-000199f0: 0a20 2020 2064 6570 7265 6361 7465 645f  .    deprecated_
-00019a00: 6b65 7977 6f72 6473 203d 207b 0a20 2020  keywords = {.   
-00019a10: 2020 2020 2022 6e62 5f6f 665f 706f 696e       "nb_of_poin
-00019a20: 7473 223a 2022 6e22 2c0a 2020 2020 2020  ts": "n",.      
-00019a30: 2020 226e 625f 6f66 5f70 6f69 6e74 735f    "nb_of_points_
-00019a40: 7822 3a20 226e 3122 2c0a 2020 2020 2020  x": "n1",.      
-00019a50: 2020 226e 625f 6f66 5f70 6f69 6e74 735f    "nb_of_points_
-00019a60: 7922 3a20 226e 3222 2c0a 2020 2020 2020  y": "n2",.      
-00019a70: 2020 226e 625f 6f66 5f70 6f69 6e74 735f    "nb_of_points_
-00019a80: 7522 3a20 226e 3122 2c0a 2020 2020 2020  u": "n1",.      
-00019a90: 2020 226e 625f 6f66 5f70 6f69 6e74 735f    "nb_of_points_
-00019aa0: 7622 3a20 226e 3222 2c0a 2020 2020 2020  v": "n2",.      
-00019ab0: 2020 2270 6f69 6e74 7322 3a20 226e 220a    "points": "n".
-00019ac0: 2020 2020 7d0a 2020 2020 666f 7220 6b2c      }.    for k,
-00019ad0: 2076 2069 6e20 6465 7072 6563 6174 6564   v in deprecated
-00019ae0: 5f6b 6579 776f 7264 732e 6974 656d 7328  _keywords.items(
-00019af0: 293a 0a20 2020 2020 2020 2069 6620 6b20  ):.        if k 
-00019b00: 696e 206b 7761 7267 732e 6b65 7973 2829  in kwargs.keys()
-00019b10: 3a0a 2020 2020 2020 2020 2020 2020 6b77  :.            kw
-00019b20: 6172 6773 5b76 5d20 3d20 6b77 6172 6773  args[v] = kwargs
-00019b30: 2e70 6f70 286b 290a 0a20 2020 2069 6620  .pop(k)..    if 
-00019b40: 7074 2069 6e20 5b0a 2020 2020 2020 2020  pt in [.        
-00019b50: 4c69 6e65 4f76 6572 3144 5261 6e67 6553  LineOver1DRangeS
-00019b60: 6572 6965 732c 2050 6172 616d 6574 7269  eries, Parametri
-00019b70: 6332 444c 696e 6553 6572 6965 732c 0a20  c2DLineSeries,. 
-00019b80: 2020 2020 2020 2050 6172 616d 6574 7269         Parametri
-00019b90: 6333 444c 696e 6553 6572 6965 732c 2041  c3DLineSeries, A
-00019ba0: 6273 4172 674c 696e 6553 6572 6965 732c  bsArgLineSeries,
-00019bb0: 2043 6f6c 6f72 6564 4c69 6e65 4f76 6572   ColoredLineOver
-00019bc0: 3144 5261 6e67 6553 6572 6965 732c 0a20  1DRangeSeries,. 
-00019bd0: 2020 2020 2020 2043 6f6d 706c 6578 5061         ComplexPa
-00019be0: 7261 6d65 7472 6963 3344 4c69 6e65 5365  rametric3DLineSe
-00019bf0: 7269 6573 2c20 4e79 7175 6973 744c 696e  ries, NyquistLin
-00019c00: 6553 6572 6965 732c 204e 6963 686f 6c73  eSeries, Nichols
-00019c10: 4c69 6e65 5365 7269 6573 2c0a 2020 2020  LineSeries,.    
-00019c20: 2020 2020 5379 7374 656d 5265 7370 6f6e      SystemRespon
-00019c30: 7365 5365 7269 6573 2c20 436f 6c6f 7265  seSeries, Colore
-00019c40: 6453 7973 7465 6d52 6573 706f 6e73 6553  dSystemResponseS
-00019c50: 6572 6965 730a 2020 2020 5d3a 0a20 2020  eries.    ]:.   
-00019c60: 2020 2020 2069 6620 226e 2220 696e 206b       if "n" in k
-00019c70: 7761 7267 732e 6b65 7973 2829 3a0a 2020  wargs.keys():.  
-00019c80: 2020 2020 2020 2020 2020 6b77 6172 6773            kwargs
-00019c90: 5b22 6e31 225d 203d 206b 7761 7267 735b  ["n1"] = kwargs[
-00019ca0: 226e 225d 0a20 2020 2020 2020 2020 2020  "n"].           
-00019cb0: 2069 6620 6861 7361 7474 7228 6b77 6172   if hasattr(kwar
-00019cc0: 6773 5b22 6e22 5d2c 2022 5f5f 6974 6572  gs["n"], "__iter
-00019cd0: 5f5f 2229 2061 6e64 2028 6c65 6e28 6b77  __") and (len(kw
-00019ce0: 6172 6773 5b22 6e22 5d29 203e 2030 293a  args["n"]) > 0):
-00019cf0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00019d00: 206b 7761 7267 735b 226e 3122 5d20 3d20   kwargs["n1"] = 
-00019d10: 6b77 6172 6773 5b22 6e22 5d5b 305d 0a20  kwargs["n"][0]. 
-00019d20: 2020 2065 6c69 6620 7074 2069 6e20 5b0a     elif pt in [.
-00019d30: 2020 2020 2020 2020 5375 7266 6163 654f          SurfaceO
-00019d40: 7665 7232 4452 616e 6765 5365 7269 6573  ver2DRangeSeries
-00019d50: 2c20 436f 6e74 6f75 7253 6572 6965 732c  , ContourSeries,
-00019d60: 2050 6172 616d 6574 7269 6353 7572 6661   ParametricSurfa
-00019d70: 6365 5365 7269 6573 2c0a 2020 2020 2020  ceSeries,.      
-00019d80: 2020 436f 6d70 6c65 7853 7572 6661 6365    ComplexSurface
-00019d90: 5365 7269 6573 2c20 436f 6d70 6c65 7844  Series, ComplexD
-00019da0: 6f6d 6169 6e43 6f6c 6f72 696e 6753 6572  omainColoringSer
-00019db0: 6965 732c 0a20 2020 2020 2020 2056 6563  ies,.        Vec
-00019dc0: 746f 7232 4453 6572 6965 732c 2049 6d70  tor2DSeries, Imp
-00019dd0: 6c69 6369 7453 6572 6965 732c 2052 6965  licitSeries, Rie
-00019de0: 6d61 6e6e 5370 6865 7265 5365 7269 6573  mannSphereSeries
-00019df0: 0a20 2020 205d 3a0a 2020 2020 2020 2020  .    ]:.        
-00019e00: 6966 2022 6e22 2069 6e20 6b77 6172 6773  if "n" in kwargs
-00019e10: 2e6b 6579 7328 293a 0a20 2020 2020 2020  .keys():.       
-00019e20: 2020 2020 2069 6620 6861 7361 7474 7228       if hasattr(
-00019e30: 6b77 6172 6773 5b22 6e22 5d2c 2022 5f5f  kwargs["n"], "__
-00019e40: 6974 6572 5f5f 2229 2061 6e64 2028 6c65  iter__") and (le
-00019e50: 6e28 6b77 6172 6773 5b22 6e22 5d29 203e  n(kwargs["n"]) >
-00019e60: 2031 293a 0a20 2020 2020 2020 2020 2020   1):.           
-00019e70: 2020 2020 206b 7761 7267 735b 226e 3122       kwargs["n1"
-00019e80: 5d20 3d20 6b77 6172 6773 5b22 6e22 5d5b  ] = kwargs["n"][
-00019e90: 305d 0a20 2020 2020 2020 2020 2020 2020  0].             
-00019ea0: 2020 206b 7761 7267 735b 226e 3222 5d20     kwargs["n2"] 
-00019eb0: 3d20 6b77 6172 6773 5b22 6e22 5d5b 315d  = kwargs["n"][1]
-00019ec0: 0a20 2020 2020 2020 2020 2020 2065 6c73  .            els
-00019ed0: 653a 0a20 2020 2020 2020 2020 2020 2020  e:.             
-00019ee0: 2020 206b 7761 7267 735b 226e 3122 5d20     kwargs["n1"] 
-00019ef0: 3d20 6b77 6172 6773 5b22 6e32 225d 203d  = kwargs["n2"] =
-00019f00: 206b 7761 7267 735b 226e 225d 0a20 2020   kwargs["n"].   
-00019f10: 2065 6c69 6620 7074 2069 6e20 5b0a 2020   elif pt in [.  
-00019f20: 2020 2020 2020 5665 6374 6f72 3344 5365        Vector3DSe
-00019f30: 7269 6573 2c20 536c 6963 6556 6563 746f  ries, SliceVecto
-00019f40: 7233 4453 6572 6965 732c 2049 6d70 6c69  r3DSeries, Impli
-00019f50: 6369 7433 4453 6572 6965 732c 2050 6c61  cit3DSeries, Pla
-00019f60: 6e65 5365 7269 6573 0a20 2020 205d 3a0a  neSeries.    ]:.
-00019f70: 2020 2020 2020 2020 6966 2022 6e22 2069          if "n" i
-00019f80: 6e20 6b77 6172 6773 2e6b 6579 7328 293a  n kwargs.keys():
-00019f90: 0a20 2020 2020 2020 2020 2020 2069 6620  .            if 
-00019fa0: 6861 7361 7474 7228 6b77 6172 6773 5b22  hasattr(kwargs["
-00019fb0: 6e22 5d2c 2022 5f5f 6974 6572 5f5f 2229  n"], "__iter__")
-00019fc0: 2061 6e64 2028 6c65 6e28 6b77 6172 6773   and (len(kwargs
-00019fd0: 5b22 6e22 5d29 203e 2032 293a 0a20 2020  ["n"]) > 2):.   
-00019fe0: 2020 2020 2020 2020 2020 2020 206b 7761               kwa
-00019ff0: 7267 735b 226e 3122 5d20 3d20 6b77 6172  rgs["n1"] = kwar
-0001a000: 6773 5b22 6e22 5d5b 305d 0a20 2020 2020  gs["n"][0].     
-0001a010: 2020 2020 2020 2020 2020 206b 7761 7267             kwarg
-0001a020: 735b 226e 3222 5d20 3d20 6b77 6172 6773  s["n2"] = kwargs
-0001a030: 5b22 6e22 5d5b 315d 0a20 2020 2020 2020  ["n"][1].       
-0001a040: 2020 2020 2020 2020 206b 7761 7267 735b           kwargs[
-0001a050: 226e 3322 5d20 3d20 6b77 6172 6773 5b22  "n3"] = kwargs["
-0001a060: 6e22 5d5b 325d 0a20 2020 2020 2020 2020  n"][2].         
-0001a070: 2020 2065 6c73 653a 0a20 2020 2020 2020     else:.       
-0001a080: 2020 2020 2020 2020 206b 7761 7267 735b           kwargs[
-0001a090: 226e 3122 5d20 3d20 6b77 6172 6773 5b22  "n1"] = kwargs["
-0001a0a0: 6e32 225d 203d 206b 7761 7267 735b 226e  n2"] = kwargs["n
-0001a0b0: 3322 5d20 3d20 6b77 6172 6773 5b22 6e22  3"] = kwargs["n"
-0001a0c0: 5d0a 2020 2020 7265 7475 726e 206b 7761  ].    return kwa
-0001a0d0: 7267 730a 0a0a 636c 6173 7320 5665 6374  rgs...class Vect
-0001a0e0: 6f72 4261 7365 2843 6f6d 6d6f 6e55 6e69  orBase(CommonUni
-0001a0f0: 666f 726d 4576 616c 7561 7469 6f6e 2c20  formEvaluation, 
-0001a100: 4261 7365 5365 7269 6573 293a 0a20 2020  BaseSeries):.   
-0001a110: 2022 2222 5265 7072 6573 656e 7420 6120   """Represent a 
-0001a120: 7665 6374 6f72 2066 6965 6c64 2e22 2222  vector field."""
-0001a130: 0a0a 2020 2020 6973 5f76 6563 746f 7220  ..    is_vector 
-0001a140: 3d20 5472 7565 0a20 2020 2069 735f 736c  = True.    is_sl
-0001a150: 6963 6520 3d20 4661 6c73 650a 2020 2020  ice = False.    
-0001a160: 6973 5f73 7472 6561 6d6c 696e 6573 203d  is_streamlines =
-0001a170: 2046 616c 7365 0a20 2020 205f 616c 6c6f   False.    _allo
-0001a180: 7765 645f 6b65 7973 203d 205b 0a20 2020  wed_keys = [.   
-0001a190: 2020 2020 2022 7374 7265 616d 6c69 6e65       "streamline
-0001a1a0: 7322 2c20 2271 7569 7665 725f 6b77 222c  s", "quiver_kw",
-0001a1b0: 2022 7374 7265 616d 5f6b 7722 2c20 226e   "stream_kw", "n
-0001a1c0: 6f72 6d61 6c69 7a65 225d 0a0a 2020 2020  ormalize"]..    
-0001a1d0: 6465 6620 5f5f 696e 6974 5f5f 2873 656c  def __init__(sel
-0001a1e0: 662c 2065 7870 7273 2c20 7261 6e67 6573  f, exprs, ranges
-0001a1f0: 2c20 6c61 6265 6c2c 202a 2a6b 7761 7267  , label, **kwarg
-0001a200: 7329 3a0a 2020 2020 2020 2020 7375 7065  s):.        supe
-0001a210: 7228 292e 5f5f 696e 6974 5f5f 282a 2a6b  r().__init__(**k
-0001a220: 7761 7267 7329 0a20 2020 2020 2020 2073  wargs).        s
-0001a230: 656c 662e 6578 7072 203d 2074 7570 6c65  elf.expr = tuple
-0001a240: 285b 6520 6966 2063 616c 6c61 626c 6528  ([e if callable(
-0001a250: 6529 2065 6c73 6520 7379 6d70 6966 7928  e) else sympify(
-0001a260: 6529 2066 6f72 2065 2069 6e20 6578 7072  e) for e in expr
-0001a270: 735d 290a 2020 2020 2020 2020 7365 6c66  s]).        self
-0001a280: 2e72 616e 6765 7320 3d20 7261 6e67 6573  .ranges = ranges
-0001a290: 0a20 2020 2020 2020 2073 656c 662e 5f6c  .        self._l
-0001a2a0: 6162 656c 203d 2073 7472 2865 7870 7273  abel = str(exprs
-0001a2b0: 2920 6966 206c 6162 656c 2069 7320 4e6f  ) if label is No
-0001a2c0: 6e65 2065 6c73 6520 6c61 6265 6c0a 2020  ne else label.  
-0001a2d0: 2020 2020 2020 7365 6c66 2e5f 6c61 7465        self._late
-0001a2e0: 785f 6c61 6265 6c20 3d20 6c61 7465 7828  x_label = latex(
-0001a2f0: 6578 7072 7329 2069 6620 6c61 6265 6c20  exprs) if label 
-0001a300: 6973 204e 6f6e 6520 656c 7365 206c 6162  is None else lab
-0001a310: 656c 0a20 2020 2020 2020 2073 656c 662e  el.        self.
-0001a320: 6973 5f73 7472 6561 6d6c 696e 6573 203d  is_streamlines =
-0001a330: 206b 7761 7267 732e 6765 7428 2273 7472   kwargs.get("str
-0001a340: 6561 6d6c 696e 6573 222c 2046 616c 7365  eamlines", False
-0001a350: 290a 2020 2020 2020 2020 7365 6c66 2e75  ).        self.u
-0001a360: 7365 5f63 6d20 3d20 6b77 6172 6773 2e67  se_cm = kwargs.g
-0001a370: 6574 2822 7573 655f 636d 222c 2054 7275  et("use_cm", Tru
-0001a380: 6529 0a20 2020 2020 2020 2023 204e 4f54  e).        # NOT
-0001a390: 453a 206e 6f72 6d61 6c69 7a61 7469 6f6e  E: normalization
-0001a3a0: 2069 7320 6163 6869 6576 6564 2061 7420   is achieved at 
-0001a3b0: 7468 6520 6261 636b 656e 6420 7369 6465  the backend side
-0001a3c0: 3a20 7468 6973 2061 6c6c 6f77 7320 746f  : this allows to
-0001a3d0: 0a20 2020 2020 2020 2023 206f 6274 6169  .        # obtai
-0001a3e0: 6e20 7361 6d65 206c 656e 6774 6820 6172  n same length ar
-0001a3f0: 726f 7773 2c20 6275 7420 636f 6c6f 7265  rows, but colore
-0001a400: 6420 7769 7468 2074 6865 2061 6374 7561  d with the actua
-0001a410: 6c20 6d61 676e 6974 7564 652e 0a20 2020  l magnitude..   
-0001a420: 2020 2020 2023 2049 6620 6e6f 726d 616c       # If normal
-0001a430: 697a 6174 696f 6e20 6973 2061 7070 6c69  ization is appli
-0001a440: 6564 206f 6e20 7468 6520 7365 7269 6573  ed on the series
-0001a450: 2067 6574 5f64 6174 6128 292c 2074 6865   get_data(), the
-0001a460: 2063 6f6c 6f72 696e 670a 2020 2020 2020   coloring.      
-0001a470: 2020 2320 6279 206d 6167 6e69 7475 6465    # by magnitude
-0001a480: 2077 6f75 6c64 206e 6f74 2062 6520 6170   would not be ap
-0001a490: 706c 6963 6162 6c65 2061 7420 7468 6520  plicable at the 
-0001a4a0: 6261 636b 656e 642e 0a20 2020 2020 2020  backend..       
-0001a4b0: 2073 656c 662e 6e6f 726d 616c 697a 6520   self.normalize 
-0001a4c0: 3d20 6b77 6172 6773 2e67 6574 2822 6e6f  = kwargs.get("no
-0001a4d0: 726d 616c 697a 6522 2c20 4661 6c73 6529  rmalize", False)
-0001a4e0: 0a0a 2020 2020 2020 2020 2320 6966 2074  ..        # if t
-0001a4f0: 6865 2065 7870 7265 7373 696f 6e73 2061  he expressions a
-0001a500: 7265 206c 616d 6264 6120 6675 6e63 7469  re lambda functi
-0001a510: 6f6e 7320 616e 6420 6e6f 206c 6162 656c  ons and no label
-0001a520: 2068 6173 2062 6565 6e0a 2020 2020 2020   has been.      
-0001a530: 2020 2320 7072 6f76 6964 6564 2c20 7468    # provided, th
-0001a540: 656e 2069 7473 2062 6574 7465 7220 746f  en its better to
-0001a550: 2064 6f20 7468 6520 666f 6c6c 6f77 696e   do the followin
-0001a560: 6720 696e 206f 7264 6572 2074 6f20 6176  g in order to av
-0001a570: 6f69 640a 2020 2020 2020 2020 2320 7375  oid.        # su
-0001a580: 7072 6973 6573 206f 6e20 7468 6520 6261  prises on the ba
-0001a590: 636b 656e 640a 2020 2020 2020 2020 6966  ckend.        if
-0001a5a0: 2061 6e79 2863 616c 6c61 626c 6528 6529   any(callable(e)
-0001a5b0: 2066 6f72 2065 2069 6e20 7365 6c66 2e65   for e in self.e
-0001a5c0: 7870 7229 3a0a 2020 2020 2020 2020 2020  xpr):.          
-0001a5d0: 2020 6966 2073 656c 662e 5f6c 6162 656c    if self._label
-0001a5e0: 203d 3d20 7374 7228 7365 6c66 2e65 7870   == str(self.exp
-0001a5f0: 7229 3a0a 2020 2020 2020 2020 2020 2020  r):.            
-0001a600: 2020 2020 7365 6c66 2e5f 6c61 6265 6c20      self._label 
-0001a610: 3d20 224d 6167 6e69 7475 6465 220a 0a20  = "Magnitude".. 
-0001a620: 2020 2020 2020 2023 204e 4f54 453a 2077         # NOTE: w
-0001a630: 6865 6e20 706c 6f74 7469 6e67 2076 6563  hen plotting vec
-0001a640: 746f 7220 6669 656c 6473 2069 7420 6d69  tor fields it mi
-0001a650: 6768 7420 6265 2075 7365 6675 6c20 746f  ght be useful to
-0001a660: 2072 6570 6561 7420 7468 650a 2020 2020   repeat the.    
-0001a670: 2020 2020 2320 706c 6f74 2063 6f6d 6d61      # plot comma
-0001a680: 6e64 2073 7769 7463 6869 6e67 2062 6574  nd switching bet
-0001a690: 7765 656e 2071 7569 7665 7273 2061 6e64  ween quivers and
-0001a6a0: 2073 7472 6561 6d6c 696e 6573 2e0a 2020   streamlines..  
-0001a6b0: 2020 2020 2020 2320 5573 7561 6c6c 792c        # Usually,
-0001a6c0: 2070 6c6f 7474 696e 6720 6c69 6272 6172   plotting librar
-0001a6d0: 6965 7320 6578 706f 7365 2064 6966 6665  ies expose diffe
-0001a6e0: 7265 6e74 2066 756e 6374 696f 6e73 2066  rent functions f
-0001a6f0: 6f72 2071 7569 7665 7273 0a20 2020 2020  or quivers.     
-0001a700: 2020 2023 2061 6e64 2073 7472 6561 6d6c     # and streaml
-0001a710: 696e 6573 2c20 6163 6365 7074 696e 6720  ines, accepting 
-0001a720: 6469 6666 6572 656e 7420 6b65 7977 6f72  different keywor
-0001a730: 6420 6172 6775 6d65 6e74 732e 0a20 2020  d arguments..   
-0001a740: 2020 2020 2023 2054 6865 2063 686f 6963       # The choic
-0001a750: 6520 746f 2069 6d70 6c65 6d65 6e74 2073  e to implement s
-0001a760: 6570 6172 6174 6573 2073 7472 6561 6d5f  eparates stream_
-0001a770: 6b77 2061 6e64 2071 7569 7665 725f 6b77  kw and quiver_kw
-0001a780: 2061 6c6c 6f77 730a 2020 2020 2020 2020   allows.        
-0001a790: 2320 7468 6973 2071 7569 636b 2073 7769  # this quick swi
-0001a7a0: 7463 682e 0a20 2020 2020 2020 2069 6620  tch..        if 
-0001a7b0: 7365 6c66 2e69 735f 7374 7265 616d 6c69  self.is_streamli
-0001a7c0: 6e65 733a 0a20 2020 2020 2020 2020 2020  nes:.           
-0001a7d0: 2073 656c 662e 7265 6e64 6572 696e 675f   self.rendering_
-0001a7e0: 6b77 203d 206b 7761 7267 732e 6765 7428  kw = kwargs.get(
-0001a7f0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0001a800: 2022 7374 7265 616d 5f6b 7722 2c20 6b77   "stream_kw", kw
-0001a810: 6172 6773 2e67 6574 2822 7265 6e64 6572  args.get("render
-0001a820: 696e 675f 6b77 222c 2064 6963 7428 2929  ing_kw", dict())
-0001a830: 290a 2020 2020 2020 2020 656c 7365 3a0a  ).        else:.
-0001a840: 2020 2020 2020 2020 2020 2020 7365 6c66              self
-0001a850: 2e72 656e 6465 7269 6e67 5f6b 7720 3d20  .rendering_kw = 
-0001a860: 6b77 6172 6773 2e67 6574 280a 2020 2020  kwargs.get(.    
-0001a870: 2020 2020 2020 2020 2020 2020 2271 7569              "qui
-0001a880: 7665 725f 6b77 222c 206b 7761 7267 732e  ver_kw", kwargs.
-0001a890: 6765 7428 2272 656e 6465 7269 6e67 5f6b  get("rendering_k
-0001a8a0: 7722 2c20 6469 6374 2829 2929 0a20 2020  w", dict())).   
-0001a8b0: 2020 2020 2073 656c 662e 5f70 6f73 745f       self._post_
-0001a8c0: 696e 6974 2829 0a0a 2020 2020 6465 6620  init()..    def 
-0001a8d0: 6765 745f 6c61 6265 6c28 7365 6c66 2c20  get_label(self, 
-0001a8e0: 7573 655f 6c61 7465 783d 4661 6c73 652c  use_latex=False,
-0001a8f0: 2077 7261 7070 6572 3d22 2425 7324 2229   wrapper="$%s$")
-0001a900: 3a0a 2020 2020 2020 2020 6966 2075 7365  :.        if use
-0001a910: 5f6c 6174 6578 3a0a 2020 2020 2020 2020  _latex:.        
-0001a920: 2020 2020 6578 7072 203d 2073 656c 662e      expr = self.
-0001a930: 6578 7072 0a20 2020 2020 2020 2020 2020  expr.           
-0001a940: 2069 6620 7365 6c66 2e5f 6c61 6265 6c20   if self._label 
-0001a950: 213d 2073 7472 2865 7870 7229 3a0a 2020  != str(expr):.  
-0001a960: 2020 2020 2020 2020 2020 2020 2020 7265                re
-0001a970: 7475 726e 2073 656c 662e 5f6c 6174 6578  turn self._latex
-0001a980: 5f6c 6162 656c 0a20 2020 2020 2020 2020  _label.         
-0001a990: 2020 2072 6574 7572 6e20 7365 6c66 2e5f     return self._
-0001a9a0: 6765 745f 7772 6170 7065 645f 6c61 6265  get_wrapped_labe
-0001a9b0: 6c28 7365 6c66 2e5f 6c61 7465 785f 6c61  l(self._latex_la
-0001a9c0: 6265 6c2c 2077 7261 7070 6572 290a 2020  bel, wrapper).  
-0001a9d0: 2020 2020 2020 7265 7475 726e 2073 656c        return sel
-0001a9e0: 662e 5f6c 6162 656c 0a0a 2020 2020 6465  f._label..    de
-0001a9f0: 6620 6765 745f 6461 7461 2873 656c 6629  f get_data(self)
-0001aa00: 3a0a 2020 2020 2020 2020 2222 2252 6574  :.        """Ret
-0001aa10: 7572 6e20 6172 7261 7973 206f 6620 636f  urn arrays of co
-0001aa20: 6f72 6469 6e61 7465 7320 666f 7220 706c  ordinates for pl
-0001aa30: 6f74 7469 6e67 2e20 4465 7065 6e64 696e  otting. Dependin
-0001aa40: 6720 6f6e 2074 6865 0a20 2020 2020 2020  g on the.       
-0001aa50: 2060 6164 6170 7469 7665 6020 6f70 7469   `adaptive` opti
-0001aa60: 6f6e 2c20 7468 6973 2066 756e 6374 696f  on, this functio
-0001aa70: 6e20 7769 6c6c 2065 6974 6865 7220 7573  n will either us
-0001aa80: 6520 616e 2061 6461 7074 6976 6520 616c  e an adaptive al
-0001aa90: 676f 7269 7468 6d0a 2020 2020 2020 2020  gorithm.        
-0001aaa0: 6f72 2069 7420 7769 6c6c 2075 6e69 666f  or it will unifo
-0001aab0: 726d 6c79 2073 616d 706c 6520 7468 6520  rmly sample the 
-0001aac0: 6578 7072 6573 7369 6f6e 206f 7665 7220  expression over 
-0001aad0: 7468 6520 7072 6f76 6964 6564 2072 616e  the provided ran
-0001aae0: 6765 2e0a 0a20 2020 2020 2020 2052 6574  ge...        Ret
-0001aaf0: 7572 6e73 0a20 2020 2020 2020 203d 3d3d  urns.        ===
-0001ab00: 3d3d 3d3d 0a0a 2020 2020 2020 2020 6d65  ====..        me
-0001ab10: 7368 5f78 203a 206e 702e 6e64 6172 7261  sh_x : np.ndarra
-0001ab20: 7920 5b6e 3220 7820 6e31 5d0a 2020 2020  y [n2 x n1].    
-0001ab30: 2020 2020 2020 2020 4469 7363 7265 7469          Discreti
-0001ab40: 7a65 6420 782d 646f 6d61 696e 2e0a 0a20  zed x-domain... 
-0001ab50: 2020 2020 2020 206d 6573 685f 7920 3a20         mesh_y : 
-0001ab60: 6e70 2e6e 6461 7272 6179 205b 6e32 2078  np.ndarray [n2 x
-0001ab70: 206e 315d 0a20 2020 2020 2020 2020 2020   n1].           
-0001ab80: 2044 6973 6372 6574 697a 6564 2079 2d64   Discretized y-d
-0001ab90: 6f6d 6169 6e2e 0a0a 2020 2020 2020 2020  omain...        
-0001aba0: 6d65 7368 5f7a 203a 206e 702e 6e64 6172  mesh_z : np.ndar
-0001abb0: 7261 7920 5b6e 3220 7820 6e31 5d20 286f  ray [n2 x n1] (o
-0001abc0: 7074 696f 6e61 6c29 0a20 2020 2020 2020  ptional).       
-0001abd0: 2020 2020 2044 6973 6372 6574 697a 6564       Discretized
-0001abe0: 207a 2d64 6f6d 6169 6e20 696e 2074 6865   z-domain in the
-0001abf0: 2063 6173 6520 6f66 2056 6563 746f 7233   case of Vector3
-0001ac00: 4453 6572 6965 732e 0a0a 2020 2020 2020  DSeries...      
-0001ac10: 2020 7520 3a20 6e70 2e6e 6461 7272 6179    u : np.ndarray
-0001ac20: 205b 6e32 2078 206e 315d 0a20 2020 2020   [n2 x n1].     
-0001ac30: 2020 2020 2020 2046 6972 7374 2063 6f6d         First com
-0001ac40: 706f 6e65 6e74 206f 6620 7468 6520 7665  ponent of the ve
-0001ac50: 6374 6f72 2066 6965 6c64 2e0a 0a20 2020  ctor field...   
-0001ac60: 2020 2020 2076 203a 206e 702e 6e64 6172       v : np.ndar
-0001ac70: 7261 7920 5b6e 3220 7820 6e31 5d0a 2020  ray [n2 x n1].  
-0001ac80: 2020 2020 2020 2020 2020 5365 636f 6e64            Second
-0001ac90: 2063 6f6d 706f 6e65 6e74 206f 6620 7468   component of th
-0001aca0: 6520 7665 6374 6f72 2066 6965 6c64 2e0a  e vector field..
-0001acb0: 0a20 2020 2020 2020 2077 203a 206e 702e  .        w : np.
-0001acc0: 6e64 6172 7261 7920 5b6e 3220 7820 6e31  ndarray [n2 x n1
-0001acd0: 5d20 286f 7074 696f 6e61 6c29 0a20 2020  ] (optional).   
-0001ace0: 2020 2020 2020 2020 2054 6869 7264 2063           Third c
-0001acf0: 6f6d 706f 6e65 6e74 206f 6620 7468 6520  omponent of the 
-0001ad00: 7665 6374 6f72 2066 6965 6c64 2069 6e20  vector field in 
-0001ad10: 7468 6520 6361 7365 206f 6620 5665 6374  the case of Vect
-0001ad20: 6f72 3344 5365 7269 6573 2e0a 2020 2020  or3DSeries..    
-0001ad30: 2020 2020 2222 220a 2020 2020 2020 2020      """.        
-0001ad40: 6e70 203d 2069 6d70 6f72 745f 6d6f 6475  np = import_modu
-0001ad50: 6c65 2827 6e75 6d70 7927 290a 0a20 2020  le('numpy')..   
-0001ad60: 2020 2020 2072 6573 756c 7473 203d 2073       results = s
-0001ad70: 656c 662e 5f65 7661 6c75 6174 6528 290a  elf._evaluate().
-0001ad80: 2020 2020 2020 2020 666f 7220 692c 2072          for i, r
-0001ad90: 2069 6e20 656e 756d 6572 6174 6528 7265   in enumerate(re
-0001ada0: 7375 6c74 7329 3a0a 2020 2020 2020 2020  sults):.        
-0001adb0: 2020 2020 7265 5f76 2c20 696d 5f76 203d      re_v, im_v =
-0001adc0: 206e 702e 7265 616c 2872 292c 206e 702e   np.real(r), np.
-0001add0: 696d 6167 2872 290a 2020 2020 2020 2020  imag(r).        
-0001ade0: 2020 2020 7265 5f76 5b6e 702e 696e 7665      re_v[np.inve
-0001adf0: 7274 286e 702e 6973 636c 6f73 6528 696d  rt(np.isclose(im
-0001ae00: 5f76 2c20 6e70 2e7a 6572 6f73 5f6c 696b  _v, np.zeros_lik
-0001ae10: 6528 696d 5f76 2929 295d 203d 206e 702e  e(im_v)))] = np.
-0001ae20: 6e61 6e0a 2020 2020 2020 2020 2020 2020  nan.            
-0001ae30: 7265 7375 6c74 735b 695d 203d 2072 655f  results[i] = re_
-0001ae40: 760a 0a20 2020 2020 2020 2072 6574 7572  v..        retur
-0001ae50: 6e20 7365 6c66 2e5f 6170 706c 795f 7472  n self._apply_tr
-0001ae60: 616e 7366 6f72 6d28 2a72 6573 756c 7473  ansform(*results
-0001ae70: 290a 0a0a 636c 6173 7320 5665 6374 6f72  )...class Vector
-0001ae80: 3244 5365 7269 6573 2856 6563 746f 7242  2DSeries(VectorB
-0001ae90: 6173 6529 3a0a 2020 2020 2222 2252 6570  ase):.    """Rep
-0001aea0: 7265 7365 6e74 7320 6120 3244 2076 6563  resents a 2D vec
-0001aeb0: 746f 7220 6669 656c 642e 2222 220a 0a20  tor field.""".. 
-0001aec0: 2020 2069 735f 3244 7665 6374 6f72 203d     is_2Dvector =
-0001aed0: 2054 7275 650a 2020 2020 2320 6465 6661   True.    # defa
-0001aee0: 756c 7420 6e75 6d62 6572 206f 6620 6469  ult number of di
-0001aef0: 7363 7265 7469 7a61 7469 6f6e 2070 6f69  scretization poi
-0001af00: 6e74 730a 2020 2020 5f4e 203d 2032 350a  nts.    _N = 25.
-0001af10: 2020 2020 5f61 6c6c 6f77 6564 5f6b 6579      _allowed_key
-0001af20: 7320 3d20 5b22 7363 616c 6172 225d 0a0a  s = ["scalar"]..
-0001af30: 2020 2020 6465 6620 5f5f 696e 6974 5f5f      def __init__
-0001af40: 2873 656c 662c 2075 2c20 762c 2072 616e  (self, u, v, ran
-0001af50: 6765 312c 2072 616e 6765 322c 206c 6162  ge1, range2, lab
-0001af60: 656c 3d22 222c 202a 2a6b 7761 7267 7329  el="", **kwargs)
-0001af70: 3a0a 2020 2020 2020 2020 7375 7065 7228  :.        super(
-0001af80: 292e 5f5f 696e 6974 5f5f 2828 752c 2076  ).__init__((u, v
-0001af90: 292c 2028 7261 6e67 6531 2c20 7261 6e67  ), (range1, rang
-0001afa0: 6532 292c 206c 6162 656c 2c20 2a2a 6b77  e2), label, **kw
-0001afb0: 6172 6773 290a 2020 2020 2020 2020 6966  args).        if
-0001afc0: 2022 7363 616c 6172 2220 6e6f 7420 696e   "scalar" not in
-0001afd0: 206b 7761 7267 732e 6b65 7973 2829 3a0a   kwargs.keys():.
-0001afe0: 2020 2020 2020 2020 2020 2020 7573 655f              use_
-0001aff0: 636d 203d 2046 616c 7365 0a20 2020 2020  cm = False.     
-0001b000: 2020 2065 6c69 6620 286e 6f74 206b 7761     elif (not kwa
-0001b010: 7267 735b 2273 6361 6c61 7222 5d29 206f  rgs["scalar"]) o
-0001b020: 7220 286b 7761 7267 735b 2273 6361 6c61  r (kwargs["scala
-0001b030: 7222 5d20 6973 204e 6f6e 6529 3a0a 2020  r"] is None):.  
-0001b040: 2020 2020 2020 2020 2020 7573 655f 636d            use_cm
-0001b050: 203d 2054 7275 650a 2020 2020 2020 2020   = True.        
-0001b060: 656c 7365 3a0a 2020 2020 2020 2020 2020  else:.          
-0001b070: 2020 7573 655f 636d 203d 2046 616c 7365    use_cm = False
-0001b080: 0a20 2020 2020 2020 2073 656c 662e 7573  .        self.us
-0001b090: 655f 636d 203d 206b 7761 7267 732e 6765  e_cm = kwargs.ge
-0001b0a0: 7428 2275 7365 5f63 6d22 2c20 7573 655f  t("use_cm", use_
-0001b0b0: 636d 290a 0a20 2020 2064 6566 205f 5f73  cm)..    def __s
-0001b0c0: 7472 5f5f 2873 656c 6629 3a0a 2020 2020  tr__(self):.    
-0001b0d0: 2020 2020 7261 6e67 6573 203d 205b 5d0a      ranges = [].
-0001b0e0: 2020 2020 2020 2020 6620 3d20 6c61 6d62          f = lamb
-0001b0f0: 6461 2074 3a20 7420 6966 206c 656e 2874  da t: t if len(t
-0001b100: 2e66 7265 655f 7379 6d62 6f6c 7329 203e  .free_symbols) >
-0001b110: 2030 2065 6c73 6520 666c 6f61 7428 7429   0 else float(t)
-0001b120: 0a20 2020 2020 2020 2066 6f72 2072 2069  .        for r i
-0001b130: 6e20 7365 6c66 2e72 616e 6765 733a 0a20  n self.ranges:. 
-0001b140: 2020 2020 2020 2020 2020 2072 616e 6765             range
-0001b150: 732e 6170 7065 6e64 2828 725b 305d 2c20  s.append((r[0], 
-0001b160: 6628 725b 315d 292c 2066 2872 5b32 5d29  f(r[1]), f(r[2])
-0001b170: 2929 0a20 2020 2020 2020 2072 6574 7572  )).        retur
-0001b180: 6e20 7365 6c66 2e5f 7374 725f 6865 6c70  n self._str_help
-0001b190: 6572 280a 2020 2020 2020 2020 2020 2020  er(.            
-0001b1a0: 2232 4420 7665 6374 6f72 2073 6572 6965  "2D vector serie
-0001b1b0: 733a 205b 2573 2c20 2573 5d20 6f76 6572  s: [%s, %s] over
-0001b1c0: 2025 732c 2025 7322 2025 2028 0a20 2020   %s, %s" % (.   
-0001b1d0: 2020 2020 2020 2020 2020 2020 202a 7365               *se
-0001b1e0: 6c66 2e65 7870 722c 202a 7261 6e67 6573  lf.expr, *ranges
-0001b1f0: 2929 0a0a 0a63 6c61 7373 2056 6563 746f  ))...class Vecto
-0001b200: 7233 4453 6572 6965 7328 5665 6374 6f72  r3DSeries(Vector
-0001b210: 4261 7365 293a 0a20 2020 2022 2222 5265  Base):.    """Re
-0001b220: 7072 6573 656e 7473 2061 2033 4420 7665  presents a 3D ve
-0001b230: 6374 6f72 2066 6965 6c64 2e22 2222 0a0a  ctor field."""..
-0001b240: 2020 2020 6973 5f33 4420 3d20 5472 7565      is_3D = True
-0001b250: 0a20 2020 2069 735f 3344 7665 6374 6f72  .    is_3Dvector
-0001b260: 203d 2054 7275 650a 2020 2020 2320 6465   = True.    # de
-0001b270: 6661 756c 7420 6e75 6d62 6572 206f 6620  fault number of 
-0001b280: 6469 7363 7265 7469 7a61 7469 6f6e 2070  discretization p
-0001b290: 6f69 6e74 730a 2020 2020 5f4e 203d 2031  oints.    _N = 1
-0001b2a0: 300a 0a20 2020 2064 6566 205f 5f69 6e69  0..    def __ini
-0001b2b0: 745f 5f28 7365 6c66 2c20 752c 2076 2c20  t__(self, u, v, 
-0001b2c0: 7a2c 2072 616e 6765 312c 2072 616e 6765  z, range1, range
-0001b2d0: 322c 2072 616e 6765 332c 206c 6162 656c  2, range3, label
-0001b2e0: 3d22 222c 202a 2a6b 7761 7267 7329 3a0a  ="", **kwargs):.
-0001b2f0: 2020 2020 2020 2020 7375 7065 7228 292e          super().
-0001b300: 5f5f 696e 6974 5f5f 2828 752c 2076 2c20  __init__((u, v, 
-0001b310: 7a29 2c20 2872 616e 6765 312c 2072 616e  z), (range1, ran
-0001b320: 6765 322c 2072 616e 6765 3329 2c20 6c61  ge2, range3), la
-0001b330: 6265 6c2c 202a 2a6b 7761 7267 7329 0a20  bel, **kwargs). 
-0001b340: 2020 2020 2020 2069 6620 7365 6c66 2e69         if self.i
-0001b350: 735f 7374 7265 616d 6c69 6e65 7320 616e  s_streamlines an
-0001b360: 6420 6973 696e 7374 616e 6365 2873 656c  d isinstance(sel
-0001b370: 662e 636f 6c6f 725f 6675 6e63 2c20 4578  f.color_func, Ex
-0001b380: 7072 293a 0a20 2020 2020 2020 2020 2020  pr):.           
-0001b390: 2072 6169 7365 2054 7970 6545 7272 6f72   raise TypeError
-0001b3a0: 280a 2020 2020 2020 2020 2020 2020 2020  (.              
-0001b3b0: 2020 2256 6563 746f 7233 4453 6572 6965    "Vector3DSerie
-0001b3c0: 7320 7769 7468 2073 7472 6561 6d6c 696e  s with streamlin
-0001b3d0: 6573 2063 616e 2774 2075 7365 2022 0a20  es can't use ". 
-0001b3e0: 2020 2020 2020 2020 2020 2020 2020 2022                 "
-0001b3f0: 7379 6d62 6f6c 6963 2060 636f 6c6f 725f  symbolic `color_
-0001b400: 6675 6e63 602e 2229 0a0a 2020 2020 6465  func`.")..    de
-0001b410: 6620 5f5f 7374 725f 5f28 7365 6c66 293a  f __str__(self):
-0001b420: 0a20 2020 2020 2020 2072 616e 6765 7320  .        ranges 
-0001b430: 3d20 5b5d 0a20 2020 2020 2020 2066 6f72  = [].        for
-0001b440: 2072 2069 6e20 7365 6c66 2e72 616e 6765   r in self.range
-0001b450: 733a 0a20 2020 2020 2020 2020 2020 2072  s:.            r
-0001b460: 616e 6765 732e 6170 7065 6e64 2828 725b  anges.append((r[
-0001b470: 305d 2c20 666c 6f61 7428 725b 315d 292c  0], float(r[1]),
-0001b480: 2066 6c6f 6174 2872 5b32 5d29 2929 0a20   float(r[2]))). 
-0001b490: 2020 2020 2020 2072 6574 7572 6e20 7365         return se
-0001b4a0: 6c66 2e5f 7374 725f 6865 6c70 6572 280a  lf._str_helper(.
-0001b4b0: 2020 2020 2020 2020 2020 2020 2233 4420              "3D 
-0001b4c0: 7665 6374 6f72 2073 6572 6965 733a 205b  vector series: [
-0001b4d0: 2573 2c20 2573 2c20 2573 5d20 6f76 6572  %s, %s, %s] over
-0001b4e0: 2025 732c 2025 732c 2025 7322 2025 2028   %s, %s, %s" % (
-0001b4f0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0001b500: 202a 7365 6c66 2e65 7870 722c 202a 7261   *self.expr, *ra
-0001b510: 6e67 6573 2929 0a0a 0a64 6566 205f 6275  nges))...def _bu
-0001b520: 696c 645f 736c 6963 655f 7365 7269 6573  ild_slice_series
-0001b530: 2873 6c69 6365 5f73 7572 662c 2072 616e  (slice_surf, ran
-0001b540: 6765 732c 202a 2a6b 7761 7267 7329 3a0a  ges, **kwargs):.
-0001b550: 2020 2020 6966 2069 7369 6e73 7461 6e63      if isinstanc
-0001b560: 6528 736c 6963 655f 7375 7266 2c20 506c  e(slice_surf, Pl
-0001b570: 616e 6529 3a0a 2020 2020 2020 2020 7265  ane):.        re
-0001b580: 7475 726e 2050 6c61 6e65 5365 7269 6573  turn PlaneSeries
-0001b590: 2873 796d 7069 6679 2873 6c69 6365 5f73  (sympify(slice_s
-0001b5a0: 7572 6629 2c20 2a72 616e 6765 732c 202a  urf), *ranges, *
-0001b5b0: 2a6b 7761 7267 7329 0a20 2020 2065 6c69  *kwargs).    eli
-0001b5c0: 6620 6973 696e 7374 616e 6365 2873 6c69  f isinstance(sli
-0001b5d0: 6365 5f73 7572 662c 2042 6173 6553 6572  ce_surf, BaseSer
-0001b5e0: 6965 7329 3a0a 2020 2020 2020 2020 6966  ies):.        if
-0001b5f0: 2073 6c69 6365 5f73 7572 662e 6973 5f33   slice_surf.is_3
-0001b600: 4473 7572 6661 6365 3a0a 2020 2020 2020  Dsurface:.      
-0001b610: 2020 2020 2020 7265 7475 726e 2073 6c69        return sli
-0001b620: 6365 5f73 7572 660a 2020 2020 2020 2020  ce_surf.        
-0001b630: 7261 6973 6520 5479 7065 4572 726f 7228  raise TypeError(
-0001b640: 224f 6e6c 7920 3344 2073 7572 6661 6365  "Only 3D surface
-0001b650: 2d72 656c 6174 6564 2073 6572 6965 7320  -related series 
-0001b660: 6172 6520 7375 7070 6f72 7465 642e 2229  are supported.")
-0001b670: 0a0a 2020 2020 2320 4966 2074 6865 2076  ..    # If the v
-0001b680: 6563 746f 7220 6669 656c 6420 6973 2056  ector field is V
-0001b690: 2878 2c20 792c 207a 292c 2074 6865 2073  (x, y, z), the s
-0001b6a0: 6c69 6365 2065 7870 7265 7373 696f 6e20  lice expression 
-0001b6b0: 6361 6e20 6265 2066 2878 2c20 7929 0a20  can be f(x, y). 
-0001b6c0: 2020 2023 206f 7220 6628 792c 207a 2920     # or f(y, z) 
-0001b6d0: 6f72 2066 2878 2c20 7a29 2e20 4578 7472  or f(x, z). Extr
-0001b6e0: 6163 7420 7468 6520 636f 7272 6563 7420  act the correct 
-0001b6f0: 7261 6e67 6573 2e0a 2020 2020 6673 203d  ranges..    fs =
-0001b700: 2073 6c69 6365 5f73 7572 662e 6672 6565   slice_surf.free
-0001b710: 5f73 796d 626f 6c73 0a20 2020 206e 6577  _symbols.    new
-0001b720: 5f72 616e 6765 7320 3d20 5b72 2066 6f72  _ranges = [r for
-0001b730: 2072 2069 6e20 7261 6e67 6573 2069 6620   r in ranges if 
-0001b740: 725b 305d 2069 6e20 6673 5d0a 2020 2020  r[0] in fs].    
-0001b750: 2320 6170 706c 7920 7468 6520 636f 7272  # apply the corr
-0001b760: 6563 7420 6469 7363 7265 7469 7a61 7469  ect discretizati
-0001b770: 6f6e 206e 756d 6265 720a 2020 2020 6e20  on number.    n 
-0001b780: 3d20 5b0a 2020 2020 2020 2020 696e 7428  = [.        int(
-0001b790: 6b77 6172 6773 2e67 6574 2822 6e31 222c  kwargs.get("n1",
-0001b7a0: 2056 6563 746f 7233 4453 6572 6965 732e   Vector3DSeries.
-0001b7b0: 5f4e 2929 2c0a 2020 2020 2020 2020 696e  _N)),.        in
-0001b7c0: 7428 6b77 6172 6773 2e67 6574 2822 6e32  t(kwargs.get("n2
-0001b7d0: 222c 2056 6563 746f 7233 4453 6572 6965  ", Vector3DSerie
-0001b7e0: 732e 5f4e 2929 2c0a 2020 2020 2020 2020  s._N)),.        
-0001b7f0: 696e 7428 6b77 6172 6773 2e67 6574 2822  int(kwargs.get("
-0001b800: 6e33 222c 2056 6563 746f 7233 4453 6572  n3", Vector3DSer
-0001b810: 6965 732e 5f4e 2929 5d0a 2020 2020 6469  ies._N))].    di
-0001b820: 7363 725f 7379 6d62 6f6c 7320 3d20 5b72  scr_symbols = [r
-0001b830: 5b30 5d20 666f 7220 7220 696e 2072 616e  [0] for r in ran
-0001b840: 6765 735d 0a20 2020 2069 6478 203d 205b  ges].    idx = [
-0001b850: 6469 7363 725f 7379 6d62 6f6c 732e 696e  discr_symbols.in
-0001b860: 6465 7828 7329 2066 6f72 2073 2069 6e20  dex(s) for s in 
-0001b870: 5b72 5b30 5d20 666f 7220 7220 696e 206e  [r[0] for r in n
-0001b880: 6577 5f72 616e 6765 735d 5d0a 2020 2020  ew_ranges]].    
-0001b890: 6b77 6172 6773 3220 3d20 6b77 6172 6773  kwargs2 = kwargs
-0001b8a0: 2e63 6f70 7928 290a 2020 2020 6b77 6172  .copy().    kwar
-0001b8b0: 6773 325b 226e 3122 5d20 3d20 6e5b 6964  gs2["n1"] = n[id
-0001b8c0: 785b 305d 5d0a 2020 2020 6b77 6172 6773  x[0]].    kwargs
-0001b8d0: 325b 226e 3222 5d20 3d20 6e5b 6964 785b  2["n2"] = n[idx[
-0001b8e0: 315d 5d0a 0a20 2020 2072 6574 7572 6e20  1]]..    return 
-0001b8f0: 5375 7266 6163 654f 7665 7232 4452 616e  SurfaceOver2DRan
-0001b900: 6765 5365 7269 6573 2873 6c69 6365 5f73  geSeries(slice_s
-0001b910: 7572 662c 202a 6e65 775f 7261 6e67 6573  urf, *new_ranges
-0001b920: 2c20 2a2a 6b77 6172 6773 3229 0a0a 0a63  , **kwargs2)...c
-0001b930: 6c61 7373 2053 6c69 6365 5665 6374 6f72  lass SliceVector
-0001b940: 3344 5365 7269 6573 2856 6563 746f 7233  3DSeries(Vector3
-0001b950: 4453 6572 6965 7329 3a0a 2020 2020 2222  DSeries):.    ""
-0001b960: 2252 6570 7265 7365 6e74 7320 6120 3344  "Represents a 3D
-0001b970: 2076 6563 746f 7220 6669 656c 6420 706c   vector field pl
-0001b980: 6f74 7465 6420 6f76 6572 2061 2073 6c69  otted over a sli
-0001b990: 6365 2e20 5468 6520 736c 6963 6520 6361  ce. The slice ca
-0001b9a0: 6e20 6265 0a20 2020 2061 2050 6c61 6e65  n be.    a Plane
-0001b9b0: 206f 7220 6120 7375 7266 6163 652e 0a20   or a surface.. 
-0001b9c0: 2020 2022 2222 0a20 2020 2069 735f 736c     """.    is_sl
-0001b9d0: 6963 6520 3d20 5472 7565 0a0a 2020 2020  ice = True..    
-0001b9e0: 6465 6620 5f5f 696e 6974 5f5f 280a 2020  def __init__(.  
-0001b9f0: 2020 2020 2020 7365 6c66 2c20 736c 6963        self, slic
-0001ba00: 655f 7375 7266 2c20 752c 2076 2c20 772c  e_surf, u, v, w,
-0001ba10: 2072 616e 6765 5f78 2c20 7261 6e67 655f   range_x, range_
-0001ba20: 792c 2072 616e 6765 5f7a 2c0a 2020 2020  y, range_z,.    
-0001ba30: 2020 2020 6c61 6265 6c3d 2222 2c20 2a2a      label="", **
-0001ba40: 6b77 6172 6773 0a20 2020 2029 3a0a 2020  kwargs.    ):.  
-0001ba50: 2020 2020 2020 7365 6c66 2e73 6c69 6365        self.slice
-0001ba60: 5f73 7572 665f 7365 7269 6573 203d 205f  _surf_series = _
-0001ba70: 6275 696c 645f 736c 6963 655f 7365 7269  build_slice_seri
-0001ba80: 6573 280a 2020 2020 2020 2020 2020 2020  es(.            
-0001ba90: 736c 6963 655f 7375 7266 2c20 5b72 616e  slice_surf, [ran
-0001baa0: 6765 5f78 2c20 7261 6e67 655f 792c 2072  ge_x, range_y, r
-0001bab0: 616e 6765 5f7a 5d2c 202a 2a6b 7761 7267  ange_z], **kwarg
-0001bac0: 7329 0a20 2020 2020 2020 2073 7570 6572  s).        super
-0001bad0: 2829 2e5f 5f69 6e69 745f 5f28 752c 2076  ().__init__(u, v
-0001bae0: 2c20 772c 2072 616e 6765 5f78 2c20 7261  , w, range_x, ra
-0001baf0: 6e67 655f 792c 2072 616e 6765 5f7a 2c20  nge_y, range_z, 
-0001bb00: 6c61 6265 6c2c 202a 2a6b 7761 7267 7329  label, **kwargs)
-0001bb10: 0a0a 2020 2020 6465 6620 5f64 6973 6372  ..    def _discr
-0001bb20: 6574 697a 6528 7365 6c66 293a 0a20 2020  etize(self):.   
-0001bb30: 2020 2020 2064 6174 6120 3d20 7365 6c66       data = self
-0001bb40: 2e73 6c69 6365 5f73 7572 665f 7365 7269  .slice_surf_seri
-0001bb50: 6573 2e67 6574 5f64 6174 6128 290a 2020  es.get_data().  
-0001bb60: 2020 2020 2020 6966 2069 7369 6e73 7461        if isinsta
-0001bb70: 6e63 6528 7365 6c66 2e73 6c69 6365 5f73  nce(self.slice_s
-0001bb80: 7572 665f 7365 7269 6573 2c20 506c 616e  urf_series, Plan
-0001bb90: 6553 6572 6965 7329 3a0a 2020 2020 2020  eSeries):.      
-0001bba0: 2020 2020 2020 7265 7475 726e 2064 6174        return dat
-0001bbb0: 610a 2020 2020 2020 2020 6966 2073 656c  a.        if sel
-0001bbc0: 662e 736c 6963 655f 7375 7266 5f73 6572  f.slice_surf_ser
-0001bbd0: 6965 732e 6973 5f70 6172 616d 6574 7269  ies.is_parametri
-0001bbe0: 633a 0a20 2020 2020 2020 2020 2020 2072  c:.            r
-0001bbf0: 6574 7572 6e20 6461 7461 5b3a 335d 0a0a  eturn data[:3]..
-0001bc00: 2020 2020 2020 2020 2320 7379 6d62 6f6c          # symbol
-0001bc10: 7320 7573 6564 2062 7920 7468 6973 2076  s used by this v
-0001bc20: 6563 746f 7227 7320 6469 7363 7265 7469  ector's discreti
-0001bc30: 7a61 7469 6f6e 0a20 2020 2020 2020 2064  zation.        d
-0001bc40: 6973 6372 5f73 796d 626f 6c73 203d 205b  iscr_symbols = [
-0001bc50: 725b 305d 2066 6f72 2072 2069 6e20 7365  r[0] for r in se
-0001bc60: 6c66 2e72 616e 6765 735d 0a20 2020 2020  lf.ranges].     
-0001bc70: 2020 2023 206f 7264 6572 6564 2073 796d     # ordered sym
-0001bc80: 626f 6c73 2066 726f 6d20 736c 6963 655f  bols from slice_
-0001bc90: 7375 7266 5f73 6572 6965 730a 2020 2020  surf_series.    
-0001bca0: 2020 2020 6f72 6465 7220 3d20 7365 6c66      order = self
-0001bcb0: 2e5f 6469 7363 7265 7469 7a65 5f68 656c  ._discretize_hel
-0001bcc0: 7065 7228 6469 7363 725f 7379 6d62 6f6c  per(discr_symbol
-0001bcd0: 7329 0a20 2020 2020 2020 2072 6574 7572  s).        retur
-0001bce0: 6e20 5b64 6174 615b 6b5d 2066 6f72 206b  n [data[k] for k
-0001bcf0: 2069 6e20 6f72 6465 725d 0a0a 2020 2020   in order]..    
-0001bd00: 6465 6620 5f64 6973 6372 6574 697a 655f  def _discretize_
-0001bd10: 6865 6c70 6572 2873 656c 662c 2076 6563  helper(self, vec
-0001bd20: 5f64 6973 6372 5f73 796d 626f 6c73 293a  _discr_symbols):
-0001bd30: 0a20 2020 2020 2020 2023 204e 4f54 453a  .        # NOTE:
-0001bd40: 206c 6574 2773 2073 6179 2074 6865 2076   let's say the v
-0001bd50: 6563 746f 7220 6669 656c 6420 6973 2064  ector field is d
-0001bd60: 6973 6372 6574 697a 6564 2061 6c6f 6e67  iscretized along
-0001bd70: 2078 2c20 792c 207a 2028 696e 0a20 2020   x, y, z (in.   
-0001bd80: 2020 2020 2023 2074 6869 7320 6f72 6465       # this orde
-0001bd90: 7229 2c20 616e 6420 7468 6520 736c 6963  r), and the slic
-0001bda0: 6520 7375 7266 6163 6520 6973 2066 2879  e surface is f(y
-0001bdb0: 2c20 7a29 2e20 5468 656e 2c20 6461 7461  , z). Then, data
-0001bdc0: 2077 696c 6c20 6265 0a20 2020 2020 2020   will be.       
-0001bdd0: 2023 205b 7979 2c20 7a7a 2c20 6628 7979   # [yy, zz, f(yy
-0001bde0: 2c20 7a7a 295d 2c20 7768 6963 6820 6861  , zz)], which ha
-0001bdf0: 7320 6e6f 7420 7468 6520 636f 7272 6563  s not the correc
-0001be00: 7420 6f72 6465 7220 6578 7065 6374 6564  t order expected
-0001be10: 2062 790a 2020 2020 2020 2020 2320 7468   by.        # th
-0001be20: 6520 7665 6374 6f72 2066 6965 6c64 2773  e vector field's
-0001be30: 2064 6973 6372 6574 697a 6174 696f 6e2e   discretization.
-0001be40: 2048 6572 6520 7765 2061 7265 2067 6f69   Here we are goi
-0001be50: 6e67 2074 6f20 6669 7820 7468 6174 2e0a  ng to fix that..
-0001be60: 0a20 2020 2020 2020 2069 6620 6e6f 7420  .        if not 
-0001be70: 6973 696e 7374 616e 6365 2873 656c 662e  isinstance(self.
-0001be80: 736c 6963 655f 7375 7266 5f73 6572 6965  slice_surf_serie
-0001be90: 732c 2053 7572 6661 6365 4f76 6572 3244  s, SurfaceOver2D
-0001bea0: 5261 6e67 6553 6572 6965 7329 3a0a 2020  RangeSeries):.  
-0001beb0: 2020 2020 2020 2020 2020 7261 6973 6520            raise 
-0001bec0: 5479 7065 4572 726f 7228 2254 6869 7320  TypeError("This 
-0001bed0: 6865 6c70 6572 2066 756e 6374 696f 6e20  helper function 
-0001bee0: 6973 206d 6561 6e74 2074 6f20 6265 2075  is meant to be u
-0001bef0: 7365 6420 6f6e 6c79 2022 0a20 2020 2020  sed only ".     
-0001bf00: 2020 2020 2020 2020 2020 2022 7769 7468             "with
-0001bf10: 206e 6f6e 2d70 6172 616d 6574 7269 6320   non-parametric 
-0001bf20: 736c 6963 696e 6720 7375 7266 6163 6573  slicing surfaces
-0001bf30: 206f 6620 3220 7661 7269 6162 6c65 732e   of 2 variables.
-0001bf40: 2022 0a20 2020 2020 2020 2020 2020 2020   ".             
-0001bf50: 2020 2022 7479 7065 2873 656c 662e 736c     "type(self.sl
-0001bf60: 6963 655f 7375 7266 5f73 6572 6965 7329  ice_surf_series)
-0001bf70: 203d 207b 7d22 2e66 6f72 6d61 7428 0a20   = {}".format(. 
-0001bf80: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001bf90: 2020 2074 7970 6528 7365 6c66 2e73 6c69     type(self.sli
-0001bfa0: 6365 5f73 7572 665f 7365 7269 6573 2929  ce_surf_series))
-0001bfb0: 290a 0a20 2020 2020 2020 2023 2073 6c69  )..        # sli
-0001bfc0: 6365 2073 7572 6661 6365 2066 7265 6520  ce surface free 
-0001bfd0: 7379 6d62 6f6c 730a 2020 2020 2020 2020  symbols.        
-0001bfe0: 2320 646f 6e27 7420 7573 6520 7365 6c66  # don't use self
-0001bff0: 2e73 6c69 6365 5f73 7572 665f 7365 7269  .slice_surf_seri
-0001c000: 6573 2e66 7265 655f 7379 6d62 6f6c 7320  es.free_symbols 
-0001c010: 6173 2074 6869 7320 6578 7072 6573 7369  as this expressi
-0001c020: 6f6e 0a20 2020 2020 2020 2023 206d 6967  on.        # mig
-0001c030: 6874 206e 6f74 2075 7365 2062 6f74 6820  ht not use both 
-0001c040: 6974 7320 6469 7363 7265 7469 7a61 7469  its discretizati
-0001c050: 6f6e 2073 796d 626f 6c73 0a20 2020 2020  on symbols.     
-0001c060: 2020 2073 7366 7320 3d20 5b72 5b30 5d20     ssfs = [r[0] 
-0001c070: 666f 7220 7220 696e 2073 656c 662e 736c  for r in self.sl
-0001c080: 6963 655f 7375 7266 5f73 6572 6965 732e  ice_surf_series.
-0001c090: 7261 6e67 6573 5d0a 2020 2020 2020 2020  ranges].        
-0001c0a0: 2320 6769 7665 6e20 6628 792c 207a 292c  # given f(y, z),
-0001c0b0: 2077 6520 616c 7265 6164 7920 6861 7665   we already have
-0001c0c0: 2079 2c20 7a20 2873 7366 7329 2c20 6e6f   y, z (ssfs), no
-0001c0d0: 7720 6669 6e64 2078 0a20 2020 2020 2020  w find x.       
-0001c0e0: 206d 6973 7369 6e67 5f73 796d 626f 6c20   missing_symbol 
-0001c0f0: 3d20 6c69 7374 2873 6574 2876 6563 5f64  = list(set(vec_d
-0001c100: 6973 6372 5f73 796d 626f 6c73 292e 6469  iscr_symbols).di
-0001c110: 6666 6572 656e 6365 2873 7366 7329 290a  fference(ssfs)).
-0001c120: 2020 2020 2020 2020 2320 6f72 6465 7265          # ordere
-0001c130: 6420 7379 6d62 6f6c 7320 696e 2074 6865  d symbols in the
-0001c140: 2072 6574 7572 6e65 6420 6461 7461 0a20   returned data. 
-0001c150: 2020 2020 2020 2072 6574 7572 6e65 645f         returned_
-0001c160: 7379 6d62 6f6c 7320 3d20 7373 6673 202b  symbols = ssfs +
-0001c170: 206d 6973 7369 6e67 5f73 796d 626f 6c0a   missing_symbol.
-0001c180: 2020 2020 2020 2020 2320 6f75 7470 7574          # output
-0001c190: 206f 7264 6572 0a20 2020 2020 2020 206f   order.        o
-0001c1a0: 7264 6572 203d 205b 7265 7475 726e 6564  rder = [returned
-0001c1b0: 5f73 796d 626f 6c73 2e69 6e64 6578 2873  _symbols.index(s
-0001c1c0: 2920 666f 7220 7320 696e 2076 6563 5f64  ) for s in vec_d
-0001c1d0: 6973 6372 5f73 796d 626f 6c73 5d0a 2020  iscr_symbols].  
-0001c1e0: 2020 2020 2020 7265 7475 726e 206f 7264        return ord
-0001c1f0: 6572 0a0a 2020 2020 6465 6620 5f63 7265  er..    def _cre
-0001c200: 6174 655f 6469 7363 7265 7469 7a65 645f  ate_discretized_
-0001c210: 646f 6d61 696e 2873 656c 6629 3a0a 2020  domain(self):.  
-0001c220: 2020 2020 2020 2222 2244 6973 6372 6574        """Discret
-0001c230: 697a 6520 7468 6520 7261 6e67 6573 2069  ize the ranges i
-0001c240: 6e20 6361 7365 206f 6620 756e 6966 6f72  n case of unifor
-0001c250: 6d20 6d65 7368 696e 6720 7374 7261 7465  m meshing strate
-0001c260: 6779 2e0a 2020 2020 2020 2020 2222 220a  gy..        """.
-0001c270: 2020 2020 2020 2020 2320 544f 444f 3a20          # TODO: 
-0001c280: 6f6e 6365 2049 6e74 6572 6163 7469 7665  once Interactive
-0001c290: 5365 7269 6573 2068 6173 2062 6565 6e20  Series has been 
-0001c2a0: 7265 6d6f 7665 2c20 7468 6520 666f 6c6c  remove, the foll
-0001c2b0: 6f77 696e 6720 6361 6e0a 2020 2020 2020  owing can.      
-0001c2c0: 2020 2320 6265 2072 656f 7267 616e 697a    # be reorganiz
-0001c2d0: 6564 2069 6e20 6f72 6465 7220 746f 2072  ed in order to r
-0001c2e0: 656d 6f76 6520 636f 6465 2072 6570 6574  emove code repet
-0001c2f0: 6974 696f 6e2c 2073 7065 6369 6669 6361  ition, specifica
-0001c300: 6c6c 7920 7468 650a 2020 2020 2020 2020  lly the.        
-0001c310: 2320 666f 6c6c 6f77 696e 6720 6c69 6e65  # following line
-0001c320: 206f 6620 636f 6465 2e0a 2020 2020 2020   of code..      
-0001c330: 2020 2320 7379 6d62 6f6c 7320 7573 6564    # symbols used
-0001c340: 2062 7920 7468 6973 2076 6563 746f 7227   by this vector'
-0001c350: 7320 6469 7363 7265 7469 7a61 7469 6f6e  s discretization
-0001c360: 0a20 2020 2020 2020 2064 6973 6372 5f73  .        discr_s
-0001c370: 796d 626f 6c73 203d 205b 725b 305d 2066  ymbols = [r[0] f
-0001c380: 6f72 2072 2069 6e20 7365 6c66 2e72 616e  or r in self.ran
-0001c390: 6765 735d 0a20 2020 2020 2020 2064 6973  ges].        dis
-0001c3a0: 6372 6574 697a 6174 696f 6e73 203d 2073  cretizations = s
-0001c3b0: 656c 662e 5f64 6973 6372 6574 697a 6528  elf._discretize(
-0001c3c0: 290a 2020 2020 2020 2020 7365 6c66 2e5f  ).        self._
-0001c3d0: 6469 7363 7265 7469 7a65 645f 646f 6d61  discretized_doma
-0001c3e0: 696e 203d 207b 0a20 2020 2020 2020 2020  in = {.         
-0001c3f0: 2020 206b 3a20 7620 666f 7220 6b2c 2076     k: v for k, v
-0001c400: 2069 6e20 7a69 7028 6469 7363 725f 7379   in zip(discr_sy
-0001c410: 6d62 6f6c 732c 2064 6973 6372 6574 697a  mbols, discretiz
-0001c420: 6174 696f 6e73 297d 0a0a 2020 2020 4070  ations)}..    @p
-0001c430: 726f 7065 7274 790a 2020 2020 6465 6620  roperty.    def 
-0001c440: 7061 7261 6d73 2873 656c 6629 3a0a 2020  params(self):.  
-0001c450: 2020 2020 2020 2222 2247 6574 206f 7220        """Get or 
-0001c460: 7365 7420 7468 6520 6375 7272 656e 7420  set the current 
-0001c470: 7061 7261 6d65 7465 7273 2064 6963 7469  parameters dicti
-0001c480: 6f6e 6172 792e 0a0a 2020 2020 2020 2020  onary...        
-0001c490: 5061 7261 6d65 7465 7273 0a20 2020 2020  Parameters.     
-0001c4a0: 2020 203d 3d3d 3d3d 3d3d 3d3d 3d0a 0a20     ==========.. 
-0001c4b0: 2020 2020 2020 2070 203a 2064 6963 740a         p : dict.
-0001c4c0: 2020 2020 2020 2020 2020 2020 6b65 793a              key:
-0001c4d0: 2073 796d 626f 6c20 6173 736f 6369 6174   symbol associat
-0001c4e0: 6564 2074 6f20 7468 6520 7061 7261 6d65  ed to the parame
-0001c4f0: 7465 720a 2020 2020 2020 2020 2020 2020  ter.            
-0001c500: 7661 6c3a 2074 6865 2076 616c 7565 0a20  val: the value. 
-0001c510: 2020 2020 2020 2022 2222 0a20 2020 2020         """.     
-0001c520: 2020 2072 6574 7572 6e20 7365 6c66 2e5f     return self._
-0001c530: 7061 7261 6d73 0a0a 2020 2020 4070 6172  params..    @par
-0001c540: 616d 732e 7365 7474 6572 0a20 2020 2064  ams.setter.    d
-0001c550: 6566 2070 6172 616d 7328 7365 6c66 2c20  ef params(self, 
-0001c560: 7029 3a0a 2020 2020 2020 2020 7365 6c66  p):.        self
-0001c570: 2e5f 7061 7261 6d73 203d 2070 0a20 2020  ._params = p.   
-0001c580: 2020 2020 2069 6620 7365 6c66 2e73 6c69       if self.sli
-0001c590: 6365 5f73 7572 665f 7365 7269 6573 2e69  ce_surf_series.i
-0001c5a0: 735f 696e 7465 7261 6374 6976 653a 0a20  s_interactive:. 
-0001c5b0: 2020 2020 2020 2020 2020 2023 2075 7064             # upd
-0001c5c0: 6174 6520 626f 7468 2070 6172 616d 6574  ate both paramet
-0001c5d0: 6572 7320 616e 6420 6469 7363 7265 7469  ers and discreti
-0001c5e0: 7a61 7469 6f6e 2072 616e 6765 730a 2020  zation ranges.  
-0001c5f0: 2020 2020 2020 2020 2020 7365 6c66 2e73            self.s
-0001c600: 6c69 6365 5f73 7572 665f 7365 7269 6573  lice_surf_series
-0001c610: 2e70 6172 616d 7320 3d20 700a 2020 2020  .params = p.    
-0001c620: 2020 2020 2320 7379 6d62 6f6c 7320 7573      # symbols us
-0001c630: 6564 2062 7920 7468 6973 2076 6563 746f  ed by this vecto
-0001c640: 7227 7320 6469 7363 7265 7469 7a61 7469  r's discretizati
-0001c650: 6f6e 0a20 2020 2020 2020 2064 6973 6372  on.        discr
-0001c660: 5f73 796d 626f 6c73 203d 205b 725b 305d  _symbols = [r[0]
-0001c670: 2066 6f72 2072 2069 6e20 7365 6c66 2e72   for r in self.r
-0001c680: 616e 6765 735d 0a0a 2020 2020 2020 2020  anges]..        
-0001c690: 6966 2028 0a20 2020 2020 2020 2020 2020  if (.           
-0001c6a0: 2069 7369 6e73 7461 6e63 6528 7365 6c66   isinstance(self
-0001c6b0: 2e73 6c69 6365 5f73 7572 665f 7365 7269  .slice_surf_seri
-0001c6c0: 6573 2c20 5375 7266 6163 654f 7665 7232  es, SurfaceOver2
-0001c6d0: 4452 616e 6765 5365 7269 6573 2920 616e  DRangeSeries) an
-0001c6e0: 640a 2020 2020 2020 2020 2020 2020 286e  d.            (n
-0001c6f0: 6f74 2073 656c 662e 736c 6963 655f 7375  ot self.slice_su
-0001c700: 7266 5f73 6572 6965 732e 6973 5f70 6172  rf_series.is_par
-0001c710: 616d 6574 7269 6329 0a20 2020 2020 2020  ametric).       
-0001c720: 2029 3a0a 2020 2020 2020 2020 2020 2020   ):.            
-0001c730: 2320 6f72 6465 7265 6420 7379 6d62 6f6c  # ordered symbol
-0001c740: 7320 6672 6f6d 2073 6c69 6365 5f73 7572  s from slice_sur
-0001c750: 665f 7365 7269 6573 0a20 2020 2020 2020  f_series.       
-0001c760: 2020 2020 206f 7264 6572 6564 5f73 796d       ordered_sym
-0001c770: 626f 6c73 203d 2073 656c 662e 5f64 6973  bols = self._dis
-0001c780: 6372 6574 697a 655f 6865 6c70 6572 2864  cretize_helper(d
-0001c790: 6973 6372 5f73 796d 626f 6c73 290a 2020  iscr_symbols).  
-0001c7a0: 2020 2020 2020 2020 2020 6461 7461 203d            data =
-0001c7b0: 2073 656c 662e 736c 6963 655f 7375 7266   self.slice_surf
-0001c7c0: 5f73 6572 6965 732e 6765 745f 6461 7461  _series.get_data
-0001c7d0: 2829 0a20 2020 2020 2020 2020 2020 2073  ().            s
-0001c7e0: 656c 662e 5f64 6973 6372 6574 697a 6564  elf._discretized
-0001c7f0: 5f64 6f6d 6169 6e20 3d20 7b0a 2020 2020  _domain = {.    
-0001c800: 2020 2020 2020 2020 2020 2020 6b3a 2064              k: d
-0001c810: 6174 615b 765d 2066 6f72 206b 2c20 7620  ata[v] for k, v 
-0001c820: 696e 207a 6970 2864 6973 6372 5f73 796d  in zip(discr_sym
-0001c830: 626f 6c73 2c20 6f72 6465 7265 645f 7379  bols, ordered_sy
-0001c840: 6d62 6f6c 7329 0a20 2020 2020 2020 2020  mbols).         
-0001c850: 2020 207d 0a20 2020 2020 2020 2065 6c73     }.        els
-0001c860: 653a 0a20 2020 2020 2020 2020 2020 2073  e:.            s
-0001c870: 656c 662e 5f64 6973 6372 6574 697a 6564  elf._discretized
-0001c880: 5f64 6f6d 6169 6e20 3d20 7b0a 2020 2020  _domain = {.    
-0001c890: 2020 2020 2020 2020 2020 2020 6b3a 2076              k: v
-0001c8a0: 2066 6f72 206b 2c20 7620 696e 207a 6970   for k, v in zip
-0001c8b0: 280a 2020 2020 2020 2020 2020 2020 2020  (.              
-0001c8c0: 2020 2020 2020 6469 7363 725f 7379 6d62        discr_symb
-0001c8d0: 6f6c 732c 0a20 2020 2020 2020 2020 2020  ols,.           
-0001c8e0: 2020 2020 2020 2020 2073 656c 662e 736c           self.sl
-0001c8f0: 6963 655f 7375 7266 5f73 6572 6965 732e  ice_surf_series.
-0001c900: 6765 745f 6461 7461 2829 0a20 2020 2020  get_data().     
-0001c910: 2020 2020 2020 2020 2020 2029 0a20 2020             ).   
-0001c920: 2020 2020 2020 2020 207d 0a0a 2020 2020           }..    
-0001c930: 6465 6620 5f5f 7374 725f 5f28 7365 6c66  def __str__(self
-0001c940: 293a 0a20 2020 2020 2020 2072 6574 7572  ):.        retur
-0001c950: 6e20 2273 6c69 6365 6420 2220 2b20 7375  n "sliced " + su
-0001c960: 7065 7228 292e 5f5f 7374 725f 5f28 2920  per().__str__() 
-0001c970: 2b20 2220 6174 207b 7d22 2e66 6f72 6d61  + " at {}".forma
-0001c980: 7428 0a20 2020 2020 2020 2020 2020 2073  t(.            s
-0001c990: 656c 662e 736c 6963 655f 7375 7266 5f73  elf.slice_surf_s
-0001c9a0: 6572 6965 7329 0a0a 0a63 6c61 7373 2050  eries)...class P
-0001c9b0: 6c61 6e65 5365 7269 6573 2853 7572 6661  laneSeries(Surfa
-0001c9c0: 6365 4261 7365 5365 7269 6573 293a 0a20  ceBaseSeries):. 
-0001c9d0: 2020 2022 2222 5265 7072 6573 656e 7473     """Represents
-0001c9e0: 2061 2070 6c61 6e65 2069 6e20 6120 3344   a plane in a 3D
-0001c9f0: 2064 6f6d 6169 6e2e 2222 220a 0a20 2020   domain."""..   
-0001ca00: 2069 735f 3344 7375 7266 6163 6520 3d20   is_3Dsurface = 
-0001ca10: 5472 7565 0a20 2020 205f 4e20 3d20 3230  True.    _N = 20
-0001ca20: 0a0a 2020 2020 2320 6120 6765 6e65 7269  ..    # a generi
-0001ca30: 6320 706c 616e 6520 2866 6f72 2065 7861  c plane (for exa
-0001ca40: 6d70 6c65 2077 6974 6820 6e6f 726d 616c  mple with normal
-0001ca50: 2028 312c 312c 3129 2920 6361 6e20 6765   (1,1,1)) can ge
-0001ca60: 6e65 7261 7465 2061 2068 7567 650a 2020  nerate a huge.  
-0001ca70: 2020 2320 7261 6e67 6520 616c 6f6e 6720    # range along 
-0001ca80: 7468 6520 7a2d 6469 7265 6374 696f 6e2e  the z-direction.
-0001ca90: 2057 6974 6820 5f75 7365 5f6e 616e 3d54   With _use_nan=T
-0001caa0: 7275 652c 2065 7665 7279 207a 2d76 616c  rue, every z-val
-0001cab0: 7565 206f 7574 7369 6465 0a20 2020 2023  ue outside.    #
-0001cac0: 206f 6620 7468 6520 7072 6f76 6964 6564   of the provided
-0001cad0: 207a 5f72 616e 6765 2077 696c 6c20 6265   z_range will be
-0001cae0: 2073 6574 2074 6f20 4e61 6e2e 0a20 2020   set to Nan..   
-0001caf0: 205f 7573 655f 6e61 6e20 3d20 5472 7565   _use_nan = True
-0001cb00: 0a0a 2020 2020 6465 6620 5f5f 696e 6974  ..    def __init
-0001cb10: 5f5f 280a 2020 2020 2020 2020 7365 6c66  __(.        self
-0001cb20: 2c20 706c 616e 652c 2078 5f72 616e 6765  , plane, x_range
-0001cb30: 2c20 795f 7261 6e67 652c 207a 5f72 616e  , y_range, z_ran
-0001cb40: 6765 3d4e 6f6e 652c 206c 6162 656c 3d22  ge=None, label="
-0001cb50: 222c 202a 2a6b 7761 7267 730a 2020 2020  ", **kwargs.    
-0001cb60: 293a 0a20 2020 2020 2020 2073 7570 6572  ):.        super
-0001cb70: 2829 2e5f 5f69 6e69 745f 5f28 2a2a 6b77  ().__init__(**kw
-0001cb80: 6172 6773 290a 2020 2020 2020 2020 7365  args).        se
-0001cb90: 6c66 2e5f 626c 6f63 6b5f 6c61 6d62 6461  lf._block_lambda
-0001cba0: 5f66 756e 6374 696f 6e73 2870 6c61 6e65  _functions(plane
-0001cbb0: 290a 2020 2020 2020 2020 7365 6c66 2e70  ).        self.p
-0001cbc0: 6c61 6e65 203d 2073 796d 7069 6679 2870  lane = sympify(p
-0001cbd0: 6c61 6e65 290a 2020 2020 2020 2020 7365  lane).        se
-0001cbe0: 6c66 2e65 7870 7220 3d20 7365 6c66 2e70  lf.expr = self.p
-0001cbf0: 6c61 6e65 0a20 2020 2020 2020 2069 6620  lane.        if 
-0001cc00: 6e6f 7420 6973 696e 7374 616e 6365 2873  not isinstance(s
-0001cc10: 656c 662e 706c 616e 652c 2050 6c61 6e65  elf.plane, Plane
-0001cc20: 293a 0a20 2020 2020 2020 2020 2020 2072  ):.            r
-0001cc30: 6169 7365 2054 7970 6545 7272 6f72 280a  aise TypeError(.
-0001cc40: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001cc50: 2260 706c 616e 6560 206d 7573 7420 6265  "`plane` must be
-0001cc60: 2061 6e20 696e 7374 616e 6365 206f 6620   an instance of 
-0001cc70: 7379 6d70 792e 6765 6f6d 6574 7279 2e50  sympy.geometry.P
-0001cc80: 6c61 6e65 2229 0a20 2020 2020 2020 2073  lane").        s
-0001cc90: 656c 662e 785f 7261 6e67 6520 3d20 7379  elf.x_range = sy
-0001cca0: 6d70 6966 7928 785f 7261 6e67 6529 0a20  mpify(x_range). 
-0001ccb0: 2020 2020 2020 2073 656c 662e 795f 7261         self.y_ra
-0001ccc0: 6e67 6520 3d20 7379 6d70 6966 7928 795f  nge = sympify(y_
-0001ccd0: 7261 6e67 6529 0a20 2020 2020 2020 2073  range).        s
-0001cce0: 656c 662e 7a5f 7261 6e67 6520 3d20 7379  elf.z_range = sy
-0001ccf0: 6d70 6966 7928 7a5f 7261 6e67 6529 0a20  mpify(z_range). 
-0001cd00: 2020 2020 2020 2073 656c 662e 7261 6e67         self.rang
-0001cd10: 6573 203d 205b 7365 6c66 2e78 5f72 616e  es = [self.x_ran
-0001cd20: 6765 2c20 7365 6c66 2e79 5f72 616e 6765  ge, self.y_range
-0001cd30: 2c20 7365 6c66 2e7a 5f72 616e 6765 5d0a  , self.z_range].
-0001cd40: 2020 2020 2020 2020 7365 6c66 2e5f 7365          self._se
-0001cd50: 745f 7375 7266 6163 655f 6c61 6265 6c28  t_surface_label(
-0001cd60: 6c61 6265 6c29 0a20 2020 2020 2020 2069  label).        i
-0001cd70: 6620 7365 6c66 2e70 6172 616d 7320 616e  f self.params an
-0001cd80: 6420 6e6f 7420 7365 6c66 2e70 6c61 6e65  d not self.plane
-0001cd90: 2e66 7265 655f 7379 6d62 6f6c 733a 0a20  .free_symbols:. 
-0001cda0: 2020 2020 2020 2020 2020 2073 656c 662e             self.
-0001cdb0: 7061 7261 6d73 203d 2064 6963 7428 290a  params = dict().
-0001cdc0: 2020 2020 2020 2020 2020 2020 7365 6c66              self
-0001cdd0: 2e69 735f 696e 7465 7261 6374 6976 6520  .is_interactive 
-0001cde0: 3d20 4661 6c73 650a 0a20 2020 2064 6566  = False..    def
-0001cdf0: 205f 5f73 7472 5f5f 2873 656c 6629 3a0a   __str__(self):.
-0001ce00: 2020 2020 2020 2020 7265 7475 726e 2073          return s
-0001ce10: 656c 662e 5f73 7472 5f68 656c 7065 7228  elf._str_helper(
-0001ce20: 0a20 2020 2020 2020 2020 2020 2022 706c  .            "pl
-0001ce30: 616e 6520 7365 7269 6573 3a20 2573 206f  ane series: %s o
-0001ce40: 7665 7220 2573 2c20 2573 2c20 2573 2220  ver %s, %s, %s" 
-0001ce50: 2520 280a 2020 2020 2020 2020 2020 2020  % (.            
-0001ce60: 2020 2020 7365 6c66 2e70 6c61 6e65 2c20      self.plane, 
-0001ce70: 7365 6c66 2e78 5f72 616e 6765 2c20 7365  self.x_range, se
-0001ce80: 6c66 2e79 5f72 616e 6765 2c20 7365 6c66  lf.y_range, self
-0001ce90: 2e7a 5f72 616e 6765 2929 0a0a 2020 2020  .z_range))..    
-0001cea0: 6465 6620 6765 745f 6461 7461 2873 656c  def get_data(sel
-0001ceb0: 6629 3a0a 2020 2020 2020 2020 6e70 203d  f):.        np =
-0001cec0: 2069 6d70 6f72 745f 6d6f 6475 6c65 2827   import_module('
-0001ced0: 6e75 6d70 7927 290a 0a20 2020 2020 2020  numpy')..       
-0001cee0: 2078 2c20 792c 207a 203d 2073 796d 626f   x, y, z = symbo
-0001cef0: 6c73 2822 782c 2079 2c20 7a22 290a 2020  ls("x, y, z").  
-0001cf00: 2020 2020 2020 706c 616e 6520 3d20 7365        plane = se
-0001cf10: 6c66 2e70 6c61 6e65 2e73 7562 7328 7365  lf.plane.subs(se
-0001cf20: 6c66 2e5f 7061 7261 6d73 290a 2020 2020  lf._params).    
-0001cf30: 2020 2020 6673 203d 2070 6c61 6e65 2e65      fs = plane.e
-0001cf40: 7175 6174 696f 6e28 782c 2079 2c20 7a29  quation(x, y, z)
-0001cf50: 2e66 7265 655f 7379 6d62 6f6c 730a 2020  .free_symbols.  
-0001cf60: 2020 2020 2020 7878 2c20 7979 2c20 7a7a        xx, yy, zz
-0001cf70: 203d 204e 6f6e 652c 204e 6f6e 652c 204e   = None, None, N
-0001cf80: 6f6e 650a 2020 2020 2020 2020 6966 2066  one.        if f
-0001cf90: 7320 3d3d 2073 6574 285b 785d 293a 0a20  s == set([x]):. 
-0001cfa0: 2020 2020 2020 2020 2020 2023 2070 6172             # par
-0001cfb0: 616c 6c65 6c20 746f 2079 7a20 706c 616e  allel to yz plan
-0001cfc0: 6520 286e 6f72 6d61 6c20 7665 6374 6f72  e (normal vector
-0001cfd0: 2028 312c 2030 2c20 3029 290a 2020 2020   (1, 0, 0)).    
-0001cfe0: 2020 2020 2020 2020 7320 3d20 5375 7266          s = Surf
-0001cff0: 6163 654f 7665 7232 4452 616e 6765 5365  aceOver2DRangeSe
-0001d000: 7269 6573 280a 2020 2020 2020 2020 2020  ries(.          
-0001d010: 2020 2020 2020 706c 616e 652e 7031 5b30        plane.p1[0
-0001d020: 5d2c 0a20 2020 2020 2020 2020 2020 2020  ],.             
-0001d030: 2020 2028 782c 202a 7365 6c66 2e7a 5f72     (x, *self.z_r
-0001d040: 616e 6765 5b31 3a5d 292c 0a20 2020 2020  ange[1:]),.     
-0001d050: 2020 2020 2020 2020 2020 2028 792c 202a             (y, *
-0001d060: 7365 6c66 2e79 5f72 616e 6765 5b31 3a5d  self.y_range[1:]
-0001d070: 292c 0a20 2020 2020 2020 2020 2020 2020  ),.             
-0001d080: 2020 2022 222c 0a20 2020 2020 2020 2020     "",.         
-0001d090: 2020 2020 2020 206e 313d 7365 6c66 2e6e         n1=self.n
-0001d0a0: 5b32 5d2c 0a20 2020 2020 2020 2020 2020  [2],.           
-0001d0b0: 2020 2020 206e 323d 7365 6c66 2e6e 5b31       n2=self.n[1
-0001d0c0: 5d2c 0a20 2020 2020 2020 2020 2020 2020  ],.             
-0001d0d0: 2020 2078 7363 616c 653d 7365 6c66 2e5f     xscale=self._
-0001d0e0: 7363 616c 6573 5b30 5d2c 0a20 2020 2020  scales[0],.     
-0001d0f0: 2020 2020 2020 2020 2020 2079 7363 616c             yscal
-0001d100: 653d 7365 6c66 2e5f 7363 616c 6573 5b31  e=self._scales[1
-0001d110: 5d0a 2020 2020 2020 2020 2020 2020 290a  ].            ).
-0001d120: 2020 2020 2020 2020 2020 2020 7878 2c20              xx, 
-0001d130: 7979 2c20 7a7a 203d 2073 2e67 6574 5f64  yy, zz = s.get_d
-0001d140: 6174 6128 290a 2020 2020 2020 2020 2020  ata().          
-0001d150: 2020 7878 2c20 7979 2c20 7a7a 203d 207a    xx, yy, zz = z
-0001d160: 7a2c 2079 792c 2078 780a 2020 2020 2020  z, yy, xx.      
-0001d170: 2020 656c 6966 2066 7320 3d3d 2073 6574    elif fs == set
-0001d180: 285b 795d 293a 0a20 2020 2020 2020 2020  ([y]):.         
-0001d190: 2020 2023 2070 6172 616c 6c65 6c20 746f     # parallel to
-0001d1a0: 2078 7a20 706c 616e 6520 286e 6f72 6d61   xz plane (norma
-0001d1b0: 6c20 7665 6374 6f72 2028 302c 2031 2c20  l vector (0, 1, 
-0001d1c0: 3029 290a 2020 2020 2020 2020 2020 2020  0)).            
-0001d1d0: 7320 3d20 5375 7266 6163 654f 7665 7232  s = SurfaceOver2
-0001d1e0: 4452 616e 6765 5365 7269 6573 280a 2020  DRangeSeries(.  
-0001d1f0: 2020 2020 2020 2020 2020 2020 2020 706c                pl
-0001d200: 616e 652e 7031 5b31 5d2c 0a20 2020 2020  ane.p1[1],.     
-0001d210: 2020 2020 2020 2020 2020 2028 782c 202a             (x, *
-0001d220: 7365 6c66 2e78 5f72 616e 6765 5b31 3a5d  self.x_range[1:]
-0001d230: 292c 0a20 2020 2020 2020 2020 2020 2020  ),.             
-0001d240: 2020 2028 792c 202a 7365 6c66 2e7a 5f72     (y, *self.z_r
-0001d250: 616e 6765 5b31 3a5d 292c 0a20 2020 2020  ange[1:]),.     
-0001d260: 2020 2020 2020 2020 2020 2022 222c 0a20             "",. 
-0001d270: 2020 2020 2020 2020 2020 2020 2020 206e                 n
-0001d280: 313d 7365 6c66 2e6e 5b30 5d2c 0a20 2020  1=self.n[0],.   
-0001d290: 2020 2020 2020 2020 2020 2020 206e 323d               n2=
-0001d2a0: 7365 6c66 2e6e 5b32 5d2c 0a20 2020 2020  self.n[2],.     
-0001d2b0: 2020 2020 2020 2020 2020 2078 7363 616c             xscal
-0001d2c0: 653d 7365 6c66 2e5f 7363 616c 6573 5b30  e=self._scales[0
-0001d2d0: 5d2c 0a20 2020 2020 2020 2020 2020 2020  ],.             
-0001d2e0: 2020 2079 7363 616c 653d 7365 6c66 2e5f     yscale=self._
-0001d2f0: 7363 616c 6573 5b31 5d0a 2020 2020 2020  scales[1].      
-0001d300: 2020 2020 2020 290a 2020 2020 2020 2020        ).        
-0001d310: 2020 2020 7878 2c20 7979 2c20 7a7a 203d      xx, yy, zz =
-0001d320: 2073 2e67 6574 5f64 6174 6128 290a 2020   s.get_data().  
-0001d330: 2020 2020 2020 2020 2020 7878 2c20 7979            xx, yy
-0001d340: 2c20 7a7a 203d 2078 782c 207a 7a2c 2079  , zz = xx, zz, y
-0001d350: 790a 2020 2020 2020 2020 656c 6966 2066  y.        elif f
-0001d360: 7320 3d3d 2073 6574 285b 782c 2079 5d29  s == set([x, y])
-0001d370: 3a0a 2020 2020 2020 2020 2020 2020 2320  :.            # 
-0001d380: 7665 7274 6963 616c 2070 6c61 6e65 206f  vertical plane o
-0001d390: 7269 656e 7465 6420 7769 7468 2073 6f6d  riented with som
-0001d3a0: 6520 616e 676c 650a 0a20 2020 2020 2020  e angle..       
-0001d3b0: 2020 2020 2023 2047 6574 206e 756d 7079       # Get numpy
-0001d3c0: 2076 6563 746f 7273 0a20 2020 2020 2020   vectors.       
-0001d3d0: 2020 2020 2070 3120 3d20 6e70 2e61 7272       p1 = np.arr
-0001d3e0: 6179 2870 6c61 6e65 2e70 312c 2064 7479  ay(plane.p1, dty
-0001d3f0: 7065 3d66 6c6f 6174 290a 2020 2020 2020  pe=float).      
-0001d400: 2020 2020 2020 6e76 203d 206e 702e 6172        nv = np.ar
-0001d410: 7261 7928 706c 616e 652e 6e6f 726d 616c  ray(plane.normal
-0001d420: 5f76 6563 746f 722c 2064 7479 7065 3d66  _vector, dtype=f
-0001d430: 6c6f 6174 290a 2020 2020 2020 2020 2020  loat).          
-0001d440: 2020 2320 636f 6e76 6572 7420 7468 6520    # convert the 
-0001d450: 6e6f 726d 616c 2076 6563 746f 7220 746f  normal vector to
-0001d460: 2075 6e69 7420 6e6f 726d 616c 2076 6563   unit normal vec
-0001d470: 746f 720a 2020 2020 2020 2020 2020 2020  tor.            
-0001d480: 6e76 203d 206e 7620 2f20 6e70 2e73 7172  nv = nv / np.sqr
-0001d490: 7428 6e76 2e54 2040 206e 7629 0a0a 2020  t(nv.T @ nv)..  
-0001d4a0: 2020 2020 2020 2020 2020 2320 706c 616e            # plan
-0001d4b0: 6520 6861 7320 6469 7374 616e 6365 2074  e has distance t
-0001d4c0: 6f20 6f72 6967 696e 2061 7320 6c65 6e67  o origin as leng
-0001d4d0: 7468 206f 6620 7072 6f6a 6563 7469 6f6e  th of projection
-0001d4e0: 206f 660a 2020 2020 2020 2020 2020 2020   of.            
-0001d4f0: 2320 7031 206f 6e74 6f20 6e6f 726d 616c  # p1 onto normal
-0001d500: 2076 6563 746f 720a 2020 2020 2020 2020   vector.        
-0001d510: 2020 2020 7072 6f6a 5f70 326e 7620 3d20      proj_p2nv = 
-0001d520: 6e76 2e64 6f74 2870 3129 0a0a 2020 2020  nv.dot(p1)..    
-0001d530: 2020 2020 2020 2020 7320 3d20 5375 7266          s = Surf
-0001d540: 6163 654f 7665 7232 4452 616e 6765 5365  aceOver2DRangeSe
-0001d550: 7269 6573 280a 2020 2020 2020 2020 2020  ries(.          
-0001d560: 2020 2020 2020 7072 6f6a 5f70 326e 762c        proj_p2nv,
-0001d570: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0001d580: 2028 782c 202a 7365 6c66 2e78 5f72 616e   (x, *self.x_ran
-0001d590: 6765 5b31 3a5d 292c 0a20 2020 2020 2020  ge[1:]),.       
-0001d5a0: 2020 2020 2020 2020 2028 792c 202a 7365           (y, *se
-0001d5b0: 6c66 2e7a 5f72 616e 6765 5b31 3a5d 292c  lf.z_range[1:]),
-0001d5c0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0001d5d0: 2022 222c 0a20 2020 2020 2020 2020 2020   "",.           
-0001d5e0: 2020 2020 206e 313d 7365 6c66 2e6e 5b30       n1=self.n[0
-0001d5f0: 5d2c 0a20 2020 2020 2020 2020 2020 2020  ],.             
-0001d600: 2020 206e 323d 7365 6c66 2e6e 5b32 5d2c     n2=self.n[2],
-0001d610: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0001d620: 2078 7363 616c 653d 7365 6c66 2e5f 7363   xscale=self._sc
-0001d630: 616c 6573 5b30 5d2c 0a20 2020 2020 2020  ales[0],.       
-0001d640: 2020 2020 2020 2020 2079 7363 616c 653d           yscale=
-0001d650: 7365 6c66 2e5f 7363 616c 6573 5b31 5d0a  self._scales[1].
-0001d660: 2020 2020 2020 2020 2020 2020 290a 2020              ).  
-0001d670: 2020 2020 2020 2020 2020 7878 2c20 7979            xx, yy
-0001d680: 2c20 7a7a 203d 2073 2e67 6574 5f64 6174  , zz = s.get_dat
-0001d690: 6128 290a 2020 2020 2020 2020 2020 2020  a().            
-0001d6a0: 7878 2c20 7979 2c20 7a7a 203d 2078 782c  xx, yy, zz = xx,
-0001d6b0: 207a 7a2c 2079 790a 0a20 2020 2020 2020   zz, yy..       
-0001d6c0: 2020 2020 2023 2072 6f74 6174 6520 706c       # rotate pl
-0001d6d0: 616e 6520 636f 7272 6573 706f 6e64 696e  ane correspondin
-0001d6e0: 6720 746f 2074 6865 206e 6f72 6d61 6c20  g to the normal 
-0001d6f0: 7665 6374 6f72 0a20 2020 2020 2020 2020  vector.         
-0001d700: 2020 2064 6566 2052 2874 293a 0a20 2020     def R(t):.   
-0001d710: 2020 2020 2020 2020 2020 2020 2072 6574               ret
-0001d720: 7572 6e20 6e70 2e61 7272 6179 285b 0a20  urn np.array([. 
-0001d730: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001d740: 2020 205b 6e70 2e63 6f73 2874 292c 202d     [np.cos(t), -
-0001d750: 6e70 2e73 696e 2874 292c 2030 5d2c 0a20  np.sin(t), 0],. 
-0001d760: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001d770: 2020 205b 6e70 2e73 696e 2874 292c 206e     [np.sin(t), n
-0001d780: 702e 636f 7328 7429 2c20 305d 2c0a 2020  p.cos(t), 0],.  
-0001d790: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001d7a0: 2020 5b30 2c20 302c 2031 5d0a 2020 2020    [0, 0, 1].    
-0001d7b0: 2020 2020 2020 2020 2020 2020 5d29 0a0a              ])..
-0001d7c0: 2020 2020 2020 2020 2020 2020 7468 6574              thet
-0001d7d0: 6120 3d20 6e70 2e61 7263 7461 6e32 286e  a = np.arctan2(n
-0001d7e0: 765b 315d 2c20 6e76 5b30 5d29 0a20 2020  v[1], nv[0]).   
-0001d7f0: 2020 2020 2020 2020 2063 6f6f 7264 7320           coords 
-0001d800: 3d20 6e70 2e73 7461 636b 285b 742e 666c  = np.stack([t.fl
-0001d810: 6174 7465 6e28 2920 666f 7220 7420 696e  atten() for t in
-0001d820: 205b 7878 2c20 7979 2c20 6e70 2e6f 6e65   [xx, yy, np.one
-0001d830: 735f 6c69 6b65 2878 7829 5d5d 292e 540a  s_like(xx)]]).T.
-0001d840: 2020 2020 2020 2020 2020 2020 636f 6f72              coor
-0001d850: 6473 203d 206e 702e 6d61 746d 756c 2863  ds = np.matmul(c
-0001d860: 6f6f 7264 732c 2052 2874 6865 7461 2929  oords, R(theta))
-0001d870: 0a20 2020 2020 2020 2020 2020 2079 792c  .            yy,
-0001d880: 2078 7820 3d20 636f 6f72 6473 5b3a 2c20   xx = coords[:, 
-0001d890: 305d 2e72 6573 6861 7065 2879 792e 7368  0].reshape(yy.sh
-0001d8a0: 6170 6529 2c20 636f 6f72 6473 5b3a 2c20  ape), coords[:, 
-0001d8b0: 315d 2e72 6573 6861 7065 2878 782e 7368  1].reshape(xx.sh
-0001d8c0: 6170 6529 0a20 2020 2020 2020 2065 6c73  ape).        els
-0001d8d0: 653a 0a20 2020 2020 2020 2020 2020 2023  e:.            #
-0001d8e0: 2061 6e79 206f 7468 6572 2070 6c61 6e65   any other plane
-0001d8f0: 0a20 2020 2020 2020 2020 2020 2065 7120  .            eq 
-0001d900: 3d20 706c 616e 652e 6571 7561 7469 6f6e  = plane.equation
-0001d910: 2878 2c20 792c 207a 290a 2020 2020 2020  (x, y, z).      
-0001d920: 2020 2020 2020 6966 207a 2069 6e20 6571        if z in eq
-0001d930: 2e66 7265 655f 7379 6d62 6f6c 733a 0a20  .free_symbols:. 
-0001d940: 2020 2020 2020 2020 2020 2020 2020 2065                 e
-0001d950: 7120 3d20 736f 6c76 6528 6571 2c20 7a29  q = solve(eq, z)
-0001d960: 5b30 5d0a 2020 2020 2020 2020 2020 2020  [0].            
-0001d970: 7320 3d20 5375 7266 6163 654f 7665 7232  s = SurfaceOver2
-0001d980: 4452 616e 6765 5365 7269 6573 280a 2020  DRangeSeries(.  
-0001d990: 2020 2020 2020 2020 2020 2020 2020 6571                eq
-0001d9a0: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
-0001d9b0: 2020 2878 2c20 2a73 656c 662e 785f 7261    (x, *self.x_ra
-0001d9c0: 6e67 655b 313a 5d29 2c0a 2020 2020 2020  nge[1:]),.      
-0001d9d0: 2020 2020 2020 2020 2020 2879 2c20 2a73            (y, *s
-0001d9e0: 656c 662e 795f 7261 6e67 655b 313a 5d29  elf.y_range[1:])
-0001d9f0: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
-0001da00: 2020 2222 2c0a 2020 2020 2020 2020 2020    "",.          
-0001da10: 2020 2020 2020 6e31 3d73 656c 662e 6e5b        n1=self.n[
-0001da20: 305d 2c0a 2020 2020 2020 2020 2020 2020  0],.            
-0001da30: 2020 2020 6e32 3d73 656c 662e 6e5b 315d      n2=self.n[1]
-0001da40: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
-0001da50: 2020 7873 6361 6c65 3d73 656c 662e 5f73    xscale=self._s
-0001da60: 6361 6c65 735b 305d 2c0a 2020 2020 2020  cales[0],.      
-0001da70: 2020 2020 2020 2020 2020 7973 6361 6c65            yscale
-0001da80: 3d73 656c 662e 5f73 6361 6c65 735b 315d  =self._scales[1]
-0001da90: 0a20 2020 2020 2020 2020 2020 2029 0a20  .            ). 
-0001daa0: 2020 2020 2020 2020 2020 2078 782c 2079             xx, y
-0001dab0: 792c 207a 7a20 3d20 732e 6765 745f 6461  y, zz = s.get_da
-0001dac0: 7461 2829 0a20 2020 2020 2020 2020 2020  ta().           
-0001dad0: 2069 6620 286c 656e 2866 7329 203e 2031   if (len(fs) > 1
-0001dae0: 2920 616e 6420 7365 6c66 2e5f 7573 655f  ) and self._use_
-0001daf0: 6e61 6e3a 0a20 2020 2020 2020 2020 2020  nan:.           
-0001db00: 2020 2020 2069 6478 203d 206e 702e 6c6f       idx = np.lo
-0001db10: 6769 6361 6c5f 6f72 287a 7a20 3c20 7365  gical_or(zz < se
-0001db20: 6c66 2e7a 5f72 616e 6765 5b31 5d2c 207a  lf.z_range[1], z
-0001db30: 7a20 3e20 7365 6c66 2e7a 5f72 616e 6765  z > self.z_range
-0001db40: 5b32 5d29 0a20 2020 2020 2020 2020 2020  [2]).           
-0001db50: 2020 2020 207a 7a5b 6964 785d 203d 206e       zz[idx] = n
-0001db60: 702e 6e61 6e0a 2020 2020 2020 2020 7265  p.nan.        re
-0001db70: 7475 726e 2073 656c 662e 5f61 7070 6c79  turn self._apply
-0001db80: 5f74 7261 6e73 666f 726d 2878 782c 2079  _transform(xx, y
-0001db90: 792c 207a 7a29 0a0a 0a63 6c61 7373 2047  y, zz)...class G
-0001dba0: 656f 6d65 7472 7953 6572 6965 7328 4c69  eometrySeries(Li
-0001dbb0: 6e65 3244 4261 7365 5365 7269 6573 293a  ne2DBaseSeries):
-0001dbc0: 0a20 2020 2022 2222 5265 7072 6573 656e  .    """Represen
-0001dbd0: 7473 2061 6e20 656e 7469 7479 2066 726f  ts an entity fro
-0001dbe0: 6d20 7468 6520 7379 6d70 792e 6765 6f6d  m the sympy.geom
-0001dbf0: 6574 7279 206d 6f64 756c 652e 0a20 2020  etry module..   
-0001dc00: 2044 6570 656e 6469 6e67 206f 6e20 7468   Depending on th
-0001dc10: 6520 6765 6f6d 6574 7279 2065 6e74 6974  e geometry entit
-0001dc20: 792c 2074 6869 7320 636c 6173 7320 6361  y, this class ca
-0001dc30: 6e20 6569 7468 6572 2072 6570 7265 7365  n either represe
-0001dc40: 6e74 7320 610a 2020 2020 706f 696e 742c  nts a.    point,
-0001dc50: 2061 206c 696e 652c 206f 7220 6120 7061   a line, or a pa
-0001dc60: 7261 6d65 7472 6963 206c 696e 650a 2020  rametric line.  
-0001dc70: 2020 2222 220a 0a20 2020 2069 735f 6765    """..    is_ge
-0001dc80: 6f6d 6574 7279 203d 2054 7275 650a 0a20  ometry = True.. 
-0001dc90: 2020 2064 6566 205f 5f6e 6577 5f5f 2863     def __new__(c
-0001dca0: 6c73 2c20 2a61 7267 732c 202a 2a6b 7761  ls, *args, **kwa
-0001dcb0: 7267 7329 3a0a 2020 2020 2020 2020 6966  rgs):.        if
-0001dcc0: 2069 7369 6e73 7461 6e63 6528 6172 6773   isinstance(args
-0001dcd0: 5b30 5d2c 2050 6c61 6e65 293a 0a20 2020  [0], Plane):.   
-0001dce0: 2020 2020 2020 2020 2072 6574 7572 6e20           return 
-0001dcf0: 506c 616e 6553 6572 6965 7328 2a61 7267  PlaneSeries(*arg
-0001dd00: 732c 202a 2a6b 7761 7267 7329 0a20 2020  s, **kwargs).   
-0001dd10: 2020 2020 2065 6c69 6620 6973 696e 7374       elif isinst
-0001dd20: 616e 6365 2861 7267 735b 305d 2c20 4375  ance(args[0], Cu
-0001dd30: 7276 6529 3a0a 2020 2020 2020 2020 2020  rve):.          
-0001dd40: 2020 6e65 775f 636c 7320 3d20 280a 2020    new_cls = (.  
-0001dd50: 2020 2020 2020 2020 2020 2020 2020 5061                Pa
-0001dd60: 7261 6d65 7472 6963 3244 4c69 6e65 5365  rametric2DLineSe
-0001dd70: 7269 6573 0a20 2020 2020 2020 2020 2020  ries.           
-0001dd80: 2020 2020 2069 6620 6c65 6e28 6172 6773       if len(args
-0001dd90: 5b30 5d2e 6675 6e63 7469 6f6e 7329 203d  [0].functions) =
-0001dda0: 3d20 320a 2020 2020 2020 2020 2020 2020  = 2.            
-0001ddb0: 2020 2020 656c 7365 2050 6172 616d 6574      else Paramet
-0001ddc0: 7269 6333 444c 696e 6553 6572 6965 730a  ric3DLineSeries.
-0001ddd0: 2020 2020 2020 2020 2020 2020 290a 2020              ).  
-0001dde0: 2020 2020 2020 2020 2020 7265 7475 726e            return
-0001ddf0: 206e 6577 5f63 6c73 282a 6172 6773 5b30   new_cls(*args[0
-0001de00: 5d2e 6675 6e63 7469 6f6e 732c 2061 7267  ].functions, arg
-0001de10: 735b 305d 2e6c 696d 6974 732c 202a 2a6b  s[0].limits, **k
-0001de20: 7761 7267 7329 0a20 2020 2020 2020 2072  wargs).        r
-0001de30: 6574 7572 6e20 6f62 6a65 6374 2e5f 5f6e  eturn object.__n
-0001de40: 6577 5f5f 2863 6c73 290a 0a20 2020 2064  ew__(cls)..    d
-0001de50: 6566 205f 5f69 6e69 745f 5f28 7365 6c66  ef __init__(self
-0001de60: 2c20 6578 7072 2c20 5f72 616e 6765 3d4e  , expr, _range=N
-0001de70: 6f6e 652c 206c 6162 656c 3d22 222c 202a  one, label="", *
-0001de80: 2a6b 7761 7267 7329 3a0a 2020 2020 2020  *kwargs):.      
-0001de90: 2020 6966 206e 6f74 2069 7369 6e73 7461    if not isinsta
-0001dea0: 6e63 6528 6578 7072 2c20 4765 6f6d 6574  nce(expr, Geomet
-0001deb0: 7279 456e 7469 7479 293a 0a20 2020 2020  ryEntity):.     
-0001dec0: 2020 2020 2020 2072 6169 7365 2056 616c         raise Val
-0001ded0: 7565 4572 726f 7228 0a20 2020 2020 2020  ueError(.       
-0001dee0: 2020 2020 2020 2020 2022 6065 7870 7260           "`expr`
-0001def0: 206d 7573 7420 6265 2061 2067 656f 6d74   must be a geomt
-0001df00: 7269 6320 656e 7469 7479 2e5c 6e22 0a20  ric entity.\n". 
-0001df10: 2020 2020 2020 2020 2020 2020 2020 202b                 +
-0001df20: 2022 5265 6365 6976 6564 3a20 7479 7065   "Received: type
-0001df30: 2865 7870 7229 203d 207b 7d5c 6e22 2e66  (expr) = {}\n".f
-0001df40: 6f72 6d61 7428 7479 7065 2865 7870 7229  ormat(type(expr)
-0001df50: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
-0001df60: 2020 2b20 2245 7870 723a 207b 7d22 2e66    + "Expr: {}".f
-0001df70: 6f72 6d61 7428 6578 7072 290a 2020 2020  ormat(expr).    
-0001df80: 2020 2020 2020 2020 290a 2020 2020 2020          ).      
-0001df90: 2020 7375 7065 7228 292e 5f5f 696e 6974    super().__init
-0001dfa0: 5f5f 282a 2a6b 7761 7267 7329 0a20 2020  __(**kwargs).   
-0001dfb0: 2020 2020 2072 203d 2065 7870 722e 6672       r = expr.fr
-0001dfc0: 6565 5f73 796d 626f 6c73 2e64 6966 6665  ee_symbols.diffe
-0001dfd0: 7265 6e63 6528 7365 7428 7365 6c66 2e70  rence(set(self.p
-0001dfe0: 6172 616d 732e 6b65 7973 2829 2929 0a20  arams.keys())). 
-0001dff0: 2020 2020 2020 2069 6620 6c65 6e28 7229         if len(r)
-0001e000: 203e 2030 3a0a 2020 2020 2020 2020 2020   > 0:.          
-0001e010: 2020 7261 6973 6520 5661 6c75 6545 7272    raise ValueErr
-0001e020: 6f72 280a 2020 2020 2020 2020 2020 2020  or(.            
-0001e030: 2020 2020 2254 6f6f 206d 616e 7920 6672      "Too many fr
-0001e040: 6565 2073 796d 626f 6c73 2e20 506c 6561  ee symbols. Plea
-0001e050: 7365 2c20 7370 6563 6966 7920 7468 6520  se, specify the 
-0001e060: 7661 6c75 6573 206f 6620 7468 6520 220a  values of the ".
-0001e070: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001e080: 6622 666f 6c6c 6f77 696e 6720 7379 6d62  f"following symb
-0001e090: 6f6c 7320 7769 7468 2074 6865 2060 7061  ols with the `pa
-0001e0a0: 7261 6d73 6020 6469 6374 696f 6e61 7279  rams` dictionary
-0001e0b0: 3a20 7b72 7d22 0a20 2020 2020 2020 2020  : {r}".         
-0001e0c0: 2020 2029 0a20 2020 2020 2020 2073 656c     ).        sel
-0001e0d0: 662e 5f65 7870 7220 3d20 6578 7072 0a20  f._expr = expr. 
-0001e0e0: 2020 2020 2020 2073 656c 662e 7261 6e67         self.rang
-0001e0f0: 6573 203d 205b 5f72 616e 6765 5d0a 2020  es = [_range].  
-0001e100: 2020 2020 2020 7365 6c66 2e5f 6c61 6265        self._labe
-0001e110: 6c20 3d20 7374 7228 6578 7072 2920 6966  l = str(expr) if
-0001e120: 206c 6162 656c 2069 7320 4e6f 6e65 2065   label is None e
-0001e130: 6c73 6520 6c61 6265 6c0a 2020 2020 2020  lse label.      
-0001e140: 2020 7365 6c66 2e5f 6c61 7465 785f 6c61    self._latex_la
-0001e150: 6265 6c20 3d20 6c61 7465 7828 6578 7072  bel = latex(expr
-0001e160: 2920 6966 206c 6162 656c 2069 7320 4e6f  ) if label is No
-0001e170: 6e65 2065 6c73 6520 6c61 6265 6c0a 2020  ne else label.  
-0001e180: 2020 2020 2020 6966 2069 7369 6e73 7461        if isinsta
-0001e190: 6e63 6528 6578 7072 2c20 284c 696e 6561  nce(expr, (Linea
-0001e1a0: 7245 6e74 6974 7933 442c 2050 6f69 6e74  rEntity3D, Point
-0001e1b0: 3344 2929 3a0a 2020 2020 2020 2020 2020  3D)):.          
-0001e1c0: 2020 7365 6c66 2e69 735f 3244 6c69 6e65    self.is_2Dline
-0001e1d0: 203d 2046 616c 7365 0a20 2020 2020 2020   = False.       
-0001e1e0: 2020 2020 2073 656c 662e 6973 5f33 446c       self.is_3Dl
-0001e1f0: 696e 6520 3d20 5472 7565 0a20 2020 2020  ine = True.     
-0001e200: 2020 2020 2020 2073 656c 662e 6973 5f70         self.is_p
-0001e210: 6172 616d 6574 7269 6320 3d20 4661 6c73  arametric = Fals
-0001e220: 650a 2020 2020 2020 2020 2020 2020 6966  e.            if
-0001e230: 2069 7369 6e73 7461 6e63 6528 6578 7072   isinstance(expr
-0001e240: 2c20 506f 696e 7433 4429 3a0a 2020 2020  , Point3D):.    
-0001e250: 2020 2020 2020 2020 2020 2020 7365 6c66              self
-0001e260: 2e69 735f 706f 696e 7420 3d20 5472 7565  .is_point = True
-0001e270: 0a20 2020 2020 2020 2065 6c69 6620 6973  .        elif is
-0001e280: 696e 7374 616e 6365 2865 7870 722c 204c  instance(expr, L
-0001e290: 696e 6561 7245 6e74 6974 7932 4429 3a0a  inearEntity2D):.
-0001e2a0: 2020 2020 2020 2020 2020 2020 7365 6c66              self
-0001e2b0: 2e69 735f 3244 6c69 6e65 203d 2054 7275  .is_2Dline = Tru
-0001e2c0: 650a 2020 2020 2020 2020 656c 6966 2069  e.        elif i
-0001e2d0: 7369 6e73 7461 6e63 6528 6578 7072 2c20  sinstance(expr, 
-0001e2e0: 2850 6f6c 7967 6f6e 2c20 4369 7263 6c65  (Polygon, Circle
-0001e2f0: 2c20 456c 6c69 7073 6529 293a 0a20 2020  , Ellipse)):.   
-0001e300: 2020 2020 2020 2020 2073 656c 662e 6973           self.is
-0001e310: 5f32 446c 696e 6520 3d20 6e6f 7420 7365  _2Dline = not se
-0001e320: 6c66 2e69 735f 6669 6c6c 6564 0a20 2020  lf.is_filled.   
-0001e330: 2020 2020 2065 6c69 6620 6973 696e 7374       elif isinst
-0001e340: 616e 6365 2865 7870 722c 2050 6f69 6e74  ance(expr, Point
-0001e350: 3244 293a 0a20 2020 2020 2020 2020 2020  2D):.           
-0001e360: 2073 656c 662e 6973 5f70 6f69 6e74 203d   self.is_point =
-0001e370: 2054 7275 650a 2020 2020 2020 2020 2020   True.          
-0001e380: 2020 7365 6c66 2e69 735f 3244 6c69 6e65    self.is_2Dline
-0001e390: 203d 2054 7275 650a 2020 2020 2020 2020   = True.        
-0001e3a0: 2020 2020 7365 6c66 2e70 6f6c 6573 5f6c      self.poles_l
-0001e3b0: 6f63 6174 696f 6e73 203d 205b 5d0a 0a20  ocations = [].. 
-0001e3c0: 2020 2064 6566 2067 6574 5f64 6174 6128     def get_data(
-0001e3d0: 7365 6c66 293a 0a20 2020 2020 2020 206e  self):.        n
-0001e3e0: 7020 3d20 696d 706f 7274 5f6d 6f64 756c  p = import_modul
-0001e3f0: 6528 276e 756d 7079 2729 0a0a 2020 2020  e('numpy')..    
-0001e400: 2020 2020 6578 7072 203d 2073 656c 662e      expr = self.
-0001e410: 6578 7072 2e73 7562 7328 7365 6c66 2e70  expr.subs(self.p
-0001e420: 6172 616d 7329 0a20 2020 2020 2020 2069  arams).        i
-0001e430: 6620 6973 696e 7374 616e 6365 2865 7870  f isinstance(exp
-0001e440: 722c 2050 6f69 6e74 3344 293a 0a20 2020  r, Point3D):.   
-0001e450: 2020 2020 2020 2020 2072 6574 7572 6e20           return 
-0001e460: 7365 6c66 2e5f 6170 706c 795f 7472 616e  self._apply_tran
-0001e470: 7366 6f72 6d28 0a20 2020 2020 2020 2020  sform(.         
-0001e480: 2020 2020 2020 206e 702e 6172 7261 7928         np.array(
-0001e490: 5b65 7870 722e 785d 2c20 6474 7970 653d  [expr.x], dtype=
-0001e4a0: 666c 6f61 7429 2c0a 2020 2020 2020 2020  float),.        
-0001e4b0: 2020 2020 2020 2020 6e70 2e61 7272 6179          np.array
-0001e4c0: 285b 6578 7072 2e79 5d2c 2064 7479 7065  ([expr.y], dtype
-0001e4d0: 3d66 6c6f 6174 292c 0a20 2020 2020 2020  =float),.       
-0001e4e0: 2020 2020 2020 2020 206e 702e 6172 7261           np.arra
-0001e4f0: 7928 5b65 7870 722e 7a5d 2c20 6474 7970  y([expr.z], dtyp
-0001e500: 653d 666c 6f61 7429 0a20 2020 2020 2020  e=float).       
-0001e510: 2020 2020 2029 0a20 2020 2020 2020 2065       ).        e
-0001e520: 6c69 6620 6973 696e 7374 616e 6365 2865  lif isinstance(e
-0001e530: 7870 722c 2050 6f69 6e74 3244 293a 0a20  xpr, Point2D):. 
-0001e540: 2020 2020 2020 2020 2020 2072 6574 7572             retur
-0001e550: 6e20 7365 6c66 2e5f 6170 706c 795f 7472  n self._apply_tr
-0001e560: 616e 7366 6f72 6d28 0a20 2020 2020 2020  ansform(.       
-0001e570: 2020 2020 2020 2020 206e 702e 6172 7261           np.arra
-0001e580: 7928 5b65 7870 722e 785d 2c20 6474 7970  y([expr.x], dtyp
-0001e590: 653d 666c 6f61 7429 2c0a 2020 2020 2020  e=float),.      
-0001e5a0: 2020 2020 2020 2020 2020 6e70 2e61 7272            np.arr
-0001e5b0: 6179 285b 6578 7072 2e79 5d2c 2064 7479  ay([expr.y], dty
-0001e5c0: 7065 3d66 6c6f 6174 290a 2020 2020 2020  pe=float).      
-0001e5d0: 2020 2020 2020 290a 2020 2020 2020 2020        ).        
-0001e5e0: 656c 6966 2069 7369 6e73 7461 6e63 6528  elif isinstance(
-0001e5f0: 6578 7072 2c20 506f 6c79 676f 6e29 3a0a  expr, Polygon):.
-0001e600: 2020 2020 2020 2020 2020 2020 7820 3d20              x = 
-0001e610: 5b66 6c6f 6174 2876 2e78 2920 666f 7220  [float(v.x) for 
-0001e620: 7620 696e 2065 7870 722e 7665 7274 6963  v in expr.vertic
-0001e630: 6573 5d0a 2020 2020 2020 2020 2020 2020  es].            
-0001e640: 7920 3d20 5b66 6c6f 6174 2876 2e79 2920  y = [float(v.y) 
-0001e650: 666f 7220 7620 696e 2065 7870 722e 7665  for v in expr.ve
-0001e660: 7274 6963 6573 5d0a 2020 2020 2020 2020  rtices].        
-0001e670: 2020 2020 782e 6170 7065 6e64 2878 5b30      x.append(x[0
-0001e680: 5d29 0a20 2020 2020 2020 2020 2020 2079  ]).            y
-0001e690: 2e61 7070 656e 6428 795b 305d 290a 2020  .append(y[0]).  
-0001e6a0: 2020 2020 2020 2020 2020 7265 7475 726e            return
-0001e6b0: 2073 656c 662e 5f61 7070 6c79 5f74 7261   self._apply_tra
-0001e6c0: 6e73 666f 726d 286e 702e 6172 7261 7928  nsform(np.array(
-0001e6d0: 7829 2c20 6e70 2e61 7272 6179 2879 2929  x), np.array(y))
-0001e6e0: 0a20 2020 2020 2020 2065 6c69 6620 6973  .        elif is
-0001e6f0: 696e 7374 616e 6365 2865 7870 722c 2043  instance(expr, C
-0001e700: 6972 636c 6529 3a0a 2020 2020 2020 2020  ircle):.        
-0001e710: 2020 2020 6378 2c20 6379 203d 2066 6c6f      cx, cy = flo
-0001e720: 6174 2865 7870 722e 6365 6e74 6572 5b30  at(expr.center[0
-0001e730: 5d29 2c20 666c 6f61 7428 6578 7072 2e63  ]), float(expr.c
-0001e740: 656e 7465 725b 315d 290a 2020 2020 2020  enter[1]).      
-0001e750: 2020 2020 2020 7220 3d20 666c 6f61 7428        r = float(
-0001e760: 6578 7072 2e72 6164 6975 7329 0a20 2020  expr.radius).   
-0001e770: 2020 2020 2020 2020 2074 203d 206e 702e           t = np.
-0001e780: 6c69 6e73 7061 6365 2830 2c20 3220 2a20  linspace(0, 2 * 
-0001e790: 6e70 2e70 692c 2073 656c 662e 6e5b 305d  np.pi, self.n[0]
-0001e7a0: 290a 2020 2020 2020 2020 2020 2020 782c  ).            x,
-0001e7b0: 2079 203d 2063 7820 2b20 7220 2a20 6e70   y = cx + r * np
-0001e7c0: 2e63 6f73 2874 292c 2063 7920 2b20 7220  .cos(t), cy + r 
-0001e7d0: 2a20 6e70 2e73 696e 2874 290a 2020 2020  * np.sin(t).    
-0001e7e0: 2020 2020 2020 2020 7820 3d20 6e70 2e61          x = np.a
-0001e7f0: 7070 656e 6428 782c 2078 5b30 5d29 0a20  ppend(x, x[0]). 
-0001e800: 2020 2020 2020 2020 2020 2079 203d 206e             y = n
-0001e810: 702e 6170 7065 6e64 2879 2c20 795b 305d  p.append(y, y[0]
-0001e820: 290a 2020 2020 2020 2020 2020 2020 7265  ).            re
-0001e830: 7475 726e 2073 656c 662e 5f61 7070 6c79  turn self._apply
-0001e840: 5f74 7261 6e73 666f 726d 2878 2c20 7929  _transform(x, y)
-0001e850: 0a20 2020 2020 2020 2065 6c69 6620 6973  .        elif is
-0001e860: 696e 7374 616e 6365 2865 7870 722c 2045  instance(expr, E
-0001e870: 6c6c 6970 7365 293a 0a20 2020 2020 2020  llipse):.       
-0001e880: 2020 2020 2063 782c 2063 7920 3d20 666c       cx, cy = fl
-0001e890: 6f61 7428 6578 7072 2e63 656e 7465 725b  oat(expr.center[
-0001e8a0: 305d 292c 2066 6c6f 6174 2865 7870 722e  0]), float(expr.
-0001e8b0: 6365 6e74 6572 5b31 5d29 0a20 2020 2020  center[1]).     
-0001e8c0: 2020 2020 2020 2061 203d 2066 6c6f 6174         a = float
-0001e8d0: 2865 7870 722e 6872 6164 6975 7329 0a20  (expr.hradius). 
-0001e8e0: 2020 2020 2020 2020 2020 2065 203d 2066             e = f
-0001e8f0: 6c6f 6174 2865 7870 722e 6563 6365 6e74  loat(expr.eccent
-0001e900: 7269 6369 7479 290a 2020 2020 2020 2020  ricity).        
-0001e910: 2020 2020 7820 3d20 6e70 2e6c 696e 7370      x = np.linsp
-0001e920: 6163 6528 2d61 2c20 612c 2073 656c 662e  ace(-a, a, self.
-0001e930: 6e5b 305d 290a 2020 2020 2020 2020 2020  n[0]).          
-0001e940: 2020 7920 3d20 6e70 2e73 7172 7428 2861    y = np.sqrt((a
-0001e950: 202a 2a20 3220 2d20 7820 2a2a 2032 2920   ** 2 - x ** 2) 
-0001e960: 2a20 2831 202d 2065 202a 2a20 3229 290a  * (1 - e ** 2)).
-0001e970: 2020 2020 2020 2020 2020 2020 7820 2b3d              x +=
-0001e980: 2063 780a 2020 2020 2020 2020 2020 2020   cx.            
-0001e990: 782c 2079 203d 206e 702e 636f 6e63 6174  x, y = np.concat
-0001e9a0: 656e 6174 6528 2878 2c20 785b 3a3a 2d31  enate((x, x[::-1
-0001e9b0: 5d29 292c 206e 702e 636f 6e63 6174 656e  ])), np.concaten
-0001e9c0: 6174 6528 2863 7920 2b20 792c 2063 7920  ate((cy + y, cy 
-0001e9d0: 2d20 795b 3a3a 2d31 5d29 290a 2020 2020  - y[::-1])).    
-0001e9e0: 2020 2020 2020 2020 7820 3d20 6e70 2e61          x = np.a
-0001e9f0: 7070 656e 6428 782c 2078 5b30 5d29 0a20  ppend(x, x[0]). 
-0001ea00: 2020 2020 2020 2020 2020 2079 203d 206e             y = n
-0001ea10: 702e 6170 7065 6e64 2879 2c20 795b 305d  p.append(y, y[0]
-0001ea20: 290a 2020 2020 2020 2020 2020 2020 7265  ).            re
-0001ea30: 7475 726e 2073 656c 662e 5f61 7070 6c79  turn self._apply
-0001ea40: 5f74 7261 6e73 666f 726d 2878 2c20 7929  _transform(x, y)
-0001ea50: 0a20 2020 2020 2020 2065 6c69 6620 6973  .        elif is
-0001ea60: 696e 7374 616e 6365 2865 7870 722c 204c  instance(expr, L
-0001ea70: 696e 6561 7245 6e74 6974 7933 4429 3a0a  inearEntity3D):.
-0001ea80: 2020 2020 2020 2020 2020 2020 7031 2c20              p1, 
-0001ea90: 7032 203d 2065 7870 722e 706f 696e 7473  p2 = expr.points
-0001eaa0: 0a20 2020 2020 2020 2020 2020 2078 203d  .            x =
-0001eab0: 206e 702e 6172 7261 7928 5b70 312e 782c   np.array([p1.x,
-0001eac0: 2070 322e 785d 2c20 6474 7970 653d 666c   p2.x], dtype=fl
-0001ead0: 6f61 7429 0a20 2020 2020 2020 2020 2020  oat).           
-0001eae0: 2079 203d 206e 702e 6172 7261 7928 5b70   y = np.array([p
-0001eaf0: 312e 792c 2070 322e 795d 2c20 6474 7970  1.y, p2.y], dtyp
-0001eb00: 653d 666c 6f61 7429 0a20 2020 2020 2020  e=float).       
-0001eb10: 2020 2020 207a 203d 206e 702e 6172 7261       z = np.arra
-0001eb20: 7928 5b70 312e 7a2c 2070 322e 7a5d 2c20  y([p1.z, p2.z], 
-0001eb30: 6474 7970 653d 666c 6f61 7429 0a20 2020  dtype=float).   
-0001eb40: 2020 2020 2020 2020 2072 6574 7572 6e20           return 
-0001eb50: 7365 6c66 2e5f 6170 706c 795f 7472 616e  self._apply_tran
-0001eb60: 7366 6f72 6d28 782c 2079 2c20 7a29 0a20  sform(x, y, z). 
-0001eb70: 2020 2020 2020 2065 6c69 6620 6973 696e         elif isin
-0001eb80: 7374 616e 6365 2865 7870 722c 2028 5365  stance(expr, (Se
-0001eb90: 676d 656e 742c 2052 6179 2929 3a0a 2020  gment, Ray)):.  
-0001eba0: 2020 2020 2020 2020 2020 7031 2c20 7032            p1, p2
-0001ebb0: 203d 2065 7870 722e 706f 696e 7473 0a20   = expr.points. 
-0001ebc0: 2020 2020 2020 2020 2020 2078 203d 206e             x = n
-0001ebd0: 702e 6172 7261 7928 5b70 312e 782c 2070  p.array([p1.x, p
-0001ebe0: 322e 785d 290a 2020 2020 2020 2020 2020  2.x]).          
-0001ebf0: 2020 7920 3d20 6e70 2e61 7272 6179 285b    y = np.array([
-0001ec00: 7031 2e79 2c20 7032 2e79 5d29 0a20 2020  p1.y, p2.y]).   
-0001ec10: 2020 2020 2020 2020 2072 6574 7572 6e20           return 
-0001ec20: 7365 6c66 2e5f 6170 706c 795f 7472 616e  self._apply_tran
-0001ec30: 7366 6f72 6d28 782e 6173 7479 7065 2866  sform(x.astype(f
-0001ec40: 6c6f 6174 292c 2079 2e61 7374 7970 6528  loat), y.astype(
-0001ec50: 666c 6f61 7429 290a 2020 2020 2020 2020  float)).        
-0001ec60: 656c 7365 3a20 2023 204c 696e 650a 2020  else:  # Line.  
-0001ec70: 2020 2020 2020 2020 2020 7031 2c20 7032            p1, p2
-0001ec80: 203d 2065 7870 722e 706f 696e 7473 0a20   = expr.points. 
-0001ec90: 2020 2020 2020 2020 2020 2069 6620 6e6f             if no
-0001eca0: 7420 7365 6c66 2e72 616e 6765 733a 0a20  t self.ranges:. 
-0001ecb0: 2020 2020 2020 2020 2020 2020 2020 2078                 x
-0001ecc0: 203d 206e 702e 6172 7261 7928 5b70 312e   = np.array([p1.
-0001ecd0: 782c 2070 322e 785d 290a 2020 2020 2020  x, p2.x]).      
-0001ece0: 2020 2020 2020 2020 2020 7920 3d20 6e70            y = np
-0001ecf0: 2e61 7272 6179 285b 7031 2e79 2c20 7032  .array([p1.y, p2
-0001ed00: 2e79 5d29 0a20 2020 2020 2020 2020 2020  .y]).           
-0001ed10: 2065 6c73 653a 0a20 2020 2020 2020 2020   else:.         
-0001ed20: 2020 2020 2020 205f 7261 6e67 6520 3d20         _range = 
-0001ed30: 7365 6c66 2e72 616e 6765 735b 305d 0a20  self.ranges[0]. 
-0001ed40: 2020 2020 2020 2020 2020 2020 2020 206d                 m
-0001ed50: 203d 2065 7870 722e 736c 6f70 650a 2020   = expr.slope.  
-0001ed60: 2020 2020 2020 2020 2020 2020 2020 7120                q 
-0001ed70: 3d20 7031 5b31 5d20 2d20 6d20 2a20 7031  = p1[1] - m * p1
-0001ed80: 5b30 5d0a 2020 2020 2020 2020 2020 2020  [0].            
-0001ed90: 2020 2020 7820 3d20 6e70 2e61 7272 6179      x = np.array
-0001eda0: 285b 5f72 616e 6765 5b31 5d2c 205f 7261  ([_range[1], _ra
-0001edb0: 6e67 655b 325d 5d29 0a20 2020 2020 2020  nge[2]]).       
-0001edc0: 2020 2020 2020 2020 2079 203d 206d 202a           y = m *
-0001edd0: 2078 202b 2071 0a20 2020 2020 2020 2020   x + q.         
-0001ede0: 2020 2072 6574 7572 6e20 7365 6c66 2e5f     return self._
-0001edf0: 6170 706c 795f 7472 616e 7366 6f72 6d28  apply_transform(
-0001ee00: 782e 6173 7479 7065 2866 6c6f 6174 292c  x.astype(float),
-0001ee10: 2079 2e61 7374 7970 6528 666c 6f61 7429   y.astype(float)
-0001ee20: 290a 0a20 2020 2064 6566 205f 5f73 7472  )..    def __str
-0001ee30: 5f5f 2873 656c 6629 3a0a 2020 2020 2020  __(self):.      
-0001ee40: 2020 7265 7475 726e 2073 656c 662e 5f73    return self._s
-0001ee50: 7472 5f68 656c 7065 7228 2267 656f 6d65  tr_helper("geome
-0001ee60: 7472 7920 656e 7469 7479 3a20 2573 2220  try entity: %s" 
-0001ee70: 2520 7374 7228 7365 6c66 2e65 7870 7229  % str(self.expr)
-0001ee80: 290a 0a0a 636c 6173 7320 4765 6e65 7269  )...class Generi
-0001ee90: 6344 6174 6153 6572 6965 7328 4261 7365  cDataSeries(Base
-0001eea0: 5365 7269 6573 293a 0a20 2020 2022 2222  Series):.    """
-0001eeb0: 5265 7072 6573 656e 7473 2067 656e 6572  Represents gener
-0001eec0: 6963 206e 756d 6572 6963 616c 2064 6174  ic numerical dat
-0001eed0: 612e 0a0a 2020 2020 4e4f 5445 3a0a 2020  a...    NOTE:.  
-0001eee0: 2020 5468 6973 2063 6c61 7373 2069 6d70    This class imp
-0001eef0: 6c65 6d65 6e74 7320 6261 636b 2d63 6f6d  lements back-com
-0001ef00: 7061 7469 6269 6c69 7479 2077 6974 6820  patibility with 
-0001ef10: 5379 6d70 7920 3c3d 312e 3131 3a20 6974  Sympy <=1.11: it
-0001ef20: 7320 706c 6f74 7469 6e67 0a20 2020 206d  s plotting.    m
-0001ef30: 6f64 756c 6520 6163 6365 7074 7320 7468  odule accepts th
-0001ef40: 6520 666f 6c6c 6f77 696e 6720 6b65 7977  e following keyw
-0001ef50: 6f72 6420 6172 6775 6d65 6e74 733a 0a0a  ord arguments:..
-0001ef60: 2020 2020 616e 6e6f 7461 7469 6f6e 732c      annotations,
-0001ef70: 206d 6172 6b65 7273 2c20 7265 6374 616e   markers, rectan
-0001ef80: 676c 6573 2c20 6669 6c6c 0a0a 2020 2020  gles, fill..    
-0001ef90: 5361 646c 792c 2074 6865 2064 6576 656c  Sadly, the devel
-0001efa0: 6f70 6572 7320 666f 7267 6f74 2074 6f20  opers forgot to 
-0001efb0: 7072 6f70 6572 6c79 2064 6f63 756d 656e  properly documen
-0001efc0: 7420 7468 656d 3a20 7468 6572 6520 6172  t them: there ar
-0001efd0: 6520 6e6f 0a20 2020 2065 7861 6d70 6c65  e no.    example
-0001efe0: 2077 6861 7473 6f65 7665 7220 6162 6f75   whatsoever abou
-0001eff0: 7420 7468 6569 7220 7573 6167 652e 2054  t their usage. T
-0001f000: 6869 7320 6973 2061 6374 7561 6c6c 7920  his is actually 
-0001f010: 6120 7665 7279 2067 6f6f 6420 7468 696e  a very good thin
-0001f020: 670a 2020 2020 666f 7220 7468 6973 206e  g.    for this n
-0001f030: 6577 2070 6c6f 7474 696e 6720 6d6f 6475  ew plotting modu
-0001f040: 6c65 2c20 7768 6963 6820 7375 7070 6f72  le, which suppor
-0001f050: 7473 206d 756c 7469 706c 6520 6261 636b  ts multiple back
-0001f060: 656e 6473 2e0a 2020 2020 4576 6572 7920  ends..    Every 
-0001f070: 6261 636b 656e 6420 6578 706f 7365 7320  backend exposes 
-0001f080: 6469 6666 6572 656e 7420 6675 6e63 7469  different functi
-0001f090: 6f6e 733a 0a0a 2020 2020 312e 2046 6f72  ons:..    1. For
-0001f0a0: 2065 7861 6d70 6c65 2c20 746f 2063 7265   example, to cre
-0001f0b0: 6174 6520 6c69 6e65 2070 6c6f 7473 204d  ate line plots M
-0001f0c0: 6174 706c 6f74 6c69 6220 6578 706f 7365  atplotlib expose
-0001f0d0: 7320 6060 6178 2e70 6c6f 7460 602c 0a20  s ``ax.plot``,. 
-0001f0e0: 2020 2020 2020 7768 6572 6561 7320 506c        whereas Pl
-0001f0f0: 6f74 6c79 2065 7870 6f73 6573 2060 6067  otly exposes ``g
-0001f100: 6f2e 5363 6174 7465 7260 602c 2077 6865  o.Scatter``, whe
-0001f110: 7265 6173 2042 6f6b 6568 2065 7870 6f73  reas Bokeh expos
-0001f120: 6573 0a20 2020 2020 2020 6060 6669 672e  es.       ``fig.
-0001f130: 6c69 6e65 6060 2c20 6574 632e 2042 7574  line``, etc. But
-0001f140: 2074 686f 7365 2064 6966 6665 7265 6e74   those different
-0001f150: 2077 6179 7320 646f 206e 6f74 206f 7665   ways do not ove
-0001f160: 726c 6170 2063 6f6d 706c 6574 656c 793a  rlap completely:
-0001f170: 0a20 2020 2020 2020 7769 7468 2060 6067  .       with ``g
-0001f180: 6f2e 5363 6174 7465 7260 6020 6974 2773  o.Scatter`` it's
-0001f190: 2061 6c73 6f20 706f 7373 6962 6c65 2074   also possible t
-0001f1a0: 6f20 6372 6561 7465 2066 696c 6c65 6420  o create filled 
-0001f1b0: 7265 6769 6f6e 732c 0a20 2020 2020 2020  regions,.       
-0001f1c0: 7768 6572 6561 7320 7769 7468 2060 6061  whereas with ``a
-0001f1d0: 782e 706c 6f74 6060 2074 6861 7427 7320  x.plot`` that's 
-0001f1e0: 6e6f 7420 706f 7373 6962 6c65 2e0a 2020  not possible..  
-0001f1f0: 2020 322e 204d 6f72 656f 7665 722c 2073    2. Moreover, s
-0001f200: 6f6d 6520 706c 6f74 7469 6e67 206c 6962  ome plotting lib
-0001f210: 7261 7279 2065 7870 6f73 6573 2066 756e  rary exposes fun
-0001f220: 6374 696f 6e61 6c69 7469 6573 2074 6861  ctionalities tha
-0001f230: 7420 6172 650a 2020 2020 2020 2075 6e6d  t are.       unm
-0001f240: 6174 6368 6564 2062 7920 6f74 6865 7273  atched by others
-0001f250: 2e20 466f 7220 6578 616d 706c 652c 204d  . For example, M
-0001f260: 6174 706c 6f74 6c69 6227 7320 6060 6178  atplotlib's ``ax
-0001f270: 2e66 696c 6c5f 6265 7477 6565 6e60 6020  .fill_between`` 
-0001f280: 6973 0a20 2020 2020 2020 7375 6273 7461  is.       substa
-0001f290: 6e74 6961 6c6c 7920 6469 6666 6572 656e  ntially differen
-0001f2a0: 7420 6672 6f6d 2050 6c6f 746c 7927 7320  t from Plotly's 
-0001f2b0: 6669 6c6c 6564 2061 7265 6120 6f72 2077  filled area or w
-0001f2c0: 6861 7465 7665 7220 426f 6b65 680a 2020  hatever Bokeh.  
-0001f2d0: 2020 2020 2065 7870 6f73 6573 2e20 5369       exposes. Si
-0001f2e0: 6d69 6c61 726c 792c 204d 6174 706c 6f74  milarly, Matplot
-0001f2f0: 6c69 6227 7320 5265 6374 616e 676c 6520  lib's Rectangle 
-0001f300: 6973 2076 6572 7920 7370 6563 6966 6963  is very specific
-0001f310: 2c20 7768 6572 6561 730a 2020 2020 2020  , whereas.      
-0001f320: 2077 6974 6820 506c 6f74 6c79 2077 6520   with Plotly we 
-0001f330: 6361 6e20 6164 6420 616e 7920 7368 6170  can add any shap
-0001f340: 6520 2872 6563 7461 6e67 6c65 2c20 6c69  e (rectangle, li
-0001f350: 6e65 2c20 2e2e 2e29 2077 6974 6820 7468  ne, ...) with th
-0001f360: 6520 7361 6d65 0a20 2020 2020 2020 6675  e same.       fu
-0001f370: 6e63 7469 6f6e 2063 616c 6c2e 0a0a 2020  nction call...  
-0001f380: 2020 536f 2c20 7468 6520 7072 6f62 6c65    So, the proble
-0001f390: 6d20 6973 2063 6c65 6172 3a20 6966 2064  m is clear: if d
-0001f3a0: 6576 656c 6f70 6572 7320 646f 6375 6d65  evelopers docume
-0001f3b0: 6e74 2061 2066 6561 7475 7265 2074 6f20  nt a feature to 
-0001f3c0: 646f 206f 6e65 0a20 2020 2073 7065 6369  do one.    speci
-0001f3d0: 6669 6320 7468 696e 672c 2075 7365 7273  fic thing, users
-0001f3e0: 2065 7870 6563 7420 6974 2074 6f20 7072   expect it to pr
-0001f3f0: 6f64 7563 6520 636f 6e73 6973 7465 6e74  oduce consistent
-0001f400: 2072 6573 756c 7473 2061 6372 6f73 730a   results across.
-0001f410: 2020 2020 6261 636b 656e 6473 2e20 5468      backends. Th
-0001f420: 6973 2069 7320 636c 6561 726c 7920 696d  is is clearly im
-0001f430: 706f 7373 6962 6c65 2074 6f20 6163 6869  possible to achi
-0001f440: 6576 652e 0a0a 2020 2020 5468 6572 6520  eve...    There 
-0001f450: 6973 2061 6c73 6f20 7468 6520 7072 6f62  is also the prob
-0001f460: 6c65 6d20 6f66 2077 6865 6e20 2265 6e6f  lem of when "eno
-0001f470: 7567 6820 6973 2065 6e6f 7567 6822 3f20  ugh is enough"? 
-0001f480: 4d65 616e 696e 672c 2077 686f 2069 7320  Meaning, who is 
-0001f490: 746f 0a20 2020 2073 746f 7020 616e 796f  to.    stop anyo
-0001f4a0: 6e65 2066 726f 6d20 6164 6469 6e67 206e  ne from adding n
-0001f4b0: 6577 206b 6579 776f 7264 2061 7267 756d  ew keyword argum
-0001f4c0: 656e 7473 2074 6861 7420 6172 6520 6a75  ents that are ju
-0001f4d0: 7374 2077 7261 7070 6572 7320 746f 0a20  st wrappers to. 
-0001f4e0: 2020 2077 6861 7420 6120 706c 6f74 7469     what a plotti
-0001f4f0: 6e67 206c 6962 7261 7279 2061 6c72 6561  ng library alrea
-0001f500: 6479 2063 616e 2064 6f3f 2046 6f72 2065  dy can do? For e
-0001f510: 7861 6d70 6c65 2c20 4920 636f 756c 6420  xample, I could 
-0001f520: 6164 6420 7468 650a 2020 2020 6060 6865  add the.    ``he
-0001f530: 785f 7469 6c65 6060 206b 6579 776f 7264  x_tile`` keyword
-0001f540: 3a20 6974 2773 2062 6561 7574 6966 756c  : it's beautiful
-0001f550: 2066 6f72 2042 6f6b 6568 2c20 6275 7420   for Bokeh, but 
-0001f560: 7665 7279 2064 6966 6669 6375 6c74 0a20  very difficult. 
-0001f570: 2020 2074 6f20 696d 706c 656d 656e 7420     to implement 
-0001f580: 6f6e 206f 7468 6572 2062 6163 6b65 6e64  on other backend
-0001f590: 732e 204f 7220 6d61 7962 6520 4920 636f  s. Or maybe I co
-0001f5a0: 756c 6420 6164 6420 6060 686c 696e 6573  uld add ``hlines
-0001f5b0: 6060 206f 720a 2020 2020 6060 766c 696e  `` or.    ``vlin
-0001f5c0: 6573 6060 206b 6579 776f 7264 2061 7267  es`` keyword arg
-0001f5d0: 756d 656e 7473 2074 6f20 6164 6420 686f  uments to add ho
-0001f5e0: 7269 7a6f 6e74 616c 206f 7220 7665 7274  rizontal or vert
-0001f5f0: 6963 616c 206c 696e 6573 2e20 4966 2074  ical lines. If t
-0001f600: 6869 730a 2020 2020 6170 7072 6f61 6368  his.    approach
-0001f610: 2077 6173 2074 6f20 6265 2066 6f6c 6c6f   was to be follo
-0001f620: 7765 642c 2077 6520 7769 6c6c 2065 6e64  wed, we will end
-0001f630: 2075 7020 7265 7772 6974 696e 6720 6d75   up rewriting mu
-0001f640: 6c74 6970 6c65 2070 6c6f 7474 696e 670a  ltiple plotting.
-0001f650: 2020 2020 6c69 6272 6172 6965 733a 2066      libraries: f
-0001f660: 6f72 2077 6861 743f 0a0a 2020 2020 496e  or what?..    In
-0001f670: 7374 6561 642c 2074 6865 2067 6f61 6c20  stead, the goal 
-0001f680: 6f66 2074 6869 7320 6d6f 6475 6c65 2069  of this module i
-0001f690: 7320 746f 2066 6163 696c 6974 6174 6520  s to facilitate 
-0001f6a0: 7468 6520 706c 6f74 7469 6e67 206f 6620  the plotting of 
-0001f6b0: 7379 6d62 6f6c 6963 0a20 2020 2065 7870  symbolic.    exp
-0001f6c0: 7265 7373 696f 6e73 2e20 4966 2075 7365  ressions. If use
-0001f6d0: 7220 6e65 6564 7320 746f 2061 6464 206e  r needs to add n
-0001f6e0: 756d 6572 6963 616c 2064 6174 6120 746f  umerical data to
-0001f6f0: 2061 2070 6c6f 742c 2068 652f 7368 6520   a plot, he/she 
-0001f700: 6361 6e0a 2020 2020 6561 7369 6c79 2072  can.    easily r
-0001f710: 6574 7269 6576 6520 7468 6520 6669 6775  etrieve the figu
-0001f720: 7265 206f 626a 6563 7420 616e 6420 7072  re object and pr
-0001f730: 6f63 6565 6420 7769 7468 2074 6865 2075  oceed with the u
-0001f740: 7375 616c 2063 6f6d 6d61 6e64 730a 2020  sual commands.  
-0001f750: 2020 6173 736f 6369 6174 6564 2074 6f20    associated to 
-0001f760: 6120 7370 6563 6966 6963 2070 6c6f 7474  a specific plott
-0001f770: 696e 6720 6c69 6272 6172 792e 0a20 2020  ing library..   
-0001f780: 2046 6f72 2065 7861 6d70 6c65 2c20 666f   For example, fo
-0001f790: 7220 6060 4d61 7470 6c6f 746c 6962 4261  r ``MatplotlibBa
-0001f7a0: 636b 656e 6460 603a 0a0a 2020 2020 2e2e  ckend``:..    ..
-0001f7b0: 2063 6f64 652d 626c 6f63 6b3a 3a20 7079   code-block:: py
-0001f7c0: 7468 6f6e 0a0a 2020 2020 2020 2066 726f  thon..       fro
-0001f7d0: 6d20 7379 6d70 7920 696d 706f 7274 202a  m sympy import *
-0001f7e0: 0a20 2020 2020 2020 6672 6f6d 2073 7062  .       from spb
-0001f7f0: 2069 6d70 6f72 7420 2a0a 2020 2020 2020   import *.      
-0001f800: 2069 6d70 6f72 7420 6e75 6d70 7920 6173   import numpy as
-0001f810: 206e 700a 2020 2020 2020 2076 6172 2822   np.       var("
-0001f820: 7822 290a 0a20 2020 2020 2020 2320 706c  x")..       # pl
-0001f830: 6f74 2073 796d 626f 6c69 6320 6578 7072  ot symbolic expr
-0001f840: 6573 7369 6f6e 730a 2020 2020 2020 2070  essions.       p
-0001f850: 203d 2070 6c6f 7428 7369 6e28 7829 2c20   = plot(sin(x), 
-0001f860: 636f 7328 7829 2c20 6261 636b 656e 643d  cos(x), backend=
-0001f870: 4d42 290a 2020 2020 2020 2023 2065 7874  MB).       # ext
-0001f880: 7261 6374 2074 6865 2061 7865 7320 6f62  ract the axes ob
-0001f890: 6a65 6374 0a20 2020 2020 2020 6178 203d  ject.       ax =
-0001f8a0: 2070 2e66 6967 2e61 7865 735b 305d 0a20   p.fig.axes[0]. 
-0001f8b0: 2020 2020 2020 2320 6164 6420 6e75 6d65        # add nume
-0001f8c0: 7269 6361 6c20 6461 7461 0a20 2020 2020  rical data.     
-0001f8d0: 2020 7878 203d 206e 702e 6c69 6e73 7061    xx = np.linspa
-0001f8e0: 6365 282d 3130 2c20 3130 290a 2020 2020  ce(-10, 10).    
-0001f8f0: 2020 2066 203d 2031 202f 2028 3120 2b20     f = 1 / (1 + 
-0001f900: 6e70 2e65 7870 282d 7878 2929 0a20 2020  np.exp(-xx)).   
-0001f910: 2020 2020 6178 2e70 6c6f 7428 7878 2c20      ax.plot(xx, 
-0001f920: 6631 2c20 226b 3a22 2c20 6c61 6265 6c3d  f1, "k:", label=
-0001f930: 226e 756d 6572 6963 616c 2064 6174 6122  "numerical data"
-0001f940: 290a 2020 2020 2020 2061 782e 6c65 6765  ).       ax.lege
-0001f950: 6e64 2829 0a20 2020 2020 2020 702e 6669  nd().       p.fi
-0001f960: 670a 0a20 2020 2048 656e 6365 2c20 7468  g..    Hence, th
-0001f970: 6520 6465 6369 7369 6f6e 2074 6f20 6d61  e decision to ma
-0001f980: 696e 7461 696e 2074 6869 7320 6261 636b  intain this back
-0001f990: 2d63 6f6d 7061 7469 6269 6c69 7479 2028  -compatibility (
-0001f9a0: 666f 7220 7468 6520 6d6f 6d65 6e74 290a  for the moment).
-0001f9b0: 2020 2020 6275 7420 6e6f 7420 746f 2064      but not to d
-0001f9c0: 6f63 756d 656e 7420 7468 6f73 6520 6b65  ocument those ke
-0001f9d0: 7977 6f72 6420 6172 6775 6d65 6e74 7320  yword arguments 
-0001f9e0: 6f6e 2074 6865 2070 6c6f 7474 696e 6720  on the plotting 
-0001f9f0: 6675 6e63 7469 6f6e 732e 0a20 2020 2022  functions..    "
-0001fa00: 2222 0a20 2020 2069 735f 6765 6e65 7269  "".    is_generi
-0001fa10: 6320 3d20 5472 7565 0a0a 2020 2020 6465  c = True..    de
-0001fa20: 6620 5f5f 696e 6974 5f5f 2873 656c 662c  f __init__(self,
-0001fa30: 2074 702c 202a 6172 6773 2c20 2a2a 6b77   tp, *args, **kw
-0001fa40: 6172 6773 293a 0a20 2020 2020 2020 2073  args):.        s
-0001fa50: 7570 6572 2829 2e5f 5f69 6e69 745f 5f28  uper().__init__(
-0001fa60: 2a2a 6b77 6172 6773 290a 2020 2020 2020  **kwargs).      
-0001fa70: 2020 7365 6c66 2e74 7970 6520 3d20 7470    self.type = tp
-0001fa80: 0a20 2020 2020 2020 2073 656c 662e 6172  .        self.ar
-0001fa90: 6773 203d 2061 7267 730a 2020 2020 2020  gs = args.      
-0001faa0: 2020 7365 6c66 2e72 656e 6465 7269 6e67    self.rendering
-0001fab0: 5f6b 7720 3d20 6b77 6172 6773 0a0a 2020  _kw = kwargs..  
-0001fac0: 2020 6465 6620 6765 745f 6461 7461 2873    def get_data(s
-0001fad0: 656c 6629 3a0a 2020 2020 2020 2020 7265  elf):.        re
-0001fae0: 7475 726e 2073 656c 662e 6172 6773 0a0a  turn self.args..
-0001faf0: 0a63 6c61 7373 2052 6965 6d61 6e6e 5370  .class RiemannSp
-0001fb00: 6865 7265 5365 7269 6573 2842 6173 6553  hereSeries(BaseS
-0001fb10: 6572 6965 7329 3a0a 2020 2020 6973 5f63  eries):.    is_c
-0001fb20: 6f6d 706c 6578 203d 2054 7275 650a 2020  omplex = True.  
-0001fb30: 2020 6973 5f64 6f6d 6169 6e5f 636f 6c6f    is_domain_colo
-0001fb40: 7269 6e67 203d 2054 7275 650a 2020 2020  ring = True.    
-0001fb50: 6973 5f33 4473 7572 6661 6365 203d 2054  is_3Dsurface = T
-0001fb60: 7275 650a 2020 2020 5f4e 203d 2031 3530  rue.    _N = 150
-0001fb70: 0a20 2020 205f 616c 6c6f 7765 645f 6b65  .    _allowed_ke
-0001fb80: 7973 203d 205b 0a20 2020 2020 2020 2022  ys = [.        "
-0001fb90: 636d 6170 222c 2022 636f 6c6f 7269 6e67  cmap", "coloring
-0001fba0: 222c 2022 626c 6576 656c 222c 2022 7068  ", "blevel", "ph
-0001fbb0: 6173 6572 6573 222c 2022 7068 6173 656f  aseres", "phaseo
-0001fbc0: 6666 7365 7422 5d0a 0a20 2020 2064 6566  ffset"]..    def
-0001fbd0: 205f 5f69 6e69 745f 5f28 7365 6c66 2c20   __init__(self, 
-0001fbe0: 662c 2072 616e 6765 5f74 2c20 7261 6e67  f, range_t, rang
-0001fbf0: 655f 702c 202a 2a6b 7761 7267 7329 3a0a  e_p, **kwargs):.
-0001fc00: 2020 2020 2020 2020 7365 6c66 2e5f 626c          self._bl
-0001fc10: 6f63 6b5f 6c61 6d62 6461 5f66 756e 6374  ock_lambda_funct
-0001fc20: 696f 6e73 2866 290a 2020 2020 2020 2020  ions(f).        
-0001fc30: 7375 7065 7228 292e 5f5f 696e 6974 5f5f  super().__init__
-0001fc40: 282a 2a6b 7761 7267 7329 0a20 2020 2020  (**kwargs).     
-0001fc50: 2020 2069 6620 6c65 6e28 662e 6672 6565     if len(f.free
-0001fc60: 5f73 796d 626f 6c73 2920 3e20 313a 0a20  _symbols) > 1:. 
-0001fc70: 2020 2020 2020 2020 2020 2023 204e 4f54             # NOT
-0001fc80: 453a 2063 6f6e 7369 6465 7269 6e67 2068  E: considering h
-0001fc90: 6f77 2063 6f6d 7075 7461 7469 6f6e 616c  ow computational
-0001fca0: 6c79 2068 6561 7679 2074 6869 7320 7365  ly heavy this se
-0001fcb0: 7269 6573 2069 732c 0a20 2020 2020 2020  ries is,.       
-0001fcc0: 2020 2020 2023 2069 7420 6973 2072 6174       # it is rat
-0001fcd0: 6865 7220 756e 7573 6566 756c 2074 6f20  her unuseful to 
-0001fce0: 616c 6c6f 7720 696e 7465 7261 6374 6976  allow interactiv
-0001fcf0: 652d 7769 6467 6574 7320 706c 6f74 2e0a  e-widgets plot..
-0001fd00: 2020 2020 2020 2020 2020 2020 7261 6973              rais
-0001fd10: 6520 5661 6c75 6545 7272 6f72 280a 2020  e ValueError(.  
-0001fd20: 2020 2020 2020 2020 2020 2020 2020 2243                "C
-0001fd30: 6f6d 706c 6578 2066 756e 6374 696f 6e20  omplex function 
-0001fd40: 6361 6e20 6f6e 6c79 2068 6176 6520 6f6e  can only have on
-0001fd50: 6520 6672 6565 2073 796d 626f 6c2e 2022  e free symbol. "
-0001fd60: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0001fd70: 2022 5265 6365 6976 6564 2066 7265 6520   "Received free 
-0001fd80: 7379 6d62 6f6c 733a 2025 7322 2025 2066  symbols: %s" % f
-0001fd90: 2e66 7265 655f 7379 6d62 6f6c 7329 0a20  .free_symbols). 
-0001fda0: 2020 2020 2020 2073 656c 662e 6578 7072         self.expr
-0001fdb0: 203d 2066 0a20 2020 2020 2020 2023 204e   = f.        # N
-0001fdc0: 4f54 453a 2077 6520 6361 6e20 6561 7369  OTE: we can easi
-0001fdd0: 6c79 2063 7265 6174 6520 6120 7370 6865  ly create a sphe
-0001fde0: 7265 2077 6974 6820 6120 7369 6e67 6c65  re with a single
-0001fdf0: 2064 6174 6120 7365 7269 6573 2e0a 2020   data series..  
-0001fe00: 2020 2020 2020 2320 486f 7765 7665 722c        # However,
-0001fe10: 204b 3344 4261 636b 656e 6420 6973 2075   K3DBackend is u
-0001fe20: 6e61 626c 6520 746f 2070 726f 7065 726c  nable to properl
-0001fe30: 7920 7669 7375 616c 697a 6520 6974 2c20  y visualize it, 
-0001fe40: 616e 6420 6974 0a20 2020 2020 2020 2023  and it.        #
-0001fe50: 2077 6f75 6c64 2072 6571 7569 7265 2061   would require a
-0001fe60: 2066 6577 2068 6f75 7273 206f 6620 776f   few hours of wo
-0001fe70: 726b 2074 6f20 6170 706c 7920 7468 6520  rk to apply the 
-0001fe80: 6e65 6365 7373 6172 7920 6564 6974 732e  necessary edits.
-0001fe90: 0a20 2020 2020 2020 2023 2049 6e73 7465  .        # Inste
-0001fea0: 6164 2c20 4927 6d20 676f 696e 6720 746f  ad, I'm going to
-0001feb0: 2063 7265 6174 6520 7477 6f20 7370 6865   create two sphe
-0001fec0: 7265 2063 6170 7320 284e 6f72 7468 656e  re caps (Northen
-0001fed0: 2061 6e64 2053 6f75 7468 6572 6e0a 2020   and Southern.  
-0001fee0: 2020 2020 2020 2320 6865 6d69 7370 6865        # hemisphe
-0001fef0: 7265 732c 2072 6573 7065 6374 6976 656c  res, respectivel
-0001ff00: 7929 2c20 6865 6e63 6520 7468 6520 6e65  y), hence the ne
-0001ff10: 6564 2066 6f72 2072 616e 6765 7320 3a44  ed for ranges :D
-0001ff20: 0a20 2020 2020 2020 2073 656c 662e 7261  .        self.ra
-0001ff30: 6e67 6573 203d 205b 7261 6e67 655f 742c  nges = [range_t,
-0001ff40: 2072 616e 6765 5f70 5d0a 2020 2020 2020   range_p].      
-0001ff50: 2020 436f 6d70 6c65 7844 6f6d 6169 6e43    ComplexDomainC
-0001ff60: 6f6c 6f72 696e 6753 6572 6965 732e 5f69  oloringSeries._i
-0001ff70: 6e69 745f 646f 6d61 696e 5f63 6f6c 6f72  nit_domain_color
-0001ff80: 696e 675f 6b77 2873 656c 662c 202a 2a6b  ing_kw(self, **k
-0001ff90: 7761 7267 7329 0a20 2020 2020 2020 2069  wargs).        i
-0001ffa0: 6620 7365 6c66 2e6e 5b30 5d20 3d3d 2073  f self.n[0] == s
-0001ffb0: 656c 662e 6e5b 315d 3a0a 2020 2020 2020  elf.n[1]:.      
-0001ffc0: 2020 2020 2020 7365 6c66 2e6e 203d 205b        self.n = [
-0001ffd0: 7365 6c66 2e6e 5b30 5d2c 2034 202a 2073  self.n[0], 4 * s
-0001ffe0: 656c 662e 6e5b 305d 5d0a 2020 2020 2020  elf.n[0]].      
-0001fff0: 2020 7365 6c66 2e75 7365 5f63 6d20 3d20    self.use_cm = 
-00020000: 5472 7565 0a0a 2020 2020 6465 6620 6765  True..    def ge
-00020010: 745f 6461 7461 2873 656c 6629 3a0a 2020  t_data(self):.  
-00020020: 2020 2020 2020 2222 2252 6574 7572 6e20        """Return 
-00020030: 6172 7261 7973 206f 6620 636f 6f72 6469  arrays of coordi
-00020040: 6e61 7465 7320 666f 7220 706c 6f74 7469  nates for plotti
-00020050: 6e67 2e0a 0a20 2020 2020 2020 2052 6574  ng...        Ret
-00020060: 7572 6e73 0a20 2020 2020 2020 203d 3d3d  urns.        ===
-00020070: 3d3d 3d3d 0a0a 2020 2020 2020 2020 782c  ====..        x,
-00020080: 2079 2c20 7a20 3a20 6e70 2e6e 6461 7272   y, z : np.ndarr
-00020090: 6179 205b 6e32 2078 206e 315d 0a20 2020  ay [n2 x n1].   
-000200a0: 2020 2020 2020 2020 2043 6f6f 7264 696e           Coordin
-000200b0: 6174 6573 206f 6e20 7468 6520 756e 6974  ates on the unit
-000200c0: 2073 7068 6572 652e 0a0a 2020 2020 2020   sphere...      
-000200d0: 2020 6172 6720 3a20 6e70 2e6e 6461 7272    arg : np.ndarr
-000200e0: 6179 205b 6e32 2078 206e 315d 0a20 2020  ay [n2 x n1].   
-000200f0: 2020 2020 2020 2020 2041 7267 756d 656e           Argumen
-00020100: 7420 6f66 2074 6865 2066 756e 6374 696f  t of the functio
-00020110: 6e2e 0a0a 2020 2020 2020 2020 696d 6720  n...        img 
-00020120: 3a20 6e70 2e6e 6461 7272 6179 205b 6e32  : np.ndarray [n2
-00020130: 2078 206e 3120 7820 335d 0a20 2020 2020   x n1 x 3].     
-00020140: 2020 2020 2020 2052 4742 2069 6d61 6765         RGB image
-00020150: 2076 616c 7565 7320 636f 6d70 7574 6564   values computed
-00020160: 2066 726f 6d20 7468 6520 6172 6775 6d65   from the argume
-00020170: 6e74 206f 6620 7468 6520 6675 6e63 7469  nt of the functi
-00020180: 6f6e 2e0a 2020 2020 2020 2020 2020 2020  on..            
-00020190: 3020 3c3d 2052 2c20 472c 2042 203c 3d20  0 <= R, G, B <= 
-000201a0: 3235 350a 0a20 2020 2020 2020 2063 6f6c  255..        col
-000201b0: 6f72 7320 3a20 6e70 2e6e 6461 7272 6179  ors : np.ndarray
-000201c0: 205b 3235 3620 7820 335d 0a20 2020 2020   [256 x 3].     
-000201d0: 2020 2020 2020 2043 6f6c 6f72 2073 6361         Color sca
-000201e0: 6c65 2061 7373 6f63 6961 7465 6420 746f  le associated to
-000201f0: 2060 696d 6760 2e0a 2020 2020 2020 2020   `img`..        
-00020200: 2222 220a 2020 2020 2020 2020 6e70 203d  """.        np =
-00020210: 2069 6d70 6f72 745f 6d6f 6475 6c65 2827   import_module('
-00020220: 6e75 6d70 7927 290a 0a20 2020 2020 2020  numpy')..       
-00020230: 2023 2064 6973 6372 6574 697a 6520 7468   # discretize th
-00020240: 6520 756e 6974 2073 7068 6572 650a 2020  e unit sphere.  
-00020250: 2020 2020 2020 7220 3d20 310a 2020 2020        r = 1.    
-00020260: 2020 2020 2320 544f 444f 3a20 7468 6973      # TODO: this
-00020270: 2070 6172 616d 6574 6572 697a 6174 696f   parameterizatio
-00020280: 6e20 706c 6163 6573 2061 206c 6f74 206f  n places a lot o
-00020290: 6620 706f 696e 7473 206e 6561 7220 7468  f points near th
-000202a0: 6520 706f 6c65 730a 2020 2020 2020 2020  e poles.        
-000202b0: 2320 6275 7420 6e6f 7420 656e 6f75 6768  # but not enough
-000202c0: 206e 6561 7220 7468 6520 6571 7561 746f   near the equato
-000202d0: 722e 2043 616e 2061 2064 6966 6665 7265  r. Can a differe
-000202e0: 6e74 2070 6172 616d 6574 6572 697a 6174  nt parameterizat
-000202f0: 696f 6e0a 2020 2020 2020 2020 2320 696d  ion.        # im
-00020300: 7072 6f76 6573 2074 6865 2066 696e 616c  proves the final
-00020310: 2072 6573 756c 742c 206d 6179 6265 2065   result, maybe e
-00020320: 7665 6e20 7265 6475 6369 6e67 2074 6865  ven reducing the
-00020330: 2063 6f6d 7075 7461 7469 6f6e 616c 0a20   computational. 
-00020340: 2020 2020 2020 2023 2063 6f73 743f 0a20         # cost?. 
-00020350: 2020 2020 2020 2074 732c 2074 6520 3d20         ts, te = 
-00020360: 5b66 6c6f 6174 2874 2920 666f 7220 7420  [float(t) for t 
-00020370: 696e 2073 656c 662e 7261 6e67 6573 5b30  in self.ranges[0
-00020380: 5d5b 313a 5d5d 0a20 2020 2020 2020 2070  ][1:]].        p
-00020390: 732c 2070 6520 3d20 5b66 6c6f 6174 2874  s, pe = [float(t
-000203a0: 2920 666f 7220 7420 696e 2073 656c 662e  ) for t in self.
-000203b0: 7261 6e67 6573 5b31 5d5b 313a 5d5d 0a20  ranges[1][1:]]. 
-000203c0: 2020 2020 2020 2074 2c20 7020 3d20 6e70         t, p = np
-000203d0: 2e6d 6772 6964 5b74 733a 7465 3a73 656c  .mgrid[ts:te:sel
-000203e0: 662e 6e5b 305d 2a31 6a2c 2070 733a 7065  f.n[0]*1j, ps:pe
-000203f0: 3a73 656c 662e 6e5b 315d 2a31 6a5d 0a20  :self.n[1]*1j]. 
-00020400: 2020 2020 2020 2058 203d 2072 202a 206e         X = r * n
-00020410: 702e 7369 6e28 7429 202a 206e 702e 636f  p.sin(t) * np.co
-00020420: 7328 7029 0a20 2020 2020 2020 2059 203d  s(p).        Y =
-00020430: 2072 202a 206e 702e 7369 6e28 7429 202a   r * np.sin(t) *
-00020440: 206e 702e 7369 6e28 7029 0a20 2020 2020   np.sin(p).     
-00020450: 2020 205a 203d 2072 202a 206e 702e 636f     Z = r * np.co
-00020460: 7328 7429 0a20 2020 2020 2020 2023 2073  s(t).        # s
-00020470: 7465 7265 6f67 7261 7068 6963 2070 726f  tereographic pro
-00020480: 6a65 6374 696f 6e0a 2020 2020 2020 2020  jection.        
-00020490: 2320 544f 444f 3a20 7375 7070 7265 7373  # TODO: suppress
-000204a0: 2077 6172 6e69 6e67 730a 2020 2020 2020   warnings.      
-000204b0: 2020 7820 3d20 5820 2f20 2831 202d 205a    x = X / (1 - Z
-000204c0: 290a 2020 2020 2020 2020 7920 3d20 5920  ).        y = Y 
-000204d0: 2f20 2831 202d 205a 290a 2020 2020 2020  / (1 - Z).      
-000204e0: 2020 2320 6576 616c 7561 7469 6f6e 206f    # evaluation o
-000204f0: 7665 7220 7468 6520 636f 6d70 6c65 7820  ver the complex 
-00020500: 706c 616e 650a 2020 2020 2020 2020 2320  plane.        # 
-00020510: 4e4f 5445 3a20 5f75 6e69 666f 726d 5f65  NOTE: _uniform_e
-00020520: 7661 6c20 7368 6f75 6c64 2062 6520 7573  val should be us
-00020530: 6564 2c20 6173 2069 7420 6973 2061 626c  ed, as it is abl
-00020540: 6520 746f 2064 6561 6c20 7769 7468 0a20  e to deal with. 
-00020550: 2020 2020 2020 2023 2064 6966 6665 7265         # differe
-00020560: 6e74 2065 7661 6c75 6174 696f 6e20 6d6f  nt evaluation mo
-00020570: 6475 6c65 732e 2048 6f77 6576 6572 2c20  dules. However, 
-00020580: 7468 6174 206d 6574 686f 6420 6973 206d  that method is m
-00020590: 7563 6820 736c 6f77 6572 0a20 2020 2020  uch slower.     
-000205a0: 2020 2023 2074 6861 6e20 7661 6e69 6c6c     # than vanill
-000205b0: 612d 4e75 6d70 7920 7769 7468 2076 6563  a-Numpy with vec
-000205c0: 746f 7269 7a61 7469 6f6e 2c20 6576 656e  torization, even
-000205d0: 2077 6865 6e20 7573 696e 6720 4e75 6d70   when using Nump
-000205e0: 792e 0a20 2020 2020 2020 2023 2054 6f20  y..        # To 
-000205f0: 6765 7420 6465 6365 6e74 2072 6573 756c  get decent resul
-00020600: 7473 2c20 7468 6520 6675 6e63 7469 6f6e  ts, the function
-00020610: 206d 7573 7420 6265 2065 7661 6c75 6174   must be evaluat
-00020620: 6564 206f 6e20 6120 6269 670a 2020 2020  ed on a big.    
-00020630: 2020 2020 2320 6e75 6d62 6572 206f 6620      # number of 
-00020640: 6469 7363 7265 7469 7a61 7469 6f6e 2070  discretization p
-00020650: 6f69 6e74 732c 2077 6869 6368 2061 7574  oints, which aut
-00020660: 6f6d 6174 6963 616c 6c79 2070 7265 636c  omatically precl
-00020670: 7564 6573 0a20 2020 2020 2020 2023 206d  udes.        # m
-00020680: 706d 6174 6820 6f72 2073 796d 7079 2e20  pmath or sympy. 
-00020690: 4865 6e63 652c 206a 7573 7420 7573 6520  Hence, just use 
-000206a0: 6261 7265 2062 6f6e 6573 204e 756d 7079  bare bones Numpy
-000206b0: 2c20 6576 656e 2074 686f 7567 6820 7468  , even though th
-000206c0: 6973 0a20 2020 2020 2020 2023 206d 6f64  is.        # mod
-000206d0: 756c 6520 6d69 6768 7420 6e6f 7420 696d  ule might not im
-000206e0: 706c 656d 656e 7420 616c 6c20 7468 6520  plement all the 
-000206f0: 696e 7465 7265 7374 696e 6720 6675 6e63  interesting func
-00020700: 7469 6f6e 732e 0a20 2020 2020 2020 207a  tions..        z
-00020710: 203d 2078 202b 2031 6a20 2a20 790a 2020   = x + 1j * y.  
-00020720: 2020 2020 2020 6620 3d20 6c61 6d62 6469        f = lambdi
-00020730: 6679 286c 6973 7428 7365 6c66 2e65 7870  fy(list(self.exp
-00020740: 722e 6672 6565 5f73 796d 626f 6c73 295b  r.free_symbols)[
-00020750: 305d 2c20 7365 6c66 2e65 7870 7229 0a20  0], self.expr). 
-00020760: 2020 2020 2020 2077 203d 2066 287a 290a         w = f(z).
-00020770: 2020 2020 2020 2020 696d 672c 2063 7320          img, cs 
-00020780: 3d20 7765 6765 7274 2873 656c 662e 636f  = wegert(self.co
-00020790: 6c6f 7269 6e67 2c20 772c 2073 656c 662e  loring, w, self.
-000207a0: 7068 6173 6572 6573 2c20 7365 6c66 2e63  phaseres, self.c
-000207b0: 6d61 7029 0a20 2020 2020 2020 2072 6574  map).        ret
-000207c0: 7572 6e20 7365 6c66 2e5f 6170 706c 795f  urn self._apply_
-000207d0: 7472 616e 7366 6f72 6d28 582c 2059 2c20  transform(X, Y, 
-000207e0: 5a2c 206e 702e 616e 676c 6528 7729 2c20  Z, np.angle(w), 
-000207f0: 696d 672c 2063 7329 0a0a 0a63 6c61 7373  img, cs)...class
-00020800: 2048 564c 696e 6553 6572 6965 7328 4261   HVLineSeries(Ba
-00020810: 7365 5365 7269 6573 293a 0a20 2020 2022  seSeries):.    "
-00020820: 2222 5265 7072 6573 656e 7420 616e 2068  ""Represent an h
-00020830: 6f72 697a 6f6e 7461 6c20 6f72 2076 6572  orizontal or ver
-00020840: 7469 6361 6c20 6c69 6e65 2073 6572 6965  tical line serie
-00020850: 732e 0a20 2020 2049 6e20 4d61 7470 6c6f  s..    In Matplo
-00020860: 746c 6962 2c20 7468 6973 2077 696c 6c20  tlib, this will 
-00020870: 6265 2072 656e 6465 7265 6420 6279 2061  be rendered by a
-00020880: 7868 6c69 6e65 206f 7220 6178 766c 696e  xhline or axvlin
-00020890: 652e 0a20 2020 2022 2222 0a20 2020 2064  e..    """.    d
-000208a0: 6566 205f 5f69 6e69 745f 5f28 7365 6c66  ef __init__(self
-000208b0: 2c20 762c 2068 6f72 697a 6f6e 7461 6c2c  , v, horizontal,
-000208c0: 206c 6162 656c 3d22 222c 202a 2a6b 7761   label="", **kwa
-000208d0: 7267 7329 3a0a 2020 2020 2020 2020 7375  rgs):.        su
-000208e0: 7065 7228 292e 5f5f 696e 6974 5f5f 282a  per().__init__(*
-000208f0: 2a6b 7761 7267 7329 0a20 2020 2020 2020  *kwargs).       
-00020900: 2073 656c 662e 5f65 7870 7220 3d20 7379   self._expr = sy
-00020910: 6d70 6966 7928 7629 0a20 2020 2020 2020  mpify(v).       
-00020920: 2073 656c 662e 6973 5f68 6f72 697a 6f6e   self.is_horizon
-00020930: 7461 6c20 3d20 686f 7269 7a6f 6e74 616c  tal = horizontal
-00020940: 0a20 2020 2020 2020 2073 656c 662e 5f6c  .        self._l
-00020950: 6162 656c 203d 2073 7472 2873 656c 662e  abel = str(self.
-00020960: 6578 7072 2920 6966 206c 6162 656c 2069  expr) if label i
-00020970: 7320 4e6f 6e65 2065 6c73 6520 6c61 6265  s None else labe
-00020980: 6c0a 2020 2020 2020 2020 7365 6c66 2e5f  l.        self._
-00020990: 6c61 7465 785f 6c61 6265 6c20 3d20 6c61  latex_label = la
-000209a0: 7465 7828 7365 6c66 2e65 7870 7229 2069  tex(self.expr) i
-000209b0: 6620 6c61 6265 6c20 6973 204e 6f6e 6520  f label is None 
-000209c0: 656c 7365 206c 6162 656c 0a0a 2020 2020  else label..    
-000209d0: 6465 6620 6765 745f 6461 7461 2873 656c  def get_data(sel
-000209e0: 6629 3a0a 2020 2020 2020 2020 6c6f 6361  f):.        loca
-000209f0: 7469 6f6e 203d 2073 656c 662e 6578 7072  tion = self.expr
-00020a00: 0a20 2020 2020 2020 2069 6620 7365 6c66  .        if self
-00020a10: 2e69 735f 696e 7465 7261 6374 6976 653a  .is_interactive:
-00020a20: 0a20 2020 2020 2020 2020 2020 206c 6f63  .            loc
-00020a30: 6174 696f 6e20 3d20 7365 6c66 2e65 7870  ation = self.exp
-00020a40: 722e 7375 6273 2873 656c 662e 7061 7261  r.subs(self.para
-00020a50: 6d73 290a 2020 2020 2020 2020 7265 7475  ms).        retu
-00020a60: 726e 2066 6c6f 6174 286c 6f63 6174 696f  rn float(locatio
-00020a70: 6e29 0a0a 2020 2020 6465 6620 5f5f 7374  n)..    def __st
-00020a80: 725f 5f28 7365 6c66 293a 0a20 2020 2020  r__(self):.     
-00020a90: 2020 2070 7265 203d 2022 686f 7269 7a6f     pre = "horizo
-00020aa0: 6e74 616c 2220 6966 2073 656c 662e 6973  ntal" if self.is
-00020ab0: 5f68 6f72 697a 6f6e 7461 6c20 656c 7365  _horizontal else
-00020ac0: 2022 7665 7274 6963 616c 220a 2020 2020   "vertical".    
-00020ad0: 2020 2020 706f 7374 203d 2022 7920 3d20      post = "y = 
-00020ae0: 2220 6966 2073 656c 662e 6973 5f68 6f72  " if self.is_hor
-00020af0: 697a 6f6e 7461 6c20 656c 7365 2022 7820  izontal else "x 
-00020b00: 3d20 220a 2020 2020 2020 2020 7265 7475  = ".        retu
-00020b10: 726e 2073 656c 662e 5f73 7472 5f68 656c  rn self._str_hel
-00020b20: 7065 7228 7072 6520 2b20 2220 6c69 6e65  per(pre + " line
-00020b30: 2061 7420 2220 2b20 706f 7374 202b 2073   at " + post + s
-00020b40: 7472 2873 656c 662e 6578 7072 2929 0a0a  tr(self.expr))..
-00020b50: 0a63 6c61 7373 2041 7272 6f77 3244 5365  .class Arrow2DSe
-00020b60: 7269 6573 2842 6173 6553 6572 6965 7329  ries(BaseSeries)
-00020b70: 3a0a 2020 2020 2222 2252 6570 7265 7365  :.    """Represe
-00020b80: 6e74 2061 6e20 6172 726f 7720 696e 2061  nt an arrow in a
-00020b90: 2032 4420 7370 6163 652e 0a20 2020 2022   2D space..    "
-00020ba0: 2222 0a0a 2020 2020 6973 5f32 4476 6563  ""..    is_2Dvec
-00020bb0: 746f 7220 3d20 5472 7565 0a20 2020 205f  tor = True.    _
-00020bc0: 616c 6c6f 7765 645f 6b65 7973 203d 205b  allowed_keys = [
-00020bd0: 226e 6f72 6d61 6c69 7a65 225d 0a0a 2020  "normalize"]..  
-00020be0: 2020 6465 6620 5f5f 696e 6974 5f5f 2873    def __init__(s
-00020bf0: 656c 662c 2073 7461 7274 2c20 6469 7265  elf, start, dire
-00020c00: 6374 696f 6e2c 206c 6162 656c 3d22 222c  ction, label="",
-00020c10: 202a 2a6b 7761 7267 7329 3a0a 2020 2020   **kwargs):.    
-00020c20: 2020 2020 7375 7065 7228 292e 5f5f 696e      super().__in
-00020c30: 6974 5f5f 282a 2a6b 7761 7267 7329 0a20  it__(**kwargs). 
-00020c40: 2020 2020 2020 206e 7020 3d20 696d 706f         np = impo
-00020c50: 7274 5f6d 6f64 756c 6528 276e 756d 7079  rt_module('numpy
-00020c60: 2729 0a20 2020 2020 2020 2069 6620 6c65  ').        if le
-00020c70: 6e28 7374 6172 7429 2021 3d20 6c65 6e28  n(start) != len(
-00020c80: 6469 7265 6374 696f 6e29 3a0a 2020 2020  direction):.    
-00020c90: 2020 2020 2020 2020 7261 6973 6520 5661          raise Va
-00020ca0: 6c75 6545 7272 6f72 280a 2020 2020 2020  lueError(.      
-00020cb0: 2020 2020 2020 2020 2020 2260 7374 6172            "`star
-00020cc0: 7460 2061 6e64 2060 6469 7265 6374 696f  t` and `directio
-00020cd0: 6e60 206d 7573 7420 6861 7665 2074 6865  n` must have the
-00020ce0: 2073 616d 6520 6e75 6d62 6572 206f 6620   same number of 
-00020cf0: 656c 656d 656e 7473 2e5c 6e22 0a20 2020  elements.\n".   
-00020d00: 2020 2020 2020 2020 2020 2020 2066 2252               f"R
-00020d10: 6563 6569 7665 643a 206c 656e 2873 7461  eceived: len(sta
-00020d20: 7274 2920 3d20 7b6c 656e 2873 7461 7274  rt) = {len(start
-00020d30: 297d 2022 0a20 2020 2020 2020 2020 2020  )} ".           
-00020d40: 2020 2020 2066 2261 6e64 206c 656e 2864       f"and len(d
-00020d50: 6972 6563 7469 6f6e 2920 3d20 7b6c 656e  irection) = {len
-00020d60: 2864 6972 6563 7469 6f6e 297d 220a 2020  (direction)}".  
-00020d70: 2020 2020 2020 2020 2020 290a 2020 2020            ).    
-00020d80: 2020 2020 7365 6c66 2e5f 626c 6f63 6b5f      self._block_
-00020d90: 6c61 6d62 6461 5f66 756e 6374 696f 6e73  lambda_functions
-00020da0: 2873 7461 7274 2c20 6469 7265 6374 696f  (start, directio
-00020db0: 6e29 0a20 2020 2020 2020 2063 6865 636b  n).        check
-00020dc0: 203d 206c 616d 6264 6120 6c3a 205b 0a20   = lambda l: [. 
-00020dd0: 2020 2020 2020 2020 2020 2069 7369 6e73             isins
-00020de0: 7461 6e63 6528 742c 2045 7870 7229 2061  tance(t, Expr) a
-00020df0: 6e64 2028 6e6f 7420 742e 6973 5f6e 756d  nd (not t.is_num
-00020e00: 6265 7229 2066 6f72 2074 2069 6e20 6c0a  ber) for t in l.
-00020e10: 2020 2020 2020 2020 5d0a 2020 2020 2020          ].      
-00020e20: 2020 6966 2061 6e79 2863 6865 636b 2873    if any(check(s
-00020e30: 7461 7274 2920 2b20 6368 6563 6b28 6469  tart) + check(di
-00020e40: 7265 6374 696f 6e29 2920 6f72 2073 656c  rection)) or sel
-00020e50: 662e 7061 7261 6d73 3a0a 2020 2020 2020  f.params:.      
-00020e60: 2020 2020 2020 6966 206e 6f74 2073 656c        if not sel
-00020e70: 662e 7061 7261 6d73 3a0a 2020 2020 2020  f.params:.      
-00020e80: 2020 2020 2020 2020 2020 7261 6973 6520            raise 
-00020e90: 5661 6c75 6545 7272 6f72 280a 2020 2020  ValueError(.    
-00020ea0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00020eb0: 2253 6f6d 6520 6f72 2061 6c6c 2065 6c65  "Some or all ele
-00020ec0: 6d65 6e74 7320 6f66 2074 6865 2070 726f  ments of the pro
-00020ed0: 7669 6465 6420 636f 6f72 6469 6e61 7465  vided coordinate
-00020ee0: 7320 220a 2020 2020 2020 2020 2020 2020  s ".            
-00020ef0: 2020 2020 2020 2020 2261 7265 2073 796d          "are sym
-00020f00: 626f 6c69 6320 6578 7072 6573 7369 6f6e  bolic expression
-00020f10: 732c 2062 7574 2074 6865 2060 6070 6172  s, but the ``par
-00020f20: 616d 7360 6020 6469 6374 696f 6e61 7279  ams`` dictionary
-00020f30: 2022 0a20 2020 2020 2020 2020 2020 2020   ".             
-00020f40: 2020 2020 2020 2022 7761 7320 6e6f 7420         "was not 
-00020f50: 7072 6f76 6964 6564 3a20 7468 6f73 6520  provided: those 
-00020f60: 656c 656d 656e 7473 2063 616e 2774 2062  elements can't b
-00020f70: 6520 6576 616c 7561 7465 642e 220a 2020  e evaluated.".  
-00020f80: 2020 2020 2020 2020 2020 2020 2020 290a                ).
-00020f90: 2020 2020 2020 2020 2020 2020 7365 6c66              self
-00020fa0: 2e73 7461 7274 203d 2054 7570 6c65 282a  .start = Tuple(*
-00020fb0: 7374 6172 7429 0a20 2020 2020 2020 2020  start).         
-00020fc0: 2020 2073 656c 662e 6469 7265 6374 696f     self.directio
-00020fd0: 6e20 3d20 5475 706c 6528 2a64 6972 6563  n = Tuple(*direc
-00020fe0: 7469 6f6e 290a 2020 2020 2020 2020 656c  tion).        el
-00020ff0: 7365 3a0a 2020 2020 2020 2020 2020 2020  se:.            
-00021000: 7365 6c66 2e73 7461 7274 203d 206e 702e  self.start = np.
-00021010: 6172 7261 7928 7374 6172 742c 2064 7479  array(start, dty
-00021020: 7065 3d6e 702e 666c 6f61 7436 3429 0a20  pe=np.float64). 
-00021030: 2020 2020 2020 2020 2020 2073 656c 662e             self.
-00021040: 6469 7265 6374 696f 6e20 3d20 6e70 2e61  direction = np.a
-00021050: 7272 6179 2864 6972 6563 7469 6f6e 2c20  rray(direction, 
-00021060: 6474 7970 653d 6e70 2e66 6c6f 6174 3634  dtype=np.float64
-00021070: 290a 0a20 2020 2020 2020 2073 656c 662e  )..        self.
-00021080: 5f65 7870 7220 3d20 2873 656c 662e 7374  _expr = (self.st
-00021090: 6172 742c 2073 656c 662e 6469 7265 6374  art, self.direct
-000210a0: 696f 6e29 0a20 2020 2020 2020 2069 6620  ion).        if 
-000210b0: 6e6f 7420 616e 7928 6973 696e 7374 616e  not any(isinstan
-000210c0: 6365 2874 2c20 6e70 2e6e 6461 7272 6179  ce(t, np.ndarray
-000210d0: 2920 666f 7220 7420 696e 205b 7365 6c66  ) for t in [self
-000210e0: 2e73 7461 7274 2c20 7365 6c66 2e64 6972  .start, self.dir
-000210f0: 6563 7469 6f6e 5d29 3a0a 2020 2020 2020  ection]):.      
-00021100: 2020 2020 2020 7365 6c66 2e5f 6368 6563        self._chec
-00021110: 6b5f 6673 2829 0a20 2020 2020 2020 2069  k_fs().        i
-00021120: 6620 6c61 6265 6c3a 0a20 2020 2020 2020  f label:.       
-00021130: 2020 2020 2073 656c 662e 6c61 6265 6c20       self.label 
-00021140: 3d20 6c61 6265 6c0a 2020 2020 2020 2020  = label.        
-00021150: 656c 7365 3a0a 2020 2020 2020 2020 2020  else:.          
-00021160: 2020 2320 6c61 6265 6c3a 2028 6672 6f6d    # label: (from
-00021170: 2920 2d3e 2028 746f 290a 2020 2020 2020  ) -> (to).      
-00021180: 2020 2020 2020 7365 6c66 2e5f 6c61 6265        self._labe
-00021190: 6c20 3d20 280a 2020 2020 2020 2020 2020  l = (.          
-000211a0: 2020 2020 2020 2228 7b7d 2920 2d3e 2028        "({}) -> (
-000211b0: 7b7d 2922 2e66 6f72 6d61 7428 0a20 2020  {})".format(.   
-000211c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000211d0: 2022 2c20 222e 6a6f 696e 285b 7374 7228   ", ".join([str(
-000211e0: 7429 2066 6f72 2074 2069 6e20 7365 6c66  t) for t in self
-000211f0: 2e73 7461 7274 5d29 2c0a 2020 2020 2020  .start]),.      
-00021200: 2020 2020 2020 2020 2020 2020 2020 222c                ",
-00021210: 2022 2e6a 6f69 6e28 5b73 7472 2875 202b   ".join([str(u +
-00021220: 2076 2920 666f 7220 752c 2076 2069 6e20   v) for u, v in 
-00021230: 7a69 7028 0a20 2020 2020 2020 2020 2020  zip(.           
-00021240: 2020 2020 2020 2020 2020 2020 2073 656c               sel
-00021250: 662e 7374 6172 742c 2073 656c 662e 6469  f.start, self.di
-00021260: 7265 6374 696f 6e29 5d29 0a20 2020 2020  rection)]).     
-00021270: 2020 2020 2020 2020 2020 2029 0a20 2020             ).   
-00021280: 2020 2020 2020 2020 2029 0a20 2020 2020           ).     
-00021290: 2020 2020 2020 2073 656c 662e 5f6c 6174         self._lat
-000212a0: 6578 5f6c 6162 656c 203d 2028 0a20 2020  ex_label = (.   
-000212b0: 2020 2020 2020 2020 2020 2020 2072 225c               r"\
-000212c0: 6c65 6674 287b 7d5c 7269 6768 7429 205c  left({}\right) \
-000212d0: 7269 6768 7461 7272 6f77 205c 6c65 6674  rightarrow \left
-000212e0: 287b 7d5c 7269 6768 7429 222e 666f 726d  ({}\right)".form
-000212f0: 6174 280a 2020 2020 2020 2020 2020 2020  at(.            
-00021300: 2020 2020 2020 2020 222c 2022 2e6a 6f69          ", ".joi
-00021310: 6e28 5b6c 6174 6578 2874 2920 666f 7220  n([latex(t) for 
-00021320: 7420 696e 2073 656c 662e 7374 6172 745d  t in self.start]
-00021330: 292c 0a20 2020 2020 2020 2020 2020 2020  ),.             
-00021340: 2020 2020 2020 2022 2c20 222e 6a6f 696e         ", ".join
-00021350: 285b 6c61 7465 7828 7520 2b20 7629 2066  ([latex(u + v) f
-00021360: 6f72 2075 2c20 7620 696e 207a 6970 280a  or u, v in zip(.
-00021370: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00021380: 2020 2020 2020 2020 7365 6c66 2e73 7461          self.sta
-00021390: 7274 2c20 7365 6c66 2e64 6972 6563 7469  rt, self.directi
-000213a0: 6f6e 295d 290a 2020 2020 2020 2020 2020  on)]).          
-000213b0: 2020 2020 2020 290a 2020 2020 2020 2020        ).        
-000213c0: 2020 2020 290a 2020 2020 2020 2020 7365      ).        se
-000213d0: 6c66 2e75 7365 5f71 7569 7665 725f 736f  lf.use_quiver_so
-000213e0: 6c69 645f 636f 6c6f 7220 3d20 6e6f 7420  lid_color = not 
-000213f0: 7365 6c66 2e75 7365 5f63 6d0a 2020 2020  self.use_cm.    
-00021400: 2020 2020 7365 6c66 2e6e 6f72 6d61 6c69      self.normali
-00021410: 7a65 203d 206b 7761 7267 732e 6765 7428  ze = kwargs.get(
-00021420: 226e 6f72 6d61 6c69 7a65 222c 2046 616c  "normalize", Fal
-00021430: 7365 290a 2020 2020 2020 2020 2320 544f  se).        # TO
-00021440: 444f 3a20 446f 2049 204e 6565 6420 7468  DO: Do I Need th
-00021450: 6973 3f0a 2020 2020 2020 2020 7365 6c66  is?.        self
-00021460: 2e69 735f 7374 7265 616d 6c69 6e65 7320  .is_streamlines 
-00021470: 3d20 6b77 6172 6773 2e67 6574 2822 7374  = kwargs.get("st
-00021480: 7265 616d 6c69 6e65 7322 2c20 4661 6c73  reamlines", Fals
-00021490: 6529 0a0a 2020 2020 6465 6620 5f5f 7374  e)..    def __st
-000214a0: 725f 5f28 7365 6c66 293a 0a20 2020 2020  r__(self):.     
-000214b0: 2020 2070 7265 203d 2022 3344 2022 2069     pre = "3D " i
-000214c0: 6620 7365 6c66 2e69 735f 3344 2065 6c73  f self.is_3D els
-000214d0: 6520 2232 4420 220a 2020 2020 2020 2020  e "2D ".        
-000214e0: 7374 6172 7420 3d20 7475 706c 6528 7365  start = tuple(se
-000214f0: 6c66 2e73 7461 7274 290a 2020 2020 2020  lf.start).      
-00021500: 2020 656e 6420 3d20 7475 706c 6528 7320    end = tuple(s 
-00021510: 2b20 6420 666f 7220 732c 2064 2069 6e20  + d for s, d in 
-00021520: 7a69 7028 7374 6172 742c 2073 656c 662e  zip(start, self.
-00021530: 6469 7265 6374 696f 6e29 290a 2020 2020  direction)).    
-00021540: 2020 2020 7265 7475 726e 2073 656c 662e      return self.
-00021550: 5f73 7472 5f68 656c 7065 7228 0a20 2020  _str_helper(.   
-00021560: 2020 2020 2020 2020 2070 7265 202b 2066           pre + f
-00021570: 2261 7272 6f77 2066 726f 6d20 7b73 7461  "arrow from {sta
-00021580: 7274 7d20 746f 207b 656e 647d 220a 2020  rt} to {end}".  
-00021590: 2020 2020 2020 290a 0a20 2020 2064 6566        )..    def
-000215a0: 2067 6574 5f6c 6162 656c 2873 656c 662c   get_label(self,
-000215b0: 2075 7365 5f6c 6174 6578 3d46 616c 7365   use_latex=False
-000215c0: 2c20 7772 6170 7065 723d 2224 2573 2422  , wrapper="$%s$"
-000215d0: 293a 0a20 2020 2020 2020 2022 2222 5265  ):.        """Re
-000215e0: 7475 726e 2074 6865 206c 6162 656c 2074  turn the label t
-000215f0: 6f20 6265 2075 7365 6420 746f 2064 6973  o be used to dis
-00021600: 706c 6179 2074 6865 2065 7870 7265 7373  play the express
-00021610: 696f 6e2e 0a0a 2020 2020 2020 2020 5061  ion...        Pa
-00021620: 7261 6d65 7465 7273 0a20 2020 2020 2020  rameters.       
-00021630: 203d 3d3d 3d3d 3d3d 3d3d 3d0a 2020 2020   ==========.    
-00021640: 2020 2020 7573 655f 6c61 7465 7820 3a20      use_latex : 
-00021650: 626f 6f6c 0a20 2020 2020 2020 2020 2020  bool.           
-00021660: 2049 6620 4661 6c73 652c 2074 6865 2073   If False, the s
-00021670: 7472 696e 6720 7265 7072 6573 656e 7461  tring representa
-00021680: 7469 6f6e 206f 6620 7468 6520 6578 7072  tion of the expr
-00021690: 6573 7369 6f6e 2069 7320 7265 7475 726e  ession is return
-000216a0: 6564 2e0a 2020 2020 2020 2020 2020 2020  ed..            
-000216b0: 4966 2054 7275 652c 2074 6865 206c 6174  If True, the lat
-000216c0: 6578 2072 6570 7265 7365 6e74 6174 696f  ex representatio
-000216d0: 6e20 6973 2072 6574 7572 6e65 642e 0a20  n is returned.. 
-000216e0: 2020 2020 2020 2077 7261 7070 6572 203a         wrapper :
-000216f0: 2073 7472 0a20 2020 2020 2020 2020 2020   str.           
-00021700: 2054 6865 2062 6163 6b65 6e64 206d 6967   The backend mig
-00021710: 6874 206e 6565 6420 7468 6520 6c61 7465  ht need the late
-00021720: 7820 7265 7072 6573 656e 7461 7469 6f6e  x representation
-00021730: 2074 6f20 6265 2077 7261 7070 6564 2062   to be wrapped b
-00021740: 790a 2020 2020 2020 2020 2020 2020 736f  y.            so
-00021750: 6d65 2063 6861 7261 6374 6572 732e 2044  me characters. D
-00021760: 6566 6175 6c74 2074 6f20 6060 2224 2573  efault to ``"$%s
-00021770: 2422 6060 2e0a 0a20 2020 2020 2020 2052  $"``...        R
-00021780: 6574 7572 6e73 0a20 2020 2020 2020 203d  eturns.        =
-00021790: 3d3d 3d3d 3d3d 0a20 2020 2020 2020 206c  ======.        l
-000217a0: 6162 656c 203a 2073 7472 0a20 2020 2020  abel : str.     
-000217b0: 2020 2022 2222 0a20 2020 2020 2020 2069     """.        i
-000217c0: 6620 7573 655f 6c61 7465 7820 6973 2046  f use_latex is F
-000217d0: 616c 7365 3a0a 2020 2020 2020 2020 2020  alse:.          
-000217e0: 2020 7265 7475 726e 2073 656c 662e 5f6c    return self._l
-000217f0: 6162 656c 0a20 2020 2020 2020 2072 6574  abel.        ret
-00021800: 7572 6e20 7365 6c66 2e5f 6765 745f 7772  urn self._get_wr
-00021810: 6170 7065 645f 6c61 6265 6c28 7365 6c66  apped_label(self
-00021820: 2e5f 6c61 7465 785f 6c61 6265 6c2c 2077  ._latex_label, w
-00021830: 7261 7070 6572 290a 0a20 2020 2064 6566  rapper)..    def
-00021840: 2067 6574 5f64 6174 6128 7365 6c66 293a   get_data(self):
-00021850: 0a20 2020 2020 2020 2022 2222 5265 7475  .        """Retu
-00021860: 726e 2061 7272 6179 7320 6f66 2063 6f6f  rn arrays of coo
-00021870: 7264 696e 6174 6573 2066 6f72 2070 6c6f  rdinates for plo
-00021880: 7474 696e 672e 0a0a 2020 2020 2020 2020  tting...        
-00021890: 5265 7475 726e 730a 2020 2020 2020 2020  Returns.        
-000218a0: 3d3d 3d3d 3d3d 3d0a 2020 2020 2020 2020  =======.        
-000218b0: 7831 2c20 7931 2c20 7a31 205b 6f70 7469  x1, y1, z1 [opti
-000218c0: 6f6e 616c 5d20 3a20 666c 6f61 740a 2020  onal] : float.  
-000218d0: 2020 2020 2020 2020 2020 436f 6f72 6469            Coordi
-000218e0: 6e61 7465 7320 6f66 2074 6865 2073 7461  nates of the sta
-000218f0: 7274 2070 6f73 6974 696f 6e2e 0a20 2020  rt position..   
-00021900: 2020 2020 2078 322c 2079 322c 207a 3220       x2, y2, z2 
-00021910: 5b6f 7074 696f 6e61 6c5d 203a 2066 6c6f  [optional] : flo
-00021920: 6174 0a20 2020 2020 2020 2020 2020 2043  at.            C
-00021930: 6f6f 7264 696e 6174 6573 206f 6620 7468  oordinates of th
-00021940: 6520 656e 6420 706f 7369 7469 6f6e 2e0a  e end position..
-00021950: 2020 2020 2020 2020 2222 220a 2020 2020          """.    
-00021960: 2020 2020 6e70 203d 2069 6d70 6f72 745f      np = import_
-00021970: 6d6f 6475 6c65 2827 6e75 6d70 7927 290a  module('numpy').
-00021980: 2020 2020 2020 2020 7374 6172 742c 2064          start, d
-00021990: 6972 6563 7469 6f6e 203d 2073 656c 662e  irection = self.
-000219a0: 7374 6172 742c 2073 656c 662e 6469 7265  start, self.dire
-000219b0: 6374 696f 6e0a 0a20 2020 2020 2020 2069  ction..        i
-000219c0: 6620 6e6f 7420 7365 6c66 2e69 735f 696e  f not self.is_in
-000219d0: 7465 7261 6374 6976 653a 0a20 2020 2020  teractive:.     
-000219e0: 2020 2020 2020 2073 7461 7274 2c20 6469         start, di
-000219f0: 7265 6374 696f 6e20 3d20 5b0a 2020 2020  rection = [.    
-00021a00: 2020 2020 2020 2020 2020 2020 6e70 2e61              np.a
-00021a10: 7272 6179 2874 2c20 6474 7970 653d 666c  rray(t, dtype=fl
-00021a20: 6f61 7429 2066 6f72 2074 2069 6e20 5b73  oat) for t in [s
-00021a30: 7461 7274 2c20 6469 7265 6374 696f 6e5d  tart, direction]
-00021a40: 0a20 2020 2020 2020 2020 2020 205d 0a20  .            ]. 
-00021a50: 2020 2020 2020 2065 6c73 653a 0a20 2020         else:.   
-00021a60: 2020 2020 2020 2020 2073 7461 7274 203d           start =
-00021a70: 206e 702e 6172 7261 7928 0a20 2020 2020   np.array(.     
-00021a80: 2020 2020 2020 2020 2020 205b 742e 6576             [t.ev
-00021a90: 616c 6628 7375 6273 3d73 656c 662e 7061  alf(subs=self.pa
-00021aa0: 7261 6d73 2920 666f 7220 7420 696e 2073  rams) for t in s
-00021ab0: 7461 7274 5d2c 2064 7479 7065 3d66 6c6f  tart], dtype=flo
-00021ac0: 6174 290a 2020 2020 2020 2020 2020 2020  at).            
-00021ad0: 6469 7265 6374 696f 6e20 3d20 6e70 2e61  direction = np.a
-00021ae0: 7272 6179 280a 2020 2020 2020 2020 2020  rray(.          
-00021af0: 2020 2020 2020 5b74 2e65 7661 6c66 2873        [t.evalf(s
-00021b00: 7562 733d 7365 6c66 2e70 6172 616d 7329  ubs=self.params)
-00021b10: 2066 6f72 2074 2069 6e20 6469 7265 6374   for t in direct
-00021b20: 696f 6e5d 2c20 6474 7970 653d 666c 6f61  ion], dtype=floa
-00021b30: 7429 0a0a 2020 2020 2020 2020 656e 6420  t)..        end 
-00021b40: 3d20 7374 6172 7420 2b20 6469 7265 6374  = start + direct
-00021b50: 696f 6e0a 2020 2020 2020 2020 7265 7475  ion.        retu
-00021b60: 726e 2073 656c 662e 5f61 7070 6c79 5f74  rn self._apply_t
-00021b70: 7261 6e73 666f 726d 282a 7374 6172 742c  ransform(*start,
-00021b80: 202a 656e 6429 0a0a 0a63 6c61 7373 2041   *end)...class A
-00021b90: 7272 6f77 3344 5365 7269 6573 2841 7272  rrow3DSeries(Arr
-00021ba0: 6f77 3244 5365 7269 6573 293a 0a20 2020  ow2DSeries):.   
-00021bb0: 2022 2222 5265 7072 6573 656e 7420 616e   """Represent an
-00021bc0: 2061 7272 6f77 2069 6e20 6120 3344 2073   arrow in a 3D s
-00021bd0: 7061 6365 2e0a 2020 2020 2222 220a 2020  pace..    """.  
-00021be0: 2020 6973 5f33 4420 3d20 5472 7565 0a20    is_3D = True. 
-00021bf0: 2020 2069 735f 3244 7665 6374 6f72 203d     is_2Dvector =
-00021c00: 2046 616c 7365 0a20 2020 2069 735f 3344   False.    is_3D
-00021c10: 7665 6374 6f72 203d 2054 7275 650a 0a20  vector = True.. 
-00021c20: 2020 2064 6566 2067 6574 5f64 6174 6128     def get_data(
-00021c30: 7365 6c66 293a 0a20 2020 2020 2020 2022  self):.        "
-00021c40: 2222 5265 7475 726e 2061 7272 6179 7320  ""Return arrays 
-00021c50: 6f66 2063 6f6f 7264 696e 6174 6573 2066  of coordinates f
-00021c60: 6f72 2070 6c6f 7474 696e 672e 0a0a 2020  or plotting...  
-00021c70: 2020 2020 2020 5265 7475 726e 730a 2020        Returns.  
-00021c80: 2020 2020 2020 3d3d 3d3d 3d3d 3d0a 2020        =======.  
-00021c90: 2020 2020 2020 782c 2079 2c20 7a20 3a20        x, y, z : 
-00021ca0: 666c 6f61 740a 2020 2020 2020 2020 2020  float.          
-00021cb0: 2020 436f 6f72 6469 6e61 7465 7320 6f66    Coordinates of
-00021cc0: 2074 6865 2073 7461 7274 2070 6f73 6974   the start posit
-00021cd0: 696f 6e2e 0a20 2020 2020 2020 2075 2c20  ion..        u, 
-00021ce0: 762c 2077 203a 2066 6c6f 6174 0a20 2020  v, w : float.   
-00021cf0: 2020 2020 2020 2020 2043 6f6f 7264 696e           Coordin
-00021d00: 6174 6573 206f 6620 7468 6520 656e 6420  ates of the end 
-00021d10: 706f 7369 7469 6f6e 2e0a 2020 2020 2020  position..      
-00021d20: 2020 2222 220a 2020 2020 2020 2020 7265    """.        re
-00021d30: 7475 726e 2073 7570 6572 2829 2e67 6574  turn super().get
-00021d40: 5f64 6174 6128 290a 0a0a 636c 6173 7320  _data()...class 
-00021d50: 4772 6964 4261 7365 3a0a 2020 2020 2222  GridBase:.    ""
-00021d60: 220a 2020 2020 2a47 7269 644c 696e 6553  ".    *GridLineS
-00021d70: 6572 6965 7320 6d61 7920 636f 7665 7220  eries may cover 
-00021d80: 7468 6520 656e 7469 7265 2076 6973 6962  the entire visib
-00021d90: 6c65 2061 7265 612e 2048 656e 6365 2c20  le area. Hence, 
-00021da0: 7468 6579 206e 6565 6420 746f 0a20 2020  they need to.   
-00021db0: 206b 6e6f 7720 7468 6520 6178 6973 206c   know the axis l
-00021dc0: 696d 6974 732e 0a0a 2020 2020 4178 6973  imits...    Axis
-00021dd0: 206c 696d 6974 7320 6361 6e20 6265 3a0a   limits can be:.
-00021de0: 2020 2020 312e 2070 726f 7669 6465 6420      1. provided 
-00021df0: 6279 2074 6865 2075 7365 7220 696e 2074  by the user in t
-00021e00: 6865 2070 6c6f 7420 6675 6e63 7469 6f6e  he plot function
-00021e10: 2063 616c 6c2e 2046 6f72 2065 7861 6d70   call. For examp
-00021e20: 6c65 3a0a 2020 2020 2020 2060 6070 6c6f  le:.       ``plo
-00021e30: 7428 2e2e 2e2c 2078 6c69 6d3d 2861 2c20  t(..., xlim=(a, 
-00021e40: 6229 2c20 796c 696d 3d28 632c 2064 2929  b), ylim=(c, d))
-00021e50: 6060 0a20 2020 2032 2e20 636f 6d70 7574  ``.    2. comput
-00021e60: 6564 2066 726f 6d20 7468 6520 6461 7461  ed from the data
-00021e70: 2074 6861 7420 6861 7320 616c 7265 6164   that has alread
-00021e80: 7920 6265 2070 6c6f 7474 6564 2e0a 2020  y be plotted..  
-00021e90: 2020 332e 2070 726f 7669 6465 6420 696e    3. provided in
-00021ea0: 2073 6f6d 6520 6675 6e63 7469 6f6e 2063   some function c
-00021eb0: 616c 6c20 7468 6174 2067 656e 6572 6174  all that generat
-00021ec0: 6573 2064 6174 6120 7365 7269 6573 2e20  es data series. 
-00021ed0: 466f 7220 6578 616d 706c 653a 0a20 2020  For example:.   
-00021ee0: 2020 2020 6060 6772 6170 6869 6373 2873      ``graphics(s
-00021ef0: 6772 6964 2878 6c69 6d3d 2861 2c20 6229  grid(xlim=(a, b)
-00021f00: 2c20 796c 696d 3d28 632c 2064 2929 2960  , ylim=(c, d)))`
-00021f10: 600a 0a20 2020 2045 6974 6865 7220 7761  `..    Either wa
-00021f20: 792c 2074 6865 2061 7070 726f 7072 6961  y, the appropria
-00021f30: 7465 2072 656e 6465 7265 7220 7769 6c6c  te renderer will
-00021f40: 3a0a 0a20 2020 2031 2e20 6669 6775 7265  :..    1. figure
-00021f50: 2069 7420 6f75 7420 7468 6520 6178 6973   it out the axis
-00021f60: 206c 696d 6974 732e 0a20 2020 2032 2e20   limits..    2. 
-00021f70: 4c65 7420 7468 6520 6772 6964 2073 6572  Let the grid ser
-00021f80: 6965 7320 6b6e 6f77 7320 6162 6f75 7420  ies knows about 
-00021f90: 7468 6973 206c 696d 6974 7320 6279 2063  this limits by c
-00021fa0: 616c 6c69 6e67 0a20 2020 2020 2020 6060  alling.       ``
-00021fb0: 7365 7269 6573 2e73 6574 5f61 7869 735f  series.set_axis_
-00021fc0: 6c69 6d69 7473 2878 6c69 6d2c 2079 6c69  limits(xlim, yli
-00021fd0: 6d29 6060 2e0a 2020 2020 332e 2043 6f6d  m)``..    3. Com
-00021fe0: 7075 7465 2074 6865 206e 756d 6572 6963  pute the numeric
-00021ff0: 616c 2064 6174 6120 666f 7220 7468 6520  al data for the 
-00022000: 7370 6563 6966 6965 6420 6772 6964 2074  specified grid t
-00022010: 6861 7420 636f 7665 7220 7468 650a 2020  hat cover the.  
-00022020: 2020 2020 2073 7065 6369 6669 6564 2061       specified a
-00022030: 7265 612c 2077 6974 6820 6060 7365 7269  rea, with ``seri
-00022040: 6573 2e67 6574 5f64 6174 6128 2960 602e  es.get_data()``.
-00022050: 0a0a 2020 2020 2222 220a 2020 2020 6973  ..    """.    is
-00022060: 5f67 7269 6420 3d20 5472 7565 0a0a 2020  _grid = True..  
-00022070: 2020 6465 6620 5f5f 696e 6974 5f5f 2873    def __init__(s
-00022080: 656c 662c 202a 6172 6773 2c20 2a2a 6b77  elf, *args, **kw
-00022090: 6172 6773 293a 0a20 2020 2020 2020 2073  args):.        s
-000220a0: 7570 6572 2829 2e5f 5f69 6e69 745f 5f28  uper().__init__(
-000220b0: 2a61 7267 732c 202a 2a6b 7761 7267 7329  *args, **kwargs)
-000220c0: 0a20 2020 2020 2020 2073 656c 662e 7368  .        self.sh
-000220d0: 6f77 5f69 6e5f 6c65 6765 6e64 203d 206b  ow_in_legend = k
-000220e0: 7761 7267 732e 6765 7428 2273 686f 775f  wargs.get("show_
-000220f0: 696e 5f6c 6567 656e 6422 2c20 4661 6c73  in_legend", Fals
-00022100: 6529 0a20 2020 2020 2020 2078 6c69 6d20  e).        xlim 
-00022110: 3d20 6b77 6172 6773 2e67 6574 2822 786c  = kwargs.get("xl
-00022120: 696d 222c 204e 6f6e 6529 0a20 2020 2020  im", None).     
-00022130: 2020 2079 6c69 6d20 3d20 6b77 6172 6773     ylim = kwargs
-00022140: 2e67 6574 2822 796c 696d 222c 204e 6f6e  .get("ylim", Non
-00022150: 6529 0a20 2020 2020 2020 2023 204a 7570  e).        # Jup
-00022160: 7974 6572 206c 6162 202b 2022 6672 6f6d  yter lab + "from
-00022170: 2073 796d 7079 2069 6d70 6f72 7420 2a22   sympy import *"
-00022180: 2063 6f6e 7665 7274 2061 6c6c 206e 756d   convert all num
-00022190: 6265 7273 2074 6f0a 2020 2020 2020 2020  bers to.        
-000221a0: 2320 7379 6d70 7927 7320 7479 7065 732e  # sympy's types.
-000221b0: 2054 6865 2061 6c67 6f72 6974 686d 2065   The algorithm e
-000221c0: 7870 6563 7465 7320 7468 656d 2074 6f20  xpectes them to 
-000221d0: 6265 2060 666c 6f61 7460 2e0a 2020 2020  be `float`..    
-000221e0: 2020 2020 7365 6c66 2e5f 786c 696d 203d      self._xlim =
-000221f0: 205b 666c 6f61 7428 7429 2066 6f72 2074   [float(t) for t
-00022200: 2069 6e20 786c 696d 5d20 6966 2078 6c69   in xlim] if xli
-00022210: 6d20 656c 7365 204e 6f6e 650a 2020 2020  m else None.    
-00022220: 2020 2020 7365 6c66 2e5f 796c 696d 203d      self._ylim =
-00022230: 205b 666c 6f61 7428 7429 2066 6f72 2074   [float(t) for t
-00022240: 2069 6e20 796c 696d 5d20 6966 2079 6c69   in ylim] if yli
-00022250: 6d20 656c 7365 204e 6f6e 650a 0a20 2020  m else None..   
-00022260: 2064 6566 2073 6574 5f61 7869 735f 6c69   def set_axis_li
-00022270: 6d69 7473 2873 656c 662c 2078 6c69 6d2c  mits(self, xlim,
-00022280: 2079 6c69 6d29 3a0a 2020 2020 2020 2020   ylim):.        
-00022290: 7365 6c66 2e5f 786c 696d 203d 2078 6c69  self._xlim = xli
-000222a0: 6d0a 2020 2020 2020 2020 7365 6c66 2e5f  m.        self._
-000222b0: 796c 696d 203d 2079 6c69 6d0a 0a20 2020  ylim = ylim..   
-000222c0: 2040 7072 6f70 6572 7479 0a20 2020 2064   @property.    d
-000222d0: 6566 2078 6c69 6d28 7365 6c66 293a 0a20  ef xlim(self):. 
-000222e0: 2020 2020 2020 2072 6574 7572 6e20 7365         return se
-000222f0: 6c66 2e5f 786c 696d 0a0a 2020 2020 4070  lf._xlim..    @p
-00022300: 726f 7065 7274 790a 2020 2020 6465 6620  roperty.    def 
-00022310: 796c 696d 2873 656c 6629 3a0a 2020 2020  ylim(self):.    
-00022320: 2020 2020 7265 7475 726e 2073 656c 662e      return self.
-00022330: 5f79 6c69 6d0a 0a0a 636c 6173 7320 5347  _ylim...class SG
-00022340: 7269 644c 696e 6553 6572 6965 7328 4772  ridLineSeries(Gr
-00022350: 6964 4261 7365 2c20 4261 7365 5365 7269  idBase, BaseSeri
-00022360: 6573 293a 0a20 2020 2022 2222 5265 7072  es):.    """Repr
-00022370: 6573 656e 7420 6120 6772 6964 206f 6620  esent a grid of 
-00022380: 6461 6d70 696e 6720 7261 7469 6f20 6c69  damping ratio li
-00022390: 6e65 7320 616e 6420 6e61 7475 7261 6c20  nes and natural 
-000223a0: 6672 6571 7565 6e63 7920 6c69 6e65 730a  frequency lines.
-000223b0: 2020 2020 6f6e 2074 6865 2073 2d70 6c61      on the s-pla
-000223c0: 6e65 2e20 5468 6973 2064 6174 6120 7365  ne. This data se
-000223d0: 7269 6573 2069 6d70 6c65 6d65 6e74 7320  ries implements 
-000223e0: 7477 6f20 6d6f 6465 7320 6f66 206f 7065  two modes of ope
-000223f0: 7261 7469 6f6e 3a0a 0a20 2020 2031 2e20  ration:..    1. 
-00022400: 5573 6572 2063 616e 2070 726f 7669 6465  User can provide
-00022410: 2078 692c 2077 6e2e 0a20 2020 2032 2e20   xi, wn..    2. 
-00022420: 5573 6572 2063 616e 2070 726f 7669 6465  User can provide
-00022430: 2064 756d 6d79 2078 692c 2077 6e2c 2061   dummy xi, wn, a
-00022440: 6e64 2061 206c 6973 7420 6f66 2061 7373  nd a list of ass
-00022450: 6f63 6961 7465 6420 526f 6f74 4c6f 6375  ociated RootLocu
-00022460: 7353 6572 6965 732e 0a20 2020 2020 2020  sSeries..       
-00022470: 5768 656e 2060 6067 6574 5f64 6174 6128  When ``get_data(
-00022480: 2960 6020 7769 6c6c 2062 6520 6361 6c6c  )`` will be call
-00022490: 6564 2c20 6974 2066 6972 7374 206c 6f6f  ed, it first loo
-000224a0: 7073 206f 7665 7220 7468 6520 6173 736f  ps over the asso
-000224b0: 6369 6174 6564 0a20 2020 2020 2020 726f  ciated.       ro
-000224c0: 6f74 206c 6f63 7573 2073 6572 6965 7320  ot locus series 
-000224d0: 696e 206f 7264 6572 2074 6f20 6465 7465  in order to dete
-000224e0: 726d 696e 6520 7468 6520 6178 6973 206c  rmine the axis l
-000224f0: 696d 6974 7320 6f66 2074 6865 2076 6973  imits of the vis
-00022500: 6962 6c65 0a20 2020 2020 2020 6172 6561  ible.       area
-00022510: 2e20 5468 656e 2c20 6974 2063 6f6d 7075  . Then, it compu
-00022520: 7465 7320 6e65 7720 7661 6c75 6573 206f  tes new values o
-00022530: 6620 7869 2c20 776e 2069 6e20 6f72 6465  f xi, wn in orde
-00022540: 7220 746f 2067 6574 2067 7269 6420 6c69  r to get grid li
-00022550: 6e65 730a 2020 2020 2020 2022 6576 656e  nes.       "even
-00022560: 6c79 2220 6469 7374 7269 6275 7465 6420  ly" distributed 
-00022570: 6f6e 2074 6865 2061 7661 696c 6162 6c65  on the available
-00022580: 2073 7061 6365 2e0a 2020 2020 2222 220a   space..    """.
-00022590: 0a20 2020 2064 6566 205f 5f69 6e69 745f  .    def __init_
-000225a0: 5f28 7365 6c66 2c20 7869 2c20 776e 2c20  _(self, xi, wn, 
-000225b0: 7470 2c20 7473 2c20 7365 7269 6573 3d5b  tp, ts, series=[
-000225c0: 5d2c 202a 2a6b 7761 7267 7329 3a0a 2020  ], **kwargs):.  
-000225d0: 2020 2020 2020 7375 7065 7228 292e 5f5f        super().__
-000225e0: 696e 6974 5f5f 282a 2a6b 7761 7267 7329  init__(**kwargs)
-000225f0: 0a20 2020 2020 2020 2073 656c 662e 7869  .        self.xi
-00022600: 203d 2078 690a 2020 2020 2020 2020 7365   = xi.        se
-00022610: 6c66 2e77 6e20 3d20 776e 0a20 2020 2020  lf.wn = wn.     
-00022620: 2020 2073 656c 662e 7470 203d 2074 700a     self.tp = tp.
-00022630: 2020 2020 2020 2020 7365 6c66 2e74 7320          self.ts 
-00022640: 3d20 7473 0a20 2020 2020 2020 2023 2077  = ts.        # w
-00022650: 6865 7468 6572 2063 6f6d 7075 7465 7320  hether computes 
-00022660: 7869 2f77 6e20 696e 206f 7264 6572 2074  xi/wn in order t
-00022670: 6f20 6576 656e 6c79 2064 6973 7472 6962  o evenly distrib
-00022680: 7574 6520 6c69 6e65 7320 6f76 6572 0a20  ute lines over. 
-00022690: 2020 2020 2020 2023 2074 6865 2061 7661         # the ava
-000226a0: 696c 6162 6c65 2070 6c6f 742d 6172 6561  ilable plot-area
-000226b0: 0a20 2020 2020 2020 2073 656c 662e 6175  .        self.au
-000226c0: 746f 203d 206b 7761 7267 732e 6765 7428  to = kwargs.get(
-000226d0: 2261 7574 6f22 2c20 4661 6c73 6529 0a20  "auto", False). 
-000226e0: 2020 2020 2020 2073 656c 662e 7368 6f77         self.show
-000226f0: 5f63 6f6e 7472 6f6c 5f61 7869 7320 3d20  _control_axis = 
-00022700: 6b77 6172 6773 2e67 6574 2822 7368 6f77  kwargs.get("show
-00022710: 5f63 6f6e 7472 6f6c 5f61 7869 7322 2c20  _control_axis", 
-00022720: 4661 6c73 6529 0a0a 2020 2020 6465 6620  False)..    def 
-00022730: 5f5f 7374 725f 5f28 7365 6c66 293a 0a20  __str__(self):. 
-00022740: 2020 2020 2020 2072 6574 7572 6e20 2273         return "s
-00022750: 2d67 7269 6422 0a0a 2020 2020 6465 6620  -grid"..    def 
-00022760: 5f73 6772 6964 5f64 6566 6175 6c74 5f78  _sgrid_default_x
-00022770: 6928 7365 6c66 2c20 786c 696d 2c20 796c  i(self, xlim, yl
-00022780: 696d 293a 0a20 2020 2020 2020 2022 2222  im):.        """
-00022790: 5265 7475 726e 2064 6566 6175 6c74 206c  Return default l
-000227a0: 6973 7420 6f66 2064 616d 7069 6e67 2063  ist of damping c
-000227b0: 6f65 6666 6963 6965 6e74 730a 0a20 2020  oefficients..   
-000227c0: 2020 2020 2054 6869 7320 6675 6e63 7469       This functi
-000227d0: 6f6e 2063 6f6d 7075 7465 7320 6120 6c69  on computes a li
-000227e0: 7374 206f 6620 6461 6d70 696e 6720 636f  st of damping co
-000227f0: 6566 6669 6369 656e 7473 2062 6173 6564  efficients based
-00022800: 206f 6e20 7468 6520 6c69 6d69 7473 0a20   on the limits. 
-00022810: 2020 2020 2020 206f 6620 7468 6520 6772         of the gr
-00022820: 6170 682e 2020 4120 7365 7420 6f66 2034  aph.  A set of 4
-00022830: 2064 616d 7069 6e67 2063 6f65 6666 6963   damping coeffic
-00022840: 6965 6e74 7320 6172 6520 636f 6d70 7574  ients are comput
-00022850: 6564 2066 6f72 2074 6865 2078 2d61 7869  ed for the x-axi
-00022860: 730a 2020 2020 2020 2020 616e 6420 6120  s.        and a 
-00022870: 7365 7420 6f66 2074 6872 6565 2064 616d  set of three dam
-00022880: 7069 6e67 2063 6f65 6666 6963 6965 6e74  ping coefficient
-00022890: 7320 6172 6520 636f 6d70 7574 6564 2066  s are computed f
-000228a0: 6f72 2074 6865 2079 2d61 7869 730a 2020  or the y-axis.  
-000228b0: 2020 2020 2020 2863 6f72 7265 7370 6f6e        (correspon
-000228c0: 6469 6e67 2074 6f20 7468 6520 6e6f 726d  ding to the norm
-000228d0: 616c 2034 3a33 2070 6c6f 7420 6173 7065  al 4:3 plot aspe
-000228e0: 6374 2072 6174 696f 2069 6e20 606d 6174  ct ratio in `mat
-000228f0: 706c 6f74 6c69 6260 3f29 2e0a 0a20 2020  plotlib`?)...   
-00022900: 2020 2020 2050 6172 616d 6574 6572 730a       Parameters.
-00022910: 2020 2020 2020 2020 2d2d 2d2d 2d2d 2d2d          --------
-00022920: 2d2d 0a20 2020 2020 2020 2078 6c69 6d20  --.        xlim 
-00022930: 3a20 6172 7261 795f 6c69 6b65 0a20 2020  : array_like.   
-00022940: 2020 2020 2020 2020 204c 6973 7420 6f66           List of
-00022950: 2078 2d61 7869 7320 6c69 6d69 7473 205b   x-axis limits [
-00022960: 6d69 6e2c 206d 6178 5d0a 2020 2020 2020  min, max].      
-00022970: 2020 796c 696d 203a 2061 7272 6179 5f6c    ylim : array_l
-00022980: 696b 650a 2020 2020 2020 2020 2020 2020  ike.            
-00022990: 4c69 7374 206f 6620 792d 6178 6973 206c  List of y-axis l
-000229a0: 696d 6974 7320 5b6d 696e 2c20 6d61 785d  imits [min, max]
-000229b0: 0a0a 2020 2020 2020 2020 5265 7475 726e  ..        Return
-000229c0: 730a 2020 2020 2020 2020 2d2d 2d2d 2d2d  s.        ------
-000229d0: 2d0a 2020 2020 2020 2020 7a65 7461 203a  -.        zeta :
-000229e0: 206c 6973 740a 2020 2020 2020 2020 2020   list.          
-000229f0: 2020 4c69 7374 206f 6620 6465 6661 756c    List of defaul
-00022a00: 7420 6461 6d70 696e 6720 636f 6566 6669  t damping coeffi
-00022a10: 6369 656e 7473 2066 6f72 2074 6865 2070  cients for the p
-00022a20: 6c6f 740a 0a20 2020 2020 2020 2022 2222  lot..        """
-00022a30: 0a20 2020 2020 2020 206e 7020 3d20 696d  .        np = im
-00022a40: 706f 7274 5f6d 6f64 756c 6528 226e 756d  port_module("num
-00022a50: 7079 2229 0a0a 2020 2020 2020 2020 785f  py")..        x_
-00022a60: 6c6f 7765 725f 6c69 6d20 3d20 786c 696d  lower_lim = xlim
-00022a70: 5b30 5d20 6966 2078 6c69 6d20 656c 7365  [0] if xlim else
-00022a80: 202d 3130 0a20 2020 2020 2020 2079 5f75   -10.        y_u
-00022a90: 7070 6572 5f6c 696d 203d 2079 6c69 6d5b  pper_lim = ylim[
-00022aa0: 315d 2069 6620 796c 696d 2065 6c73 6520  1] if ylim else 
-00022ab0: 3130 0a0a 2020 2020 2020 2020 2320 4461  10..        # Da
-00022ac0: 6d70 696e 6720 636f 6566 6669 6369 656e  mping coefficien
-00022ad0: 7420 6c69 6e65 7320 7468 6174 2069 6e74  t lines that int
-00022ae0: 6572 7365 6374 2074 6865 2078 2d61 7869  ersect the x-axi
-00022af0: 730a 2020 2020 2020 2020 7365 7031 203d  s.        sep1 =
-00022b00: 202d 785f 6c6f 7765 725f 6c69 6d20 2f20   -x_lower_lim / 
-00022b10: 340a 2020 2020 2020 2020 616e 6731 203d  4.        ang1 =
-00022b20: 205b 6e70 2e61 7263 7461 6e28 2873 6570   [np.arctan((sep
-00022b30: 312a 6929 2f79 5f75 7070 6572 5f6c 696d  1*i)/y_upper_lim
-00022b40: 2920 666f 7220 6920 696e 206e 702e 6172  ) for i in np.ar
-00022b50: 616e 6765 2831 2c20 342c 2031 295d 0a0a  ange(1, 4, 1)]..
-00022b60: 2020 2020 2020 2020 2320 4461 6d70 696e          # Dampin
-00022b70: 6720 636f 6566 6669 6369 656e 7420 6c69  g coefficient li
-00022b80: 6e65 7320 7468 6174 2069 6e74 6572 7365  nes that interse
-00022b90: 6374 696f 6e20 7468 6520 792d 6178 6973  ction the y-axis
-00022ba0: 0a20 2020 2020 2020 2073 6570 3220 3d20  .        sep2 = 
-00022bb0: 795f 7570 7065 725f 6c69 6d20 2f20 330a  y_upper_lim / 3.
-00022bc0: 2020 2020 2020 2020 616e 6732 203d 205b          ang2 = [
-00022bd0: 0a20 2020 2020 2020 2020 2020 206e 702e  .            np.
-00022be0: 6172 6374 616e 282d 785f 6c6f 7765 725f  arctan(-x_lower_
-00022bf0: 6c69 6d2f 2879 5f75 7070 6572 5f6c 696d  lim/(y_upper_lim
-00022c00: 2d73 6570 322a 6929 290a 2020 2020 2020  -sep2*i)).      
-00022c10: 2020 2020 2020 666f 7220 6920 696e 206e        for i in n
-00022c20: 702e 6172 616e 6765 2831 2c20 332c 2031  p.arange(1, 3, 1
-00022c30: 290a 2020 2020 2020 2020 5d0a 0a20 2020  ).        ]..   
-00022c40: 2020 2020 2023 2050 7574 2074 6865 206c       # Put the l
-00022c50: 696e 6573 2074 6f67 6574 6865 7220 616e  ines together an
-00022c60: 6420 6164 6420 6f6e 6520 6174 202d 7069  d add one at -pi
-00022c70: 2f32 2028 6e65 6761 7469 7665 2072 6561  /2 (negative rea
-00022c80: 6c20 6178 6973 290a 2020 2020 2020 2020  l axis).        
-00022c90: 616e 676c 6573 203d 206e 702e 636f 6e63  angles = np.conc
-00022ca0: 6174 656e 6174 6528 2861 6e67 312c 2061  atenate((ang1, a
-00022cb0: 6e67 3229 290a 0a20 2020 2020 2020 2023  ng2))..        #
-00022cc0: 2052 6574 7572 6e20 7468 6520 6461 6d70   Return the damp
-00022cd0: 696e 6720 636f 6566 6669 6369 656e 7473  ing coefficients
-00022ce0: 2063 6f72 7265 7370 6f6e 6469 6e67 2074   corresponding t
-00022cf0: 6f20 7468 6573 6520 616e 676c 6573 0a20  o these angles. 
-00022d00: 2020 2020 2020 207a 6574 6120 3d20 6e70         zeta = np
-00022d10: 2e73 696e 2861 6e67 6c65 7329 2e74 6f6c  .sin(angles).tol
-00022d20: 6973 7428 290a 2020 2020 2020 2020 6966  ist().        if
-00022d30: 206e 6f74 2073 656c 662e 7368 6f77 5f63   not self.show_c
-00022d40: 6f6e 7472 6f6c 5f61 7869 733a 0a20 2020  ontrol_axis:.   
-00022d50: 2020 2020 2020 2020 207a 6574 6120 2b3d           zeta +=
-00022d60: 205b 302c 2031 5d0a 2020 2020 2020 2020   [0, 1].        
-00022d70: 7265 7475 726e 207a 6574 610a 0a20 2020  return zeta..   
-00022d80: 2064 6566 205f 7367 7269 645f 6465 6661   def _sgrid_defa
-00022d90: 756c 745f 776e 2873 656c 662c 2078 6c69  ult_wn(self, xli
-00022da0: 6d2c 2079 6c69 6d2c 206d 6178 5f6c 696e  m, ylim, max_lin
-00022db0: 6573 3d37 293a 0a20 2020 2020 2020 2022  es=7):.        "
-00022dc0: 2222 5265 7475 726e 2064 6566 6175 6c74  ""Return default
-00022dd0: 2077 6e20 666f 7220 726f 6f74 206c 6f63   wn for root loc
-00022de0: 7573 2070 6c6f 740a 0a20 2020 2020 2020  us plot..       
-00022df0: 2054 6869 7320 6675 6e63 7469 6f6e 2063   This function c
-00022e00: 6f6d 7075 7465 7320 6120 6c69 7374 206f  omputes a list o
-00022e10: 6620 6e61 7475 7261 6c20 6672 6571 7565  f natural freque
-00022e20: 6e63 6965 7320 6261 7365 6420 6f6e 2074  ncies based on t
-00022e30: 6865 2067 7269 640a 2020 2020 2020 2020  he grid.        
-00022e40: 7061 7261 6d65 7465 7273 206f 6620 7468  parameters of th
-00022e50: 6520 6772 6170 682e 0a0a 2020 2020 2020  e graph...      
-00022e60: 2020 5061 7261 6d65 7465 7273 0a20 2020    Parameters.   
-00022e70: 2020 2020 202d 2d2d 2d2d 2d2d 2d2d 2d0a       ----------.
-00022e80: 2020 2020 2020 2020 786c 6f63 203a 2061          xloc : a
-00022e90: 7272 6179 5f6c 696b 650a 2020 2020 2020  rray_like.      
-00022ea0: 2020 2020 2020 4c69 7374 206f 6620 782d        List of x-
-00022eb0: 6178 6973 2074 6963 6b20 7661 6c75 6573  axis tick values
-00022ec0: 0a20 2020 2020 2020 2079 6c69 6d20 3a20  .        ylim : 
-00022ed0: 6172 7261 795f 6c69 6b65 0a20 2020 2020  array_like.     
-00022ee0: 2020 2020 2020 204c 6973 7420 6f66 2079         List of y
-00022ef0: 2d61 7869 7320 6c69 6d69 7473 205b 6d69  -axis limits [mi
-00022f00: 6e2c 206d 6178 5d0a 2020 2020 2020 2020  n, max].        
-00022f10: 6d61 785f 6c69 6e65 7320 3a20 696e 742c  max_lines : int,
-00022f20: 206f 7074 696f 6e61 6c0a 2020 2020 2020   optional.      
-00022f30: 2020 2020 2020 4d61 7869 6d75 6d20 6e75        Maximum nu
-00022f40: 6d62 6572 206f 6620 6672 6571 7565 6e63  mber of frequenc
-00022f50: 6965 7320 746f 2067 656e 6572 6174 6520  ies to generate 
-00022f60: 2864 6566 6175 6c74 203d 2037 290a 0a20  (default = 7).. 
-00022f70: 2020 2020 2020 2052 6574 7572 6e73 0a20         Returns. 
-00022f80: 2020 2020 2020 202d 2d2d 2d2d 2d2d 0a20         -------. 
-00022f90: 2020 2020 2020 2077 6e20 3a20 6c69 7374         wn : list
-00022fa0: 0a20 2020 2020 2020 2020 2020 204c 6973  .            Lis
-00022fb0: 7420 6f66 2064 6566 6175 6c74 206e 6174  t of default nat
-00022fc0: 7572 616c 2066 7265 7175 656e 6369 6573  ural frequencies
-00022fd0: 2066 6f72 2074 6865 2070 6c6f 740a 0a20   for the plot.. 
-00022fe0: 2020 2020 2020 2022 2222 0a20 2020 2020         """.     
-00022ff0: 2020 206c 6f77 6572 5f6c 696d 203d 2078     lower_lim = x
-00023000: 6c69 6d5b 305d 2069 6620 786c 696d 2065  lim[0] if xlim e
-00023010: 6c73 6520 2d31 300a 2020 2020 2020 2020  lse -10.        
-00023020: 6e70 203d 2069 6d70 6f72 745f 6d6f 6475  np = import_modu
-00023030: 6c65 2822 6e75 6d70 7922 290a 2020 2020  le("numpy").    
-00023040: 2020 2020 6176 6169 6c61 626c 655f 7769      available_wi
-00023050: 6474 6820 3d20 3020 2d20 6c6f 7765 725f  dth = 0 - lower_
-00023060: 6c69 6d0a 2020 2020 2020 2020 776e 203d  lim.        wn =
-00023070: 206e 702e 6c69 6e73 7061 6365 2830 2c20   np.linspace(0, 
-00023080: 6162 7328 6c6f 7765 725f 6c69 6d29 2c20  abs(lower_lim), 
-00023090: 6d61 785f 6c69 6e65 7329 5b31 3a2d 315d  max_lines)[1:-1]
-000230a0: 0a20 2020 2020 2020 2072 6574 7572 6e20  .        return 
-000230b0: 776e 0a0a 2020 2020 6465 6620 6765 745f  wn..    def get_
-000230c0: 6461 7461 2873 656c 6629 3a0a 2020 2020  data(self):.    
-000230d0: 2020 2020 2222 220a 2020 2020 2020 2020      """.        
-000230e0: 5265 7475 726e 730a 2020 2020 2020 2020  Returns.        
-000230f0: 3d3d 3d3d 3d3d 3d0a 2020 2020 2020 2020  =======.        
-00023100: 7869 5f64 6963 7420 3a20 6469 6374 0a20  xi_dict : dict. 
-00023110: 2020 2020 2020 2077 6e5f 6469 6374 203a         wn_dict :
-00023120: 2064 6963 740a 2020 2020 2020 2020 795f   dict.        y_
-00023130: 7470 203a 206e 702e 6e64 6172 7261 790a  tp : np.ndarray.
-00023140: 2020 2020 2020 2020 785f 7473 203a 206e          x_ts : n
-00023150: 702e 6e64 6172 7261 790a 2020 2020 2020  p.ndarray.      
-00023160: 2020 2222 220a 2020 2020 2020 2020 6e70    """.        np
-00023170: 203d 2069 6d70 6f72 745f 6d6f 6475 6c65   = import_module
-00023180: 2822 6e75 6d70 7922 290a 0a20 2020 2020  ("numpy")..     
-00023190: 2020 2069 6620 7365 6c66 2e61 7574 6f3a     if self.auto:
-000231a0: 0a20 2020 2020 2020 2020 2020 2078 6920  .            xi 
-000231b0: 3d20 7365 6c66 2e5f 7367 7269 645f 6465  = self._sgrid_de
-000231c0: 6661 756c 745f 7869 2873 656c 662e 786c  fault_xi(self.xl
-000231d0: 696d 2c20 7365 6c66 2e79 6c69 6d29 0a20  im, self.ylim). 
-000231e0: 2020 2020 2020 2020 2020 2077 6e20 3d20             wn = 
-000231f0: 7365 6c66 2e5f 7367 7269 645f 6465 6661  self._sgrid_defa
-00023200: 756c 745f 776e 2873 656c 662e 786c 696d  ult_wn(self.xlim
-00023210: 2c20 7365 6c66 2e79 6c69 6d29 0a20 2020  , self.ylim).   
-00023220: 2020 2020 2065 6c73 653a 0a20 2020 2020       else:.     
-00023230: 2020 2020 2020 2078 6920 3d20 6e70 2e61         xi = np.a
-00023240: 7272 6179 285b 0a20 2020 2020 2020 2020  rray([.         
-00023250: 2020 2020 2020 2074 2e65 7661 6c66 2873         t.evalf(s
-00023260: 7562 733d 7365 6c66 2e70 6172 616d 7329  ubs=self.params)
-00023270: 2069 6620 6973 696e 7374 616e 6365 2874   if isinstance(t
-00023280: 2c20 4578 7072 2920 656c 7365 2074 0a20  , Expr) else t. 
-00023290: 2020 2020 2020 2020 2020 2020 2020 2066                 f
-000232a0: 6f72 2074 2069 6e20 7365 6c66 2e78 695d  or t in self.xi]
-000232b0: 2c20 6474 7970 653d 666c 6f61 7429 0a20  , dtype=float). 
-000232c0: 2020 2020 2020 2020 2020 2069 6620 616e             if an
-000232d0: 7928 7869 203e 2031 2920 6f72 2061 6e79  y(xi > 1) or any
-000232e0: 2878 6920 3c20 3029 3a0a 2020 2020 2020  (xi < 0):.      
-000232f0: 2020 2020 2020 2020 2020 2320 456e 666f            # Enfo
-00023300: 7263 6520 7468 6973 2063 6f6e 6469 7469  rce this conditi
-00023310: 6f6e 0a20 2020 2020 2020 2020 2020 2020  on.             
-00023320: 2020 2072 6169 7365 2056 616c 7565 4572     raise ValueEr
-00023330: 726f 7228 2249 7420 6d75 7374 2062 6520  ror("It must be 
-00023340: 6060 3020 3c3d 2078 6920 3c3d 2031 2e20  ``0 <= xi <= 1. 
-00023350: 220a 2020 2020 2020 2020 2020 2020 2020  ".              
-00023360: 2020 2020 2020 2243 6f6d 7075 7465 643a        "Computed:
-00023370: 2025 7322 2025 2078 6929 0a20 2020 2020   %s" % xi).     
-00023380: 2020 2020 2020 2077 6e20 3d20 6e70 2e61         wn = np.a
-00023390: 7272 6179 285b 0a20 2020 2020 2020 2020  rray([.         
-000233a0: 2020 2020 2020 2074 2e65 7661 6c66 2873         t.evalf(s
-000233b0: 7562 733d 7365 6c66 2e70 6172 616d 7329  ubs=self.params)
-000233c0: 2069 6620 6973 696e 7374 616e 6365 2874   if isinstance(t
-000233d0: 2c20 4578 7072 2920 656c 7365 2074 0a20  , Expr) else t. 
-000233e0: 2020 2020 2020 2020 2020 2020 2020 2066                 f
-000233f0: 6f72 2074 2069 6e20 7365 6c66 2e77 6e5d  or t in self.wn]
-00023400: 2c20 6474 7970 653d 666c 6f61 7429 0a20  , dtype=float). 
-00023410: 2020 2020 2020 2074 7020 3d20 6e70 2e61         tp = np.a
-00023420: 7272 6179 285b 0a20 2020 2020 2020 2020  rray([.         
-00023430: 2020 2074 2e65 7661 6c66 2873 7562 733d     t.evalf(subs=
-00023440: 7365 6c66 2e70 6172 616d 7329 2069 6620  self.params) if 
-00023450: 6973 696e 7374 616e 6365 2874 2c20 4578  isinstance(t, Ex
-00023460: 7072 2920 656c 7365 2074 0a20 2020 2020  pr) else t.     
-00023470: 2020 2020 2020 2066 6f72 2074 2069 6e20         for t in 
-00023480: 7365 6c66 2e74 705d 2c20 6474 7970 653d  self.tp], dtype=
-00023490: 666c 6f61 7429 0a20 2020 2020 2020 2074  float).        t
-000234a0: 7320 3d20 6e70 2e61 7272 6179 285b 0a20  s = np.array([. 
-000234b0: 2020 2020 2020 2020 2020 2074 2e65 7661             t.eva
-000234c0: 6c66 2873 7562 733d 7365 6c66 2e70 6172  lf(subs=self.par
-000234d0: 616d 7329 2069 6620 6973 696e 7374 616e  ams) if isinstan
-000234e0: 6365 2874 2c20 4578 7072 2920 656c 7365  ce(t, Expr) else
-000234f0: 2074 0a20 2020 2020 2020 2020 2020 2066   t.            f
-00023500: 6f72 2074 2069 6e20 7365 6c66 2e74 735d  or t in self.ts]
-00023510: 2c20 6474 7970 653d 666c 6f61 7429 0a0a  , dtype=float)..
-00023520: 2020 2020 2020 2020 616e 676c 6573 203d          angles =
-00023530: 206e 702e 7069 202d 206e 702e 6172 6363   np.pi - np.arcc
-00023540: 6f73 2878 6929 0a20 2020 2020 2020 2079  os(xi).        y
-00023550: 5f6f 7665 725f 7820 3d20 6e70 2e74 616e  _over_x = np.tan
-00023560: 2861 6e67 6c65 7329 0a20 2020 2020 2020  (angles).       
-00023570: 2072 203d 206d 6178 2831 3030 302c 206d   r = max(1000, m
-00023580: 6178 2877 6e29 2920 6966 206c 656e 2877  ax(wn)) if len(w
-00023590: 6e29 203e 2030 2065 6c73 6520 3130 3030  n) > 0 else 1000
-000235a0: 0a0a 2020 2020 2020 2020 7869 5f64 6963  ..        xi_dic
-000235b0: 7420 3d20 7b6b 3a20 7b7d 2066 6f72 206b  t = {k: {} for k
-000235c0: 2069 6e20 7a69 7028 7869 2c20 616e 676c   in zip(xi, angl
-000235d0: 6573 2c20 795f 6f76 6572 5f78 297d 0a20  es, y_over_x)}. 
-000235e0: 2020 2020 2020 2077 6e5f 6469 6374 203d         wn_dict =
-000235f0: 207b 6b3a 207b 7d20 666f 7220 6b20 696e   {k: {} for k in
-00023600: 2077 6e7d 0a20 2020 2020 2020 2074 705f   wn}.        tp_
-00023610: 6469 6374 203d 207b 6b3a 207b 7d20 666f  dict = {k: {} fo
-00023620: 7220 6b20 696e 2074 707d 0a20 2020 2020  r k in tp}.     
-00023630: 2020 2074 735f 6469 6374 203d 207b 6b3a     ts_dict = {k:
-00023640: 207b 7d20 666f 7220 6b20 696e 2074 737d   {} for k in ts}
-00023650: 0a0a 2020 2020 2020 2020 2320 6461 6d70  ..        # damp
-00023660: 696e 6720 7261 7469 6f20 6c69 6e65 730a  ing ratio lines.
-00023670: 2020 2020 2020 2020 666f 7220 6b20 696e          for k in
-00023680: 207a 6970 2878 692c 2061 6e67 6c65 732c   zip(xi, angles,
-00023690: 2079 5f6f 7665 725f 7829 3a0a 2020 2020   y_over_x):.    
-000236a0: 2020 2020 2020 2020 782c 2061 2c20 7970          x, a, yp
-000236b0: 203d 206b 0a20 2020 2020 2020 2020 2020   = k.           
-000236c0: 2078 695f 6469 6374 5b6b 5d5b 2278 225d   xi_dict[k]["x"]
-000236d0: 203d 206e 702e 6172 7261 7928 5b30 2c20   = np.array([0, 
-000236e0: 7220 2a20 6e70 2e63 6f73 2861 295d 290a  r * np.cos(a)]).
-000236f0: 2020 2020 2020 2020 2020 2020 7869 5f64              xi_d
-00023700: 6963 745b 6b5d 5b22 7922 5d20 3d20 6e70  ict[k]["y"] = np
-00023710: 2e61 7272 6179 285b 302c 2072 202a 206e  .array([0, r * n
-00023720: 702e 7369 6e28 6129 5d29 0a20 2020 2020  p.sin(a)]).     
-00023730: 2020 2020 2020 2078 695f 6469 6374 5b6b         xi_dict[k
-00023740: 5d5b 226c 6162 656c 225d 203d 2022 252e  ]["label"] = "%.
-00023750: 3266 2220 2520 780a 0a20 2020 2020 2020  2f" % x..       
-00023760: 2023 206e 6174 7572 616c 2066 7265 7175   # natural frequ
-00023770: 656e 6379 206c 696e 6573 0a20 2020 2020  ency lines.     
-00023780: 2020 2074 203d 206e 702e 6c69 6e73 7061     t = np.linspa
-00023790: 6365 286e 702e 7069 2f32 2c20 332a 6e70  ce(np.pi/2, 3*np
-000237a0: 2e70 692f 322c 2031 3030 290a 2020 2020  .pi/2, 100).    
-000237b0: 2020 2020 6374 203d 206e 702e 636f 7328      ct = np.cos(
-000237c0: 7429 0a20 2020 2020 2020 2073 7420 3d20  t).        st = 
-000237d0: 6e70 2e73 696e 2874 290a 2020 2020 2020  np.sin(t).      
-000237e0: 2020 796c 696d 203d 2073 656c 662e 5f79    ylim = self._y
-000237f0: 6c69 6d0a 2020 2020 2020 2020 795f 6f66  lim.        y_of
-00023800: 6673 6574 203d 2030 2069 6620 796c 696d  fset = 0 if ylim
-00023810: 2069 7320 4e6f 6e65 2065 6c73 6520 302e   is None else 0.
-00023820: 3031 3520 2a20 6162 7328 796c 696d 5b31  015 * abs(ylim[1
-00023830: 5d20 2d20 796c 696d 5b30 5d29 0a20 2020  ] - ylim[0]).   
-00023840: 2020 2020 2066 6f72 2077 2069 6e20 776e       for w in wn
-00023850: 3a0a 2020 2020 2020 2020 2020 2020 776e  :.            wn
-00023860: 5f64 6963 745b 775d 5b22 7822 5d20 3d20  _dict[w]["x"] = 
-00023870: 7720 2a20 6374 0a20 2020 2020 2020 2020  w * ct.         
-00023880: 2020 2077 6e5f 6469 6374 5b77 5d5b 2279     wn_dict[w]["y
-00023890: 225d 203d 2077 202a 2073 740a 2020 2020  "] = w * st.    
-000238a0: 2020 2020 2020 2020 776e 5f64 6963 745b          wn_dict[
-000238b0: 775d 5b22 6c61 6265 6c22 5d20 3d20 2225  w]["label"] = "%
-000238c0: 2e32 6622 2025 2077 0a20 2020 2020 2020  .2f" % w.       
-000238d0: 2020 2020 2077 6e5f 6469 6374 5b77 5d5b       wn_dict[w][
-000238e0: 226c 7822 5d20 3d20 2d77 0a20 2020 2020  "lx"] = -w.     
-000238f0: 2020 2020 2020 2077 6e5f 6469 6374 5b77         wn_dict[w
-00023900: 5d5b 226c 7922 5d20 3d20 795f 6f66 6673  ]["ly"] = y_offs
-00023910: 6574 0a0a 2020 2020 2020 2020 2320 7065  et..        # pe
-00023920: 616b 2074 696d 6520 6c69 6e65 730a 2020  ak time lines.  
-00023930: 2020 2020 2020 795f 7470 203d 206e 702e        y_tp = np.
-00023940: 7069 202f 2074 700a 2020 2020 2020 2020  pi / tp.        
-00023950: 2320 7365 7474 6c69 6e67 2074 696d 6520  # settling time 
-00023960: 6c69 6e65 730a 2020 2020 2020 2020 785f  lines.        x_
-00023970: 7473 203d 202d 3420 2f20 7473 0a0a 2020  ts = -4 / ts..  
-00023980: 2020 2020 2020 7265 7475 726e 2078 695f        return xi_
-00023990: 6469 6374 2c20 776e 5f64 6963 742c 2079  dict, wn_dict, y
-000239a0: 5f74 702c 2078 5f74 730a 0a0a 636c 6173  _tp, x_ts...clas
-000239b0: 7320 5a47 7269 644c 696e 6553 6572 6965  s ZGridLineSerie
-000239c0: 7328 4772 6964 4261 7365 2c20 4261 7365  s(GridBase, Base
-000239d0: 5365 7269 6573 293a 0a20 2020 2022 2222  Series):.    """
-000239e0: 5265 7072 6573 656e 7420 6120 6772 6964  Represent a grid
-000239f0: 206f 6620 6461 6d70 696e 6720 7261 7469   of damping rati
-00023a00: 6f20 6c69 6e65 7320 616e 6420 6e61 7475  o lines and natu
-00023a10: 7261 6c20 6672 6571 7565 6e63 7920 6c69  ral frequency li
-00023a20: 6e65 730a 2020 2020 6f6e 2074 6865 207a  nes.    on the z
-00023a30: 2d70 6c61 6e65 2e0a 2020 2020 2222 220a  -plane..    """.
-00023a40: 0a20 2020 2064 6566 205f 5f69 6e69 745f  .    def __init_
-00023a50: 5f28 7365 6c66 2c20 7869 2c20 776e 2c20  _(self, xi, wn, 
-00023a60: 7470 2c20 7473 2c20 2a2a 6b77 6172 6773  tp, ts, **kwargs
-00023a70: 293a 0a20 2020 2020 2020 2073 7570 6572  ):.        super
-00023a80: 2829 2e5f 5f69 6e69 745f 5f28 2a2a 6b77  ().__init__(**kw
-00023a90: 6172 6773 290a 2020 2020 2020 2020 5420  args).        T 
-00023aa0: 3d20 6b77 6172 6773 2e67 6574 2822 5422  = kwargs.get("T"
-00023ab0: 2c20 4e6f 6e65 290a 2020 2020 2020 2020  , None).        
-00023ac0: 7365 6c66 2e73 616d 706c 696e 675f 7065  self.sampling_pe
-00023ad0: 7269 6f64 203d 2054 2069 6620 5420 6973  riod = T if T is
-00023ae0: 204e 6f6e 6520 656c 7365 2066 6c6f 6174   None else float
-00023af0: 2854 290a 2020 2020 2020 2020 7365 6c66  (T).        self
-00023b00: 2e78 6920 3d20 7869 0a20 2020 2020 2020  .xi = xi.       
-00023b10: 2073 656c 662e 776e 203d 2077 6e0a 2020   self.wn = wn.  
-00023b20: 2020 2020 2020 7365 6c66 2e74 7020 3d20        self.tp = 
-00023b30: 7470 0a20 2020 2020 2020 2073 656c 662e  tp.        self.
-00023b40: 7473 203d 2074 730a 2020 2020 2020 2020  ts = ts.        
-00023b50: 7365 6c66 2e73 686f 775f 636f 6e74 726f  self.show_contro
-00023b60: 6c5f 6178 6973 203d 206b 7761 7267 732e  l_axis = kwargs.
-00023b70: 6765 7428 2273 686f 775f 636f 6e74 726f  get("show_contro
-00023b80: 6c5f 6178 6973 222c 2046 616c 7365 290a  l_axis", False).
-00023b90: 0a20 2020 2064 6566 205f 5f73 7472 5f5f  .    def __str__
-00023ba0: 2873 656c 6629 3a0a 2020 2020 2020 2020  (self):.        
-00023bb0: 7265 7475 726e 2022 7a2d 6772 6964 220a  return "z-grid".
-00023bc0: 0a20 2020 2064 6566 2067 6574 5f64 6174  .    def get_dat
-00023bd0: 6128 7365 6c66 293a 0a20 2020 2020 2020  a(self):.       
-00023be0: 2022 2222 0a20 2020 2020 2020 2052 6574   """.        Ret
-00023bf0: 7572 6e73 0a20 2020 2020 2020 203d 3d3d  urns.        ===
-00023c00: 3d3d 3d3d 0a20 2020 2020 2020 2078 692c  ====.        xi,
-00023c10: 2077 6e2c 2074 702c 2074 7320 3a20 6469   wn, tp, ts : di
-00023c20: 6374 0a20 2020 2020 2020 2020 2020 2044  ct.            D
-00023c30: 6963 7469 6f6e 6172 6965 7320 636f 6e74  ictionaries cont
-00023c40: 6169 6e69 6e67 2074 6865 2072 6571 7569  aining the requi
-00023c50: 7265 6420 6e75 6d65 7269 6361 6c20 6461  red numerical da
-00023c60: 7461 2074 6f20 6372 6561 7465 0a20 2020  ta to create.   
-00023c70: 2020 2020 2020 2020 206c 696e 6573 2061           lines a
-00023c80: 6e64 2061 6e6e 6f74 6174 696f 6e73 2e0a  nd annotations..
-00023c90: 2020 2020 2020 2020 2222 220a 2020 2020          """.    
-00023ca0: 2020 2020 6e70 203d 2069 6d70 6f72 745f      np = import_
-00023cb0: 6d6f 6475 6c65 2822 6e75 6d70 7922 290a  module("numpy").
-00023cc0: 2020 2020 2020 2020 6966 2073 656c 662e          if self.
-00023cd0: 6973 5f69 6e74 6572 6163 7469 7665 3a0a  is_interactive:.
-00023ce0: 2020 2020 2020 2020 2020 2020 7869 203d              xi =
-00023cf0: 206e 702e 6172 7261 7928 5b0a 2020 2020   np.array([.    
-00023d00: 2020 2020 2020 2020 2020 2020 742e 6576              t.ev
-00023d10: 616c 6628 7375 6273 3d73 656c 662e 7061  alf(subs=self.pa
-00023d20: 7261 6d73 2920 6966 2069 7369 6e73 7461  rams) if isinsta
-00023d30: 6e63 6528 742c 2045 7870 7229 2065 6c73  nce(t, Expr) els
-00023d40: 6520 740a 2020 2020 2020 2020 2020 2020  e t.            
-00023d50: 2020 2020 666f 7220 7420 696e 2073 656c      for t in sel
-00023d60: 662e 7869 5d2c 2064 7479 7065 3d66 6c6f  f.xi], dtype=flo
-00023d70: 6174 290a 2020 2020 2020 2020 2020 2020  at).            
-00023d80: 776e 203d 206e 702e 6172 7261 7928 5b0a  wn = np.array([.
-00023d90: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00023da0: 742e 6576 616c 6628 7375 6273 3d73 656c  t.evalf(subs=sel
-00023db0: 662e 7061 7261 6d73 2920 6966 2069 7369  f.params) if isi
-00023dc0: 6e73 7461 6e63 6528 742c 2045 7870 7229  nstance(t, Expr)
-00023dd0: 2065 6c73 6520 740a 2020 2020 2020 2020   else t.        
-00023de0: 2020 2020 2020 2020 666f 7220 7420 696e          for t in
-00023df0: 2073 656c 662e 776e 5d2c 2064 7479 7065   self.wn], dtype
-00023e00: 3d66 6c6f 6174 290a 2020 2020 2020 2020  =float).        
-00023e10: 2020 2020 7470 203d 206e 702e 6172 7261      tp = np.arra
-00023e20: 7928 5b0a 2020 2020 2020 2020 2020 2020  y([.            
-00023e30: 2020 2020 742e 6576 616c 6628 7375 6273      t.evalf(subs
-00023e40: 3d73 656c 662e 7061 7261 6d73 2920 6966  =self.params) if
-00023e50: 2069 7369 6e73 7461 6e63 6528 742c 2045   isinstance(t, E
-00023e60: 7870 7229 2065 6c73 6520 740a 2020 2020  xpr) else t.    
-00023e70: 2020 2020 2020 2020 2020 2020 666f 7220              for 
-00023e80: 7420 696e 2073 656c 662e 7470 5d2c 2064  t in self.tp], d
-00023e90: 7479 7065 3d66 6c6f 6174 290a 2020 2020  type=float).    
-00023ea0: 2020 2020 2020 2020 7473 203d 206e 702e          ts = np.
-00023eb0: 6172 7261 7928 5b0a 2020 2020 2020 2020  array([.        
-00023ec0: 2020 2020 2020 2020 742e 6576 616c 6628          t.evalf(
-00023ed0: 7375 6273 3d73 656c 662e 7061 7261 6d73  subs=self.params
-00023ee0: 2920 6966 2069 7369 6e73 7461 6e63 6528  ) if isinstance(
-00023ef0: 742c 2045 7870 7229 2065 6c73 6520 740a  t, Expr) else t.
-00023f00: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00023f10: 666f 7220 7420 696e 2073 656c 662e 7473  for t in self.ts
-00023f20: 5d2c 2064 7479 7065 3d66 6c6f 6174 290a  ], dtype=float).
-00023f30: 2020 2020 2020 2020 656c 7365 3a0a 2020          else:.  
-00023f40: 2020 2020 2020 2020 2020 7869 203d 206e            xi = n
-00023f50: 702e 6172 7261 7928 7365 6c66 2e78 692c  p.array(self.xi,
-00023f60: 2064 7479 7065 3d66 6c6f 6174 290a 2020   dtype=float).  
-00023f70: 2020 2020 2020 2020 2020 776e 203d 206e            wn = n
-00023f80: 702e 6172 7261 7928 7365 6c66 2e77 6e2c  p.array(self.wn,
-00023f90: 2064 7479 7065 3d66 6c6f 6174 290a 2020   dtype=float).  
-00023fa0: 2020 2020 2020 2020 2020 7470 203d 206e            tp = n
-00023fb0: 702e 6172 7261 7928 7365 6c66 2e74 702c  p.array(self.tp,
-00023fc0: 2064 7479 7065 3d66 6c6f 6174 290a 2020   dtype=float).  
-00023fd0: 2020 2020 2020 2020 2020 7473 203d 206e            ts = n
-00023fe0: 702e 6172 7261 7928 7365 6c66 2e74 732c  p.array(self.ts,
-00023ff0: 2064 7479 7065 3d66 6c6f 6174 290a 0a20   dtype=float).. 
-00024000: 2020 2020 2020 2054 203d 2073 656c 662e         T = self.
-00024010: 7361 6d70 6c69 6e67 5f70 6572 696f 640a  sampling_period.
-00024020: 2020 2020 2020 2020 7869 5f64 6963 7420          xi_dict 
-00024030: 3d20 7b6b 3a20 7b7d 2066 6f72 206b 2069  = {k: {} for k i
-00024040: 6e20 7869 7d0a 2020 2020 2020 2020 776e  n xi}.        wn
-00024050: 5f64 6963 7420 3d20 7b6b 3a20 7b7d 2066  _dict = {k: {} f
-00024060: 6f72 206b 2069 6e20 776e 7d0a 2020 2020  or k in wn}.    
-00024070: 2020 2020 7470 5f64 6963 7420 3d20 7b6b      tp_dict = {k
-00024080: 3a20 7b7d 2066 6f72 206b 2069 6e20 7470  : {} for k in tp
-00024090: 7d0a 2020 2020 2020 2020 7473 5f64 6963  }.        ts_dic
-000240a0: 7420 3d20 7b6b 3a20 7b7d 2066 6f72 206b  t = {k: {} for k
-000240b0: 2069 6e20 7473 7d0a 0a20 2020 2020 2020   in ts}..       
-000240c0: 2023 2064 616d 7069 6e67 2072 6174 696f   # damping ratio
-000240d0: 206c 696e 6573 0a20 2020 2020 2020 2066   lines.        f
-000240e0: 6f72 207a 6574 6120 696e 2078 693a 0a20  or zeta in xi:. 
-000240f0: 2020 2020 2020 2020 2020 2023 2043 616c             # Cal
-00024100: 6375 6c61 7465 2069 6e20 706f 6c61 7220  culate in polar 
-00024110: 636f 6f72 6469 6e61 7465 730a 2020 2020  coordinates.    
-00024120: 2020 2020 2020 2020 6661 6374 6f72 203d          factor =
-00024130: 207a 6574 612f 6e70 2e73 7172 7428 312d   zeta/np.sqrt(1-
-00024140: 7a65 7461 2a2a 3229 0a20 2020 2020 2020  zeta**2).       
-00024150: 2020 2020 2078 203d 206e 702e 6c69 6e73       x = np.lins
-00024160: 7061 6365 2830 2c20 6e70 2e73 7172 7428  pace(0, np.sqrt(
-00024170: 312d 7a65 7461 2a2a 3229 2c20 3230 3029  1-zeta**2), 200)
-00024180: 0a20 2020 2020 2020 2020 2020 2061 6e67  .            ang
-00024190: 203d 206e 702e 7069 2a78 0a20 2020 2020   = np.pi*x.     
-000241a0: 2020 2020 2020 206d 6167 203d 206e 702e         mag = np.
-000241b0: 6578 7028 2d6e 702e 7069 2a66 6163 746f  exp(-np.pi*facto
-000241c0: 722a 7829 0a20 2020 2020 2020 2020 2020  r*x).           
-000241d0: 2023 2044 7261 7720 7570 7065 7220 7061   # Draw upper pa
-000241e0: 7274 2069 6e20 7265 7461 6e67 756c 6172  rt in retangular
-000241f0: 2063 6f6f 7264 696e 6174 6573 0a20 2020   coordinates.   
-00024200: 2020 2020 2020 2020 2078 7265 7420 3d20           xret = 
-00024210: 6d61 672a 6e70 2e63 6f73 2861 6e67 290a  mag*np.cos(ang).
-00024220: 2020 2020 2020 2020 2020 2020 7972 6574              yret
-00024230: 203d 206d 6167 2a6e 702e 7369 6e28 616e   = mag*np.sin(an
-00024240: 6729 0a20 2020 2020 2020 2020 2020 2078  g).            x
-00024250: 695f 6469 6374 5b7a 6574 615d 5b22 7831  i_dict[zeta]["x1
-00024260: 225d 203d 2078 7265 740a 2020 2020 2020  "] = xret.      
-00024270: 2020 2020 2020 7869 5f64 6963 745b 7a65        xi_dict[ze
-00024280: 7461 5d5b 2279 3122 5d20 3d20 7972 6574  ta]["y1"] = yret
-00024290: 0a20 2020 2020 2020 2020 2020 2023 2044  .            # D
-000242a0: 7261 7720 6c6f 7765 7220 7061 7274 2069  raw lower part i
-000242b0: 6e20 7265 7461 6e67 756c 6172 2063 6f6f  n retangular coo
-000242c0: 7264 696e 6174 6573 0a20 2020 2020 2020  rdinates.       
-000242d0: 2020 2020 2078 7265 7420 3d20 6d61 672a       xret = mag*
-000242e0: 6e70 2e63 6f73 282d 616e 6729 0a20 2020  np.cos(-ang).   
-000242f0: 2020 2020 2020 2020 2079 7265 7420 3d20           yret = 
-00024300: 6d61 672a 6e70 2e73 696e 282d 616e 6729  mag*np.sin(-ang)
-00024310: 0a20 2020 2020 2020 2020 2020 2078 695f  .            xi_
-00024320: 6469 6374 5b7a 6574 615d 5b22 7832 225d  dict[zeta]["x2"]
-00024330: 203d 2078 7265 740a 2020 2020 2020 2020   = xret.        
-00024340: 2020 2020 7869 5f64 6963 745b 7a65 7461      xi_dict[zeta
-00024350: 5d5b 2279 3222 5d20 3d20 7972 6574 0a20  ]["y2"] = yret. 
-00024360: 2020 2020 2020 2020 2020 2023 2041 6e6e             # Ann
-00024370: 6f74 6174 696f 6e0a 2020 2020 2020 2020  otation.        
-00024380: 2020 2020 616e 5f69 203d 2069 6e74 286c      an_i = int(l
-00024390: 656e 2878 7265 7429 2f32 2e35 290a 2020  en(xret)/2.5).  
-000243a0: 2020 2020 2020 2020 2020 616e 5f78 203d            an_x =
-000243b0: 2078 7265 745b 616e 5f69 5d0a 2020 2020   xret[an_i].    
-000243c0: 2020 2020 2020 2020 616e 5f79 203d 2079          an_y = y
-000243d0: 7265 745b 616e 5f69 5d0a 2020 2020 2020  ret[an_i].      
-000243e0: 2020 2020 2020 7869 5f64 6963 745b 7a65        xi_dict[ze
-000243f0: 7461 5d5b 226c 7822 5d20 3d20 7872 6574  ta]["lx"] = xret
-00024400: 5b61 6e5f 695d 0a20 2020 2020 2020 2020  [an_i].         
-00024410: 2020 2078 695f 6469 6374 5b7a 6574 615d     xi_dict[zeta]
-00024420: 5b22 6c79 225d 203d 2079 7265 745b 616e  ["ly"] = yret[an
-00024430: 5f69 5d0a 2020 2020 2020 2020 2020 2020  _i].            
-00024440: 7869 5f64 6963 745b 7a65 7461 5d5b 226c  xi_dict[zeta]["l
-00024450: 6162 656c 225d 203d 2073 7472 2872 6f75  abel"] = str(rou
-00024460: 6e64 287a 6574 612c 2032 2929 0a0a 2020  nd(zeta, 2))..  
-00024470: 2020 2020 2020 2320 6e61 7475 7261 6c20        # natural 
-00024480: 6672 6571 7565 6e63 7920 6c69 6e65 730a  frequency lines.
-00024490: 2020 2020 2020 2020 725f 616e 203d 2031          r_an = 1
-000244a0: 2e30 3735 0a20 2020 2020 2020 2066 6d74  .075.        fmt
-000244b0: 203d 2027 7b3a 312e 3166 7d27 2069 6620   = '{:1.1f}' if 
-000244c0: 6c65 6e28 776e 2920 3e20 3120 656c 7365  len(wn) > 1 else
-000244d0: 2027 7b3a 312e 3266 7d27 0a20 2020 2020   '{:1.2f}'.     
-000244e0: 2020 2064 6566 2067 6574 5f6c 6162 656c     def get_label
-000244f0: 286e 756d 293a 0a20 2020 2020 2020 2020  (num):.         
-00024500: 2020 2064 6566 2066 756e 6328 7573 655f     def func(use_
-00024510: 6c61 7465 783d 5472 7565 293a 0a20 2020  latex=True):.   
-00024520: 2020 2020 2020 2020 2020 2020 2069 6620               if 
-00024530: 7573 655f 6c61 7465 783a 0a20 2020 2020  use_latex:.     
-00024540: 2020 2020 2020 2020 2020 2020 2020 2072                 r
-00024550: 6574 7572 6e20 7222 245c 6672 6163 7b22  eturn r"$\frac{"
-00024560: 2b6e 756d 2b72 225c 7069 7d7b 547d 2422  +num+r"\pi}{T}$"
-00024570: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00024580: 2072 6574 7572 6e20 7374 7228 6e75 6d29   return str(num)
-00024590: 202b 2022 20cf 802f 5422 0a20 2020 2020   + " ../T".     
-000245a0: 2020 2020 2020 2072 6574 7572 6e20 6675         return fu
-000245b0: 6e63 0a20 2020 2020 2020 2066 6f72 2061  nc.        for a
-000245c0: 2069 6e20 776e 3a0a 2020 2020 2020 2020   in wn:.        
-000245d0: 2020 2020 2320 4361 6c63 756c 6174 6520      # Calculate 
-000245e0: 696e 2070 6f6c 6172 2063 6f6f 7264 696e  in polar coordin
-000245f0: 6174 6573 0a20 2020 2020 2020 2020 2020  ates.           
-00024600: 2078 203d 206e 702e 6c69 6e73 7061 6365   x = np.linspace
-00024610: 282d 6e70 2e70 692f 322c 206e 702e 7069  (-np.pi/2, np.pi
-00024620: 2f32 2c20 3230 3029 0a20 2020 2020 2020  /2, 200).       
-00024630: 2020 2020 2061 6e67 203d 206e 702e 7069       ang = np.pi
-00024640: 2a61 2a6e 702e 7369 6e28 7829 0a20 2020  *a*np.sin(x).   
-00024650: 2020 2020 2020 2020 206d 6167 203d 206e           mag = n
-00024660: 702e 6578 7028 2d6e 702e 7069 2a61 2a6e  p.exp(-np.pi*a*n
-00024670: 702e 636f 7328 7829 290a 2020 2020 2020  p.cos(x)).      
-00024680: 2020 2020 2020 2320 4472 6177 2069 6e20        # Draw in 
-00024690: 7265 7461 6e67 756c 6172 2063 6f6f 7264  retangular coord
-000246a0: 696e 6174 6573 0a20 2020 2020 2020 2020  inates.         
-000246b0: 2020 2078 7265 7420 3d20 6d61 672a 6e70     xret = mag*np
-000246c0: 2e63 6f73 2861 6e67 290a 2020 2020 2020  .cos(ang).      
-000246d0: 2020 2020 2020 7972 6574 203d 206d 6167        yret = mag
-000246e0: 2a6e 702e 7369 6e28 616e 6729 0a20 2020  *np.sin(ang).   
-000246f0: 2020 2020 2020 2020 2077 6e5f 6469 6374           wn_dict
-00024700: 5b61 5d5b 2278 225d 203d 2078 7265 740a  [a]["x"] = xret.
-00024710: 2020 2020 2020 2020 2020 2020 776e 5f64              wn_d
-00024720: 6963 745b 615d 5b22 7922 5d20 3d20 7972  ict[a]["y"] = yr
-00024730: 6574 0a20 2020 2020 2020 2020 2020 2023  et.            #
-00024740: 2041 6e6e 6f74 6174 696f 6e0a 2020 2020   Annotation.    
-00024750: 2020 2020 2020 2020 616e 676c 6520 3d20          angle = 
-00024760: 6e70 2e61 7263 7461 6e32 2879 7265 745b  np.arctan2(yret[
-00024770: 2d31 5d2c 2078 7265 745b 2d31 5d29 0a20  -1], xret[-1]). 
-00024780: 2020 2020 2020 2020 2020 2077 6e5f 6469             wn_di
-00024790: 6374 5b61 5d5b 226c 7822 5d20 3d20 725f  ct[a]["lx"] = r_
-000247a0: 616e 202a 206e 702e 636f 7328 616e 676c  an * np.cos(angl
-000247b0: 6529 0a20 2020 2020 2020 2020 2020 2077  e).            w
-000247c0: 6e5f 6469 6374 5b61 5d5b 226c 7922 5d20  n_dict[a]["ly"] 
-000247d0: 3d20 725f 616e 202a 206e 702e 7369 6e28  = r_an * np.sin(
-000247e0: 616e 676c 6529 0a20 2020 2020 2020 2020  angle).         
-000247f0: 2020 2069 6620 5420 6973 204e 6f6e 653a     if T is None:
-00024800: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00024810: 206e 756d 203d 2066 6d74 2e66 6f72 6d61   num = fmt.forma
-00024820: 7428 6129 0a20 2020 2020 2020 2020 2020  t(a).           
-00024830: 2020 2020 2061 6e20 3d20 7222 245c 6672       an = r"$\fr
-00024840: 6163 7b22 2b6e 756d 2b72 225c 7069 7d7b  ac{"+num+r"\pi}{
-00024850: 547d 2422 0a20 2020 2020 2020 2020 2020  T}$".           
-00024860: 2020 2020 2061 6e20 3d20 6765 745f 6c61       an = get_la
-00024870: 6265 6c28 6e75 6d29 0a20 2020 2020 2020  bel(num).       
-00024880: 2020 2020 2065 6c73 653a 0a20 2020 2020       else:.     
-00024890: 2020 2020 2020 2020 2020 2066 756e 6320             func 
-000248a0: 3d20 6c61 6d62 6461 2061 2c20 543a 206c  = lambda a, T: l
-000248b0: 616d 6264 6120 7573 655f 6c61 7465 783a  ambda use_latex:
-000248c0: 2022 252e 3266 2220 2520 2861 202a 206e   "%.2f" % (a * n
-000248d0: 702e 7069 202a 2054 290a 2020 2020 2020  p.pi * T).      
-000248e0: 2020 2020 2020 2020 2020 616e 203d 2066            an = f
-000248f0: 756e 6328 612c 2054 290a 2020 2020 2020  unc(a, T).      
-00024900: 2020 2020 2020 776e 5f64 6963 745b 615d        wn_dict[a]
-00024910: 5b22 6c61 6265 6c22 5d20 3d20 616e 0a0a  ["label"] = an..
-00024920: 2020 2020 2020 2020 2320 7065 616b 2074          # peak t
-00024930: 696d 6520 6c69 6e65 730a 2020 2020 2020  ime lines.      
-00024940: 2020 616e 676c 6573 203d 206e 702e 7069    angles = np.pi
-00024950: 202f 2074 700a 2020 2020 2020 2020 666f   / tp.        fo
-00024960: 7220 5f74 702c 2061 2069 6e20 7a69 7028  r _tp, a in zip(
-00024970: 7470 2c20 616e 676c 6573 293a 0a20 2020  tp, angles):.   
-00024980: 2020 2020 2020 2020 2074 705f 6469 6374           tp_dict
-00024990: 5b5f 7470 5d5b 2278 225d 203d 205b 302c  [_tp]["x"] = [0,
-000249a0: 206e 702e 636f 7328 6129 5d0a 2020 2020   np.cos(a)].    
-000249b0: 2020 2020 2020 2020 7470 5f64 6963 745b          tp_dict[
-000249c0: 5f74 705d 5b22 7922 5d20 3d20 5b30 2c20  _tp]["y"] = [0, 
-000249d0: 6e70 2e73 696e 2861 295d 0a20 2020 2020  np.sin(a)].     
-000249e0: 2020 2020 2020 2023 2041 6e6e 6f74 6174         # Annotat
-000249f0: 696f 6e0a 2020 2020 2020 2020 2020 2020  ion.            
-00024a00: 7470 5f64 6963 745b 5f74 705d 5b22 6c78  tp_dict[_tp]["lx
-00024a10: 225d 203d 2072 5f61 6e20 2a20 6e70 2e63  "] = r_an * np.c
-00024a20: 6f73 2861 290a 2020 2020 2020 2020 2020  os(a).          
-00024a30: 2020 7470 5f64 6963 745b 5f74 705d 5b22    tp_dict[_tp]["
-00024a40: 6c79 225d 203d 2072 5f61 6e20 2a20 6e70  ly"] = r_an * np
-00024a50: 2e73 696e 2861 290a 2020 2020 2020 2020  .sin(a).        
-00024a60: 2020 2020 616e 203d 205f 7470 2069 6620      an = _tp if 
-00024a70: 6e6f 7420 5420 656c 7365 205f 7470 202a  not T else _tp *
-00024a80: 2054 0a20 2020 2020 2020 2020 2020 2061   T.            a
-00024a90: 6e20 3d20 2225 2e32 6622 2025 2061 6e20  n = "%.2f" % an 
-00024aa0: 6966 206e 6f74 2054 2065 6c73 6520 2225  if not T else "%
-00024ab0: 2e32 6620 7322 2025 2061 6e0a 2020 2020  .2f s" % an.    
-00024ac0: 2020 2020 2020 2020 7470 5f64 6963 745b          tp_dict[
-00024ad0: 5f74 705d 5b22 6c61 6265 6c22 5d20 3d20  _tp]["label"] = 
-00024ae0: 616e 0a0a 2020 2020 2020 2020 2320 7365  an..        # se
-00024af0: 7474 6c69 6e67 2074 696d 6520 6c69 6e65  ttling time line
-00024b00: 730a 2020 2020 2020 2020 7261 6469 7573  s.        radius
-00024b10: 203d 206e 702e 6578 7028 2d34 202f 2074   = np.exp(-4 / t
-00024b20: 7329 0a20 2020 2020 2020 2074 6865 7461  s).        theta
-00024b30: 203d 206e 702e 6c69 6e73 7061 6365 2830   = np.linspace(0
-00024b40: 2c20 322a 6e70 2e70 692c 2034 3030 290a  , 2*np.pi, 400).
-00024b50: 2020 2020 2020 2020 6374 203d 206e 702e          ct = np.
-00024b60: 636f 7328 7468 6574 6129 0a20 2020 2020  cos(theta).     
-00024b70: 2020 2073 7420 3d20 6e70 2e73 696e 2874     st = np.sin(t
-00024b80: 6865 7461 290a 2020 2020 2020 2020 666f  heta).        fo
-00024b90: 7220 5f74 732c 2072 2069 6e20 7a69 7028  r _ts, r in zip(
-00024ba0: 7473 2c20 7261 6469 7573 293a 0a20 2020  ts, radius):.   
-00024bb0: 2020 2020 2020 2020 2074 735f 6469 6374           ts_dict
-00024bc0: 5b5f 7473 5d5b 2278 225d 203d 2072 202a  [_ts]["x"] = r *
-00024bd0: 2063 740a 2020 2020 2020 2020 2020 2020   ct.            
-00024be0: 7473 5f64 6963 745b 5f74 735d 5b22 7922  ts_dict[_ts]["y"
-00024bf0: 5d20 3d20 7220 2a20 7374 0a20 2020 2020  ] = r * st.     
-00024c00: 2020 2020 2020 2023 2041 6e6e 6f74 6174         # Annotat
-00024c10: 696f 6e0a 2020 2020 2020 2020 2020 2020  ion.            
-00024c20: 616e 5f69 203d 2069 6e74 286c 656e 2874  an_i = int(len(t
-00024c30: 6865 7461 292a 302e 3735 290a 2020 2020  heta)*0.75).    
-00024c40: 2020 2020 2020 2020 7473 5f64 6963 745b          ts_dict[
-00024c50: 5f74 735d 5b22 6c78 225d 203d 2074 735f  _ts]["lx"] = ts_
-00024c60: 6469 6374 5b5f 7473 5d5b 2278 225d 5b61  dict[_ts]["x"][a
-00024c70: 6e5f 695d 0a20 2020 2020 2020 2020 2020  n_i].           
-00024c80: 2074 735f 6469 6374 5b5f 7473 5d5b 226c   ts_dict[_ts]["l
-00024c90: 7922 5d20 3d20 7473 5f64 6963 745b 5f74  y"] = ts_dict[_t
-00024ca0: 735d 5b22 7922 5d5b 616e 5f69 5d0a 2020  s]["y"][an_i].  
-00024cb0: 2020 2020 2020 2020 2020 616e 203d 205f            an = _
-00024cc0: 7473 2069 6620 6e6f 7420 5420 656c 7365  ts if not T else
-00024cd0: 205f 7473 202a 2054 0a20 2020 2020 2020   _ts * T.       
-00024ce0: 2020 2020 2061 6e20 3d20 2225 2e32 6622       an = "%.2f"
-00024cf0: 2025 2061 6e20 6966 206e 6f74 2054 2065   % an if not T e
-00024d00: 6c73 6520 2225 2e32 6620 7322 2025 2061  lse "%.2f s" % a
-00024d10: 6e0a 2020 2020 2020 2020 2020 2020 7473  n.            ts
-00024d20: 5f64 6963 745b 5f74 735d 5b22 6c61 6265  _dict[_ts]["labe
-00024d30: 6c22 5d20 3d20 616e 0a0a 2020 2020 2020  l"] = an..      
-00024d40: 2020 7265 7475 726e 2078 695f 6469 6374    return xi_dict
-00024d50: 2c20 776e 5f64 6963 742c 2074 705f 6469  , wn_dict, tp_di
-00024d60: 6374 2c20 7473 5f64 6963 740a 0a0a 636c  ct, ts_dict...cl
-00024d70: 6173 7320 4172 726f 7773 4d69 7869 6e3a  ass ArrowsMixin:
-00024d80: 0a20 2020 2064 6566 205f 5f69 6e69 745f  .    def __init_
-00024d90: 5f28 7365 6c66 2c20 2a61 7267 732c 202a  _(self, *args, *
-00024da0: 2a6b 7761 7267 7329 3a0a 2020 2020 2020  *kwargs):.      
-00024db0: 2020 7375 7065 7228 292e 5f5f 696e 6974    super().__init
-00024dc0: 5f5f 282a 6172 6773 2c20 2a2a 6b77 6172  __(*args, **kwar
-00024dd0: 6773 290a 2020 2020 2020 2020 7365 6c66  gs).        self
-00024de0: 2e61 7272 6f77 7320 3d20 6b77 6172 6773  .arrows = kwargs
-00024df0: 2e67 6574 2822 6172 726f 7773 222c 2033  .get("arrows", 3
-00024e00: 290a 0a20 2020 2020 2020 2023 2050 6172  )..        # Par
-00024e10: 7365 2074 6865 2061 7272 6f77 7320 6b65  se the arrows ke
-00024e20: 7977 6f72 640a 2020 2020 2020 2020 6e70  yword.        np
-00024e30: 203d 2069 6d70 6f72 745f 6d6f 6475 6c65   = import_module
-00024e40: 2822 6e75 6d70 7922 290a 2020 2020 2020  ("numpy").      
-00024e50: 2020 6966 206e 6f74 2073 656c 662e 6172    if not self.ar
-00024e60: 726f 7773 3a0a 2020 2020 2020 2020 2020  rows:.          
-00024e70: 2020 7365 6c66 2e61 7272 6f77 5f6c 6f63    self.arrow_loc
-00024e80: 7320 3d20 5b5d 0a20 2020 2020 2020 2065  s = [].        e
-00024e90: 6c69 6620 6973 696e 7374 616e 6365 2873  lif isinstance(s
-00024ea0: 656c 662e 6172 726f 7773 2c20 696e 7429  elf.arrows, int)
-00024eb0: 3a0a 2020 2020 2020 2020 2020 2020 4e20  :.            N 
-00024ec0: 3d20 3320 6966 2073 656c 662e 6172 726f  = 3 if self.arro
-00024ed0: 7773 2069 7320 5472 7565 2065 6c73 6520  ws is True else 
-00024ee0: 7365 6c66 2e61 7272 6f77 730a 2020 2020  self.arrows.    
-00024ef0: 2020 2020 2020 2020 2320 5370 6163 6520          # Space 
-00024f00: 6172 726f 7773 206f 7574 2c20 7374 6172  arrows out, star
-00024f10: 7469 6e67 206d 6964 7761 7920 616c 6f6e  ting midway alon
-00024f20: 6720 6561 6368 2022 7265 6769 6f6e 220a  g each "region".
-00024f30: 2020 2020 2020 2020 2020 2020 7365 6c66              self
-00024f40: 2e61 7272 6f77 5f6c 6f63 7320 3d20 6e70  .arrow_locs = np
-00024f50: 2e6c 696e 7370 6163 6528 302e 352f 4e2c  .linspace(0.5/N,
-00024f60: 2031 202b 2030 2e35 2f4e 2c20 4e2c 2065   1 + 0.5/N, N, e
-00024f70: 6e64 706f 696e 743d 4661 6c73 6529 0a20  ndpoint=False). 
-00024f80: 2020 2020 2020 2065 6c69 6620 6973 696e         elif isin
-00024f90: 7374 616e 6365 2873 656c 662e 6172 726f  stance(self.arro
-00024fa0: 7773 2c20 286c 6973 742c 206e 702e 6e64  ws, (list, np.nd
-00024fb0: 6172 7261 7929 293a 0a20 2020 2020 2020  array)):.       
-00024fc0: 2020 2020 2073 656c 662e 6172 726f 775f       self.arrow_
-00024fd0: 6c6f 6373 203d 206e 702e 736f 7274 286e  locs = np.sort(n
-00024fe0: 702e 6174 6c65 6173 745f 3164 2873 656c  p.atleast_1d(sel
-00024ff0: 662e 6172 726f 7773 2929 0a20 2020 2020  f.arrows)).     
-00025000: 2020 2065 6c73 653a 0a20 2020 2020 2020     else:.       
-00025010: 2020 2020 2072 6169 7365 2056 616c 7565       raise Value
-00025020: 4572 726f 7228 2275 6e6b 6e6f 776e 206f  Error("unknown o
-00025030: 7220 756e 7375 7070 6f72 7465 6420 6172  r unsupported ar
-00025040: 726f 7720 6c6f 6361 7469 6f6e 2229 0a0a  row location")..
-00025050: 0a63 6c61 7373 204e 6963 686f 6c73 4c69  .class NicholsLi
-00025060: 6e65 5365 7269 6573 2841 7272 6f77 734d  neSeries(ArrowsM
-00025070: 6978 696e 2c20 436f 6d6d 6f6e 556e 6966  ixin, CommonUnif
-00025080: 6f72 6d45 7661 6c75 6174 696f 6e2c 204c  ormEvaluation, L
-00025090: 696e 6532 4442 6173 6553 6572 6965 7329  ine2DBaseSeries)
-000250a0: 3a0a 2020 2020 2222 2252 6570 7265 7365  :.    """Represe
-000250b0: 6e74 2061 204e 6963 686f 6c73 206c 696e  nt a Nichols lin
-000250c0: 6520 696e 2063 6f6e 7472 6f6c 2073 7973  e in control sys
-000250d0: 7465 6d20 706c 6f74 7469 6e67 2e0a 2020  tem plotting..  
-000250e0: 2020 2222 220a 2020 2020 5f61 6c6c 6f77    """.    _allow
-000250f0: 6564 5f6b 6579 7320 3d20 5b22 6172 726f  ed_keys = ["arro
-00025100: 7773 225d 0a0a 2020 2020 6465 6620 5f5f  ws"]..    def __
-00025110: 696e 6974 5f5f 280a 2020 2020 2020 2020  init__(.        
-00025120: 7365 6c66 2c20 7466 2c20 6f6c 5f70 6861  self, tf, ol_pha
-00025130: 7365 2c20 6f6c 5f6d 6167 2c20 636c 5f70  se, ol_mag, cl_p
-00025140: 6861 7365 2c20 636c 5f6d 6167 2c20 6f6d  hase, cl_mag, om
-00025150: 6567 615f 7261 6e67 652c 0a20 2020 2020  ega_range,.     
-00025160: 2020 206c 6162 656c 3d22 222c 202a 2a6b     label="", **k
-00025170: 7761 7267 730a 2020 2020 293a 0a20 2020  wargs.    ):.   
-00025180: 2020 2020 2073 7570 6572 2829 2e5f 5f69       super().__i
-00025190: 6e69 745f 5f28 2a2a 6b77 6172 6773 290a  nit__(**kwargs).
-000251a0: 2020 2020 2020 2020 7365 6c66 2e5f 7466          self._tf
-000251b0: 203d 2074 660a 2020 2020 2020 2020 7365   = tf.        se
-000251c0: 6c66 2e65 7870 7220 3d20 5475 706c 6528  lf.expr = Tuple(
-000251d0: 6f6c 5f70 6861 7365 2c20 6f6c 5f6d 6167  ol_phase, ol_mag
-000251e0: 2c20 636c 5f70 6861 7365 2c20 636c 5f6d  , cl_phase, cl_m
-000251f0: 6167 290a 2020 2020 2020 2020 7365 6c66  ag).        self
-00025200: 2e72 616e 6765 7320 3d20 5b6f 6d65 6761  .ranges = [omega
-00025210: 5f72 616e 6765 5d0a 2020 2020 2020 2020  _range].        
-00025220: 7365 6c66 2e6c 6162 656c 203d 206c 6162  self.label = lab
-00025230: 656c 0a20 2020 2020 2020 2073 656c 662e  el.        self.
-00025240: 5f66 6f72 6365 5f72 6561 6c5f 6576 616c  _force_real_eval
-00025250: 203d 2054 7275 650a 0a20 2020 2064 6566   = True..    def
-00025260: 205f 5f73 7472 5f5f 2873 656c 6629 3a0a   __str__(self):.
-00025270: 2020 2020 2020 2020 7265 7475 726e 2073          return s
-00025280: 656c 662e 5f73 7472 5f68 656c 7065 7228  elf._str_helper(
-00025290: 226e 6963 686f 6c73 206c 696e 6520 6f66  "nichols line of
-000252a0: 2025 7322 2025 2073 656c 662e 5f74 6629   %s" % self._tf)
-000252b0: 0a0a 2020 2020 6465 6620 6765 745f 6461  ..    def get_da
-000252c0: 7461 2873 656c 6629 3a0a 2020 2020 2020  ta(self):.      
-000252d0: 2020 2222 220a 2020 2020 2020 2020 5265    """.        Re
-000252e0: 7475 726e 730a 2020 2020 2020 2020 3d3d  turns.        ==
-000252f0: 3d3d 3d3d 3d0a 2020 2020 2020 2020 6f6d  =====.        om
-00025300: 6567 6120 3a20 6e70 2e6e 6461 7272 6179  ega : np.ndarray
-00025310: 0a20 2020 2020 2020 206f 6c5f 7068 6173  .        ol_phas
-00025320: 6520 3a20 6e70 2e6e 6461 7272 6179 0a20  e : np.ndarray. 
-00025330: 2020 2020 2020 206f 6c5f 6d61 6720 3a20         ol_mag : 
-00025340: 6e70 2e6e 6461 7272 6179 0a20 2020 2020  np.ndarray.     
-00025350: 2020 2063 6c5f 7068 6173 6520 3a20 6e70     cl_phase : np
-00025360: 2e6e 6461 7272 6179 0a20 2020 2020 2020  .ndarray.       
-00025370: 2063 6c5f 6d61 6720 3a20 6e70 2e6e 6461   cl_mag : np.nda
-00025380: 7272 6179 0a20 2020 2020 2020 2022 2222  rray.        """
-00025390: 0a20 2020 2020 2020 206e 7020 3d20 696d  .        np = im
-000253a0: 706f 7274 5f6d 6f64 756c 6528 276e 756d  port_module('num
-000253b0: 7079 2729 0a0a 2020 2020 2020 2020 7265  py')..        re
-000253c0: 7375 6c74 7320 3d20 7365 6c66 2e5f 6576  sults = self._ev
-000253d0: 616c 7561 7465 2829 0a20 2020 2020 2020  aluate().       
-000253e0: 2066 6f72 2069 2c20 7220 696e 2065 6e75   for i, r in enu
-000253f0: 6d65 7261 7465 2872 6573 756c 7473 293a  merate(results):
-00025400: 0a20 2020 2020 2020 2020 2020 205f 7265  .            _re
-00025410: 2c20 5f69 6d20 3d20 6e70 2e72 6561 6c28  , _im = np.real(
-00025420: 7229 2c20 6e70 2e69 6d61 6728 7229 0a20  r), np.imag(r). 
-00025430: 2020 2020 2020 2020 2020 205f 7265 5b6e             _re[n
-00025440: 702e 696e 7665 7274 286e 702e 6973 636c  p.invert(np.iscl
-00025450: 6f73 6528 5f69 6d2c 206e 702e 7a65 726f  ose(_im, np.zero
-00025460: 735f 6c69 6b65 285f 696d 2929 295d 203d  s_like(_im)))] =
-00025470: 206e 702e 6e61 6e0a 2020 2020 2020 2020   np.nan.        
-00025480: 2020 2020 7265 7375 6c74 735b 695d 203d      results[i] =
-00025490: 205f 7265 0a0a 2020 2020 2020 2020 6f6d   _re..        om
-000254a0: 6567 612c 206f 6c5f 7068 6173 652c 206f  ega, ol_phase, o
-000254b0: 6c5f 6d61 672c 2063 6c5f 7068 6173 652c  l_mag, cl_phase,
-000254c0: 2063 6c5f 6d61 6720 3d20 7265 7375 6c74   cl_mag = result
-000254d0: 730a 2020 2020 2020 2020 6f6c 5f6d 6167  s.        ol_mag
-000254e0: 203d 2032 3020 2a20 6e70 2e6c 6f67 3130   = 20 * np.log10
-000254f0: 286f 6c5f 6d61 6729 0a20 2020 2020 2020  (ol_mag).       
-00025500: 206f 6c5f 7068 6173 6520 3d20 6e70 2e64   ol_phase = np.d
-00025510: 6567 7265 6573 2875 6e77 7261 7028 6f6c  egrees(unwrap(ol
-00025520: 5f70 6861 7365 2929 0a20 2020 2020 2020  _phase)).       
-00025530: 2063 6c5f 6d61 6720 3d20 3230 202a 206e   cl_mag = 20 * n
-00025540: 702e 6c6f 6731 3028 636c 5f6d 6167 290a  p.log10(cl_mag).
-00025550: 2020 2020 2020 2020 2320 544f 444f 3a20          # TODO: 
-00025560: 6966 2074 6865 206e 6963 686f 6c73 206c  if the nichols l
-00025570: 696e 6520 7061 7373 6573 2074 6872 6f75  ine passes throu
-00025580: 6768 2074 6865 2070 6f69 6e74 2028 2d31  gh the point (-1
-00025590: 3830 2064 6567 2c20 3020 6442 290a 2020  80 deg, 0 dB).  
-000255a0: 2020 2020 2020 2320 2869 6e20 6f70 656e        # (in open
-000255b0: 206c 6f6f 7029 2c20 7468 656e 2074 6865   loop), then the
-000255c0: 2072 6573 756c 7469 6e67 2063 6c6f 7365   resulting close
-000255d0: 642d 6c6f 6f70 2070 6861 7365 2069 7320  d-loop phase is 
-000255e0: 7772 6f6e 672e 2057 6879 3f0a 2020 2020  wrong. Why?.    
-000255f0: 2020 2020 2320 466f 7220 6578 616d 706c      # For exampl
-00025600: 652c 2074 6573 7420 7769 7468 2074 6869  e, test with thi
-00025610: 7320 7379 7374 656d 3a0a 2020 2020 2020  s system:.      
-00025620: 2020 2320 7466 203d 2028 3520 2a20 2873    # tf = (5 * (s
-00025630: 202d 2031 2929 202f 2028 732a 2a32 202a   - 1)) / (s**2 *
-00025640: 2028 732a 2a32 202b 2073 202b 2034 2929   (s**2 + s + 4))
-00025650: 0a20 2020 2020 2020 2063 6c5f 7068 6173  .        cl_phas
-00025660: 6520 3d20 6e70 2e64 6567 7265 6573 2875  e = np.degrees(u
-00025670: 6e77 7261 7028 636c 5f70 6861 7365 2929  nwrap(cl_phase))
-00025680: 0a20 2020 2020 2020 2072 6574 7572 6e20  .        return 
-00025690: 6f6d 6567 612c 206f 6c5f 7068 6173 652c  omega, ol_phase,
-000256a0: 206f 6c5f 6d61 672c 2063 6c5f 7068 6173   ol_mag, cl_phas
-000256b0: 652c 2063 6c5f 6d61 670a 0a0a 636c 6173  e, cl_mag...clas
-000256c0: 7320 436f 6e74 726f 6c42 6173 6553 6572  s ControlBaseSer
-000256d0: 6965 7328 4c69 6e65 3244 4261 7365 5365  ies(Line2DBaseSe
-000256e0: 7269 6573 293a 0a20 2020 2022 2222 4120  ries):.    """A 
-000256f0: 6261 7365 2073 6572 6965 7320 666f 7220  base series for 
-00025700: 636c 6173 7365 7320 7468 6174 2061 7265  classes that are
-00025710: 2067 6f69 6e67 2074 6f20 7072 6f64 7563   going to produc
-00025720: 6520 6e75 6d65 7269 6361 6c0a 2020 2020  e numerical.    
-00025730: 6461 7461 2075 7369 6e67 2074 6865 2060  data using the `
-00025740: 6063 6f6e 7472 6f6c 6060 206d 6f64 756c  `control`` modul
-00025750: 6520 666f 7220 636f 6e74 726f 6c2d 7379  e for control-sy
-00025760: 7374 656d 2070 6c6f 7474 696e 672e 0a20  stem plotting.. 
-00025770: 2020 2054 686f 7365 2073 6572 6965 7320     Those series 
-00025780: 7265 7072 6573 656e 7420 6120 5349 534f  represent a SISO
-00025790: 2073 7973 7465 6d2e 0a20 2020 2022 2222   system..    """
-000257a0: 0a0a 2020 2020 5f61 6c6c 6f77 6564 5f6b  ..    _allowed_k
-000257b0: 6579 7320 3d20 5b22 636f 6e74 726f 6c5f  eys = ["control_
-000257c0: 6b77 225d 0a0a 2020 2020 6465 6620 5f5f  kw"]..    def __
-000257d0: 696e 6974 5f5f 2873 656c 662c 202a 6172  init__(self, *ar
-000257e0: 6773 2c20 2a2a 6b77 6172 6773 293a 0a20  gs, **kwargs):. 
-000257f0: 2020 2020 2020 2073 7570 6572 2829 2e5f         super()._
-00025800: 5f69 6e69 745f 5f28 2a2a 6b77 6172 6773  _init__(**kwargs
-00025810: 290a 2020 2020 2020 2020 5472 616e 7366  ).        Transf
-00025820: 6572 4675 6e63 7469 6f6e 203d 2073 796d  erFunction = sym
-00025830: 7079 2e70 6879 7369 6373 2e63 6f6e 7472  py.physics.contr
-00025840: 6f6c 2e6c 7469 2e54 7261 6e73 6665 7246  ol.lti.TransferF
-00025850: 756e 6374 696f 6e0a 2020 2020 2020 2020  unction.        
-00025860: 6e70 203d 2069 6d70 6f72 745f 6d6f 6475  np = import_modu
-00025870: 6c65 2827 6e75 6d70 7927 290a 2020 2020  le('numpy').    
-00025880: 2020 2020 7370 203d 2069 6d70 6f72 745f      sp = import_
-00025890: 6d6f 6475 6c65 2827 7363 6970 7927 290a  module('scipy').
-000258a0: 2020 2020 2020 2020 6374 203d 2069 6d70          ct = imp
-000258b0: 6f72 745f 6d6f 6475 6c65 2827 636f 6e74  ort_module('cont
-000258c0: 726f 6c27 290a 2020 2020 2020 2020 6c61  rol').        la
-000258d0: 6265 6c20 3d20 6b77 6172 6773 2e67 6574  bel = kwargs.get
-000258e0: 2822 6c61 6265 6c22 2c20 2222 290a 2020  ("label", "").  
-000258f0: 2020 2020 2020 7466 203d 2061 7267 735b        tf = args[
-00025900: 305d 0a0a 2020 2020 2020 2020 6966 2069  0]..        if i
-00025910: 7369 6e73 7461 6e63 6528 7466 2c20 2845  sinstance(tf, (E
-00025920: 7870 722c 2054 7261 6e73 6665 7246 756e  xpr, TransferFun
-00025930: 6374 696f 6e29 293a 0a20 2020 2020 2020  ction)):.       
-00025940: 2020 2020 2069 6620 6973 696e 7374 616e       if isinstan
-00025950: 6365 2874 662c 2045 7870 7229 3a0a 2020  ce(tf, Expr):.  
-00025960: 2020 2020 2020 2020 2020 2020 2020 7061                pa
-00025970: 7261 6d73 5f66 7320 3d20 7365 7428 7365  rams_fs = set(se
-00025980: 6c66 2e70 6172 616d 732e 6b65 7973 2829  lf.params.keys()
-00025990: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
-000259a0: 2020 6673 203d 2074 662e 6672 6565 5f73    fs = tf.free_s
-000259b0: 796d 626f 6c73 2e64 6966 6665 7265 6e63  ymbols.differenc
-000259c0: 6528 7061 7261 6d73 5f66 7329 0a20 2020  e(params_fs).   
-000259d0: 2020 2020 2020 2020 2020 2020 2066 7320               fs 
-000259e0: 3d20 6673 2e70 6f70 2829 2069 6620 6c65  = fs.pop() if le
-000259f0: 6e28 6673 2920 3e20 3020 656c 7365 2073  n(fs) > 0 else s
-00025a00: 796d 626f 6c73 2822 7322 290a 2020 2020  ymbols("s").    
-00025a10: 2020 2020 2020 2020 2020 2020 7466 203d              tf =
-00025a20: 2054 7261 6e73 6665 7246 756e 6374 696f   TransferFunctio
-00025a30: 6e2e 6672 6f6d 5f72 6174 696f 6e61 6c5f  n.from_rational_
-00025a40: 6578 7072 6573 7369 6f6e 2874 662c 2066  expression(tf, f
-00025a50: 7329 0a20 2020 2020 2020 2020 2020 2073  s).            s
-00025a60: 656c 662e 5f65 7870 7220 3d20 7466 0a20  elf._expr = tf. 
-00025a70: 2020 2020 2020 2020 2020 2073 656c 662e             self.
-00025a80: 5f63 6f6e 7472 6f6c 5f74 6620 3d20 4e6f  _control_tf = No
-00025a90: 6e65 0a20 2020 2020 2020 2020 2020 2069  ne.            i
-00025aa0: 6620 6e6f 7420 7365 6c66 2e69 735f 696e  f not self.is_in
-00025ab0: 7465 7261 6374 6976 653a 0a20 2020 2020  teractive:.     
-00025ac0: 2020 2020 2020 2020 2020 2073 656c 662e             self.
-00025ad0: 5f63 6f6e 7472 6f6c 5f74 6620 3d20 7466  _control_tf = tf
-00025ae0: 5f74 6f5f 636f 6e74 726f 6c28 7466 290a  _to_control(tf).
-00025af0: 2020 2020 2020 2020 2020 2020 7365 6c66              self
-00025b00: 2e5f 6c61 6265 6c20 3d20 7374 7228 7365  ._label = str(se
-00025b10: 6c66 2e65 7870 7229 2069 6620 6c61 6265  lf.expr) if labe
-00025b20: 6c20 6973 204e 6f6e 6520 656c 7365 206c  l is None else l
-00025b30: 6162 656c 0a20 2020 2020 2020 2020 2020  abel.           
-00025b40: 2073 656c 662e 5f6c 6174 6578 5f6c 6162   self._latex_lab
-00025b50: 656c 203d 206c 6174 6578 2873 656c 662e  el = latex(self.
-00025b60: 6578 7072 2920 6966 206c 6162 656c 2069  expr) if label i
-00025b70: 7320 4e6f 6e65 2065 6c73 6520 6c61 6265  s None else labe
-00025b80: 6c0a 2020 2020 2020 2020 656c 6966 2069  l.        elif i
-00025b90: 7369 6e73 7461 6e63 6528 7466 2c20 2873  sinstance(tf, (s
-00025ba0: 702e 7369 676e 616c 2e54 7261 6e73 6665  p.signal.Transfe
-00025bb0: 7246 756e 6374 696f 6e2c 2063 742e 5472  rFunction, ct.Tr
-00025bc0: 616e 7366 6572 4675 6e63 7469 6f6e 2929  ansferFunction))
-00025bd0: 3a0a 2020 2020 2020 2020 2020 2020 7365  :.            se
-00025be0: 6c66 2e5f 6578 7072 203d 204e 6f6e 650a  lf._expr = None.
-00025bf0: 2020 2020 2020 2020 2020 2020 7365 6c66              self
-00025c00: 2e5f 6c61 6265 6c20 3d20 6c61 6265 6c0a  ._label = label.
-00025c10: 2020 2020 2020 2020 2020 2020 7365 6c66              self
-00025c20: 2e5f 6c61 7465 785f 6c61 6265 6c20 3d20  ._latex_label = 
-00025c30: 6c61 6265 6c0a 2020 2020 2020 2020 2020  label.          
-00025c40: 2020 6966 206c 6162 656c 2069 7320 4e6f    if label is No
-00025c50: 6e65 3a0a 2020 2020 2020 2020 2020 2020  ne:.            
-00025c60: 2020 2020 7320 3d20 7379 6d62 6f6c 7328      s = symbols(
-00025c70: 2273 2220 6966 2074 662e 6474 2069 7320  "s" if tf.dt is 
-00025c80: 4e6f 6e65 2065 6c73 6520 227a 2229 0a20  None else "z"). 
-00025c90: 2020 2020 2020 2020 2020 2020 2020 206e                 n
-00025ca0: 203d 2074 662e 6e75 6d5b 305d 5b30 5d20   = tf.num[0][0] 
-00025cb0: 6966 2069 7369 6e73 7461 6e63 6528 6374  if isinstance(ct
-00025cc0: 2e54 7261 6e73 6665 7246 756e 6374 696f  .TransferFunctio
-00025cd0: 6e29 2065 6c73 6520 7466 2e6e 756d 0a20  n) else tf.num. 
-00025ce0: 2020 2020 2020 2020 2020 2020 2020 2064                 d
-00025cf0: 203d 2074 662e 6465 6e5b 305d 5b30 5d20   = tf.den[0][0] 
-00025d00: 6966 2069 7369 6e73 7461 6e63 6528 6374  if isinstance(ct
-00025d10: 2e54 7261 6e73 6665 7246 756e 6374 696f  .TransferFunctio
-00025d20: 6e29 2065 6c73 6520 7466 2e64 656e 0a20  n) else tf.den. 
-00025d30: 2020 2020 2020 2020 2020 2020 2020 2065                 e
-00025d40: 7870 7220 3d20 506f 6c79 2e66 726f 6d5f  xpr = Poly.from_
-00025d50: 6c69 7374 286e 2c20 7329 202f 2050 6f6c  list(n, s) / Pol
-00025d60: 792e 6672 6f6d 5f6c 6973 7428 642c 2073  y.from_list(d, s
-00025d70: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
-00025d80: 2020 7365 6c66 2e5f 6c61 6265 6c20 3d20    self._label = 
-00025d90: 7374 7228 6578 7072 290a 2020 2020 2020  str(expr).      
-00025da0: 2020 2020 2020 2020 2020 7365 6c66 2e5f            self._
-00025db0: 6c61 7465 785f 6c61 6265 6c20 3d20 6c61  latex_label = la
-00025dc0: 7465 7828 6578 7072 290a 2020 2020 2020  tex(expr).      
-00025dd0: 2020 2020 2020 6966 2069 7369 6e73 7461        if isinsta
-00025de0: 6e63 6528 7466 2c20 7370 2e73 6967 6e61  nce(tf, sp.signa
-00025df0: 6c2e 5472 616e 7366 6572 4675 6e63 7469  l.TransferFuncti
-00025e00: 6f6e 293a 0a20 2020 2020 2020 2020 2020  on):.           
-00025e10: 2020 2020 2073 656c 662e 5f63 6f6e 7472       self._contr
-00025e20: 6f6c 5f74 6620 3d20 7466 5f74 6f5f 636f  ol_tf = tf_to_co
-00025e30: 6e74 726f 6c28 7466 290a 2020 2020 2020  ntrol(tf).      
-00025e40: 2020 2020 2020 656c 7365 3a0a 2020 2020        else:.    
-00025e50: 2020 2020 2020 2020 2020 2020 7365 6c66              self
-00025e60: 2e5f 636f 6e74 726f 6c5f 7466 203d 2074  ._control_tf = t
-00025e70: 660a 2020 2020 2020 2020 656c 7365 3a0a  f.        else:.
-00025e80: 2020 2020 2020 2020 2020 2020 7261 6973              rais
-00025e90: 6520 5479 7065 4572 726f 7228 0a20 2020  e TypeError(.   
-00025ea0: 2020 2020 2020 2020 2020 2020 2022 5472               "Tr
-00025eb0: 616e 7366 6572 2066 756e 6374 696f 6e27  ansfer function'
-00025ec0: 7320 7479 7065 206e 6f74 2072 6563 6f67  s type not recog
-00025ed0: 6e69 7a65 642e 2022 0a20 2020 2020 2020  nized. ".       
-00025ee0: 2020 2020 2020 2020 2022 5265 6365 6976           "Receiv
-00025ef0: 6564 3a20 2220 2b20 7374 7228 7479 7065  ed: " + str(type
-00025f00: 2874 6629 290a 2020 2020 2020 2020 2020  (tf)).          
-00025f10: 2020 290a 0a20 2020 2020 2020 2073 656c    )..        sel
-00025f20: 662e 5f63 6f6e 7472 6f6c 5f6b 7720 3d20  f._control_kw = 
-00025f30: 6b77 6172 6773 2e67 6574 2822 636f 6e74  kwargs.get("cont
-00025f40: 726f 6c5f 6b77 222c 207b 7d29 0a0a 2020  rol_kw", {})..  
-00025f50: 2020 6465 6620 5f63 6865 636b 5f66 7328    def _check_fs(
-00025f60: 7365 6c66 293a 0a20 2020 2020 2020 2022  self):.        "
-00025f70: 2222 2043 6865 636b 7320 6966 2074 6865  "" Checks if the
-00025f80: 7265 2061 7265 2065 6e6f 6768 2070 6172  re are enogh par
-00025f90: 616d 6574 6572 7320 616e 6420 6672 6565  ameters and free
-00025fa0: 2073 796d 626f 6c73 2e0a 2020 2020 2020   symbols..      
-00025fb0: 2020 2222 220a 2020 2020 2020 2020 6673    """.        fs
-00025fc0: 203d 2073 6574 2829 0a20 2020 2020 2020   = set().       
-00025fd0: 2069 6620 7365 6c66 2e5f 6578 7072 3a0a   if self._expr:.
-00025fe0: 2020 2020 2020 2020 2020 2020 6673 203d              fs =
-00025ff0: 207b 7365 6c66 2e5f 6578 7072 2e76 6172   {self._expr.var
-00026000: 7d0a 2020 2020 2020 2020 7261 6e67 6573  }.        ranges
-00026010: 2c20 7061 7261 6d73 203d 2073 656c 662e  , params = self.
-00026020: 7261 6e67 6573 2c20 7365 6c66 2e70 6172  ranges, self.par
-00026030: 616d 730a 0a20 2020 2020 2020 2023 2066  ams..        # f
-00026040: 726f 6d20 7468 6520 6578 7072 6573 7369  rom the expressi
-00026050: 6f6e 2773 2066 7265 6520 7379 6d62 6f6c  on's free symbol
-00026060: 732c 2072 656d 6f76 6520 7468 6520 6f6e  s, remove the on
-00026070: 6573 2075 7365 6420 696e 0a20 2020 2020  es used in.     
-00026080: 2020 2023 2074 6865 2070 6172 616d 6574     # the paramet
-00026090: 6572 7320 616e 6420 7468 6520 7261 6e67  ers and the rang
-000260a0: 6573 0a20 2020 2020 2020 2066 7320 3d20  es.        fs = 
-000260b0: 6673 2e64 6966 6665 7265 6e63 6528 7061  fs.difference(pa
-000260c0: 7261 6d73 2e6b 6579 7328 2929 0a20 2020  rams.keys()).   
-000260d0: 2020 2020 2069 6620 7261 6e67 6573 2069       if ranges i
-000260e0: 7320 6e6f 7420 4e6f 6e65 3a0a 2020 2020  s not None:.    
-000260f0: 2020 2020 2020 2020 6673 203d 2066 732e          fs = fs.
-00026100: 6469 6666 6572 656e 6365 285b 725b 305d  difference([r[0]
-00026110: 2066 6f72 2072 2069 6e20 7261 6e67 6573   for r in ranges
-00026120: 5d29 0a0a 2020 2020 2020 2020 6966 206c  ])..        if l
-00026130: 656e 2866 7329 203e 2031 3a0a 2020 2020  en(fs) > 1:.    
-00026140: 2020 2020 2020 2020 7261 6973 6520 5661          raise Va
-00026150: 6c75 6545 7272 6f72 280a 2020 2020 2020  lueError(.      
-00026160: 2020 2020 2020 2020 2020 2249 6e63 6f6d            "Incom
-00026170: 7061 7469 626c 6520 6578 7072 6573 7369  patible expressi
-00026180: 6f6e 2061 6e64 2070 6172 616d 6574 6572  on and parameter
-00026190: 732e 5c6e 220a 2020 2020 2020 2020 2020  s.\n".          
-000261a0: 2020 2020 2020 2b20 2253 7065 6369 6679        + "Specify
-000261b0: 2077 6861 7420 7468 6573 6520 7379 6d62   what these symb
-000261c0: 6f6c 7320 7265 7072 6573 656e 743a 207b  ols represent: {
-000261d0: 7d5c 6e22 2e66 6f72 6d61 7428 6673 290a  }\n".format(fs).
-000261e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000261f0: 2b20 2241 7265 2074 6865 7920 7261 6e67  + "Are they rang
-00026200: 6573 206f 7220 7061 7261 6d65 7465 7273  es or parameters
-00026210: 3f22 0a20 2020 2020 2020 2020 2020 2029  ?".            )
-00026220: 0a0a 2020 2020 2020 2020 2320 7665 7269  ..        # veri
-00026230: 6679 2074 6861 7420 616c 6c20 7379 6d62  fy that all symb
-00026240: 6f6c 7320 6172 6520 6b6e 6f77 6e20 2874  ols are known (t
-00026250: 6865 7920 6569 7468 6572 2072 6570 7265  hey either repre
-00026260: 7365 6e74 2070 6c6f 7474 696e 670a 2020  sent plotting.  
-00026270: 2020 2020 2020 2320 7261 6e67 6573 206f        # ranges o
-00026280: 7220 7061 7261 6d65 7465 7273 290a 2020  r parameters).  
-00026290: 2020 2020 2020 7261 6e67 655f 7379 6d62        range_symb
-000262a0: 6f6c 7320 3d20 5b72 5b30 5d20 666f 7220  ols = [r[0] for 
-000262b0: 7220 696e 2072 616e 6765 735d 0a20 2020  r in ranges].   
-000262c0: 2020 2020 2066 6f72 2072 2069 6e20 7261       for r in ra
-000262d0: 6e67 6573 3a0a 2020 2020 2020 2020 2020  nges:.          
-000262e0: 2020 6673 203d 2073 6574 2829 2e75 6e69    fs = set().uni
-000262f0: 6f6e 282a 5b65 2e66 7265 655f 7379 6d62  on(*[e.free_symb
-00026300: 6f6c 7320 666f 7220 6520 696e 2072 5b31  ols for e in r[1
-00026310: 3a5d 5d29 0a20 2020 2020 2020 2020 2020  :]]).           
-00026320: 2069 6620 616e 7928 7420 696e 2066 7320   if any(t in fs 
-00026330: 666f 7220 7420 696e 2072 616e 6765 5f73  for t in range_s
-00026340: 796d 626f 6c73 293a 0a20 2020 2020 2020  ymbols):.       
-00026350: 2020 2020 2020 2020 2072 6169 7365 2056           raise V
-00026360: 616c 7565 4572 726f 7228 2252 616e 6765  alueError("Range
-00026370: 2073 796d 626f 6c73 2063 616e 2774 2062   symbols can't b
-00026380: 6520 696e 636c 7564 6564 2069 6e74 6f20  e included into 
-00026390: 220a 2020 2020 2020 2020 2020 2020 2020  ".              
-000263a0: 2020 2020 2020 226d 696e 696d 756d 2061        "minimum a
-000263b0: 6e64 206d 6178 696d 756d 206f 6620 6120  nd maximum of a 
-000263c0: 7261 6e67 652e 2022 0a20 2020 2020 2020  range. ".       
-000263d0: 2020 2020 2020 2020 2020 2020 2022 5265               "Re
-000263e0: 6365 6976 6564 2072 616e 6765 3a20 2573  ceived range: %s
-000263f0: 2220 2520 7374 7228 7229 290a 2020 2020  " % str(r)).    
-00026400: 2020 2020 2020 2020 7265 6d61 696e 696e          remainin
-00026410: 675f 6673 203d 2066 732e 6469 6666 6572  g_fs = fs.differ
-00026420: 656e 6365 2870 6172 616d 732e 6b65 7973  ence(params.keys
-00026430: 2829 290a 2020 2020 2020 2020 2020 2020  ()).            
-00026440: 6966 206c 656e 2872 656d 6169 6e69 6e67  if len(remaining
-00026450: 5f66 7329 203e 2030 3a0a 2020 2020 2020  _fs) > 0:.      
-00026460: 2020 2020 2020 2020 2020 7261 6973 6520            raise 
-00026470: 5661 6c75 6545 7272 6f72 280a 2020 2020  ValueError(.    
+00003720: 7061 7261 6d73 203d 205f 7061 7261 6d73  params = _params
+00003730: 203d 206b 7761 7267 732e 6765 7428 2270   = kwargs.get("p
+00003740: 6172 616d 7322 2c20 6469 6374 2829 290a  arams", dict()).
+00003750: 2020 2020 2020 2020 2320 7468 6973 2069          # this i
+00003760: 7320 7573 6564 2062 7920 7370 622e 696e  s used by spb.in
+00003770: 7465 7261 6374 6976 6520 746f 206b 6565  teractive to kee
+00003780: 7020 7472 6163 6b20 6f66 206d 756c 7469  p track of multi
+00003790: 2d76 616c 7565 7320 7769 6467 6574 730a  -values widgets.
+000037a0: 2020 2020 2020 2020 7365 6c66 2e5f 6f72          self._or
+000037b0: 6967 696e 616c 5f70 6172 616d 7320 3d20  iginal_params = 
+000037c0: 5f70 6172 616d 732e 636f 7079 2829 0a20  _params.copy(). 
+000037d0: 2020 2020 2020 2069 6620 6e6f 7420 6973         if not is
+000037e0: 696e 7374 616e 6365 285f 7061 7261 6d73  instance(_params
+000037f0: 2c20 6469 6374 293a 0a20 2020 2020 2020  , dict):.       
+00003800: 2020 2020 2072 6169 7365 2054 7970 6545       raise TypeE
+00003810: 7272 6f72 280a 2020 2020 2020 2020 2020  rror(.          
+00003820: 2020 2020 2020 2260 7061 7261 6d73 6020        "`params` 
+00003830: 6d75 7374 2062 6520 6120 6469 6374 696f  must be a dictio
+00003840: 6e61 7279 206d 6170 7069 6e67 2073 796d  nary mapping sym
+00003850: 626f 6c73 2022 0a20 2020 2020 2020 2020  bols ".         
+00003860: 2020 2020 2020 2022 746f 206e 756d 6572         "to numer
+00003870: 6963 2076 616c 7565 732e 2229 0a20 2020  ic values.").   
+00003880: 2020 2020 2069 6620 6c65 6e28 5f70 6172       if len(_par
+00003890: 616d 7329 203e 2030 3a0a 2020 2020 2020  ams) > 0:.      
+000038a0: 2020 2020 2020 7365 6c66 2e69 735f 696e        self.is_in
+000038b0: 7465 7261 6374 6976 6520 3d20 5472 7565  teractive = True
+000038c0: 0a20 2020 2020 2020 2020 2020 2069 6620  .            if 
+000038d0: 616e 7928 6973 696e 7374 616e 6365 2874  any(isinstance(t
+000038e0: 2c20 286c 6973 742c 2074 7570 6c65 2929  , (list, tuple))
+000038f0: 2066 6f72 2074 2069 6e20 5f70 6172 616d   for t in _param
+00003900: 732e 6b65 7973 2829 293a 0a20 2020 2020  s.keys()):.     
+00003910: 2020 2020 2020 2020 2020 2023 204e 4f54             # NOT
+00003920: 453a 2061 7420 7468 6973 2070 6f69 6e74  E: at this point
+00003930: 2c20 7061 7261 6d73 2069 7320 6120 6469  , params is a di
+00003940: 6374 696f 6e61 7279 2077 6974 6820 7468  ctionary with th
+00003950: 650a 2020 2020 2020 2020 2020 2020 2020  e.              
+00003960: 2020 2320 666f 6c6c 6f77 696e 6766 6f72    # followingfor
+00003970: 6d3a 0a20 2020 2020 2020 2020 2020 2020  m:.             
+00003980: 2020 2023 2020 2020 207b 2073 796d 6231     #     { symb1
+00003990: 3a20 2831 2c20 302c 2031 302c 2022 6c61  : (1, 0, 10, "la
+000039a0: 6265 6c22 292c 0a20 2020 2020 2020 2020  bel"),.         
+000039b0: 2020 2020 2020 2023 2020 2020 2020 2073         #       s
+000039c0: 796d 6232 3a20 466c 6f61 7453 6c69 6465  ymb2: FloatSlide
+000039d0: 7228 7661 6c75 653d 322c 206d 696e 3d30  r(value=2, min=0
+000039e0: 2c20 6d61 783d 3529 2c0a 2020 2020 2020  , max=5),.      
+000039f0: 2020 2020 2020 2020 2020 2320 2020 2020            #     
+00003a00: 2020 2873 796d 6233 2c20 7379 6d62 3429    (symb3, symb4)
+00003a10: 3a20 5261 6e67 6553 6c69 6465 7228 2e2e  : RangeSlider(..
+00003a20: 2e29 7d0a 2020 2020 2020 2020 2020 2020  .)}.            
+00003a30: 2020 2020 2320 4e65 6564 2074 6f20 6578      # Need to ex
+00003a40: 7472 6163 7420 2873 796d 6233 2c20 7379  tract (symb3, sy
+00003a50: 6d62 3429 2073 6f20 7468 6174 2073 656c  mb4) so that sel
+00003a60: 662e 7061 7261 6d2e 6b65 7973 2829 0a20  f.param.keys(). 
+00003a70: 2020 2020 2020 2020 2020 2020 2020 2023                 #
+00003a80: 2063 6f6e 7461 696e 7320 6f6e 6c79 2073   contains only s
+00003a90: 796d 626f 6c73 0a20 2020 2020 2020 2020  ymbols.         
+00003aa0: 2020 2020 2020 206e 6577 5f70 6172 616d         new_param
+00003ab0: 7320 3d20 7b7d 0a20 2020 2020 2020 2020  s = {}.         
+00003ac0: 2020 2020 2020 2066 6f72 206b 2c20 7620         for k, v 
+00003ad0: 696e 205f 7061 7261 6d73 2e69 7465 6d73  in _params.items
+00003ae0: 2829 3a0a 2020 2020 2020 2020 2020 2020  ():.            
+00003af0: 2020 2020 2020 2020 6966 2069 7369 6e73          if isins
+00003b00: 7461 6e63 6528 6b2c 2028 6c69 7374 2c20  tance(k, (list, 
+00003b10: 7475 706c 6529 293a 0a20 2020 2020 2020  tuple)):.       
+00003b20: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00003b30: 2066 6f72 2073 2069 6e20 6b3a 0a20 2020   for s in k:.   
+00003b40: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00003b50: 2020 2020 2020 2020 206e 6577 5f70 6172           new_par
+00003b60: 616d 735b 735d 203d 2076 0a20 2020 2020  ams[s] = v.     
+00003b70: 2020 2020 2020 2020 2020 2020 2020 2065                 e
+00003b80: 6c73 653a 0a20 2020 2020 2020 2020 2020  lse:.           
+00003b90: 2020 2020 2020 2020 2020 2020 206e 6577               new
+00003ba0: 5f70 6172 616d 735b 6b5d 203d 2076 0a20  _params[k] = v. 
+00003bb0: 2020 2020 2020 2020 2020 2020 2020 2073                 s
+00003bc0: 656c 662e 5f70 6172 616d 7320 3d20 6e65  elf._params = ne
+00003bd0: 775f 7061 7261 6d73 0a20 2020 2020 2020  w_params.       
+00003be0: 2020 2020 2020 2020 2023 204e 4f54 453a           # NOTE:
+00003bf0: 2044 6174 6120 7365 7269 6573 2061 7265   Data series are
+00003c00: 2075 6e61 626c 6520 746f 2065 7874 7261   unable to extra
+00003c10: 6374 206e 756d 6572 6963 616c 2076 616c  ct numerical val
+00003c20: 7565 730a 2020 2020 2020 2020 2020 2020  ues.            
+00003c30: 2020 2020 2320 6672 6f6d 2077 6964 6765      # from widge
+00003c40: 7473 2e20 5468 6973 2073 7465 7020 6973  ts. This step is
+00003c50: 2064 6f6e 6520 6279 2069 706c 6f74 2829   done by iplot()
+00003c60: 2e20 4265 666f 7265 2065 7865 6375 7469  . Before executi
+00003c70: 6e67 0a20 2020 2020 2020 2020 2020 2020  ng.             
+00003c80: 2020 2023 2074 6865 2067 6574 5f64 6174     # the get_dat
+00003c90: 6128 2920 6d65 7468 6f64 2c20 6265 2073  a() method, be s
+00003ca0: 7572 6520 746f 2070 726f 7669 6465 2061  ure to provide a
+00003cb0: 2060 6070 6172 616d 7360 600a 2020 2020   ``params``.    
+00003cc0: 2020 2020 2020 2020 2020 2020 2320 6469              # di
+00003cd0: 6374 696f 6e61 7279 206d 6170 7069 6e67  ctionary mapping
+00003ce0: 2073 796d 626f 6c73 2074 6f20 6e75 6d65   symbols to nume
+00003cf0: 7269 6320 7661 6c75 6573 2e0a 0a20 2020  ric values...   
+00003d00: 2020 2020 2073 656c 662e 7265 6e64 6572       self.render
+00003d10: 696e 675f 6b77 203d 206b 7761 7267 732e  ing_kw = kwargs.
+00003d20: 6765 7428 2272 656e 6465 7269 6e67 5f6b  get("rendering_k
+00003d30: 7722 2c20 6469 6374 2829 290a 0a20 2020  w", dict())..   
+00003d40: 2020 2020 2023 206e 756d 6572 6963 616c       # numerical
+00003d50: 2074 7261 6e73 666f 726d 6174 696f 6e20   transformation 
+00003d60: 6675 6e63 7469 6f6e 7320 746f 2062 6520  functions to be 
+00003d70: 6170 706c 6965 6420 746f 2074 6865 206f  applied to the o
+00003d80: 7574 7075 7420 6461 7461 0a20 2020 2020  utput data.     
+00003d90: 2020 2073 656c 662e 5f74 7820 3d20 6b77     self._tx = kw
+00003da0: 6172 6773 2e67 6574 2822 7478 222c 204e  args.get("tx", N
+00003db0: 6f6e 6529 0a20 2020 2020 2020 2073 656c  one).        sel
+00003dc0: 662e 5f74 7920 3d20 6b77 6172 6773 2e67  f._ty = kwargs.g
+00003dd0: 6574 2822 7479 222c 204e 6f6e 6529 0a20  et("ty", None). 
+00003de0: 2020 2020 2020 2073 656c 662e 5f74 7a20         self._tz 
+00003df0: 3d20 6b77 6172 6773 2e67 6574 2822 747a  = kwargs.get("tz
+00003e00: 222c 204e 6f6e 6529 0a20 2020 2020 2020  ", None).       
+00003e10: 2073 656c 662e 5f74 7020 3d20 6b77 6172   self._tp = kwar
+00003e20: 6773 2e67 6574 2822 7470 222c 204e 6f6e  gs.get("tp", Non
+00003e30: 6529 0a20 2020 2020 2020 2069 6620 6e6f  e).        if no
+00003e40: 7420 616c 6c28 0a20 2020 2020 2020 2020  t all(.         
+00003e50: 2020 2063 616c 6c61 626c 6528 7429 206f     callable(t) o
+00003e60: 7220 2874 2069 7320 4e6f 6e65 2920 666f  r (t is None) fo
+00003e70: 7220 7420 696e 0a20 2020 2020 2020 2020  r t in.         
+00003e80: 2020 205b 7365 6c66 2e5f 7478 2c20 7365     [self._tx, se
+00003e90: 6c66 2e5f 7479 2c20 7365 6c66 2e5f 747a  lf._ty, self._tz
+00003ea0: 2c20 7365 6c66 2e5f 7470 5d0a 2020 2020  , self._tp].    
+00003eb0: 2020 2020 293a 0a20 2020 2020 2020 2020      ):.         
+00003ec0: 2020 2072 6169 7365 2054 7970 6545 7272     raise TypeErr
+00003ed0: 6f72 2822 6074 7860 2c20 6074 7960 2c20  or("`tx`, `ty`, 
+00003ee0: 6074 7a60 2c20 6074 7060 206d 7573 7420  `tz`, `tp` must 
+00003ef0: 6265 2066 756e 6374 696f 6e73 2e22 290a  be functions.").
+00003f00: 0a20 2020 2020 2020 2023 2077 6865 7468  .        # wheth
+00003f10: 6572 2074 6865 2073 6572 6965 7320 636f  er the series co
+00003f20: 6e74 6169 6e73 2061 6e79 2069 6e74 6572  ntains any inter
+00003f30: 6163 7469 7665 2072 616e 6765 0a20 2020  active range.   
+00003f40: 2020 2020 2073 656c 662e 5f69 6e74 6572       self._inter
+00003f50: 6163 7469 7665 5f72 616e 6765 7320 3d20  active_ranges = 
+00003f60: 4661 6c73 650a 2020 2020 2020 2020 2320  False.        # 
+00003f70: 7768 6574 6865 7220 736f 6d65 2063 6f6c  whether some col
+00003f80: 6f72 2066 756e 6374 696f 6e20 7368 6f75  or function shou
+00003f90: 6c64 2062 6520 6170 706c 6965 6420 746f  ld be applied to
+00003fa0: 2074 6865 206e 756d 6572 6963 616c 2064   the numerical d
+00003fb0: 6174 610a 2020 2020 2020 2020 7365 6c66  ata.        self
+00003fc0: 2e63 6f6c 6f72 5f66 756e 6320 3d20 6b77  .color_func = kw
+00003fd0: 6172 6773 2e67 6574 2822 636f 6c6f 725f  args.get("color_
+00003fe0: 6675 6e63 222c 204e 6f6e 6529 0a20 2020  func", None).   
+00003ff0: 2020 2020 2023 204e 4f54 453a 2063 6f6c       # NOTE: col
+00004000: 6f72 5f66 756e 6320 7573 7561 6c6c 7920  or_func usually 
+00004010: 7265 6365 6976 6573 206e 756d 6572 6963  receives numeric
+00004020: 616c 2066 756e 6374 696f 6e73 2074 6861  al functions tha
+00004030: 7420 6172 6520 676f 696e 670a 2020 2020  t are going.    
+00004040: 2020 2020 2320 746f 2062 6520 6576 616c      # to be eval
+00004050: 7561 7465 6420 6f76 6572 2074 6865 2063  uated over the c
+00004060: 6f6f 7264 696e 6174 6573 206f 6620 7468  oordinates of th
+00004070: 6520 636f 6d70 7574 6564 2070 6f69 6e74  e computed point
+00004080: 7320 286f 7220 7468 650a 2020 2020 2020  s (or the.      
+00004090: 2020 2320 6469 7363 7265 7469 7a65 6420    # discretized 
+000040a0: 6d65 7368 6573 292e 0a20 2020 2020 2020  meshes)..       
+000040b0: 2023 2048 6f77 6576 6572 2c20 6966 2061   # However, if a
+000040c0: 6e20 6578 7072 6573 7369 6f6e 2069 7320  n expression is 
+000040d0: 6769 7665 6e20 746f 2063 6f6c 6f72 5f66  given to color_f
+000040e0: 756e 632c 2074 6865 6e20 6974 2077 696c  unc, then it wil
+000040f0: 6c20 6265 0a20 2020 2020 2020 2023 206c  l be.        # l
+00004100: 616d 6264 6966 6965 6420 7769 7468 2073  ambdified with s
+00004110: 796d 626f 6c73 2069 6e20 7365 6c66 2e5f  ymbols in self._
+00004120: 7369 676e 6174 7572 652c 2061 6e64 2069  signature, and i
+00004130: 7420 7769 6c6c 2062 6520 6576 616c 7561  t will be evalua
+00004140: 7465 640a 2020 2020 2020 2020 2320 7769  ted.        # wi
+00004150: 7468 2074 6865 2073 616d 6520 6461 7461  th the same data
+00004160: 2075 7365 6420 746f 2065 7661 6c75 6174   used to evaluat
+00004170: 6520 7468 6520 706c 6f74 7465 6420 6578  e the plotted ex
+00004180: 7072 6573 7369 6f6e 2e0a 2020 2020 2020  pression..      
+00004190: 2020 7365 6c66 2e5f 6576 616c 5f63 6f6c    self._eval_col
+000041a0: 6f72 5f66 756e 635f 7769 7468 5f73 6967  or_func_with_sig
+000041b0: 6e61 7475 7265 203d 2046 616c 7365 0a0a  nature = False..
+000041c0: 2020 2020 6465 6620 5f62 6c6f 636b 5f6c      def _block_l
+000041d0: 616d 6264 615f 6675 6e63 7469 6f6e 7328  ambda_functions(
+000041e0: 7365 6c66 2c20 2a65 7870 7273 293a 0a20  self, *exprs):. 
+000041f0: 2020 2020 2020 2069 6620 616e 7928 6361         if any(ca
+00004200: 6c6c 6162 6c65 2865 2920 666f 7220 6520  llable(e) for e 
+00004210: 696e 2065 7870 7273 293a 0a20 2020 2020  in exprs):.     
+00004220: 2020 2020 2020 2072 6169 7365 2054 7970         raise Typ
+00004230: 6545 7272 6f72 2874 7970 6528 7365 6c66  eError(type(self
+00004240: 292e 5f5f 6e61 6d65 5f5f 202b 2022 2072  ).__name__ + " r
+00004250: 6571 7569 7265 7320 6120 7379 6d62 6f6c  equires a symbol
+00004260: 6963 2022 0a20 2020 2020 2020 2020 2020  ic ".           
+00004270: 2020 2020 2022 6578 7072 6573 7369 6f6e       "expression
+00004280: 2e22 290a 0a20 2020 2064 6566 205f 6368  .")..    def _ch
+00004290: 6563 6b5f 6673 2873 656c 6629 3a0a 2020  eck_fs(self):.  
+000042a0: 2020 2020 2020 2222 2220 4368 6563 6b73        """ Checks
+000042b0: 2069 6620 7468 6572 6520 6172 6520 656e   if there are en
+000042c0: 6f67 6820 7061 7261 6d65 7465 7273 2061  ogh parameters a
+000042d0: 6e64 2066 7265 6520 7379 6d62 6f6c 732e  nd free symbols.
+000042e0: 0a20 2020 2020 2020 2022 2222 0a20 2020  .        """.   
+000042f0: 2020 2020 2065 7870 7273 2c20 7261 6e67       exprs, rang
+00004300: 6573 203d 2073 656c 662e 6578 7072 2c20  es = self.expr, 
+00004310: 7365 6c66 2e72 616e 6765 730a 2020 2020  self.ranges.    
+00004320: 2020 2020 7061 7261 6d73 2c20 6c61 6265      params, labe
+00004330: 6c20 3d20 7365 6c66 2e70 6172 616d 732c  l = self.params,
+00004340: 2073 656c 662e 6c61 6265 6c0a 2020 2020   self.label.    
+00004350: 2020 2020 6578 7072 7320 3d20 6578 7072      exprs = expr
+00004360: 7320 6966 2068 6173 6174 7472 2865 7870  s if hasattr(exp
+00004370: 7273 2c20 225f 5f69 7465 725f 5f22 2920  rs, "__iter__") 
+00004380: 656c 7365 205b 6578 7072 735d 0a20 2020  else [exprs].   
+00004390: 2020 2020 2069 6620 616e 7928 6361 6c6c       if any(call
+000043a0: 6162 6c65 2865 2920 666f 7220 6520 696e  able(e) for e in
+000043b0: 2065 7870 7273 293a 0a20 2020 2020 2020   exprs):.       
+000043c0: 2020 2020 2072 6574 7572 6e0a 0a20 2020       return..   
+000043d0: 2020 2020 2023 2066 726f 6d20 7468 6520       # from the 
+000043e0: 6578 7072 6573 7369 6f6e 2773 2066 7265  expression's fre
+000043f0: 6520 7379 6d62 6f6c 732c 2072 656d 6f76  e symbols, remov
+00004400: 6520 7468 6520 6f6e 6573 2075 7365 6420  e the ones used 
+00004410: 696e 0a20 2020 2020 2020 2023 2074 6865  in.        # the
+00004420: 2070 6172 616d 6574 6572 7320 616e 6420   parameters and 
+00004430: 7468 6520 7261 6e67 6573 0a20 2020 2020  the ranges.     
+00004440: 2020 2066 7320 3d20 5f67 6574 5f66 7265     fs = _get_fre
+00004450: 655f 7379 6d62 6f6c 7328 6578 7072 7329  e_symbols(exprs)
+00004460: 0a20 2020 2020 2020 2066 7320 3d20 6673  .        fs = fs
+00004470: 2e64 6966 6665 7265 6e63 6528 7061 7261  .difference(para
+00004480: 6d73 2e6b 6579 7328 2929 0a20 2020 2020  ms.keys()).     
+00004490: 2020 2069 6620 7261 6e67 6573 2069 7320     if ranges is 
+000044a0: 6e6f 7420 4e6f 6e65 3a0a 2020 2020 2020  not None:.      
+000044b0: 2020 2020 2020 6673 203d 2066 732e 6469        fs = fs.di
+000044c0: 6666 6572 656e 6365 285b 725b 305d 2066  fference([r[0] f
+000044d0: 6f72 2072 2069 6e20 7261 6e67 6573 5d29  or r in ranges])
+000044e0: 0a0a 2020 2020 2020 2020 6966 206c 656e  ..        if len
+000044f0: 2866 7329 203e 2030 3a0a 2020 2020 2020  (fs) > 0:.      
+00004500: 2020 2020 2020 6966 2028 7261 6e67 6573        if (ranges
+00004510: 2069 7320 6e6f 7420 4e6f 6e65 2920 616e   is not None) an
+00004520: 6420 6c65 6e28 7261 6e67 6573 2920 3e20  d len(ranges) > 
+00004530: 303a 0a20 2020 2020 2020 2020 2020 2020  0:.             
+00004540: 2020 2065 726c 203d 2022 4578 7072 6573     erl = "Expres
+00004550: 7369 6f6e 3a20 2573 5c6e 5261 6e67 6573  sion: %s\nRanges
+00004560: 3a20 2573 5c6e 4c61 6265 6c3a 2025 735c  : %s\nLabel: %s\
+00004570: 6e22 2025 2028 0a20 2020 2020 2020 2020  n" % (.         
+00004580: 2020 2020 2020 2020 2020 2065 7870 7273             exprs
+00004590: 2c20 7261 6e67 6573 2c20 6c61 6265 6c29  , ranges, label)
+000045a0: 0a20 2020 2020 2020 2020 2020 2065 6c73  .            els
+000045b0: 653a 0a20 2020 2020 2020 2020 2020 2020  e:.             
+000045c0: 2020 2065 726c 203d 2022 4578 7072 6573     erl = "Expres
+000045d0: 7369 6f6e 3a20 2573 5c6e 4c61 6265 6c3a  sion: %s\nLabel:
+000045e0: 2025 735c 6e22 2025 2028 6578 7072 732c   %s\n" % (exprs,
+000045f0: 206c 6162 656c 290a 2020 2020 2020 2020   label).        
+00004600: 2020 2020 7261 6973 6520 5661 6c75 6545      raise ValueE
+00004610: 7272 6f72 280a 2020 2020 2020 2020 2020  rror(.          
+00004620: 2020 2020 2020 2249 6e63 6f6d 7061 7469        "Incompati
+00004630: 626c 6520 6578 7072 6573 7369 6f6e 2061  ble expression a
+00004640: 6e64 2070 6172 616d 6574 6572 732e 5c6e  nd parameters.\n
+00004650: 2573 220a 2020 2020 2020 2020 2020 2020  %s".            
+00004660: 2020 2020 2270 6172 616d 733a 2025 735c      "params: %s\
+00004670: 6e22 0a20 2020 2020 2020 2020 2020 2020  n".             
+00004680: 2020 2022 5370 6563 6966 7920 7768 6174     "Specify what
+00004690: 2074 6865 7365 2073 796d 626f 6c73 2072   these symbols r
+000046a0: 6570 7265 7365 6e74 3a20 2573 5c6e 220a  epresent: %s\n".
+000046b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000046c0: 2241 7265 2074 6865 7920 7261 6e67 6573  "Are they ranges
+000046d0: 206f 7220 7061 7261 6d65 7465 7273 3f22   or parameters?"
+000046e0: 2025 2028 6572 6c2c 2070 6172 616d 732c   % (erl, params,
+000046f0: 2066 7329 0a20 2020 2020 2020 2020 2020   fs).           
+00004700: 2029 0a0a 2020 2020 2020 2020 2320 7665   )..        # ve
+00004710: 7269 6679 2074 6861 7420 616c 6c20 7379  rify that all sy
+00004720: 6d62 6f6c 7320 6172 6520 6b6e 6f77 6e20  mbols are known 
+00004730: 2874 6865 7920 6569 7468 6572 2072 6570  (they either rep
+00004740: 7265 7365 6e74 2070 6c6f 7474 696e 670a  resent plotting.
+00004750: 2020 2020 2020 2020 2320 7261 6e67 6573          # ranges
+00004760: 206f 7220 7061 7261 6d65 7465 7273 290a   or parameters).
+00004770: 2020 2020 2020 2020 7261 6e67 655f 7379          range_sy
+00004780: 6d62 6f6c 7320 3d20 5b72 5b30 5d20 666f  mbols = [r[0] fo
+00004790: 7220 7220 696e 2072 616e 6765 735d 0a20  r r in ranges]. 
+000047a0: 2020 2020 2020 2066 6f72 2072 2069 6e20         for r in 
+000047b0: 7261 6e67 6573 3a0a 2020 2020 2020 2020  ranges:.        
+000047c0: 2020 2020 6673 203d 2073 6574 2829 2e75      fs = set().u
+000047d0: 6e69 6f6e 282a 5b65 2e66 7265 655f 7379  nion(*[e.free_sy
+000047e0: 6d62 6f6c 7320 666f 7220 6520 696e 2072  mbols for e in r
+000047f0: 5b31 3a5d 5d29 0a20 2020 2020 2020 2020  [1:]]).         
+00004800: 2020 2069 6620 616e 7928 7420 696e 2066     if any(t in f
+00004810: 7320 666f 7220 7420 696e 2072 616e 6765  s for t in range
+00004820: 5f73 796d 626f 6c73 293a 0a20 2020 2020  _symbols):.     
+00004830: 2020 2020 2020 2020 2020 2072 6169 7365             raise
+00004840: 2056 616c 7565 4572 726f 7228 2252 616e   ValueError("Ran
+00004850: 6765 2073 796d 626f 6c73 2063 616e 2774  ge symbols can't
+00004860: 2062 6520 696e 636c 7564 6564 2069 6e74   be included int
+00004870: 6f20 220a 2020 2020 2020 2020 2020 2020  o ".            
+00004880: 2020 2020 2020 2020 226d 696e 696d 756d          "minimum
+00004890: 2061 6e64 206d 6178 696d 756d 206f 6620   and maximum of 
+000048a0: 6120 7261 6e67 652e 2022 0a20 2020 2020  a range. ".     
+000048b0: 2020 2020 2020 2020 2020 2020 2020 2022                 "
+000048c0: 5265 6365 6976 6564 2072 616e 6765 3a20  Received range: 
+000048d0: 2573 2220 2520 7374 7228 7229 290a 2020  %s" % str(r)).  
+000048e0: 2020 2020 2020 2020 2020 7265 6d61 696e            remain
+000048f0: 696e 675f 6673 203d 2066 732e 6469 6666  ing_fs = fs.diff
+00004900: 6572 656e 6365 2870 6172 616d 732e 6b65  erence(params.ke
+00004910: 7973 2829 290a 2020 2020 2020 2020 2020  ys()).          
+00004920: 2020 6966 206c 656e 2872 656d 6169 6e69    if len(remaini
+00004930: 6e67 5f66 7329 203e 2030 3a0a 2020 2020  ng_fs) > 0:.    
+00004940: 2020 2020 2020 2020 2020 2020 7261 6973              rais
+00004950: 6520 5661 6c75 6545 7272 6f72 280a 2020  e ValueError(.  
+00004960: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00004970: 2020 2255 6e6b 6f77 6e20 7379 6d62 6f6c    "Unkown symbol
+00004980: 7320 666f 756e 6420 696e 2070 6c6f 7474  s found in plott
+00004990: 696e 6720 7261 6e67 653a 2025 732e 2022  ing range: %s. "
+000049a0: 2025 2028 722c 2920 2b0a 2020 2020 2020   % (r,) +.      
+000049b0: 2020 2020 2020 2020 2020 2020 2020 2241                "A
+000049c0: 7265 2074 6865 2066 6f6c 6c6f 7769 6e67  re the following
+000049d0: 2070 6172 616d 6574 6572 733f 2025 7322   parameters? %s"
+000049e0: 2025 2072 656d 6169 6e69 6e67 5f66 7329   % remaining_fs)
+000049f0: 0a0a 2020 2020 6465 6620 5f75 7064 6174  ..    def _updat
+00004a00: 655f 7261 6e67 655f 7661 6c75 6528 7365  e_range_value(se
+00004a10: 6c66 2c20 7429 3a0a 2020 2020 2020 2020  lf, t):.        
+00004a20: 2222 2247 6976 656e 2061 2073 796d 626f  """Given a symbo
+00004a30: 6c69 6320 6578 7072 6573 7369 6f6e 2c20  lic expression, 
+00004a40: 6074 602c 2073 7562 7374 6974 7574 6573  `t`, substitutes
+00004a50: 2074 6865 2070 6172 616d 6574 6572 7320   the parameters 
+00004a60: 6966 0a20 2020 2020 2020 2074 6869 7320  if.        this 
+00004a70: 7365 7269 6573 2069 7320 696e 7465 7261  series is intera
+00004a80: 6374 6976 652e 0a20 2020 2020 2020 2022  ctive..        "
+00004a90: 2222 0a20 2020 2020 2020 2069 6620 6e6f  "".        if no
+00004aa0: 7420 7365 6c66 2e5f 696e 7465 7261 6374  t self._interact
+00004ab0: 6976 655f 7261 6e67 6573 3a0a 2020 2020  ive_ranges:.    
+00004ac0: 2020 2020 2020 2020 7265 7475 726e 2063          return c
+00004ad0: 6f6d 706c 6578 2874 290a 2020 2020 2020  omplex(t).      
+00004ae0: 2020 7265 7475 726e 2063 6f6d 706c 6578    return complex
+00004af0: 2874 2e73 7562 7328 7365 6c66 2e70 6172  (t.subs(self.par
+00004b00: 616d 7329 290a 0a20 2020 2040 7072 6f70  ams))..    @prop
+00004b10: 6572 7479 0a20 2020 2064 6566 2065 7870  erty.    def exp
+00004b20: 7228 7365 6c66 293a 0a20 2020 2020 2020  r(self):.       
+00004b30: 2022 2222 5265 7475 726e 2074 6865 2065   """Return the e
+00004b40: 7870 7265 7373 696f 6e20 286f 7220 6578  xpression (or ex
+00004b50: 7072 6573 7369 6f6e 7329 206f 6620 7468  pressions) of th
+00004b60: 6520 7365 7269 6573 2e22 2222 0a20 2020  e series.""".   
+00004b70: 2020 2020 2072 6574 7572 6e20 7365 6c66       return self
+00004b80: 2e5f 6578 7072 0a0a 2020 2020 4065 7870  ._expr..    @exp
+00004b90: 722e 7365 7474 6572 0a20 2020 2064 6566  r.setter.    def
+00004ba0: 2065 7870 7228 7365 6c66 2c20 7629 3a0a   expr(self, v):.
+00004bb0: 2020 2020 2020 2020 7365 6c66 2e5f 6578          self._ex
+00004bc0: 7072 203d 2076 0a0a 2020 2020 4070 726f  pr = v..    @pro
+00004bd0: 7065 7274 790a 2020 2020 6465 6620 6973  perty.    def is
+00004be0: 5f33 4428 7365 6c66 293a 0a20 2020 2020  _3D(self):.     
+00004bf0: 2020 2066 6c61 6773 3344 203d 205b 7365     flags3D = [se
+00004c00: 6c66 2e69 735f 3344 6c69 6e65 2c20 7365  lf.is_3Dline, se
+00004c10: 6c66 2e69 735f 3344 7375 7266 6163 652c  lf.is_3Dsurface,
+00004c20: 2073 656c 662e 6973 5f33 4476 6563 746f   self.is_3Dvecto
+00004c30: 725d 0a20 2020 2020 2020 2072 6574 7572  r].        retur
+00004c40: 6e20 616e 7928 666c 6167 7333 4429 0a0a  n any(flags3D)..
+00004c50: 2020 2020 4070 726f 7065 7274 790a 2020      @property.  
+00004c60: 2020 6465 6620 6973 5f6c 696e 6528 7365    def is_line(se
+00004c70: 6c66 293a 0a20 2020 2020 2020 2066 6c61  lf):.        fla
+00004c80: 6773 6c69 6e65 7320 3d20 5b73 656c 662e  gslines = [self.
+00004c90: 6973 5f32 446c 696e 652c 2073 656c 662e  is_2Dline, self.
+00004ca0: 6973 5f33 446c 696e 655d 0a20 2020 2020  is_3Dline].     
+00004cb0: 2020 2072 6574 7572 6e20 616e 7928 666c     return any(fl
+00004cc0: 6167 736c 696e 6573 290a 0a20 2020 2064  agslines)..    d
+00004cd0: 6566 205f 6c69 6e65 5f73 7572 6661 6365  ef _line_surface
+00004ce0: 5f63 6f6c 6f72 2873 656c 662c 2070 726f  _color(self, pro
+00004cf0: 702c 2076 616c 293a 0a20 2020 2020 2020  p, val):.       
+00004d00: 2022 2222 5468 6973 206d 6574 686f 6420   """This method 
+00004d10: 656e 6162 6c65 7320 6261 636b 2d63 6f6d  enables back-com
+00004d20: 7061 7469 6269 6c69 7479 2077 6974 6820  patibility with 
+00004d30: 6f6c 6420 7379 6d70 792e 706c 6f74 7469  old sympy.plotti
+00004d40: 6e67 2222 220a 2020 2020 2020 2020 2320  ng""".        # 
+00004d50: 4e4f 5445 3a20 636f 6c6f 725f 6675 6e63  NOTE: color_func
+00004d60: 2069 7320 7365 7420 696e 7369 6465 2074   is set inside t
+00004d70: 6865 2069 6e69 7420 6d65 7468 6f64 206f  he init method o
+00004d80: 6620 7468 6520 7365 7269 6573 2e0a 2020  f the series..  
+00004d90: 2020 2020 2020 2320 4966 206c 696e 655f        # If line_
+00004da0: 636f 6c6f 722f 7375 7266 6163 655f 636f  color/surface_co
+00004db0: 6c6f 7220 6973 206e 6f74 2061 2063 616c  lor is not a cal
+00004dc0: 6c61 626c 652c 2074 6865 6e20 636f 6c6f  lable, then colo
+00004dd0: 725f 6675 6e63 2077 696c 6c0a 2020 2020  r_func will.    
+00004de0: 2020 2020 2320 6265 2073 6574 2074 6f20      # be set to 
+00004df0: 4e6f 6e65 2e0a 2020 2020 2020 2020 7365  None..        se
+00004e00: 7461 7474 7228 7365 6c66 2c20 7072 6f70  tattr(self, prop
+00004e10: 2c20 7661 6c29 0a20 2020 2020 2020 2069  , val).        i
+00004e20: 6620 6361 6c6c 6162 6c65 2876 616c 2920  f callable(val) 
+00004e30: 6f72 2069 7369 6e73 7461 6e63 6528 7661  or isinstance(va
+00004e40: 6c2c 2045 7870 7229 3a0a 2020 2020 2020  l, Expr):.      
+00004e50: 2020 2020 2020 7365 6c66 2e63 6f6c 6f72        self.color
+00004e60: 5f66 756e 6320 3d20 7661 6c0a 2020 2020  _func = val.    
+00004e70: 2020 2020 2020 2020 7365 7461 7474 7228          setattr(
+00004e80: 7365 6c66 2c20 7072 6f70 2c20 4e6f 6e65  self, prop, None
+00004e90: 290a 2020 2020 2020 2020 656c 6966 2076  ).        elif v
+00004ea0: 616c 2069 7320 6e6f 7420 4e6f 6e65 3a0a  al is not None:.
+00004eb0: 2020 2020 2020 2020 2020 2020 7365 6c66              self
+00004ec0: 2e63 6f6c 6f72 5f66 756e 6320 3d20 4e6f  .color_func = No
+00004ed0: 6e65 0a0a 2020 2020 4070 726f 7065 7274  ne..    @propert
+00004ee0: 790a 2020 2020 6465 6620 6e28 7365 6c66  y.    def n(self
+00004ef0: 293a 0a20 2020 2020 2020 2022 2222 5265  ):.        """Re
+00004f00: 7475 726e 7320 6120 6c69 7374 205b 6e31  turns a list [n1
+00004f10: 2c20 6e32 2c20 6e33 5d20 6f66 206e 756d  , n2, n3] of num
+00004f20: 6265 7273 206f 6620 6469 7363 7261 7469  bers of discrati
+00004f30: 7a61 7469 6f6e 2070 6f69 6e74 732e 0a20  zation points.. 
+00004f40: 2020 2020 2020 2022 2222 0a20 2020 2020         """.     
+00004f50: 2020 2072 6574 7572 6e20 7365 6c66 2e5f     return self._
+00004f60: 6e0a 0a20 2020 2040 6e2e 7365 7474 6572  n..    @n.setter
+00004f70: 0a20 2020 2064 6566 206e 2873 656c 662c  .    def n(self,
+00004f80: 2076 293a 0a20 2020 2020 2020 2022 2222   v):.        """
+00004f90: 5365 7420 7468 6520 6e75 6d62 6572 7320  Set the numbers 
+00004fa0: 6f66 2064 6973 6372 6574 697a 6174 696f  of discretizatio
+00004fb0: 6e20 706f 696e 7473 2e20 6060 7660 6020  n points. ``v`` 
+00004fc0: 6d75 7374 2062 6520 616e 2069 6e74 206f  must be an int o
+00004fd0: 720a 2020 2020 2020 2020 6120 6c69 7374  r.        a list
+00004fe0: 2e0a 0a20 2020 2020 2020 204c 6574 2060  ...        Let `
+00004ff0: 6073 6060 2062 6520 6120 7365 7269 6573  `s`` be a series
+00005000: 2e20 5468 656e 3a0a 0a20 2020 2020 2020  . Then:..       
+00005010: 202a 2074 6f20 7365 7420 7468 6520 6e75   * to set the nu
+00005020: 6d62 6572 206f 6620 6469 7363 7265 7469  mber of discreti
+00005030: 7a61 7469 6f6e 2070 6f69 6e74 7320 616c  zation points al
+00005040: 6f6e 6720 7468 6520 7820 6469 7265 6374  ong the x direct
+00005050: 696f 6e20 286f 720a 2020 2020 2020 2020  ion (or.        
+00005060: 2020 6669 7273 7420 7061 7261 6d65 7465    first paramete
+00005070: 7229 3a20 6060 732e 6e20 3d20 3130 6060  r): ``s.n = 10``
+00005080: 0a20 2020 2020 2020 202a 2074 6f20 7365  .        * to se
+00005090: 7420 7468 6520 6e75 6d62 6572 206f 6620  t the number of 
+000050a0: 6469 7363 7265 7469 7a61 7469 6f6e 2070  discretization p
+000050b0: 6f69 6e74 7320 616c 6f6e 6720 7468 6520  oints along the 
+000050c0: 7820 616e 6420 790a 2020 2020 2020 2020  x and y.        
+000050d0: 2020 6469 7265 6374 696f 6e73 2028 6f72    directions (or
+000050e0: 2066 6972 7374 2061 6e64 2073 6563 6f6e   first and secon
+000050f0: 6420 7061 7261 6d65 7465 7273 293a 2060  d parameters): `
+00005100: 6073 2e6e 203d 205b 3130 2c20 3135 5d60  `s.n = [10, 15]`
+00005110: 600a 2020 2020 2020 2020 2a20 746f 2073  `.        * to s
+00005120: 6574 2074 6865 206e 756d 6265 7220 6f66  et the number of
+00005130: 2064 6973 6372 6574 697a 6174 696f 6e20   discretization 
+00005140: 706f 696e 7473 2061 6c6f 6e67 2074 6865  points along the
+00005150: 2078 2c20 7920 616e 6420 7a0a 2020 2020   x, y and z.    
+00005160: 2020 2020 2020 6469 7265 6374 696f 6e73        directions
+00005170: 3a20 6060 732e 6e20 3d20 5b31 302c 2031  : ``s.n = [10, 1
+00005180: 352c 2032 305d 6060 0a0a 2020 2020 2020  5, 20]``..      
+00005190: 2020 4e6f 7465 2074 6861 7420 7468 6520    Note that the 
+000051a0: 666f 6c6c 6f77 696e 6720 6973 2068 6967  following is hig
+000051b0: 686c 7920 756e 7265 6363 6f6d 656e 6465  hly unreccomende
+000051c0: 642c 2062 6563 6175 7365 2069 7420 7072  d, because it pr
+000051d0: 6576 656e 7473 0a20 2020 2020 2020 2074  events.        t
+000051e0: 6865 2065 7865 6375 7469 6f6e 206f 6620  he execution of 
+000051f0: 6e65 6365 7373 6172 7920 636f 6465 2069  necessary code i
+00005200: 6e20 6f72 6465 7220 746f 206b 6565 7020  n order to keep 
+00005210: 7570 6461 7465 6420 6461 7461 3a0a 2020  updated data:.  
+00005220: 2020 2020 2020 6060 732e 6e5b 315d 203d        ``s.n[1] =
+00005230: 2031 3560 600a 2020 2020 2020 2020 2222   15``.        ""
+00005240: 220a 2020 2020 2020 2020 6966 206e 6f74  ".        if not
+00005250: 2068 6173 6174 7472 2876 2c20 225f 5f69   hasattr(v, "__i
+00005260: 7465 725f 5f22 293a 0a20 2020 2020 2020  ter__"):.       
+00005270: 2020 2020 2073 656c 662e 5f6e 5b30 5d20       self._n[0] 
+00005280: 3d20 760a 2020 2020 2020 2020 656c 7365  = v.        else
+00005290: 3a0a 2020 2020 2020 2020 2020 2020 7365  :.            se
+000052a0: 6c66 2e5f 6e5b 3a6c 656e 2876 295d 203d  lf._n[:len(v)] =
+000052b0: 2076 0a0a 2020 2020 4070 726f 7065 7274   v..    @propert
+000052c0: 790a 2020 2020 6465 6620 7061 7261 6d73  y.    def params
+000052d0: 2873 656c 6629 3a0a 2020 2020 2020 2020  (self):.        
+000052e0: 2222 2247 6574 206f 7220 7365 7420 7468  """Get or set th
+000052f0: 6520 6375 7272 656e 7420 7061 7261 6d65  e current parame
+00005300: 7465 7273 2064 6963 7469 6f6e 6172 792e  ters dictionary.
+00005310: 0a0a 2020 2020 2020 2020 5061 7261 6d65  ..        Parame
+00005320: 7465 7273 0a20 2020 2020 2020 203d 3d3d  ters.        ===
+00005330: 3d3d 3d3d 3d3d 3d0a 0a20 2020 2020 2020  =======..       
+00005340: 2070 203a 2064 6963 740a 0a20 2020 2020   p : dict..     
+00005350: 2020 2020 2020 202a 206b 6579 3a20 7379         * key: sy
+00005360: 6d62 6f6c 2061 7373 6f63 6961 7465 6420  mbol associated 
+00005370: 746f 2074 6865 2070 6172 616d 6574 6572  to the parameter
+00005380: 0a20 2020 2020 2020 2020 2020 202a 2076  .            * v
+00005390: 616c 3a20 7468 6520 6e75 6d65 7269 6320  al: the numeric 
+000053a0: 7661 6c75 650a 2020 2020 2020 2020 2222  value.        ""
+000053b0: 220a 2020 2020 2020 2020 7265 7475 726e  ".        return
+000053c0: 2073 656c 662e 5f70 6172 616d 730a 0a20   self._params.. 
+000053d0: 2020 2040 7061 7261 6d73 2e73 6574 7465     @params.sette
+000053e0: 720a 2020 2020 6465 6620 7061 7261 6d73  r.    def params
+000053f0: 2873 656c 662c 2070 293a 0a20 2020 2020  (self, p):.     
+00005400: 2020 2023 204e 4f54 453a 2074 6869 7320     # NOTE: this 
+00005410: 7365 7474 6572 2065 7870 6563 7473 2070  setter expects p
+00005420: 2e76 616c 7565 7328 2920 746f 2062 6520  .values() to be 
+00005430: 6e75 6d65 7269 632c 206f 7220 6c69 7374  numeric, or list
+00005440: 2f74 7570 6c65 206f 660a 2020 2020 2020  /tuple of.      
+00005450: 2020 2320 6e75 6d62 6572 732e 2049 7420    # numbers. It 
+00005460: 6973 206d 6561 6e74 2074 6f20 6265 2063  is meant to be c
+00005470: 616c 6c65 6420 7768 656e 2075 7365 7273  alled when users
+00005480: 2075 7064 6174 6520 7468 6520 7374 6174   update the stat
+00005490: 6520 6f66 0a20 2020 2020 2020 2023 2073  e of.        # s
+000054a0: 6f6d 6520 5769 6467 6574 2e0a 2020 2020  ome Widget..    
+000054b0: 2020 2020 7365 6c66 2e5f 7061 7261 6d73      self._params
+000054c0: 203d 2073 656c 662e 5f70 6172 616d 735f   = self._params_
+000054d0: 6865 6c70 6572 2870 290a 0a20 2020 2064  helper(p)..    d
+000054e0: 6566 205f 7061 7261 6d73 5f68 656c 7065  ef _params_helpe
+000054f0: 7228 7365 6c66 2c20 7029 3a0a 2020 2020  r(self, p):.    
+00005500: 2020 2020 6966 206e 6f74 2061 6e79 2869      if not any(i
+00005510: 7369 6e73 7461 6e63 6528 742c 2028 6c69  sinstance(t, (li
+00005520: 7374 2c20 7475 706c 6529 2920 666f 7220  st, tuple)) for 
+00005530: 7420 696e 2070 2e6b 6579 7328 2929 3a0a  t in p.keys()):.
+00005540: 2020 2020 2020 2020 2020 2020 7265 7475              retu
+00005550: 726e 2070 0a20 2020 2020 2020 2023 2073  rn p.        # s
+00005560: 6f6d 6520 7769 6467 6574 2063 6f75 6c64  ome widget could
+00005570: 2062 6520 6120 5261 6e67 6553 6c69 6465   be a RangeSlide
+00005580: 722e 2055 7365 7220 7772 6f74 6520 736f  r. User wrote so
+00005590: 6d65 7468 696e 6720 6c69 6b65 3a0a 2020  mething like:.  
+000055a0: 2020 2020 2020 2320 2873 796d 6231 2c20        # (symb1, 
+000055b0: 7379 6d62 3229 3a20 5261 6e67 6553 6c69  symb2): RangeSli
+000055c0: 6465 7228 2e2e 2e29 0a20 2020 2020 2020  der(...).       
+000055d0: 2023 204e 6565 6420 746f 2073 706c 6974   # Need to split
+000055e0: 2069 7473 2073 796d 626f 6c73 2f76 616c   its symbols/val
+000055f0: 7565 732e 0a20 2020 2020 2020 206e 6577  ues..        new
+00005600: 5f70 6172 616d 7320 3d20 7b7d 0a20 2020  _params = {}.   
+00005610: 2020 2020 2066 6f72 206b 2c20 7620 696e       for k, v in
+00005620: 2070 2e69 7465 6d73 2829 3a0a 2020 2020   p.items():.    
+00005630: 2020 2020 2020 2020 6966 206e 6f74 2069          if not i
+00005640: 7369 6e73 7461 6e63 6528 762c 2028 6c69  sinstance(v, (li
+00005650: 7374 2c20 7475 706c 6529 293a 0a20 2020  st, tuple)):.   
+00005660: 2020 2020 2020 2020 2020 2020 206e 6577               new
+00005670: 5f70 6172 616d 735b 6b5d 203d 2076 0a20  _params[k] = v. 
+00005680: 2020 2020 2020 2020 2020 2065 6c73 653a             else:
+00005690: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+000056a0: 2066 6f72 2073 2c20 7661 6c20 696e 207a   for s, val in z
+000056b0: 6970 286b 2c20 7629 3a0a 2020 2020 2020  ip(k, v):.      
+000056c0: 2020 2020 2020 2020 2020 2020 2020 6e65                ne
+000056d0: 775f 7061 7261 6d73 5b73 5d20 3d20 7661  w_params[s] = va
+000056e0: 6c0a 2020 2020 2020 2020 7265 7475 726e  l.        return
+000056f0: 206e 6577 5f70 6172 616d 730a 0a20 2020   new_params..   
+00005700: 2040 7072 6f70 6572 7479 0a20 2020 2064   @property.    d
+00005710: 6566 2073 6361 6c65 7328 7365 6c66 293a  ef scales(self):
+00005720: 0a20 2020 2020 2020 2072 6574 7572 6e20  .        return 
+00005730: 7365 6c66 2e5f 7363 616c 6573 0a0a 2020  self._scales..  
+00005740: 2020 4073 6361 6c65 732e 7365 7474 6572    @scales.setter
+00005750: 0a20 2020 2064 6566 2073 6361 6c65 7328  .    def scales(
+00005760: 7365 6c66 2c20 7629 3a0a 2020 2020 2020  self, v):.      
+00005770: 2020 6966 2069 7369 6e73 7461 6e63 6528    if isinstance(
+00005780: 762c 2073 7472 293a 0a20 2020 2020 2020  v, str):.       
+00005790: 2020 2020 2073 656c 662e 5f73 6361 6c65       self._scale
+000057a0: 735b 305d 203d 2076 0a20 2020 2020 2020  s[0] = v.       
+000057b0: 2065 6c73 653a 0a20 2020 2020 2020 2020   else:.         
+000057c0: 2020 2073 656c 662e 5f73 6361 6c65 735b     self._scales[
+000057d0: 3a6c 656e 2876 295d 203d 2076 0a0a 2020  :len(v)] = v..  
+000057e0: 2020 4070 726f 7065 7274 790a 2020 2020    @property.    
+000057f0: 6465 6620 7265 6e64 6572 696e 675f 6b77  def rendering_kw
+00005800: 2873 656c 6629 3a0a 2020 2020 2020 2020  (self):.        
+00005810: 7265 7475 726e 2073 656c 662e 5f72 656e  return self._ren
+00005820: 6465 7269 6e67 5f6b 770a 0a20 2020 2040  dering_kw..    @
+00005830: 7265 6e64 6572 696e 675f 6b77 2e73 6574  rendering_kw.set
+00005840: 7465 720a 2020 2020 6465 6620 7265 6e64  ter.    def rend
+00005850: 6572 696e 675f 6b77 2873 656c 662c 206b  ering_kw(self, k
+00005860: 7761 7267 7329 3a0a 2020 2020 2020 2020  wargs):.        
+00005870: 6966 2069 7369 6e73 7461 6e63 6528 6b77  if isinstance(kw
+00005880: 6172 6773 2c20 6469 6374 293a 0a20 2020  args, dict):.   
+00005890: 2020 2020 2020 2020 2073 656c 662e 5f72           self._r
+000058a0: 656e 6465 7269 6e67 5f6b 7720 3d20 6b77  endering_kw = kw
+000058b0: 6172 6773 0a20 2020 2020 2020 2065 6c73  args.        els
+000058c0: 653a 0a20 2020 2020 2020 2020 2020 2073  e:.            s
+000058d0: 656c 662e 5f72 656e 6465 7269 6e67 5f6b  elf._rendering_k
+000058e0: 7720 3d20 6469 6374 2829 0a20 2020 2020  w = dict().     
+000058f0: 2020 2020 2020 2069 6620 6b77 6172 6773         if kwargs
+00005900: 2069 7320 6e6f 7420 4e6f 6e65 3a0a 2020   is not None:.  
+00005910: 2020 2020 2020 2020 2020 2020 2020 7761                wa
+00005920: 726e 696e 6773 2e77 6172 6e28 0a20 2020  rnings.warn(.   
+00005930: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00005940: 2022 6072 656e 6465 7269 6e67 5f6b 7760   "`rendering_kw`
+00005950: 206d 7573 7420 6265 2061 2064 6963 7469   must be a dicti
+00005960: 6f6e 6172 792c 2069 6e73 7465 6164 2061  onary, instead a
+00005970: 6e20 220a 2020 2020 2020 2020 2020 2020  n ".            
+00005980: 2020 2020 2020 2020 226f 626a 6563 7420          "object 
+00005990: 6f66 2074 7970 6520 2573 2077 6173 2072  of type %s was r
+000059a0: 6563 6569 7665 642e 2022 2025 2074 7970  eceived. " % typ
+000059b0: 6528 6b77 6172 6773 2920 2b0a 2020 2020  e(kwargs) +.    
+000059c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000059d0: 2241 7574 6f6d 6174 6963 616c 6c79 2073  "Automatically s
+000059e0: 6574 7469 6e67 2060 7265 6e64 6572 696e  etting `renderin
+000059f0: 675f 6b77 6020 746f 2061 6e20 656d 7074  g_kw` to an empt
+00005a00: 7920 220a 2020 2020 2020 2020 2020 2020  y ".            
+00005a10: 2020 2020 2020 2020 2264 6963 7469 6f6e          "diction
+00005a20: 6172 7922 290a 0a20 2020 2040 7374 6174  ary")..    @stat
+00005a30: 6963 6d65 7468 6f64 0a20 2020 2064 6566  icmethod.    def
+00005a40: 205f 6469 7363 7265 7469 7a65 2873 7461   _discretize(sta
+00005a50: 7274 2c20 656e 642c 204e 2c20 7363 616c  rt, end, N, scal
+00005a60: 653d 226c 696e 6561 7222 2c20 6f6e 6c79  e="linear", only
+00005a70: 5f69 6e74 6567 6572 733d 4661 6c73 6529  _integers=False)
+00005a80: 3a0a 2020 2020 2020 2020 2222 2244 6973  :.        """Dis
+00005a90: 6372 6574 697a 6520 6120 3144 2064 6f6d  cretize a 1D dom
+00005aa0: 6169 6e2e 0a0a 2020 2020 2020 2020 5265  ain...        Re
+00005ab0: 7475 726e 730a 2020 2020 2020 2020 3d3d  turns.        ==
+00005ac0: 3d3d 3d3d 3d0a 0a20 2020 2020 2020 2064  =====..        d
+00005ad0: 6f6d 6169 6e20 3a20 6e70 2e6e 6461 7272  omain : np.ndarr
+00005ae0: 6179 2077 6974 6820 6474 7970 653d 666c  ay with dtype=fl
+00005af0: 6f61 7420 6f72 2063 6f6d 706c 6578 0a20  oat or complex. 
+00005b00: 2020 2020 2020 2020 2020 2054 6865 2064             The d
+00005b10: 6f6d 6169 6e27 7320 6474 7970 6520 7769  omain's dtype wi
+00005b20: 6c6c 2062 6520 666c 6f61 7420 6f72 2063  ll be float or c
+00005b30: 6f6d 706c 6578 2028 6465 7065 6e64 696e  omplex (dependin
+00005b40: 6720 6f6e 2074 6865 0a20 2020 2020 2020  g on the.       
+00005b50: 2020 2020 2074 7970 6520 6f66 2073 7461       type of sta
+00005b60: 7274 2f65 6e64 2920 6576 656e 2069 6620  rt/end) even if 
+00005b70: 6f6e 6c79 5f69 6e74 6567 6572 733d 5472  only_integers=Tr
+00005b80: 7565 2e20 4974 2069 7320 6c65 6674 2066  ue. It is left f
+00005b90: 6f72 0a20 2020 2020 2020 2020 2020 2074  or.            t
+00005ba0: 6865 2064 6f77 6e73 7472 6561 6d20 636f  he downstream co
+00005bb0: 6465 2074 6f20 7065 7266 6f72 6d20 6675  de to perform fu
+00005bc0: 7274 6865 7220 6361 7374 696e 672c 2069  rther casting, i
+00005bd0: 6620 6e65 6365 7373 6172 792e 0a20 2020  f necessary..   
+00005be0: 2020 2020 2022 2222 0a20 2020 2020 2020       """.       
+00005bf0: 206e 7020 3d20 696d 706f 7274 5f6d 6f64   np = import_mod
+00005c00: 756c 6528 276e 756d 7079 2729 0a0a 2020  ule('numpy')..  
+00005c10: 2020 2020 2020 6966 206f 6e6c 795f 696e        if only_in
+00005c20: 7465 6765 7273 2069 7320 5472 7565 3a0a  tegers is True:.
+00005c30: 2020 2020 2020 2020 2020 2020 7374 6172              star
+00005c40: 742c 2065 6e64 203d 2069 6e74 2873 7461  t, end = int(sta
+00005c50: 7274 292c 2069 6e74 2865 6e64 290a 2020  rt), int(end).  
+00005c60: 2020 2020 2020 2020 2020 4e20 3d20 656e            N = en
+00005c70: 6420 2d20 7374 6172 7420 2b20 310a 0a20  d - start + 1.. 
+00005c80: 2020 2020 2020 2069 6620 7363 616c 6520         if scale 
+00005c90: 3d3d 2022 6c69 6e65 6172 223a 0a20 2020  == "linear":.   
+00005ca0: 2020 2020 2020 2020 2072 6574 7572 6e20           return 
+00005cb0: 6e70 2e6c 696e 7370 6163 6528 7374 6172  np.linspace(star
+00005cc0: 742c 2065 6e64 2c20 4e29 0a20 2020 2020  t, end, N).     
+00005cd0: 2020 2072 6574 7572 6e20 6e70 2e67 656f     return np.geo
+00005ce0: 6d73 7061 6365 2873 7461 7274 2c20 656e  mspace(start, en
+00005cf0: 642c 204e 290a 0a20 2020 2040 7374 6174  d, N)..    @stat
+00005d00: 6963 6d65 7468 6f64 0a20 2020 2064 6566  icmethod.    def
+00005d10: 205f 636f 7272 6563 745f 7368 6170 6528   _correct_shape(
+00005d20: 612c 2062 293a 0a20 2020 2020 2020 2022  a, b):.        "
+00005d30: 2222 436f 6e76 6572 7420 6060 6160 6020  ""Convert ``a`` 
+00005d40: 746f 2061 206e 702e 6e64 6172 7261 7920  to a np.ndarray 
+00005d50: 6f66 2074 6865 2073 616d 6520 7368 6170  of the same shap
+00005d60: 6520 6f66 2060 6062 6060 2e0a 0a20 2020  e of ``b``...   
+00005d70: 2020 2020 2050 6172 616d 6574 6572 730a       Parameters.
+00005d80: 2020 2020 2020 2020 3d3d 3d3d 3d3d 3d3d          ========
+00005d90: 3d3d 0a0a 2020 2020 2020 2020 6120 3a20  ==..        a : 
+00005da0: 696e 742c 2066 6c6f 6174 2c20 636f 6d70  int, float, comp
+00005db0: 6c65 782c 206e 702e 6e64 6172 7261 790a  lex, np.ndarray.
+00005dc0: 2020 2020 2020 2020 2020 2020 5573 7561              Usua
+00005dd0: 6c6c 792c 2074 6869 7320 6973 2074 6865  lly, this is the
+00005de0: 2072 6573 756c 7420 6f66 2061 206e 756d   result of a num
+00005df0: 6572 6963 616c 2065 7661 6c75 6174 696f  erical evaluatio
+00005e00: 6e20 6f66 2061 0a20 2020 2020 2020 2020  n of a.         
+00005e10: 2020 2073 796d 626f 6c69 6320 6578 7072     symbolic expr
+00005e20: 6573 7369 6f6e 2e20 4576 656e 2069 6620  ession. Even if 
+00005e30: 6120 6469 7363 7265 7469 7a65 6420 646f  a discretized do
+00005e40: 6d61 696e 2077 6173 2075 7365 6420 746f  main was used to
+00005e50: 0a20 2020 2020 2020 2020 2020 2065 7661  .            eva
+00005e60: 6c75 6174 6520 7468 6520 6675 6e63 7469  luate the functi
+00005e70: 6f6e 2c20 7468 6520 7265 7375 6c74 2063  on, the result c
+00005e80: 616e 2062 6520 6120 7363 616c 6172 2028  an be a scalar (
+00005e90: 696e 742c 2066 6c6f 6174 2c0a 2020 2020  int, float,.    
+00005ea0: 2020 2020 2020 2020 636f 6d70 6c65 7829          complex)
+00005eb0: 2e0a 0a20 2020 2020 2020 2062 203a 206e  ...        b : n
+00005ec0: 702e 6e64 6172 7261 790a 2020 2020 2020  p.ndarray.      
+00005ed0: 2020 2020 2020 4974 2072 6570 7265 7365        It represe
+00005ee0: 6e74 7320 7468 6520 636f 7272 6563 7420  nts the correct 
+00005ef0: 7368 6170 6520 7468 6174 2060 6061 6060  shape that ``a``
+00005f00: 2073 686f 756c 6420 6861 7665 2e0a 0a20   should have... 
+00005f10: 2020 2020 2020 2052 6574 7572 6e73 0a20         Returns. 
+00005f20: 2020 2020 2020 203d 3d3d 3d3d 3d3d 0a20         =======. 
+00005f30: 2020 2020 2020 206e 6577 5f61 203a 206e         new_a : n
+00005f40: 702e 6e64 6172 7261 790a 2020 2020 2020  p.ndarray.      
+00005f50: 2020 2020 2020 416e 2061 7272 6179 2077        An array w
+00005f60: 6974 6820 7468 6520 636f 7272 6563 7420  ith the correct 
+00005f70: 7368 6170 652e 0a20 2020 2020 2020 2022  shape..        "
+00005f80: 2222 0a20 2020 2020 2020 206e 7020 3d20  "".        np = 
+00005f90: 696d 706f 7274 5f6d 6f64 756c 6528 276e  import_module('n
+00005fa0: 756d 7079 2729 0a0a 2020 2020 2020 2020  umpy')..        
+00005fb0: 6966 206e 6f74 2069 7369 6e73 7461 6e63  if not isinstanc
+00005fc0: 6528 612c 206e 702e 6e64 6172 7261 7929  e(a, np.ndarray)
+00005fd0: 3a0a 2020 2020 2020 2020 2020 2020 6120  :.            a 
+00005fe0: 3d20 6e70 2e61 7272 6179 2861 290a 2020  = np.array(a).  
+00005ff0: 2020 2020 2020 6966 2061 2e73 6861 7065        if a.shape
+00006000: 2021 3d20 622e 7368 6170 653a 0a20 2020   != b.shape:.   
+00006010: 2020 2020 2020 2020 2069 6620 612e 7368           if a.sh
+00006020: 6170 6520 3d3d 2028 293a 0a20 2020 2020  ape == ():.     
+00006030: 2020 2020 2020 2020 2020 2061 203d 2061             a = a
+00006040: 202a 206e 702e 6f6e 6573 5f6c 696b 6528   * np.ones_like(
+00006050: 6229 0a20 2020 2020 2020 2020 2020 2065  b).            e
+00006060: 6c73 653a 0a20 2020 2020 2020 2020 2020  lse:.           
+00006070: 2020 2020 2061 203d 2061 2e72 6573 6861       a = a.resha
+00006080: 7065 2862 2e73 6861 7065 290a 2020 2020  pe(b.shape).    
+00006090: 2020 2020 7265 7475 726e 2061 0a0a 2020      return a..  
+000060a0: 2020 6465 6620 6576 616c 5f63 6f6c 6f72    def eval_color
+000060b0: 5f66 756e 6328 7365 6c66 2c20 2a61 7267  _func(self, *arg
+000060c0: 7329 3a0a 2020 2020 2020 2020 2222 2245  s):.        """E
+000060d0: 7661 6c75 6174 6520 7468 6520 636f 6c6f  valuate the colo
+000060e0: 7220 6675 6e63 7469 6f6e 2e0a 0a20 2020  r function...   
+000060f0: 2020 2020 2050 6172 616d 6574 6572 730a       Parameters.
+00006100: 2020 2020 2020 2020 3d3d 3d3d 3d3d 3d3d          ========
+00006110: 3d3d 0a0a 2020 2020 2020 2020 6172 6773  ==..        args
+00006120: 203a 2074 7570 6c65 0a20 2020 2020 2020   : tuple.       
+00006130: 2020 2020 2041 7267 756d 656e 7473 2074       Arguments t
+00006140: 6f20 6265 2070 6173 7365 6420 746f 2074  o be passed to t
+00006150: 6865 2063 6f6c 6f72 696e 6720 6675 6e63  he coloring func
+00006160: 7469 6f6e 2e20 4361 6e20 6265 2063 6f6f  tion. Can be coo
+00006170: 7264 696e 6174 6573 0a20 2020 2020 2020  rdinates.       
+00006180: 2020 2020 206f 7220 7061 7261 6d65 7465       or paramete
+00006190: 7273 206f 7220 626f 7468 2e0a 0a20 2020  rs or both...   
+000061a0: 2020 2020 204e 6f74 6573 0a20 2020 2020       Notes.     
+000061b0: 2020 203d 3d3d 3d3d 0a0a 2020 2020 2020     =====..      
+000061c0: 2020 5468 6520 6261 636b 656e 6420 7769    The backend wi
+000061d0: 6c6c 2072 6571 7565 7374 2074 6865 2064  ll request the d
+000061e0: 6174 6120 7365 7269 6573 2074 6f20 6765  ata series to ge
+000061f0: 6e65 7261 7465 2074 6865 206e 756d 6572  nerate the numer
+00006200: 6963 616c 0a20 2020 2020 2020 2064 6174  ical.        dat
+00006210: 612e 2044 6570 656e 6469 6e67 206f 6e20  a. Depending on 
+00006220: 7468 6520 6461 7461 2073 6572 6965 732c  the data series,
+00006230: 2065 6974 6865 7220 7468 6520 6461 7461   either the data
+00006240: 2073 6572 6965 7320 6974 7365 6c66 206f   series itself o
+00006250: 720a 2020 2020 2020 2020 7468 6520 6261  r.        the ba
+00006260: 636b 656e 6420 7769 6c6c 2065 7665 6e74  ckend will event
+00006270: 7561 6c6c 7920 6578 6563 7574 6520 7468  ually execute th
+00006280: 6973 2066 756e 6374 696f 6e20 746f 2067  is function to g
+00006290: 656e 6572 6174 6520 7468 650a 2020 2020  enerate the.    
+000062a0: 2020 2020 6170 7072 6f70 7269 6174 6520      appropriate 
+000062b0: 636f 6c6f 7269 6e67 2076 616c 7565 2e0a  coloring value..
+000062c0: 2020 2020 2020 2020 2222 220a 2020 2020          """.    
+000062d0: 2020 2020 6e70 203d 2069 6d70 6f72 745f      np = import_
+000062e0: 6d6f 6475 6c65 2827 6e75 6d70 7927 290a  module('numpy').
+000062f0: 2020 2020 2020 2020 6966 2073 656c 662e          if self.
+00006300: 636f 6c6f 725f 6675 6e63 2069 7320 4e6f  color_func is No
+00006310: 6e65 3a0a 2020 2020 2020 2020 2020 2020  ne:.            
+00006320: 2320 4e4f 5445 3a20 7769 7468 2074 6865  # NOTE: with the
+00006330: 206c 696e 655f 636f 6c6f 7220 616e 6420   line_color and 
+00006340: 7375 7266 6163 655f 636f 6c6f 7220 6174  surface_color at
+00006350: 7472 6962 7574 6573 0a20 2020 2020 2020  tributes.       
+00006360: 2020 2020 2023 2028 6261 636b 2d63 6f6d       # (back-com
+00006370: 7061 7469 6269 6c69 7479 2077 6974 6820  patibility with 
+00006380: 7468 6520 6f6c 6420 7379 6d70 792e 706c  the old sympy.pl
+00006390: 6f74 7469 6e67 206d 6f64 756c 6529 2069  otting module) i
+000063a0: 7420 6973 0a20 2020 2020 2020 2020 2020  t is.           
+000063b0: 2023 2070 6f73 7369 626c 6520 746f 2063   # possible to c
+000063c0: 7265 6174 6520 6120 706c 6f74 2077 6974  reate a plot wit
+000063d0: 6820 6120 6361 6c6c 6162 6c65 206c 696e  h a callable lin
+000063e0: 655f 636f 6c6f 7220 286f 720a 2020 2020  e_color (or.    
+000063f0: 2020 2020 2020 2020 2320 7375 7266 6163          # surfac
+00006400: 655f 636f 6c6f 7229 2e20 466f 7220 6578  e_color). For ex
+00006410: 616d 706c 653a 0a20 2020 2020 2020 2020  ample:.         
+00006420: 2020 2023 2070 203d 2070 6c6f 7428 7369     # p = plot(si
+00006430: 6e28 7829 2c20 6c69 6e65 5f63 6f6c 6f72  n(x), line_color
+00006440: 3d6c 616d 6264 6120 782c 2079 3a20 2d79  =lambda x, y: -y
+00006450: 290a 2020 2020 2020 2020 2020 2020 2320  ).            # 
+00006460: 5468 6973 2077 696c 6c20 6372 6561 7465  This will create
+00006470: 2061 2043 6f6c 6f72 6564 4c69 6e65 4f76   a ColoredLineOv
+00006480: 6572 3144 5261 6e67 6553 6572 6965 732c  er1DRangeSeries,
+00006490: 2077 6869 6368 0a20 2020 2020 2020 2020   which.         
+000064a0: 2020 2023 2065 6666 6665 6374 6976 656c     # efffectivel
+000064b0: 7920 6973 2061 2070 6172 616d 6574 7269  y is a parametri
+000064c0: 6320 7365 7269 6573 2e20 4c61 7465 7220  c series. Later 
+000064d0: 7765 2063 6f75 6c64 2063 6861 6e67 650a  we could change.
+000064e0: 2020 2020 2020 2020 2020 2020 2320 6974              # it
+000064f0: 2074 6f20 6120 7374 7269 6e67 2076 616c   to a string val
+00006500: 7565 3a0a 2020 2020 2020 2020 2020 2020  ue:.            
+00006510: 2320 705b 305d 2e6c 696e 655f 636f 6c6f  # p[0].line_colo
+00006520: 7220 3d20 2272 6564 220a 2020 2020 2020  r = "red".      
+00006530: 2020 2020 2020 2320 486f 7765 7665 722c        # However,
+00006540: 2074 6869 7320 776f 6e27 7420 6170 706c   this won't appl
+00006550: 7920 7468 6520 7265 6420 636f 6c6f 722c  y the red color,
+00006560: 2062 6563 6175 7365 2077 6520 6361 6e27   because we can'
+00006570: 7420 6173 6b0a 2020 2020 2020 2020 2020  t ask.          
+00006580: 2020 2320 6120 7061 7261 6d65 7472 6963    # a parametric
+00006590: 2073 6572 6965 7320 746f 2062 6520 6e6f   series to be no
+000065a0: 6e2d 7061 7261 6d65 7472 6963 210a 2020  n-parametric!.  
+000065b0: 2020 2020 2020 2020 2020 7761 726e 696e            warnin
+000065c0: 6773 2e77 6172 6e28 0a20 2020 2020 2020  gs.warn(.       
+000065d0: 2020 2020 2020 2020 2022 5468 6973 2069           "This i
+000065e0: 7320 6c69 6b65 6c79 206e 6f74 2074 6865  s likely not the
+000065f0: 2072 6573 756c 7420 796f 7520 7765 7265   result you were
+00006600: 2020 6c6f 6f6b 696e 6720 666f 722e 2022    looking for. "
+00006610: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00006620: 2022 506c 6561 7365 2c20 7265 2d65 7865   "Please, re-exe
+00006630: 6375 7465 2074 6865 2070 6c6f 7420 636f  cute the plot co
+00006640: 6d6d 616e 642c 2074 6869 7320 7469 6d65  mmand, this time
+00006650: 2022 0a20 2020 2020 2020 2020 2020 2020   ".             
+00006660: 2020 2022 7769 7468 2074 6865 2061 7070     "with the app
+00006670: 726f 7072 6961 7465 206c 696e 655f 636f  ropriate line_co
+00006680: 6c6f 7220 6f72 2073 7572 6661 6365 5f63  lor or surface_c
+00006690: 6f6c 6f72 2229 0a20 2020 2020 2020 2020  olor").         
+000066a0: 2020 2072 6574 7572 6e20 6e70 2e6f 6e65     return np.one
+000066b0: 735f 6c69 6b65 2861 7267 735b 305d 290a  s_like(args[0]).
+000066c0: 0a20 2020 2020 2020 2069 6620 7365 6c66  .        if self
+000066d0: 2e5f 6576 616c 5f63 6f6c 6f72 5f66 756e  ._eval_color_fun
+000066e0: 635f 7769 7468 5f73 6967 6e61 7475 7265  c_with_signature
+000066f0: 3a0a 2020 2020 2020 2020 2020 2020 6172  :.            ar
+00006700: 6773 203d 2073 656c 662e 5f61 6767 7265  gs = self._aggre
+00006710: 6761 7465 5f61 7267 7328 290a 2020 2020  gate_args().    
+00006720: 2020 2020 2020 2020 636f 6c6f 7220 3d20          color = 
+00006730: 7365 6c66 2e63 6f6c 6f72 5f66 756e 6328  self.color_func(
+00006740: 2a61 7267 7329 0a20 2020 2020 2020 2020  *args).         
+00006750: 2020 205f 7265 2c20 5f69 6d20 3d20 6e70     _re, _im = np
+00006760: 2e72 6561 6c28 636f 6c6f 7229 2c20 6e70  .real(color), np
+00006770: 2e69 6d61 6728 636f 6c6f 7229 0a20 2020  .imag(color).   
+00006780: 2020 2020 2020 2020 205f 7265 5b6e 702e           _re[np.
+00006790: 696e 7665 7274 286e 702e 6973 636c 6f73  invert(np.isclos
+000067a0: 6528 5f69 6d2c 206e 702e 7a65 726f 735f  e(_im, np.zeros_
+000067b0: 6c69 6b65 285f 696d 2929 295d 203d 206e  like(_im)))] = n
+000067c0: 702e 6e61 6e0a 2020 2020 2020 2020 2020  p.nan.          
+000067d0: 2020 7265 7475 726e 205f 7265 0a0a 2020    return _re..  
+000067e0: 2020 2020 2020 6e61 7267 7320 3d20 6172        nargs = ar
+000067f0: 6974 7928 7365 6c66 2e63 6f6c 6f72 5f66  ity(self.color_f
+00006800: 756e 6329 0a20 2020 2020 2020 2069 6620  unc).        if 
+00006810: 6e61 7267 7320 3d3d 2031 3a0a 2020 2020  nargs == 1:.    
+00006820: 2020 2020 2020 2020 6966 2073 656c 662e          if self.
+00006830: 6973 5f32 446c 696e 6520 616e 6420 7365  is_2Dline and se
+00006840: 6c66 2e69 735f 7061 7261 6d65 7472 6963  lf.is_parametric
+00006850: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+00006860: 2020 6966 206c 656e 2861 7267 7329 203d    if len(args) =
+00006870: 3d20 323a 0a20 2020 2020 2020 2020 2020  = 2:.           
+00006880: 2020 2020 2020 2020 2023 2043 6f6c 6f72           # Color
+00006890: 6564 4c69 6e65 4f76 6572 3144 5261 6e67  edLineOver1DRang
+000068a0: 6553 6572 6965 730a 2020 2020 2020 2020  eSeries.        
+000068b0: 2020 2020 2020 2020 2020 2020 7265 7475              retu
+000068c0: 726e 2073 656c 662e 5f63 6f72 7265 6374  rn self._correct
+000068d0: 5f73 6861 7065 280a 2020 2020 2020 2020  _shape(.        
+000068e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000068f0: 7365 6c66 2e63 6f6c 6f72 5f66 756e 6328  self.color_func(
+00006900: 6172 6773 5b30 5d29 2c20 6172 6773 5b30  args[0]), args[0
+00006910: 5d29 0a20 2020 2020 2020 2020 2020 2020  ]).             
+00006920: 2020 2023 2050 6172 616d 6574 7269 6332     # Parametric2
+00006930: 444c 696e 6553 6572 6965 730a 2020 2020  DLineSeries.    
+00006940: 2020 2020 2020 2020 2020 2020 7265 7475              retu
+00006950: 726e 2073 656c 662e 5f63 6f72 7265 6374  rn self._correct
+00006960: 5f73 6861 7065 2873 656c 662e 636f 6c6f  _shape(self.colo
+00006970: 725f 6675 6e63 2861 7267 735b 325d 292c  r_func(args[2]),
+00006980: 2061 7267 735b 325d 290a 2020 2020 2020   args[2]).      
+00006990: 2020 2020 2020 656c 6966 2073 656c 662e        elif self.
+000069a0: 6973 5f33 446c 696e 6520 616e 6420 7365  is_3Dline and se
+000069b0: 6c66 2e69 735f 7061 7261 6d65 7472 6963  lf.is_parametric
+000069c0: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+000069d0: 2020 7265 7475 726e 2073 656c 662e 5f63    return self._c
+000069e0: 6f72 7265 6374 5f73 6861 7065 2873 656c  orrect_shape(sel
+000069f0: 662e 636f 6c6f 725f 6675 6e63 2861 7267  f.color_func(arg
+00006a00: 735b 335d 292c 2061 7267 735b 335d 290a  s[3]), args[3]).
+00006a10: 2020 2020 2020 2020 2020 2020 656c 6966              elif
+00006a20: 2073 656c 662e 6973 5f33 4473 7572 6661   self.is_3Dsurfa
+00006a30: 6365 2061 6e64 2073 656c 662e 6973 5f70  ce and self.is_p
+00006a40: 6172 616d 6574 7269 633a 0a20 2020 2020  arametric:.     
+00006a50: 2020 2020 2020 2020 2020 2072 6574 7572             retur
+00006a60: 6e20 7365 6c66 2e5f 636f 7272 6563 745f  n self._correct_
+00006a70: 7368 6170 6528 7365 6c66 2e63 6f6c 6f72  shape(self.color
+00006a80: 5f66 756e 6328 6172 6773 5b33 5d29 2c20  _func(args[3]), 
+00006a90: 6172 6773 5b33 5d29 0a20 2020 2020 2020  args[3]).       
+00006aa0: 2020 2020 2072 6574 7572 6e20 7365 6c66       return self
+00006ab0: 2e5f 636f 7272 6563 745f 7368 6170 6528  ._correct_shape(
+00006ac0: 7365 6c66 2e63 6f6c 6f72 5f66 756e 6328  self.color_func(
+00006ad0: 6172 6773 5b30 5d29 2c20 6172 6773 5b30  args[0]), args[0
+00006ae0: 5d29 0a20 2020 2020 2020 2065 6c69 6620  ]).        elif 
+00006af0: 6e61 7267 7320 3d3d 2032 3a0a 2020 2020  nargs == 2:.    
+00006b00: 2020 2020 2020 2020 6966 2073 656c 662e          if self.
+00006b10: 6973 5f33 4473 7572 6661 6365 2061 6e64  is_3Dsurface and
+00006b20: 2073 656c 662e 6973 5f70 6172 616d 6574   self.is_paramet
+00006b30: 7269 633a 0a20 2020 2020 2020 2020 2020  ric:.           
+00006b40: 2020 2020 2072 6574 7572 6e20 7365 6c66       return self
+00006b50: 2e5f 636f 7272 6563 745f 7368 6170 6528  ._correct_shape(
+00006b60: 7365 6c66 2e63 6f6c 6f72 5f66 756e 6328  self.color_func(
+00006b70: 2a61 7267 735b 333a 5d29 2c20 6172 6773  *args[3:]), args
+00006b80: 5b33 5d29 0a20 2020 2020 2020 2020 2020  [3]).           
+00006b90: 2072 6574 7572 6e20 7365 6c66 2e5f 636f   return self._co
+00006ba0: 7272 6563 745f 7368 6170 6528 7365 6c66  rrect_shape(self
+00006bb0: 2e63 6f6c 6f72 5f66 756e 6328 2a61 7267  .color_func(*arg
+00006bc0: 735b 3a32 5d29 2c20 6172 6773 5b30 5d29  s[:2]), args[0])
+00006bd0: 0a20 2020 2020 2020 2072 6574 7572 6e20  .        return 
+00006be0: 7365 6c66 2e5f 636f 7272 6563 745f 7368  self._correct_sh
+00006bf0: 6170 6528 7365 6c66 2e63 6f6c 6f72 5f66  ape(self.color_f
+00006c00: 756e 6328 2a61 7267 735b 3a6e 6172 6773  unc(*args[:nargs
+00006c10: 5d29 2c20 6172 6773 5b30 5d29 0a0a 2020  ]), args[0])..  
+00006c20: 2020 6465 6620 6765 745f 6461 7461 2873    def get_data(s
+00006c30: 656c 6629 3a0a 2020 2020 2020 2020 2222  elf):.        ""
+00006c40: 2243 6f6d 7075 7465 2061 6e64 2072 6574  "Compute and ret
+00006c50: 7572 6e73 2074 6865 206e 756d 6572 6963  urns the numeric
+00006c60: 616c 2064 6174 612e 0a0a 2020 2020 2020  al data...      
+00006c70: 2020 5468 6520 6e75 6d62 6572 206f 6620    The number of 
+00006c80: 6172 7261 7973 2072 6574 7572 6e65 6420  arrays returned 
+00006c90: 6279 2074 6869 7320 6d65 7468 6f64 2064  by this method d
+00006ca0: 6570 656e 6473 206f 6e20 7468 650a 2020  epends on the.  
+00006cb0: 2020 2020 2020 7370 6563 6966 6963 2069        specific i
+00006cc0: 6e73 7461 6e63 652e 204c 6574 2060 6073  nstance. Let ``s
+00006cd0: 6060 2062 6520 616e 2069 6e73 7461 6e63  `` be an instanc
+00006ce0: 6520 6f66 2060 6042 6173 6553 6572 6965  e of ``BaseSerie
+00006cf0: 7360 602e 0a20 2020 2020 2020 204d 616b  s``..        Mak
+00006d00: 6520 7375 7265 2074 6f20 7265 6164 2060  e sure to read `
+00006d10: 6068 656c 7028 732e 6765 745f 6461 7461  `help(s.get_data
+00006d20: 2960 6020 746f 2075 6e64 6572 7374 616e  )`` to understan
+00006d30: 6420 7768 6174 2069 7420 7265 7475 726e  d what it return
+00006d40: 732e 0a20 2020 2020 2020 2022 2222 0a20  s..        """. 
+00006d50: 2020 2020 2020 2072 6169 7365 204e 6f74         raise Not
+00006d60: 496d 706c 656d 656e 7465 6445 7272 6f72  ImplementedError
+00006d70: 0a0a 2020 2020 6465 6620 5f67 6574 5f77  ..    def _get_w
+00006d80: 7261 7070 6564 5f6c 6162 656c 2873 656c  rapped_label(sel
+00006d90: 662c 206c 6162 656c 2c20 7772 6170 7065  f, label, wrappe
+00006da0: 7229 3a0a 2020 2020 2020 2020 2222 2247  r):.        """G
+00006db0: 6976 656e 2061 206c 6174 6578 2072 6570  iven a latex rep
+00006dc0: 7265 7365 6e74 6174 696f 6e20 6f66 2061  resentation of a
+00006dd0: 6e20 6578 7072 6573 7369 6f6e 2c20 7772  n expression, wr
+00006de0: 6170 2069 7420 696e 7369 6465 0a20 2020  ap it inside.   
+00006df0: 2020 2020 2073 6f6d 6520 6368 6172 6163       some charac
+00006e00: 7465 7273 2e20 4d61 7470 6c6f 746c 6962  ters. Matplotlib
+00006e10: 206e 6565 6473 2022 2425 7325 2422 2c20   needs "$%s%$", 
+00006e20: 4b33 442d 4a75 7079 7465 7220 6e65 6564  K3D-Jupyter need
+00006e30: 7320 2225 7322 2e0a 2020 2020 2020 2020  s "%s"..        
+00006e40: 2222 220a 2020 2020 2020 2020 7265 7475  """.        retu
+00006e50: 726e 2077 7261 7070 6572 2025 206c 6162  rn wrapper % lab
+00006e60: 656c 0a0a 2020 2020 6465 6620 6765 745f  el..    def get_
+00006e70: 6c61 6265 6c28 7365 6c66 2c20 7573 655f  label(self, use_
+00006e80: 6c61 7465 783d 4661 6c73 652c 2077 7261  latex=False, wra
+00006e90: 7070 6572 3d22 2425 7324 2229 3a0a 2020  pper="$%s$"):.  
+00006ea0: 2020 2020 2020 2222 2252 6574 7572 6e20        """Return 
+00006eb0: 7468 6520 6c61 6265 6c20 746f 2062 6520  the label to be 
+00006ec0: 7573 6564 2074 6f20 6469 7370 6c61 7920  used to display 
+00006ed0: 7468 6520 6578 7072 6573 7369 6f6e 2e0a  the expression..
+00006ee0: 0a20 2020 2020 2020 2050 6172 616d 6574  .        Paramet
+00006ef0: 6572 730a 2020 2020 2020 2020 3d3d 3d3d  ers.        ====
+00006f00: 3d3d 3d3d 3d3d 0a20 2020 2020 2020 2075  ======.        u
+00006f10: 7365 5f6c 6174 6578 203a 2062 6f6f 6c0a  se_latex : bool.
+00006f20: 2020 2020 2020 2020 2020 2020 4966 2046              If F
+00006f30: 616c 7365 2c20 7468 6520 7374 7269 6e67  alse, the string
+00006f40: 2072 6570 7265 7365 6e74 6174 696f 6e20   representation 
+00006f50: 6f66 2074 6865 2065 7870 7265 7373 696f  of the expressio
+00006f60: 6e20 6973 2072 6574 7572 6e65 642e 0a20  n is returned.. 
+00006f70: 2020 2020 2020 2020 2020 2049 6620 5472             If Tr
+00006f80: 7565 2c20 7468 6520 6c61 7465 7820 7265  ue, the latex re
+00006f90: 7072 6573 656e 7461 7469 6f6e 2069 7320  presentation is 
+00006fa0: 7265 7475 726e 6564 2e0a 2020 2020 2020  returned..      
+00006fb0: 2020 7772 6170 7065 7220 3a20 7374 720a    wrapper : str.
+00006fc0: 2020 2020 2020 2020 2020 2020 5468 6520              The 
+00006fd0: 6261 636b 656e 6420 6d69 6768 7420 6e65  backend might ne
+00006fe0: 6564 2074 6865 206c 6174 6578 2072 6570  ed the latex rep
+00006ff0: 7265 7365 6e74 6174 696f 6e20 746f 2062  resentation to b
+00007000: 6520 7772 6170 7065 6420 6279 0a20 2020  e wrapped by.   
+00007010: 2020 2020 2020 2020 2073 6f6d 6520 6368           some ch
+00007020: 6172 6163 7465 7273 2e20 4465 6661 756c  aracters. Defaul
+00007030: 7420 746f 2060 6022 2425 7324 2260 602e  t to ``"$%s$"``.
+00007040: 0a0a 2020 2020 2020 2020 5265 7475 726e  ..        Return
+00007050: 730a 2020 2020 2020 2020 3d3d 3d3d 3d3d  s.        ======
+00007060: 3d0a 2020 2020 2020 2020 6c61 6265 6c20  =.        label 
+00007070: 3a20 7374 720a 2020 2020 2020 2020 2222  : str.        ""
+00007080: 220a 2020 2020 2020 2020 6966 2075 7365  ".        if use
+00007090: 5f6c 6174 6578 2069 7320 4661 6c73 653a  _latex is False:
+000070a0: 0a20 2020 2020 2020 2020 2020 2072 6574  .            ret
+000070b0: 7572 6e20 7365 6c66 2e5f 6c61 6265 6c0a  urn self._label.
+000070c0: 2020 2020 2020 2020 6966 2073 656c 662e          if self.
+000070d0: 5f6c 6162 656c 203d 3d20 7374 7228 7365  _label == str(se
+000070e0: 6c66 2e65 7870 7229 3a0a 2020 2020 2020  lf.expr):.      
+000070f0: 2020 2020 2020 7265 7475 726e 2073 656c        return sel
+00007100: 662e 5f67 6574 5f77 7261 7070 6564 5f6c  f._get_wrapped_l
+00007110: 6162 656c 2873 656c 662e 5f6c 6174 6578  abel(self._latex
+00007120: 5f6c 6162 656c 2c20 7772 6170 7065 7229  _label, wrapper)
+00007130: 0a20 2020 2020 2020 2072 6574 7572 6e20  .        return 
+00007140: 7365 6c66 2e5f 6c61 7465 785f 6c61 6265  self._latex_labe
+00007150: 6c0a 0a20 2020 2040 7072 6f70 6572 7479  l..    @property
+00007160: 0a20 2020 2064 6566 206c 6162 656c 2873  .    def label(s
+00007170: 656c 6629 3a0a 2020 2020 2020 2020 7265  elf):.        re
+00007180: 7475 726e 2073 656c 662e 6765 745f 6c61  turn self.get_la
+00007190: 6265 6c28 290a 0a20 2020 2040 6c61 6265  bel()..    @labe
+000071a0: 6c2e 7365 7474 6572 0a20 2020 2064 6566  l.setter.    def
+000071b0: 206c 6162 656c 2873 656c 662c 2076 616c   label(self, val
+000071c0: 293a 0a20 2020 2020 2020 2022 2222 5365  ):.        """Se
+000071d0: 7420 7468 6520 6c61 6265 6c73 2061 7373  t the labels ass
+000071e0: 6f63 6961 7465 6420 746f 2074 6869 7320  ociated to this 
+000071f0: 7365 7269 6573 2e22 2222 0a20 2020 2020  series.""".     
+00007200: 2020 2023 204e 4f54 453a 2074 6865 2069     # NOTE: the i
+00007210: 6e69 7420 6d65 7468 6f64 206f 6620 616e  nit method of an
+00007220: 7920 7365 7269 6573 2072 6571 7569 7265  y series require
+00007230: 7320 6120 6c61 6265 6c2e 2049 6620 7468  s a label. If th
+00007240: 6520 7573 6572 2064 6f0a 2020 2020 2020  e user do.      
+00007250: 2020 2320 6e6f 7420 7072 6f76 6964 6520    # not provide 
+00007260: 6974 2c20 7468 6520 7072 6570 726f 6365  it, the preproce
+00007270: 7373 696e 6720 6675 6e63 7469 6f6e 2077  ssing function w
+00007280: 696c 6c20 7365 7420 6c61 6265 6c3d 4e6f  ill set label=No
+00007290: 6e65 2c20 7768 6963 680a 2020 2020 2020  ne, which.      
+000072a0: 2020 2320 696e 666f 726d 7320 7468 6520    # informs the 
+000072b0: 7365 7269 6573 2074 6f20 696e 6974 6961  series to initia
+000072c0: 6c69 7a65 2074 776f 2061 7474 7269 6275  lize two attribu
+000072d0: 7465 733a 0a20 2020 2020 2020 2023 205f  tes:.        # _
+000072e0: 6c61 6265 6c20 636f 6e74 6169 6e73 2074  label contains t
+000072f0: 6865 2073 7472 696e 6720 7265 7072 6573  he string repres
+00007300: 656e 7461 7469 6f6e 206f 6620 7468 6520  entation of the 
+00007310: 6578 7072 6573 7369 6f6e 2e0a 2020 2020  expression..    
+00007320: 2020 2020 2320 5f6c 6174 6578 5f6c 6162      # _latex_lab
+00007330: 656c 2063 6f6e 7461 696e 7320 7468 6520  el contains the 
+00007340: 6c61 7465 7820 7265 7072 6573 656e 7461  latex representa
+00007350: 7469 6f6e 206f 6620 7468 6520 6578 7072  tion of the expr
+00007360: 6573 7369 6f6e 2e0a 2020 2020 2020 2020  ession..        
+00007370: 7365 6c66 2e5f 6c61 6265 6c20 3d20 7365  self._label = se
+00007380: 6c66 2e5f 6c61 7465 785f 6c61 6265 6c20  lf._latex_label 
+00007390: 3d20 7661 6c0a 0a20 2020 2040 7072 6f70  = val..    @prop
+000073a0: 6572 7479 0a20 2020 2064 6566 2072 616e  erty.    def ran
+000073b0: 6765 7328 7365 6c66 293a 0a20 2020 2020  ges(self):.     
+000073c0: 2020 2072 6574 7572 6e20 7365 6c66 2e5f     return self._
+000073d0: 7261 6e67 6573 0a0a 2020 2020 4072 616e  ranges..    @ran
+000073e0: 6765 732e 7365 7474 6572 0a20 2020 2064  ges.setter.    d
+000073f0: 6566 2072 616e 6765 7328 7365 6c66 2c20  ef ranges(self, 
+00007400: 7661 6c29 3a0a 2020 2020 2020 2020 6e65  val):.        ne
+00007410: 775f 7661 6c73 203d 205b 5d0a 2020 2020  w_vals = [].    
+00007420: 2020 2020 666f 7220 7620 696e 2076 616c      for v in val
+00007430: 3a0a 2020 2020 2020 2020 2020 2020 6966  :.            if
+00007440: 2076 2069 7320 6e6f 7420 4e6f 6e65 3a0a   v is not None:.
+00007450: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00007460: 6e65 775f 7661 6c73 2e61 7070 656e 6428  new_vals.append(
+00007470: 7475 706c 6528 6d61 7028 7379 6d70 6966  tuple(map(sympif
+00007480: 792c 2076 2929 290a 0a20 2020 2020 2020  y, v)))..       
+00007490: 206e 756d 6265 7273 5f6f 725f 6578 7072   numbers_or_expr
+000074a0: 6573 7369 6f6e 7320 3d20 7365 7428 292e  essions = set().
+000074b0: 756e 696f 6e28 2a5b 6e76 5b31 3a5d 2066  union(*[nv[1:] f
+000074c0: 6f72 206e 7620 696e 206e 6577 5f76 616c  or nv in new_val
+000074d0: 735d 290a 2020 2020 2020 2020 6673 203d  s]).        fs =
+000074e0: 2073 6574 2829 2e75 6e69 6f6e 282a 5b65   set().union(*[e
+000074f0: 2e66 7265 655f 7379 6d62 6f6c 7320 666f  .free_symbols fo
+00007500: 7220 6520 696e 206e 756d 6265 7273 5f6f  r e in numbers_o
+00007510: 725f 6578 7072 6573 7369 6f6e 735d 290a  r_expressions]).
+00007520: 2020 2020 2020 2020 6966 206c 656e 2866          if len(f
+00007530: 7329 203e 2030 3a0a 2020 2020 2020 2020  s) > 0:.        
+00007540: 2020 2020 7365 6c66 2e5f 696e 7465 7261      self._intera
+00007550: 6374 6976 655f 7261 6e67 6573 203d 2054  ctive_ranges = T
+00007560: 7275 650a 2020 2020 2020 2020 7365 6c66  rue.        self
+00007570: 2e5f 7261 6e67 6573 203d 206e 6577 5f76  ._ranges = new_v
+00007580: 616c 730a 0a20 2020 2064 6566 205f 6170  als..    def _ap
+00007590: 706c 795f 7472 616e 7366 6f72 6d28 7365  ply_transform(se
+000075a0: 6c66 2c20 2a61 7267 7329 3a0a 2020 2020  lf, *args):.    
+000075b0: 2020 2020 2222 2241 7070 6c79 2074 7261      """Apply tra
+000075c0: 6e73 666f 726d 6174 696f 6e73 2074 6f20  nsformations to 
+000075d0: 7468 6520 7265 7375 6c74 7320 6f66 206e  the results of n
+000075e0: 756d 6572 6963 616c 2065 7661 6c75 6174  umerical evaluat
+000075f0: 696f 6e2e 0a0a 2020 2020 2020 2020 5061  ion...        Pa
+00007600: 7261 6d65 7465 7273 0a20 2020 2020 2020  rameters.       
+00007610: 203d 3d3d 3d3d 3d3d 3d3d 3d0a 2020 2020   ==========.    
+00007620: 2020 2020 6172 6773 203a 2074 7570 6c65      args : tuple
+00007630: 0a20 2020 2020 2020 2020 2020 2052 6573  .            Res
+00007640: 756c 7473 206f 6620 6e75 6d65 7269 6361  ults of numerica
+00007650: 6c20 6576 616c 7561 7469 6f6e 2e0a 0a20  l evaluation... 
+00007660: 2020 2020 2020 2052 6574 7572 6e73 0a20         Returns. 
+00007670: 2020 2020 2020 203d 3d3d 3d3d 3d3d 0a20         =======. 
+00007680: 2020 2020 2020 2074 7261 6e73 666f 726d         transform
+00007690: 6564 5f61 7267 7320 3a20 7475 706c 650a  ed_args : tuple.
+000076a0: 2020 2020 2020 2020 2020 2020 5475 706c              Tupl
+000076b0: 6520 636f 6e74 6169 6e69 6e67 2074 6865  e containing the
+000076c0: 2074 7261 6e73 666f 726d 6564 2072 6573   transformed res
+000076d0: 756c 7473 2e0a 2020 2020 2020 2020 2222  ults..        ""
+000076e0: 220a 2020 2020 2020 2020 7420 3d20 6c61  ".        t = la
+000076f0: 6d62 6461 2078 2c20 7472 616e 7366 6f72  mbda x, transfor
+00007700: 6d3a 2078 2069 6620 7472 616e 7366 6f72  m: x if transfor
+00007710: 6d20 6973 204e 6f6e 6520 656c 7365 2074  m is None else t
+00007720: 7261 6e73 666f 726d 2878 290a 2020 2020  ransform(x).    
+00007730: 2020 2020 782c 2079 2c20 7a20 3d20 4e6f      x, y, z = No
+00007740: 6e65 2c20 4e6f 6e65 2c20 4e6f 6e65 0a20  ne, None, None. 
+00007750: 2020 2020 2020 2069 6620 6c65 6e28 6172         if len(ar
+00007760: 6773 2920 3d3d 2032 3a0a 2020 2020 2020  gs) == 2:.      
+00007770: 2020 2020 2020 782c 2079 203d 2061 7267        x, y = arg
+00007780: 730a 2020 2020 2020 2020 2020 2020 7265  s.            re
+00007790: 7475 726e 2074 2878 2c20 7365 6c66 2e5f  turn t(x, self._
+000077a0: 7478 292c 2074 2879 2c20 7365 6c66 2e5f  tx), t(y, self._
+000077b0: 7479 290a 2020 2020 2020 2020 656c 6966  ty).        elif
+000077c0: 2028 0a20 2020 2020 2020 2020 2020 2028   (.            (
+000077d0: 6c65 6e28 6172 6773 2920 3d3d 2033 2920  len(args) == 3) 
+000077e0: 616e 6420 6973 696e 7374 616e 6365 2873  and isinstance(s
+000077f0: 656c 662c 2028 0a20 2020 2020 2020 2020  elf, (.         
+00007800: 2020 2020 2020 2050 6172 616d 6574 7269         Parametri
+00007810: 6332 444c 696e 6553 6572 6965 732c 2043  c2DLineSeries, C
+00007820: 6f6c 6f72 6564 4c69 6e65 4f76 6572 3144  oloredLineOver1D
+00007830: 5261 6e67 6553 6572 6965 732c 0a20 2020  RangeSeries,.   
+00007840: 2020 2020 2020 2020 2020 2020 2043 6f6c               Col
+00007850: 6f72 6564 5379 7374 656d 5265 7370 6f6e  oredSystemRespon
+00007860: 7365 5365 7269 6573 2929 0a20 2020 2020  seSeries)).     
+00007870: 2020 2029 3a0a 2020 2020 2020 2020 2020     ):.          
+00007880: 2020 782c 2079 2c20 7520 3d20 6172 6773    x, y, u = args
+00007890: 0a20 2020 2020 2020 2020 2020 2072 6574  .            ret
+000078a0: 7572 6e20 2874 2878 2c20 7365 6c66 2e5f  urn (t(x, self._
+000078b0: 7478 292c 2074 2879 2c20 7365 6c66 2e5f  tx), t(y, self._
+000078c0: 7479 292c 2074 2875 2c20 7365 6c66 2e5f  ty), t(u, self._
+000078d0: 7470 2929 0a20 2020 2020 2020 2065 6c69  tp)).        eli
+000078e0: 6620 6c65 6e28 6172 6773 2920 3d3d 2033  f len(args) == 3
+000078f0: 3a0a 2020 2020 2020 2020 2020 2020 782c  :.            x,
+00007900: 2079 2c20 7a20 3d20 6172 6773 0a20 2020   y, z = args.   
+00007910: 2020 2020 2020 2020 2072 6574 7572 6e20           return 
+00007920: 7428 782c 2073 656c 662e 5f74 7829 2c20  t(x, self._tx), 
+00007930: 7428 792c 2073 656c 662e 5f74 7929 2c20  t(y, self._ty), 
+00007940: 7428 7a2c 2073 656c 662e 5f74 7a29 0a20  t(z, self._tz). 
+00007950: 2020 2020 2020 2065 6c69 6620 286c 656e         elif (len
+00007960: 2861 7267 7329 203d 3d20 3429 2061 6e64  (args) == 4) and
+00007970: 2069 7369 6e73 7461 6e63 6528 7365 6c66   isinstance(self
+00007980: 2c20 5061 7261 6d65 7472 6963 3344 4c69  , Parametric3DLi
+00007990: 6e65 5365 7269 6573 293a 0a20 2020 2020  neSeries):.     
+000079a0: 2020 2020 2020 2078 2c20 792c 207a 2c20         x, y, z, 
+000079b0: 7520 3d20 6172 6773 0a20 2020 2020 2020  u = args.       
+000079c0: 2020 2020 2072 6574 7572 6e20 2874 2878       return (t(x
+000079d0: 2c20 7365 6c66 2e5f 7478 292c 2074 2879  , self._tx), t(y
+000079e0: 2c20 7365 6c66 2e5f 7479 292c 2074 287a  , self._ty), t(z
+000079f0: 2c20 7365 6c66 2e5f 747a 292c 2074 2875  , self._tz), t(u
+00007a00: 2c20 7365 6c66 2e5f 7470 2929 0a20 2020  , self._tp)).   
+00007a10: 2020 2020 2065 6c69 6620 6c65 6e28 6172       elif len(ar
+00007a20: 6773 2920 3d3d 2034 3a20 2023 2032 4420  gs) == 4:  # 2D 
+00007a30: 7665 6374 6f72 2070 6c6f 740a 2020 2020  vector plot.    
+00007a40: 2020 2020 2020 2020 782c 2079 2c20 752c          x, y, u,
+00007a50: 2076 203d 2061 7267 730a 2020 2020 2020   v = args.      
+00007a60: 2020 2020 2020 7265 7475 726e 2028 0a20        return (. 
+00007a70: 2020 2020 2020 2020 2020 2020 2020 2074                 t
+00007a80: 2878 2c20 7365 6c66 2e5f 7478 292c 2074  (x, self._tx), t
+00007a90: 2879 2c20 7365 6c66 2e5f 7479 292c 0a20  (y, self._ty),. 
+00007aa0: 2020 2020 2020 2020 2020 2020 2020 2074                 t
+00007ab0: 2875 2c20 7365 6c66 2e5f 7478 292c 2074  (u, self._tx), t
+00007ac0: 2876 2c20 7365 6c66 2e5f 7479 290a 2020  (v, self._ty).  
+00007ad0: 2020 2020 2020 2020 2020 290a 2020 2020            ).    
+00007ae0: 2020 2020 656c 6966 2028 6c65 6e28 6172      elif (len(ar
+00007af0: 6773 2920 3d3d 2035 2920 616e 6420 6973  gs) == 5) and is
+00007b00: 696e 7374 616e 6365 2873 656c 662c 2050  instance(self, P
+00007b10: 6172 616d 6574 7269 6353 7572 6661 6365  arametricSurface
+00007b20: 5365 7269 6573 293a 0a20 2020 2020 2020  Series):.       
+00007b30: 2020 2020 2078 2c20 792c 207a 2c20 752c       x, y, z, u,
+00007b40: 2076 203d 2061 7267 730a 2020 2020 2020   v = args.      
+00007b50: 2020 2020 2020 7265 7475 726e 2028 7428        return (t(
+00007b60: 782c 2073 656c 662e 5f74 7829 2c20 7428  x, self._tx), t(
+00007b70: 792c 2073 656c 662e 5f74 7929 2c20 7428  y, self._ty), t(
+00007b80: 7a2c 2073 656c 662e 5f74 7a29 2c20 752c  z, self._tz), u,
+00007b90: 2076 290a 2020 2020 2020 2020 656c 6966   v).        elif
+00007ba0: 2028 6c65 6e28 6172 6773 2920 3d3d 2036   (len(args) == 6
+00007bb0: 2920 616e 6420 7365 6c66 2e69 735f 3344  ) and self.is_3D
+00007bc0: 7665 6374 6f72 3a20 2023 2033 4420 7665  vector:  # 3D ve
+00007bd0: 6374 6f72 2070 6c6f 740a 2020 2020 2020  ctor plot.      
+00007be0: 2020 2020 2020 782c 2079 2c20 7a2c 2075        x, y, z, u
+00007bf0: 2c20 762c 2077 203d 2061 7267 730a 2020  , v, w = args.  
+00007c00: 2020 2020 2020 2020 2020 7265 7475 726e            return
+00007c10: 2028 0a20 2020 2020 2020 2020 2020 2020   (.             
+00007c20: 2020 2074 2878 2c20 7365 6c66 2e5f 7478     t(x, self._tx
+00007c30: 292c 2074 2879 2c20 7365 6c66 2e5f 7479  ), t(y, self._ty
+00007c40: 292c 2074 287a 2c20 7365 6c66 2e5f 747a  ), t(z, self._tz
+00007c50: 292c 0a20 2020 2020 2020 2020 2020 2020  ),.             
+00007c60: 2020 2074 2875 2c20 7365 6c66 2e5f 7478     t(u, self._tx
+00007c70: 292c 2074 2876 2c20 7365 6c66 2e5f 7479  ), t(v, self._ty
+00007c80: 292c 2074 2877 2c20 7365 6c66 2e5f 747a  ), t(w, self._tz
+00007c90: 290a 2020 2020 2020 2020 2020 2020 290a  ).            ).
+00007ca0: 2020 2020 2020 2020 656c 6966 206c 656e          elif len
+00007cb0: 2861 7267 7329 203d 3d20 363a 2020 2320  (args) == 6:  # 
+00007cc0: 636f 6d70 6c65 7820 706c 6f74 0a20 2020  complex plot.   
+00007cd0: 2020 2020 2020 2020 2078 2c20 792c 205f           x, y, _
+00007ce0: 6162 732c 205f 6172 672c 2069 6d67 2c20  abs, _arg, img, 
+00007cf0: 636f 6c6f 7273 203d 2061 7267 730a 2020  colors = args.  
+00007d00: 2020 2020 2020 2020 2020 7265 7475 726e            return
+00007d10: 2028 0a20 2020 2020 2020 2020 2020 2020   (.             
+00007d20: 2020 2074 2878 2c20 7365 6c66 2e5f 7478     t(x, self._tx
+00007d30: 292c 2074 2879 2c20 7365 6c66 2e5f 7479  ), t(y, self._ty
+00007d40: 292c 2074 285f 6162 732c 2073 656c 662e  ), t(_abs, self.
+00007d50: 5f74 7a29 2c0a 2020 2020 2020 2020 2020  _tz),.          
+00007d60: 2020 2020 2020 5f61 7267 2c20 696d 672c        _arg, img,
+00007d70: 2063 6f6c 6f72 730a 2020 2020 2020 2020   colors.        
+00007d80: 2020 2020 290a 2020 2020 2020 2020 7265      ).        re
+00007d90: 7475 726e 2061 7267 730a 0a20 2020 2064  turn args..    d
+00007da0: 6566 205f 7374 725f 6865 6c70 6572 2873  ef _str_helper(s
+00007db0: 656c 662c 2073 293a 0a20 2020 2020 2020  elf, s):.       
+00007dc0: 2070 7265 2c20 706f 7374 203d 2022 222c   pre, post = "",
+00007dd0: 2022 220a 2020 2020 2020 2020 6966 2073   "".        if s
+00007de0: 656c 662e 6973 5f69 6e74 6572 6163 7469  elf.is_interacti
+00007df0: 7665 3a0a 2020 2020 2020 2020 2020 2020  ve:.            
+00007e00: 7072 6520 3d20 2269 6e74 6572 6163 7469  pre = "interacti
+00007e10: 7665 2022 0a20 2020 2020 2020 2020 2020  ve ".           
+00007e20: 2070 6f73 7420 3d20 2220 616e 6420 7061   post = " and pa
+00007e30: 7261 6d65 7465 7273 2022 202b 2073 7472  rameters " + str
+00007e40: 2874 7570 6c65 2873 656c 662e 7061 7261  (tuple(self.para
+00007e50: 6d73 2e6b 6579 7328 2929 290a 2020 2020  ms.keys())).    
+00007e60: 2020 2020 7265 7475 726e 2070 7265 202b      return pre +
+00007e70: 2073 202b 2070 6f73 740a 0a0a 636c 6173   s + post...clas
+00007e80: 7320 436f 6d6d 6f6e 4164 6170 7469 7665  s CommonAdaptive
+00007e90: 4576 616c 7561 7469 6f6e 3a0a 2020 2020  Evaluation:.    
+00007ea0: 2222 2249 6620 6120 6461 7461 2073 6572  """If a data ser
+00007eb0: 6965 7320 7573 6573 2074 6865 2070 7974  ies uses the pyt
+00007ec0: 686f 6e2d 6164 6170 7469 7665 206d 6f64  hon-adaptive mod
+00007ed0: 756c 652c 2069 7420 7368 6f75 6c64 0a20  ule, it should. 
+00007ee0: 2020 2069 6e68 6572 6974 6820 6672 6f6d     inherith from
+00007ef0: 2074 6869 7320 6d69 7869 6e2e 0a20 2020   this mixin..   
+00007f00: 2022 2222 0a20 2020 205f 616c 6c6f 7765   """.    _allowe
+00007f10: 645f 6b65 7973 203d 205b 0a20 2020 2020  d_keys = [.     
+00007f20: 2020 2022 6164 6170 7469 7665 222c 2022     "adaptive", "
+00007f30: 6164 6170 7469 7665 5f67 6f61 6c22 2c20  adaptive_goal", 
+00007f40: 226c 6f73 735f 666e 220a 2020 2020 5d0a  "loss_fn".    ].
+00007f50: 0a20 2020 2064 6566 205f 5f69 6e69 745f  .    def __init_
+00007f60: 5f28 7365 6c66 2c20 2a61 7267 732c 202a  _(self, *args, *
+00007f70: 2a6b 7761 7267 7329 3a0a 2020 2020 2020  *kwargs):.      
+00007f80: 2020 7375 7065 7228 292e 5f5f 696e 6974    super().__init
+00007f90: 5f5f 282a 6172 6773 2c20 2a2a 6b77 6172  __(*args, **kwar
+00007fa0: 6773 290a 2020 2020 2020 2020 7365 6c66  gs).        self
+00007fb0: 2e61 6461 7074 6976 6520 3d20 6b77 6172  .adaptive = kwar
+00007fc0: 6773 2e67 6574 280a 2020 2020 2020 2020  gs.get(.        
+00007fd0: 2020 2020 2261 6461 7074 6976 6522 2c20      "adaptive", 
+00007fe0: 6366 675b 2261 6461 7074 6976 6522 5d5b  cfg["adaptive"][
+00007ff0: 2275 7365 645f 6279 5f64 6566 6175 6c74  "used_by_default
+00008000: 225d 290a 2020 2020 2020 2020 7365 6c66  "]).        self
+00008010: 2e61 6461 7074 6976 655f 676f 616c 203d  .adaptive_goal =
+00008020: 206b 7761 7267 732e 6765 7428 0a20 2020   kwargs.get(.   
+00008030: 2020 2020 2020 2020 2022 6164 6170 7469           "adapti
+00008040: 7665 5f67 6f61 6c22 2c20 6366 675b 2261  ve_goal", cfg["a
+00008050: 6461 7074 6976 6522 5d5b 2267 6f61 6c22  daptive"]["goal"
+00008060: 5d29 0a20 2020 2020 2020 2073 656c 662e  ]).        self.
+00008070: 6c6f 7373 5f66 6e20 3d20 6b77 6172 6773  loss_fn = kwargs
+00008080: 2e67 6574 2822 6c6f 7373 5f66 6e22 2c20  .get("loss_fn", 
+00008090: 4e6f 6e65 290a 0a0a 636c 6173 7320 436f  None)...class Co
+000080a0: 6d6d 6f6e 556e 6966 6f72 6d45 7661 6c75  mmonUniformEvalu
+000080b0: 6174 696f 6e3a 0a20 2020 2022 2222 4d61  ation:.    """Ma
+000080c0: 6e79 2070 6c6f 7474 696e 6720 6675 6e63  ny plotting func
+000080d0: 7469 6f6e 7320 7265 7365 6d62 6c65 2074  tions resemble t
+000080e0: 6869 7320 666f 726d 3a0a 0a20 2020 202e  his form:..    .
+000080f0: 2e20 636f 6465 2d62 6c6f 636b 3a3a 2070  . code-block:: p
+00008100: 7974 686f 6e0a 0a20 2020 2020 2020 706c  ython..       pl
+00008110: 6f74 5f66 756e 6374 696f 6e28 0a20 2020  ot_function(.   
+00008120: 2020 2020 2020 2020 6578 7072 312c 2065          expr1, e
+00008130: 7870 7232 205b 6f70 745d 2c20 2e2e 2e2c  xpr2 [opt], ...,
+00008140: 0a20 2020 2020 2020 2020 2020 7261 6e67  .           rang
+00008150: 6531 2c20 7261 6e67 6532 205b 6f70 745d  e1, range2 [opt]
+00008160: 2c20 2e2e 2e2c 0a20 2020 2020 2020 2020  , ...,.         
+00008170: 2020 7061 7261 6d73 3d64 6963 7428 290a    params=dict().
+00008180: 2020 2020 2020 2029 0a0a 2020 2020 4e61         )..    Na
+00008190: 6d65 6c79 2c20 7468 6572 6520 6172 6520  mely, there are 
+000081a0: 6f6e 6520 6f72 206d 6f72 6520 7379 6d62  one or more symb
+000081b0: 6f6c 6963 2065 7870 7265 7373 696f 6e73  olic expressions
+000081c0: 2074 6f20 7265 7072 6573 656e 7420 6120   to represent a 
+000081d0: 6375 7276 650a 2020 2020 6f72 2073 7572  curve.    or sur
+000081e0: 6661 6365 2c20 7468 6174 2073 686f 756c  face, that shoul
+000081f0: 6420 6265 2065 7661 6c75 6174 6564 206f  d be evaluated o
+00008200: 7665 7220 6f6e 6520 6f72 206d 6f72 6520  ver one or more 
+00008210: 7261 6e67 6573 2c20 7769 7468 207a 6572  ranges, with zer
+00008220: 6f0a 2020 2020 6f72 206d 6f72 6520 7061  o.    or more pa
+00008230: 7261 6d65 7465 7273 2028 7768 6f73 6520  rameters (whose 
+00008240: 7661 6c75 6573 2063 6f6d 6520 6672 6f6d  values come from
+00008250: 2069 6e74 6572 6163 7469 7665 2077 6964   interactive wid
+00008260: 6765 7473 292e 0a0a 2020 2020 5468 6973  gets)...    This
+00008270: 2063 6c61 7373 2061 7574 6f6d 6174 6573   class automates
+00008280: 2074 6865 2066 6f6c 6c6f 7769 6e67 2070   the following p
+00008290: 726f 6365 7373 6573 3a0a 0a20 2020 2031  rocesses:..    1
+000082a0: 2e20 4372 6561 7465 206c 616d 6264 6120  . Create lambda 
+000082b0: 6675 6e63 7469 6f6e 7320 6672 6f6d 2073  functions from s
+000082c0: 796d 626f 6c69 6320 6578 7072 6573 7369  ymbolic expressi
+000082d0: 6f6e 732e 2049 6e20 7061 7274 6963 756c  ons. In particul
+000082e0: 6172 2c20 6974 0a20 2020 2020 2020 6372  ar, it.       cr
+000082f0: 6561 7465 7320 6f6e 6520 6c61 6d62 6461  eates one lambda
+00008300: 2066 756e 6374 696f 6e20 746f 2062 6520   function to be 
+00008310: 6576 616c 7561 7465 6420 7769 7468 2074  evaluated with t
+00008320: 6865 2073 7065 6369 6669 6564 206d 6f64  he specified mod
+00008330: 756c 650a 2020 2020 2020 2028 7573 7561  ule.       (usua
+00008340: 6c6c 7920 4e75 6d50 7929 2c20 616e 6420  lly NumPy), and 
+00008350: 616e 6f74 6865 7220 6c61 6d62 6461 2066  another lambda f
+00008360: 756e 6374 696f 6e20 746f 2062 6520 6576  unction to be ev
+00008370: 616c 7561 7465 6420 7769 7468 0a20 2020  aluated with.   
+00008380: 2020 2020 5379 6d50 792c 2069 6e20 6361      SymPy, in ca
+00008390: 7365 2074 6865 7265 2061 7265 2061 6e79  se there are any
+000083a0: 2065 7272 6f72 7320 7769 7468 2074 6865   errors with the
+000083b0: 2066 6972 7374 2e0a 2020 2020 322e 2043   first..    2. C
+000083c0: 7265 6174 6520 6e75 6d65 7269 6361 6c20  reate numerical 
+000083d0: 6172 7261 7973 2072 6570 7265 7365 6e74  arrays represent
+000083e0: 696e 6720 7261 6e67 6573 2c20 6163 636f  ing ranges, acco
+000083f0: 7264 696e 6720 746f 2074 6865 2073 7065  rding to the spe
+00008400: 6369 6669 6564 0a20 2020 2020 2020 6469  cified.       di
+00008410: 7363 7265 7469 7a61 7469 6f6e 2073 7472  scretization str
+00008420: 6174 6567 7920 286c 696e 6561 7220 6f72  ategy (linear or
+00008430: 206c 6f67 6172 6974 686d 6963 292e 2055   logarithmic). U
+00008440: 7375 616c 6c79 2c20 7468 6573 6520 6172  sually, these ar
+00008450: 7261 7973 0a20 2020 2020 2020 6172 6520  rays.       are 
+00008460: 6f66 2074 7970 6520 636f 6d70 6c65 782c  of type complex,
+00008470: 2075 6e6c 6573 7320 6060 666f 7263 655f   unless ``force_
+00008480: 7265 616c 5f65 7661 6c3d 5472 7565 6060  real_eval=True``
+00008490: 2069 7320 7072 6f76 6964 6564 2069 6e20   is provided in 
+000084a0: 7468 650a 2020 2020 2020 2060 6070 6c6f  the.       ``plo
+000084b0: 745f 6675 6e63 7469 6f6e 6060 2063 616c  t_function`` cal
+000084c0: 6c2e 0a20 2020 2033 2e20 4576 616c 7561  l..    3. Evalua
+000084d0: 7465 2065 6163 6820 6c61 6d62 6461 2066  te each lambda f
+000084e0: 756e 6374 696f 6e20 7769 7468 2074 6865  unction with the
+000084f0: 2061 7070 726f 7072 6961 7465 2061 7272   appropriate arr
+00008500: 6179 7320 616e 640a 2020 2020 2020 2070  ays and.       p
+00008510: 6172 616d 6574 6572 732e 0a0a 2020 2020  arameters...    
+00008520: 4368 696c 6420 7365 7269 6573 2073 686f  Child series sho
+00008530: 756c 6420 6361 6c6c 2060 6073 656c 662e  uld call ``self.
+00008540: 5f65 7661 6c75 6174 6528 2960 6020 696e  _evaluate()`` in
+00008550: 206f 7264 6572 2074 6f20 6765 740a 2020   order to get.  
+00008560: 2020 6e75 6d65 7269 6361 6c20 6461 7461    numerical data
+00008570: 2c20 7768 6963 6820 7368 6f75 6c64 2074  , which should t
+00008580: 6865 6e20 6265 2070 6f73 742d 7072 6f63  hen be post-proc
+00008590: 6573 7365 642e 0a0a 2020 2020 4e6f 7465  essed...    Note
+000085a0: 3a20 6974 2773 206e 6f74 206d 616e 6461  : it's not manda
+000085b0: 746f 7279 2074 6f20 7573 6520 7468 6973  tory to use this
+000085c0: 2063 6c61 7373 2e20 466f 7220 6578 616d   class. For exam
+000085d0: 706c 652c 2063 6f6e 7472 6f6c 2073 7973  ple, control sys
+000085e0: 7465 6d0a 2020 2020 7265 6c61 7465 6420  tem.    related 
+000085f0: 6461 7461 2073 6572 6965 7320 646f 6e27  data series don'
+00008600: 7420 6e65 6564 2074 6869 7320 6d61 6368  t need this mach
+00008610: 696e 6572 792e 0a20 2020 2022 2222 0a0a  inery..    """..
+00008620: 2020 2020 5f61 6c6c 6f77 6564 5f6b 6579      _allowed_key
+00008630: 7320 3d20 5b0a 2020 2020 2020 2020 2266  s = [.        "f
+00008640: 6f72 6365 5f72 6561 6c5f 6576 616c 222c  orce_real_eval",
+00008650: 2022 6f6e 6c79 5f69 6e74 6567 6572 7322   "only_integers"
+00008660: 2c20 226d 6f64 756c 6573 222c 2022 6973  , "modules", "is
+00008670: 5f70 6f6c 6172 220a 2020 2020 5d0a 0a20  _polar".    ].. 
+00008680: 2020 2064 6566 205f 5f69 6e69 745f 5f28     def __init__(
+00008690: 7365 6c66 2c20 2a61 7267 732c 202a 2a6b  self, *args, **k
+000086a0: 7761 7267 7329 3a0a 2020 2020 2020 2020  wargs):.        
+000086b0: 7375 7065 7228 292e 5f5f 696e 6974 5f5f  super().__init__
+000086c0: 282a 6172 6773 2c20 2a2a 6b77 6172 6773  (*args, **kwargs
+000086d0: 290a 2020 2020 2020 2020 2320 6c69 7374  ).        # list
+000086e0: 206f 6620 6e75 6d65 7269 6361 6c20 6675   of numerical fu
+000086f0: 6e63 7469 6f6e 7320 7265 7072 6573 656e  nctions represen
+00008700: 7469 6e67 2074 6865 2065 7870 7265 7373  ting the express
+00008710: 696f 6e73 2074 6f20 6576 616c 7561 7465  ions to evaluate
+00008720: 0a20 2020 2020 2020 2073 656c 662e 5f66  .        self._f
+00008730: 756e 6374 696f 6e73 203d 205b 5d0a 2020  unctions = [].  
+00008740: 2020 2020 2020 2320 7369 676e 6174 7572        # signatur
+00008750: 6520 6f66 2066 6f72 2074 6865 206e 756d  e of for the num
+00008760: 6572 6963 616c 2066 756e 6374 696f 6e73  erical functions
+00008770: 0a20 2020 2020 2020 2073 656c 662e 5f73  .        self._s
+00008780: 6967 6e61 7475 7265 203d 205b 5d0a 2020  ignature = [].  
+00008790: 2020 2020 2020 2320 736f 6d65 2065 7870        # some exp
+000087a0: 7265 7373 696f 6e73 2064 6f6e 2774 206c  ressions don't l
+000087b0: 696b 6520 746f 2062 6520 6576 616c 7561  ike to be evalua
+000087c0: 7465 6420 6f76 6572 2063 6f6d 706c 6578  ted over complex
+000087d0: 2064 6174 612e 0a20 2020 2020 2020 2023   data..        #
+000087e0: 2069 6620 7468 6174 2773 2074 6865 2063   if that's the c
+000087f0: 6173 652c 2073 6574 2074 6869 7320 746f  ase, set this to
+00008800: 2054 7275 650a 2020 2020 2020 2020 7365   True.        se
+00008810: 6c66 2e5f 666f 7263 655f 7265 616c 5f65  lf._force_real_e
+00008820: 7661 6c20 3d20 6b77 6172 6773 2e67 6574  val = kwargs.get
+00008830: 2822 666f 7263 655f 7265 616c 5f65 7661  ("force_real_eva
+00008840: 6c22 2c20 4e6f 6e65 290a 2020 2020 2020  l", None).      
+00008850: 2020 2320 6576 656e 7475 616c 6c79 2069    # eventually i
+00008860: 7420 7769 6c6c 2063 6f6e 7461 696e 2061  t will contain a
+00008870: 2064 6963 7469 6f6e 6172 7920 7769 7468   dictionary with
+00008880: 2074 6865 2064 6973 6372 6574 697a 6564   the discretized
+00008890: 2072 616e 6765 730a 2020 2020 2020 2020   ranges.        
+000088a0: 7365 6c66 2e5f 6469 7363 7265 7469 7a65  self._discretize
+000088b0: 645f 646f 6d61 696e 203d 204e 6f6e 650a  d_domain = None.
+000088c0: 2020 2020 2020 2020 2320 4e4f 5445 3a20          # NOTE: 
+000088d0: 636f 6e73 6964 6572 2061 2067 656e 6572  consider a gener
+000088e0: 6963 2073 756d 6d61 7469 6f6e 2c20 666f  ic summation, fo
+000088f0: 7220 6578 616d 706c 653a 0a20 2020 2020  r example:.     
+00008900: 2020 2023 2020 2073 203d 2053 756d 2863     #   s = Sum(c
+00008910: 6f73 2870 6920 2a20 7829 2c20 2878 2c20  os(pi * x), (x, 
+00008920: 312c 2079 2929 0a20 2020 2020 2020 2023  1, y)).        #
+00008930: 2054 6869 7320 6765 7473 206c 616d 6264   This gets lambd
+00008940: 6966 6965 6420 746f 2073 6f6d 6574 6869  ified to somethi
+00008950: 6e67 3a0a 2020 2020 2020 2020 2320 2020  ng:.        #   
+00008960: 7375 6d28 636f 7328 7069 2a78 2920 666f  sum(cos(pi*x) fo
+00008970: 7220 7820 696e 2072 616e 6765 2831 2c20  r x in range(1, 
+00008980: 792b 3129 290a 2020 2020 2020 2020 2320  y+1)).        # 
+00008990: 4865 6e63 652c 2079 206e 6565 6473 2074  Hence, y needs t
+000089a0: 6f20 6265 2061 6e20 696e 7465 6765 722c  o be an integer,
+000089b0: 206f 7468 6572 7769 7365 2069 7420 7261   otherwise it ra
+000089c0: 6973 6573 3a0a 2020 2020 2020 2020 2320  ises:.        # 
+000089d0: 2020 5479 7065 4572 726f 723a 2027 636f    TypeError: 'co
+000089e0: 6d70 6c65 7827 206f 626a 6563 7420 6361  mplex' object ca
+000089f0: 6e6e 6f74 2062 6520 696e 7465 7270 7265  nnot be interpre
+00008a00: 7465 6420 6173 2061 6e20 696e 7465 6765  ted as an intege
+00008a10: 720a 2020 2020 2020 2020 2320 5468 6973  r.        # This
+00008a20: 206c 6973 7420 7769 6c6c 2063 6f6e 7461   list will conta
+00008a30: 696e 7320 7379 6d62 6f6c 7320 7468 6174  ins symbols that
+00008a40: 2061 7265 2075 7070 6572 2062 6f75 6e64   are upper bound
+00008a50: 2074 6f20 7375 6d6d 6174 696f 6e73 0a20   to summations. 
+00008a60: 2020 2020 2020 2023 206f 7220 7072 6f64         # or prod
+00008a70: 7563 7473 0a20 2020 2020 2020 2073 656c  ucts.        sel
+00008a80: 662e 5f6e 6565 6473 5f74 6f5f 6265 5f69  f._needs_to_be_i
+00008a90: 6e74 203d 205b 5d0a 2020 2020 2020 2020  nt = [].        
+00008aa0: 2320 6469 7363 7265 7469 7a65 2074 6865  # discretize the
+00008ab0: 2064 6f6d 6169 6e20 7573 696e 6720 6f6e   domain using on
+00008ac0: 6c79 2069 6e74 6567 6572 206e 756d 6265  ly integer numbe
+00008ad0: 7273 0a20 2020 2020 2020 2073 656c 662e  rs.        self.
+00008ae0: 6f6e 6c79 5f69 6e74 6567 6572 7320 3d20  only_integers = 
+00008af0: 6b77 6172 6773 2e67 6574 2822 6f6e 6c79  kwargs.get("only
+00008b00: 5f69 6e74 6567 6572 7322 2c20 4661 6c73  _integers", Fals
+00008b10: 6529 0a20 2020 2020 2020 2069 6620 6861  e).        if ha
+00008b20: 7361 7474 7228 7365 6c66 2c20 2261 6461  sattr(self, "ada
+00008b30: 7074 6976 6522 2920 616e 6420 7365 6c66  ptive") and self
+00008b40: 2e61 6461 7074 6976 6520 616e 6420 7365  .adaptive and se
+00008b50: 6c66 2e6f 6e6c 795f 696e 7465 6765 7273  lf.only_integers
+00008b60: 3a0a 2020 2020 2020 2020 2020 2020 7761  :.            wa
+00008b70: 726e 696e 6773 2e77 6172 6e28 0a20 2020  rnings.warn(.   
+00008b80: 2020 2020 2020 2020 2020 2020 2022 6060               "``
+00008b90: 6f6e 6c79 5f69 6e74 6567 6572 733d 5472  only_integers=Tr
+00008ba0: 7565 6060 2069 7320 6e6f 7420 7375 7070  ue`` is not supp
+00008bb0: 6f72 7465 6420 6279 2074 6865 2061 6461  orted by the ada
+00008bc0: 7074 6976 6520 220a 2020 2020 2020 2020  ptive ".        
+00008bd0: 2020 2020 2020 2020 2261 6c67 6f72 6974          "algorit
+00008be0: 686d 2e20 4175 746f 6d61 7469 6361 6c6c  hm. Automaticall
+00008bf0: 7920 7365 7474 696e 6720 6060 6164 6170  y setting ``adap
+00008c00: 7469 7665 3d46 616c 7365 6060 2e22 0a20  tive=False``.". 
+00008c10: 2020 2020 2020 2020 2020 2029 0a20 2020             ).   
+00008c20: 2020 2020 2020 2020 2073 656c 662e 6164           self.ad
+00008c30: 6170 7469 7665 203d 2046 616c 7365 0a20  aptive = False. 
+00008c40: 2020 2020 2020 2023 2072 6570 7265 7365         # represe
+00008c50: 6e74 7320 7468 6520 6576 616c 7561 7469  nts the evaluati
+00008c60: 6f6e 206d 6f64 756c 6573 2074 6f20 6265  on modules to be
+00008c70: 2075 7365 6420 6279 206c 616d 6264 6966   used by lambdif
+00008c80: 790a 2020 2020 2020 2020 7365 6c66 2e6d  y.        self.m
+00008c90: 6f64 756c 6573 203d 206b 7761 7267 732e  odules = kwargs.
+00008ca0: 6765 7428 226d 6f64 756c 6573 222c 204e  get("modules", N
+00008cb0: 6f6e 6529 0a20 2020 2020 2020 2023 2049  one).        # I
+00008cc0: 6620 5472 7565 2c20 7468 6520 6261 636b  f True, the back
+00008cd0: 656e 6420 7769 6c6c 2061 7474 656d 7074  end will attempt
+00008ce0: 2074 6f20 7265 6e64 6572 2069 7420 6f6e   to render it on
+00008cf0: 2061 2070 6f6c 6172 2d70 726f 6a65 6374   a polar-project
+00008d00: 696f 6e0a 2020 2020 2020 2020 2320 6178  ion.        # ax
+00008d10: 6973 2c20 6f72 2075 7369 6e67 2061 2070  is, or using a p
+00008d20: 6f6c 6172 2064 6973 6372 6574 697a 6174  olar discretizat
+00008d30: 696f 6e20 6966 2061 2033 4420 706c 6f74  ion if a 3D plot
+00008d40: 2069 7320 7265 7175 6573 7465 640a 2020   is requested.  
+00008d50: 2020 2020 2020 7365 6c66 2e69 735f 706f        self.is_po
+00008d60: 6c61 7220 3d20 6b77 6172 6773 2e67 6574  lar = kwargs.get
+00008d70: 2822 6973 5f70 6f6c 6172 222c 2046 616c  ("is_polar", Fal
+00008d80: 7365 290a 0a20 2020 2064 6566 205f 6372  se)..    def _cr
+00008d90: 6561 7465 5f6c 616d 6264 615f 6675 6e63  eate_lambda_func
+00008da0: 2873 656c 6629 3a0a 2020 2020 2020 2020  (self):.        
+00008db0: 2222 2243 7265 6174 6520 7468 6520 6c61  """Create the la
+00008dc0: 6d62 6461 2066 756e 6374 696f 6e73 2074  mbda functions t
+00008dd0: 6f20 6265 2075 7365 6420 6279 2074 6865  o be used by the
+00008de0: 2075 6e69 666f 726d 206d 6573 6869 6e67   uniform meshing
+00008df0: 0a20 2020 2020 2020 2073 7472 6174 6567  .        strateg
+00008e00: 792e 0a20 2020 2020 2020 2022 2222 0a20  y..        """. 
+00008e10: 2020 2020 2020 2065 7870 7273 203d 2073         exprs = s
+00008e20: 656c 662e 6578 7072 2069 6620 6861 7361  elf.expr if hasa
+00008e30: 7474 7228 7365 6c66 2e65 7870 722c 2022  ttr(self.expr, "
+00008e40: 5f5f 6974 6572 5f5f 2229 2065 6c73 6520  __iter__") else 
+00008e50: 5b73 656c 662e 6578 7072 5d0a 2020 2020  [self.expr].    
+00008e60: 2020 2020 6966 206e 6f74 2061 6e79 2863      if not any(c
+00008e70: 616c 6c61 626c 6528 6529 2066 6f72 2065  allable(e) for e
+00008e80: 2069 6e20 6578 7072 7329 3a0a 2020 2020   in exprs):.    
+00008e90: 2020 2020 2020 2020 6673 203d 205f 6765          fs = _ge
+00008ea0: 745f 6672 6565 5f73 796d 626f 6c73 2865  t_free_symbols(e
+00008eb0: 7870 7273 290a 2020 2020 2020 2020 2020  xprs).          
+00008ec0: 2020 7365 6c66 2e5f 7369 676e 6174 7572    self._signatur
+00008ed0: 6520 3d20 736f 7274 6564 2866 732c 206b  e = sorted(fs, k
+00008ee0: 6579 3d6c 616d 6264 6120 743a 2074 2e6e  ey=lambda t: t.n
+00008ef0: 616d 6529 0a0a 2020 2020 2020 2020 2020  ame)..          
+00008f00: 2020 2320 4765 6e65 7261 7465 2061 206c    # Generate a l
+00008f10: 6973 7420 6f66 206c 616d 6264 6120 6675  ist of lambda fu
+00008f20: 6e63 7469 6f6e 732c 2074 776f 2066 6f72  nctions, two for
+00008f30: 2065 6163 6820 6578 7072 6573 7369 6f6e   each expression
+00008f40: 3a0a 2020 2020 2020 2020 2020 2020 2320  :.            # 
+00008f50: 312e 2074 6865 2064 6566 6175 6c74 206f  1. the default o
+00008f60: 6e65 2e0a 2020 2020 2020 2020 2020 2020  ne..            
+00008f70: 2320 322e 2074 6865 2062 6163 6b75 7020  # 2. the backup 
+00008f80: 6f6e 652c 2069 6e20 6361 7365 206f 6620  one, in case of 
+00008f90: 6661 696c 7572 6573 2077 6974 6820 7468  failures with th
+00008fa0: 6520 6465 6661 756c 7420 6f6e 652e 0a20  e default one.. 
+00008fb0: 2020 2020 2020 2020 2020 2073 656c 662e             self.
+00008fc0: 5f66 756e 6374 696f 6e73 203d 205b 5d0a  _functions = [].
+00008fd0: 2020 2020 2020 2020 2020 2020 666f 7220              for 
+00008fe0: 6520 696e 2065 7870 7273 3a0a 2020 2020  e in exprs:.    
+00008ff0: 2020 2020 2020 2020 2020 2020 2320 544f              # TO
+00009000: 444f 3a20 7365 7420 6373 653d 5472 7565  DO: set cse=True
+00009010: 206f 6e63 6520 7468 6973 2069 7373 7565   once this issue
+00009020: 2069 7320 736f 6c76 6564 3a0a 2020 2020   is solved:.    
+00009030: 2020 2020 2020 2020 2020 2020 2320 6874              # ht
+00009040: 7470 733a 2f2f 6769 7468 7562 2e63 6f6d  tps://github.com
+00009050: 2f73 796d 7079 2f73 796d 7079 2f69 7373  /sympy/sympy/iss
+00009060: 7565 732f 3234 3234 360a 2020 2020 2020  ues/24246.      
+00009070: 2020 2020 2020 2020 2020 7365 6c66 2e5f            self._
+00009080: 6675 6e63 7469 6f6e 732e 6170 7065 6e64  functions.append
+00009090: 285b 0a20 2020 2020 2020 2020 2020 2020  ([.             
+000090a0: 2020 2020 2020 206c 616d 6264 6966 7928         lambdify(
+000090b0: 7365 6c66 2e5f 7369 676e 6174 7572 652c  self._signature,
+000090c0: 2065 2c20 6d6f 6475 6c65 733d 7365 6c66   e, modules=self
+000090d0: 2e6d 6f64 756c 6573 292c 0a20 2020 2020  .modules),.     
+000090e0: 2020 2020 2020 2020 2020 2020 2020 206c                 l
+000090f0: 616d 6264 6966 7928 7365 6c66 2e5f 7369  ambdify(self._si
+00009100: 676e 6174 7572 652c 2065 2c20 6d6f 6475  gnature, e, modu
+00009110: 6c65 733d 2273 796d 7079 222c 2064 756d  les="sympy", dum
+00009120: 6d69 6679 3d54 7275 6529 2c0a 2020 2020  mify=True),.    
+00009130: 2020 2020 2020 2020 2020 2020 5d29 0a20              ]). 
+00009140: 2020 2020 2020 2065 6c73 653a 0a20 2020         else:.   
+00009150: 2020 2020 2020 2020 2073 656c 662e 5f73           self._s
+00009160: 6967 6e61 7475 7265 203d 2073 6f72 7465  ignature = sorte
+00009170: 6428 5b72 5b30 5d20 666f 7220 7220 696e  d([r[0] for r in
+00009180: 2073 656c 662e 7261 6e67 6573 5d2c 206b   self.ranges], k
+00009190: 6579 3d6c 616d 6264 6120 743a 2074 2e6e  ey=lambda t: t.n
+000091a0: 616d 6529 0a20 2020 2020 2020 2020 2020  ame).           
+000091b0: 2073 656c 662e 5f66 756e 6374 696f 6e73   self._functions
+000091c0: 203d 205b 2865 2c20 4e6f 6e65 2920 666f   = [(e, None) fo
+000091d0: 7220 6520 696e 2065 7870 7273 5d0a 0a20  r e in exprs].. 
+000091e0: 2020 2020 2020 2023 2064 6561 6c20 7769         # deal wi
+000091f0: 7468 2073 796d 626f 6c69 6320 636f 6c6f  th symbolic colo
+00009200: 725f 6675 6e63 0a20 2020 2020 2020 2069  r_func.        i
+00009210: 6620 6973 696e 7374 616e 6365 2873 656c  f isinstance(sel
+00009220: 662e 636f 6c6f 725f 6675 6e63 2c20 4578  f.color_func, Ex
+00009230: 7072 293a 0a20 2020 2020 2020 2020 2020  pr):.           
+00009240: 2073 656c 662e 636f 6c6f 725f 6675 6e63   self.color_func
+00009250: 203d 206c 616d 6264 6966 7928 7365 6c66   = lambdify(self
+00009260: 2e5f 7369 676e 6174 7572 652c 2073 656c  ._signature, sel
+00009270: 662e 636f 6c6f 725f 6675 6e63 290a 2020  f.color_func).  
+00009280: 2020 2020 2020 2020 2020 7365 6c66 2e5f            self._
+00009290: 6576 616c 5f63 6f6c 6f72 5f66 756e 635f  eval_color_func_
+000092a0: 7769 7468 5f73 6967 6e61 7475 7265 203d  with_signature =
+000092b0: 2054 7275 650a 0a20 2020 2064 6566 205f   True..    def _
+000092c0: 6372 6561 7465 5f64 6973 6372 6574 697a  create_discretiz
+000092d0: 6564 5f64 6f6d 6169 6e28 7365 6c66 293a  ed_domain(self):
+000092e0: 0a20 2020 2020 2020 2022 2222 4469 7363  .        """Disc
+000092f0: 7265 7469 7a65 2074 6865 2072 616e 6765  retize the range
+00009300: 7320 666f 7220 756e 6966 6f72 6d20 6d65  s for uniform me
+00009310: 7368 696e 6720 7374 7261 7465 6779 2e0a  shing strategy..
+00009320: 2020 2020 2020 2020 2222 220a 2020 2020          """.    
+00009330: 2020 2020 2320 4e4f 5445 3a20 7468 6520      # NOTE: the 
+00009340: 676f 616c 2069 7320 746f 2063 7265 6174  goal is to creat
+00009350: 6520 6120 6469 6374 696f 6e61 7279 2073  e a dictionary s
+00009360: 746f 7265 6420 696e 0a20 2020 2020 2020  tored in.       
+00009370: 2023 2073 656c 662e 5f64 6973 6372 6574   # self._discret
+00009380: 697a 6564 5f64 6f6d 6169 6e2c 206d 6170  ized_domain, map
+00009390: 7069 6e67 2073 796d 626f 6c73 2074 6f20  ping symbols to 
+000093a0: 6120 6e75 6d70 7920 6172 7261 790a 2020  a numpy array.  
+000093b0: 2020 2020 2020 2320 7265 7072 6573 656e        # represen
+000093c0: 7469 6e67 2074 6865 2064 6973 6372 6574  ting the discret
+000093d0: 697a 6174 696f 6e0a 2020 2020 2020 2020  ization.        
+000093e0: 6469 7363 725f 7379 6d62 6f6c 7320 3d20  discr_symbols = 
+000093f0: 5b5d 0a20 2020 2020 2020 2064 6973 6372  [].        discr
+00009400: 6574 697a 6174 696f 6e73 203d 205b 5d0a  etizations = [].
+00009410: 0a20 2020 2020 2020 2023 2063 7265 6174  .        # creat
+00009420: 6520 6120 3144 2064 6973 6372 6574 697a  e a 1D discretiz
+00009430: 6174 696f 6e0a 2020 2020 2020 2020 666f  ation.        fo
+00009440: 7220 692c 2072 2069 6e20 656e 756d 6572  r i, r in enumer
+00009450: 6174 6528 7365 6c66 2e72 616e 6765 7329  ate(self.ranges)
+00009460: 3a0a 2020 2020 2020 2020 2020 2020 6469  :.            di
+00009470: 7363 725f 7379 6d62 6f6c 732e 6170 7065  scr_symbols.appe
+00009480: 6e64 2872 5b30 5d29 0a20 2020 2020 2020  nd(r[0]).       
+00009490: 2020 2020 2063 5f73 7461 7274 203d 2073       c_start = s
+000094a0: 656c 662e 5f75 7064 6174 655f 7261 6e67  elf._update_rang
+000094b0: 655f 7661 6c75 6528 725b 315d 290a 2020  e_value(r[1]).  
+000094c0: 2020 2020 2020 2020 2020 635f 656e 6420            c_end 
+000094d0: 3d20 7365 6c66 2e5f 7570 6461 7465 5f72  = self._update_r
+000094e0: 616e 6765 5f76 616c 7565 2872 5b32 5d29  ange_value(r[2])
+000094f0: 0a20 2020 2020 2020 2020 2020 2073 7461  .            sta
+00009500: 7274 203d 2063 5f73 7461 7274 2e72 6561  rt = c_start.rea
+00009510: 6c20 6966 2063 5f73 7461 7274 2e69 6d61  l if c_start.ima
+00009520: 6720 3d3d 2063 5f65 6e64 2e69 6d61 6720  g == c_end.imag 
+00009530: 3d3d 2030 2065 6c73 6520 635f 7374 6172  == 0 else c_star
+00009540: 740a 2020 2020 2020 2020 2020 2020 656e  t.            en
+00009550: 6420 3d20 635f 656e 642e 7265 616c 2069  d = c_end.real i
+00009560: 6620 635f 7374 6172 742e 696d 6167 203d  f c_start.imag =
+00009570: 3d20 635f 656e 642e 696d 6167 203d 3d20  = c_end.imag == 
+00009580: 3020 656c 7365 2063 5f65 6e64 0a20 2020  0 else c_end.   
+00009590: 2020 2020 2020 2020 206e 6565 6473 5f69           needs_i
+000095a0: 6e74 6567 6572 5f64 6973 6372 203d 2073  nteger_discr = s
+000095b0: 656c 662e 6f6e 6c79 5f69 6e74 6567 6572  elf.only_integer
+000095c0: 7320 6f72 2028 725b 305d 2069 6e20 7365  s or (r[0] in se
+000095d0: 6c66 2e5f 6e65 6564 735f 746f 5f62 655f  lf._needs_to_be_
+000095e0: 696e 7429 0a20 2020 2020 2020 2020 2020  int).           
+000095f0: 2064 203d 2042 6173 6553 6572 6965 732e   d = BaseSeries.
+00009600: 5f64 6973 6372 6574 697a 6528 0a20 2020  _discretize(.   
+00009610: 2020 2020 2020 2020 2020 2020 2073 7461               sta
+00009620: 7274 2c20 656e 642c 2073 656c 662e 6e5b  rt, end, self.n[
+00009630: 695d 2c0a 2020 2020 2020 2020 2020 2020  i],.            
+00009640: 2020 2020 7363 616c 653d 7365 6c66 2e73      scale=self.s
+00009650: 6361 6c65 735b 695d 2c0a 2020 2020 2020  cales[i],.      
+00009660: 2020 2020 2020 2020 2020 6f6e 6c79 5f69            only_i
+00009670: 6e74 6567 6572 733d 6e65 6564 735f 696e  ntegers=needs_in
+00009680: 7465 6765 725f 6469 7363 720a 2020 2020  teger_discr.    
+00009690: 2020 2020 2020 2020 290a 0a20 2020 2020          )..     
+000096a0: 2020 2020 2020 2069 6620 280a 2020 2020         if (.    
+000096b0: 2020 2020 2020 2020 2020 2020 286e 6f74              (not
+000096c0: 2073 656c 662e 5f66 6f72 6365 5f72 6561   self._force_rea
+000096d0: 6c5f 6576 616c 2920 616e 640a 2020 2020  l_eval) and.    
+000096e0: 2020 2020 2020 2020 2020 2020 286e 6f74              (not
+000096f0: 206e 6565 6473 5f69 6e74 6567 6572 5f64   needs_integer_d
+00009700: 6973 6372 2920 616e 640a 2020 2020 2020  iscr) and.      
+00009710: 2020 2020 2020 2020 2020 2864 2e64 7479            (d.dty
+00009720: 7065 2021 3d20 2263 6f6d 706c 6578 2229  pe != "complex")
+00009730: 0a20 2020 2020 2020 2020 2020 2029 3a0a  .            ):.
+00009740: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00009750: 6420 3d20 6420 2b20 316a 202a 2063 5f73  d = d + 1j * c_s
+00009760: 7461 7274 2e69 6d61 670a 0a20 2020 2020  tart.imag..     
+00009770: 2020 2020 2020 2069 6620 6e65 6564 735f         if needs_
+00009780: 696e 7465 6765 725f 6469 7363 723a 0a20  integer_discr:. 
+00009790: 2020 2020 2020 2020 2020 2020 2020 2064                 d
+000097a0: 203d 2064 2e61 7374 7970 6528 696e 7429   = d.astype(int)
+000097b0: 0a0a 2020 2020 2020 2020 2020 2020 6469  ..            di
+000097c0: 7363 7265 7469 7a61 7469 6f6e 732e 6170  scretizations.ap
+000097d0: 7065 6e64 2864 290a 0a20 2020 2020 2020  pend(d)..       
+000097e0: 2023 2063 7265 6174 6520 3244 206f 7220   # create 2D or 
+000097f0: 3344 0a20 2020 2020 2020 2073 656c 662e  3D.        self.
+00009800: 5f63 7265 6174 655f 6469 7363 7265 7469  _create_discreti
+00009810: 7a65 645f 646f 6d61 696e 5f68 656c 7065  zed_domain_helpe
+00009820: 7228 6469 7363 725f 7379 6d62 6f6c 732c  r(discr_symbols,
+00009830: 2064 6973 6372 6574 697a 6174 696f 6e73   discretizations
+00009840: 290a 0a20 2020 2064 6566 205f 6372 6561  )..    def _crea
+00009850: 7465 5f64 6973 6372 6574 697a 6564 5f64  te_discretized_d
+00009860: 6f6d 6169 6e5f 6865 6c70 6572 2873 656c  omain_helper(sel
+00009870: 662c 2064 6973 6372 5f73 796d 626f 6c73  f, discr_symbols
+00009880: 2c20 6469 7363 7265 7469 7a61 7469 6f6e  , discretization
+00009890: 7329 3a0a 2020 2020 2020 2020 2222 2243  s):.        """C
+000098a0: 7265 6174 6520 3244 206f 7220 3344 2064  reate 2D or 3D d
+000098b0: 6973 6372 6574 697a 6564 2067 7269 6473  iscretized grids
+000098c0: 2e0a 0a20 2020 2020 2020 2053 7562 636c  ...        Subcl
+000098d0: 6173 7365 7320 7368 6f75 6c64 206f 7665  asses should ove
+000098e0: 7272 6964 6520 7468 6973 206d 6574 686f  rride this metho
+000098f0: 6420 696e 206f 7264 6572 2074 6f20 696d  d in order to im
+00009900: 706c 656d 656e 7420 610a 2020 2020 2020  plement a.      
+00009910: 2020 6469 6666 6572 656e 7420 6265 6861    different beha
+00009920: 7669 6f75 722e 0a20 2020 2020 2020 2022  viour..        "
+00009930: 2222 0a20 2020 2020 2020 206e 7020 3d20  "".        np = 
+00009940: 696d 706f 7274 5f6d 6f64 756c 6528 276e  import_module('n
+00009950: 756d 7079 2729 0a0a 2020 2020 2020 2020  umpy')..        
+00009960: 2320 6469 7363 7265 7469 7a61 7469 6f6e  # discretization
+00009970: 2073 7569 7461 626c 6520 666f 7220 3244   suitable for 2D
+00009980: 206c 696e 6520 706c 6f74 732c 2033 4420   line plots, 3D 
+00009990: 7375 7266 6163 6520 706c 6f74 732c 0a20  surface plots,. 
+000099a0: 2020 2020 2020 2023 2063 6f6e 746f 7572         # contour
+000099b0: 7320 706c 6f74 732c 2076 6563 746f 7220  s plots, vector 
+000099c0: 706c 6f74 730a 2020 2020 2020 2020 2320  plots.        # 
+000099d0: 4e4f 5445 3a20 7768 7920 696e 6465 7869  NOTE: why indexi
+000099e0: 6e67 3d27 696a 273f 2042 6563 6175 7365  ng='ij'? Because
+000099f0: 2069 7420 7072 6f64 7563 6573 2063 6f6e   it produces con
+00009a00: 7369 7374 656e 7420 7265 7375 6c74 7320  sistent results 
+00009a10: 7769 7468 0a20 2020 2020 2020 2023 206e  with.        # n
+00009a20: 702e 6d67 7269 642e 2054 6869 7320 6973  p.mgrid. This is
+00009a30: 2069 6d70 6f72 7461 6e74 2061 7320 4d61   important as Ma
+00009a40: 7961 7669 2072 6571 7569 7265 7320 7468  yavi requires th
+00009a50: 6973 2069 6e64 6578 696e 670a 2020 2020  is indexing.    
+00009a60: 2020 2020 2320 746f 2063 6f72 7265 6374      # to correct
+00009a70: 6c79 2063 6f6d 7075 7465 2033 4420 7374  ly compute 3D st
+00009a80: 7265 616d 6c69 6e65 732e 2056 544b 2069  reamlines. VTK i
+00009a90: 7320 6162 6c65 2074 6f20 636f 6d70 7574  s able to comput
+00009aa0: 6520 7468 656d 0a20 2020 2020 2020 2023  e them.        #
+00009ab0: 206e 6f6e 6574 6865 6c65 7373 2c20 6275   nonetheless, bu
+00009ac0: 7420 6974 2070 726f 6475 6365 7320 2273  t it produces "s
+00009ad0: 7472 616e 6765 2220 7265 7375 6c74 7320  trange" results 
+00009ae0: 7769 7468 2022 766f 6964 7322 2069 6e74  with "voids" int
+00009af0: 6f20 7468 650a 2020 2020 2020 2020 2320  o the.        # 
+00009b00: 6469 7363 7265 7469 7a61 7469 6f6e 2076  discretization v
+00009b10: 6f6c 756d 652e 2054 6869 7320 696e 6465  olume. This inde
+00009b20: 7869 6e67 2073 6f6c 7665 7320 7468 6520  xing solves the 
+00009b30: 7072 6f62 6c65 6d2e 0a20 2020 2020 2020  problem..       
+00009b40: 2023 2041 6c73 6f20 6e6f 7465 2074 6861   # Also note tha
+00009b50: 7420 6d61 7470 6c6f 746c 6962 2032 4420  t matplotlib 2D 
+00009b60: 7374 7265 616d 6c69 6e65 7320 7265 7175  streamlines requ
+00009b70: 6972 6573 2069 6e64 6578 696e 673d 2778  ires indexing='x
+00009b80: 7927 2e0a 2020 2020 2020 2020 696e 6465  y'..        inde
+00009b90: 7869 6e67 203d 2022 7879 220a 2020 2020  xing = "xy".    
+00009ba0: 2020 2020 6966 2073 656c 662e 6973 5f33      if self.is_3
+00009bb0: 4476 6563 746f 7220 6f72 2028 7365 6c66  Dvector or (self
+00009bc0: 2e69 735f 3344 7375 7266 6163 6520 616e  .is_3Dsurface an
+00009bd0: 6420 7365 6c66 2e69 735f 696d 706c 6963  d self.is_implic
+00009be0: 6974 293a 0a20 2020 2020 2020 2020 2020  it):.           
+00009bf0: 2069 6e64 6578 696e 6720 3d20 2269 6a22   indexing = "ij"
+00009c00: 0a20 2020 2020 2020 206d 6573 6865 7320  .        meshes 
+00009c10: 3d20 6e70 2e6d 6573 6867 7269 6428 2a64  = np.meshgrid(*d
+00009c20: 6973 6372 6574 697a 6174 696f 6e73 2c20  iscretizations, 
+00009c30: 696e 6465 7869 6e67 3d69 6e64 6578 696e  indexing=indexin
+00009c40: 6729 0a20 2020 2020 2020 2073 656c 662e  g).        self.
+00009c50: 5f64 6973 6372 6574 697a 6564 5f64 6f6d  _discretized_dom
+00009c60: 6169 6e20 3d20 7b0a 2020 2020 2020 2020  ain = {.        
+00009c70: 2020 2020 6b3a 2076 2066 6f72 206b 2c20      k: v for k, 
+00009c80: 7620 696e 207a 6970 2864 6973 6372 5f73  v in zip(discr_s
+00009c90: 796d 626f 6c73 2c20 6d65 7368 6573 297d  ymbols, meshes)}
+00009ca0: 0a0a 2020 2020 6465 6620 5f65 7661 6c75  ..    def _evalu
+00009cb0: 6174 6528 7365 6c66 2c20 6361 7374 5f74  ate(self, cast_t
+00009cc0: 6f5f 7265 616c 3d54 7275 6529 3a0a 2020  o_real=True):.  
+00009cd0: 2020 2020 2020 2222 2245 7661 6c75 6174        """Evaluat
+00009ce0: 696f 6e20 6f66 2074 6865 2073 796d 626f  ion of the symbo
+00009cf0: 6c69 6320 6578 7072 6573 7369 6f6e 2028  lic expression (
+00009d00: 6f72 2065 7870 7265 7373 696f 6e73 2920  or expressions) 
+00009d10: 7769 7468 2074 6865 0a20 2020 2020 2020  with the.       
+00009d20: 2075 6e69 666f 726d 206d 6573 6869 6e67   uniform meshing
+00009d30: 2073 7472 6174 6567 792c 2062 6173 6564   strategy, based
+00009d40: 206f 6e20 6375 7272 656e 7420 7661 6c75   on current valu
+00009d50: 6573 206f 6620 7468 6520 7061 7261 6d65  es of the parame
+00009d60: 7465 7273 2e0a 2020 2020 2020 2020 2222  ters..        ""
+00009d70: 220a 2020 2020 2020 2020 6e70 203d 2069  ".        np = i
+00009d80: 6d70 6f72 745f 6d6f 6475 6c65 2827 6e75  mport_module('nu
+00009d90: 6d70 7927 290a 0a20 2020 2020 2020 2023  mpy')..        #
+00009da0: 2063 7265 6174 6520 6c61 6d62 6461 2066   create lambda f
+00009db0: 756e 6374 696f 6e73 0a20 2020 2020 2020  unctions.       
+00009dc0: 2069 6620 6e6f 7420 7365 6c66 2e5f 6675   if not self._fu
+00009dd0: 6e63 7469 6f6e 733a 0a20 2020 2020 2020  nctions:.       
+00009de0: 2020 2020 2073 656c 662e 5f63 7265 6174       self._creat
+00009df0: 655f 6c61 6d62 6461 5f66 756e 6328 290a  e_lambda_func().
+00009e00: 2020 2020 2020 2020 2320 6372 6561 7465          # create
+00009e10: 2028 6f72 2075 7064 6174 6529 2074 6865   (or update) the
+00009e20: 2064 6973 6372 6574 697a 6564 2064 6f6d   discretized dom
+00009e30: 6169 6e0a 2020 2020 2020 2020 6966 2028  ain.        if (
+00009e40: 6e6f 7420 7365 6c66 2e5f 6469 7363 7265  not self._discre
+00009e50: 7469 7a65 645f 646f 6d61 696e 2920 6f72  tized_domain) or
+00009e60: 2073 656c 662e 5f69 6e74 6572 6163 7469   self._interacti
+00009e70: 7665 5f72 616e 6765 733a 0a20 2020 2020  ve_ranges:.     
+00009e80: 2020 2020 2020 2073 656c 662e 5f63 7265         self._cre
+00009e90: 6174 655f 6469 7363 7265 7469 7a65 645f  ate_discretized_
+00009ea0: 646f 6d61 696e 2829 0a20 2020 2020 2020  domain().       
+00009eb0: 2023 2065 6e73 7572 6520 7468 6174 2064   # ensure that d
+00009ec0: 6973 6372 6574 697a 6564 2064 6f6d 6169  iscretized domai
+00009ed0: 6e73 2061 7265 2072 6574 7572 6e65 6420  ns are returned 
+00009ee0: 7769 7468 2074 6865 2070 726f 7065 7220  with the proper 
+00009ef0: 6f72 6465 720a 2020 2020 2020 2020 6469  order.        di
+00009f00: 7363 7220 3d20 5b73 656c 662e 5f64 6973  scr = [self._dis
+00009f10: 6372 6574 697a 6564 5f64 6f6d 6169 6e5b  cretized_domain[
+00009f20: 735b 305d 5d20 666f 7220 7320 696e 2073  s[0]] for s in s
+00009f30: 656c 662e 7261 6e67 6573 5d0a 0a20 2020  elf.ranges]..   
+00009f40: 2020 2020 2061 7267 7320 3d20 7365 6c66       args = self
+00009f50: 2e5f 6167 6772 6567 6174 655f 6172 6773  ._aggregate_args
+00009f60: 2829 0a0a 2020 2020 2020 2020 7265 7375  ()..        resu
+00009f70: 6c74 7320 3d20 5b5d 0a20 2020 2020 2020  lts = [].       
+00009f80: 2066 6f72 2066 2069 6e20 7365 6c66 2e5f   for f in self._
+00009f90: 6675 6e63 7469 6f6e 733a 0a20 2020 2020  functions:.     
+00009fa0: 2020 2020 2020 2072 203d 205f 756e 6966         r = _unif
+00009fb0: 6f72 6d5f 6576 616c 282a 662c 202a 6172  orm_eval(*f, *ar
+00009fc0: 6773 2c20 6d6f 6475 6c65 733d 7365 6c66  gs, modules=self
+00009fd0: 2e6d 6f64 756c 6573 290a 2020 2020 2020  .modules).      
+00009fe0: 2020 2020 2020 2320 7468 6520 6576 616c        # the eval
+00009ff0: 7561 7469 6f6e 206d 6967 6874 2070 726f  uation might pro
+0000a000: 6475 6365 2061 6e20 696e 742f 666c 6f61  duce an int/floa
+0000a010: 742e 204e 6565 6420 7468 6973 2063 6f72  t. Need this cor
+0000a020: 7265 6374 696f 6e2e 0a20 2020 2020 2020  rection..       
+0000a030: 2020 2020 2072 203d 2073 656c 662e 5f63       r = self._c
+0000a040: 6f72 7265 6374 5f73 6861 7065 286e 702e  orrect_shape(np.
+0000a050: 6172 7261 7928 7229 2c20 6469 7363 725b  array(r), discr[
+0000a060: 305d 290a 2020 2020 2020 2020 2020 2020  0]).            
+0000a070: 2320 736f 6d65 7469 6d65 2074 6865 2065  # sometime the e
+0000a080: 7661 6c75 6174 696f 6e20 6973 2070 6572  valuation is per
+0000a090: 666f 726d 6564 206f 7665 7220 6172 7261  formed over arra
+0000a0a0: 7973 206f 6620 7479 7065 206f 626a 6563  ys of type objec
+0000a0b0: 742e 0a20 2020 2020 2020 2020 2020 2023  t..            #
+0000a0c0: 2068 656e 6365 2c20 6072 6573 756c 7460   hence, `result`
+0000a0d0: 206d 6967 6874 2062 6520 6f66 2074 7970   might be of typ
+0000a0e0: 6520 6f62 6a65 6374 2c20 7768 6963 6820  e object, which 
+0000a0f0: 646f 6e27 7420 776f 726b 2077 656c 6c0a  don't work well.
+0000a100: 2020 2020 2020 2020 2020 2020 2320 7769              # wi
+0000a110: 7468 206e 756d 7079 2072 6561 6c20 616e  th numpy real an
+0000a120: 6420 696d 6167 2066 756e 6374 696f 6e73  d imag functions
+0000a130: 2e0a 2020 2020 2020 2020 2020 2020 7220  ..            r 
+0000a140: 3d20 722e 6173 7479 7065 2863 6f6d 706c  = r.astype(compl
+0000a150: 6578 290a 2020 2020 2020 2020 2020 2020  ex).            
+0000a160: 7265 7375 6c74 732e 6170 7065 6e64 2872  results.append(r
+0000a170: 290a 0a20 2020 2020 2020 2069 6620 6361  )..        if ca
+0000a180: 7374 5f74 6f5f 7265 616c 3a0a 2020 2020  st_to_real:.    
+0000a190: 2020 2020 2020 2020 6469 7363 7220 3d20          discr = 
+0000a1a0: 5b6e 702e 7265 616c 2864 2e61 7374 7970  [np.real(d.astyp
+0000a1b0: 6528 636f 6d70 6c65 7829 2920 666f 7220  e(complex)) for 
+0000a1c0: 6420 696e 2064 6973 6372 5d0a 2020 2020  d in discr].    
+0000a1d0: 2020 2020 7265 7475 726e 205b 2a64 6973      return [*dis
+0000a1e0: 6372 2c20 2a72 6573 756c 7473 5d0a 0a20  cr, *results].. 
+0000a1f0: 2020 2064 6566 205f 6167 6772 6567 6174     def _aggregat
+0000a200: 655f 6172 6773 2873 656c 6629 3a0a 2020  e_args(self):.  
+0000a210: 2020 2020 2020 6172 6773 203d 205b 5d0a        args = [].
+0000a220: 2020 2020 2020 2020 666f 7220 7320 696e          for s in
+0000a230: 2073 656c 662e 5f73 6967 6e61 7475 7265   self._signature
+0000a240: 3a0a 2020 2020 2020 2020 2020 2020 6966  :.            if
+0000a250: 2073 2069 6e20 7365 6c66 2e5f 7061 7261   s in self._para
+0000a260: 6d73 2e6b 6579 7328 293a 0a20 2020 2020  ms.keys():.     
+0000a270: 2020 2020 2020 2020 2020 2061 7267 732e             args.
+0000a280: 6170 7065 6e64 280a 2020 2020 2020 2020  append(.        
+0000a290: 2020 2020 2020 2020 2020 2020 696e 7428              int(
+0000a2a0: 7365 6c66 2e5f 7061 7261 6d73 5b73 5d29  self._params[s])
+0000a2b0: 2069 6620 7320 696e 2073 656c 662e 5f6e   if s in self._n
+0000a2c0: 6565 6473 5f74 6f5f 6265 5f69 6e74 2065  eeds_to_be_int e
+0000a2d0: 6c73 650a 2020 2020 2020 2020 2020 2020  lse.            
+0000a2e0: 2020 2020 2020 2020 7365 6c66 2e5f 7061          self._pa
+0000a2f0: 7261 6d73 5b73 5d20 6966 2073 656c 662e  rams[s] if self.
+0000a300: 5f66 6f72 6365 5f72 6561 6c5f 6576 616c  _force_real_eval
+0000a310: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0000a320: 2020 2020 2065 6c73 6520 636f 6d70 6c65       else comple
+0000a330: 7828 7365 6c66 2e5f 7061 7261 6d73 5b73  x(self._params[s
+0000a340: 5d29 290a 2020 2020 2020 2020 2020 2020  ])).            
+0000a350: 656c 7365 3a0a 2020 2020 2020 2020 2020  else:.          
+0000a360: 2020 2020 2020 6172 6773 2e61 7070 656e        args.appen
+0000a370: 6428 7365 6c66 2e5f 6469 7363 7265 7469  d(self._discreti
+0000a380: 7a65 645f 646f 6d61 696e 5b73 5d29 0a20  zed_domain[s]). 
+0000a390: 2020 2020 2020 2072 6574 7572 6e20 6172         return ar
+0000a3a0: 6773 0a0a 2020 2020 4070 726f 7065 7274  gs..    @propert
+0000a3b0: 790a 2020 2020 6465 6620 6578 7072 2873  y.    def expr(s
+0000a3c0: 656c 6629 3a0a 2020 2020 2020 2020 2222  elf):.        ""
+0000a3d0: 2252 6574 7572 6e20 7468 6520 6578 7072  "Return the expr
+0000a3e0: 6573 7369 6f6e 2028 6f72 2065 7870 7265  ession (or expre
+0000a3f0: 7373 696f 6e73 2920 6f66 2074 6865 2073  ssions) of the s
+0000a400: 6572 6965 732e 2222 220a 2020 2020 2020  eries.""".      
+0000a410: 2020 7265 7475 726e 2073 656c 662e 5f65    return self._e
+0000a420: 7870 720a 0a20 2020 2040 6578 7072 2e73  xpr..    @expr.s
+0000a430: 6574 7465 720a 2020 2020 6465 6620 6578  etter.    def ex
+0000a440: 7072 2873 656c 662c 2065 293a 0a20 2020  pr(self, e):.   
+0000a450: 2020 2020 2022 2222 5365 7420 7468 6520       """Set the 
+0000a460: 6578 7072 6573 7369 6f6e 2028 6f72 2065  expression (or e
+0000a470: 7870 7265 7373 696f 6e73 2920 6f66 2074  xpressions) of t
+0000a480: 6865 2073 6572 6965 732e 2222 220a 2020  he series.""".  
+0000a490: 2020 2020 2020 6973 5f69 7465 7220 3d20        is_iter = 
+0000a4a0: 6861 7361 7474 7228 652c 2022 5f5f 6974  hasattr(e, "__it
+0000a4b0: 6572 5f5f 2229 0a20 2020 2020 2020 2069  er__").        i
+0000a4c0: 735f 6361 6c6c 6162 6c65 203d 2063 616c  s_callable = cal
+0000a4d0: 6c61 626c 6528 6529 2069 6620 6e6f 7420  lable(e) if not 
+0000a4e0: 6973 5f69 7465 7220 656c 7365 2061 6e79  is_iter else any
+0000a4f0: 2863 616c 6c61 626c 6528 7429 2066 6f72  (callable(t) for
+0000a500: 2074 2069 6e20 6529 0a20 2020 2020 2020   t in e).       
+0000a510: 2069 6620 6973 5f63 616c 6c61 626c 653a   if is_callable:
+0000a520: 0a20 2020 2020 2020 2020 2020 2073 656c  .            sel
+0000a530: 662e 5f65 7870 7220 3d20 650a 2020 2020  f._expr = e.    
+0000a540: 2020 2020 656c 7365 3a0a 2020 2020 2020      else:.      
+0000a550: 2020 2020 2020 7365 6c66 2e5f 6578 7072        self._expr
+0000a560: 203d 2073 796d 7069 6679 2865 2920 6966   = sympify(e) if
+0000a570: 206e 6f74 2069 735f 6974 6572 2065 6c73   not is_iter els
+0000a580: 6520 5475 706c 6528 2a65 290a 2020 2020  e Tuple(*e).    
+0000a590: 2020 2020 2020 2020 7320 3d20 7365 7428          s = set(
+0000a5a0: 290a 2020 2020 2020 2020 2020 2020 666f  ).            fo
+0000a5b0: 7220 6520 696e 2073 656c 662e 5f65 7870  r e in self._exp
+0000a5c0: 722e 6174 6f6d 7328 5375 6d2c 2050 726f  r.atoms(Sum, Pro
+0000a5d0: 6475 6374 293a 0a20 2020 2020 2020 2020  duct):.         
+0000a5e0: 2020 2020 2020 2066 6f72 2061 2069 6e20         for a in 
+0000a5f0: 652e 6172 6773 5b31 3a5d 3a0a 2020 2020  e.args[1:]:.    
+0000a600: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000a610: 6966 2069 7369 6e73 7461 6e63 6528 615b  if isinstance(a[
+0000a620: 2d31 5d2c 2053 796d 626f 6c29 3a0a 2020  -1], Symbol):.  
+0000a630: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000a640: 2020 2020 2020 732e 6164 6428 615b 2d31        s.add(a[-1
+0000a650: 5d29 0a20 2020 2020 2020 2020 2020 2073  ]).            s
+0000a660: 656c 662e 5f6e 6565 6473 5f74 6f5f 6265  elf._needs_to_be
+0000a670: 5f69 6e74 203d 206c 6973 7428 7329 0a0a  _int = list(s)..
+0000a680: 2020 2020 2020 2020 2020 2020 2320 6c69              # li
+0000a690: 7374 206f 6620 7379 6d70 7920 6675 6e63  st of sympy func
+0000a6a0: 7469 6f6e 7320 7468 6174 2077 6865 6e20  tions that when 
+0000a6b0: 6c61 6d62 6469 6669 6564 2c20 7468 6520  lambdified, the 
+0000a6c0: 636f 7272 6573 706f 6e64 696e 670a 2020  corresponding.  
+0000a6d0: 2020 2020 2020 2020 2020 2320 6e75 6d70            # nump
+0000a6e0: 7920 6675 6e63 7469 6f6e 7320 646f 6e27  y functions don'
+0000a6f0: 7420 6c69 6b65 2063 6f6d 706c 6578 2d74  t like complex-t
+0000a700: 7970 6520 6172 6775 6d65 6e74 730a 2020  ype arguments.  
+0000a710: 2020 2020 2020 2020 2020 7066 203d 205b            pf = [
+0000a720: 6365 696c 696e 672c 2066 6c6f 6f72 2c20  ceiling, floor, 
+0000a730: 6174 616e 322c 2066 7261 632c 207a 6574  atan2, frac, zet
+0000a740: 612c 2049 6e74 6567 7261 6c2c 2068 7970  a, Integral, hyp
+0000a750: 6572 5d0a 2020 2020 2020 2020 2020 2020  er].            
+0000a760: 6966 2073 656c 662e 5f66 6f72 6365 5f72  if self._force_r
+0000a770: 6561 6c5f 6576 616c 2069 7320 6e6f 7420  eal_eval is not 
+0000a780: 5472 7565 3a0a 2020 2020 2020 2020 2020  True:.          
+0000a790: 2020 2020 2020 6368 6563 6b5f 7265 7320        check_res 
+0000a7a0: 3d20 5b73 656c 662e 5f65 7870 722e 6861  = [self._expr.ha
+0000a7b0: 7328 6629 2066 6f72 2066 2069 6e20 7066  s(f) for f in pf
+0000a7c0: 5d0a 2020 2020 2020 2020 2020 2020 2020  ].              
+0000a7d0: 2020 7365 6c66 2e5f 666f 7263 655f 7265    self._force_re
+0000a7e0: 616c 5f65 7661 6c20 3d20 616e 7928 6368  al_eval = any(ch
+0000a7f0: 6563 6b5f 7265 7329 0a20 2020 2020 2020  eck_res).       
+0000a800: 2020 2020 2020 2020 2069 6620 7365 6c66           if self
+0000a810: 2e5f 666f 7263 655f 7265 616c 5f65 7661  ._force_real_eva
+0000a820: 6c20 616e 6420 280a 2020 2020 2020 2020  l and (.        
+0000a830: 2020 2020 2020 2020 2020 2020 2873 656c              (sel
+0000a840: 662e 6d6f 6475 6c65 7320 6973 204e 6f6e  f.modules is Non
+0000a850: 6529 206f 720a 2020 2020 2020 2020 2020  e) or.          
+0000a860: 2020 2020 2020 2020 2020 2869 7369 6e73            (isins
+0000a870: 7461 6e63 6528 7365 6c66 2e6d 6f64 756c  tance(self.modul
+0000a880: 6573 2c20 7374 7229 2061 6e64 2022 6e75  es, str) and "nu
+0000a890: 6d70 7922 2069 6e20 7365 6c66 2e6d 6f64  mpy" in self.mod
+0000a8a0: 756c 6573 290a 2020 2020 2020 2020 2020  ules).          
+0000a8b0: 2020 2020 2020 293a 0a20 2020 2020 2020        ):.       
+0000a8c0: 2020 2020 2020 2020 2020 2020 2066 756e               fun
+0000a8d0: 6373 203d 205b 6620 666f 7220 662c 2063  cs = [f for f, c
+0000a8e0: 2069 6e20 7a69 7028 7066 2c20 6368 6563   in zip(pf, chec
+0000a8f0: 6b5f 7265 7329 2069 6620 635d 0a20 2020  k_res) if c].   
+0000a900: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000a910: 2077 6172 6e69 6e67 732e 7761 726e 280a   warnings.warn(.
+0000a920: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000a930: 2020 2020 2020 2020 224e 756d 5079 2069          "NumPy i
+0000a940: 7320 756e 6162 6c65 2074 6f20 6576 616c  s unable to eval
+0000a950: 7561 7465 2077 6974 6820 636f 6d70 6c65  uate with comple
+0000a960: 7820 220a 2020 2020 2020 2020 2020 2020  x ".            
+0000a970: 2020 2020 2020 2020 2020 2020 226e 756d              "num
+0000a980: 6265 7273 2073 6f6d 6520 6f66 2074 6865  bers some of the
+0000a990: 2066 756e 6374 696f 6e73 2069 6e63 6c75   functions inclu
+0000a9a0: 6465 6420 696e 2074 6869 7320 220a 2020  ded in this ".  
+0000a9b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000a9c0: 2020 2020 2020 2273 796d 626f 6c69 6320        "symbolic 
+0000a9d0: 6578 7072 6573 7369 6f6e 3a20 2573 2e20  expression: %s. 
+0000a9e0: 2220 2520 6675 6e63 7320 2b0a 2020 2020  " % funcs +.    
+0000a9f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000aa00: 2020 2020 2248 656e 6365 2c20 7468 6520      "Hence, the 
+0000aa10: 6576 616c 7561 7469 6f6e 2077 696c 6c20  evaluation will 
+0000aa20: 7573 6520 7265 616c 206e 756d 6265 7273  use real numbers
+0000aa30: 2e20 220a 2020 2020 2020 2020 2020 2020  . ".            
+0000aa40: 2020 2020 2020 2020 2020 2020 2249 6620              "If 
+0000aa50: 796f 7520 6265 6c69 6576 6520 7468 6520  you believe the 
+0000aa60: 7265 7375 6c74 696e 6720 706c 6f74 2069  resulting plot i
+0000aa70: 7320 696e 636f 7272 6563 742c 2022 0a20  s incorrect, ". 
+0000aa80: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000aa90: 2020 2020 2020 2022 6368 616e 6765 2074         "change t
+0000aaa0: 6865 2065 7661 6c75 6174 696f 6e20 6d6f  he evaluation mo
+0000aab0: 6475 6c65 2062 7920 7365 7474 696e 6720  dule by setting 
+0000aac0: 7468 6520 220a 2020 2020 2020 2020 2020  the ".          
+0000aad0: 2020 2020 2020 2020 2020 2020 2020 2260                "`
+0000aae0: 6d6f 6475 6c65 7360 206b 6579 776f 7264  modules` keyword
+0000aaf0: 2061 7267 756d 656e 742e 2229 0a20 2020   argument.").   
+0000ab00: 2020 2020 2020 2020 2069 6620 7365 6c66           if self
+0000ab10: 2e5f 6675 6e63 7469 6f6e 733a 0a20 2020  ._functions:.   
+0000ab20: 2020 2020 2020 2020 2020 2020 2023 2075               # u
+0000ab30: 7064 6174 6520 6c61 6d62 6461 2066 756e  pdate lambda fun
+0000ab40: 6374 696f 6e73 0a20 2020 2020 2020 2020  ctions.         
+0000ab50: 2020 2020 2020 2073 656c 662e 5f63 7265         self._cre
+0000ab60: 6174 655f 6c61 6d62 6461 5f66 756e 6328  ate_lambda_func(
+0000ab70: 290a 0a20 2020 2040 7072 6f70 6572 7479  )..    @property
+0000ab80: 0a20 2020 2064 6566 206e 2873 656c 6629  .    def n(self)
+0000ab90: 3a0a 2020 2020 2020 2020 2222 2252 6574  :.        """Ret
+0000aba0: 7572 6e73 2061 206c 6973 7420 5b6e 312c  urns a list [n1,
+0000abb0: 206e 322c 206e 335d 206f 6620 6e75 6d62   n2, n3] of numb
+0000abc0: 6572 7320 6f66 2064 6973 6372 6174 697a  ers of discratiz
+0000abd0: 6174 696f 6e20 706f 696e 7473 2e0a 2020  ation points..  
+0000abe0: 2020 2020 2020 2222 220a 2020 2020 2020        """.      
+0000abf0: 2020 7265 7475 726e 2073 656c 662e 5f6e    return self._n
+0000ac00: 0a0a 2020 2020 406e 2e73 6574 7465 720a  ..    @n.setter.
+0000ac10: 2020 2020 6465 6620 6e28 7365 6c66 2c20      def n(self, 
+0000ac20: 7629 3a0a 2020 2020 2020 2020 7375 7065  v):.        supe
+0000ac30: 7228 292e 6e20 3d20 760a 2020 2020 2020  r().n = v.      
+0000ac40: 2020 6966 2073 656c 662e 5f64 6973 6372    if self._discr
+0000ac50: 6574 697a 6564 5f64 6f6d 6169 6e3a 0a20  etized_domain:. 
+0000ac60: 2020 2020 2020 2020 2020 2023 2075 7064             # upd
+0000ac70: 6174 6520 7468 6520 6469 7363 7265 7469  ate the discreti
+0000ac80: 7a65 6420 646f 6d61 696e 0a20 2020 2020  zed domain.     
+0000ac90: 2020 2020 2020 2073 656c 662e 5f63 7265         self._cre
+0000aca0: 6174 655f 6469 7363 7265 7469 7a65 645f  ate_discretized_
+0000acb0: 646f 6d61 696e 2829 0a0a 2020 2020 6465  domain()..    de
+0000acc0: 6620 5f70 6f73 745f 696e 6974 2873 656c  f _post_init(sel
+0000acd0: 6629 3a0a 2020 2020 2020 2020 6578 7072  f):.        expr
+0000ace0: 7320 3d20 7365 6c66 2e65 7870 7220 6966  s = self.expr if
+0000acf0: 2068 6173 6174 7472 2873 656c 662e 6578   hasattr(self.ex
+0000ad00: 7072 2c20 225f 5f69 7465 725f 5f22 2920  pr, "__iter__") 
+0000ad10: 656c 7365 205b 7365 6c66 2e65 7870 725d  else [self.expr]
+0000ad20: 0a20 2020 2020 2020 2069 6620 616e 7928  .        if any(
+0000ad30: 6361 6c6c 6162 6c65 2865 2920 666f 7220  callable(e) for 
+0000ad40: 6520 696e 2065 7870 7273 2920 616e 6420  e in exprs) and 
+0000ad50: 7365 6c66 2e70 6172 616d 733a 0a20 2020  self.params:.   
+0000ad60: 2020 2020 2020 2020 2072 6169 7365 2054           raise T
+0000ad70: 7970 6545 7272 6f72 280a 2020 2020 2020  ypeError(.      
+0000ad80: 2020 2020 2020 2020 2020 2260 7061 7261            "`para
+0000ad90: 6d73 6020 7761 7320 7072 6f76 6964 6564  ms` was provided
+0000ada0: 2c20 6865 6e63 6520 616e 2069 6e74 6572  , hence an inter
+0000adb0: 6163 7469 7665 2070 6c6f 7420 220a 2020  active plot ".  
+0000adc0: 2020 2020 2020 2020 2020 2020 2020 2269                "i
+0000add0: 7320 6578 7065 6374 6564 2e20 486f 7765  s expected. Howe
+0000ade0: 7665 722c 2069 6e74 6572 6163 7469 7665  ver, interactive
+0000adf0: 2070 6c6f 7473 2064 6f20 6e6f 7420 7375   plots do not su
+0000ae00: 7070 6f72 7420 220a 2020 2020 2020 2020  pport ".        
+0000ae10: 2020 2020 2020 2020 2275 7365 722d 7072          "user-pr
+0000ae20: 6f76 6964 6564 206e 756d 6572 6963 616c  ovided numerical
+0000ae30: 2066 756e 6374 696f 6e73 2e22 290a 0a20   functions.").. 
+0000ae40: 2020 2020 2020 2023 2069 6620 7468 6520         # if the 
+0000ae50: 6578 7072 6573 7369 6f6e 7320 6973 2061  expressions is a
+0000ae60: 206c 616d 6264 6120 6675 6e63 7469 6f6e   lambda function
+0000ae70: 2061 6e64 206e 6f20 6c61 6265 6c20 6861   and no label ha
+0000ae80: 7320 6265 656e 0a20 2020 2020 2020 2023  s been.        #
+0000ae90: 2070 726f 7669 6465 642c 2074 6865 6e20   provided, then 
+0000aea0: 6974 7320 6265 7474 6572 2074 6f20 646f  its better to do
+0000aeb0: 2074 6865 2066 6f6c 6c6f 7769 6e67 2069   the following i
+0000aec0: 6e20 6f72 6465 7220 746f 2061 766f 6964  n order to avoid
+0000aed0: 0a20 2020 2020 2020 2023 2073 7570 7269  .        # supri
+0000aee0: 7365 7320 6f6e 2074 6865 2062 6163 6b65  ses on the backe
+0000aef0: 6e64 0a20 2020 2020 2020 2069 6620 616e  nd.        if an
+0000af00: 7928 6361 6c6c 6162 6c65 2865 2920 666f  y(callable(e) fo
+0000af10: 7220 6520 696e 2065 7870 7273 293a 0a20  r e in exprs):. 
+0000af20: 2020 2020 2020 2020 2020 2069 6620 7365             if se
+0000af30: 6c66 2e5f 6c61 6265 6c20 3d3d 2073 7472  lf._label == str
+0000af40: 2873 656c 662e 6578 7072 293a 0a20 2020  (self.expr):.   
+0000af50: 2020 2020 2020 2020 2020 2020 2073 656c               sel
+0000af60: 662e 6c61 6265 6c20 3d20 2222 0a0a 2020  f.label = ""..  
+0000af70: 2020 2020 2020 7365 6c66 2e5f 6368 6563        self._chec
+0000af80: 6b5f 6673 2829 0a0a 2020 2020 2020 2020  k_fs()..        
+0000af90: 6966 2068 6173 6174 7472 2873 656c 662c  if hasattr(self,
+0000afa0: 2022 6164 6170 7469 7665 2229 2061 6e64   "adaptive") and
+0000afb0: 2073 656c 662e 6164 6170 7469 7665 2061   self.adaptive a
+0000afc0: 6e64 2073 656c 662e 7061 7261 6d73 3a0a  nd self.params:.
+0000afd0: 2020 2020 2020 2020 2020 2020 7761 726e              warn
+0000afe0: 696e 6773 2e77 6172 6e28 0a20 2020 2020  ings.warn(.     
+0000aff0: 2020 2020 2020 2020 2020 2022 6070 6172             "`par
+0000b000: 616d 7360 2077 6173 2070 726f 7669 6465  ams` was provide
+0000b010: 642c 2068 656e 6365 2061 6e20 696e 7465  d, hence an inte
+0000b020: 7261 6374 6976 6520 706c 6f74 2022 0a20  ractive plot ". 
+0000b030: 2020 2020 2020 2020 2020 2020 2020 2022                 "
+0000b040: 6973 2065 7870 6563 7465 642e 2048 6f77  is expected. How
+0000b050: 6576 6572 2c20 696e 7465 7261 6374 6976  ever, interactiv
+0000b060: 6520 706c 6f74 7320 646f 206e 6f74 2073  e plots do not s
+0000b070: 7570 706f 7274 2022 0a20 2020 2020 2020  upport ".       
+0000b080: 2020 2020 2020 2020 2022 6164 6170 7469           "adapti
+0000b090: 7665 2065 7661 6c75 6174 696f 6e2e 2041  ve evaluation. A
+0000b0a0: 7574 6f6d 6174 6963 616c 6c79 2073 7769  utomatically swi
+0000b0b0: 7463 6865 6420 746f 2022 0a20 2020 2020  tched to ".     
+0000b0c0: 2020 2020 2020 2020 2020 2022 6164 6170             "adap
+0000b0d0: 7469 7665 3d46 616c 7365 2e22 290a 2020  tive=False.").  
+0000b0e0: 2020 2020 2020 2020 2020 7365 6c66 2e61            self.a
+0000b0f0: 6461 7074 6976 6520 3d20 4661 6c73 650a  daptive = False.
+0000b100: 0a0a 6465 6620 5f64 6574 6563 745f 706f  ..def _detect_po
+0000b110: 6c65 735f 6e75 6d65 7269 6361 6c5f 6865  les_numerical_he
+0000b120: 6c70 6572 280a 2020 2020 782c 2079 2c20  lper(.    x, y, 
+0000b130: 6570 733d 302e 3031 2c20 6578 7072 3d4e  eps=0.01, expr=N
+0000b140: 6f6e 652c 2073 796d 623d 4e6f 6e65 2c20  one, symb=None, 
+0000b150: 7379 6d62 6f6c 6963 3d46 616c 7365 0a29  symbolic=False.)
+0000b160: 3a0a 2020 2020 2222 2243 6f6d 7075 7465  :.    """Compute
+0000b170: 2074 6865 2073 7465 6570 6e65 7373 206f   the steepness o
+0000b180: 6620 6561 6368 2073 6567 6d65 6e74 2e20  f each segment. 
+0000b190: 4966 2069 7427 7320 6772 6561 7465 7220  If it's greater 
+0000b1a0: 7468 616e 2061 0a20 2020 2074 6872 6573  than a.    thres
+0000b1b0: 686f 6c64 2c20 7365 7420 7468 6520 7269  hold, set the ri
+0000b1c0: 6768 742d 706f 696e 7420 792d 7661 6c75  ght-point y-valu
+0000b1d0: 6520 6e6f 6e20 4e61 4e20 616e 6420 7265  e non NaN and re
+0000b1e0: 636f 7264 2074 6865 0a20 2020 2063 6f72  cord the.    cor
+0000b1f0: 7265 7370 6f6e 6469 6e67 2078 2d6c 6f63  responding x-loc
+0000b200: 6174 696f 6e20 666f 7220 6675 7274 6865  ation for furthe
+0000b210: 7220 7072 6f63 6573 7369 6e67 2e0a 0a20  r processing... 
+0000b220: 2020 2052 6574 7572 6e73 0a20 2020 203d     Returns.    =
+0000b230: 3d3d 3d3d 3d3d 0a20 2020 2078 203a 206e  ======.    x : n
+0000b240: 702e 6e64 6172 7261 790a 2020 2020 2020  p.ndarray.      
+0000b250: 2020 556e 6368 616e 6765 6420 782d 6461    Unchanged x-da
+0000b260: 7461 2e0a 2020 2020 7979 203a 206e 702e  ta..    yy : np.
+0000b270: 6e64 6172 7261 790a 2020 2020 2020 2020  ndarray.        
+0000b280: 4d6f 6469 6669 6564 2079 2d64 6174 6120  Modified y-data 
+0000b290: 7769 7468 204e 614e 2076 616c 7565 732e  with NaN values.
+0000b2a0: 0a20 2020 2022 2222 0a20 2020 206e 7020  .    """.    np 
+0000b2b0: 3d20 696d 706f 7274 5f6d 6f64 756c 6528  = import_module(
+0000b2c0: 276e 756d 7079 2729 0a0a 2020 2020 7979  'numpy')..    yy
+0000b2d0: 203d 2079 2e63 6f70 7928 290a 2020 2020   = y.copy().    
+0000b2e0: 7468 7265 7368 6f6c 6420 3d20 6e70 2e70  threshold = np.p
+0000b2f0: 6920 2f20 3220 2d20 6570 730a 2020 2020  i / 2 - eps.    
+0000b300: 666f 7220 6920 696e 2072 616e 6765 286c  for i in range(l
+0000b310: 656e 2878 2920 2d20 3129 3a0a 2020 2020  en(x) - 1):.    
+0000b320: 2020 2020 6478 203d 2078 5b69 202b 2031      dx = x[i + 1
+0000b330: 5d20 2d20 785b 695d 0a20 2020 2020 2020  ] - x[i].       
+0000b340: 2064 7920 3d20 6162 7328 795b 6920 2b20   dy = abs(y[i + 
+0000b350: 315d 202d 2079 5b69 5d29 0a20 2020 2020  1] - y[i]).     
+0000b360: 2020 2061 6e67 6c65 203d 206e 702e 6172     angle = np.ar
+0000b370: 6374 616e 2864 7920 2f20 6478 290a 2020  ctan(dy / dx).  
+0000b380: 2020 2020 2020 6966 2061 6273 2861 6e67        if abs(ang
+0000b390: 6c65 2920 3e3d 2074 6872 6573 686f 6c64  le) >= threshold
+0000b3a0: 3a0a 2020 2020 2020 2020 2020 2020 7979  :.            yy
+0000b3b0: 5b69 202b 2031 5d20 3d20 6e70 2e6e 616e  [i + 1] = np.nan
+0000b3c0: 0a0a 2020 2020 7265 7475 726e 2078 2c20  ..    return x, 
+0000b3d0: 7979 0a0a 0a64 6566 205f 6465 7465 6374  yy...def _detect
+0000b3e0: 5f70 6f6c 6573 5f73 796d 626f 6c69 635f  _poles_symbolic_
+0000b3f0: 6865 6c70 6572 2865 7870 722c 2073 796d  helper(expr, sym
+0000b400: 622c 2073 7461 7274 2c20 656e 6429 3a0a  b, start, end):.
+0000b410: 2020 2020 2222 2241 7474 656d 7074 7320      """Attempts 
+0000b420: 746f 2063 6f6d 7075 7465 2073 796d 626f  to compute symbo
+0000b430: 6c69 6320 6469 7363 6f6e 7469 6e75 6974  lic discontinuit
+0000b440: 6965 732e 0a0a 2020 2020 5265 7475 726e  ies...    Return
+0000b450: 730a 2020 2020 3d3d 3d3d 3d3d 3d0a 2020  s.    =======.  
+0000b460: 2020 706f 6c65 203a 206c 6973 740a 2020    pole : list.  
+0000b470: 2020 2020 2020 4c69 7374 206f 6620 7379        List of sy
+0000b480: 6d62 6f6c 6963 2070 6f6c 6573 2c20 706f  mbolic poles, po
+0000b490: 7373 6962 696c 7920 656d 7074 792e 0a20  ssibily empty.. 
+0000b4a0: 2020 2022 2222 0a20 2020 2070 6f6c 6573     """.    poles
+0000b4b0: 203d 205b 5d0a 2020 2020 696e 7465 7276   = [].    interv
+0000b4c0: 616c 203d 2049 6e74 6572 7661 6c28 6e73  al = Interval(ns
+0000b4d0: 696d 706c 6966 7928 7374 6172 7429 2c20  implify(start), 
+0000b4e0: 6e73 696d 706c 6966 7928 656e 6429 290a  nsimplify(end)).
+0000b4f0: 2020 2020 7265 7320 3d20 636f 6e74 696e      res = contin
+0000b500: 756f 7573 5f64 6f6d 6169 6e28 6578 7072  uous_domain(expr
+0000b510: 2c20 7379 6d62 2c20 696e 7465 7276 616c  , symb, interval
+0000b520: 290a 2020 2020 7265 7320 3d20 7265 732e  ).    res = res.
+0000b530: 7369 6d70 6c69 6679 2829 0a20 2020 2069  simplify().    i
+0000b540: 6620 7265 7320 3d3d 2069 6e74 6572 7661  f res == interva
+0000b550: 6c3a 0a20 2020 2020 2020 2070 6173 730a  l:.        pass.
+0000b560: 2020 2020 656c 6966 2028 6973 696e 7374      elif (isinst
+0000b570: 616e 6365 2872 6573 2c20 556e 696f 6e29  ance(res, Union)
+0000b580: 2061 6e64 0a20 2020 2020 2020 2061 6c6c   and.        all
+0000b590: 2869 7369 6e73 7461 6e63 6528 742c 2049  (isinstance(t, I
+0000b5a0: 6e74 6572 7661 6c29 2066 6f72 2074 2069  nterval) for t i
+0000b5b0: 6e20 7265 732e 6172 6773 2929 3a0a 2020  n res.args)):.  
+0000b5c0: 2020 2020 2020 706f 6c65 7320 3d20 5b5d        poles = []
+0000b5d0: 0a20 2020 2020 2020 2066 6f72 2073 2069  .        for s i
+0000b5e0: 6e20 7265 732e 6172 6773 3a0a 2020 2020  n res.args:.    
+0000b5f0: 2020 2020 2020 2020 6966 2073 2e6c 6566          if s.lef
+0000b600: 745f 6f70 656e 3a0a 2020 2020 2020 2020  t_open:.        
+0000b610: 2020 2020 2020 2020 706f 6c65 732e 6170          poles.ap
+0000b620: 7065 6e64 2873 2e6c 6566 7429 0a20 2020  pend(s.left).   
+0000b630: 2020 2020 2020 2020 2069 6620 732e 7269           if s.ri
+0000b640: 6768 745f 6f70 656e 3a0a 2020 2020 2020  ght_open:.      
+0000b650: 2020 2020 2020 2020 2020 706f 6c65 732e            poles.
+0000b660: 6170 7065 6e64 2873 2e72 6967 6874 290a  append(s.right).
+0000b670: 2020 2020 2020 2020 706f 6c65 7320 3d20          poles = 
+0000b680: 6c69 7374 2873 6574 2870 6f6c 6573 2929  list(set(poles))
+0000b690: 0a20 2020 2065 6c73 653a 0a20 2020 2020  .    else:.     
+0000b6a0: 2020 2072 6169 7365 2056 616c 7565 4572     raise ValueEr
+0000b6b0: 726f 7228 0a20 2020 2020 2020 2020 2020  ror(.           
+0000b6c0: 2066 2243 6f75 6c64 206e 6f74 2070 6172   f"Could not par
+0000b6d0: 7365 2074 6865 2066 6f6c 6c6f 7769 6e67  se the following
+0000b6e0: 206f 626a 6563 743a 207b 7265 737d 202e   object: {res} .
+0000b6f0: 5c6e 220a 2020 2020 2020 2020 2020 2020  \n".            
+0000b700: 2250 6c65 6173 652c 2073 7562 6d69 7420  "Please, submit 
+0000b710: 7468 6973 2061 7320 6120 6275 672e 2043  this as a bug. C
+0000b720: 6f6e 7369 6465 7220 616c 736f 2074 6f20  onsider also to 
+0000b730: 7365 7420 220a 2020 2020 2020 2020 2020  set ".          
+0000b740: 2020 2260 6465 7465 6374 5f70 6f6c 6573    "`detect_poles
+0000b750: 3d54 7275 6560 2e22 0a20 2020 2020 2020  =True`.".       
+0000b760: 2029 0a20 2020 2072 6574 7572 6e20 706f   ).    return po
+0000b770: 6c65 730a 0a0a 6465 6620 5f63 6865 636b  les...def _check
+0000b780: 5f73 7465 7073 2873 7465 7073 293a 0a20  _steps(steps):. 
+0000b790: 2020 2069 6620 6973 696e 7374 616e 6365     if isinstance
+0000b7a0: 2873 7465 7073 2c20 7374 7229 3a0a 2020  (steps, str):.  
+0000b7b0: 2020 2020 2020 7374 6570 7320 3d20 7374        steps = st
+0000b7c0: 6570 732e 6c6f 7765 7228 290a 2020 2020  eps.lower().    
+0000b7d0: 706f 7373 6962 6c65 5f76 616c 7565 7320  possible_values 
+0000b7e0: 3d20 5b22 7072 6522 2c20 2270 6f73 7422  = ["pre", "post"
+0000b7f0: 2c20 226d 6964 222c 2054 7275 652c 2046  , "mid", True, F
+0000b800: 616c 7365 2c20 4e6f 6e65 5d0a 2020 2020  alse, None].    
+0000b810: 6966 206e 6f74 2028 7374 6570 7320 696e  if not (steps in
+0000b820: 2070 6f73 7369 626c 655f 7661 6c75 6573   possible_values
+0000b830: 293a 0a20 2020 2020 2020 2077 6172 6e69  ):.        warni
+0000b840: 6e67 732e 7761 726e 280a 2020 2020 2020  ngs.warn(.      
+0000b850: 2020 2020 2020 2260 6073 7465 7073 6060        "``steps``
+0000b860: 206e 6f74 2072 6563 6f67 6e69 7a65 642e   not recognized.
+0000b870: 2050 6f73 7369 626c 6520 7661 6c75 6573   Possible values
+0000b880: 2061 7265 3a20 2220 2520 706f 7373 6962   are: " % possib
+0000b890: 6c65 5f76 616c 7565 730a 2020 2020 2020  le_values.      
+0000b8a0: 2020 290a 2020 2020 7265 7475 726e 2073    ).    return s
+0000b8b0: 7465 7073 0a0a 0a63 6c61 7373 204c 696e  teps...class Lin
+0000b8c0: 6532 4442 6173 6553 6572 6965 7328 4261  e2DBaseSeries(Ba
+0000b8d0: 7365 5365 7269 6573 293a 0a20 2020 2022  seSeries):.    "
+0000b8e0: 2222 4120 6261 7365 2063 6c61 7373 2066  ""A base class f
+0000b8f0: 6f72 2032 4420 6c69 6e65 732e 2222 220a  or 2D lines.""".
+0000b900: 0a20 2020 2069 735f 3244 6c69 6e65 203d  .    is_2Dline =
+0000b910: 2054 7275 650a 2020 2020 5f4e 203d 2031   True.    _N = 1
+0000b920: 3030 300a 2020 2020 5f61 6c6c 6f77 6564  000.    _allowed
+0000b930: 5f6b 6579 7320 3d20 5b0a 2020 2020 2020  _keys = [.      
+0000b940: 2020 2273 7465 7073 222c 2022 7363 6174    "steps", "scat
+0000b950: 7465 7222 2c20 2269 735f 6669 6c6c 6564  ter", "is_filled
+0000b960: 222c 2022 6669 6c6c 222c 2022 6c69 6e65  ", "fill", "line
+0000b970: 5f63 6f6c 6f72 222c 2022 6465 7465 6374  _color", "detect
+0000b980: 5f70 6f6c 6573 222c 0a20 2020 2020 2020  _poles",.       
+0000b990: 2022 6570 7322 2c20 2269 735f 706f 6c61   "eps", "is_pola
+0000b9a0: 7222 2c20 2275 6e77 7261 7022 2c20 2265  r", "unwrap", "e
+0000b9b0: 7863 6c75 6465 222c 0a20 2020 205d 0a0a  xclude",.    ]..
+0000b9c0: 2020 2020 6465 6620 5f5f 696e 6974 5f5f      def __init__
+0000b9d0: 2873 656c 662c 202a 6172 6773 2c20 2a2a  (self, *args, **
+0000b9e0: 6b77 6172 6773 293a 0a20 2020 2020 2020  kwargs):.       
+0000b9f0: 2073 7570 6572 2829 2e5f 5f69 6e69 745f   super().__init_
+0000ba00: 5f28 2a61 7267 732c 202a 2a6b 7761 7267  _(*args, **kwarg
+0000ba10: 7329 0a20 2020 2020 2020 2023 206d 6f64  s).        # mod
+0000ba20: 6966 7920 7468 6520 636f 6d70 7574 6564  ify the computed
+0000ba30: 2063 6f6f 7264 696e 6174 6573 2069 6e20   coordinates in 
+0000ba40: 6f72 6465 7220 746f 206f 6274 6169 6e20  order to obtain 
+0000ba50: 6120 7374 6570 2d6c 696b 6520 706c 6f74  a step-like plot
+0000ba60: 0a20 2020 2020 2020 2073 656c 662e 7374  .        self.st
+0000ba70: 6570 7320 3d20 5f63 6865 636b 5f73 7465  eps = _check_ste
+0000ba80: 7073 286b 7761 7267 732e 6765 7428 2273  ps(kwargs.get("s
+0000ba90: 7465 7073 222c 2046 616c 7365 2929 0a20  teps", False)). 
+0000baa0: 2020 2020 2020 2023 2077 6865 7468 6572         # whether
+0000bab0: 2074 6f20 6372 6561 7465 2073 6361 7474   to create scatt
+0000bac0: 6572 206f 7220 6120 636f 6e74 696e 756f  er or a continuo
+0000bad0: 7573 206c 696e 650a 2020 2020 2020 2020  us line.        
+0000bae0: 7365 6c66 2e69 735f 706f 696e 7420 3d20  self.is_point = 
+0000baf0: 6b77 6172 6773 2e67 6574 2822 7363 6174  kwargs.get("scat
+0000bb00: 7465 7222 2c20 6b77 6172 6773 2e67 6574  ter", kwargs.get
+0000bb10: 2822 6973 5f70 6f69 6e74 222c 2046 616c  ("is_point", Fal
+0000bb20: 7365 2929 0a20 2020 2020 2020 2023 2077  se)).        # w
+0000bb30: 6865 7468 6572 2073 6361 7474 6572 2773  hether scatter's
+0000bb40: 206d 6172 6b65 7273 2061 7265 2066 696c   markers are fil
+0000bb50: 6c65 6420 6f72 2076 6f69 640a 2020 2020  led or void.    
+0000bb60: 2020 2020 7365 6c66 2e69 735f 6669 6c6c      self.is_fill
+0000bb70: 6564 203d 206b 7761 7267 732e 6765 7428  ed = kwargs.get(
+0000bb80: 2269 735f 6669 6c6c 6564 222c 206b 7761  "is_filled", kwa
+0000bb90: 7267 732e 6765 7428 2266 696c 6c22 2c20  rgs.get("fill", 
+0000bba0: 5472 7565 2929 0a20 2020 2020 2020 2023  True)).        #
+0000bbb0: 2077 6865 7468 6572 2074 6f20 7573 6520   whether to use 
+0000bbc0: 6120 636f 6c6f 726d 6170 206f 7220 6120  a colormap or a 
+0000bbd0: 736f 6c69 6420 6c69 6e65 2063 6f6c 6f72  solid line color
+0000bbe0: 0a20 2020 2020 2020 2073 656c 662e 7573  .        self.us
+0000bbf0: 655f 636d 203d 206b 7761 7267 732e 6765  e_cm = kwargs.ge
+0000bc00: 7428 2275 7365 5f63 6d22 2c20 4661 6c73  t("use_cm", Fals
+0000bc10: 6529 0a20 2020 2020 2020 2023 2066 6f72  e).        # for
+0000bc20: 2062 6163 6b2d 636f 6d70 6174 6962 696c   back-compatibil
+0000bc30: 6974 7920 7769 7468 206f 6c64 2073 796d  ity with old sym
+0000bc40: 7079 2e70 6c6f 7474 696e 670a 2020 2020  py.plotting.    
+0000bc50: 2020 2020 7365 6c66 2e6c 696e 655f 636f      self.line_co
+0000bc60: 6c6f 7220 3d20 6b77 6172 6773 2e67 6574  lor = kwargs.get
+0000bc70: 2822 6c69 6e65 5f63 6f6c 6f72 222c 204e  ("line_color", N
+0000bc80: 6f6e 6529 0a20 2020 2020 2020 2023 2077  one).        # w
+0000bc90: 6865 7468 6572 2074 6f20 6465 7465 6374  hether to detect
+0000bca0: 2072 6f6f 7473 206f 6620 6465 6e6f 6d69   roots of denomi
+0000bcb0: 6e61 746f 720a 2020 2020 2020 2020 7365  nator.        se
+0000bcc0: 6c66 2e64 6574 6563 745f 706f 6c65 7320  lf.detect_poles 
+0000bcd0: 3d20 6b77 6172 6773 2e67 6574 2822 6465  = kwargs.get("de
+0000bce0: 7465 6374 5f70 6f6c 6573 222c 2046 616c  tect_poles", Fal
+0000bcf0: 7365 290a 2020 2020 2020 2020 2320 6120  se).        # a 
+0000bd00: 7061 7261 6d65 7465 7220 746f 2063 6f6e  parameter to con
+0000bd10: 7472 6f6c 2074 6865 2064 6574 6563 745f  trol the detect_
+0000bd20: 706f 6c65 7320 616c 676f 7269 7468 6d0a  poles algorithm.
+0000bd30: 2020 2020 2020 2020 7365 6c66 2e65 7073          self.eps
+0000bd40: 203d 206b 7761 7267 732e 6765 7428 2265   = kwargs.get("e
+0000bd50: 7073 222c 2030 2e30 3129 0a20 2020 2020  ps", 0.01).     
+0000bd60: 2020 2023 2077 6865 6e20 6465 7465 6374     # when detect
+0000bd70: 5f70 6f6c 6573 3d22 7379 6d62 6f6c 6963  _poles="symbolic
+0000bd80: 222c 2073 746f 7265 7320 7468 6520 6c6f  ", stores the lo
+0000bd90: 6361 7469 6f6e 206f 6620 706f 6c65 7320  cation of poles 
+0000bda0: 736f 2074 6861 740a 2020 2020 2020 2020  so that.        
+0000bdb0: 2320 7468 6579 2063 616e 2062 6520 6170  # they can be ap
+0000bdc0: 7072 6f70 7269 6174 656c 7920 7265 6e64  propriately rend
+0000bdd0: 6572 6564 0a20 2020 2020 2020 2073 656c  ered.        sel
+0000bde0: 662e 706f 6c65 735f 6c6f 6361 7469 6f6e  f.poles_location
+0000bdf0: 7320 3d20 5b5d 0a20 2020 2020 2020 2023  s = [].        #
+0000be00: 2077 6865 7468 6572 2074 6f20 636f 6e76   whether to conv
+0000be10: 6572 2074 6865 2063 6f6d 7075 7465 6420  er the computed 
+0000be20: 636f 6f72 6469 6e61 7465 7320 746f 2070  coordinates to p
+0000be30: 6f6c 6172 2063 6f6f 7264 696e 6174 6573  olar coordinates
+0000be40: 0a20 2020 2020 2020 2073 656c 662e 6973  .        self.is
+0000be50: 5f70 6f6c 6172 203d 206b 7761 7267 732e  _polar = kwargs.
+0000be60: 6765 7428 2269 735f 706f 6c61 7222 2c20  get("is_polar", 
+0000be70: 4661 6c73 6529 0a20 2020 2020 2020 2023  False).        #
+0000be80: 2077 6865 7468 6572 2074 6f20 7573 6520   whether to use 
+0000be90: 6e75 6d70 792e 756e 7772 6170 2829 0a20  numpy.unwrap(). 
+0000bea0: 2020 2020 2020 2073 656c 662e 756e 7772         self.unwr
+0000beb0: 6170 203d 206b 7761 7267 732e 6765 7428  ap = kwargs.get(
+0000bec0: 2275 6e77 7261 7022 2c20 4661 6c73 6529  "unwrap", False)
+0000bed0: 0a20 2020 2020 2020 2023 206c 6973 7420  .        # list 
+0000bee0: 6f66 2078 2d63 6f6f 7264 696e 6174 6573  of x-coordinates
+0000bef0: 2074 6f20 6265 2065 7863 6c75 6465 6420   to be excluded 
+0000bf00: 6672 6f6d 2065 7661 6c75 6174 696f 6e0a  from evaluation.
+0000bf10: 2020 2020 2020 2020 6578 636c 7564 6520          exclude 
+0000bf20: 3d20 6b77 6172 6773 2e67 6574 2822 6578  = kwargs.get("ex
+0000bf30: 636c 7564 6522 2c20 5b5d 290a 2020 2020  clude", []).    
+0000bf40: 2020 2020 6966 2069 7369 6e73 7461 6e63      if isinstanc
+0000bf50: 6528 6578 636c 7564 652c 2053 6574 293a  e(exclude, Set):
+0000bf60: 0a20 2020 2020 2020 2020 2020 2065 7863  .            exc
+0000bf70: 6c75 6465 203d 206c 6973 7428 6578 7472  lude = list(extr
+0000bf80: 6163 745f 736f 6c75 7469 6f6e 2865 7863  act_solution(exc
+0000bf90: 6c75 6465 2c20 6e3d 3130 3029 290a 2020  lude, n=100)).  
+0000bfa0: 2020 2020 2020 6966 206e 6f74 2068 6173        if not has
+0000bfb0: 6174 7472 2865 7863 6c75 6465 2c20 225f  attr(exclude, "_
+0000bfc0: 5f69 7465 725f 5f22 293a 0a20 2020 2020  _iter__"):.     
+0000bfd0: 2020 2020 2020 2065 7863 6c75 6465 203d         exclude =
+0000bfe0: 205b 6578 636c 7564 655d 0a20 2020 2020   [exclude].     
+0000bff0: 2020 2065 7863 6c75 6465 203d 205b 666c     exclude = [fl
+0000c000: 6f61 7428 6529 2066 6f72 2065 2069 6e20  oat(e) for e in 
+0000c010: 6578 636c 7564 655d 0a20 2020 2020 2020  exclude].       
+0000c020: 2073 656c 662e 6578 636c 7564 6520 3d20   self.exclude = 
+0000c030: 736f 7274 6564 2865 7863 6c75 6465 290a  sorted(exclude).
+0000c040: 0a20 2020 2064 6566 2067 6574 5f64 6174  .    def get_dat
+0000c050: 6128 7365 6c66 293a 0a20 2020 2020 2020  a(self):.       
+0000c060: 2022 2222 5265 7475 726e 2063 6f6f 7264   """Return coord
+0000c070: 696e 6174 6573 2066 6f72 2070 6c6f 7474  inates for plott
+0000c080: 696e 6720 7468 6520 6c69 6e65 2e0a 0a20  ing the line... 
+0000c090: 2020 2020 2020 2052 6574 7572 6e73 0a20         Returns. 
+0000c0a0: 2020 2020 2020 203d 3d3d 3d3d 3d3d 0a0a         =======..
+0000c0b0: 2020 2020 2020 2020 783a 206e 702e 6e64          x: np.nd
+0000c0c0: 6172 7261 790a 2020 2020 2020 2020 2020  array.          
+0000c0d0: 2020 782d 636f 6f72 6469 6e61 7465 730a    x-coordinates.
+0000c0e0: 2020 2020 2020 2020 793a 206e 702e 6e64          y: np.nd
+0000c0f0: 6172 7261 790a 2020 2020 2020 2020 2020  array.          
+0000c100: 2020 792d 636f 6f72 6469 6e61 7465 730a    y-coordinates.
+0000c110: 2020 2020 2020 2020 7a3a 206e 702e 6e64          z: np.nd
+0000c120: 6172 7261 7920 286f 7074 696f 6e61 6c29  array (optional)
+0000c130: 0a20 2020 2020 2020 2020 2020 207a 2d63  .            z-c
+0000c140: 6f6f 7264 696e 6174 6573 2069 6e20 6361  oordinates in ca
+0000c150: 7365 206f 6620 5061 7261 6d65 7472 6963  se of Parametric
+0000c160: 3344 4c69 6e65 5365 7269 6573 0a20 2020  3DLineSeries.   
+0000c170: 2020 2020 2070 6172 616d 203a 206e 702e       param : np.
+0000c180: 6e64 6172 7261 7920 286f 7074 696f 6e61  ndarray (optiona
+0000c190: 6c29 0a20 2020 2020 2020 2020 2020 2054  l).            T
+0000c1a0: 6865 2070 6172 616d 6574 6572 2069 6e20  he parameter in 
+0000c1b0: 6361 7365 206f 6620 5061 7261 6d65 7472  case of Parametr
+0000c1c0: 6963 3244 4c69 6e65 5365 7269 6573 2c0a  ic2DLineSeries,.
+0000c1d0: 2020 2020 2020 2020 2020 2020 5061 7261              Para
+0000c1e0: 6d65 7472 6963 3344 4c69 6e65 5365 7269  metric3DLineSeri
+0000c1f0: 6573 206f 7220 4162 7341 7267 4c69 6e65  es or AbsArgLine
+0000c200: 5365 7269 6573 2e0a 2020 2020 2020 2020  Series..        
+0000c210: 2222 220a 2020 2020 2020 2020 6e70 203d  """.        np =
+0000c220: 2069 6d70 6f72 745f 6d6f 6475 6c65 2827   import_module('
+0000c230: 6e75 6d70 7927 290a 2020 2020 2020 2020  numpy').        
+0000c240: 706f 696e 7473 203d 2073 656c 662e 5f67  points = self._g
+0000c250: 6574 5f64 6174 615f 6865 6c70 6572 2829  et_data_helper()
+0000c260: 0a0a 2020 2020 2020 2020 6966 2028 0a20  ..        if (. 
+0000c270: 2020 2020 2020 2020 2020 2069 7369 6e73             isins
+0000c280: 7461 6e63 6528 7365 6c66 2c20 4c69 6e65  tance(self, Line
+0000c290: 4f76 6572 3144 5261 6e67 6553 6572 6965  Over1DRangeSerie
+0000c2a0: 7329 2061 6e64 0a20 2020 2020 2020 2020  s) and.         
+0000c2b0: 2020 2028 7365 6c66 2e64 6574 6563 745f     (self.detect_
+0000c2c0: 706f 6c65 7320 3d3d 2022 7379 6d62 6f6c  poles == "symbol
+0000c2d0: 6963 2229 0a20 2020 2020 2020 2029 3a0a  ic").        ):.
+0000c2e0: 2020 2020 2020 2020 2020 2020 706f 6c65              pole
+0000c2f0: 7320 3d20 5f64 6574 6563 745f 706f 6c65  s = _detect_pole
+0000c300: 735f 7379 6d62 6f6c 6963 5f68 656c 7065  s_symbolic_helpe
+0000c310: 7228 0a20 2020 2020 2020 2020 2020 2020  r(.             
+0000c320: 2020 2073 656c 662e 6578 7072 2e73 7562     self.expr.sub
+0000c330: 7328 7365 6c66 2e70 6172 616d 7329 2c20  s(self.params), 
+0000c340: 2a73 656c 662e 7261 6e67 6573 5b30 5d29  *self.ranges[0])
+0000c350: 0a20 2020 2020 2020 2020 2020 2070 6f6c  .            pol
+0000c360: 6573 203d 206e 702e 6172 7261 7928 5b66  es = np.array([f
+0000c370: 6c6f 6174 2874 2920 666f 7220 7420 696e  loat(t) for t in
+0000c380: 2070 6f6c 6573 5d29 0a20 2020 2020 2020   poles]).       
+0000c390: 2020 2020 2074 203d 206c 616d 6264 6120       t = lambda 
+0000c3a0: 782c 2074 7261 6e73 666f 726d 3a20 7820  x, transform: x 
+0000c3b0: 6966 2074 7261 6e73 666f 726d 2069 7320  if transform is 
+0000c3c0: 4e6f 6e65 2065 6c73 6520 7472 616e 7366  None else transf
+0000c3d0: 6f72 6d28 7829 0a20 2020 2020 2020 2020  orm(x).         
+0000c3e0: 2020 2073 656c 662e 706f 6c65 735f 6c6f     self.poles_lo
+0000c3f0: 6361 7469 6f6e 7320 3d20 7428 6e70 2e61  cations = t(np.a
+0000c400: 7272 6179 2870 6f6c 6573 292c 2073 656c  rray(poles), sel
+0000c410: 662e 5f74 7829 0a0a 2020 2020 2020 2020  f._tx)..        
+0000c420: 2320 706f 7374 7072 6f63 6573 7369 6e67  # postprocessing
+0000c430: 0a20 2020 2020 2020 2070 6f69 6e74 7320  .        points 
+0000c440: 3d20 7365 6c66 2e5f 6170 706c 795f 7472  = self._apply_tr
+0000c450: 616e 7366 6f72 6d28 2a70 6f69 6e74 7329  ansform(*points)
+0000c460: 0a0a 2020 2020 2020 2020 6966 2073 656c  ..        if sel
+0000c470: 662e 6973 5f32 446c 696e 6520 616e 6420  f.is_2Dline and 
+0000c480: 7365 6c66 2e64 6574 6563 745f 706f 6c65  self.detect_pole
+0000c490: 733a 0a20 2020 2020 2020 2020 2020 2069  s:.            i
+0000c4a0: 6620 6c65 6e28 706f 696e 7473 2920 3d3d  f len(points) ==
+0000c4b0: 2032 3a0a 2020 2020 2020 2020 2020 2020   2:.            
+0000c4c0: 2020 2020 782c 2079 203d 2070 6f69 6e74      x, y = point
+0000c4d0: 730a 2020 2020 2020 2020 2020 2020 2020  s.              
+0000c4e0: 2020 782c 2079 203d 205f 6465 7465 6374    x, y = _detect
+0000c4f0: 5f70 6f6c 6573 5f6e 756d 6572 6963 616c  _poles_numerical
+0000c500: 5f68 656c 7065 7228 0a20 2020 2020 2020  _helper(.       
+0000c510: 2020 2020 2020 2020 2020 2020 2078 2c20               x, 
+0000c520: 792c 2073 656c 662e 6570 7329 0a20 2020  y, self.eps).   
+0000c530: 2020 2020 2020 2020 2020 2020 2070 6f69               poi
+0000c540: 6e74 7320 3d20 2878 2c20 7929 0a20 2020  nts = (x, y).   
+0000c550: 2020 2020 2020 2020 2065 6c73 653a 0a20           else:. 
+0000c560: 2020 2020 2020 2020 2020 2020 2020 2078                 x
+0000c570: 2c20 792c 2070 203d 2070 6f69 6e74 730a  , y, p = points.
+0000c580: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000c590: 782c 2079 203d 205f 6465 7465 6374 5f70  x, y = _detect_p
+0000c5a0: 6f6c 6573 5f6e 756d 6572 6963 616c 5f68  oles_numerical_h
+0000c5b0: 656c 7065 7228 782c 2079 2c20 7365 6c66  elper(x, y, self
+0000c5c0: 2e65 7073 290a 2020 2020 2020 2020 2020  .eps).          
+0000c5d0: 2020 2020 2020 706f 696e 7473 203d 2028        points = (
+0000c5e0: 782c 2079 2c20 7029 0a0a 2020 2020 2020  x, y, p)..      
+0000c5f0: 2020 6966 2073 656c 662e 756e 7772 6170    if self.unwrap
+0000c600: 3a0a 2020 2020 2020 2020 2020 2020 6b77  :.            kw
+0000c610: 203d 207b 7d0a 2020 2020 2020 2020 2020   = {}.          
+0000c620: 2020 6966 2073 656c 662e 756e 7772 6170    if self.unwrap
+0000c630: 2069 7320 6e6f 7420 5472 7565 3a0a 2020   is not True:.  
+0000c640: 2020 2020 2020 2020 2020 2020 2020 6b77                kw
+0000c650: 203d 2073 656c 662e 756e 7772 6170 0a20   = self.unwrap. 
+0000c660: 2020 2020 2020 2020 2020 2069 6620 7365             if se
+0000c670: 6c66 2e69 735f 3244 6c69 6e65 3a0a 2020  lf.is_2Dline:.  
+0000c680: 2020 2020 2020 2020 2020 2020 2020 6966                if
+0000c690: 206c 656e 2870 6f69 6e74 7329 203d 3d20   len(points) == 
+0000c6a0: 323a 0a20 2020 2020 2020 2020 2020 2020  2:.             
+0000c6b0: 2020 2020 2020 2078 2c20 7920 3d20 706f         x, y = po
+0000c6c0: 696e 7473 0a20 2020 2020 2020 2020 2020  ints.           
+0000c6d0: 2020 2020 2020 2020 2079 203d 206e 702e           y = np.
+0000c6e0: 756e 7772 6170 2879 2c20 2a2a 6b77 290a  unwrap(y, **kw).
+0000c6f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000c700: 2020 2020 706f 696e 7473 203d 2028 782c      points = (x,
+0000c710: 2079 290a 2020 2020 2020 2020 2020 2020   y).            
+0000c720: 2020 2020 656c 7365 3a0a 2020 2020 2020      else:.      
+0000c730: 2020 2020 2020 2020 2020 2020 2020 782c                x,
+0000c740: 2079 2c20 7020 3d20 706f 696e 7473 0a20   y, p = points. 
+0000c750: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000c760: 2020 2079 203d 206e 702e 756e 7772 6170     y = np.unwrap
+0000c770: 2879 2c20 2a2a 6b77 290a 2020 2020 2020  (y, **kw).      
+0000c780: 2020 2020 2020 2020 2020 2020 2020 706f                po
+0000c790: 696e 7473 203d 2028 782c 2079 2c20 7029  ints = (x, y, p)
+0000c7a0: 0a0a 2020 2020 2020 2020 6966 2028 7365  ..        if (se
+0000c7b0: 6c66 2e73 7465 7073 2069 7320 5472 7565  lf.steps is True
+0000c7c0: 2920 6f72 2028 7365 6c66 2e73 7465 7073  ) or (self.steps
+0000c7d0: 203d 3d20 2270 7265 2229 3a0a 2020 2020   == "pre"):.    
+0000c7e0: 2020 2020 2020 2020 706f 696e 7473 203d          points =
+0000c7f0: 2070 7473 5f74 6f5f 7072 6573 7465 7028   pts_to_prestep(
+0000c800: 2a70 6f69 6e74 7329 0a20 2020 2020 2020  *points).       
+0000c810: 2065 6c69 6620 7365 6c66 2e73 7465 7073   elif self.steps
+0000c820: 203d 3d20 2270 6f73 7422 3a0a 2020 2020   == "post":.    
+0000c830: 2020 2020 2020 2020 706f 696e 7473 203d          points =
+0000c840: 2070 7473 5f74 6f5f 706f 7374 7374 6570   pts_to_poststep
+0000c850: 282a 706f 696e 7473 290a 2020 2020 2020  (*points).      
+0000c860: 2020 656c 6966 2073 656c 662e 7374 6570    elif self.step
+0000c870: 7320 3d3d 2022 6d69 6422 3a0a 2020 2020  s == "mid":.    
+0000c880: 2020 2020 2020 2020 706f 696e 7473 203d          points =
+0000c890: 2070 7473 5f74 6f5f 6d69 6473 7465 7028   pts_to_midstep(
+0000c8a0: 2a70 6f69 6e74 7329 0a0a 2020 2020 2020  *points)..      
+0000c8b0: 2020 706f 696e 7473 203d 2073 656c 662e    points = self.
+0000c8c0: 5f69 6e73 6572 745f 6578 636c 7573 696f  _insert_exclusio
+0000c8d0: 6e73 2870 6f69 6e74 7329 0a20 2020 2020  ns(points).     
+0000c8e0: 2020 2072 6574 7572 6e20 706f 696e 7473     return points
+0000c8f0: 0a0a 2020 2020 6465 6620 5f69 6e73 6572  ..    def _inser
+0000c900: 745f 6578 636c 7573 696f 6e73 2873 656c  t_exclusions(sel
+0000c910: 662c 2070 6f69 6e74 7329 3a0a 2020 2020  f, points):.    
+0000c920: 2020 2020 2222 2241 6464 204e 614e 2074      """Add NaN t
+0000c930: 6f20 6561 6368 206f 6620 7468 6520 6578  o each of the ex
+0000c940: 636c 7573 696f 6e20 706f 696e 742e 2050  clusion point. P
+0000c950: 7261 6374 6963 616c 6c79 2c20 7468 6973  ractically, this
+0000c960: 2061 6464 7320 610a 2020 2020 2020 2020   adds a.        
+0000c970: 4e61 4e20 746f 2074 6865 2065 786c 7573  NaN to the exlus
+0000c980: 696f 6e20 706f 696e 742c 2070 6c75 7320  ion point, plus 
+0000c990: 7477 6f20 6f74 6865 7220 6e65 6172 6279  two other nearby
+0000c9a0: 2070 6f69 6e74 7320 6576 616c 7561 7465   points evaluate
+0000c9b0: 6420 7769 7468 0a20 2020 2020 2020 2074  d with.        t
+0000c9c0: 6865 206e 756d 6572 6963 616c 2066 756e  he numerical fun
+0000c9d0: 6374 696f 6e73 2061 7373 6f63 6961 7465  ctions associate
+0000c9e0: 6420 746f 2074 6869 7320 6461 7461 2073  d to this data s
+0000c9f0: 6572 6965 732e 0a20 2020 2020 2020 2054  eries..        T
+0000ca00: 6865 7365 206e 6561 7262 7920 706f 696e  hese nearby poin
+0000ca10: 7473 2061 7265 2069 6d70 6f72 7461 6e74  ts are important
+0000ca20: 2077 6865 6e20 7468 6520 6e75 6d62 6572   when the number
+0000ca30: 206f 6620 6469 7363 7265 7469 7a61 7469   of discretizati
+0000ca40: 6f6e 0a20 2020 2020 2020 2070 6f69 6e74  on.        point
+0000ca50: 7320 6973 206c 6f77 2c20 6f72 2074 6865  s is low, or the
+0000ca60: 2073 6361 6c65 2069 7320 6c6f 6761 7269   scale is logari
+0000ca70: 7468 6d2e 0a0a 2020 2020 2020 2020 4e4f  thm...        NO
+0000ca80: 5445 3a20 6974 2077 6f75 6c64 2062 6520  TE: it would be 
+0000ca90: 6561 7369 6572 2074 6f20 6a75 7374 2061  easier to just a
+0000caa0: 6464 2065 7863 6c75 7369 6f6e 2070 6f69  dd exclusion poi
+0000cab0: 6e74 7320 746f 2074 6865 0a20 2020 2020  nts to the.     
+0000cac0: 2020 2064 6973 6372 6574 697a 6564 2064     discretized d
+0000cad0: 6f6d 6169 6e20 6265 666f 7265 2065 7661  omain before eva
+0000cae0: 6c75 6174 696f 6e2c 2074 6865 6e20 6166  luation, then af
+0000caf0: 7465 7220 6576 616c 7561 7469 6f6e 2061  ter evaluation a
+0000cb00: 6464 204e 614e 0a20 2020 2020 2020 2074  dd NaN.        t
+0000cb10: 6f20 7468 6520 6578 636c 7573 696f 6e20  o the exclusion 
+0000cb20: 706f 696e 7473 2e20 4275 7420 7468 6174  points. But that
+0000cb30: 2773 206f 6e6c 7920 776f 726b 2077 6974  's only work wit
+0000cb40: 6820 6164 6170 7469 7665 3d46 616c 7365  h adaptive=False
+0000cb50: 2e0a 2020 2020 2020 2020 5468 6520 666f  ..        The fo
+0000cb60: 6c6c 6f77 696e 6720 6170 7072 6f61 6368  llowing approach
+0000cb70: 2077 6f72 6b20 6576 656e 2077 6974 6820   work even with 
+0000cb80: 6164 6170 7469 7665 3d54 7275 652e 0a20  adaptive=True.. 
+0000cb90: 2020 2020 2020 2022 2222 0a20 2020 2020         """.     
+0000cba0: 2020 2069 6620 6c65 6e28 7365 6c66 2e65     if len(self.e
+0000cbb0: 7863 6c75 6465 2920 3d3d 2030 3a0a 2020  xclude) == 0:.  
+0000cbc0: 2020 2020 2020 2020 2020 7265 7475 726e            return
+0000cbd0: 2070 6f69 6e74 730a 0a20 2020 2020 2020   points..       
+0000cbe0: 206e 7020 3d20 696d 706f 7274 5f6d 6f64   np = import_mod
+0000cbf0: 756c 6528 226e 756d 7079 2229 0a20 2020  ule("numpy").   
+0000cc00: 2020 2020 2070 6f69 6e74 7320 3d20 6c69       points = li
+0000cc10: 7374 2870 6f69 6e74 7329 0a20 2020 2020  st(points).     
+0000cc20: 2020 206e 203d 206c 656e 2870 6f69 6e74     n = len(point
+0000cc30: 7329 0a20 2020 2020 2020 2023 2069 6e64  s).        # ind
+0000cc40: 6578 206f 6620 7468 6520 782d 636f 6f72  ex of the x-coor
+0000cc50: 6469 6e61 7465 2028 666f 7220 3264 2070  dinate (for 2d p
+0000cc60: 6c6f 7473 2920 6f72 2070 6172 616d 6574  lots) or paramet
+0000cc70: 6572 2028 666f 7220 3264 2f33 640a 2020  er (for 2d/3d.  
+0000cc80: 2020 2020 2020 2320 7061 7261 6d65 7472        # parametr
+0000cc90: 6963 2070 6c6f 7473 290a 2020 2020 2020  ic plots).      
+0000cca0: 2020 6b20 3d20 6e20 2d20 310a 2020 2020    k = n - 1.    
+0000ccb0: 2020 2020 6966 206e 203d 3d20 323a 0a20      if n == 2:. 
+0000ccc0: 2020 2020 2020 2020 2020 206b 203d 2030             k = 0
+0000ccd0: 0a20 2020 2020 2020 2023 2069 6e64 6563  .        # indec
+0000cce0: 6573 206f 6620 7468 6520 6f74 6865 7220  es of the other 
+0000ccf0: 636f 6f72 6469 6e61 7465 730a 2020 2020  coordinates.    
+0000cd00: 2020 2020 6a5f 696e 6465 6365 7320 3d20      j_indeces = 
+0000cd10: 736f 7274 6564 2873 6574 2872 616e 6765  sorted(set(range
+0000cd20: 286e 2929 2e64 6966 6665 7265 6e63 6528  (n)).difference(
+0000cd30: 5b6b 5d29 290a 2020 2020 2020 2020 2320  [k])).        # 
+0000cd40: 544f 444f 3a20 666f 7220 6e6f 772c 2049  TODO: for now, I
+0000cd50: 2061 7373 756d 6520 7468 6174 206e 756d   assume that num
+0000cd60: 7079 2066 756e 6374 696f 6e73 2061 7265  py functions are
+0000cd70: 2067 6f69 6e67 2074 6f20 7375 6363 6565   going to succee
+0000cd80: 640a 2020 2020 2020 2020 6675 6e63 7320  d.        funcs 
+0000cd90: 3d20 5b66 5b30 5d20 666f 7220 6620 696e  = [f[0] for f in
+0000cda0: 2073 656c 662e 5f66 756e 6374 696f 6e73   self._functions
+0000cdb0: 5d0a 0a20 2020 2020 2020 2066 6f72 2065  ]..        for e
+0000cdc0: 2069 6e20 7365 6c66 2e65 7863 6c75 6465   in self.exclude
+0000cdd0: 3a0a 2020 2020 2020 2020 2020 2020 7265  :.            re
+0000cde0: 7320 3d20 706f 696e 7473 5b6b 5d20 2d20  s = points[k] - 
+0000cdf0: 6520 3e3d 2030 0a20 2020 2020 2020 2020  e >= 0.         
+0000ce00: 2020 2023 2069 6620 7265 7320 636f 6e74     # if res cont
+0000ce10: 6169 6e73 2062 6f74 6820 5472 7565 2061  ains both True a
+0000ce20: 6e64 2046 616c 7365 2c20 6965 2c20 6966  nd False, ie, if
+0000ce30: 2065 2069 7320 666f 756e 640a 2020 2020   e is found.    
+0000ce40: 2020 2020 2020 2020 6966 2061 6e79 2872          if any(r
+0000ce50: 6573 2920 616e 6420 616e 7928 7e72 6573  es) and any(~res
+0000ce60: 293a 0a20 2020 2020 2020 2020 2020 2020  ):.             
+0000ce70: 2020 2069 6478 203d 206e 702e 6e61 6e61     idx = np.nana
+0000ce80: 7267 6d61 7828 7265 7329 0a20 2020 2020  rgmax(res).     
+0000ce90: 2020 2020 2020 2020 2020 2023 2073 656c             # sel
+0000cea0: 6563 7420 7468 6520 7072 6576 696f 7573  ect the previous
+0000ceb0: 2070 6f69 6e74 2077 6974 6820 7265 7370   point with resp
+0000cec0: 6563 7420 746f 2065 0a20 2020 2020 2020  ect to e.       
+0000ced0: 2020 2020 2020 2020 2069 6478 202d 3d20           idx -= 
+0000cee0: 310a 2020 2020 2020 2020 2020 2020 2020  1.              
+0000cef0: 2020 2320 544f 444f 3a20 7768 6174 2069    # TODO: what i
+0000cf00: 6620 706f 696e 7473 5b6b 5d5b 6964 785d  f points[k][idx]
+0000cf10: 3d3d 6520 6f72 2070 6f69 6e74 735b 6b5d  ==e or points[k]
+0000cf20: 5b69 6478 2b31 5d3d 3d65 3f0a 0a20 2020  [idx+1]==e?..   
+0000cf30: 2020 2020 2020 2020 2020 2020 2069 6620               if 
+0000cf40: 6964 7820 3e20 3020 616e 6420 6964 7820  idx > 0 and idx 
+0000cf50: 3c20 6c65 6e28 706f 696e 7473 5b6b 5d29  < len(points[k])
+0000cf60: 202d 2031 3a0a 2020 2020 2020 2020 2020   - 1:.          
+0000cf70: 2020 2020 2020 2020 2020 6465 6c74 615f            delta_
+0000cf80: 7072 6576 203d 2061 6273 2865 202d 2070  prev = abs(e - p
+0000cf90: 6f69 6e74 735b 6b5d 5b69 6478 5d29 0a20  oints[k][idx]). 
+0000cfa0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000cfb0: 2020 2064 656c 7461 5f70 6f73 7420 3d20     delta_post = 
+0000cfc0: 6162 7328 6520 2d20 706f 696e 7473 5b6b  abs(e - points[k
+0000cfd0: 5d5b 6964 7820 2b20 315d 290a 2020 2020  ][idx + 1]).    
+0000cfe0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000cff0: 6465 6c74 6120 3d20 6d69 6e28 6465 6c74  delta = min(delt
+0000d000: 615f 7072 6576 2c20 6465 6c74 615f 706f  a_prev, delta_po
+0000d010: 7374 2920 2f20 3130 300a 2020 2020 2020  st) / 100.      
+0000d020: 2020 2020 2020 2020 2020 2020 2020 7072                pr
+0000d030: 6576 203d 2065 202d 2064 656c 7461 0a20  ev = e - delta. 
+0000d040: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000d050: 2020 2070 6f73 7420 3d20 6520 2b20 6465     post = e + de
+0000d060: 6c74 610a 0a20 2020 2020 2020 2020 2020  lta..           
+0000d070: 2020 2020 2020 2020 2023 2061 6464 2070           # add p
+0000d080: 6f69 6e74 7320 746f 2074 6865 2078 2d63  oints to the x-c
+0000d090: 6f6f 7264 206f 7220 7468 6520 7061 7261  oord or the para
+0000d0a0: 6d65 7465 720a 2020 2020 2020 2020 2020  meter.          
+0000d0b0: 2020 2020 2020 2020 2020 706f 696e 7473            points
+0000d0c0: 5b6b 5d20 3d20 6e70 2e63 6f6e 6361 7465  [k] = np.concate
+0000d0d0: 6e61 7465 280a 2020 2020 2020 2020 2020  nate(.          
+0000d0e0: 2020 2020 2020 2020 2020 2020 2020 2870                (p
+0000d0f0: 6f69 6e74 735b 6b5d 5b3a 6964 785d 2c20  oints[k][:idx], 
+0000d100: 5b70 7265 762c 2065 2c20 706f 7374 5d2c  [prev, e, post],
+0000d110: 2070 6f69 6e74 735b 6b5d 5b69 6478 2b31   points[k][idx+1
+0000d120: 3a5d 2929 0a0a 2020 2020 2020 2020 2020  :]))..          
+0000d130: 2020 2020 2020 2020 2020 2320 6164 6420            # add 
+0000d140: 706f 696e 7473 2074 6f20 7468 6520 6f74  points to the ot
+0000d150: 6865 7220 636f 6f72 6469 6e61 7465 730a  her coordinates.
+0000d160: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000d170: 2020 2020 6320 3d20 300a 2020 2020 2020      c = 0.      
+0000d180: 2020 2020 2020 2020 2020 2020 2020 666f                fo
+0000d190: 7220 6a20 696e 206a 5f69 6e64 6563 6573  r j in j_indeces
+0000d1a0: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+0000d1b0: 2020 2020 2020 2020 2020 7661 6c75 6573            values
+0000d1c0: 203d 2066 756e 6373 5b63 5d28 6e70 2e61   = funcs[c](np.a
+0000d1d0: 7272 6179 285b 7072 6576 2c20 706f 7374  rray([prev, post
+0000d1e0: 5d29 290a 2020 2020 2020 2020 2020 2020  ])).            
+0000d1f0: 2020 2020 2020 2020 2020 2020 6320 2b3d              c +=
+0000d200: 2031 0a20 2020 2020 2020 2020 2020 2020   1.             
+0000d210: 2020 2020 2020 2020 2020 2070 6f69 6e74             point
+0000d220: 735b 6a5d 203d 206e 702e 636f 6e63 6174  s[j] = np.concat
+0000d230: 656e 6174 6528 0a20 2020 2020 2020 2020  enate(.         
+0000d240: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000d250: 2020 2028 706f 696e 7473 5b6a 5d5b 3a69     (points[j][:i
+0000d260: 6478 5d2c 205b 7661 6c75 6573 5b30 5d2c  dx], [values[0],
+0000d270: 206e 702e 6e61 6e2c 2076 616c 7565 735b   np.nan, values[
+0000d280: 315d 5d2c 2070 6f69 6e74 735b 6a5d 5b69  1]], points[j][i
+0000d290: 6478 2b31 3a5d 2929 0a20 2020 2020 2020  dx+1:])).       
+0000d2a0: 2072 6574 7572 6e20 706f 696e 7473 0a0a   return points..
+0000d2b0: 2020 2020 4070 726f 7065 7274 790a 2020      @property.  
+0000d2c0: 2020 6465 6620 7661 7228 7365 6c66 293a    def var(self):
+0000d2d0: 0a20 2020 2020 2020 2072 6574 7572 6e20  .        return 
+0000d2e0: 4e6f 6e65 2069 6620 6e6f 7420 7365 6c66  None if not self
+0000d2f0: 2e72 616e 6765 7320 656c 7365 2073 656c  .ranges else sel
+0000d300: 662e 7261 6e67 6573 5b30 5d5b 305d 0a0a  f.ranges[0][0]..
+0000d310: 2020 2020 4070 726f 7065 7274 790a 2020      @property.  
+0000d320: 2020 6465 6620 7374 6172 7428 7365 6c66    def start(self
+0000d330: 293a 0a20 2020 2020 2020 2069 6620 6e6f  ):.        if no
+0000d340: 7420 7365 6c66 2e72 616e 6765 733a 0a20  t self.ranges:. 
+0000d350: 2020 2020 2020 2020 2020 2072 6574 7572             retur
+0000d360: 6e20 4e6f 6e65 0a20 2020 2020 2020 2074  n None.        t
+0000d370: 7279 3a0a 2020 2020 2020 2020 2020 2020  ry:.            
+0000d380: 7265 7475 726e 2073 656c 662e 5f63 6173  return self._cas
+0000d390: 7428 7365 6c66 2e72 616e 6765 735b 305d  t(self.ranges[0]
+0000d3a0: 5b31 5d29 0a20 2020 2020 2020 2065 7863  [1]).        exc
+0000d3b0: 6570 7420 4578 6365 7074 696f 6e3a 0a20  ept Exception:. 
+0000d3c0: 2020 2020 2020 2020 2020 2072 6574 7572             retur
+0000d3d0: 6e20 7365 6c66 2e72 616e 6765 735b 305d  n self.ranges[0]
+0000d3e0: 5b31 5d0a 0a20 2020 2040 7072 6f70 6572  [1]..    @proper
+0000d3f0: 7479 0a20 2020 2064 6566 2065 6e64 2873  ty.    def end(s
+0000d400: 656c 6629 3a0a 2020 2020 2020 2020 6966  elf):.        if
+0000d410: 206e 6f74 2073 656c 662e 7261 6e67 6573   not self.ranges
+0000d420: 3a0a 2020 2020 2020 2020 2020 2020 7265  :.            re
+0000d430: 7475 726e 204e 6f6e 650a 2020 2020 2020  turn None.      
+0000d440: 2020 7472 793a 0a20 2020 2020 2020 2020    try:.         
+0000d450: 2020 2072 6574 7572 6e20 7365 6c66 2e5f     return self._
+0000d460: 6361 7374 2873 656c 662e 7261 6e67 6573  cast(self.ranges
+0000d470: 5b30 5d5b 325d 290a 2020 2020 2020 2020  [0][2]).        
+0000d480: 6578 6365 7074 2045 7863 6570 7469 6f6e  except Exception
+0000d490: 3a0a 2020 2020 2020 2020 2020 2020 7265  :.            re
+0000d4a0: 7475 726e 2073 656c 662e 7261 6e67 6573  turn self.ranges
+0000d4b0: 5b30 5d5b 325d 0a0a 2020 2020 4070 726f  [0][2]..    @pro
+0000d4c0: 7065 7274 790a 2020 2020 6465 6620 6c69  perty.    def li
+0000d4d0: 6e65 5f63 6f6c 6f72 2873 656c 6629 3a0a  ne_color(self):.
+0000d4e0: 2020 2020 2020 2020 7265 7475 726e 2073          return s
+0000d4f0: 656c 662e 5f6c 696e 655f 636f 6c6f 720a  elf._line_color.
+0000d500: 0a20 2020 2040 6c69 6e65 5f63 6f6c 6f72  .    @line_color
+0000d510: 2e73 6574 7465 720a 2020 2020 6465 6620  .setter.    def 
+0000d520: 6c69 6e65 5f63 6f6c 6f72 2873 656c 662c  line_color(self,
+0000d530: 2076 616c 293a 0a20 2020 2020 2020 2073   val):.        s
+0000d540: 656c 662e 5f6c 696e 655f 7375 7266 6163  elf._line_surfac
+0000d550: 655f 636f 6c6f 7228 225f 6c69 6e65 5f63  e_color("_line_c
+0000d560: 6f6c 6f72 222c 2076 616c 290a 0a0a 636c  olor", val)...cl
+0000d570: 6173 7320 4c69 7374 3244 5365 7269 6573  ass List2DSeries
+0000d580: 284c 696e 6532 4442 6173 6553 6572 6965  (Line2DBaseSerie
+0000d590: 7329 3a0a 2020 2020 2222 2252 6570 7265  s):.    """Repre
+0000d5a0: 7365 6e74 6174 696f 6e20 666f 7220 6120  sentation for a 
+0000d5b0: 6c69 6e65 2063 6f6e 7369 7374 696e 6720  line consisting 
+0000d5c0: 6f66 206c 6973 7420 6f66 2070 6f69 6e74  of list of point
+0000d5d0: 732e 2222 220a 0a20 2020 2064 6566 205f  s."""..    def _
+0000d5e0: 5f69 6e69 745f 5f28 7365 6c66 2c20 6c69  _init__(self, li
+0000d5f0: 7374 5f78 2c20 6c69 7374 5f79 2c20 6c61  st_x, list_y, la
+0000d600: 6265 6c3d 2222 2c20 2a2a 6b77 6172 6773  bel="", **kwargs
+0000d610: 293a 0a20 2020 2020 2020 2073 7570 6572  ):.        super
+0000d620: 2829 2e5f 5f69 6e69 745f 5f28 6c61 6265  ().__init__(labe
+0000d630: 6c3d 6c61 6265 6c2c 202a 2a6b 7761 7267  l=label, **kwarg
+0000d640: 7329 0a20 2020 2020 2020 206e 7020 3d20  s).        np = 
+0000d650: 696d 706f 7274 5f6d 6f64 756c 6528 276e  import_module('n
+0000d660: 756d 7079 2729 0a20 2020 2020 2020 2069  umpy').        i
+0000d670: 6620 6c65 6e28 6c69 7374 5f78 2920 213d  f len(list_x) !=
+0000d680: 206c 656e 286c 6973 745f 7929 3a0a 2020   len(list_y):.  
+0000d690: 2020 2020 2020 2020 2020 7261 6973 6520            raise 
+0000d6a0: 5661 6c75 6545 7272 6f72 280a 2020 2020  ValueError(.    
+0000d6b0: 2020 2020 2020 2020 2020 2020 2254 6865              "The
+0000d6c0: 2074 776f 206c 6973 7473 206f 6620 636f   two lists of co
+0000d6d0: 6f72 6469 6e61 7465 7320 6d75 7374 2068  ordinates must h
+0000d6e0: 6176 6520 7468 6520 7361 6d65 2022 0a20  ave the same ". 
+0000d6f0: 2020 2020 2020 2020 2020 2020 2020 2022                 "
+0000d700: 6e75 6d62 6572 206f 6620 656c 656d 656e  number of elemen
+0000d710: 7473 2e5c 6e52 6563 6569 7665 643a 206c  ts.\nReceived: l
+0000d720: 656e 286c 6973 745f 7829 203d 2025 7320  en(list_x) = %s 
+0000d730: 220a 2020 2020 2020 2020 2020 2020 2020  ".              
+0000d740: 2020 2261 6e64 206c 656e 286c 6973 745f    "and len(list_
+0000d750: 7929 203d 2025 7322 2025 2028 6c65 6e28  y) = %s" % (len(
+0000d760: 6c69 7374 5f78 292c 206c 656e 286c 6973  list_x), len(lis
+0000d770: 745f 7929 290a 2020 2020 2020 2020 2020  t_y)).          
+0000d780: 2020 290a 2020 2020 2020 2020 7365 6c66    ).        self
+0000d790: 2e5f 626c 6f63 6b5f 6c61 6d62 6461 5f66  ._block_lambda_f
+0000d7a0: 756e 6374 696f 6e73 286c 6973 745f 782c  unctions(list_x,
+0000d7b0: 206c 6973 745f 7929 0a20 2020 2020 2020   list_y).       
+0000d7c0: 2063 6865 636b 203d 206c 616d 6264 6120   check = lambda 
+0000d7d0: 6c3a 205b 6973 696e 7374 616e 6365 2874  l: [isinstance(t
+0000d7e0: 2c20 4578 7072 2920 616e 6420 286e 6f74  , Expr) and (not
+0000d7f0: 2074 2e69 735f 6e75 6d62 6572 2920 666f   t.is_number) fo
+0000d800: 7220 7420 696e 206c 5d0a 2020 2020 2020  r t in l].      
+0000d810: 2020 6966 2061 6e79 2863 6865 636b 286c    if any(check(l
+0000d820: 6973 745f 7829 202b 2063 6865 636b 286c  ist_x) + check(l
+0000d830: 6973 745f 7929 2920 6f72 2073 656c 662e  ist_y)) or self.
+0000d840: 7061 7261 6d73 3a0a 2020 2020 2020 2020  params:.        
+0000d850: 2020 2020 6966 206e 6f74 2073 656c 662e      if not self.
+0000d860: 7061 7261 6d73 3a0a 2020 2020 2020 2020  params:.        
+0000d870: 2020 2020 2020 2020 7261 6973 6520 5661          raise Va
+0000d880: 6c75 6545 7272 6f72 280a 2020 2020 2020  lueError(.      
+0000d890: 2020 2020 2020 2020 2020 2020 2020 2253                "S
+0000d8a0: 6f6d 6520 6f72 2061 6c6c 2065 6c65 6d65  ome or all eleme
+0000d8b0: 6e74 7320 6f66 2074 6865 2070 726f 7669  nts of the provi
+0000d8c0: 6465 6420 6c69 7374 7320 220a 2020 2020  ded lists ".    
+0000d8d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000d8e0: 2261 7265 2073 796d 626f 6c69 6320 6578  "are symbolic ex
+0000d8f0: 7072 6573 7369 6f6e 732c 2062 7574 2074  pressions, but t
+0000d900: 6865 2060 6070 6172 616d 7360 6020 6469  he ``params`` di
+0000d910: 6374 696f 6e61 7279 2022 0a20 2020 2020  ctionary ".     
+0000d920: 2020 2020 2020 2020 2020 2020 2020 2022                 "
+0000d930: 7761 7320 6e6f 7420 7072 6f76 6964 6564  was not provided
+0000d940: 3a20 7468 6f73 6520 656c 656d 656e 7473  : those elements
+0000d950: 2063 616e 2774 2062 6520 6576 616c 7561   can't be evalua
+0000d960: 7465 642e 2229 0a20 2020 2020 2020 2020  ted.").         
+0000d970: 2020 2073 656c 662e 6c69 7374 5f78 203d     self.list_x =
+0000d980: 2054 7570 6c65 282a 6c69 7374 5f78 290a   Tuple(*list_x).
+0000d990: 2020 2020 2020 2020 2020 2020 7365 6c66              self
+0000d9a0: 2e6c 6973 745f 7920 3d20 5475 706c 6528  .list_y = Tuple(
+0000d9b0: 2a6c 6973 745f 7929 0a20 2020 2020 2020  *list_y).       
+0000d9c0: 2065 6c73 653a 0a20 2020 2020 2020 2020   else:.         
+0000d9d0: 2020 2073 656c 662e 6c69 7374 5f78 203d     self.list_x =
+0000d9e0: 206e 702e 6172 7261 7928 6c69 7374 5f78   np.array(list_x
+0000d9f0: 2c20 6474 7970 653d 6e70 2e66 6c6f 6174  , dtype=np.float
+0000da00: 3634 290a 2020 2020 2020 2020 2020 2020  64).            
+0000da10: 7365 6c66 2e6c 6973 745f 7920 3d20 6e70  self.list_y = np
+0000da20: 2e61 7272 6179 286c 6973 745f 792c 2064  .array(list_y, d
+0000da30: 7479 7065 3d6e 702e 666c 6f61 7436 3429  type=np.float64)
+0000da40: 0a0a 2020 2020 2020 2020 7365 6c66 2e5f  ..        self._
+0000da50: 6578 7072 203d 2028 7365 6c66 2e6c 6973  expr = (self.lis
+0000da60: 745f 782c 2073 656c 662e 6c69 7374 5f79  t_x, self.list_y
+0000da70: 290a 2020 2020 2020 2020 6966 206e 6f74  ).        if not
+0000da80: 2061 6e79 2869 7369 6e73 7461 6e63 6528   any(isinstance(
+0000da90: 742c 206e 702e 6e64 6172 7261 7929 2066  t, np.ndarray) f
+0000daa0: 6f72 2074 2069 6e20 5b73 656c 662e 6c69  or t in [self.li
+0000dab0: 7374 5f78 2c20 7365 6c66 2e6c 6973 745f  st_x, self.list_
+0000dac0: 795d 293a 0a20 2020 2020 2020 2020 2020  y]):.           
+0000dad0: 2073 656c 662e 5f63 6865 636b 5f66 7328   self._check_fs(
+0000dae0: 290a 0a20 2020 2020 2020 2069 6620 7365  )..        if se
+0000daf0: 6c66 2e75 7365 5f63 6d20 616e 6420 7365  lf.use_cm and se
+0000db00: 6c66 2e63 6f6c 6f72 5f66 756e 633a 0a20  lf.color_func:. 
+0000db10: 2020 2020 2020 2020 2020 2073 656c 662e             self.
+0000db20: 6973 5f70 6172 616d 6574 7269 6320 3d20  is_parametric = 
+0000db30: 5472 7565 0a20 2020 2020 2020 2020 2020  True.           
+0000db40: 2069 6620 6973 696e 7374 616e 6365 2873   if isinstance(s
+0000db50: 656c 662e 636f 6c6f 725f 6675 6e63 2c20  elf.color_func, 
+0000db60: 4578 7072 293a 0a20 2020 2020 2020 2020  Expr):.         
+0000db70: 2020 2020 2020 2072 6169 7365 2054 7970         raise Typ
+0000db80: 6545 7272 6f72 280a 2020 2020 2020 2020  eError(.        
+0000db90: 2020 2020 2020 2020 2020 2020 2225 7320              "%s 
+0000dba0: 646f 6e27 7420 7375 7070 6f72 7420 7379  don't support sy
+0000dbb0: 6d62 6f6c 6963 2022 2025 2073 656c 662e  mbolic " % self.
+0000dbc0: 5f5f 636c 6173 735f 5f2e 5f5f 6e61 6d65  __class__.__name
+0000dbd0: 5f5f 202b 0a20 2020 2020 2020 2020 2020  __ +.           
+0000dbe0: 2020 2020 2020 2020 2022 6578 7072 6573           "expres
+0000dbf0: 7369 6f6e 2066 6f72 2060 636f 6c6f 725f  sion for `color_
+0000dc00: 6675 6e63 602e 2229 0a0a 2020 2020 6465  func`.")..    de
+0000dc10: 6620 5f5f 7374 725f 5f28 7365 6c66 293a  f __str__(self):
+0000dc20: 0a20 2020 2020 2020 2070 7265 203d 2022  .        pre = "
+0000dc30: 3244 2220 6966 2073 656c 662e 6973 5f32  2D" if self.is_2
+0000dc40: 446c 696e 6520 656c 7365 2022 3344 220a  Dline else "3D".
+0000dc50: 2020 2020 2020 2020 7265 7475 726e 2070          return p
+0000dc60: 7265 202b 2022 206c 6973 7420 706c 6f74  re + " list plot
+0000dc70: 220a 0a20 2020 2064 6566 205f 6765 745f  "..    def _get_
+0000dc80: 6461 7461 5f68 656c 7065 7228 7365 6c66  data_helper(self
+0000dc90: 293a 0a20 2020 2020 2020 2022 2222 5265  ):.        """Re
+0000dca0: 7475 726e 7320 636f 6f72 6469 6e61 7465  turns coordinate
+0000dcb0: 7320 7468 6174 206e 6565 6473 2074 6f20  s that needs to 
+0000dcc0: 6265 2070 6f73 7470 726f 6365 7373 6564  be postprocessed
+0000dcd0: 2e22 2222 0a20 2020 2020 2020 206c 782c  .""".        lx,
+0000dce0: 206c 7920 3d20 7365 6c66 2e6c 6973 745f   ly = self.list_
+0000dcf0: 782c 2073 656c 662e 6c69 7374 5f79 0a0a  x, self.list_y..
+0000dd00: 2020 2020 2020 2020 6966 206e 6f74 2073          if not s
+0000dd10: 656c 662e 6973 5f69 6e74 6572 6163 7469  elf.is_interacti
+0000dd20: 7665 3a0a 2020 2020 2020 2020 2020 2020  ve:.            
+0000dd30: 7265 7475 726e 2073 656c 662e 5f65 7661  return self._eva
+0000dd40: 6c5f 636f 6c6f 725f 6675 6e63 5f61 6e64  l_color_func_and
+0000dd50: 5f72 6574 7572 6e28 6c78 2c20 6c79 290a  _return(lx, ly).
+0000dd60: 0a20 2020 2020 2020 206e 7020 3d20 696d  .        np = im
+0000dd70: 706f 7274 5f6d 6f64 756c 6528 276e 756d  port_module('num
+0000dd80: 7079 2729 0a20 2020 2020 2020 206c 7820  py').        lx 
+0000dd90: 3d20 6e70 2e61 7272 6179 285b 742e 6576  = np.array([t.ev
+0000dda0: 616c 6628 7375 6273 3d73 656c 662e 7061  alf(subs=self.pa
+0000ddb0: 7261 6d73 2920 666f 7220 7420 696e 206c  rams) for t in l
+0000ddc0: 785d 2c20 6474 7970 653d 666c 6f61 7429  x], dtype=float)
+0000ddd0: 0a20 2020 2020 2020 206c 7920 3d20 6e70  .        ly = np
+0000dde0: 2e61 7272 6179 285b 742e 6576 616c 6628  .array([t.evalf(
+0000ddf0: 7375 6273 3d73 656c 662e 7061 7261 6d73  subs=self.params
+0000de00: 2920 666f 7220 7420 696e 206c 795d 2c20  ) for t in ly], 
+0000de10: 6474 7970 653d 666c 6f61 7429 0a20 2020  dtype=float).   
+0000de20: 2020 2020 2072 6574 7572 6e20 7365 6c66       return self
+0000de30: 2e5f 6576 616c 5f63 6f6c 6f72 5f66 756e  ._eval_color_fun
+0000de40: 635f 616e 645f 7265 7475 726e 286c 782c  c_and_return(lx,
+0000de50: 206c 7929 0a0a 2020 2020 6465 6620 5f65   ly)..    def _e
+0000de60: 7661 6c5f 636f 6c6f 725f 6675 6e63 5f61  val_color_func_a
+0000de70: 6e64 5f72 6574 7572 6e28 7365 6c66 2c20  nd_return(self, 
+0000de80: 2a64 6174 6129 3a0a 2020 2020 2020 2020  *data):.        
+0000de90: 6966 2073 656c 662e 7573 655f 636d 2061  if self.use_cm a
+0000dea0: 6e64 2063 616c 6c61 626c 6528 7365 6c66  nd callable(self
+0000deb0: 2e63 6f6c 6f72 5f66 756e 6329 3a0a 2020  .color_func):.  
+0000dec0: 2020 2020 2020 2020 2020 7265 7475 726e            return
+0000ded0: 205b 2a64 6174 612c 2073 656c 662e 6576   [*data, self.ev
+0000dee0: 616c 5f63 6f6c 6f72 5f66 756e 6328 2a64  al_color_func(*d
+0000def0: 6174 6129 5d0a 2020 2020 2020 2020 7265  ata)].        re
+0000df00: 7475 726e 2064 6174 610a 0a0a 636c 6173  turn data...clas
+0000df10: 7320 4c69 7374 3344 5365 7269 6573 284c  s List3DSeries(L
+0000df20: 6973 7432 4453 6572 6965 7329 3a0a 2020  ist2DSeries):.  
+0000df30: 2020 6973 5f32 446c 696e 6520 3d20 4661    is_2Dline = Fa
+0000df40: 6c73 650a 2020 2020 6973 5f33 446c 696e  lse.    is_3Dlin
+0000df50: 6520 3d20 5472 7565 0a0a 2020 2020 6465  e = True..    de
+0000df60: 6620 5f5f 696e 6974 5f5f 2873 656c 662c  f __init__(self,
+0000df70: 206c 6973 745f 782c 206c 6973 745f 792c   list_x, list_y,
+0000df80: 206c 6973 745f 7a2c 206c 6162 656c 3d22   list_z, label="
+0000df90: 222c 202a 2a6b 7761 7267 7329 3a0a 2020  ", **kwargs):.  
+0000dfa0: 2020 2020 2020 2320 544f 444f 3a20 7468        # TODO: th
+0000dfb0: 6973 2063 616e 2064 6566 696e 6974 656c  is can definitel
+0000dfc0: 7920 6265 2064 6f6e 6520 6265 7474 6572  y be done better
+0000dfd0: 0a20 2020 2020 2020 2073 7570 6572 2829  .        super()
+0000dfe0: 2e5f 5f69 6e69 745f 5f28 6c69 7374 5f78  .__init__(list_x
+0000dff0: 2c20 6c69 7374 5f79 2c20 6c61 6265 6c2c  , list_y, label,
+0000e000: 202a 2a6b 7761 7267 7329 0a20 2020 2020   **kwargs).     
+0000e010: 2020 206e 7020 3d20 696d 706f 7274 5f6d     np = import_m
+0000e020: 6f64 756c 6528 276e 756d 7079 2729 0a20  odule('numpy'). 
+0000e030: 2020 2020 2020 2069 6620 6c65 6e28 6c69         if len(li
+0000e040: 7374 5f7a 2920 213d 206c 656e 286c 6973  st_z) != len(lis
+0000e050: 745f 7829 3a0a 2020 2020 2020 2020 2020  t_x):.          
+0000e060: 2020 7261 6973 6520 5661 6c75 6545 7272    raise ValueErr
+0000e070: 6f72 280a 2020 2020 2020 2020 2020 2020  or(.            
+0000e080: 2020 2020 2254 6865 2074 6872 6565 206c      "The three l
+0000e090: 6973 7473 206f 6620 636f 6f72 6469 6e61  ists of coordina
+0000e0a0: 7465 7320 6d75 7374 2068 6176 6520 7468  tes must have th
+0000e0b0: 6520 7361 6d65 2022 0a20 2020 2020 2020  e same ".       
+0000e0c0: 2020 2020 2020 2020 2022 6e75 6d62 6572           "number
+0000e0d0: 206f 6620 656c 656d 656e 7473 2e5c 6e22   of elements.\n"
+0000e0e0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0000e0f0: 2022 5265 6365 6976 6564 3a20 6c65 6e28   "Received: len(
+0000e100: 6c69 7374 5f78 2920 3d20 6c65 6e28 6c69  list_x) = len(li
+0000e110: 7374 5f79 2920 3d20 7b7d 2022 2e66 6f72  st_y) = {} ".for
+0000e120: 6d61 7428 6c65 6e28 6c69 7374 5f78 2929  mat(len(list_x))
+0000e130: 202b 0a20 2020 2020 2020 2020 2020 2020   +.             
+0000e140: 2020 2022 616e 6420 6c65 6e28 6c69 7374     "and len(list
+0000e150: 5f7a 2920 3d20 7b7d 222e 666f 726d 6174  _z) = {}".format
+0000e160: 286c 656e 286c 6973 745f 7a29 290a 2020  (len(list_z)).  
+0000e170: 2020 2020 2020 2020 2020 290a 2020 2020            ).    
+0000e180: 2020 2020 7365 6c66 2e5f 626c 6f63 6b5f      self._block_
+0000e190: 6c61 6d62 6461 5f66 756e 6374 696f 6e73  lambda_functions
+0000e1a0: 286c 6973 745f 7a29 0a20 2020 2020 2020  (list_z).       
+0000e1b0: 2063 6865 636b 203d 206c 616d 6264 6120   check = lambda 
+0000e1c0: 6c3a 205b 6973 696e 7374 616e 6365 2874  l: [isinstance(t
+0000e1d0: 2c20 4578 7072 2920 616e 6420 286e 6f74  , Expr) and (not
+0000e1e0: 2074 2e69 735f 6e75 6d62 6572 2920 666f   t.is_number) fo
+0000e1f0: 7220 7420 696e 206c 5d0a 2020 2020 2020  r t in l].      
+0000e200: 2020 6966 2061 6e79 2863 6865 636b 286c    if any(check(l
+0000e210: 6973 745f 7a29 293a 0a20 2020 2020 2020  ist_z)):.       
+0000e220: 2020 2020 2069 6620 6e6f 7420 7365 6c66       if not self
+0000e230: 2e70 6172 616d 733a 0a20 2020 2020 2020  .params:.       
+0000e240: 2020 2020 2020 2020 2072 6169 7365 2056           raise V
+0000e250: 616c 7565 4572 726f 7228 0a20 2020 2020  alueError(.     
+0000e260: 2020 2020 2020 2020 2020 2020 2020 2022                 "
+0000e270: 536f 6d65 206f 7220 616c 6c20 656c 656d  Some or all elem
+0000e280: 656e 7473 206f 6620 7468 6520 7072 6f76  ents of the prov
+0000e290: 6964 6564 206c 6973 7473 2022 0a20 2020  ided lists ".   
+0000e2a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000e2b0: 2022 6172 6520 7379 6d62 6f6c 6963 2065   "are symbolic e
+0000e2c0: 7870 7265 7373 696f 6e73 2c20 6275 7420  xpressions, but 
+0000e2d0: 7468 6520 6060 7061 7261 6d73 6060 2064  the ``params`` d
+0000e2e0: 6963 7469 6f6e 6172 7920 220a 2020 2020  ictionary ".    
+0000e2f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000e300: 2277 6173 206e 6f74 2070 726f 7669 6465  "was not provide
+0000e310: 643a 2074 686f 7365 2065 6c65 6d65 6e74  d: those element
+0000e320: 7320 6361 6e27 7420 6265 2065 7661 6c75  s can't be evalu
+0000e330: 6174 6564 2e22 290a 2020 2020 2020 2020  ated.").        
+0000e340: 2020 2020 7365 6c66 2e6c 6973 745f 7a20      self.list_z 
+0000e350: 3d20 5475 706c 6528 2a6c 6973 745f 7a29  = Tuple(*list_z)
+0000e360: 0a20 2020 2020 2020 2020 2020 2073 656c  .            sel
+0000e370: 662e 5f63 6865 636b 5f66 7328 290a 2020  f._check_fs().  
+0000e380: 2020 2020 2020 656c 7365 3a0a 2020 2020        else:.    
+0000e390: 2020 2020 2020 2020 7365 6c66 2e6c 6973          self.lis
+0000e3a0: 745f 7a20 3d20 6e70 2e61 7272 6179 286c  t_z = np.array(l
+0000e3b0: 6973 745f 7a2c 2064 7479 7065 3d6e 702e  ist_z, dtype=np.
+0000e3c0: 666c 6f61 7436 3429 0a0a 2020 2020 2020  float64)..      
+0000e3d0: 2020 7365 6c66 2e5f 6578 7072 203d 2028    self._expr = (
+0000e3e0: 7365 6c66 2e6c 6973 745f 782c 2073 656c  self.list_x, sel
+0000e3f0: 662e 6c69 7374 5f79 2c20 7365 6c66 2e6c  f.list_y, self.l
+0000e400: 6973 745f 7a29 0a0a 2020 2020 6465 6620  ist_z)..    def 
+0000e410: 5f67 6574 5f64 6174 615f 6865 6c70 6572  _get_data_helper
+0000e420: 2873 656c 6629 3a0a 2020 2020 2020 2020  (self):.        
+0000e430: 2222 2252 6574 7572 6e73 2063 6f6f 7264  """Returns coord
+0000e440: 696e 6174 6573 2074 6861 7420 6e65 6564  inates that need
+0000e450: 7320 746f 2062 6520 706f 7374 7072 6f63  s to be postproc
+0000e460: 6573 7365 642e 2222 220a 2020 2020 2020  essed.""".      
+0000e470: 2020 6c78 2c20 6c79 2c20 6c7a 203d 2073    lx, ly, lz = s
+0000e480: 656c 662e 6c69 7374 5f78 2c20 7365 6c66  elf.list_x, self
+0000e490: 2e6c 6973 745f 792c 2073 656c 662e 6c69  .list_y, self.li
+0000e4a0: 7374 5f7a 0a0a 2020 2020 2020 2020 6966  st_z..        if
+0000e4b0: 206e 6f74 2073 656c 662e 6973 5f69 6e74   not self.is_int
+0000e4c0: 6572 6163 7469 7665 3a0a 2020 2020 2020  eractive:.      
+0000e4d0: 2020 2020 2020 7265 7475 726e 2073 656c        return sel
+0000e4e0: 662e 5f65 7661 6c5f 636f 6c6f 725f 6675  f._eval_color_fu
+0000e4f0: 6e63 5f61 6e64 5f72 6574 7572 6e28 6c78  nc_and_return(lx
+0000e500: 2c20 6c79 2c20 6c7a 290a 0a20 2020 2020  , ly, lz)..     
+0000e510: 2020 206e 7020 3d20 696d 706f 7274 5f6d     np = import_m
+0000e520: 6f64 756c 6528 276e 756d 7079 2729 0a20  odule('numpy'). 
+0000e530: 2020 2020 2020 206c 7820 3d20 6e70 2e61         lx = np.a
+0000e540: 7272 6179 285b 742e 6576 616c 6628 7375  rray([t.evalf(su
+0000e550: 6273 3d73 656c 662e 7061 7261 6d73 2920  bs=self.params) 
+0000e560: 666f 7220 7420 696e 206c 785d 2c20 6474  for t in lx], dt
+0000e570: 7970 653d 666c 6f61 7429 0a20 2020 2020  ype=float).     
+0000e580: 2020 206c 7920 3d20 6e70 2e61 7272 6179     ly = np.array
+0000e590: 285b 742e 6576 616c 6628 7375 6273 3d73  ([t.evalf(subs=s
+0000e5a0: 656c 662e 7061 7261 6d73 2920 666f 7220  elf.params) for 
+0000e5b0: 7420 696e 206c 795d 2c20 6474 7970 653d  t in ly], dtype=
+0000e5c0: 666c 6f61 7429 0a20 2020 2020 2020 206c  float).        l
+0000e5d0: 7a20 3d20 6e70 2e61 7272 6179 285b 742e  z = np.array([t.
+0000e5e0: 6576 616c 6628 7375 6273 3d73 656c 662e  evalf(subs=self.
+0000e5f0: 7061 7261 6d73 2920 666f 7220 7420 696e  params) for t in
+0000e600: 206c 7a5d 2c20 6474 7970 653d 666c 6f61   lz], dtype=floa
+0000e610: 7429 0a20 2020 2020 2020 2072 6574 7572  t).        retur
+0000e620: 6e20 7365 6c66 2e5f 6576 616c 5f63 6f6c  n self._eval_col
+0000e630: 6f72 5f66 756e 635f 616e 645f 7265 7475  or_func_and_retu
+0000e640: 726e 286c 782c 206c 792c 206c 7a29 0a0a  rn(lx, ly, lz)..
+0000e650: 0a63 6c61 7373 204c 696e 654f 7665 7231  .class LineOver1
+0000e660: 4452 616e 6765 5365 7269 6573 280a 2020  DRangeSeries(.  
+0000e670: 2020 436f 6d6d 6f6e 4164 6170 7469 7665    CommonAdaptive
+0000e680: 4576 616c 7561 7469 6f6e 2c20 436f 6d6d  Evaluation, Comm
+0000e690: 6f6e 556e 6966 6f72 6d45 7661 6c75 6174  onUniformEvaluat
+0000e6a0: 696f 6e2c 204c 696e 6532 4442 6173 6553  ion, Line2DBaseS
+0000e6b0: 6572 6965 730a 293a 0a20 2020 2022 2222  eries.):.    """
+0000e6c0: 5265 7072 6573 656e 7461 7469 6f6e 2066  Representation f
+0000e6d0: 6f72 2061 206c 696e 6520 636f 6e73 6973  or a line consis
+0000e6e0: 7469 6e67 206f 6620 6120 5379 6d50 7920  ting of a SymPy 
+0000e6f0: 6578 7072 6573 7369 6f6e 206f 7665 7220  expression over 
+0000e700: 610a 2020 2020 7265 616c 2072 616e 6765  a.    real range
+0000e710: 2e22 2222 0a0a 2020 2020 5f61 6c6c 6f77  ."""..    _allow
+0000e720: 6564 5f6b 6579 7320 3d20 5b0a 2020 2020  ed_keys = [.    
+0000e730: 2020 2020 2261 6273 6172 6722 2c20 2269      "absarg", "i
+0000e740: 735f 636f 6d70 6c65 7822 2c20 2269 735f  s_complex", "is_
+0000e750: 706f 6c61 7222 0a20 2020 205d 0a0a 2020  polar".    ]..  
+0000e760: 2020 6465 6620 5f5f 6e65 775f 5f28 636c    def __new__(cl
+0000e770: 732c 202a 6172 6773 2c20 2a2a 6b77 6172  s, *args, **kwar
+0000e780: 6773 293a 0a20 2020 2020 2020 2069 6620  gs):.        if 
+0000e790: 6b77 6172 6773 2e67 6574 2822 6162 7361  kwargs.get("absa
+0000e7a0: 7267 222c 2046 616c 7365 293a 0a20 2020  rg", False):.   
+0000e7b0: 2020 2020 2020 2020 2072 6574 7572 6e20           return 
+0000e7c0: 7375 7065 7228 292e 5f5f 6e65 775f 5f28  super().__new__(
+0000e7d0: 4162 7341 7267 4c69 6e65 5365 7269 6573  AbsArgLineSeries
+0000e7e0: 290a 2020 2020 2020 2020 6366 203d 206b  ).        cf = k
+0000e7f0: 7761 7267 732e 6765 7428 2263 6f6c 6f72  wargs.get("color
+0000e800: 5f66 756e 6322 2c20 4e6f 6e65 290a 2020  _func", None).  
+0000e810: 2020 2020 2020 6c63 203d 206b 7761 7267        lc = kwarg
+0000e820: 732e 6765 7428 226c 696e 655f 636f 6c6f  s.get("line_colo
+0000e830: 7222 2c20 4e6f 6e65 290a 2020 2020 2020  r", None).      
+0000e840: 2020 6966 2028 6361 6c6c 6162 6c65 2863    if (callable(c
+0000e850: 6629 206f 7220 6361 6c6c 6162 6c65 286c  f) or callable(l
+0000e860: 6329 206f 7220 6973 696e 7374 616e 6365  c) or isinstance
+0000e870: 2863 662c 2045 7870 7229 293a 0a20 2020  (cf, Expr)):.   
+0000e880: 2020 2020 2020 2020 2072 6574 7572 6e20           return 
+0000e890: 7375 7065 7228 292e 5f5f 6e65 775f 5f28  super().__new__(
+0000e8a0: 436f 6c6f 7265 644c 696e 654f 7665 7231  ColoredLineOver1
+0000e8b0: 4452 616e 6765 5365 7269 6573 290a 2020  DRangeSeries).  
+0000e8c0: 2020 2020 2020 7265 7475 726e 206f 626a        return obj
+0000e8d0: 6563 742e 5f5f 6e65 775f 5f28 636c 7329  ect.__new__(cls)
+0000e8e0: 0a0a 2020 2020 6465 6620 5f5f 696e 6974  ..    def __init
+0000e8f0: 5f5f 2873 656c 662c 2065 7870 722c 2076  __(self, expr, v
+0000e900: 6172 5f73 7461 7274 5f65 6e64 2c20 6c61  ar_start_end, la
+0000e910: 6265 6c3d 2222 2c20 2a2a 6b77 6172 6773  bel="", **kwargs
+0000e920: 293a 0a20 2020 2020 2020 2073 7570 6572  ):.        super
+0000e930: 2829 2e5f 5f69 6e69 745f 5f28 2a2a 6b77  ().__init__(**kw
+0000e940: 6172 6773 290a 2020 2020 2020 2020 7365  args).        se
+0000e950: 6c66 2e65 7870 7220 3d20 6578 7072 2069  lf.expr = expr i
+0000e960: 6620 6361 6c6c 6162 6c65 2865 7870 7229  f callable(expr)
+0000e970: 2065 6c73 6520 7379 6d70 6966 7928 6578   else sympify(ex
+0000e980: 7072 290a 2020 2020 2020 2020 7365 6c66  pr).        self
+0000e990: 2e5f 6c61 6265 6c20 3d20 7374 7228 7365  ._label = str(se
+0000e9a0: 6c66 2e65 7870 7229 2069 6620 6c61 6265  lf.expr) if labe
+0000e9b0: 6c20 6973 204e 6f6e 6520 656c 7365 206c  l is None else l
+0000e9c0: 6162 656c 0a20 2020 2020 2020 2073 656c  abel.        sel
+0000e9d0: 662e 5f6c 6174 6578 5f6c 6162 656c 203d  f._latex_label =
+0000e9e0: 206c 6174 6578 2873 656c 662e 6578 7072   latex(self.expr
+0000e9f0: 2920 6966 206c 6162 656c 2069 7320 4e6f  ) if label is No
+0000ea00: 6e65 2065 6c73 6520 6c61 6265 6c0a 2020  ne else label.  
+0000ea10: 2020 2020 2020 7365 6c66 2e72 616e 6765        self.range
+0000ea20: 7320 3d20 5b76 6172 5f73 7461 7274 5f65  s = [var_start_e
+0000ea30: 6e64 5d0a 2020 2020 2020 2020 2320 7468  nd].        # th
+0000ea40: 6973 2069 7320 7573 6564 2074 6f20 6361  is is used to ca
+0000ea50: 7374 2074 6865 2076 616c 7565 7320 6f66  st the values of
+0000ea60: 2072 616e 6765 7320 7768 656e 2073 656c   ranges when sel
+0000ea70: 662e 7374 6172 742f 7365 6c66 2e65 6e64  f.start/self.end
+0000ea80: 0a20 2020 2020 2020 2023 2061 7265 2063  .        # are c
+0000ea90: 616c 6c65 642e 2055 7365 6420 666f 7220  alled. Used for 
+0000eaa0: 6261 636b 2d63 6f6d 7061 7469 6269 6c69  back-compatibili
+0000eab0: 7479 2077 6974 6820 6f6c 6420 7379 6d70  ty with old symp
+0000eac0: 792e 706c 6f74 7469 6e67 2c0a 2020 2020  y.plotting,.    
+0000ead0: 2020 2020 2320 6974 2069 7320 6e6f 7720      # it is now 
+0000eae0: 6469 6666 6963 756c 7420 746f 2072 656d  difficult to rem
+0000eaf0: 6f76 652e 0a20 2020 2020 2020 2073 656c  ove..        sel
+0000eb00: 662e 5f63 6173 7420 3d20 636f 6d70 6c65  f._cast = comple
+0000eb10: 780a 2020 2020 2020 2020 2320 666f 7220  x.        # for 
+0000eb20: 636f 6d70 6c65 782d 7265 6c61 7465 6420  complex-related 
+0000eb30: 6461 7461 2073 6572 6965 732c 2074 6869  data series, thi
+0000eb40: 7320 6465 7465 726d 696e 6573 2077 6861  s determines wha
+0000eb50: 7420 6461 7461 2074 6f20 7265 7475 726e  t data to return
+0000eb60: 0a20 2020 2020 2020 2023 206f 6e20 7468  .        # on th
+0000eb70: 6520 792d 6178 6973 0a20 2020 2020 2020  e y-axis.       
+0000eb80: 2073 656c 662e 5f72 6574 7572 6e20 3d20   self._return = 
+0000eb90: 6b77 6172 6773 2e67 6574 2822 7265 7475  kwargs.get("retu
+0000eba0: 726e 222c 204e 6f6e 6529 0a20 2020 2020  rn", None).     
+0000ebb0: 2020 2073 656c 662e 5f70 6f73 745f 696e     self._post_in
+0000ebc0: 6974 2829 0a0a 2020 2020 2020 2020 6966  it()..        if
+0000ebd0: 206e 6f74 2073 656c 662e 5f69 6e74 6572   not self._inter
+0000ebe0: 6163 7469 7665 5f72 616e 6765 733a 0a20  active_ranges:. 
+0000ebf0: 2020 2020 2020 2020 2020 2023 204e 4f54             # NOT
+0000ec00: 453a 2074 6865 2066 6f6c 6c6f 7769 6e67  E: the following
+0000ec10: 2063 6865 636b 2069 7320 6f6e 6c79 2070   check is only p
+0000ec20: 6f73 7369 626c 6520 7768 656e 2074 6865  ossible when the
+0000ec30: 206d 696e 696d 756d 2061 6e64 0a20 2020   minimum and.   
+0000ec40: 2020 2020 2020 2020 2023 206d 6178 696d           # maxim
+0000ec50: 756d 2076 616c 7565 7320 6f66 2061 2070  um values of a p
+0000ec60: 6c6f 7474 696e 6720 7261 6e67 6520 6172  lotting range ar
+0000ec70: 6520 6e75 6d65 7269 630a 2020 2020 2020  e numeric.      
+0000ec80: 2020 2020 2020 7374 6172 742c 2065 6e64        start, end
+0000ec90: 203d 205b 636f 6d70 6c65 7828 7429 2066   = [complex(t) f
+0000eca0: 6f72 2074 2069 6e20 7365 6c66 2e72 616e  or t in self.ran
+0000ecb0: 6765 735b 305d 5b31 3a5d 5d0a 2020 2020  ges[0][1:]].    
+0000ecc0: 2020 2020 2020 2020 6966 2069 6d28 7374          if im(st
+0000ecd0: 6172 7429 2021 3d20 696d 2865 6e64 293a  art) != im(end):
+0000ece0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0000ecf0: 2072 6169 7365 2056 616c 7565 4572 726f   raise ValueErro
+0000ed00: 7228 0a20 2020 2020 2020 2020 2020 2020  r(.             
+0000ed10: 2020 2020 2020 2022 2573 2072 6571 7569         "%s requi
+0000ed20: 7265 7320 7468 6520 696d 6167 696e 6172  res the imaginar
+0000ed30: 7920 2220 2520 7365 6c66 2e5f 5f63 6c61  y " % self.__cla
+0000ed40: 7373 5f5f 2e5f 5f6e 616d 655f 5f20 2b0a  ss__.__name__ +.
+0000ed50: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000ed60: 2020 2020 2270 6172 7420 6f66 2074 6865      "part of the
+0000ed70: 2073 7461 7274 2061 6e64 2065 6e64 2076   start and end v
+0000ed80: 616c 7565 7320 6f66 2074 6865 2072 616e  alues of the ran
+0000ed90: 6765 2022 0a20 2020 2020 2020 2020 2020  ge ".           
+0000eda0: 2020 2020 2020 2020 2022 746f 2062 6520           "to be 
+0000edb0: 7468 6520 7361 6d65 2e22 290a 0a20 2020  the same.")..   
+0000edc0: 2064 6566 205f 5f73 7472 5f5f 2873 656c   def __str__(sel
+0000edd0: 6629 3a0a 2020 2020 2020 2020 6465 6620  f):.        def 
+0000ede0: 6628 7429 3a0a 2020 2020 2020 2020 2020  f(t):.          
+0000edf0: 2020 6966 2069 7369 6e73 7461 6e63 6528    if isinstance(
+0000ee00: 742c 2063 6f6d 706c 6578 293a 0a20 2020  t, complex):.   
+0000ee10: 2020 2020 2020 2020 2020 2020 2069 6620               if 
+0000ee20: 742e 696d 6167 2021 3d20 303a 0a20 2020  t.imag != 0:.   
+0000ee30: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000ee40: 2072 6574 7572 6e20 740a 2020 2020 2020   return t.      
+0000ee50: 2020 2020 2020 2020 2020 7265 7475 726e            return
+0000ee60: 2074 2e72 6561 6c0a 2020 2020 2020 2020   t.real.        
+0000ee70: 2020 2020 7265 7475 726e 2074 0a20 2020      return t.   
+0000ee80: 2020 2020 2070 7265 203d 2022 696e 7465       pre = "inte
+0000ee90: 7261 6374 6976 6520 2220 6966 2073 656c  ractive " if sel
+0000eea0: 662e 6973 5f69 6e74 6572 6163 7469 7665  f.is_interactive
+0000eeb0: 2065 6c73 6520 2222 0a20 2020 2020 2020   else "".       
+0000eec0: 2070 6f73 7420 3d20 2222 0a20 2020 2020   post = "".     
+0000eed0: 2020 2069 6620 7365 6c66 2e69 735f 696e     if self.is_in
+0000eee0: 7465 7261 6374 6976 653a 0a20 2020 2020  teractive:.     
+0000eef0: 2020 2020 2020 2070 6f73 7420 3d20 2220         post = " 
+0000ef00: 616e 6420 7061 7261 6d65 7465 7273 2022  and parameters "
+0000ef10: 202b 2073 7472 2874 7570 6c65 2873 656c   + str(tuple(sel
+0000ef20: 662e 7061 7261 6d73 2e6b 6579 7328 2929  f.params.keys())
+0000ef30: 290a 2020 2020 2020 2020 7772 6170 7065  ).        wrappe
+0000ef40: 7220 3d20 5f67 6574 5f77 7261 7070 6572  r = _get_wrapper
+0000ef50: 5f66 6f72 5f65 7870 7228 7365 6c66 2e5f  _for_expr(self._
+0000ef60: 7265 7475 726e 290a 2020 2020 2020 2020  return).        
+0000ef70: 7265 7475 726e 2070 7265 202b 2022 6361  return pre + "ca
+0000ef80: 7274 6573 6961 6e20 6c69 6e65 3a20 2573  rtesian line: %s
+0000ef90: 2066 6f72 2025 7320 6f76 6572 2025 7322   for %s over %s"
+0000efa0: 2025 2028 0a20 2020 2020 2020 2020 2020   % (.           
+0000efb0: 2077 7261 7070 6572 2025 2073 656c 662e   wrapper % self.
+0000efc0: 6578 7072 2c0a 2020 2020 2020 2020 2020  expr,.          
+0000efd0: 2020 7374 7228 7365 6c66 2e76 6172 292c    str(self.var),
+0000efe0: 0a20 2020 2020 2020 2020 2020 2073 7472  .            str
+0000eff0: 2828 6628 7365 6c66 2e73 7461 7274 292c  ((f(self.start),
+0000f000: 2066 2873 656c 662e 656e 6429 2929 2c0a   f(self.end))),.
+0000f010: 2020 2020 2020 2020 2920 2b20 706f 7374          ) + post
+0000f020: 0a0a 2020 2020 6465 6620 5f61 6461 7074  ..    def _adapt
+0000f030: 6976 655f 7361 6d70 6c69 6e67 2873 656c  ive_sampling(sel
+0000f040: 6629 3a0a 2020 2020 2020 2020 6e70 203d  f):.        np =
+0000f050: 2069 6d70 6f72 745f 6d6f 6475 6c65 2827   import_module('
+0000f060: 6e75 6d70 7927 290a 0a20 2020 2020 2020  numpy')..       
+0000f070: 2064 6566 2066 756e 6328 662c 2069 6d61   def func(f, ima
+0000f080: 672c 2078 293a 0a20 2020 2020 2020 2020  g, x):.         
+0000f090: 2020 2074 7279 3a0a 2020 2020 2020 2020     try:.        
+0000f0a0: 2020 2020 2020 2020 7720 3d20 636f 6d70          w = comp
+0000f0b0: 6c65 7828 6628 7820 2b20 316a 202a 2069  lex(f(x + 1j * i
+0000f0c0: 6d61 6729 290a 2020 2020 2020 2020 2020  mag)).          
+0000f0d0: 2020 2020 2020 7265 7475 726e 2077 2e72        return w.r
+0000f0e0: 6561 6c2c 2077 2e69 6d61 670a 2020 2020  eal, w.imag.    
+0000f0f0: 2020 2020 2020 2020 6578 6365 7074 2028          except (
+0000f100: 5a65 726f 4469 7669 7369 6f6e 4572 726f  ZeroDivisionErro
+0000f110: 722c 204f 7665 7266 6c6f 7745 7272 6f72  r, OverflowError
+0000f120: 293a 0a20 2020 2020 2020 2020 2020 2020  ):.             
+0000f130: 2020 2072 6574 7572 6e20 6e70 2e6e 616e     return np.nan
+0000f140: 2c20 6e70 2e6e 616e 0a0a 2020 2020 2020  , np.nan..      
+0000f150: 2020 6461 7461 203d 205f 6164 6170 7469    data = _adapti
+0000f160: 7665 5f65 7661 6c28 0a20 2020 2020 2020  ve_eval(.       
+0000f170: 2020 2020 2066 756e 632c 205b 7365 6c66       func, [self
+0000f180: 2e76 6172 5d2c 2073 656c 662e 6578 7072  .var], self.expr
+0000f190: 2c0a 2020 2020 2020 2020 2020 2020 5b63  ,.            [c
+0000f1a0: 6f6d 706c 6578 2873 656c 662e 7374 6172  omplex(self.star
+0000f1b0: 7429 2e72 6561 6c2c 2063 6f6d 706c 6578  t).real, complex
+0000f1c0: 2873 656c 662e 656e 6429 2e72 6561 6c5d  (self.end).real]
+0000f1d0: 2c0a 2020 2020 2020 2020 2020 2020 636f  ,.            co
+0000f1e0: 6d70 6c65 7828 7365 6c66 2e73 7461 7274  mplex(self.start
+0000f1f0: 292e 696d 6167 2c0a 2020 2020 2020 2020  ).imag,.        
+0000f200: 2020 2020 6d6f 6475 6c65 733d 7365 6c66      modules=self
+0000f210: 2e6d 6f64 756c 6573 2c0a 2020 2020 2020  .modules,.      
+0000f220: 2020 2020 2020 6164 6170 7469 7665 5f67        adaptive_g
+0000f230: 6f61 6c3d 7365 6c66 2e61 6461 7074 6976  oal=self.adaptiv
+0000f240: 655f 676f 616c 2c0a 2020 2020 2020 2020  e_goal,.        
+0000f250: 2020 2020 6c6f 7373 5f66 6e3d 7365 6c66      loss_fn=self
+0000f260: 2e6c 6f73 735f 666e 290a 2020 2020 2020  .loss_fn).      
+0000f270: 2020 7265 7475 726e 2064 6174 615b 3a2c    return data[:,
+0000f280: 2030 5d2c 2064 6174 615b 3a2c 2031 5d2c   0], data[:, 1],
+0000f290: 2064 6174 615b 3a2c 2032 5d0a 0a20 2020   data[:, 2]..   
+0000f2a0: 2064 6566 205f 756e 6966 6f72 6d5f 7361   def _uniform_sa
+0000f2b0: 6d70 6c69 6e67 2873 656c 6629 3a0a 2020  mpling(self):.  
+0000f2c0: 2020 2020 2020 6e70 203d 2069 6d70 6f72        np = impor
+0000f2d0: 745f 6d6f 6475 6c65 2827 6e75 6d70 7927  t_module('numpy'
+0000f2e0: 290a 0a20 2020 2020 2020 2078 2c20 7265  )..        x, re
+0000f2f0: 7375 6c74 203d 2073 656c 662e 5f65 7661  sult = self._eva
+0000f300: 6c75 6174 6528 290a 2020 2020 2020 2020  luate().        
+0000f310: 5f72 652c 205f 696d 203d 206e 702e 7265  _re, _im = np.re
+0000f320: 616c 2872 6573 756c 7429 2c20 6e70 2e69  al(result), np.i
+0000f330: 6d61 6728 7265 7375 6c74 290a 2020 2020  mag(result).    
+0000f340: 2020 2020 5f72 6520 3d20 7365 6c66 2e5f      _re = self._
+0000f350: 636f 7272 6563 745f 7368 6170 6528 5f72  correct_shape(_r
+0000f360: 652c 2078 290a 2020 2020 2020 2020 5f69  e, x).        _i
+0000f370: 6d20 3d20 7365 6c66 2e5f 636f 7272 6563  m = self._correc
+0000f380: 745f 7368 6170 6528 5f69 6d2c 2078 290a  t_shape(_im, x).
+0000f390: 2020 2020 2020 2020 7265 7475 726e 2078          return x
+0000f3a0: 2c20 5f72 652c 205f 696d 0a0a 2020 2020  , _re, _im..    
+0000f3b0: 6465 6620 5f67 6574 5f72 6561 6c5f 696d  def _get_real_im
+0000f3c0: 6167 2873 656c 6629 3a0a 2020 2020 2020  ag(self):.      
+0000f3d0: 2020 2222 2220 4279 2065 7661 6c75 6174    """ By evaluat
+0000f3e0: 696e 6720 7468 6520 6675 6e63 7469 6f6e  ing the function
+0000f3f0: 206f 7665 7220 6120 636f 6d70 6c65 7820   over a complex 
+0000f400: 7261 6e67 6520 6974 2073 686f 756c 640a  range it should.
+0000f410: 2020 2020 2020 2020 7265 7475 726e 2063          return c
+0000f420: 6f6d 706c 6578 2076 616c 7565 732e 2054  omplex values. T
+0000f430: 6865 2069 6d61 6769 6e61 7279 2070 6172  he imaginary par
+0000f440: 7420 6361 6e20 6265 2075 7365 6420 746f  t can be used to
+0000f450: 206d 6173 6b20 6f75 7420 7468 650a 2020   mask out the.  
+0000f460: 2020 2020 2020 756e 7761 6e74 6564 2076        unwanted v
+0000f470: 616c 7565 732e 0a20 2020 2020 2020 2022  alues..        "
+0000f480: 2222 0a20 2020 2020 2020 2069 6620 7365  "".        if se
+0000f490: 6c66 2e61 6461 7074 6976 653a 0a20 2020  lf.adaptive:.   
+0000f4a0: 2020 2020 2020 2020 2072 6574 7572 6e20           return 
+0000f4b0: 7365 6c66 2e5f 6164 6170 7469 7665 5f73  self._adaptive_s
+0000f4c0: 616d 706c 696e 6728 290a 2020 2020 2020  ampling().      
+0000f4d0: 2020 7265 7475 726e 2073 656c 662e 5f75    return self._u
+0000f4e0: 6e69 666f 726d 5f73 616d 706c 696e 6728  niform_sampling(
+0000f4f0: 290a 0a20 2020 2064 6566 205f 6765 745f  )..    def _get_
+0000f500: 6461 7461 5f68 656c 7065 7228 7365 6c66  data_helper(self
+0000f510: 293a 0a20 2020 2020 2020 2022 2222 5265  ):.        """Re
+0000f520: 7475 726e 7320 636f 6f72 6469 6e61 7465  turns coordinate
+0000f530: 7320 7468 6174 206e 6565 6473 2074 6f20  s that needs to 
+0000f540: 6265 2070 6f73 7470 726f 6365 7373 6564  be postprocessed
+0000f550: 2e0a 2020 2020 2020 2020 2222 220a 2020  ..        """.  
+0000f560: 2020 2020 2020 6e70 203d 2069 6d70 6f72        np = impor
+0000f570: 745f 6d6f 6475 6c65 2827 6e75 6d70 7927  t_module('numpy'
+0000f580: 290a 0a20 2020 2020 2020 2078 2c20 5f72  )..        x, _r
+0000f590: 652c 205f 696d 203d 2073 656c 662e 5f67  e, _im = self._g
+0000f5a0: 6574 5f72 6561 6c5f 696d 6167 2829 0a0a  et_real_imag()..
+0000f5b0: 2020 2020 2020 2020 6966 2073 656c 662e          if self.
+0000f5c0: 5f72 6574 7572 6e20 6973 204e 6f6e 653a  _return is None:
+0000f5d0: 0a20 2020 2020 2020 2020 2020 2023 2054  .            # T
+0000f5e0: 6865 2065 7661 6c75 6174 696f 6e20 636f  he evaluation co
+0000f5f0: 756c 6420 7072 6f64 7563 6520 636f 6d70  uld produce comp
+0000f600: 6c65 7820 6e75 6d62 6572 732e 2053 6574  lex numbers. Set
+0000f610: 2072 6561 6c20 656c 656d 656e 7473 0a20   real elements. 
+0000f620: 2020 2020 2020 2020 2020 2023 2074 6f20             # to 
+0000f630: 4e61 4e20 7768 6572 6520 7468 6572 6520  NaN where there 
+0000f640: 6172 6520 6e6f 6e2d 7a65 726f 2069 6d61  are non-zero ima
+0000f650: 6769 6e61 7279 2065 6c65 6d65 6e74 730a  ginary elements.
+0000f660: 2020 2020 2020 2020 2020 2020 5f72 655b              _re[
+0000f670: 6e70 2e69 6e76 6572 7428 6e70 2e69 7363  np.invert(np.isc
+0000f680: 6c6f 7365 285f 696d 2c20 6e70 2e7a 6572  lose(_im, np.zer
+0000f690: 6f73 5f6c 696b 6528 5f69 6d29 2929 5d20  os_like(_im)))] 
+0000f6a0: 3d20 6e70 2e6e 616e 0a20 2020 2020 2020  = np.nan.       
+0000f6b0: 2065 6c69 6620 7365 6c66 2e5f 7265 7475   elif self._retu
+0000f6c0: 726e 203d 3d20 2272 6561 6c22 3a0a 2020  rn == "real":.  
+0000f6d0: 2020 2020 2020 2020 2020 7061 7373 0a20            pass. 
+0000f6e0: 2020 2020 2020 2065 6c69 6620 7365 6c66         elif self
+0000f6f0: 2e5f 7265 7475 726e 203d 3d20 2269 6d61  ._return == "ima
+0000f700: 6722 3a0a 2020 2020 2020 2020 2020 2020  g":.            
+0000f710: 5f72 6520 3d20 5f69 6d0a 2020 2020 2020  _re = _im.      
+0000f720: 2020 656c 6966 2073 656c 662e 5f72 6574    elif self._ret
+0000f730: 7572 6e20 3d3d 2022 6162 7322 3a0a 2020  urn == "abs":.  
+0000f740: 2020 2020 2020 2020 2020 5f72 6520 3d20            _re = 
+0000f750: 6e70 2e73 7172 7428 5f72 652a 2a32 202b  np.sqrt(_re**2 +
+0000f760: 205f 696d 2a2a 3229 0a20 2020 2020 2020   _im**2).       
+0000f770: 2065 6c69 6620 7365 6c66 2e5f 7265 7475   elif self._retu
+0000f780: 726e 203d 3d20 2261 7267 223a 0a20 2020  rn == "arg":.   
+0000f790: 2020 2020 2020 2020 205f 7265 203d 206e           _re = n
+0000f7a0: 702e 6172 6374 616e 3228 5f69 6d2c 205f  p.arctan2(_im, _
+0000f7b0: 7265 290a 2020 2020 2020 2020 656c 7365  re).        else
+0000f7c0: 3a0a 2020 2020 2020 2020 2020 2020 7261  :.            ra
+0000f7d0: 6973 6520 5661 6c75 6545 7272 6f72 280a  ise ValueError(.
+0000f7e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000f7f0: 2260 5f72 6574 7572 6e60 206e 6f74 2072  "`_return` not r
+0000f800: 6563 6f67 6e69 7a65 642e 2052 6563 6569  ecognized. Recei
+0000f810: 7665 643a 2025 7322 2025 2073 656c 662e  ved: %s" % self.
+0000f820: 5f72 6574 7572 6e29 0a0a 2020 2020 2020  _return)..      
+0000f830: 2020 7265 7475 726e 2078 2c20 5f72 650a    return x, _re.
+0000f840: 0a0a 636c 6173 7320 436f 6c6f 7265 644c  ..class ColoredL
+0000f850: 696e 654f 7665 7231 4452 616e 6765 5365  ineOver1DRangeSe
+0000f860: 7269 6573 284c 696e 654f 7665 7231 4452  ries(LineOver1DR
+0000f870: 616e 6765 5365 7269 6573 293a 0a20 2020  angeSeries):.   
+0000f880: 2022 2222 5265 7072 6573 656e 7473 2061   """Represents a
+0000f890: 2032 4420 6c69 6e65 2073 6572 6965 7320   2D line series 
+0000f8a0: 696e 2077 6869 6368 2060 636f 6c6f 725f  in which `color_
+0000f8b0: 6675 6e63 6020 6973 2061 2063 616c 6c61  func` is a calla
+0000f8c0: 626c 652e 0a20 2020 2022 2222 0a20 2020  ble..    """.   
+0000f8d0: 2069 735f 7061 7261 6d65 7472 6963 203d   is_parametric =
+0000f8e0: 2054 7275 650a 0a20 2020 2064 6566 205f   True..    def _
+0000f8f0: 5f69 6e69 745f 5f28 7365 6c66 2c20 2a61  _init__(self, *a
+0000f900: 7267 732c 202a 2a6b 7761 7267 7329 3a0a  rgs, **kwargs):.
+0000f910: 2020 2020 2020 2020 7375 7065 7228 292e          super().
+0000f920: 5f5f 696e 6974 5f5f 282a 6172 6773 2c20  __init__(*args, 
+0000f930: 2a2a 6b77 6172 6773 290a 2020 2020 2020  **kwargs).      
+0000f940: 2020 7365 6c66 2e75 7365 5f63 6d20 3d20    self.use_cm = 
+0000f950: 6b77 6172 6773 2e67 6574 2822 7573 655f  kwargs.get("use_
+0000f960: 636d 222c 2054 7275 6529 0a0a 2020 2020  cm", True)..    
+0000f970: 6465 6620 5f67 6574 5f64 6174 615f 6865  def _get_data_he
+0000f980: 6c70 6572 2873 656c 6629 3a0a 2020 2020  lper(self):.    
+0000f990: 2020 2020 2222 2252 6574 7572 6e73 2063      """Returns c
+0000f9a0: 6f6f 7264 696e 6174 6573 2074 6861 7420  oordinates that 
+0000f9b0: 6e65 6564 7320 746f 2062 6520 706f 7374  needs to be post
+0000f9c0: 7072 6f63 6573 7365 642e 0a20 2020 2020  processed..     
+0000f9d0: 2020 2044 6570 656e 6469 6e67 206f 6e20     Depending on 
+0000f9e0: 7468 6520 6061 6461 7074 6976 6560 206f  the `adaptive` o
+0000f9f0: 7074 696f 6e2c 2074 6869 7320 6675 6e63  ption, this func
+0000fa00: 7469 6f6e 2077 696c 6c20 6569 7468 6572  tion will either
+0000fa10: 2075 7365 2061 6e0a 2020 2020 2020 2020   use an.        
+0000fa20: 6164 6170 7469 7665 2061 6c67 6f72 6974  adaptive algorit
+0000fa30: 686d 206f 7220 6974 2077 696c 6c20 756e  hm or it will un
+0000fa40: 6966 6f72 6d6c 7920 7361 6d70 6c65 2074  iformly sample t
+0000fa50: 6865 2065 7870 7265 7373 696f 6e20 6f76  he expression ov
+0000fa60: 6572 2074 6865 0a20 2020 2020 2020 2070  er the.        p
+0000fa70: 726f 7669 6465 6420 7261 6e67 652e 0a20  rovided range.. 
+0000fa80: 2020 2020 2020 2022 2222 0a20 2020 2020         """.     
+0000fa90: 2020 2078 2c20 7920 3d20 7375 7065 7228     x, y = super(
+0000faa0: 292e 5f67 6574 5f64 6174 615f 6865 6c70  )._get_data_help
+0000fab0: 6572 2829 0a20 2020 2020 2020 2072 6574  er().        ret
+0000fac0: 7572 6e20 782c 2079 2c20 7365 6c66 2e65  urn x, y, self.e
+0000fad0: 7661 6c5f 636f 6c6f 725f 6675 6e63 2878  val_color_func(x
+0000fae0: 2c20 7929 0a0a 0a63 6c61 7373 2041 6273  , y)...class Abs
+0000faf0: 4172 674c 696e 6553 6572 6965 7328 4c69  ArgLineSeries(Li
+0000fb00: 6e65 4f76 6572 3144 5261 6e67 6553 6572  neOver1DRangeSer
+0000fb10: 6965 7329 3a0a 2020 2020 2222 2252 6570  ies):.    """Rep
+0000fb20: 7265 7365 6e74 7320 7468 6520 6162 736f  resents the abso
+0000fb30: 6c75 7465 2076 616c 7565 206f 6620 6120  lute value of a 
+0000fb40: 636f 6d70 6c65 7820 6675 6e63 7469 6f6e  complex function
+0000fb50: 2063 6f6c 6f72 6564 2062 7920 6974 730a   colored by its.
+0000fb60: 2020 2020 6172 6775 6d65 6e74 206f 7665      argument ove
+0000fb70: 7220 6120 636f 6d70 6c65 7820 7261 6e67  r a complex rang
+0000fb80: 6520 2861 202b 2049 2a62 2c20 6320 2b20  e (a + I*b, c + 
+0000fb90: 4920 2a20 6229 2e0a 2020 2020 4e6f 7465  I * b)..    Note
+0000fba0: 2074 6861 7420 7468 6520 696d 6167 696e   that the imagin
+0000fbb0: 6172 7920 7061 7274 206f 6620 7468 6520  ary part of the 
+0000fbc0: 7374 6172 7420 616e 6420 656e 6420 6d75  start and end mu
+0000fbd0: 7374 2062 6520 7468 6520 7361 6d65 2e0a  st be the same..
+0000fbe0: 2020 2020 2222 220a 0a20 2020 2069 735f      """..    is_
+0000fbf0: 7061 7261 6d65 7472 6963 203d 2054 7275  parametric = Tru
+0000fc00: 650a 2020 2020 6973 5f63 6f6d 706c 6578  e.    is_complex
+0000fc10: 203d 2054 7275 650a 0a20 2020 2064 6566   = True..    def
+0000fc20: 205f 5f6e 6577 5f5f 2863 6c73 2c20 2a61   __new__(cls, *a
+0000fc30: 7267 732c 202a 2a6b 7761 7267 7329 3a0a  rgs, **kwargs):.
+0000fc40: 2020 2020 2020 2020 7265 7475 726e 206f          return o
+0000fc50: 626a 6563 742e 5f5f 6e65 775f 5f28 636c  bject.__new__(cl
+0000fc60: 7329 0a0a 2020 2020 6465 6620 5f5f 696e  s)..    def __in
+0000fc70: 6974 5f5f 2873 656c 662c 202a 6172 6773  it__(self, *args
+0000fc80: 2c20 2a2a 6b77 6172 6773 293a 0a20 2020  , **kwargs):.   
+0000fc90: 2020 2020 2073 7570 6572 2829 2e5f 5f69       super().__i
+0000fca0: 6e69 745f 5f28 2a61 7267 732c 202a 2a6b  nit__(*args, **k
+0000fcb0: 7761 7267 7329 0a20 2020 2020 2020 2073  wargs).        s
+0000fcc0: 656c 662e 7573 655f 636d 203d 206b 7761  elf.use_cm = kwa
+0000fcd0: 7267 732e 6765 7428 2275 7365 5f63 6d22  rgs.get("use_cm"
+0000fce0: 2c20 5472 7565 290a 0a20 2020 2064 6566  , True)..    def
+0000fcf0: 205f 5f73 7472 5f5f 2873 656c 6629 3a0a   __str__(self):.
+0000fd00: 2020 2020 2020 2020 7265 7475 726e 2073          return s
+0000fd10: 656c 662e 5f73 7472 5f68 656c 7065 7228  elf._str_helper(
+0000fd20: 2263 6172 7465 7369 616e 2061 6273 2d61  "cartesian abs-a
+0000fd30: 7267 206c 696e 653a 2025 7320 666f 7220  rg line: %s for 
+0000fd40: 2573 206f 7665 7220 2573 2220 2520 280a  %s over %s" % (.
+0000fd50: 2020 2020 2020 2020 2020 2020 7374 7228              str(
+0000fd60: 7365 6c66 2e65 7870 7229 2c0a 2020 2020  self.expr),.    
+0000fd70: 2020 2020 2020 2020 7374 7228 7365 6c66          str(self
+0000fd80: 2e76 6172 292c 0a20 2020 2020 2020 2020  .var),.         
+0000fd90: 2020 2073 7472 2828 7365 6c66 2e73 7461     str((self.sta
+0000fda0: 7274 2c20 7365 6c66 2e65 6e64 2929 2929  rt, self.end))))
+0000fdb0: 0a0a 2020 2020 6465 6620 5f67 6574 5f64  ..    def _get_d
+0000fdc0: 6174 615f 6865 6c70 6572 2873 656c 6629  ata_helper(self)
+0000fdd0: 3a0a 2020 2020 2020 2020 2222 2252 6574  :.        """Ret
+0000fde0: 7572 6e73 2063 6f6f 7264 696e 6174 6573  urns coordinates
+0000fdf0: 2074 6861 7420 6e65 6564 7320 746f 2062   that needs to b
+0000fe00: 6520 706f 7374 7072 6f63 6573 7365 642e  e postprocessed.
+0000fe10: 0a20 2020 2020 2020 2044 6570 656e 6469  .        Dependi
+0000fe20: 6e67 206f 6e20 7468 6520 6061 6461 7074  ng on the `adapt
+0000fe30: 6976 6560 206f 7074 696f 6e2c 2074 6869  ive` option, thi
+0000fe40: 7320 6675 6e63 7469 6f6e 2077 696c 6c20  s function will 
+0000fe50: 6569 7468 6572 2075 7365 2061 6e0a 2020  either use an.  
+0000fe60: 2020 2020 2020 6164 6170 7469 7665 2061        adaptive a
+0000fe70: 6c67 6f72 6974 686d 206f 7220 6974 2077  lgorithm or it w
+0000fe80: 696c 6c20 756e 6966 6f72 6d6c 7920 7361  ill uniformly sa
+0000fe90: 6d70 6c65 2074 6865 2065 7870 7265 7373  mple the express
+0000fea0: 696f 6e20 6f76 6572 2074 6865 0a20 2020  ion over the.   
+0000feb0: 2020 2020 2070 726f 7669 6465 6420 7261       provided ra
+0000fec0: 6e67 652e 0a20 2020 2020 2020 2022 2222  nge..        """
+0000fed0: 0a20 2020 2020 2020 206e 7020 3d20 696d  .        np = im
+0000fee0: 706f 7274 5f6d 6f64 756c 6528 276e 756d  port_module('num
+0000fef0: 7079 2729 0a0a 2020 2020 2020 2020 782c  py')..        x,
+0000ff00: 205f 7265 2c20 5f69 6d20 3d20 7365 6c66   _re, _im = self
+0000ff10: 2e5f 6765 745f 7265 616c 5f69 6d61 6728  ._get_real_imag(
+0000ff20: 290a 2020 2020 2020 2020 5f61 6273 203d  ).        _abs =
+0000ff30: 206e 702e 7371 7274 285f 7265 2a2a 3220   np.sqrt(_re**2 
+0000ff40: 2b20 5f69 6d2a 2a32 290a 2020 2020 2020  + _im**2).      
+0000ff50: 2020 5f61 6e67 6c65 203d 206e 702e 6172    _angle = np.ar
+0000ff60: 6374 616e 3228 5f69 6d2c 205f 7265 290a  ctan2(_im, _re).
+0000ff70: 2020 2020 2020 2020 7265 7475 726e 2078          return x
+0000ff80: 2c20 5f61 6273 2c20 5f61 6e67 6c65 0a0a  , _abs, _angle..
+0000ff90: 0a63 6c61 7373 2050 6172 616d 6574 7269  .class Parametri
+0000ffa0: 634c 696e 6542 6173 6553 6572 6965 7328  cLineBaseSeries(
+0000ffb0: 0a20 2020 2043 6f6d 6d6f 6e41 6461 7074  .    CommonAdapt
+0000ffc0: 6976 6545 7661 6c75 6174 696f 6e2c 2043  iveEvaluation, C
+0000ffd0: 6f6d 6d6f 6e55 6e69 666f 726d 4576 616c  ommonUniformEval
+0000ffe0: 7561 7469 6f6e 2c20 4c69 6e65 3244 4261  uation, Line2DBa
+0000fff0: 7365 5365 7269 6573 0a29 3a0a 2020 2020  seSeries.):.    
+00010000: 6973 5f70 6172 616d 6574 7269 6320 3d20  is_parametric = 
+00010010: 5472 7565 0a0a 2020 2020 6465 6620 5f73  True..    def _s
+00010020: 6574 5f70 6172 616d 6574 7269 635f 6c69  et_parametric_li
+00010030: 6e65 5f6c 6162 656c 2873 656c 662c 206c  ne_label(self, l
+00010040: 6162 656c 293a 0a20 2020 2020 2020 2022  abel):.        "
+00010050: 2222 4c6f 6769 6320 746f 2073 6574 2074  ""Logic to set t
+00010060: 6865 2063 6f72 7265 6374 206c 6162 656c  he correct label
+00010070: 2074 6f20 6265 2073 686f 776e 206f 6e20   to be shown on 
+00010080: 7468 6520 706c 6f74 2e0a 2020 2020 2020  the plot..      
+00010090: 2020 4966 2060 7573 655f 636d 3d54 7275    If `use_cm=Tru
+000100a0: 6560 2074 6865 7265 2077 696c 6c20 6265  e` there will be
+000100b0: 2061 2063 6f6c 6f72 6261 722c 2073 6f20   a colorbar, so 
+000100c0: 7765 2073 686f 7720 7468 6520 7061 7261  we show the para
+000100d0: 6d65 7465 722e 0a20 2020 2020 2020 2049  meter..        I
+000100e0: 6620 6075 7365 5f63 6d3d 4661 6c73 6560  f `use_cm=False`
+000100f0: 2c20 7468 6572 6520 6d69 6768 7420 6265  , there might be
+00010100: 2061 206c 6567 656e 642c 2073 6f20 7765   a legend, so we
+00010110: 2073 686f 7720 7468 6520 6578 7072 6573   show the expres
+00010120: 7369 6f6e 732e 0a0a 2020 2020 2020 2020  sions...        
+00010130: 5061 7261 6d65 7465 7273 0a20 2020 2020  Parameters.     
+00010140: 2020 203d 3d3d 3d3d 3d3d 3d3d 3d0a 2020     ==========.  
+00010150: 2020 2020 2020 6c61 6265 6c20 3a20 7374        label : st
+00010160: 720a 2020 2020 2020 2020 2020 2020 6c61  r.            la
+00010170: 6265 6c20 7061 7373 6564 2069 6e20 6279  bel passed in by
+00010180: 2074 6865 2070 7265 2d70 726f 6365 7373   the pre-process
+00010190: 6f72 206f 7220 7468 6520 7573 6572 0a20  or or the user. 
+000101a0: 2020 2020 2020 2022 2222 0a20 2020 2020         """.     
+000101b0: 2020 2073 656c 662e 5f6c 6162 656c 203d     self._label =
+000101c0: 2073 7472 2873 656c 662e 7661 7229 2069   str(self.var) i
+000101d0: 6620 6c61 6265 6c20 6973 204e 6f6e 6520  f label is None 
+000101e0: 656c 7365 206c 6162 656c 0a20 2020 2020  else label.     
+000101f0: 2020 2073 656c 662e 5f6c 6174 6578 5f6c     self._latex_l
+00010200: 6162 656c 203d 206c 6174 6578 2873 656c  abel = latex(sel
+00010210: 662e 7661 7229 2069 6620 6c61 6265 6c20  f.var) if label 
+00010220: 6973 204e 6f6e 6520 656c 7365 206c 6162  is None else lab
+00010230: 656c 0a20 2020 2020 2020 2069 6620 2873  el.        if (s
+00010240: 656c 662e 7573 655f 636d 2069 7320 4661  elf.use_cm is Fa
+00010250: 6c73 6529 2061 6e64 2028 7365 6c66 2e5f  lse) and (self._
+00010260: 6c61 6265 6c20 3d3d 2073 7472 2873 656c  label == str(sel
+00010270: 662e 7661 7229 293a 0a20 2020 2020 2020  f.var)):.       
+00010280: 2020 2020 2073 656c 662e 5f6c 6162 656c       self._label
+00010290: 203d 2073 7472 2873 656c 662e 6578 7072   = str(self.expr
+000102a0: 290a 2020 2020 2020 2020 2020 2020 7365  ).            se
+000102b0: 6c66 2e5f 6c61 7465 785f 6c61 6265 6c20  lf._latex_label 
+000102c0: 3d20 6c61 7465 7828 7365 6c66 2e65 7870  = latex(self.exp
+000102d0: 7229 0a20 2020 2020 2020 2023 2069 6620  r).        # if 
+000102e0: 7468 6520 6578 7072 6573 7369 6f6e 7320  the expressions 
+000102f0: 6973 2061 206c 616d 6264 6120 6675 6e63  is a lambda func
+00010300: 7469 6f6e 2061 6e64 2075 7365 5f63 6d3d  tion and use_cm=
+00010310: 4661 6c73 6520 616e 6420 6e6f 206c 6162  False and no lab
+00010320: 656c 0a20 2020 2020 2020 2023 2068 6173  el.        # has
+00010330: 2062 6565 6e20 7072 6f76 6964 6564 2c20   been provided, 
+00010340: 7468 656e 2069 7473 2062 6574 7465 7220  then its better 
+00010350: 746f 2064 6f20 7468 6520 666f 6c6c 6f77  to do the follow
+00010360: 696e 6720 696e 206f 7264 6572 2074 6f0a  ing in order to.
+00010370: 2020 2020 2020 2020 2320 6176 6f69 6420          # avoid 
+00010380: 7375 7072 6973 6573 206f 6e20 7468 6520  suprises on the 
+00010390: 6261 636b 656e 640a 2020 2020 2020 2020  backend.        
+000103a0: 6966 2061 6e79 2863 616c 6c61 626c 6528  if any(callable(
+000103b0: 6529 2066 6f72 2065 2069 6e20 7365 6c66  e) for e in self
+000103c0: 2e65 7870 7229 2061 6e64 2028 6e6f 7420  .expr) and (not 
+000103d0: 7365 6c66 2e75 7365 5f63 6d29 3a0a 2020  self.use_cm):.  
+000103e0: 2020 2020 2020 2020 2020 6966 2073 656c            if sel
+000103f0: 662e 5f6c 6162 656c 203d 3d20 7374 7228  f._label == str(
+00010400: 7365 6c66 2e65 7870 7229 3a0a 2020 2020  self.expr):.    
+00010410: 2020 2020 2020 2020 2020 2020 7365 6c66              self
+00010420: 2e5f 6c61 6265 6c20 3d20 2222 0a0a 2020  ._label = ""..  
+00010430: 2020 6465 6620 5f61 6461 7074 6976 655f    def _adaptive_
+00010440: 7361 6d70 6c69 6e67 2873 656c 6629 3a0a  sampling(self):.
+00010450: 2020 2020 2020 2020 6e70 203d 2069 6d70          np = imp
+00010460: 6f72 745f 6d6f 6475 6c65 2827 6e75 6d70  ort_module('nump
+00010470: 7927 290a 0a20 2020 2020 2020 2064 6566  y')..        def
+00010480: 2066 756e 6328 662c 2069 735f 3244 6c69   func(f, is_2Dli
+00010490: 6e65 2c20 7829 3a0a 2020 2020 2020 2020  ne, x):.        
+000104a0: 2020 2020 7472 793a 0a20 2020 2020 2020      try:.       
+000104b0: 2020 2020 2020 2020 2077 203d 205b 636f           w = [co
+000104c0: 6d70 6c65 7828 7429 2066 6f72 2074 2069  mplex(t) for t i
+000104d0: 6e20 6628 636f 6d70 6c65 7828 7829 295d  n f(complex(x))]
+000104e0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+000104f0: 2072 6574 7572 6e20 5b74 2e72 6561 6c20   return [t.real 
+00010500: 6966 206e 702e 6973 636c 6f73 6528 742e  if np.isclose(t.
+00010510: 696d 6167 2c20 3029 2065 6c73 6520 6e70  imag, 0) else np
+00010520: 2e6e 616e 2066 6f72 2074 2069 6e20 775d  .nan for t in w]
+00010530: 0a20 2020 2020 2020 2020 2020 2065 7863  .            exc
+00010540: 6570 7420 285a 6572 6f44 6976 6973 696f  ept (ZeroDivisio
+00010550: 6e45 7272 6f72 2c20 4f76 6572 666c 6f77  nError, Overflow
+00010560: 4572 726f 7229 3a0a 2020 2020 2020 2020  Error):.        
+00010570: 2020 2020 2020 2020 7265 7475 726e 205b          return [
+00010580: 6e70 2e6e 616e 2066 6f72 2074 2069 6e20  np.nan for t in 
+00010590: 7261 6e67 6528 3220 6966 2069 735f 3244  range(2 if is_2D
+000105a0: 6c69 6e65 2065 6c73 6520 3329 5d0a 0a20  line else 3)].. 
+000105b0: 2020 2020 2020 2069 6620 616c 6c28 6e6f         if all(no
+000105c0: 7420 6361 6c6c 6162 6c65 2865 2920 666f  t callable(e) fo
+000105d0: 7220 6520 696e 2073 656c 662e 6578 7072  r e in self.expr
+000105e0: 293a 0a20 2020 2020 2020 2020 2020 2065  ):.            e
+000105f0: 7870 7220 3d20 5475 706c 6528 7365 6c66  xpr = Tuple(self
+00010600: 2e65 7870 725f 782c 2073 656c 662e 6578  .expr_x, self.ex
+00010610: 7072 5f79 290a 2020 2020 2020 2020 2020  pr_y).          
+00010620: 2020 6966 206e 6f74 2073 656c 662e 6973    if not self.is
+00010630: 5f32 446c 696e 653a 0a20 2020 2020 2020  _2Dline:.       
+00010640: 2020 2020 2020 2020 2065 7870 7220 3d20           expr = 
+00010650: 5475 706c 6528 7365 6c66 2e65 7870 725f  Tuple(self.expr_
+00010660: 782c 2073 656c 662e 6578 7072 5f79 2c20  x, self.expr_y, 
+00010670: 7365 6c66 2e65 7870 725f 7a29 0a20 2020  self.expr_z).   
+00010680: 2020 2020 2065 6c73 653a 0a20 2020 2020       else:.     
+00010690: 2020 2020 2020 2023 2065 7870 7220 6973         # expr is
+000106a0: 2075 7365 722d 7072 6f76 6964 6564 206c   user-provided l
+000106b0: 616d 6264 6120 6675 6e63 7469 6f6e 730a  ambda functions.
+000106c0: 2020 2020 2020 2020 2020 2020 6578 7072              expr
+000106d0: 203d 206c 616d 6264 6120 783a 2028 7365   = lambda x: (se
+000106e0: 6c66 2e65 7870 725f 7828 7829 2c20 7365  lf.expr_x(x), se
+000106f0: 6c66 2e65 7870 725f 7928 7829 290a 2020  lf.expr_y(x)).  
+00010700: 2020 2020 2020 2020 2020 6966 206e 6f74            if not
+00010710: 2073 656c 662e 6973 5f32 446c 696e 653a   self.is_2Dline:
+00010720: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00010730: 2065 7870 7220 3d20 6c61 6d62 6461 2078   expr = lambda x
+00010740: 3a20 280a 2020 2020 2020 2020 2020 2020  : (.            
+00010750: 2020 2020 2020 2020 7365 6c66 2e65 7870          self.exp
+00010760: 725f 7828 7829 2c20 7365 6c66 2e65 7870  r_x(x), self.exp
+00010770: 725f 7928 7829 2c20 7365 6c66 2e65 7870  r_y(x), self.exp
+00010780: 725f 7a28 7829 290a 0a20 2020 2020 2020  r_z(x))..       
+00010790: 2064 6174 6120 3d20 5f61 6461 7074 6976   data = _adaptiv
+000107a0: 655f 6576 616c 280a 2020 2020 2020 2020  e_eval(.        
+000107b0: 2020 2020 6675 6e63 2c20 5b73 656c 662e      func, [self.
+000107c0: 7661 725d 2c20 6578 7072 2c0a 2020 2020  var], expr,.    
+000107d0: 2020 2020 2020 2020 5b66 6c6f 6174 2873          [float(s
+000107e0: 656c 662e 7374 6172 7429 2c20 666c 6f61  elf.start), floa
+000107f0: 7428 7365 6c66 2e65 6e64 295d 2c0a 2020  t(self.end)],.  
+00010800: 2020 2020 2020 2020 2020 7365 6c66 2e69            self.i
+00010810: 735f 3244 6c69 6e65 2c0a 2020 2020 2020  s_2Dline,.      
+00010820: 2020 2020 2020 6d6f 6475 6c65 733d 7365        modules=se
+00010830: 6c66 2e6d 6f64 756c 6573 2c0a 2020 2020  lf.modules,.    
+00010840: 2020 2020 2020 2020 6164 6170 7469 7665          adaptive
+00010850: 5f67 6f61 6c3d 7365 6c66 2e61 6461 7074  _goal=self.adapt
+00010860: 6976 655f 676f 616c 2c0a 2020 2020 2020  ive_goal,.      
+00010870: 2020 2020 2020 6c6f 7373 5f66 6e3d 7365        loss_fn=se
+00010880: 6c66 2e6c 6f73 735f 666e 290a 0a20 2020  lf.loss_fn)..   
+00010890: 2020 2020 2069 6620 7365 6c66 2e69 735f       if self.is_
+000108a0: 3244 6c69 6e65 3a0a 2020 2020 2020 2020  2Dline:.        
+000108b0: 2020 2020 7265 7475 726e 2064 6174 615b      return data[
+000108c0: 3a2c 2031 5d2c 2064 6174 615b 3a2c 2032  :, 1], data[:, 2
+000108d0: 5d2c 2064 6174 615b 3a2c 2030 5d0a 2020  ], data[:, 0].  
+000108e0: 2020 2020 2020 7265 7475 726e 2064 6174        return dat
+000108f0: 615b 3a2c 2031 5d2c 2064 6174 615b 3a2c  a[:, 1], data[:,
+00010900: 2032 5d2c 2064 6174 615b 3a2c 2033 5d2c   2], data[:, 3],
+00010910: 2064 6174 615b 3a2c 2030 5d0a 0a20 2020   data[:, 0]..   
+00010920: 2064 6566 2067 6574 5f6c 6162 656c 2873   def get_label(s
+00010930: 656c 662c 2075 7365 5f6c 6174 6578 3d46  elf, use_latex=F
+00010940: 616c 7365 2c20 7772 6170 7065 723d 2224  alse, wrapper="$
+00010950: 2573 2422 293a 0a20 2020 2020 2020 2023  %s$"):.        #
+00010960: 2070 6172 616d 6574 7269 6320 6c69 6e65   parametric line
+00010970: 7320 7265 7475 726e 7320 7468 6520 7265  s returns the re
+00010980: 7072 6573 656e 7461 7469 6f6e 206f 6620  presentation of 
+00010990: 7468 6520 7061 7261 6d65 7465 7220 746f  the parameter to
+000109a0: 2062 650a 2020 2020 2020 2020 2320 7368   be.        # sh
+000109b0: 6f77 6e20 6f6e 2074 6865 2063 6f6c 6f72  own on the color
+000109c0: 6261 7220 6966 2060 7573 655f 636d 3d54  bar if `use_cm=T
+000109d0: 7275 6560 2c20 6f74 6865 7277 6973 6520  rue`, otherwise 
+000109e0: 6974 2072 6574 7572 6e73 2074 6865 0a20  it returns the. 
+000109f0: 2020 2020 2020 2023 2072 6570 7265 7365         # represe
+00010a00: 6e74 6174 696f 6e20 6f66 2074 6865 2065  ntation of the e
+00010a10: 7870 7265 7373 696f 6e20 746f 2062 6520  xpression to be 
+00010a20: 706c 6163 6564 206f 6e20 7468 6520 6c65  placed on the le
+00010a30: 6765 6e64 2e0a 2020 2020 2020 2020 6966  gend..        if
+00010a40: 2073 656c 662e 7573 655f 636d 3a0a 2020   self.use_cm:.  
+00010a50: 2020 2020 2020 2020 2020 6966 2073 7472            if str
+00010a60: 2873 656c 662e 7661 7229 203d 3d20 7365  (self.var) == se
+00010a70: 6c66 2e5f 6c61 6265 6c3a 0a20 2020 2020  lf._label:.     
+00010a80: 2020 2020 2020 2020 2020 2069 6620 7573             if us
+00010a90: 655f 6c61 7465 783a 0a20 2020 2020 2020  e_latex:.       
+00010aa0: 2020 2020 2020 2020 2020 2020 2072 6574               ret
+00010ab0: 7572 6e20 7365 6c66 2e5f 6765 745f 7772  urn self._get_wr
+00010ac0: 6170 7065 645f 6c61 6265 6c28 6c61 7465  apped_label(late
+00010ad0: 7828 7365 6c66 2e76 6172 292c 2077 7261  x(self.var), wra
+00010ae0: 7070 6572 290a 2020 2020 2020 2020 2020  pper).          
+00010af0: 2020 2020 2020 7265 7475 726e 2073 7472        return str
+00010b00: 2873 656c 662e 7661 7229 0a20 2020 2020  (self.var).     
+00010b10: 2020 2020 2020 2023 2068 6572 6520 7468         # here th
+00010b20: 6520 7573 6572 2068 6173 2070 726f 7669  e user has provi
+00010b30: 6465 6420 6120 6375 7374 6f6d 206c 6162  ded a custom lab
+00010b40: 656c 0a20 2020 2020 2020 2020 2020 2072  el.            r
+00010b50: 6574 7572 6e20 7365 6c66 2e5f 6c61 6265  eturn self._labe
+00010b60: 6c0a 2020 2020 2020 2020 6966 2075 7365  l.        if use
+00010b70: 5f6c 6174 6578 3a0a 2020 2020 2020 2020  _latex:.        
+00010b80: 2020 2020 6966 2073 656c 662e 5f6c 6162      if self._lab
+00010b90: 656c 2021 3d20 7374 7228 7365 6c66 2e65  el != str(self.e
+00010ba0: 7870 7229 3a0a 2020 2020 2020 2020 2020  xpr):.          
+00010bb0: 2020 2020 2020 7265 7475 726e 2073 656c        return sel
+00010bc0: 662e 5f6c 6174 6578 5f6c 6162 656c 0a20  f._latex_label. 
+00010bd0: 2020 2020 2020 2020 2020 2072 6574 7572             retur
+00010be0: 6e20 7365 6c66 2e5f 6765 745f 7772 6170  n self._get_wrap
+00010bf0: 7065 645f 6c61 6265 6c28 7365 6c66 2e5f  ped_label(self._
+00010c00: 6c61 7465 785f 6c61 6265 6c2c 2077 7261  latex_label, wra
+00010c10: 7070 6572 290a 2020 2020 2020 2020 7265  pper).        re
+00010c20: 7475 726e 2073 656c 662e 5f6c 6162 656c  turn self._label
+00010c30: 0a0a 2020 2020 6465 6620 5f67 6574 5f64  ..    def _get_d
+00010c40: 6174 615f 6865 6c70 6572 2873 656c 6629  ata_helper(self)
+00010c50: 3a0a 2020 2020 2020 2020 2222 2252 6574  :.        """Ret
+00010c60: 7572 6e73 2063 6f6f 7264 696e 6174 6573  urns coordinates
+00010c70: 2074 6861 7420 6e65 6564 7320 746f 2062   that needs to b
+00010c80: 6520 706f 7374 7072 6f63 6573 7365 642e  e postprocessed.
+00010c90: 0a20 2020 2020 2020 2044 6570 656e 6469  .        Dependi
+00010ca0: 6e67 206f 6e20 7468 6520 6061 6461 7074  ng on the `adapt
+00010cb0: 6976 6560 206f 7074 696f 6e2c 2074 6869  ive` option, thi
+00010cc0: 7320 6675 6e63 7469 6f6e 2077 696c 6c20  s function will 
+00010cd0: 6569 7468 6572 2075 7365 2061 6e0a 2020  either use an.  
+00010ce0: 2020 2020 2020 6164 6170 7469 7665 2061        adaptive a
+00010cf0: 6c67 6f72 6974 686d 206f 7220 6974 2077  lgorithm or it w
+00010d00: 696c 6c20 756e 6966 6f72 6d6c 7920 7361  ill uniformly sa
+00010d10: 6d70 6c65 2074 6865 2065 7870 7265 7373  mple the express
+00010d20: 696f 6e20 6f76 6572 2074 6865 0a20 2020  ion over the.   
+00010d30: 2020 2020 2070 726f 7669 6465 6420 7261       provided ra
+00010d40: 6e67 652e 0a20 2020 2020 2020 2022 2222  nge..        """
+00010d50: 0a20 2020 2020 2020 2069 6620 7365 6c66  .        if self
+00010d60: 2e61 6461 7074 6976 653a 0a20 2020 2020  .adaptive:.     
+00010d70: 2020 2020 2020 2063 6f6f 7264 7320 3d20         coords = 
+00010d80: 7365 6c66 2e5f 6164 6170 7469 7665 5f73  self._adaptive_s
+00010d90: 616d 706c 696e 6728 290a 2020 2020 2020  ampling().      
+00010da0: 2020 656c 7365 3a0a 2020 2020 2020 2020    else:.        
+00010db0: 2020 2020 636f 6f72 6473 203d 2073 656c      coords = sel
+00010dc0: 662e 5f75 6e69 666f 726d 5f73 616d 706c  f._uniform_sampl
+00010dd0: 696e 6728 290a 0a20 2020 2020 2020 2069  ing()..        i
+00010de0: 6620 7365 6c66 2e69 735f 3244 6c69 6e65  f self.is_2Dline
+00010df0: 2061 6e64 2073 656c 662e 6973 5f70 6f6c   and self.is_pol
+00010e00: 6172 3a0a 2020 2020 2020 2020 2020 2020  ar:.            
+00010e10: 2320 7768 656e 2070 6c6f 745f 706f 6c61  # when plot_pola
+00010e20: 7220 6973 2065 7865 6375 7465 6420 7769  r is executed wi
+00010e30: 7468 2070 6f6c 6172 5f61 7869 733d 5472  th polar_axis=Tr
+00010e40: 7565 0a20 2020 2020 2020 2020 2020 206e  ue.            n
+00010e50: 7020 3d20 696d 706f 7274 5f6d 6f64 756c  p = import_modul
+00010e60: 6528 276e 756d 7079 2729 0a20 2020 2020  e('numpy').     
+00010e70: 2020 2020 2020 2078 2c20 792c 205f 203d         x, y, _ =
+00010e80: 2063 6f6f 7264 730a 2020 2020 2020 2020   coords.        
+00010e90: 2020 2020 7220 3d20 6e70 2e73 7172 7428      r = np.sqrt(
+00010ea0: 782a 2a32 202b 2079 2a2a 3229 0a20 2020  x**2 + y**2).   
+00010eb0: 2020 2020 2020 2020 2074 203d 206e 702e           t = np.
+00010ec0: 6172 6374 616e 3228 792c 2078 290a 2020  arctan2(y, x).  
+00010ed0: 2020 2020 2020 2020 2020 636f 6f72 6473            coords
+00010ee0: 203d 205b 742c 2072 2c20 636f 6f72 6473   = [t, r, coords
+00010ef0: 5b2d 315d 5d0a 0a20 2020 2020 2020 2069  [-1]]..        i
+00010f00: 6620 6361 6c6c 6162 6c65 2873 656c 662e  f callable(self.
+00010f10: 636f 6c6f 725f 6675 6e63 293a 0a20 2020  color_func):.   
+00010f20: 2020 2020 2020 2020 2063 6f6f 7264 7320           coords 
+00010f30: 3d20 6c69 7374 2863 6f6f 7264 7329 0a20  = list(coords). 
+00010f40: 2020 2020 2020 2020 2020 2063 6f6f 7264             coord
+00010f50: 735b 2d31 5d20 3d20 7365 6c66 2e65 7661  s[-1] = self.eva
+00010f60: 6c5f 636f 6c6f 725f 6675 6e63 282a 636f  l_color_func(*co
+00010f70: 6f72 6473 290a 0a20 2020 2020 2020 2072  ords)..        r
+00010f80: 6574 7572 6e20 636f 6f72 6473 0a0a 2020  eturn coords..  
+00010f90: 2020 6465 6620 5f75 6e69 666f 726d 5f73    def _uniform_s
+00010fa0: 616d 706c 696e 6728 7365 6c66 293a 0a20  ampling(self):. 
+00010fb0: 2020 2020 2020 2022 2222 5265 7475 726e         """Return
+00010fc0: 7320 636f 6f72 6469 6e61 7465 7320 7468  s coordinates th
+00010fd0: 6174 206e 6565 6473 2074 6f20 6265 2070  at needs to be p
+00010fe0: 6f73 7470 726f 6365 7373 6564 2e22 2222  ostprocessed."""
+00010ff0: 0a20 2020 2020 2020 206e 7020 3d20 696d  .        np = im
+00011000: 706f 7274 5f6d 6f64 756c 6528 276e 756d  port_module('num
+00011010: 7079 2729 0a0a 2020 2020 2020 2020 7265  py')..        re
+00011020: 7375 6c74 7320 3d20 7365 6c66 2e5f 6576  sults = self._ev
+00011030: 616c 7561 7465 2829 0a20 2020 2020 2020  aluate().       
+00011040: 2066 6f72 2069 2c20 7220 696e 2065 6e75   for i, r in enu
+00011050: 6d65 7261 7465 2872 6573 756c 7473 293a  merate(results):
+00011060: 0a20 2020 2020 2020 2020 2020 205f 7265  .            _re
+00011070: 2c20 5f69 6d20 3d20 6e70 2e72 6561 6c28  , _im = np.real(
+00011080: 7229 2c20 6e70 2e69 6d61 6728 7229 0a20  r), np.imag(r). 
+00011090: 2020 2020 2020 2020 2020 205f 7265 5b6e             _re[n
+000110a0: 702e 696e 7665 7274 286e 702e 6973 636c  p.invert(np.iscl
+000110b0: 6f73 6528 5f69 6d2c 206e 702e 7a65 726f  ose(_im, np.zero
+000110c0: 735f 6c69 6b65 285f 696d 2929 295d 203d  s_like(_im)))] =
+000110d0: 206e 702e 6e61 6e0a 2020 2020 2020 2020   np.nan.        
+000110e0: 2020 2020 7265 7375 6c74 735b 695d 203d      results[i] =
+000110f0: 205f 7265 0a0a 2020 2020 2020 2020 7265   _re..        re
+00011100: 7475 726e 205b 2a72 6573 756c 7473 5b31  turn [*results[1
+00011110: 3a5d 2c20 7265 7375 6c74 735b 305d 5d0a  :], results[0]].
+00011120: 0a0a 636c 6173 7320 5061 7261 6d65 7472  ..class Parametr
+00011130: 6963 3244 4c69 6e65 5365 7269 6573 2850  ic2DLineSeries(P
+00011140: 6172 616d 6574 7269 634c 696e 6542 6173  arametricLineBas
+00011150: 6553 6572 6965 7329 3a0a 2020 2020 2222  eSeries):.    ""
+00011160: 2252 6570 7265 7365 6e74 6174 696f 6e20  "Representation 
+00011170: 666f 7220 6120 6c69 6e65 2063 6f6e 7369  for a line consi
+00011180: 7374 696e 6720 6f66 2074 776f 2070 6172  sting of two par
+00011190: 616d 6574 7269 6320 7379 6d70 7920 6578  ametric sympy ex
+000111a0: 7072 6573 7369 6f6e 730a 2020 2020 6f76  pressions.    ov
+000111b0: 6572 2061 2072 616e 6765 2e22 2222 0a0a  er a range."""..
+000111c0: 2020 2020 6973 5f70 6172 616d 6574 7269      is_parametri
+000111d0: 6320 3d20 5472 7565 0a0a 2020 2020 6465  c = True..    de
+000111e0: 6620 5f5f 696e 6974 5f5f 2873 656c 662c  f __init__(self,
+000111f0: 2065 7870 725f 782c 2065 7870 725f 792c   expr_x, expr_y,
+00011200: 2076 6172 5f73 7461 7274 5f65 6e64 2c20   var_start_end, 
+00011210: 6c61 6265 6c3d 2222 2c20 2a2a 6b77 6172  label="", **kwar
+00011220: 6773 293a 0a20 2020 2020 2020 2073 7570  gs):.        sup
+00011230: 6572 2829 2e5f 5f69 6e69 745f 5f28 2a2a  er().__init__(**
+00011240: 6b77 6172 6773 290a 2020 2020 2020 2020  kwargs).        
+00011250: 7365 6c66 2e65 7870 725f 7820 3d20 6578  self.expr_x = ex
+00011260: 7072 5f78 2069 6620 6361 6c6c 6162 6c65  pr_x if callable
+00011270: 2865 7870 725f 7829 2065 6c73 6520 7379  (expr_x) else sy
+00011280: 6d70 6966 7928 6578 7072 5f78 290a 2020  mpify(expr_x).  
+00011290: 2020 2020 2020 7365 6c66 2e65 7870 725f        self.expr_
+000112a0: 7920 3d20 6578 7072 5f79 2069 6620 6361  y = expr_y if ca
+000112b0: 6c6c 6162 6c65 2865 7870 725f 7929 2065  llable(expr_y) e
+000112c0: 6c73 6520 7379 6d70 6966 7928 6578 7072  lse sympify(expr
+000112d0: 5f79 290a 2020 2020 2020 2020 7365 6c66  _y).        self
+000112e0: 2e65 7870 7220 3d20 2873 656c 662e 6578  .expr = (self.ex
+000112f0: 7072 5f78 2c20 7365 6c66 2e65 7870 725f  pr_x, self.expr_
+00011300: 7929 0a20 2020 2020 2020 2073 656c 662e  y).        self.
+00011310: 7261 6e67 6573 203d 205b 7661 725f 7374  ranges = [var_st
+00011320: 6172 745f 656e 645d 0a20 2020 2020 2020  art_end].       
+00011330: 2073 656c 662e 5f63 6173 7420 3d20 666c   self._cast = fl
+00011340: 6f61 740a 2020 2020 2020 2020 7365 6c66  oat.        self
+00011350: 2e75 7365 5f63 6d20 3d20 6b77 6172 6773  .use_cm = kwargs
+00011360: 2e67 6574 2822 7573 655f 636d 222c 2054  .get("use_cm", T
+00011370: 7275 6529 0a20 2020 2020 2020 2073 656c  rue).        sel
+00011380: 662e 5f73 6574 5f70 6172 616d 6574 7269  f._set_parametri
+00011390: 635f 6c69 6e65 5f6c 6162 656c 286c 6162  c_line_label(lab
+000113a0: 656c 290a 2020 2020 2020 2020 7365 6c66  el).        self
+000113b0: 2e5f 706f 7374 5f69 6e69 7428 290a 0a20  ._post_init().. 
+000113c0: 2020 2064 6566 205f 5f73 7472 5f5f 2873     def __str__(s
+000113d0: 656c 6629 3a0a 2020 2020 2020 2020 7265  elf):.        re
+000113e0: 7475 726e 2073 656c 662e 5f73 7472 5f68  turn self._str_h
+000113f0: 656c 7065 7228 0a20 2020 2020 2020 2020  elper(.         
+00011400: 2020 2022 7061 7261 6d65 7472 6963 2063     "parametric c
+00011410: 6172 7465 7369 616e 206c 696e 653a 2028  artesian line: (
+00011420: 2573 2c20 2573 2920 666f 7220 2573 206f  %s, %s) for %s o
+00011430: 7665 7220 2573 2220 2520 280a 2020 2020  ver %s" % (.    
+00011440: 2020 2020 2020 2020 2020 2020 7374 7228              str(
+00011450: 7365 6c66 2e65 7870 725f 7829 2c0a 2020  self.expr_x),.  
+00011460: 2020 2020 2020 2020 2020 2020 2020 7374                st
+00011470: 7228 7365 6c66 2e65 7870 725f 7929 2c0a  r(self.expr_y),.
+00011480: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00011490: 7374 7228 7365 6c66 2e76 6172 292c 0a20  str(self.var),. 
+000114a0: 2020 2020 2020 2020 2020 2020 2020 2073                 s
+000114b0: 7472 2828 7365 6c66 2e73 7461 7274 2c20  tr((self.start, 
+000114c0: 7365 6c66 2e65 6e64 2929 0a20 2020 2020  self.end)).     
+000114d0: 2020 2020 2020 2029 0a20 2020 2020 2020         ).       
+000114e0: 2029 0a0a 0a63 6c61 7373 2050 6172 616d   )...class Param
+000114f0: 6574 7269 6333 444c 696e 6553 6572 6965  etric3DLineSerie
+00011500: 7328 5061 7261 6d65 7472 6963 4c69 6e65  s(ParametricLine
+00011510: 4261 7365 5365 7269 6573 293a 0a20 2020  BaseSeries):.   
+00011520: 2022 2222 5265 7072 6573 656e 7461 7469   """Representati
+00011530: 6f6e 2066 6f72 2061 2033 4420 6c69 6e65  on for a 3D line
+00011540: 2063 6f6e 7369 7374 696e 6720 6f66 2074   consisting of t
+00011550: 6872 6565 2070 6172 616d 6574 7269 6320  hree parametric 
+00011560: 7379 6d70 790a 2020 2020 6578 7072 6573  sympy.    expres
+00011570: 7369 6f6e 7320 616e 6420 6120 7261 6e67  sions and a rang
+00011580: 652e 2222 220a 0a20 2020 2069 735f 3244  e."""..    is_2D
+00011590: 6c69 6e65 203d 2046 616c 7365 0a20 2020  line = False.   
+000115a0: 2069 735f 3344 6c69 6e65 203d 2054 7275   is_3Dline = Tru
+000115b0: 650a 0a20 2020 2064 6566 205f 5f69 6e69  e..    def __ini
+000115c0: 745f 5f28 0a20 2020 2020 2020 2073 656c  t__(.        sel
+000115d0: 662c 2065 7870 725f 782c 2065 7870 725f  f, expr_x, expr_
+000115e0: 792c 2065 7870 725f 7a2c 2076 6172 5f73  y, expr_z, var_s
+000115f0: 7461 7274 5f65 6e64 2c20 6c61 6265 6c3d  tart_end, label=
+00011600: 2222 2c20 2a2a 6b77 6172 6773 0a20 2020  "", **kwargs.   
+00011610: 2029 3a0a 2020 2020 2020 2020 7375 7065   ):.        supe
+00011620: 7228 292e 5f5f 696e 6974 5f5f 282a 2a6b  r().__init__(**k
+00011630: 7761 7267 7329 0a20 2020 2020 2020 2073  wargs).        s
+00011640: 656c 662e 6578 7072 5f78 203d 2065 7870  elf.expr_x = exp
+00011650: 725f 7820 6966 2063 616c 6c61 626c 6528  r_x if callable(
+00011660: 6578 7072 5f78 2920 656c 7365 2073 796d  expr_x) else sym
+00011670: 7069 6679 2865 7870 725f 7829 0a20 2020  pify(expr_x).   
+00011680: 2020 2020 2073 656c 662e 6578 7072 5f79       self.expr_y
+00011690: 203d 2065 7870 725f 7920 6966 2063 616c   = expr_y if cal
+000116a0: 6c61 626c 6528 6578 7072 5f79 2920 656c  lable(expr_y) el
+000116b0: 7365 2073 796d 7069 6679 2865 7870 725f  se sympify(expr_
+000116c0: 7929 0a20 2020 2020 2020 2073 656c 662e  y).        self.
+000116d0: 6578 7072 5f7a 203d 2065 7870 725f 7a20  expr_z = expr_z 
+000116e0: 6966 2063 616c 6c61 626c 6528 6578 7072  if callable(expr
+000116f0: 5f7a 2920 656c 7365 2073 796d 7069 6679  _z) else sympify
+00011700: 2865 7870 725f 7a29 0a20 2020 2020 2020  (expr_z).       
+00011710: 2073 656c 662e 6578 7072 203d 2028 7365   self.expr = (se
+00011720: 6c66 2e65 7870 725f 782c 2073 656c 662e  lf.expr_x, self.
+00011730: 6578 7072 5f79 2c20 7365 6c66 2e65 7870  expr_y, self.exp
+00011740: 725f 7a29 0a20 2020 2020 2020 2073 656c  r_z).        sel
+00011750: 662e 7261 6e67 6573 203d 205b 7661 725f  f.ranges = [var_
+00011760: 7374 6172 745f 656e 645d 0a20 2020 2020  start_end].     
+00011770: 2020 2073 656c 662e 5f63 6173 7420 3d20     self._cast = 
+00011780: 666c 6f61 740a 2020 2020 2020 2020 7365  float.        se
+00011790: 6c66 2e75 7365 5f63 6d20 3d20 6b77 6172  lf.use_cm = kwar
+000117a0: 6773 2e67 6574 2822 7573 655f 636d 222c  gs.get("use_cm",
+000117b0: 2054 7275 6529 0a20 2020 2020 2020 2073   True).        s
+000117c0: 656c 662e 5f73 6574 5f70 6172 616d 6574  elf._set_paramet
+000117d0: 7269 635f 6c69 6e65 5f6c 6162 656c 286c  ric_line_label(l
+000117e0: 6162 656c 290a 2020 2020 2020 2020 7365  abel).        se
+000117f0: 6c66 2e5f 706f 7374 5f69 6e69 7428 290a  lf._post_init().
+00011800: 0a20 2020 2064 6566 205f 5f73 7472 5f5f  .    def __str__
+00011810: 2873 656c 6629 3a0a 2020 2020 2020 2020  (self):.        
+00011820: 7265 7475 726e 2073 656c 662e 5f73 7472  return self._str
+00011830: 5f68 656c 7065 7228 0a20 2020 2020 2020  _helper(.       
+00011840: 2020 2020 2022 3344 2070 6172 616d 6574       "3D paramet
+00011850: 7269 6320 6361 7274 6573 6961 6e20 6c69  ric cartesian li
+00011860: 6e65 3a20 2825 732c 2025 732c 2025 7329  ne: (%s, %s, %s)
+00011870: 2066 6f72 2025 7320 6f76 6572 2025 7322   for %s over %s"
+00011880: 2025 2028 0a20 2020 2020 2020 2020 2020   % (.           
+00011890: 2073 7472 2873 656c 662e 6578 7072 5f78   str(self.expr_x
+000118a0: 292c 0a20 2020 2020 2020 2020 2020 2073  ),.            s
+000118b0: 7472 2873 656c 662e 6578 7072 5f79 292c  tr(self.expr_y),
+000118c0: 0a20 2020 2020 2020 2020 2020 2073 7472  .            str
+000118d0: 2873 656c 662e 6578 7072 5f7a 292c 0a20  (self.expr_z),. 
+000118e0: 2020 2020 2020 2020 2020 2073 7472 2873             str(s
+000118f0: 656c 662e 7661 7229 2c0a 2020 2020 2020  elf.var),.      
+00011900: 2020 2020 2020 7374 7228 2873 656c 662e        str((self.
+00011910: 7374 6172 742c 2073 656c 662e 656e 6429  start, self.end)
+00011920: 290a 2020 2020 2020 2020 2929 0a0a 0a63  ).        ))...c
+00011930: 6c61 7373 2053 7572 6661 6365 4261 7365  lass SurfaceBase
+00011940: 5365 7269 6573 2842 6173 6553 6572 6965  Series(BaseSerie
+00011950: 7329 3a0a 2020 2020 2222 2241 2062 6173  s):.    """A bas
+00011960: 6520 636c 6173 7320 666f 7220 3344 2073  e class for 3D s
+00011970: 7572 6661 6365 732e 2222 220a 0a20 2020  urfaces."""..   
+00011980: 2069 735f 3344 7375 7266 6163 6520 3d20   is_3Dsurface = 
+00011990: 5472 7565 0a20 2020 205f 616c 6c6f 7765  True.    _allowe
+000119a0: 645f 6b65 7973 203d 205b 2273 7572 6661  d_keys = ["surfa
+000119b0: 6365 5f63 6f6c 6f72 222c 2022 6973 5f70  ce_color", "is_p
+000119c0: 6f6c 6172 225d 0a0a 2020 2020 6465 6620  olar"]..    def 
+000119d0: 5f5f 696e 6974 5f5f 2873 656c 662c 202a  __init__(self, *
+000119e0: 6172 6773 2c20 2a2a 6b77 6172 6773 293a  args, **kwargs):
+000119f0: 0a20 2020 2020 2020 2073 7570 6572 2829  .        super()
+00011a00: 2e5f 5f69 6e69 745f 5f28 2a2a 6b77 6172  .__init__(**kwar
+00011a10: 6773 290a 2020 2020 2020 2020 2320 4e4f  gs).        # NO
+00011a20: 5445 3a20 7768 7920 7368 6f75 6c64 2053  TE: why should S
+00011a30: 7572 6661 6365 4f76 6572 3244 5261 6e67  urfaceOver2DRang
+00011a40: 6553 6572 6965 7320 7375 7070 6f72 7420  eSeries support 
+00011a50: 6973 2070 6f6c 6172 3f0a 2020 2020 2020  is polar?.      
+00011a60: 2020 2320 4166 7465 7220 616c 6c2c 2074    # After all, t
+00011a70: 6865 2073 616d 6520 7265 7375 6c74 2063  he same result c
+00011a80: 616e 2062 6520 6163 6869 6576 6520 7769  an be achieve wi
+00011a90: 7468 0a20 2020 2020 2020 2023 2050 6172  th.        # Par
+00011aa0: 616d 6574 7269 6353 7572 6661 6365 5365  ametricSurfaceSe
+00011ab0: 7269 6573 2e20 466f 7220 6578 616d 706c  ries. For exampl
+00011ac0: 653a 0a20 2020 2020 2020 2023 2073 696e  e:.        # sin
+00011ad0: 2872 2920 666f 7220 2872 2c20 302c 2032  (r) for (r, 0, 2
+00011ae0: 202a 2070 6929 2061 6e64 2028 7468 6574   * pi) and (thet
+00011af0: 612c 2030 2c20 7069 2f32 2920 6361 6e20  a, 0, pi/2) can 
+00011b00: 6265 2070 6172 616d 6574 6572 697a 6564  be parameterized
+00011b10: 0a20 2020 2020 2020 2023 2061 7320 2872  .        # as (r
+00011b20: 202a 2063 6f73 2874 6865 7461 292c 2072   * cos(theta), r
+00011b30: 202a 2073 696e 2874 6865 7461 292c 2073   * sin(theta), s
+00011b40: 696e 2874 2929 2066 6f72 2028 722c 2030  in(t)) for (r, 0
+00011b50: 2c20 3220 2a20 7069 2920 616e 640a 2020  , 2 * pi) and.  
+00011b60: 2020 2020 2020 2320 2874 6865 7461 2c20        # (theta, 
+00011b70: 302c 2070 692f 3229 2e0a 2020 2020 2020  0, pi/2)..      
+00011b80: 2020 2320 4265 6361 7573 6520 6974 2069    # Because it i
+00011b90: 7320 6661 7374 6572 2074 6f20 6576 616c  s faster to eval
+00011ba0: 7561 7465 2028 696d 706f 7274 616e 7420  uate (important 
+00011bb0: 666f 7220 696e 7465 7261 6374 6976 6520  for interactive 
+00011bc0: 706c 6f74 7329 2e0a 2020 2020 2020 2020  plots)..        
+00011bd0: 7365 6c66 2e69 735f 706f 6c61 7220 3d20  self.is_polar = 
+00011be0: 6b77 6172 6773 2e67 6574 2822 6973 5f70  kwargs.get("is_p
+00011bf0: 6f6c 6172 222c 2046 616c 7365 290a 2020  olar", False).  
+00011c00: 2020 2020 2020 7365 6c66 2e73 7572 6661        self.surfa
+00011c10: 6365 5f63 6f6c 6f72 203d 206b 7761 7267  ce_color = kwarg
+00011c20: 732e 6765 7428 2273 7572 6661 6365 5f63  s.get("surface_c
+00011c30: 6f6c 6f72 222c 204e 6f6e 6529 0a20 2020  olor", None).   
+00011c40: 2020 2020 2073 656c 662e 636f 6c6f 725f       self.color_
+00011c50: 6675 6e63 203d 206b 7761 7267 732e 6765  func = kwargs.ge
+00011c60: 7428 2263 6f6c 6f72 5f66 756e 6322 2c20  t("color_func", 
+00011c70: 6c61 6d62 6461 2078 2c20 792c 207a 3a20  lambda x, y, z: 
+00011c80: 7a29 0a20 2020 2020 2020 2069 6620 6361  z).        if ca
+00011c90: 6c6c 6162 6c65 2873 656c 662e 7375 7266  llable(self.surf
+00011ca0: 6163 655f 636f 6c6f 7229 3a0a 2020 2020  ace_color):.    
+00011cb0: 2020 2020 2020 2020 7365 6c66 2e63 6f6c          self.col
+00011cc0: 6f72 5f66 756e 6320 3d20 7365 6c66 2e73  or_func = self.s
+00011cd0: 7572 6661 6365 5f63 6f6c 6f72 0a20 2020  urface_color.   
+00011ce0: 2020 2020 2020 2020 2073 656c 662e 7375           self.su
+00011cf0: 7266 6163 655f 636f 6c6f 7220 3d20 4e6f  rface_color = No
+00011d00: 6e65 0a0a 2020 2020 6465 6620 5f73 6574  ne..    def _set
+00011d10: 5f73 7572 6661 6365 5f6c 6162 656c 2873  _surface_label(s
+00011d20: 656c 662c 206c 6162 656c 293a 0a20 2020  elf, label):.   
+00011d30: 2020 2020 2065 7870 7273 203d 2073 656c       exprs = sel
+00011d40: 662e 6578 7072 0a20 2020 2020 2020 2073  f.expr.        s
+00011d50: 656c 662e 5f6c 6162 656c 203d 2073 7472  elf._label = str
+00011d60: 2865 7870 7273 2920 6966 206c 6162 656c  (exprs) if label
+00011d70: 2069 7320 4e6f 6e65 2065 6c73 6520 6c61   is None else la
+00011d80: 6265 6c0a 2020 2020 2020 2020 7365 6c66  bel.        self
+00011d90: 2e5f 6c61 7465 785f 6c61 6265 6c20 3d20  ._latex_label = 
+00011da0: 6c61 7465 7828 6578 7072 7329 2069 6620  latex(exprs) if 
+00011db0: 6c61 6265 6c20 6973 204e 6f6e 6520 656c  label is None el
+00011dc0: 7365 206c 6162 656c 0a20 2020 2020 2020  se label.       
+00011dd0: 2023 2069 6620 7468 6520 6578 7072 6573   # if the expres
+00011de0: 7369 6f6e 7320 6973 2061 206c 616d 6264  sions is a lambd
+00011df0: 6120 6675 6e63 7469 6f6e 2061 6e64 206e  a function and n
+00011e00: 6f20 6c61 6265 6c0a 2020 2020 2020 2020  o label.        
+00011e10: 2320 6861 7320 6265 656e 2070 726f 7669  # has been provi
+00011e20: 6465 642c 2074 6865 6e20 6974 7320 6265  ded, then its be
+00011e30: 7474 6572 2074 6f20 646f 2074 6865 2066  tter to do the f
+00011e40: 6f6c 6c6f 7769 6e67 2074 6f20 6176 6f69  ollowing to avoi
+00011e50: 640a 2020 2020 2020 2020 2320 7375 7072  d.        # supr
+00011e60: 6973 6573 206f 6e20 7468 6520 6261 636b  ises on the back
+00011e70: 656e 640a 2020 2020 2020 2020 6973 5f6c  end.        is_l
+00011e80: 616d 6264 6120 3d20 2863 616c 6c61 626c  ambda = (callabl
+00011e90: 6528 6578 7072 7329 2069 6620 6e6f 7420  e(exprs) if not 
+00011ea0: 6861 7361 7474 7228 6578 7072 732c 2022  hasattr(exprs, "
+00011eb0: 5f5f 6974 6572 5f5f 2229 0a20 2020 2020  __iter__").     
+00011ec0: 2020 2020 2020 2065 6c73 6520 616e 7928         else any(
+00011ed0: 6361 6c6c 6162 6c65 2865 2920 666f 7220  callable(e) for 
+00011ee0: 6520 696e 2065 7870 7273 2929 0a20 2020  e in exprs)).   
+00011ef0: 2020 2020 2069 6620 6973 5f6c 616d 6264       if is_lambd
+00011f00: 6120 616e 6420 2873 656c 662e 5f6c 6162  a and (self._lab
+00011f10: 656c 203d 3d20 7374 7228 6578 7072 7329  el == str(exprs)
+00011f20: 293a 0a20 2020 2020 2020 2020 2020 2073  ):.            s
+00011f30: 656c 662e 5f6c 6162 656c 203d 2022 220a  elf._label = "".
+00011f40: 2020 2020 2020 2020 2020 2020 7365 6c66              self
+00011f50: 2e5f 6c61 7465 785f 6c61 6265 6c20 3d20  ._latex_label = 
+00011f60: 2222 0a0a 2020 2020 4070 726f 7065 7274  ""..    @propert
+00011f70: 790a 2020 2020 6465 6620 7375 7266 6163  y.    def surfac
+00011f80: 655f 636f 6c6f 7228 7365 6c66 293a 0a20  e_color(self):. 
+00011f90: 2020 2020 2020 2072 6574 7572 6e20 7365         return se
+00011fa0: 6c66 2e5f 7375 7266 6163 655f 636f 6c6f  lf._surface_colo
+00011fb0: 720a 0a20 2020 2040 7375 7266 6163 655f  r..    @surface_
+00011fc0: 636f 6c6f 722e 7365 7474 6572 0a20 2020  color.setter.   
+00011fd0: 2064 6566 2073 7572 6661 6365 5f63 6f6c   def surface_col
+00011fe0: 6f72 2873 656c 662c 2076 616c 293a 0a20  or(self, val):. 
+00011ff0: 2020 2020 2020 2073 656c 662e 5f6c 696e         self._lin
+00012000: 655f 7375 7266 6163 655f 636f 6c6f 7228  e_surface_color(
+00012010: 225f 7375 7266 6163 655f 636f 6c6f 7222  "_surface_color"
+00012020: 2c20 7661 6c29 0a0a 0a63 6c61 7373 2053  , val)...class S
+00012030: 7572 6661 6365 4f76 6572 3244 5261 6e67  urfaceOver2DRang
+00012040: 6553 6572 6965 7328 0a20 2020 2043 6f6d  eSeries(.    Com
+00012050: 6d6f 6e41 6461 7074 6976 6545 7661 6c75  monAdaptiveEvalu
+00012060: 6174 696f 6e2c 2043 6f6d 6d6f 6e55 6e69  ation, CommonUni
+00012070: 666f 726d 4576 616c 7561 7469 6f6e 2c20  formEvaluation, 
+00012080: 5375 7266 6163 6542 6173 6553 6572 6965  SurfaceBaseSerie
+00012090: 730a 293a 0a20 2020 2022 2222 5265 7072  s.):.    """Repr
+000120a0: 6573 656e 7461 7469 6f6e 2066 6f72 2061  esentation for a
+000120b0: 2033 4420 7375 7266 6163 6520 636f 6e73   3D surface cons
+000120c0: 6973 7469 6e67 206f 6620 6120 7379 6d70  isting of a symp
+000120d0: 7920 6578 7072 6573 7369 6f6e 2061 6e64  y expression and
+000120e0: 2032 440a 2020 2020 7261 6e67 652e 2222   2D.    range.""
+000120f0: 220a 0a20 2020 2064 6566 205f 5f69 6e69  "..    def __ini
+00012100: 745f 5f28 0a20 2020 2020 2020 2073 656c  t__(.        sel
+00012110: 662c 2065 7870 722c 2076 6172 5f73 7461  f, expr, var_sta
+00012120: 7274 5f65 6e64 5f78 2c20 7661 725f 7374  rt_end_x, var_st
+00012130: 6172 745f 656e 645f 792c 206c 6162 656c  art_end_y, label
+00012140: 3d22 222c 202a 2a6b 7761 7267 730a 2020  ="", **kwargs.  
+00012150: 2020 293a 0a20 2020 2020 2020 2073 7570    ):.        sup
+00012160: 6572 2829 2e5f 5f69 6e69 745f 5f28 2a2a  er().__init__(**
+00012170: 6b77 6172 6773 290a 2020 2020 2020 2020  kwargs).        
+00012180: 7365 6c66 2e65 7870 7220 3d20 6578 7072  self.expr = expr
+00012190: 2069 6620 6361 6c6c 6162 6c65 2865 7870   if callable(exp
+000121a0: 7229 2065 6c73 6520 7379 6d70 6966 7928  r) else sympify(
+000121b0: 6578 7072 290a 2020 2020 2020 2020 7365  expr).        se
+000121c0: 6c66 2e72 616e 6765 7320 3d20 5b76 6172  lf.ranges = [var
+000121d0: 5f73 7461 7274 5f65 6e64 5f78 2c20 7661  _start_end_x, va
+000121e0: 725f 7374 6172 745f 656e 645f 795d 0a20  r_start_end_y]. 
+000121f0: 2020 2020 2020 2073 656c 662e 5f73 6574         self._set
+00012200: 5f73 7572 6661 6365 5f6c 6162 656c 286c  _surface_label(l
+00012210: 6162 656c 290a 2020 2020 2020 2020 7365  abel).        se
+00012220: 6c66 2e5f 706f 7374 5f69 6e69 7428 290a  lf._post_init().
+00012230: 0a20 2020 2040 7072 6f70 6572 7479 0a20  .    @property. 
+00012240: 2020 2064 6566 2076 6172 5f78 2873 656c     def var_x(sel
+00012250: 6629 3a0a 2020 2020 2020 2020 7265 7475  f):.        retu
+00012260: 726e 2073 656c 662e 7261 6e67 6573 5b30  rn self.ranges[0
+00012270: 5d5b 305d 0a0a 2020 2020 4070 726f 7065  ][0]..    @prope
+00012280: 7274 790a 2020 2020 6465 6620 7661 725f  rty.    def var_
+00012290: 7928 7365 6c66 293a 0a20 2020 2020 2020  y(self):.       
+000122a0: 2072 6574 7572 6e20 7365 6c66 2e72 616e   return self.ran
+000122b0: 6765 735b 315d 5b30 5d0a 0a20 2020 2040  ges[1][0]..    @
+000122c0: 7072 6f70 6572 7479 0a20 2020 2064 6566  property.    def
+000122d0: 2073 7461 7274 5f78 2873 656c 6629 3a0a   start_x(self):.
+000122e0: 2020 2020 2020 2020 7472 793a 0a20 2020          try:.   
+000122f0: 2020 2020 2020 2020 2072 6574 7572 6e20           return 
+00012300: 666c 6f61 7428 7365 6c66 2e72 616e 6765  float(self.range
+00012310: 735b 305d 5b31 5d29 0a20 2020 2020 2020  s[0][1]).       
+00012320: 2065 7863 6570 7420 4578 6365 7074 696f   except Exceptio
+00012330: 6e3a 0a20 2020 2020 2020 2020 2020 2072  n:.            r
+00012340: 6574 7572 6e20 7365 6c66 2e72 616e 6765  eturn self.range
+00012350: 735b 305d 5b31 5d0a 0a20 2020 2040 7072  s[0][1]..    @pr
+00012360: 6f70 6572 7479 0a20 2020 2064 6566 2065  operty.    def e
+00012370: 6e64 5f78 2873 656c 6629 3a0a 2020 2020  nd_x(self):.    
+00012380: 2020 2020 7472 793a 0a20 2020 2020 2020      try:.       
+00012390: 2020 2020 2072 6574 7572 6e20 666c 6f61       return floa
+000123a0: 7428 7365 6c66 2e72 616e 6765 735b 305d  t(self.ranges[0]
+000123b0: 5b32 5d29 0a20 2020 2020 2020 2065 7863  [2]).        exc
+000123c0: 6570 7420 4578 6365 7074 696f 6e3a 0a20  ept Exception:. 
+000123d0: 2020 2020 2020 2020 2020 2072 6574 7572             retur
+000123e0: 6e20 7365 6c66 2e72 616e 6765 735b 305d  n self.ranges[0]
+000123f0: 5b32 5d0a 0a20 2020 2040 7072 6f70 6572  [2]..    @proper
+00012400: 7479 0a20 2020 2064 6566 2073 7461 7274  ty.    def start
+00012410: 5f79 2873 656c 6629 3a0a 2020 2020 2020  _y(self):.      
+00012420: 2020 7472 793a 0a20 2020 2020 2020 2020    try:.         
+00012430: 2020 2072 6574 7572 6e20 666c 6f61 7428     return float(
+00012440: 7365 6c66 2e72 616e 6765 735b 315d 5b31  self.ranges[1][1
+00012450: 5d29 0a20 2020 2020 2020 2065 7863 6570  ]).        excep
+00012460: 7420 4578 6365 7074 696f 6e3a 0a20 2020  t Exception:.   
+00012470: 2020 2020 2020 2020 2072 6574 7572 6e20           return 
+00012480: 7365 6c66 2e72 616e 6765 735b 315d 5b31  self.ranges[1][1
+00012490: 5d0a 0a20 2020 2040 7072 6f70 6572 7479  ]..    @property
+000124a0: 0a20 2020 2064 6566 2065 6e64 5f79 2873  .    def end_y(s
+000124b0: 656c 6629 3a0a 2020 2020 2020 2020 7472  elf):.        tr
+000124c0: 793a 0a20 2020 2020 2020 2020 2020 2072  y:.            r
+000124d0: 6574 7572 6e20 666c 6f61 7428 7365 6c66  eturn float(self
+000124e0: 2e72 616e 6765 735b 315d 5b32 5d29 0a20  .ranges[1][2]). 
+000124f0: 2020 2020 2020 2065 7863 6570 7420 4578         except Ex
+00012500: 6365 7074 696f 6e3a 0a20 2020 2020 2020  ception:.       
+00012510: 2020 2020 2072 6574 7572 6e20 7365 6c66       return self
+00012520: 2e72 616e 6765 735b 315d 5b32 5d0a 0a20  .ranges[1][2].. 
+00012530: 2020 2064 6566 205f 5f73 7472 5f5f 2873     def __str__(s
+00012540: 656c 6629 3a0a 2020 2020 2020 2020 7365  elf):.        se
+00012550: 7269 6573 5f74 7970 6520 3d20 2263 6172  ries_type = "car
+00012560: 7465 7369 616e 2073 7572 6661 6365 2220  tesian surface" 
+00012570: 6966 2073 656c 662e 6973 5f33 4473 7572  if self.is_3Dsur
+00012580: 6661 6365 2065 6c73 6520 2263 6f6e 746f  face else "conto
+00012590: 7572 220a 2020 2020 2020 2020 7265 7475  ur".        retu
+000125a0: 726e 2073 656c 662e 5f73 7472 5f68 656c  rn self._str_hel
+000125b0: 7065 7228 0a20 2020 2020 2020 2020 2020  per(.           
+000125c0: 2073 6572 6965 735f 7479 7065 202b 2022   series_type + "
+000125d0: 3a20 2573 2066 6f72 2220 2220 2573 206f  : %s for" " %s o
+000125e0: 7665 7220 2573 2061 6e64 2025 7320 6f76  ver %s and %s ov
+000125f0: 6572 2025 7322 2025 2028 0a20 2020 2020  er %s" % (.     
+00012600: 2020 2020 2020 2020 2020 2073 7472 2873             str(s
+00012610: 656c 662e 6578 7072 292c 0a20 2020 2020  elf.expr),.     
+00012620: 2020 2020 2020 2020 2020 2073 7472 2873             str(s
+00012630: 656c 662e 7661 725f 7829 2c20 7374 7228  elf.var_x), str(
+00012640: 2873 656c 662e 7374 6172 745f 782c 2073  (self.start_x, s
+00012650: 656c 662e 656e 645f 7829 292c 0a20 2020  elf.end_x)),.   
+00012660: 2020 2020 2020 2020 2020 2020 2073 7472               str
+00012670: 2873 656c 662e 7661 725f 7929 2c20 7374  (self.var_y), st
+00012680: 7228 2873 656c 662e 7374 6172 745f 792c  r((self.start_y,
+00012690: 2073 656c 662e 656e 645f 7929 292c 0a20   self.end_y)),. 
+000126a0: 2020 2020 2020 2020 2020 2029 0a20 2020             ).   
+000126b0: 2020 2020 2029 0a0a 2020 2020 6465 6620       )..    def 
+000126c0: 5f61 6461 7074 6976 655f 7361 6d70 6c69  _adaptive_sampli
+000126d0: 6e67 2873 656c 6629 3a0a 2020 2020 2020  ng(self):.      
+000126e0: 2020 6e70 203d 2069 6d70 6f72 745f 6d6f    np = import_mo
+000126f0: 6475 6c65 2827 6e75 6d70 7927 290a 0a20  dule('numpy').. 
+00012700: 2020 2020 2020 2064 6566 2066 756e 6328         def func(
+00012710: 662c 2078 7929 3a0a 2020 2020 2020 2020  f, xy):.        
+00012720: 2020 2020 7472 793a 0a20 2020 2020 2020      try:.       
+00012730: 2020 2020 2020 2020 2077 203d 2066 282a           w = f(*
+00012740: 5b63 6f6d 706c 6578 2874 2920 666f 7220  [complex(t) for 
+00012750: 7420 696e 2078 795d 290a 2020 2020 2020  t in xy]).      
+00012760: 2020 2020 2020 2020 2020 7265 7475 726e            return
+00012770: 2077 2e72 6561 6c20 6966 206e 702e 6973   w.real if np.is
+00012780: 636c 6f73 6528 772e 696d 6167 2c20 3029  close(w.imag, 0)
+00012790: 2065 6c73 6520 6e70 2e6e 616e 0a20 2020   else np.nan.   
+000127a0: 2020 2020 2020 2020 2065 7863 6570 7420           except 
+000127b0: 285a 6572 6f44 6976 6973 696f 6e45 7272  (ZeroDivisionErr
+000127c0: 6f72 2c20 4f76 6572 666c 6f77 4572 726f  or, OverflowErro
+000127d0: 7229 3a0a 2020 2020 2020 2020 2020 2020  r):.            
+000127e0: 2020 2020 7265 7475 726e 206e 702e 6e61      return np.na
+000127f0: 6e0a 0a20 2020 2020 2020 2072 6574 7572  n..        retur
+00012800: 6e20 5f61 6461 7074 6976 655f 6576 616c  n _adaptive_eval
+00012810: 280a 2020 2020 2020 2020 2020 2020 6675  (.            fu
+00012820: 6e63 2c20 5b73 656c 662e 7661 725f 782c  nc, [self.var_x,
+00012830: 2073 656c 662e 7661 725f 795d 2c20 7365   self.var_y], se
+00012840: 6c66 2e65 7870 722c 0a20 2020 2020 2020  lf.expr,.       
+00012850: 2020 2020 205b 2873 656c 662e 7374 6172       [(self.star
+00012860: 745f 782c 2073 656c 662e 656e 645f 7829  t_x, self.end_x)
+00012870: 2c20 2873 656c 662e 7374 6172 745f 792c  , (self.start_y,
+00012880: 2073 656c 662e 656e 645f 7929 5d2c 0a20   self.end_y)],. 
+00012890: 2020 2020 2020 2020 2020 206d 6f64 756c             modul
+000128a0: 6573 3d73 656c 662e 6d6f 6475 6c65 732c  es=self.modules,
+000128b0: 0a20 2020 2020 2020 2020 2020 2061 6461  .            ada
+000128c0: 7074 6976 655f 676f 616c 3d73 656c 662e  ptive_goal=self.
+000128d0: 6164 6170 7469 7665 5f67 6f61 6c2c 0a20  adaptive_goal,. 
+000128e0: 2020 2020 2020 2020 2020 206c 6f73 735f             loss_
+000128f0: 666e 3d73 656c 662e 6c6f 7373 5f66 6e29  fn=self.loss_fn)
+00012900: 0a0a 2020 2020 6465 6620 5f75 6e69 666f  ..    def _unifo
+00012910: 726d 5f73 616d 706c 696e 6728 7365 6c66  rm_sampling(self
+00012920: 293a 0a20 2020 2020 2020 206e 7020 3d20  ):.        np = 
+00012930: 696d 706f 7274 5f6d 6f64 756c 6528 276e  import_module('n
+00012940: 756d 7079 2729 0a0a 2020 2020 2020 2020  umpy')..        
+00012950: 7265 7375 6c74 7320 3d20 7365 6c66 2e5f  results = self._
+00012960: 6576 616c 7561 7465 2829 0a20 2020 2020  evaluate().     
+00012970: 2020 2066 6f72 2069 2c20 7220 696e 2065     for i, r in e
+00012980: 6e75 6d65 7261 7465 2872 6573 756c 7473  numerate(results
+00012990: 293a 0a20 2020 2020 2020 2020 2020 205f  ):.            _
+000129a0: 7265 2c20 5f69 6d20 3d20 6e70 2e72 6561  re, _im = np.rea
+000129b0: 6c28 7229 2c20 6e70 2e69 6d61 6728 7229  l(r), np.imag(r)
+000129c0: 0a20 2020 2020 2020 2020 2020 205f 7265  .            _re
+000129d0: 5b6e 702e 696e 7665 7274 286e 702e 6973  [np.invert(np.is
+000129e0: 636c 6f73 6528 5f69 6d2c 206e 702e 7a65  close(_im, np.ze
+000129f0: 726f 735f 6c69 6b65 285f 696d 2929 295d  ros_like(_im)))]
+00012a00: 203d 206e 702e 6e61 6e0a 2020 2020 2020   = np.nan.      
+00012a10: 2020 2020 2020 7265 7375 6c74 735b 695d        results[i]
+00012a20: 203d 205f 7265 0a0a 2020 2020 2020 2020   = _re..        
+00012a30: 7265 7475 726e 2072 6573 756c 7473 0a0a  return results..
+00012a40: 2020 2020 6465 6620 6765 745f 6461 7461      def get_data
+00012a50: 2873 656c 6629 3a0a 2020 2020 2020 2020  (self):.        
+00012a60: 2222 2252 6574 7572 6e20 6172 7261 7973  """Return arrays
+00012a70: 206f 6620 636f 6f72 6469 6e61 7465 7320   of coordinates 
+00012a80: 666f 7220 706c 6f74 7469 6e67 2e20 4465  for plotting. De
+00012a90: 7065 6e64 696e 6720 6f6e 2074 6865 0a20  pending on the. 
+00012aa0: 2020 2020 2020 2060 6164 6170 7469 7665         `adaptive
+00012ab0: 6020 6f70 7469 6f6e 2c20 7468 6973 2066  ` option, this f
+00012ac0: 756e 6374 696f 6e20 7769 6c6c 2065 6974  unction will eit
+00012ad0: 6865 7220 7573 6520 616e 2061 6461 7074  her use an adapt
+00012ae0: 6976 6520 616c 676f 7269 7468 6d0a 2020  ive algorithm.  
+00012af0: 2020 2020 2020 6f72 2069 7420 7769 6c6c        or it will
+00012b00: 2075 6e69 666f 726d 6c79 2073 616d 706c   uniformly sampl
+00012b10: 6520 7468 6520 6578 7072 6573 7369 6f6e  e the expression
+00012b20: 206f 7665 7220 7468 6520 7072 6f76 6964   over the provid
+00012b30: 6564 2072 616e 6765 2e0a 0a20 2020 2020  ed range...     
+00012b40: 2020 2052 6574 7572 6e73 0a20 2020 2020     Returns.     
+00012b50: 2020 203d 3d3d 3d3d 3d3d 0a0a 2020 2020     =======..    
+00012b60: 2020 2020 6d65 7368 5f78 203a 206e 702e      mesh_x : np.
+00012b70: 6e64 6172 7261 7920 5b6e 3220 7820 6e31  ndarray [n2 x n1
+00012b80: 5d0a 2020 2020 2020 2020 2020 2020 5265  ].            Re
+00012b90: 616c 2044 6973 6372 6574 697a 6564 2078  al Discretized x
+00012ba0: 2d64 6f6d 6169 6e2e 0a0a 2020 2020 2020  -domain...      
+00012bb0: 2020 6d65 7368 5f79 203a 206e 702e 6e64    mesh_y : np.nd
+00012bc0: 6172 7261 7920 5b6e 3220 7820 6e31 5d0a  array [n2 x n1].
+00012bd0: 2020 2020 2020 2020 2020 2020 5265 616c              Real
+00012be0: 2044 6973 6372 6574 697a 6564 2079 2d64   Discretized y-d
+00012bf0: 6f6d 6169 6e2e 0a0a 2020 2020 2020 2020  omain...        
+00012c00: 7a20 3a20 6e70 2e6e 6461 7272 6179 205b  z : np.ndarray [
+00012c10: 6e32 2078 206e 315d 0a20 2020 2020 2020  n2 x n1].       
+00012c20: 2020 2020 2052 6573 756c 7473 206f 6620       Results of 
+00012c30: 7468 6520 6576 616c 7561 7469 6f6e 2e0a  the evaluation..
+00012c40: 2020 2020 2020 2020 2222 220a 2020 2020          """.    
+00012c50: 2020 2020 6e70 203d 2069 6d70 6f72 745f      np = import_
+00012c60: 6d6f 6475 6c65 2827 6e75 6d70 7927 290a  module('numpy').
+00012c70: 0a20 2020 2020 2020 2069 6620 7365 6c66  .        if self
+00012c80: 2e61 6461 7074 6976 653a 0a20 2020 2020  .adaptive:.     
+00012c90: 2020 2020 2020 2072 6573 203d 2073 656c         res = sel
+00012ca0: 662e 5f61 6461 7074 6976 655f 7361 6d70  f._adaptive_samp
+00012cb0: 6c69 6e67 2829 0a20 2020 2020 2020 2065  ling().        e
+00012cc0: 6c73 653a 0a20 2020 2020 2020 2020 2020  lse:.           
+00012cd0: 2072 6573 203d 2073 656c 662e 5f75 6e69   res = self._uni
+00012ce0: 666f 726d 5f73 616d 706c 696e 6728 290a  form_sampling().
+00012cf0: 0a20 2020 2020 2020 2078 2c20 792c 207a  .        x, y, z
+00012d00: 203d 2072 6573 0a20 2020 2020 2020 2069   = res.        i
+00012d10: 6620 7365 6c66 2e69 735f 706f 6c61 7220  f self.is_polar 
+00012d20: 616e 6420 7365 6c66 2e69 735f 3344 7375  and self.is_3Dsu
+00012d30: 7266 6163 653a 0a20 2020 2020 2020 2020  rface:.         
+00012d40: 2020 2072 203d 2078 2e63 6f70 7928 290a     r = x.copy().
+00012d50: 2020 2020 2020 2020 2020 2020 7820 3d20              x = 
+00012d60: 7220 2a20 6e70 2e63 6f73 2879 290a 2020  r * np.cos(y).  
+00012d70: 2020 2020 2020 2020 2020 7920 3d20 7220            y = r 
+00012d80: 2a20 6e70 2e73 696e 2879 290a 0a20 2020  * np.sin(y)..   
+00012d90: 2020 2020 2072 6574 7572 6e20 7365 6c66       return self
+00012da0: 2e5f 6170 706c 795f 7472 616e 7366 6f72  ._apply_transfor
+00012db0: 6d28 782c 2079 2c20 7a29 0a0a 0a63 6c61  m(x, y, z)...cla
+00012dc0: 7373 2050 6172 616d 6574 7269 6353 7572  ss ParametricSur
+00012dd0: 6661 6365 5365 7269 6573 280a 2020 2020  faceSeries(.    
+00012de0: 436f 6d6d 6f6e 556e 6966 6f72 6d45 7661  CommonUniformEva
+00012df0: 6c75 6174 696f 6e2c 2053 7572 6661 6365  luation, Surface
+00012e00: 4261 7365 5365 7269 6573 0a29 3a0a 2020  BaseSeries.):.  
+00012e10: 2020 2222 2252 6570 7265 7365 6e74 6174    """Representat
+00012e20: 696f 6e20 666f 7220 6120 3344 2073 7572  ion for a 3D sur
+00012e30: 6661 6365 2063 6f6e 7369 7374 696e 6720  face consisting 
+00012e40: 6f66 2074 6872 6565 2070 6172 616d 6574  of three paramet
+00012e50: 7269 6320 7379 6d70 790a 2020 2020 6578  ric sympy.    ex
+00012e60: 7072 6573 7369 6f6e 7320 616e 6420 6120  pressions and a 
+00012e70: 7261 6e67 652e 2222 220a 0a20 2020 2069  range."""..    i
+00012e80: 735f 7061 7261 6d65 7472 6963 203d 2054  s_parametric = T
+00012e90: 7275 650a 0a20 2020 2064 6566 205f 5f69  rue..    def __i
+00012ea0: 6e69 745f 5f28 0a20 2020 2020 2020 2073  nit__(.        s
+00012eb0: 656c 662c 2065 7870 725f 782c 2065 7870  elf, expr_x, exp
+00012ec0: 725f 792c 2065 7870 725f 7a2c 0a20 2020  r_y, expr_z,.   
+00012ed0: 2020 2020 2076 6172 5f73 7461 7274 5f65       var_start_e
+00012ee0: 6e64 5f75 2c20 7661 725f 7374 6172 745f  nd_u, var_start_
+00012ef0: 656e 645f 762c 206c 6162 656c 3d22 222c  end_v, label="",
+00012f00: 202a 2a6b 7761 7267 730a 2020 2020 293a   **kwargs.    ):
+00012f10: 0a20 2020 2020 2020 2073 7570 6572 2829  .        super()
+00012f20: 2e5f 5f69 6e69 745f 5f28 2a2a 6b77 6172  .__init__(**kwar
+00012f30: 6773 290a 2020 2020 2020 2020 7365 6c66  gs).        self
+00012f40: 2e65 7870 725f 7820 3d20 6578 7072 5f78  .expr_x = expr_x
+00012f50: 2069 6620 6361 6c6c 6162 6c65 2865 7870   if callable(exp
+00012f60: 725f 7829 2065 6c73 6520 7379 6d70 6966  r_x) else sympif
+00012f70: 7928 6578 7072 5f78 290a 2020 2020 2020  y(expr_x).      
+00012f80: 2020 7365 6c66 2e65 7870 725f 7920 3d20    self.expr_y = 
+00012f90: 6578 7072 5f79 2069 6620 6361 6c6c 6162  expr_y if callab
+00012fa0: 6c65 2865 7870 725f 7929 2065 6c73 6520  le(expr_y) else 
+00012fb0: 7379 6d70 6966 7928 6578 7072 5f79 290a  sympify(expr_y).
+00012fc0: 2020 2020 2020 2020 7365 6c66 2e65 7870          self.exp
+00012fd0: 725f 7a20 3d20 6578 7072 5f7a 2069 6620  r_z = expr_z if 
+00012fe0: 6361 6c6c 6162 6c65 2865 7870 725f 7a29  callable(expr_z)
+00012ff0: 2065 6c73 6520 7379 6d70 6966 7928 6578   else sympify(ex
+00013000: 7072 5f7a 290a 2020 2020 2020 2020 7365  pr_z).        se
+00013010: 6c66 2e65 7870 7220 3d20 2873 656c 662e  lf.expr = (self.
+00013020: 6578 7072 5f78 2c20 7365 6c66 2e65 7870  expr_x, self.exp
+00013030: 725f 792c 2073 656c 662e 6578 7072 5f7a  r_y, self.expr_z
+00013040: 290a 2020 2020 2020 2020 7365 6c66 2e72  ).        self.r
+00013050: 616e 6765 7320 3d20 5b76 6172 5f73 7461  anges = [var_sta
+00013060: 7274 5f65 6e64 5f75 2c20 7661 725f 7374  rt_end_u, var_st
+00013070: 6172 745f 656e 645f 765d 0a20 2020 2020  art_end_v].     
+00013080: 2020 2073 656c 662e 636f 6c6f 725f 6675     self.color_fu
+00013090: 6e63 203d 206b 7761 7267 732e 6765 7428  nc = kwargs.get(
+000130a0: 2263 6f6c 6f72 5f66 756e 6322 2c20 6c61  "color_func", la
+000130b0: 6d62 6461 2078 2c20 792c 207a 2c20 752c  mbda x, y, z, u,
+000130c0: 2076 3a20 7a29 0a20 2020 2020 2020 2073   v: z).        s
+000130d0: 656c 662e 5f73 6574 5f73 7572 6661 6365  elf._set_surface
+000130e0: 5f6c 6162 656c 286c 6162 656c 290a 2020  _label(label).  
+000130f0: 2020 2020 2020 7365 6c66 2e5f 706f 7374        self._post
+00013100: 5f69 6e69 7428 290a 0a20 2020 2040 7072  _init()..    @pr
+00013110: 6f70 6572 7479 0a20 2020 2064 6566 2076  operty.    def v
+00013120: 6172 5f75 2873 656c 6629 3a0a 2020 2020  ar_u(self):.    
+00013130: 2020 2020 7265 7475 726e 2073 656c 662e      return self.
+00013140: 7261 6e67 6573 5b30 5d5b 305d 0a0a 2020  ranges[0][0]..  
+00013150: 2020 4070 726f 7065 7274 790a 2020 2020    @property.    
+00013160: 6465 6620 7661 725f 7628 7365 6c66 293a  def var_v(self):
+00013170: 0a20 2020 2020 2020 2072 6574 7572 6e20  .        return 
+00013180: 7365 6c66 2e72 616e 6765 735b 315d 5b30  self.ranges[1][0
+00013190: 5d0a 0a20 2020 2040 7072 6f70 6572 7479  ]..    @property
+000131a0: 0a20 2020 2064 6566 2073 7461 7274 5f75  .    def start_u
+000131b0: 2873 656c 6629 3a0a 2020 2020 2020 2020  (self):.        
+000131c0: 7472 793a 0a20 2020 2020 2020 2020 2020  try:.           
+000131d0: 2072 6574 7572 6e20 666c 6f61 7428 7365   return float(se
+000131e0: 6c66 2e72 616e 6765 735b 305d 5b31 5d29  lf.ranges[0][1])
+000131f0: 0a20 2020 2020 2020 2065 7863 6570 7420  .        except 
+00013200: 4578 6365 7074 696f 6e3a 0a20 2020 2020  Exception:.     
+00013210: 2020 2020 2020 2072 6574 7572 6e20 7365         return se
+00013220: 6c66 2e72 616e 6765 735b 305d 5b31 5d0a  lf.ranges[0][1].
+00013230: 0a20 2020 2040 7072 6f70 6572 7479 0a20  .    @property. 
+00013240: 2020 2064 6566 2065 6e64 5f75 2873 656c     def end_u(sel
+00013250: 6629 3a0a 2020 2020 2020 2020 7472 793a  f):.        try:
+00013260: 0a20 2020 2020 2020 2020 2020 2072 6574  .            ret
+00013270: 7572 6e20 666c 6f61 7428 7365 6c66 2e72  urn float(self.r
+00013280: 616e 6765 735b 305d 5b32 5d29 0a20 2020  anges[0][2]).   
+00013290: 2020 2020 2065 7863 6570 7420 4578 6365       except Exce
+000132a0: 7074 696f 6e3a 0a20 2020 2020 2020 2020  ption:.         
+000132b0: 2020 2072 6574 7572 6e20 7365 6c66 2e72     return self.r
+000132c0: 616e 6765 735b 305d 5b32 5d0a 0a20 2020  anges[0][2]..   
+000132d0: 2040 7072 6f70 6572 7479 0a20 2020 2064   @property.    d
+000132e0: 6566 2073 7461 7274 5f76 2873 656c 6629  ef start_v(self)
+000132f0: 3a0a 2020 2020 2020 2020 7472 793a 0a20  :.        try:. 
+00013300: 2020 2020 2020 2020 2020 2072 6574 7572             retur
+00013310: 6e20 666c 6f61 7428 7365 6c66 2e72 616e  n float(self.ran
+00013320: 6765 735b 315d 5b31 5d29 0a20 2020 2020  ges[1][1]).     
+00013330: 2020 2065 7863 6570 7420 4578 6365 7074     except Except
+00013340: 696f 6e3a 0a20 2020 2020 2020 2020 2020  ion:.           
+00013350: 2072 6574 7572 6e20 7365 6c66 2e72 616e   return self.ran
+00013360: 6765 735b 315d 5b31 5d0a 0a20 2020 2040  ges[1][1]..    @
+00013370: 7072 6f70 6572 7479 0a20 2020 2064 6566  property.    def
+00013380: 2065 6e64 5f76 2873 656c 6629 3a0a 2020   end_v(self):.  
+00013390: 2020 2020 2020 7472 793a 0a20 2020 2020        try:.     
+000133a0: 2020 2020 2020 2072 6574 7572 6e20 666c         return fl
+000133b0: 6f61 7428 7365 6c66 2e72 616e 6765 735b  oat(self.ranges[
+000133c0: 315d 5b32 5d29 0a20 2020 2020 2020 2065  1][2]).        e
+000133d0: 7863 6570 7420 4578 6365 7074 696f 6e3a  xcept Exception:
+000133e0: 0a20 2020 2020 2020 2020 2020 2072 6574  .            ret
+000133f0: 7572 6e20 7365 6c66 2e72 616e 6765 735b  urn self.ranges[
+00013400: 315d 5b32 5d0a 0a20 2020 2064 6566 205f  1][2]..    def _
+00013410: 5f73 7472 5f5f 2873 656c 6629 3a0a 2020  _str__(self):.  
+00013420: 2020 2020 2020 7265 7475 726e 2073 656c        return sel
+00013430: 662e 5f73 7472 5f68 656c 7065 7228 0a20  f._str_helper(. 
+00013440: 2020 2020 2020 2020 2020 2022 7061 7261             "para
+00013450: 6d65 7472 6963 2063 6172 7465 7369 616e  metric cartesian
+00013460: 2073 7572 6661 6365 3a20 2825 732c 2025   surface: (%s, %
+00013470: 732c 2025 7329 2066 6f72 220a 2020 2020  s, %s) for".    
+00013480: 2020 2020 2020 2020 2220 2573 206f 7665          " %s ove
+00013490: 7220 2573 2061 6e64 2025 7320 6f76 6572  r %s and %s over
+000134a0: 2025 7322 2025 2028 0a20 2020 2020 2020   %s" % (.       
+000134b0: 2020 2020 2020 2020 2073 7472 2873 656c           str(sel
+000134c0: 662e 6578 7072 5f78 292c 2073 7472 2873  f.expr_x), str(s
+000134d0: 656c 662e 6578 7072 5f79 292c 2073 7472  elf.expr_y), str
+000134e0: 2873 656c 662e 6578 7072 5f7a 292c 0a20  (self.expr_z),. 
+000134f0: 2020 2020 2020 2020 2020 2020 2020 2073                 s
+00013500: 7472 2873 656c 662e 7661 725f 7529 2c20  tr(self.var_u), 
+00013510: 7374 7228 2873 656c 662e 7374 6172 745f  str((self.start_
+00013520: 752c 2073 656c 662e 656e 645f 7529 292c  u, self.end_u)),
+00013530: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00013540: 2073 7472 2873 656c 662e 7661 725f 7629   str(self.var_v)
+00013550: 2c20 7374 7228 2873 656c 662e 7374 6172  , str((self.star
+00013560: 745f 762c 2073 656c 662e 656e 645f 7629  t_v, self.end_v)
+00013570: 292c 0a20 2020 2020 2020 2020 2020 2029  ),.            )
+00013580: 0a20 2020 2020 2020 2029 0a0a 2020 2020  .        )..    
+00013590: 6465 6620 6765 745f 6461 7461 2873 656c  def get_data(sel
+000135a0: 6629 3a0a 2020 2020 2020 2020 2222 2252  f):.        """R
+000135b0: 6574 7572 6e20 6172 7261 7973 206f 6620  eturn arrays of 
+000135c0: 636f 6f72 6469 6e61 7465 7320 666f 7220  coordinates for 
+000135d0: 706c 6f74 7469 6e67 2e20 4465 7065 6e64  plotting. Depend
+000135e0: 696e 6720 6f6e 2074 6865 0a20 2020 2020  ing on the.     
+000135f0: 2020 2060 6164 6170 7469 7665 6020 6f70     `adaptive` op
+00013600: 7469 6f6e 2c20 7468 6973 2066 756e 6374  tion, this funct
+00013610: 696f 6e20 7769 6c6c 2065 6974 6865 7220  ion will either 
+00013620: 7573 6520 616e 2061 6461 7074 6976 6520  use an adaptive 
+00013630: 616c 676f 7269 7468 6d0a 2020 2020 2020  algorithm.      
+00013640: 2020 6f72 2069 7420 7769 6c6c 2075 6e69    or it will uni
+00013650: 666f 726d 6c79 2073 616d 706c 6520 7468  formly sample th
+00013660: 6520 6578 7072 6573 7369 6f6e 206f 7665  e expression ove
+00013670: 7220 7468 6520 7072 6f76 6964 6564 2072  r the provided r
+00013680: 616e 6765 2e0a 0a20 2020 2020 2020 2052  ange...        R
+00013690: 6574 7572 6e73 0a20 2020 2020 2020 203d  eturns.        =
+000136a0: 3d3d 3d3d 3d3d 0a0a 2020 2020 2020 2020  ======..        
+000136b0: 7820 3a20 6e70 2e6e 6461 7272 6179 205b  x : np.ndarray [
+000136c0: 6e32 2078 206e 315d 0a20 2020 2020 2020  n2 x n1].       
+000136d0: 2020 2020 2078 2d63 6f6f 7264 696e 6174       x-coordinat
+000136e0: 6573 2e0a 2020 2020 2020 2020 7920 3a20  es..        y : 
+000136f0: 6e70 2e6e 6461 7272 6179 205b 6e32 2078  np.ndarray [n2 x
+00013700: 206e 315d 0a20 2020 2020 2020 2020 2020   n1].           
+00013710: 2079 2d63 6f6f 7264 696e 6174 6573 2e0a   y-coordinates..
+00013720: 2020 2020 2020 2020 7a20 3a20 6e70 2e6e          z : np.n
+00013730: 6461 7272 6179 205b 6e32 2078 206e 315d  darray [n2 x n1]
+00013740: 0a20 2020 2020 2020 2020 2020 207a 2d63  .            z-c
+00013750: 6f6f 7264 696e 6174 6573 2e0a 2020 2020  oordinates..    
+00013760: 2020 2020 6d65 7368 5f75 203a 206e 702e      mesh_u : np.
+00013770: 6e64 6172 7261 7920 5b6e 3220 7820 6e31  ndarray [n2 x n1
+00013780: 5d0a 2020 2020 2020 2020 2020 2020 4469  ].            Di
+00013790: 7363 7265 7469 7a65 6420 7520 7261 6e67  scretized u rang
+000137a0: 652e 0a20 2020 2020 2020 206d 6573 685f  e..        mesh_
+000137b0: 7620 3a20 6e70 2e6e 6461 7272 6179 205b  v : np.ndarray [
+000137c0: 6e32 2078 206e 315d 0a20 2020 2020 2020  n2 x n1].       
+000137d0: 2020 2020 2044 6973 6372 6574 697a 6564       Discretized
+000137e0: 2076 2072 616e 6765 2e0a 2020 2020 2020   v range..      
+000137f0: 2020 2222 220a 2020 2020 2020 2020 6e70    """.        np
+00013800: 203d 2069 6d70 6f72 745f 6d6f 6475 6c65   = import_module
+00013810: 2827 6e75 6d70 7927 290a 0a20 2020 2020  ('numpy')..     
+00013820: 2020 2072 6573 756c 7473 203d 2073 656c     results = sel
+00013830: 662e 5f65 7661 6c75 6174 6528 290a 2020  f._evaluate().  
+00013840: 2020 2020 2020 666f 7220 692c 2072 2069        for i, r i
+00013850: 6e20 656e 756d 6572 6174 6528 7265 7375  n enumerate(resu
+00013860: 6c74 7329 3a0a 2020 2020 2020 2020 2020  lts):.          
+00013870: 2020 5f72 652c 205f 696d 203d 206e 702e    _re, _im = np.
+00013880: 7265 616c 2872 292c 206e 702e 696d 6167  real(r), np.imag
+00013890: 2872 290a 2020 2020 2020 2020 2020 2020  (r).            
+000138a0: 5f72 655b 6e70 2e69 6e76 6572 7428 6e70  _re[np.invert(np
+000138b0: 2e69 7363 6c6f 7365 285f 696d 2c20 6e70  .isclose(_im, np
+000138c0: 2e7a 6572 6f73 5f6c 696b 6528 5f69 6d29  .zeros_like(_im)
+000138d0: 2929 5d20 3d20 6e70 2e6e 616e 0a20 2020  ))] = np.nan.   
+000138e0: 2020 2020 2020 2020 2072 6573 756c 7473           results
+000138f0: 5b69 5d20 3d20 5f72 650a 0a20 2020 2020  [i] = _re..     
+00013900: 2020 2072 6574 7572 6e20 7365 6c66 2e5f     return self._
+00013910: 6170 706c 795f 7472 616e 7366 6f72 6d28  apply_transform(
+00013920: 2a72 6573 756c 7473 5b32 3a5d 2c20 2a72  *results[2:], *r
+00013930: 6573 756c 7473 5b3a 325d 290a 0a0a 636c  esults[:2])...cl
+00013940: 6173 7320 436f 6e74 6f75 7253 6572 6965  ass ContourSerie
+00013950: 7328 5375 7266 6163 654f 7665 7232 4452  s(SurfaceOver2DR
+00013960: 616e 6765 5365 7269 6573 293a 0a20 2020  angeSeries):.   
+00013970: 2022 2222 5265 7072 6573 656e 7461 7469   """Representati
+00013980: 6f6e 2066 6f72 2061 2063 6f6e 746f 7572  on for a contour
+00013990: 2070 6c6f 742e 2222 220a 0a20 2020 2069   plot."""..    i
+000139a0: 735f 3344 7375 7266 6163 6520 3d20 4661  s_3Dsurface = Fa
+000139b0: 6c73 650a 2020 2020 6973 5f63 6f6e 746f  lse.    is_conto
+000139c0: 7572 203d 2054 7275 650a 2020 2020 5f61  ur = True.    _a
+000139d0: 6c6c 6f77 6564 5f6b 6579 7320 3d20 5b0a  llowed_keys = [.
+000139e0: 2020 2020 2020 2020 2263 6f6e 746f 7572          "contour
+000139f0: 5f6b 7722 2c20 2269 735f 6669 6c6c 6564  _kw", "is_filled
+00013a00: 222c 2022 6669 6c6c 222c 2022 636c 6162  ", "fill", "clab
+00013a10: 656c 7322 5d0a 0a20 2020 2064 6566 205f  els"]..    def _
+00013a20: 5f69 6e69 745f 5f28 7365 6c66 2c20 2a61  _init__(self, *a
+00013a30: 7267 732c 202a 2a6b 7761 7267 7329 3a0a  rgs, **kwargs):.
+00013a40: 2020 2020 2020 2020 7375 7065 7228 292e          super().
+00013a50: 5f5f 696e 6974 5f5f 282a 6172 6773 2c20  __init__(*args, 
+00013a60: 2a2a 6b77 6172 6773 290a 2020 2020 2020  **kwargs).      
+00013a70: 2020 7365 6c66 2e69 735f 6669 6c6c 6564    self.is_filled
+00013a80: 203d 206b 7761 7267 732e 6765 7428 2269   = kwargs.get("i
+00013a90: 735f 6669 6c6c 6564 222c 206b 7761 7267  s_filled", kwarg
+00013aa0: 732e 6765 7428 2266 696c 6c22 2c20 5472  s.get("fill", Tr
+00013ab0: 7565 2929 0a20 2020 2020 2020 2073 656c  ue)).        sel
+00013ac0: 662e 7368 6f77 5f63 6c61 6265 6c73 203d  f.show_clabels =
+00013ad0: 206b 7761 7267 732e 6765 7428 2263 6c61   kwargs.get("cla
+00013ae0: 6265 6c73 222c 2054 7275 6529 0a20 2020  bels", True).   
+00013af0: 2020 2020 2073 656c 662e 7573 655f 636d       self.use_cm
+00013b00: 203d 2054 7275 650a 0a20 2020 2020 2020   = True..       
+00013b10: 2023 204e 4f54 453a 2063 6f6e 746f 7572   # NOTE: contour
+00013b20: 2070 6c6f 7473 2061 7265 2075 7365 6420   plots are used 
+00013b30: 6279 2070 6c6f 745f 636f 6e74 6f75 722c  by plot_contour,
+00013b40: 2070 6c6f 745f 7665 6374 6f72 2061 6e64   plot_vector and
+00013b50: 0a20 2020 2020 2020 2023 2070 6c6f 745f  .        # plot_
+00013b60: 636f 6d70 6c65 785f 7665 6374 6f72 2e20  complex_vector. 
+00013b70: 4279 2069 6d70 6c65 6d65 6e74 696e 6720  By implementing 
+00013b80: 636f 6e74 6f75 725f 6b77 2077 6520 6172  contour_kw we ar
+00013b90: 6520 6162 6c65 2074 6f0a 2020 2020 2020  e able to.      
+00013ba0: 2020 2320 7175 6963 6b6c 7920 7461 7267    # quickly targ
+00013bb0: 6574 2074 6865 2063 6f6e 746f 7572 2070  et the contour p
+00013bc0: 6c6f 742e 0a20 2020 2020 2020 2073 656c  lot..        sel
+00013bd0: 662e 7265 6e64 6572 696e 675f 6b77 203d  f.rendering_kw =
+00013be0: 206b 7761 7267 732e 6765 7428 0a20 2020   kwargs.get(.   
+00013bf0: 2020 2020 2020 2020 2022 636f 6e74 6f75           "contou
+00013c00: 725f 6b77 222c 206b 7761 7267 732e 6765  r_kw", kwargs.ge
+00013c10: 7428 2272 656e 6465 7269 6e67 5f6b 7722  t("rendering_kw"
+00013c20: 2c20 6469 6374 2829 2929 0a0a 0a63 6c61  , dict()))...cla
+00013c30: 7373 2049 6d70 6c69 6369 7453 6572 6965  ss ImplicitSerie
+00013c40: 7328 0a20 2020 2043 6f6d 6d6f 6e55 6e69  s(.    CommonUni
+00013c50: 666f 726d 4576 616c 7561 7469 6f6e 2c20  formEvaluation, 
+00013c60: 4261 7365 5365 7269 6573 0a29 3a0a 2020  BaseSeries.):.  
+00013c70: 2020 2222 2252 6570 7265 7365 6e74 6174    """Representat
+00013c80: 696f 6e20 666f 7220 496d 706c 6963 6974  ion for Implicit
+00013c90: 2070 6c6f 740a 0a20 2020 2052 6566 6572   plot..    Refer
+00013ca0: 656e 6365 730a 2020 2020 3d3d 3d3d 3d3d  ences.    ======
+00013cb0: 3d3d 3d3d 0a0a 2020 2020 2e2e 205b 315d  ====..    .. [1]
+00013cc0: 204a 6566 6672 6579 2041 6c6c 656e 2054   Jeffrey Allen T
+00013cd0: 7570 7065 722e 2052 656c 6961 626c 6520  upper. Reliable 
+00013ce0: 5477 6f2d 4469 6d65 6e73 696f 6e61 6c20  Two-Dimensional 
+00013cf0: 4772 6170 6869 6e67 204d 6574 686f 6473  Graphing Methods
+00013d00: 2066 6f72 0a20 2020 204d 6174 6865 6d61   for.    Mathema
+00013d10: 7469 6361 6c20 466f 726d 756c 6165 2077  tical Formulae w
+00013d20: 6974 6820 5477 6f20 4672 6565 2056 6172  ith Two Free Var
+00013d30: 6961 626c 6573 2e0a 0a20 2020 202e 2e20  iables...    .. 
+00013d40: 5b32 5d20 4a65 6666 7265 7920 416c 6c65  [2] Jeffrey Alle
+00013d50: 6e20 5475 7070 6572 2e20 4772 6170 6869  n Tupper. Graphi
+00013d60: 6e67 2045 7175 6174 696f 6e73 2077 6974  ng Equations wit
+00013d70: 6820 4765 6e65 7261 6c69 7a65 6420 496e  h Generalized In
+00013d80: 7465 7276 616c 0a20 2020 2041 7269 7468  terval.    Arith
+00013d90: 6d65 7469 632e 204d 6173 7465 7227 7320  metic. Master's 
+00013da0: 7468 6573 6973 2e20 556e 6976 6572 7369  thesis. Universi
+00013db0: 7479 206f 6620 546f 726f 6e74 6f2c 2031  ty of Toronto, 1
+00013dc0: 3939 360a 2020 2020 2222 220a 0a20 2020  996.    """..   
+00013dd0: 2069 735f 696d 706c 6963 6974 203d 2054   is_implicit = T
+00013de0: 7275 650a 2020 2020 7573 655f 636d 203d  rue.    use_cm =
+00013df0: 2046 616c 7365 0a20 2020 205f 616c 6c6f   False.    _allo
+00013e00: 7765 645f 6b65 7973 203d 205b 2261 6461  wed_keys = ["ada
+00013e10: 7074 6976 6522 2c20 2264 6570 7468 222c  ptive", "depth",
+00013e20: 2022 636f 6c6f 7222 5d0a 2020 2020 5f4e   "color"].    _N
+00013e30: 203d 2031 3030 0a0a 2020 2020 6465 6620   = 100..    def 
+00013e40: 5f5f 696e 6974 5f5f 2873 656c 662c 2065  __init__(self, e
+00013e50: 7870 722c 2076 6172 5f73 7461 7274 5f65  xpr, var_start_e
+00013e60: 6e64 5f78 2c20 7661 725f 7374 6172 745f  nd_x, var_start_
+00013e70: 656e 645f 792c 206c 6162 656c 3d22 222c  end_y, label="",
+00013e80: 202a 2a6b 7761 7267 7329 3a0a 2020 2020   **kwargs):.    
+00013e90: 2020 2020 7375 7065 7228 292e 5f5f 696e      super().__in
+00013ea0: 6974 5f5f 282a 2a6b 7761 7267 7329 0a20  it__(**kwargs). 
+00013eb0: 2020 2020 2020 2073 656c 662e 6164 6170         self.adap
+00013ec0: 7469 7665 203d 206b 7761 7267 732e 6765  tive = kwargs.ge
+00013ed0: 7428 2261 6461 7074 6976 6522 2c20 4661  t("adaptive", Fa
+00013ee0: 6c73 6529 0a20 2020 2020 2020 2073 656c  lse).        sel
+00013ef0: 662e 6578 7072 203d 2065 7870 720a 2020  f.expr = expr.  
+00013f00: 2020 2020 2020 7365 6c66 2e5f 6c61 6265        self._labe
+00013f10: 6c20 3d20 7374 7228 6578 7072 2920 6966  l = str(expr) if
+00013f20: 206c 6162 656c 2069 7320 4e6f 6e65 2065   label is None e
+00013f30: 6c73 6520 6c61 6265 6c0a 2020 2020 2020  lse label.      
+00013f40: 2020 7365 6c66 2e5f 6c61 7465 785f 6c61    self._latex_la
+00013f50: 6265 6c20 3d20 6c61 7465 7828 6578 7072  bel = latex(expr
+00013f60: 2920 6966 206c 6162 656c 2069 7320 4e6f  ) if label is No
+00013f70: 6e65 2065 6c73 6520 6c61 6265 6c0a 2020  ne else label.  
+00013f80: 2020 2020 2020 7365 6c66 2e72 616e 6765        self.range
+00013f90: 7320 3d20 5b76 6172 5f73 7461 7274 5f65  s = [var_start_e
+00013fa0: 6e64 5f78 2c20 7661 725f 7374 6172 745f  nd_x, var_start_
+00013fb0: 656e 645f 795d 0a20 2020 2020 2020 2073  end_y].        s
+00013fc0: 656c 662e 7661 725f 782c 2073 656c 662e  elf.var_x, self.
+00013fd0: 7374 6172 745f 782c 2073 656c 662e 656e  start_x, self.en
+00013fe0: 645f 7820 3d20 7365 6c66 2e72 616e 6765  d_x = self.range
+00013ff0: 735b 305d 0a20 2020 2020 2020 2073 656c  s[0].        sel
+00014000: 662e 7661 725f 792c 2073 656c 662e 7374  f.var_y, self.st
+00014010: 6172 745f 792c 2073 656c 662e 656e 645f  art_y, self.end_
+00014020: 7920 3d20 7365 6c66 2e72 616e 6765 735b  y = self.ranges[
+00014030: 315d 0a20 2020 2020 2020 2073 656c 662e  1].        self.
+00014040: 5f63 6f6c 6f72 203d 206b 7761 7267 732e  _color = kwargs.
+00014050: 6765 7428 2263 6f6c 6f72 222c 206b 7761  get("color", kwa
+00014060: 7267 732e 6765 7428 226c 696e 655f 636f  rgs.get("line_co
+00014070: 6c6f 7222 2c20 4e6f 6e65 2929 0a0a 2020  lor", None))..  
+00014080: 2020 2020 2020 6966 2073 656c 662e 6973        if self.is
+00014090: 5f69 6e74 6572 6163 7469 7665 2061 6e64  _interactive and
+000140a0: 2073 656c 662e 6164 6170 7469 7665 3a0a   self.adaptive:.
+000140b0: 2020 2020 2020 2020 2020 2020 7261 6973              rais
+000140c0: 6520 4e6f 7449 6d70 6c65 6d65 6e74 6564  e NotImplemented
+000140d0: 4572 726f 7228 2249 6e74 6572 6163 7469  Error("Interacti
+000140e0: 7665 2070 6c6f 7420 7769 7468 2060 6164  ve plot with `ad
+000140f0: 6170 7469 7665 3d54 7275 6560 2022 0a20  aptive=True` ". 
+00014100: 2020 2020 2020 2020 2020 2020 2020 2022                 "
+00014110: 6973 206e 6f74 2073 7570 706f 7274 6564  is not supported
+00014120: 2e22 290a 0a20 2020 2020 2020 2023 2043  .")..        # C
+00014130: 6865 636b 2077 6865 7468 6572 2074 6865  heck whether the
+00014140: 2064 6570 7468 2069 7320 6772 6561 7465   depth is greate
+00014150: 7220 7468 616e 2034 206f 7220 6c65 7373  r than 4 or less
+00014160: 2074 6861 6e20 302e 0a20 2020 2020 2020   than 0..       
+00014170: 2064 6570 7468 203d 206b 7761 7267 732e   depth = kwargs.
+00014180: 6765 7428 2264 6570 7468 222c 2030 290a  get("depth", 0).
+00014190: 2020 2020 2020 2020 6966 2064 6570 7468          if depth
+000141a0: 203e 2034 3a0a 2020 2020 2020 2020 2020   > 4:.          
+000141b0: 2020 6465 7074 6820 3d20 340a 2020 2020    depth = 4.    
+000141c0: 2020 2020 656c 6966 2064 6570 7468 203c      elif depth <
+000141d0: 2030 3a0a 2020 2020 2020 2020 2020 2020   0:.            
+000141e0: 6465 7074 6820 3d20 300a 2020 2020 2020  depth = 0.      
+000141f0: 2020 7365 6c66 2e64 6570 7468 203d 2034    self.depth = 4
+00014200: 202b 2064 6570 7468 0a20 2020 2020 2020   + depth.       
+00014210: 2073 656c 662e 5f70 6f73 745f 696e 6974   self._post_init
+00014220: 2829 0a0a 2020 2020 4070 726f 7065 7274  ()..    @propert
+00014230: 790a 2020 2020 6465 6620 6578 7072 2873  y.    def expr(s
+00014240: 656c 6629 3a0a 2020 2020 2020 2020 6966  elf):.        if
+00014250: 2073 656c 662e 6164 6170 7469 7665 3a0a   self.adaptive:.
+00014260: 2020 2020 2020 2020 2020 2020 7265 7475              retu
+00014270: 726e 2073 656c 662e 5f61 6461 7074 6976  rn self._adaptiv
+00014280: 655f 6578 7072 0a20 2020 2020 2020 2072  e_expr.        r
+00014290: 6574 7572 6e20 7365 6c66 2e5f 6e6f 6e5f  eturn self._non_
+000142a0: 6164 6170 7469 7665 5f65 7870 720a 0a20  adaptive_expr.. 
+000142b0: 2020 2040 6578 7072 2e73 6574 7465 720a     @expr.setter.
+000142c0: 2020 2020 6465 6620 6578 7072 2873 656c      def expr(sel
+000142d0: 662c 2065 7870 7229 3a0a 2020 2020 2020  f, expr):.      
+000142e0: 2020 7365 6c66 2e5f 626c 6f63 6b5f 6c61    self._block_la
+000142f0: 6d62 6461 5f66 756e 6374 696f 6e73 2865  mbda_functions(e
+00014300: 7870 7229 0a20 2020 2020 2020 2023 2074  xpr).        # t
+00014310: 6865 7365 2061 7265 206e 6565 6465 6420  hese are needed 
+00014320: 666f 7220 6164 6170 7469 7665 2065 7661  for adaptive eva
+00014330: 6c75 6174 696f 6e0a 2020 2020 2020 2020  luation.        
+00014340: 6578 7072 2c20 6861 735f 6571 7561 6c69  expr, has_equali
+00014350: 7479 203d 2073 656c 662e 5f68 6173 5f65  ty = self._has_e
+00014360: 7175 616c 6974 7928 7379 6d70 6966 7928  quality(sympify(
+00014370: 6578 7072 2929 0a20 2020 2020 2020 2073  expr)).        s
+00014380: 656c 662e 5f61 6461 7074 6976 655f 6578  elf._adaptive_ex
+00014390: 7072 203d 2065 7870 720a 2020 2020 2020  pr = expr.      
+000143a0: 2020 7365 6c66 2e68 6173 5f65 7175 616c    self.has_equal
+000143b0: 6974 7920 3d20 6861 735f 6571 7561 6c69  ity = has_equali
+000143c0: 7479 0a20 2020 2020 2020 2073 656c 662e  ty.        self.
+000143d0: 5f6c 6162 656c 203d 2073 7472 2865 7870  _label = str(exp
+000143e0: 7229 0a20 2020 2020 2020 2073 656c 662e  r).        self.
+000143f0: 5f6c 6174 6578 5f6c 6162 656c 203d 206c  _latex_label = l
+00014400: 6174 6578 2865 7870 7229 0a0a 2020 2020  atex(expr)..    
+00014410: 2020 2020 6966 2069 7369 6e73 7461 6e63      if isinstanc
+00014420: 6528 6578 7072 2c20 2842 6f6f 6c65 616e  e(expr, (Boolean
+00014430: 4675 6e63 7469 6f6e 2c20 4e65 2929 2061  Function, Ne)) a
+00014440: 6e64 2028 6e6f 7420 7365 6c66 2e61 6461  nd (not self.ada
+00014450: 7074 6976 6529 3a0a 2020 2020 2020 2020  ptive):.        
+00014460: 2020 2020 7365 6c66 2e61 6461 7074 6976      self.adaptiv
+00014470: 6520 3d20 5472 7565 0a20 2020 2020 2020  e = True.       
+00014480: 2020 2020 206d 7367 203d 2022 636f 6e74       msg = "cont
+00014490: 6169 6e73 2042 6f6f 6c65 616e 2066 756e  ains Boolean fun
+000144a0: 6374 696f 6e73 2e20 220a 2020 2020 2020  ctions. ".      
+000144b0: 2020 2020 2020 6966 2069 7369 6e73 7461        if isinsta
+000144c0: 6e63 6528 6578 7072 2c20 4e65 293a 0a20  nce(expr, Ne):. 
+000144d0: 2020 2020 2020 2020 2020 2020 2020 206d                 m
+000144e0: 7367 203d 2022 6973 2061 6e20 756e 6571  sg = "is an uneq
+000144f0: 7561 6c69 7479 2e20 220a 2020 2020 2020  uality. ".      
+00014500: 2020 2020 2020 7761 726e 696e 6773 2e77        warnings.w
+00014510: 6172 6e28 6622 5468 6520 7072 6f76 6964  arn(f"The provid
+00014520: 6564 2065 7870 7265 7373 696f 6e20 7b6d  ed expression {m
+00014530: 7367 7d22 0a20 2020 2020 2020 2020 2020  sg}".           
+00014540: 2020 2020 2022 496e 206f 7264 6572 2074       "In order t
+00014550: 6f20 706c 6f74 2074 6865 2065 7870 7265  o plot the expre
+00014560: 7373 696f 6e2c 2074 6865 2061 6c67 6f72  ssion, the algor
+00014570: 6974 686d 2022 0a20 2020 2020 2020 2020  ithm ".         
+00014580: 2020 2020 2020 2022 6175 746f 6d61 7469         "automati
+00014590: 6361 6c6c 7920 7377 6974 6368 6564 2074  cally switched t
+000145a0: 6f20 616e 2061 6461 7074 6976 6520 7361  o an adaptive sa
+000145b0: 6d70 6c69 6e67 2e22 2c0a 2020 2020 2020  mpling.",.      
+000145c0: 2020 2020 2020 2020 2020 7374 6163 6b6c            stackl
+000145d0: 6576 656c 3d31 290a 0a20 2020 2020 2020  evel=1)..       
+000145e0: 2069 6620 6973 696e 7374 616e 6365 2865   if isinstance(e
+000145f0: 7870 722c 2042 6f6f 6c65 616e 4675 6e63  xpr, BooleanFunc
+00014600: 7469 6f6e 293a 0a20 2020 2020 2020 2020  tion):.         
+00014610: 2020 2073 656c 662e 5f6e 6f6e 5f61 6461     self._non_ada
+00014620: 7074 6976 655f 6578 7072 203d 204e 6f6e  ptive_expr = Non
+00014630: 650a 2020 2020 2020 2020 2020 2020 7365  e.            se
+00014640: 6c66 2e5f 6973 5f65 7175 616c 6974 7920  lf._is_equality 
+00014650: 3d20 4661 6c73 650a 2020 2020 2020 2020  = False.        
+00014660: 656c 7365 3a0a 2020 2020 2020 2020 2020  else:.          
+00014670: 2020 2320 7468 6573 6520 6172 6520 6e65    # these are ne
+00014680: 6564 6564 2066 6f72 2075 6e69 666f 726d  eded for uniform
+00014690: 206d 6573 6869 6e67 2065 7661 6c75 6174   meshing evaluat
+000146a0: 696f 6e0a 2020 2020 2020 2020 2020 2020  ion.            
+000146b0: 6578 7072 2c20 6973 5f65 7175 616c 6974  expr, is_equalit
+000146c0: 7920 3d20 7365 6c66 2e5f 7072 6570 726f  y = self._prepro
+000146d0: 6365 7373 5f6d 6573 6867 7269 645f 6578  cess_meshgrid_ex
+000146e0: 7072 6573 7369 6f6e 280a 2020 2020 2020  pression(.      
+000146f0: 2020 2020 2020 2020 2020 6578 7072 2c20            expr, 
+00014700: 7365 6c66 2e61 6461 7074 6976 6529 0a20  self.adaptive). 
+00014710: 2020 2020 2020 2020 2020 2073 656c 662e             self.
+00014720: 5f6e 6f6e 5f61 6461 7074 6976 655f 6578  _non_adaptive_ex
+00014730: 7072 203d 2065 7870 720a 2020 2020 2020  pr = expr.      
+00014740: 2020 2020 2020 7365 6c66 2e5f 6973 5f65        self._is_e
+00014750: 7175 616c 6974 7920 3d20 6973 5f65 7175  quality = is_equ
+00014760: 616c 6974 790a 0a20 2020 2040 7072 6f70  ality..    @prop
+00014770: 6572 7479 0a20 2020 2064 6566 206c 696e  erty.    def lin
+00014780: 655f 636f 6c6f 7228 7365 6c66 293a 0a20  e_color(self):. 
+00014790: 2020 2020 2020 2072 6574 7572 6e20 7365         return se
+000147a0: 6c66 2e5f 636f 6c6f 720a 0a20 2020 2040  lf._color..    @
+000147b0: 6c69 6e65 5f63 6f6c 6f72 2e73 6574 7465  line_color.sette
+000147c0: 720a 2020 2020 6465 6620 6c69 6e65 5f63  r.    def line_c
+000147d0: 6f6c 6f72 2873 656c 662c 2076 293a 0a20  olor(self, v):. 
+000147e0: 2020 2020 2020 2073 656c 662e 5f63 6f6c         self._col
+000147f0: 6f72 203d 2076 0a0a 2020 2020 636f 6c6f  or = v..    colo
+00014800: 7220 3d20 6c69 6e65 5f63 6f6c 6f72 0a0a  r = line_color..
+00014810: 2020 2020 6465 6620 5f68 6173 5f65 7175      def _has_equ
+00014820: 616c 6974 7928 7365 6c66 2c20 6578 7072  ality(self, expr
+00014830: 293a 0a20 2020 2020 2020 2023 2052 6570  ):.        # Rep
+00014840: 7265 7365 6e74 7320 7768 6574 6865 7220  resents whether 
+00014850: 7468 6520 6578 7072 6573 7369 6f6e 2063  the expression c
+00014860: 6f6e 7461 696e 7320 616e 2045 7175 616c  ontains an Equal
+00014870: 6974 792c 2047 7265 6174 6572 5468 616e  ity, GreaterThan
+00014880: 0a20 2020 2020 2020 2023 206f 7220 4c65  .        # or Le
+00014890: 7373 5468 616e 0a20 2020 2020 2020 2068  ssThan.        h
+000148a0: 6173 5f65 7175 616c 6974 7920 3d20 4661  as_equality = Fa
+000148b0: 6c73 650a 0a20 2020 2020 2020 2064 6566  lse..        def
+000148c0: 2061 7267 5f65 7870 616e 6428 626f 6f6c   arg_expand(bool
+000148d0: 5f65 7870 7229 3a0a 2020 2020 2020 2020  _expr):.        
+000148e0: 2020 2020 2222 2252 6563 7572 7369 7665      """Recursive
+000148f0: 6c79 2065 7870 616e 6473 2074 6865 2061  ly expands the a
+00014900: 7267 756d 656e 7473 206f 6620 616e 2042  rguments of an B
+00014910: 6f6f 6c65 616e 2046 756e 6374 696f 6e22  oolean Function"
+00014920: 2222 0a20 2020 2020 2020 2020 2020 2066  "".            f
+00014930: 6f72 2061 7267 2069 6e20 626f 6f6c 5f65  or arg in bool_e
+00014940: 7870 722e 6172 6773 3a0a 2020 2020 2020  xpr.args:.      
+00014950: 2020 2020 2020 2020 2020 6966 2069 7369            if isi
+00014960: 6e73 7461 6e63 6528 6172 672c 2042 6f6f  nstance(arg, Boo
+00014970: 6c65 616e 4675 6e63 7469 6f6e 293a 0a20  leanFunction):. 
+00014980: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00014990: 2020 2061 7267 5f65 7870 616e 6428 6172     arg_expand(ar
+000149a0: 6729 0a20 2020 2020 2020 2020 2020 2020  g).             
+000149b0: 2020 2065 6c69 6620 6973 696e 7374 616e     elif isinstan
+000149c0: 6365 2861 7267 2c20 5265 6c61 7469 6f6e  ce(arg, Relation
+000149d0: 616c 293a 0a20 2020 2020 2020 2020 2020  al):.           
+000149e0: 2020 2020 2020 2020 2061 7267 5f6c 6973           arg_lis
+000149f0: 742e 6170 7065 6e64 2861 7267 290a 0a20  t.append(arg).. 
+00014a00: 2020 2020 2020 2061 7267 5f6c 6973 7420         arg_list 
+00014a10: 3d20 5b5d 0a20 2020 2020 2020 2069 6620  = [].        if 
+00014a20: 6973 696e 7374 616e 6365 2865 7870 722c  isinstance(expr,
+00014a30: 2042 6f6f 6c65 616e 4675 6e63 7469 6f6e   BooleanFunction
+00014a40: 293a 0a20 2020 2020 2020 2020 2020 2061  ):.            a
+00014a50: 7267 5f65 7870 616e 6428 6578 7072 290a  rg_expand(expr).
+00014a60: 2020 2020 2020 2020 2020 2020 2320 4368              # Ch
+00014a70: 6563 6b20 7768 6574 6865 7220 7468 6572  eck whether ther
+00014a80: 6520 6973 2061 6e20 6571 7561 6c69 7479  e is an equality
+00014a90: 2069 6e20 7468 6520 6578 7072 6573 7369   in the expressi
+00014aa0: 6f6e 2070 726f 7669 6465 642e 0a20 2020  on provided..   
+00014ab0: 2020 2020 2020 2020 2069 6620 616e 7928           if any(
+00014ac0: 6973 696e 7374 616e 6365 2865 2c20 2845  isinstance(e, (E
+00014ad0: 7175 616c 6974 792c 2047 7265 6174 6572  quality, Greater
+00014ae0: 5468 616e 2c20 4c65 7373 5468 616e 2929  Than, LessThan))
+00014af0: 2066 6f72 2065 2069 6e20 6172 675f 6c69   for e in arg_li
+00014b00: 7374 293a 0a20 2020 2020 2020 2020 2020  st):.           
+00014b10: 2020 2020 2068 6173 5f65 7175 616c 6974       has_equalit
+00014b20: 7920 3d20 5472 7565 0a20 2020 2020 2020  y = True.       
+00014b30: 2065 6c69 6620 6e6f 7420 6973 696e 7374   elif not isinst
+00014b40: 616e 6365 2865 7870 722c 2052 656c 6174  ance(expr, Relat
+00014b50: 696f 6e61 6c29 3a0a 2020 2020 2020 2020  ional):.        
+00014b60: 2020 2020 6578 7072 203d 2045 7175 616c      expr = Equal
+00014b70: 6974 7928 6578 7072 2c20 3029 0a20 2020  ity(expr, 0).   
+00014b80: 2020 2020 2020 2020 2068 6173 5f65 7175           has_equ
+00014b90: 616c 6974 7920 3d20 5472 7565 0a20 2020  ality = True.   
+00014ba0: 2020 2020 2065 6c69 6620 6973 696e 7374       elif isinst
+00014bb0: 616e 6365 2865 7870 722c 2028 4571 7561  ance(expr, (Equa
+00014bc0: 6c69 7479 2c20 4772 6561 7465 7254 6861  lity, GreaterTha
+00014bd0: 6e2c 204c 6573 7354 6861 6e29 293a 0a20  n, LessThan)):. 
+00014be0: 2020 2020 2020 2020 2020 2068 6173 5f65             has_e
+00014bf0: 7175 616c 6974 7920 3d20 5472 7565 0a0a  quality = True..
+00014c00: 2020 2020 2020 2020 7265 7475 726e 2065          return e
+00014c10: 7870 722c 2068 6173 5f65 7175 616c 6974  xpr, has_equalit
+00014c20: 790a 0a20 2020 2064 6566 205f 5f73 7472  y..    def __str
+00014c30: 5f5f 2873 656c 6629 3a0a 2020 2020 2020  __(self):.      
+00014c40: 2020 6620 3d20 6c61 6d62 6461 2074 3a20    f = lambda t: 
+00014c50: 666c 6f61 7428 7429 2069 6620 6c65 6e28  float(t) if len(
+00014c60: 742e 6672 6565 5f73 796d 626f 6c73 2920  t.free_symbols) 
+00014c70: 3d3d 2030 2065 6c73 6520 740a 0a20 2020  == 0 else t..   
+00014c80: 2020 2020 2072 6574 7572 6e20 7365 6c66       return self
+00014c90: 2e5f 7374 725f 6865 6c70 6572 280a 2020  ._str_helper(.  
+00014ca0: 2020 2020 2020 2020 2020 2249 6d70 6c69            "Impli
+00014cb0: 6369 7420 6578 7072 6573 7369 6f6e 3a20  cit expression: 
+00014cc0: 2573 2066 6f72 2025 7320 6f76 6572 2025  %s for %s over %
+00014cd0: 7320 616e 6420 2573 206f 7665 7220 2573  s and %s over %s
+00014ce0: 2229 2025 2028 0a20 2020 2020 2020 2020  ") % (.         
+00014cf0: 2020 2073 7472 2873 656c 662e 5f61 6461     str(self._ada
+00014d00: 7074 6976 655f 6578 7072 292c 0a20 2020  ptive_expr),.   
+00014d10: 2020 2020 2020 2020 2073 7472 2873 656c           str(sel
+00014d20: 662e 7661 725f 7829 2c0a 2020 2020 2020  f.var_x),.      
+00014d30: 2020 2020 2020 7374 7228 2866 2873 656c        str((f(sel
+00014d40: 662e 7374 6172 745f 7829 2c20 6628 7365  f.start_x), f(se
+00014d50: 6c66 2e65 6e64 5f78 2929 292c 0a20 2020  lf.end_x))),.   
+00014d60: 2020 2020 2020 2020 2073 7472 2873 656c           str(sel
+00014d70: 662e 7661 725f 7929 2c0a 2020 2020 2020  f.var_y),.      
+00014d80: 2020 2020 2020 7374 7228 2866 2873 656c        str((f(sel
+00014d90: 662e 7374 6172 745f 7929 2c20 6628 7365  f.start_y), f(se
+00014da0: 6c66 2e65 6e64 5f79 2929 292c 0a20 2020  lf.end_y))),.   
+00014db0: 2020 2020 2029 0a0a 2020 2020 6465 6620       )..    def 
+00014dc0: 6765 745f 6461 7461 2873 656c 6629 3a0a  get_data(self):.
+00014dd0: 2020 2020 2020 2020 2222 2252 6574 7572          """Retur
+00014de0: 6e73 206e 756d 6572 6963 616c 2064 6174  ns numerical dat
+00014df0: 612e 0a0a 2020 2020 2020 2020 5265 7475  a...        Retu
+00014e00: 726e 730a 2020 2020 2020 2020 3d3d 3d3d  rns.        ====
+00014e10: 3d3d 3d0a 0a20 2020 2020 2020 2049 6620  ===..        If 
+00014e20: 7468 6520 7365 7269 6573 2069 7320 6576  the series is ev
+00014e30: 616c 7561 7465 6420 7769 7468 2074 6865  aluated with the
+00014e40: 2060 6164 6170 7469 7665 3d54 7275 6560   `adaptive=True`
+00014e50: 2069 7420 7265 7475 726e 733a 0a0a 2020   it returns:..  
+00014e60: 2020 2020 2020 696e 7465 7276 616c 5f6c        interval_l
+00014e70: 6973 7420 3a20 6c69 7374 0a20 2020 2020  ist : list.     
+00014e80: 2020 2020 2020 204c 6973 7420 6f66 2062         List of b
+00014e90: 6f75 6e64 696e 6720 7265 6374 616e 6775  ounding rectangu
+00014ea0: 6c61 7220 696e 7465 7276 616c 7320 746f  lar intervals to
+00014eb0: 2062 6520 706f 7374 7072 6f63 6573 7365   be postprocesse
+00014ec0: 6420 616e 640a 2020 2020 2020 2020 2020  d and.          
+00014ed0: 2020 6576 656e 7475 616c 6c79 2075 7365    eventually use
+00014ee0: 6420 7769 7468 204d 6174 706c 6f74 6c69  d with Matplotli
+00014ef0: 6227 7320 6060 6669 6c6c 6060 2063 6f6d  b's ``fill`` com
+00014f00: 6d61 6e64 2e0a 2020 2020 2020 2020 6475  mand..        du
+00014f10: 6d6d 7920 3a20 7374 720a 2020 2020 2020  mmy : str.      
+00014f20: 2020 2020 2020 4120 7374 7269 6e67 2063        A string c
+00014f30: 6f6e 7461 696e 696e 6720 6060 2266 696c  ontaining ``"fil
+00014f40: 6c22 6060 2e0a 0a20 2020 2020 2020 204f  l"``...        O
+00014f50: 7468 6572 7769 7365 2c20 6974 2072 6574  therwise, it ret
+00014f60: 7572 6e73 2032 4420 6e75 6d70 7920 6172  urns 2D numpy ar
+00014f70: 7261 7973 2074 6f20 6265 2075 7365 6420  rays to be used 
+00014f80: 7769 7468 204d 6174 706c 6f74 6c69 6227  with Matplotlib'
+00014f90: 730a 2020 2020 2020 2020 6060 636f 6e74  s.        ``cont
+00014fa0: 6f75 7260 6020 6f72 2060 6063 6f6e 746f  our`` or ``conto
+00014fb0: 7572 6660 6020 636f 6d6d 616e 6473 3a0a  urf`` commands:.
+00014fc0: 0a20 2020 2020 2020 2078 5f61 7272 6179  .        x_array
+00014fd0: 203a 206e 702e 6e64 6172 7261 790a 2020   : np.ndarray.  
+00014fe0: 2020 2020 2020 795f 6172 7261 7920 3a20        y_array : 
+00014ff0: 6e70 2e6e 6461 7272 6179 0a20 2020 2020  np.ndarray.     
+00015000: 2020 207a 5f61 7272 6179 203a 206e 702e     z_array : np.
+00015010: 6e64 6172 7261 790a 2020 2020 2020 2020  ndarray.        
+00015020: 706c 6f74 5f74 7970 6520 3a20 7374 720a  plot_type : str.
+00015030: 2020 2020 2020 2020 2020 2020 4120 7374              A st
+00015040: 7269 6e67 2073 7065 6369 6679 696e 6720  ring specifying 
+00015050: 7768 6963 6820 706c 6f74 2063 6f6d 6d61  which plot comma
+00015060: 6e64 2074 6f20 7573 652c 2060 6022 636f  nd to use, ``"co
+00015070: 6e74 6f75 7222 6060 0a20 2020 2020 2020  ntour"``.       
+00015080: 2020 2020 206f 7220 6060 2263 6f6e 746f       or ``"conto
+00015090: 7572 6622 6060 2e0a 2020 2020 2020 2020  urf"``..        
+000150a0: 2222 220a 2020 2020 2020 2020 6966 2073  """.        if s
+000150b0: 656c 662e 6164 6170 7469 7665 3a0a 2020  elf.adaptive:.  
+000150c0: 2020 2020 2020 2020 2020 6461 7461 203d            data =
+000150d0: 2073 656c 662e 5f61 6461 7074 6976 655f   self._adaptive_
+000150e0: 6576 616c 2829 0a20 2020 2020 2020 2020  eval().         
+000150f0: 2020 2069 6620 6461 7461 2069 7320 6e6f     if data is no
+00015100: 7420 4e6f 6e65 3a0a 2020 2020 2020 2020  t None:.        
+00015110: 2020 2020 2020 2020 7265 7475 726e 2064          return d
+00015120: 6174 610a 2020 2020 2020 2020 7265 7475  ata.        retu
+00015130: 726e 2073 656c 662e 5f67 6574 5f6d 6573  rn self._get_mes
+00015140: 6865 735f 6772 6964 2829 0a0a 2020 2020  hes_grid()..    
+00015150: 6465 6620 5f61 6461 7074 6976 655f 6576  def _adaptive_ev
+00015160: 616c 2873 656c 6629 3a0a 2020 2020 2020  al(self):.      
+00015170: 2020 696d 706f 7274 2073 796d 7079 2e70    import sympy.p
+00015180: 6c6f 7474 696e 672e 696e 7465 7276 616c  lotting.interval
+00015190: 6d61 7468 2e6c 6962 5f69 6e74 6572 7661  math.lib_interva
+000151a0: 6c20 6173 206c 690a 0a20 2020 2020 2020  l as li..       
+000151b0: 2075 7365 725f 6675 6e63 7469 6f6e 7320   user_functions 
+000151c0: 3d20 7b7d 0a20 2020 2020 2020 2070 7269  = {}.        pri
+000151d0: 6e74 6572 203d 2049 6e74 6572 7661 6c4d  nter = IntervalM
+000151e0: 6174 6850 7269 6e74 6572 287b 0a20 2020  athPrinter({.   
+000151f0: 2020 2020 2020 2020 2027 6675 6c6c 795f           'fully_
+00015200: 7175 616c 6966 6965 645f 6d6f 6475 6c65  qualified_module
+00015210: 7327 3a20 4661 6c73 652c 2027 696e 6c69  s': False, 'inli
+00015220: 6e65 273a 2054 7275 652c 0a20 2020 2020  ne': True,.     
+00015230: 2020 2020 2020 2027 616c 6c6f 775f 756e         'allow_un
+00015240: 6b6e 6f77 6e5f 6675 6e63 7469 6f6e 7327  known_functions'
+00015250: 3a20 5472 7565 2c0a 2020 2020 2020 2020  : True,.        
+00015260: 2020 2020 2775 7365 725f 6675 6e63 7469      'user_functi
+00015270: 6f6e 7327 3a20 7573 6572 5f66 756e 6374  ons': user_funct
+00015280: 696f 6e73 7d29 0a0a 2020 2020 2020 2020  ions})..        
+00015290: 6b65 7973 203d 205b 7420 666f 7220 7420  keys = [t for t 
+000152a0: 696e 2064 6972 286c 6929 2069 6620 2822  in dir(li) if ("
+000152b0: 5f5f 2220 6e6f 7420 696e 2074 2920 616e  __" not in t) an
+000152c0: 6420 2874 206e 6f74 2069 6e20 5b22 696d  d (t not in ["im
+000152d0: 706f 7274 5f6d 6f64 756c 6522 2c20 2269  port_module", "i
+000152e0: 6e74 6572 7661 6c22 5d29 5d0a 2020 2020  nterval"])].    
+000152f0: 2020 2020 7661 6c73 203d 205b 6765 7461      vals = [geta
+00015300: 7474 7228 6c69 2c20 6b29 2066 6f72 206b  ttr(li, k) for k
+00015310: 2069 6e20 6b65 7973 5d0a 2020 2020 2020   in keys].      
+00015320: 2020 6420 3d20 7b6b 3a20 7620 666f 7220    d = {k: v for 
+00015330: 6b2c 2076 2069 6e20 7a69 7028 6b65 7973  k, v in zip(keys
+00015340: 2c20 7661 6c73 297d 0a20 2020 2020 2020  , vals)}.       
+00015350: 2066 756e 6320 3d20 6c61 6d62 6469 6679   func = lambdify
+00015360: 2828 7365 6c66 2e76 6172 5f78 2c20 7365  ((self.var_x, se
+00015370: 6c66 2e76 6172 5f79 292c 2073 656c 662e  lf.var_y), self.
+00015380: 6578 7072 2c20 6d6f 6475 6c65 733d 5b64  expr, modules=[d
+00015390: 5d2c 2070 7269 6e74 6572 3d70 7269 6e74  ], printer=print
+000153a0: 6572 290a 2020 2020 2020 2020 6461 7461  er).        data
+000153b0: 203d 204e 6f6e 650a 0a20 2020 2020 2020   = None..       
+000153c0: 2074 7279 3a0a 2020 2020 2020 2020 2020   try:.          
+000153d0: 2020 6461 7461 203d 2073 656c 662e 5f67    data = self._g
+000153e0: 6574 5f72 6173 7465 725f 696e 7465 7276  et_raster_interv
+000153f0: 616c 2866 756e 6329 0a20 2020 2020 2020  al(func).       
+00015400: 2065 7863 6570 7420 4e61 6d65 4572 726f   except NameErro
+00015410: 7220 6173 2065 7272 3a0a 2020 2020 2020  r as err:.      
+00015420: 2020 2020 2020 7761 726e 696e 6773 2e77        warnings.w
+00015430: 6172 6e28 0a20 2020 2020 2020 2020 2020  arn(.           
+00015440: 2020 2020 2022 4164 6170 7469 7665 206d       "Adaptive m
+00015450: 6573 6869 6e67 2063 6f75 6c64 206e 6f74  eshing could not
+00015460: 2062 6520 6170 706c 6965 6420 746f 2074   be applied to t
+00015470: 6865 220a 2020 2020 2020 2020 2020 2020  he".            
+00015480: 2020 2020 2220 6578 7072 6573 7369 6f6e      " expression
+00015490: 2c20 6173 2073 6f6d 6520 6675 6e63 7469  , as some functi
+000154a0: 6f6e 7320 6172 6520 6e6f 7420 7965 7420  ons are not yet 
+000154b0: 696d 706c 656d 656e 7465 6422 0a20 2020  implemented".   
+000154c0: 2020 2020 2020 2020 2020 2020 2022 2069               " i
+000154d0: 6e20 7468 6520 696e 7465 7276 616c 206d  n the interval m
+000154e0: 6174 6820 6d6f 6475 6c65 3a5c 6e5c 6e22  ath module:\n\n"
+000154f0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00015500: 2022 4e61 6d65 4572 726f 723a 2025 735c   "NameError: %s\
+00015510: 6e5c 6e22 2025 2065 7272 202b 0a20 2020  n\n" % err +.   
+00015520: 2020 2020 2020 2020 2020 2020 2022 5072               "Pr
+00015530: 6f63 6565 6469 6e67 2077 6974 6820 756e  oceeding with un
+00015540: 6966 6f72 6d20 6d65 7368 696e 672e 220a  iform meshing.".
+00015550: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00015560: 290a 2020 2020 2020 2020 2020 2020 7365  ).            se
+00015570: 6c66 2e61 6461 7074 6976 6520 3d20 4661  lf.adaptive = Fa
+00015580: 6c73 650a 2020 2020 2020 2020 6578 6365  lse.        exce
+00015590: 7074 2028 4174 7472 6962 7574 6545 7272  pt (AttributeErr
+000155a0: 6f72 2c20 5479 7065 4572 726f 7229 3a0a  or, TypeError):.
+000155b0: 2020 2020 2020 2020 2020 2020 2320 5858              # XX
+000155c0: 583a 2041 7474 7269 6275 7465 4572 726f  X: AttributeErro
+000155d0: 7228 2227 6c69 7374 2720 6f62 6a65 6374  r("'list' object
+000155e0: 2068 6173 206e 6f20 6174 7472 6962 7574   has no attribut
+000155f0: 6520 2769 735f 7265 616c 2722 290a 2020  e 'is_real'").  
+00015600: 2020 2020 2020 2020 2020 2320 5468 6174            # That
+00015610: 206e 6565 6473 2066 6978 696e 6720 736f   needs fixing so
+00015620: 6d65 686f 7720 2d20 7765 2073 686f 756c  mehow - we shoul
+00015630: 646e 2774 2062 6520 6361 7463 6869 6e67  dn't be catching
+00015640: 0a20 2020 2020 2020 2020 2020 2023 2041  .            # A
+00015650: 7474 7269 6275 7465 4572 726f 7220 6865  ttributeError he
+00015660: 7265 2e0a 2020 2020 2020 2020 2020 2020  re..            
+00015670: 7761 726e 696e 6773 2e77 6172 6e28 0a20  warnings.warn(. 
+00015680: 2020 2020 2020 2020 2020 2020 2020 2022                 "
+00015690: 4164 6170 7469 7665 206d 6573 6869 6e67  Adaptive meshing
+000156a0: 2063 6f75 6c64 206e 6f74 2062 6520 6170   could not be ap
+000156b0: 706c 6965 6420 746f 2074 6865 220a 2020  plied to the".  
+000156c0: 2020 2020 2020 2020 2020 2020 2020 2220                " 
+000156d0: 6578 7072 6573 7369 6f6e 2e20 5573 696e  expression. Usin
+000156e0: 6720 756e 6966 6f72 6d20 6d65 7368 696e  g uniform meshin
+000156f0: 672e 2229 0a20 2020 2020 2020 2020 2020  g.").           
+00015700: 2073 656c 662e 6164 6170 7469 7665 203d   self.adaptive =
+00015710: 2046 616c 7365 0a0a 2020 2020 2020 2020   False..        
+00015720: 7265 7475 726e 2064 6174 610a 0a20 2020  return data..   
+00015730: 2064 6566 205f 6765 745f 7261 7374 6572   def _get_raster
+00015740: 5f69 6e74 6572 7661 6c28 7365 6c66 2c20  _interval(self, 
+00015750: 6675 6e63 293a 0a20 2020 2020 2020 2022  func):.        "
+00015760: 2222 5573 6573 2069 6e74 6572 7661 6c20  ""Uses interval 
+00015770: 6d61 7468 2074 6f20 6164 6170 7469 7665  math to adaptive
+00015780: 6c79 206d 6573 6820 616e 6420 6f62 7461  ly mesh and obta
+00015790: 696e 2074 6865 2070 6c6f 7422 2222 0a20  in the plot""". 
+000157a0: 2020 2020 2020 206e 7020 3d20 696d 706f         np = impo
+000157b0: 7274 5f6d 6f64 756c 6528 276e 756d 7079  rt_module('numpy
+000157c0: 2729 0a0a 2020 2020 2020 2020 6b20 3d20  ')..        k = 
+000157d0: 7365 6c66 2e64 6570 7468 0a20 2020 2020  self.depth.     
+000157e0: 2020 2069 6e74 6572 7661 6c5f 6c69 7374     interval_list
+000157f0: 203d 205b 5d0a 2020 2020 2020 2020 7378   = [].        sx
+00015800: 2c20 7379 203d 205b 666c 6f61 7428 7429  , sy = [float(t)
+00015810: 2066 6f72 2074 2069 6e20 5b73 656c 662e   for t in [self.
+00015820: 7374 6172 745f 782c 2073 656c 662e 7374  start_x, self.st
+00015830: 6172 745f 795d 5d0a 2020 2020 2020 2020  art_y]].        
+00015840: 6578 2c20 6579 203d 205b 666c 6f61 7428  ex, ey = [float(
+00015850: 7429 2066 6f72 2074 2069 6e20 5b73 656c  t) for t in [sel
+00015860: 662e 656e 645f 782c 2073 656c 662e 656e  f.end_x, self.en
+00015870: 645f 795d 5d0a 2020 2020 2020 2020 2320  d_y]].        # 
+00015880: 4372 6561 7465 2069 6e69 7469 616c 2033  Create initial 3
+00015890: 3220 6469 7669 7369 6f6e 730a 2020 2020  2 divisions.    
+000158a0: 2020 2020 7873 616d 706c 6520 3d20 6e70      xsample = np
+000158b0: 2e6c 696e 7370 6163 6528 7378 2c20 6578  .linspace(sx, ex
+000158c0: 2c20 3333 290a 2020 2020 2020 2020 7973  , 33).        ys
+000158d0: 616d 706c 6520 3d20 6e70 2e6c 696e 7370  ample = np.linsp
+000158e0: 6163 6528 7379 2c20 6579 2c20 3333 290a  ace(sy, ey, 33).
+000158f0: 0a20 2020 2020 2020 2023 2041 6464 2061  .        # Add a
+00015900: 2073 6d61 6c6c 206a 6974 7465 7220 736f   small jitter so
+00015910: 2074 6861 7420 7468 6572 6520 6172 6520   that there are 
+00015920: 6e6f 2066 616c 7365 2070 6f73 6974 6976  no false positiv
+00015930: 6573 2066 6f72 2065 7175 616c 6974 792e  es for equality.
+00015940: 0a20 2020 2020 2020 2023 2045 783a 2079  .        # Ex: y
+00015950: 3d3d 7820 6265 636f 6d65 7320 5472 7565  ==x becomes True
+00015960: 2066 6f72 2078 2069 6e74 6572 7661 6c28   for x interval(
+00015970: 312c 2032 2920 616e 6420 7920 696e 7465  1, 2) and y inte
+00015980: 7276 616c 2831 2c20 3229 0a20 2020 2020  rval(1, 2).     
+00015990: 2020 2023 2077 6869 6368 2077 696c 6c20     # which will 
+000159a0: 6472 6177 2061 2072 6563 7461 6e67 6c65  draw a rectangle
+000159b0: 2e0a 2020 2020 2020 2020 6a69 7474 6572  ..        jitter
+000159c0: 7820 3d20 280a 2020 2020 2020 2020 2020  x = (.          
+000159d0: 2020 286e 702e 7261 6e64 6f6d 2e72 616e    (np.random.ran
+000159e0: 6428 6c65 6e28 7873 616d 706c 6529 2920  d(len(xsample)) 
+000159f0: 2a20 3220 2d20 3129 0a20 2020 2020 2020  * 2 - 1).       
+00015a00: 2020 2020 202a 2028 6578 202d 2073 7829       * (ex - sx)
+00015a10: 0a20 2020 2020 2020 2020 2020 202f 2032  .            / 2
+00015a20: 202a 2a20 3230 0a20 2020 2020 2020 2029   ** 20.        )
+00015a30: 0a20 2020 2020 2020 206a 6974 7465 7279  .        jittery
+00015a40: 203d 2028 0a20 2020 2020 2020 2020 2020   = (.           
+00015a50: 2028 6e70 2e72 616e 646f 6d2e 7261 6e64   (np.random.rand
+00015a60: 286c 656e 2879 7361 6d70 6c65 2929 202a  (len(ysample)) *
+00015a70: 2032 202d 2031 290a 2020 2020 2020 2020   2 - 1).        
+00015a80: 2020 2020 2a20 2865 7920 2d20 7379 290a      * (ey - sy).
+00015a90: 2020 2020 2020 2020 2020 2020 2f20 3220              / 2 
+00015aa0: 2a2a 2032 300a 2020 2020 2020 2020 290a  ** 20.        ).
+00015ab0: 2020 2020 2020 2020 7873 616d 706c 6520          xsample 
+00015ac0: 2b3d 206a 6974 7465 7278 0a20 2020 2020  += jitterx.     
+00015ad0: 2020 2079 7361 6d70 6c65 202b 3d20 6a69     ysample += ji
+00015ae0: 7474 6572 790a 0a20 2020 2020 2020 2078  ttery..        x
+00015af0: 696e 7465 7220 3d20 5b69 6e74 6572 7661  inter = [interva
+00015b00: 6c28 7831 2c20 7832 2920 666f 7220 7831  l(x1, x2) for x1
+00015b10: 2c20 7832 2069 6e20 7a69 7028 7873 616d  , x2 in zip(xsam
+00015b20: 706c 655b 3a2d 315d 2c20 7873 616d 706c  ple[:-1], xsampl
+00015b30: 655b 313a 5d29 5d0a 2020 2020 2020 2020  e[1:])].        
+00015b40: 7969 6e74 6572 203d 205b 696e 7465 7276  yinter = [interv
+00015b50: 616c 2879 312c 2079 3229 2066 6f72 2079  al(y1, y2) for y
+00015b60: 312c 2079 3220 696e 207a 6970 2879 7361  1, y2 in zip(ysa
+00015b70: 6d70 6c65 5b3a 2d31 5d2c 2079 7361 6d70  mple[:-1], ysamp
+00015b80: 6c65 5b31 3a5d 295d 0a20 2020 2020 2020  le[1:])].       
+00015b90: 2069 6e74 6572 7661 6c5f 6c69 7374 203d   interval_list =
+00015ba0: 205b 5b78 2c20 795d 2066 6f72 2078 2069   [[x, y] for x i
+00015bb0: 6e20 7869 6e74 6572 2066 6f72 2079 2069  n xinter for y i
+00015bc0: 6e20 7969 6e74 6572 5d0a 2020 2020 2020  n yinter].      
+00015bd0: 2020 706c 6f74 5f6c 6973 7420 3d20 5b5d    plot_list = []
+00015be0: 0a0a 2020 2020 2020 2020 2320 7265 6375  ..        # recu
+00015bf0: 7273 6976 6520 6361 6c6c 2072 6566 696e  rsive call refin
+00015c00: 6570 6978 656c 7320 7768 6963 6820 7375  epixels which su
+00015c10: 6264 6976 6964 6573 2074 6865 2069 6e74  bdivides the int
+00015c20: 6572 7661 6c73 2077 6869 6368 2061 7265  ervals which are
+00015c30: 0a20 2020 2020 2020 2023 206e 6569 7468  .        # neith
+00015c40: 6572 2054 7275 6520 6e6f 7220 4661 6c73  er True nor Fals
+00015c50: 6520 6163 636f 7264 696e 6720 746f 2074  e according to t
+00015c60: 6865 2065 7870 7265 7373 696f 6e2e 0a20  he expression.. 
+00015c70: 2020 2020 2020 2064 6566 2072 6566 696e         def refin
+00015c80: 655f 7069 7865 6c73 2869 6e74 6572 7661  e_pixels(interva
+00015c90: 6c5f 6c69 7374 293a 0a20 2020 2020 2020  l_list):.       
+00015ca0: 2020 2020 2022 2222 4576 616c 7561 7465       """Evaluate
+00015cb0: 7320 7468 6520 696e 7465 7276 616c 7320  s the intervals 
+00015cc0: 616e 6420 7375 6264 6976 6964 6573 2074  and subdivides t
+00015cd0: 6865 2069 6e74 6572 7661 6c20 6966 2074  he interval if t
+00015ce0: 6865 0a20 2020 2020 2020 2020 2020 2065  he.            e
+00015cf0: 7870 7265 7373 696f 6e20 6973 2070 6172  xpression is par
+00015d00: 7469 616c 6c79 2073 6174 6973 6669 6564  tially satisfied
+00015d10: 2e22 2222 0a20 2020 2020 2020 2020 2020  .""".           
+00015d20: 2074 656d 705f 696e 7465 7276 616c 5f6c   temp_interval_l
+00015d30: 6973 7420 3d20 5b5d 0a20 2020 2020 2020  ist = [].       
+00015d40: 2020 2020 2070 6c6f 745f 6c69 7374 203d       plot_list =
+00015d50: 205b 5d0a 2020 2020 2020 2020 2020 2020   [].            
+00015d60: 666f 7220 696e 7465 7276 616c 7320 696e  for intervals in
+00015d70: 2069 6e74 6572 7661 6c5f 6c69 7374 3a0a   interval_list:.
+00015d80: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00015d90: 2023 2043 6f6e 7665 7274 2074 6865 2061   # Convert the a
+00015da0: 7272 6179 2069 6e64 6963 6573 2074 6f20  rray indices to 
+00015db0: 7820 616e 6420 7920 7661 6c75 6573 0a20  x and y values. 
+00015dc0: 2020 2020 2020 2020 2020 2020 2020 2069                 i
+00015dd0: 6e74 6572 7661 6c78 203d 2069 6e74 6572  ntervalx = inter
+00015de0: 7661 6c73 5b30 5d0a 2020 2020 2020 2020  vals[0].        
+00015df0: 2020 2020 2020 2020 696e 7465 7276 616c          interval
+00015e00: 7920 3d20 696e 7465 7276 616c 735b 315d  y = intervals[1]
+00015e10: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00015e20: 2066 756e 635f 6576 616c 203d 2066 756e   func_eval = fun
+00015e30: 6328 696e 7465 7276 616c 782c 2069 6e74  c(intervalx, int
+00015e40: 6572 7661 6c79 290a 2020 2020 2020 2020  ervaly).        
+00015e50: 2020 2020 2020 2020 2320 5468 6520 6578          # The ex
+00015e60: 7072 6573 7369 6f6e 2069 7320 7661 6c69  pression is vali
+00015e70: 6420 696e 2074 6865 2069 6e74 6572 7661  d in the interva
+00015e80: 6c2e 2043 6861 6e67 6520 7468 6520 636f  l. Change the co
+00015e90: 6e74 6f75 720a 2020 2020 2020 2020 2020  ntour.          
+00015ea0: 2020 2020 2020 2320 6172 7261 7920 7661        # array va
+00015eb0: 6c75 6573 2074 6f20 312e 0a20 2020 2020  lues to 1..     
+00015ec0: 2020 2020 2020 2020 2020 2069 6620 6675             if fu
+00015ed0: 6e63 5f65 7661 6c5b 315d 2069 7320 4661  nc_eval[1] is Fa
+00015ee0: 6c73 6520 6f72 2066 756e 635f 6576 616c  lse or func_eval
+00015ef0: 5b30 5d20 6973 2046 616c 7365 3a0a 2020  [0] is False:.  
+00015f00: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00015f10: 2020 7061 7373 0a20 2020 2020 2020 2020    pass.         
+00015f20: 2020 2020 2020 2065 6c69 6620 6675 6e63         elif func
+00015f30: 5f65 7661 6c20 3d3d 2028 5472 7565 2c20  _eval == (True, 
+00015f40: 5472 7565 293a 0a20 2020 2020 2020 2020  True):.         
+00015f50: 2020 2020 2020 2020 2020 2070 6c6f 745f             plot_
+00015f60: 6c69 7374 2e61 7070 656e 6428 5b69 6e74  list.append([int
+00015f70: 6572 7661 6c78 2c20 696e 7465 7276 616c  ervalx, interval
+00015f80: 795d 290a 2020 2020 2020 2020 2020 2020  y]).            
+00015f90: 2020 2020 656c 6966 2066 756e 635f 6576      elif func_ev
+00015fa0: 616c 5b31 5d20 6973 204e 6f6e 6520 6f72  al[1] is None or
+00015fb0: 2066 756e 635f 6576 616c 5b30 5d20 6973   func_eval[0] is
+00015fc0: 204e 6f6e 653a 0a20 2020 2020 2020 2020   None:.         
+00015fd0: 2020 2020 2020 2020 2020 2023 2053 7562             # Sub
+00015fe0: 6469 7669 6465 0a20 2020 2020 2020 2020  divide.         
+00015ff0: 2020 2020 2020 2020 2020 2061 7667 7820             avgx 
+00016000: 3d20 696e 7465 7276 616c 782e 6d69 640a  = intervalx.mid.
+00016010: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00016020: 2020 2020 6176 6779 203d 2069 6e74 6572      avgy = inter
+00016030: 7661 6c79 2e6d 6964 0a20 2020 2020 2020  valy.mid.       
+00016040: 2020 2020 2020 2020 2020 2020 2061 203d               a =
+00016050: 2069 6e74 6572 7661 6c28 696e 7465 7276   interval(interv
+00016060: 616c 782e 7374 6172 742c 2061 7667 7829  alx.start, avgx)
+00016070: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00016080: 2020 2020 2062 203d 2069 6e74 6572 7661       b = interva
+00016090: 6c28 6176 6778 2c20 696e 7465 7276 616c  l(avgx, interval
+000160a0: 782e 656e 6429 0a20 2020 2020 2020 2020  x.end).         
+000160b0: 2020 2020 2020 2020 2020 2063 203d 2069             c = i
+000160c0: 6e74 6572 7661 6c28 696e 7465 7276 616c  nterval(interval
+000160d0: 792e 7374 6172 742c 2061 7667 7929 0a20  y.start, avgy). 
+000160e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000160f0: 2020 2064 203d 2069 6e74 6572 7661 6c28     d = interval(
+00016100: 6176 6779 2c20 696e 7465 7276 616c 792e  avgy, intervaly.
+00016110: 656e 6429 0a20 2020 2020 2020 2020 2020  end).           
+00016120: 2020 2020 2020 2020 2074 656d 705f 696e           temp_in
+00016130: 7465 7276 616c 5f6c 6973 742e 6170 7065  terval_list.appe
+00016140: 6e64 285b 612c 2063 5d29 0a20 2020 2020  nd([a, c]).     
+00016150: 2020 2020 2020 2020 2020 2020 2020 2074                 t
+00016160: 656d 705f 696e 7465 7276 616c 5f6c 6973  emp_interval_lis
+00016170: 742e 6170 7065 6e64 285b 612c 2064 5d29  t.append([a, d])
+00016180: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00016190: 2020 2020 2074 656d 705f 696e 7465 7276       temp_interv
+000161a0: 616c 5f6c 6973 742e 6170 7065 6e64 285b  al_list.append([
+000161b0: 622c 2063 5d29 0a20 2020 2020 2020 2020  b, c]).         
+000161c0: 2020 2020 2020 2020 2020 2074 656d 705f             temp_
+000161d0: 696e 7465 7276 616c 5f6c 6973 742e 6170  interval_list.ap
+000161e0: 7065 6e64 285b 622c 2064 5d29 0a20 2020  pend([b, d]).   
+000161f0: 2020 2020 2020 2020 2072 6574 7572 6e20           return 
+00016200: 7465 6d70 5f69 6e74 6572 7661 6c5f 6c69  temp_interval_li
+00016210: 7374 2c20 706c 6f74 5f6c 6973 740a 0a20  st, plot_list.. 
+00016220: 2020 2020 2020 2077 6869 6c65 206b 203e         while k >
+00016230: 3d20 3020 616e 6420 6c65 6e28 696e 7465  = 0 and len(inte
+00016240: 7276 616c 5f6c 6973 7429 3a0a 2020 2020  rval_list):.    
+00016250: 2020 2020 2020 2020 696e 7465 7276 616c          interval
+00016260: 5f6c 6973 742c 2070 6c6f 745f 6c69 7374  _list, plot_list
+00016270: 5f74 656d 7020 3d20 7265 6669 6e65 5f70  _temp = refine_p
+00016280: 6978 656c 7328 696e 7465 7276 616c 5f6c  ixels(interval_l
+00016290: 6973 7429 0a20 2020 2020 2020 2020 2020  ist).           
+000162a0: 2070 6c6f 745f 6c69 7374 2e65 7874 656e   plot_list.exten
+000162b0: 6428 706c 6f74 5f6c 6973 745f 7465 6d70  d(plot_list_temp
+000162c0: 290a 2020 2020 2020 2020 2020 2020 6b20  ).            k 
+000162d0: 3d20 6b20 2d20 310a 2020 2020 2020 2020  = k - 1.        
+000162e0: 2320 4368 6563 6b20 7768 6574 6865 7220  # Check whether 
+000162f0: 7468 6520 6578 7072 6573 7369 6f6e 2072  the expression r
+00016300: 6570 7265 7365 6e74 7320 616e 2065 7175  epresents an equ
+00016310: 616c 6974 790a 2020 2020 2020 2020 2320  ality.        # 
+00016320: 4966 2069 7420 7265 7072 6573 656e 7473  If it represents
+00016330: 2061 6e20 6571 7561 6c69 7479 2c20 7468   an equality, th
+00016340: 656e 206e 6f6e 6520 6f66 2074 6865 2069  en none of the i
+00016350: 6e74 6572 7661 6c73 0a20 2020 2020 2020  ntervals.       
+00016360: 2023 2077 6f75 6c64 2068 6176 6520 7361   # would have sa
+00016370: 7469 7366 6965 6420 7468 6520 6578 7072  tisfied the expr
+00016380: 6573 7369 6f6e 2064 7565 2074 6f20 666c  ession due to fl
+00016390: 6f61 7469 6e67 2070 6f69 6e74 0a20 2020  oating point.   
+000163a0: 2020 2020 2023 2064 6966 6665 7265 6e63       # differenc
+000163b0: 6573 2e20 4164 6420 616c 6c20 7468 6520  es. Add all the 
+000163c0: 756e 6465 6369 6465 6420 7661 6c75 6573  undecided values
+000163d0: 2074 6f20 7468 6520 706c 6f74 2e0a 2020   to the plot..  
+000163e0: 2020 2020 2020 6966 2073 656c 662e 6861        if self.ha
+000163f0: 735f 6571 7561 6c69 7479 3a0a 2020 2020  s_equality:.    
+00016400: 2020 2020 2020 2020 666f 7220 696e 7465          for inte
+00016410: 7276 616c 7320 696e 2069 6e74 6572 7661  rvals in interva
+00016420: 6c5f 6c69 7374 3a0a 2020 2020 2020 2020  l_list:.        
+00016430: 2020 2020 2020 2020 696e 7465 7276 616c          interval
+00016440: 7820 3d20 696e 7465 7276 616c 735b 305d  x = intervals[0]
+00016450: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00016460: 2069 6e74 6572 7661 6c79 203d 2069 6e74   intervaly = int
+00016470: 6572 7661 6c73 5b31 5d0a 2020 2020 2020  ervals[1].      
+00016480: 2020 2020 2020 2020 2020 6675 6e63 5f65            func_e
+00016490: 7661 6c20 3d20 6675 6e63 2869 6e74 6572  val = func(inter
+000164a0: 7661 6c78 2c20 696e 7465 7276 616c 7929  valx, intervaly)
+000164b0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+000164c0: 2069 6620 6675 6e63 5f65 7661 6c5b 315d   if func_eval[1]
+000164d0: 2061 6e64 2066 756e 635f 6576 616c 5b30   and func_eval[0
+000164e0: 5d20 6973 206e 6f74 2046 616c 7365 3a0a  ] is not False:.
+000164f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00016500: 2020 2020 706c 6f74 5f6c 6973 742e 6170      plot_list.ap
+00016510: 7065 6e64 285b 696e 7465 7276 616c 782c  pend([intervalx,
+00016520: 2069 6e74 6572 7661 6c79 5d29 0a20 2020   intervaly]).   
+00016530: 2020 2020 2072 6574 7572 6e20 706c 6f74       return plot
+00016540: 5f6c 6973 742c 2022 6669 6c6c 220a 0a20  _list, "fill".. 
+00016550: 2020 2064 6566 205f 6765 745f 6d65 7368     def _get_mesh
+00016560: 6573 5f67 7269 6428 7365 6c66 293a 0a20  es_grid(self):. 
+00016570: 2020 2020 2020 2022 2222 4765 6e65 7261         """Genera
+00016580: 7465 7320 7468 6520 6d65 7368 2066 6f72  tes the mesh for
+00016590: 2067 656e 6572 6174 696e 6720 6120 636f   generating a co
+000165a0: 6e74 6f75 722e 0a0a 2020 2020 2020 2020  ntour...        
+000165b0: 496e 2074 6865 2063 6173 6520 6f66 2065  In the case of e
+000165c0: 7175 616c 6974 792c 2060 6063 6f6e 746f  quality, ``conto
+000165d0: 7572 6060 2066 756e 6374 696f 6e20 6f66  ur`` function of
+000165e0: 206d 6174 706c 6f74 6c69 6220 6361 6e0a   matplotlib can.
+000165f0: 2020 2020 2020 2020 6265 2075 7365 642e          be used.
+00016600: 2049 6e20 6f74 6865 7220 6361 7365 732c   In other cases,
+00016610: 206d 6174 706c 6f74 6c69 6227 7320 6060   matplotlib's ``
+00016620: 636f 6e74 6f75 7266 6060 2069 7320 7573  contourf`` is us
+00016630: 6564 2e0a 2020 2020 2020 2020 2222 220a  ed..        """.
+00016640: 2020 2020 2020 2020 6e70 203d 2069 6d70          np = imp
+00016650: 6f72 745f 6d6f 6475 6c65 2827 6e75 6d70  ort_module('nump
+00016660: 7927 290a 0a20 2020 2020 2020 2078 6172  y')..        xar
+00016670: 7261 792c 2079 6172 7261 792c 207a 5f67  ray, yarray, z_g
+00016680: 7269 6420 3d20 7365 6c66 2e5f 6576 616c  rid = self._eval
+00016690: 7561 7465 2829 0a20 2020 2020 2020 205f  uate().        _
+000166a0: 7265 2c20 5f69 6d20 3d20 6e70 2e72 6561  re, _im = np.rea
+000166b0: 6c28 7a5f 6772 6964 292c 206e 702e 696d  l(z_grid), np.im
+000166c0: 6167 287a 5f67 7269 6429 0a20 2020 2020  ag(z_grid).     
+000166d0: 2020 205f 7265 5b6e 702e 696e 7665 7274     _re[np.invert
+000166e0: 286e 702e 6973 636c 6f73 6528 5f69 6d2c  (np.isclose(_im,
+000166f0: 206e 702e 7a65 726f 735f 6c69 6b65 285f   np.zeros_like(_
+00016700: 696d 2929 295d 203d 206e 702e 6e61 6e0a  im)))] = np.nan.
+00016710: 2020 2020 2020 2020 6966 2073 656c 662e          if self.
+00016720: 5f69 735f 6571 7561 6c69 7479 3a0a 2020  _is_equality:.  
+00016730: 2020 2020 2020 2020 2020 7265 7475 726e            return
+00016740: 2078 6172 7261 792c 2079 6172 7261 792c   xarray, yarray,
+00016750: 205f 7265 2c20 2763 6f6e 746f 7572 270a   _re, 'contour'.
+00016760: 2020 2020 2020 2020 7265 7475 726e 2078          return x
+00016770: 6172 7261 792c 2079 6172 7261 792c 205f  array, yarray, _
+00016780: 7265 2c20 2763 6f6e 746f 7572 6627 0a0a  re, 'contourf'..
+00016790: 2020 2020 4073 7461 7469 636d 6574 686f      @staticmetho
+000167a0: 640a 2020 2020 6465 6620 5f70 7265 7072  d.    def _prepr
+000167b0: 6f63 6573 735f 6d65 7368 6772 6964 5f65  ocess_meshgrid_e
+000167c0: 7870 7265 7373 696f 6e28 6578 7072 2c20  xpression(expr, 
+000167d0: 6164 6170 7469 7665 293a 0a20 2020 2020  adaptive):.     
+000167e0: 2020 2022 2222 4966 2074 6865 2065 7870     """If the exp
+000167f0: 7265 7373 696f 6e20 6973 2061 2052 656c  ression is a Rel
+00016800: 6174 696f 6e61 6c2c 2072 6577 7269 7465  ational, rewrite
+00016810: 2069 7420 6173 2061 2073 696e 676c 650a   it as a single.
+00016820: 2020 2020 2020 2020 6578 7072 6573 7369          expressi
+00016830: 6f6e 2e0a 0a20 2020 2020 2020 2052 6574  on...        Ret
+00016840: 7572 6e73 0a20 2020 2020 2020 203d 3d3d  urns.        ===
+00016850: 3d3d 3d3d 0a0a 2020 2020 2020 2020 6578  ====..        ex
+00016860: 7072 203a 2045 7870 720a 2020 2020 2020  pr : Expr.      
+00016870: 2020 2020 2020 5468 6520 7265 7772 6974        The rewrit
+00016880: 7465 6e20 6578 7072 6573 7369 6f6e 0a0a  ten expression..
+00016890: 2020 2020 2020 2020 6571 7561 6c69 7479          equality
+000168a0: 203a 2042 6f6f 6c65 616e 0a20 2020 2020   : Boolean.     
+000168b0: 2020 2020 2020 2057 6865 7465 7220 7468         Wheter th
+000168c0: 6520 6f72 6967 696e 616c 2065 7870 7265  e original expre
+000168d0: 7373 696f 6e20 7761 7320 616e 2045 7175  ssion was an Equ
+000168e0: 616c 6974 7920 6f72 206e 6f74 2e0a 2020  ality or not..  
+000168f0: 2020 2020 2020 2222 220a 2020 2020 2020        """.      
+00016900: 2020 6571 7561 6c69 7479 203d 2046 616c    equality = Fal
+00016910: 7365 0a20 2020 2020 2020 2069 6620 6973  se.        if is
+00016920: 696e 7374 616e 6365 2865 7870 722c 2045  instance(expr, E
+00016930: 7175 616c 6974 7929 3a0a 2020 2020 2020  quality):.      
+00016940: 2020 2020 2020 6578 7072 203d 2065 7870        expr = exp
+00016950: 722e 6c68 7320 2d20 6578 7072 2e72 6873  r.lhs - expr.rhs
+00016960: 0a20 2020 2020 2020 2020 2020 2065 7175  .            equ
+00016970: 616c 6974 7920 3d20 5472 7565 0a20 2020  ality = True.   
+00016980: 2020 2020 2065 6c69 6620 6973 696e 7374       elif isinst
+00016990: 616e 6365 2865 7870 722c 2028 4772 6561  ance(expr, (Grea
+000169a0: 7465 7254 6861 6e2c 2053 7472 6963 7447  terThan, StrictG
+000169b0: 7265 6174 6572 5468 616e 2929 3a0a 2020  reaterThan)):.  
+000169c0: 2020 2020 2020 2020 2020 6578 7072 203d            expr =
+000169d0: 2065 7870 722e 6c68 7320 2d20 6578 7072   expr.lhs - expr
+000169e0: 2e72 6873 0a20 2020 2020 2020 2065 6c69  .rhs.        eli
+000169f0: 6620 6973 696e 7374 616e 6365 2865 7870  f isinstance(exp
+00016a00: 722c 2028 4c65 7373 5468 616e 2c20 5374  r, (LessThan, St
+00016a10: 7269 6374 4c65 7373 5468 616e 2929 3a0a  rictLessThan)):.
+00016a20: 2020 2020 2020 2020 2020 2020 6578 7072              expr
+00016a30: 203d 2065 7870 722e 7268 7320 2d20 6578   = expr.rhs - ex
+00016a40: 7072 2e6c 6873 0a20 2020 2020 2020 2065  pr.lhs.        e
+00016a50: 6c69 6620 6e6f 7420 6164 6170 7469 7665  lif not adaptive
+00016a60: 3a0a 2020 2020 2020 2020 2020 2020 7261  :.            ra
+00016a70: 6973 6520 4e6f 7449 6d70 6c65 6d65 6e74  ise NotImplement
+00016a80: 6564 4572 726f 7228 0a20 2020 2020 2020  edError(.       
+00016a90: 2020 2020 2020 2020 2022 5468 6520 6578           "The ex
+00016aa0: 7072 6573 7369 6f6e 2069 7320 6e6f 7420  pression is not 
+00016ab0: 7375 7070 6f72 7465 6420 666f 7220 220a  supported for ".
+00016ac0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00016ad0: 2270 6c6f 7474 696e 6720 696e 2075 6e69  "plotting in uni
+00016ae0: 666f 726d 206d 6573 6865 6420 706c 6f74  form meshed plot
+00016af0: 2e22 0a20 2020 2020 2020 2020 2020 2029  .".            )
+00016b00: 0a20 2020 2020 2020 2072 6574 7572 6e20  .        return 
+00016b10: 6578 7072 2c20 6571 7561 6c69 7479 0a0a  expr, equality..
+00016b20: 2020 2020 6465 6620 6765 745f 6c61 6265      def get_labe
+00016b30: 6c28 7365 6c66 2c20 7573 655f 6c61 7465  l(self, use_late
+00016b40: 783d 4661 6c73 652c 2077 7261 7070 6572  x=False, wrapper
+00016b50: 3d22 2425 7324 2229 3a0a 2020 2020 2020  ="$%s$"):.      
+00016b60: 2020 2222 2252 6574 7572 6e20 7468 6520    """Return the 
+00016b70: 6c61 6265 6c20 746f 2062 6520 7573 6564  label to be used
+00016b80: 2074 6f20 6469 7370 6c61 7920 7468 6520   to display the 
+00016b90: 6578 7072 6573 7369 6f6e 2e0a 0a20 2020  expression...   
+00016ba0: 2020 2020 2050 6172 616d 6574 6572 730a       Parameters.
+00016bb0: 2020 2020 2020 2020 3d3d 3d3d 3d3d 3d3d          ========
+00016bc0: 3d3d 0a20 2020 2020 2020 2075 7365 5f6c  ==.        use_l
+00016bd0: 6174 6578 203a 2062 6f6f 6c0a 2020 2020  atex : bool.    
+00016be0: 2020 2020 2020 2020 4966 2046 616c 7365          If False
+00016bf0: 2c20 7468 6520 7374 7269 6e67 2072 6570  , the string rep
+00016c00: 7265 7365 6e74 6174 696f 6e20 6f66 2074  resentation of t
+00016c10: 6865 2065 7870 7265 7373 696f 6e20 6973  he expression is
+00016c20: 2072 6574 7572 6e65 642e 0a20 2020 2020   returned..     
+00016c30: 2020 2020 2020 2049 6620 5472 7565 2c20         If True, 
+00016c40: 7468 6520 6c61 7465 7820 7265 7072 6573  the latex repres
+00016c50: 656e 7461 7469 6f6e 2069 7320 7265 7475  entation is retu
+00016c60: 726e 6564 2e0a 2020 2020 2020 2020 7772  rned..        wr
+00016c70: 6170 7065 7220 3a20 7374 720a 2020 2020  apper : str.    
+00016c80: 2020 2020 2020 2020 5468 6520 6261 636b          The back
+00016c90: 656e 6420 6d69 6768 7420 6e65 6564 2074  end might need t
+00016ca0: 6865 206c 6174 6578 2072 6570 7265 7365  he latex represe
+00016cb0: 6e74 6174 696f 6e20 746f 2062 6520 7772  ntation to be wr
+00016cc0: 6170 7065 6420 6279 0a20 2020 2020 2020  apped by.       
+00016cd0: 2020 2020 2073 6f6d 6520 6368 6172 6163       some charac
+00016ce0: 7465 7273 2e20 4465 6661 756c 7420 746f  ters. Default to
+00016cf0: 2060 6022 2425 7324 2260 602e 0a0a 2020   ``"$%s$"``...  
+00016d00: 2020 2020 2020 5265 7475 726e 730a 2020        Returns.  
+00016d10: 2020 2020 2020 3d3d 3d3d 3d3d 3d0a 2020        =======.  
+00016d20: 2020 2020 2020 6c61 6265 6c20 3a20 7374        label : st
+00016d30: 720a 2020 2020 2020 2020 2222 220a 2020  r.        """.  
+00016d40: 2020 2020 2020 6966 2075 7365 5f6c 6174        if use_lat
+00016d50: 6578 2069 7320 4661 6c73 653a 0a20 2020  ex is False:.   
+00016d60: 2020 2020 2020 2020 2072 6574 7572 6e20           return 
+00016d70: 7365 6c66 2e5f 6c61 6265 6c0a 2020 2020  self._label.    
+00016d80: 2020 2020 6966 2028 0a20 2020 2020 2020      if (.       
+00016d90: 2020 2020 2028 7365 6c66 2e5f 6c61 6265       (self._labe
+00016da0: 6c20 3d3d 2073 7472 2873 656c 662e 5f61  l == str(self._a
+00016db0: 6461 7074 6976 655f 6578 7072 2929 206f  daptive_expr)) o
+00016dc0: 720a 2020 2020 2020 2020 2020 2020 2822  r.            ("
+00016dd0: 4571 2825 732c 2030 2922 2025 2073 656c  Eq(%s, 0)" % sel
+00016de0: 662e 5f6c 6162 656c 203d 3d20 7374 7228  f._label == str(
+00016df0: 7365 6c66 2e5f 6164 6170 7469 7665 5f65  self._adaptive_e
+00016e00: 7870 7229 290a 2020 2020 2020 2020 293a  xpr)).        ):
+00016e10: 0a20 2020 2020 2020 2020 2020 2072 6574  .            ret
+00016e20: 7572 6e20 7365 6c66 2e5f 6765 745f 7772  urn self._get_wr
+00016e30: 6170 7065 645f 6c61 6265 6c28 7365 6c66  apped_label(self
+00016e40: 2e5f 6c61 7465 785f 6c61 6265 6c2c 2077  ._latex_label, w
+00016e50: 7261 7070 6572 290a 2020 2020 2020 2020  rapper).        
+00016e60: 7265 7475 726e 2073 656c 662e 5f6c 6174  return self._lat
+00016e70: 6578 5f6c 6162 656c 0a0a 0a63 6c61 7373  ex_label...class
+00016e80: 2049 6d70 6c69 6369 7433 4453 6572 6965   Implicit3DSerie
+00016e90: 7328 0a20 2020 2043 6f6d 6d6f 6e55 6e69  s(.    CommonUni
+00016ea0: 666f 726d 4576 616c 7561 7469 6f6e 2c20  formEvaluation, 
+00016eb0: 5375 7266 6163 6542 6173 6553 6572 6965  SurfaceBaseSerie
+00016ec0: 730a 293a 0a20 2020 2069 735f 696d 706c  s.):.    is_impl
+00016ed0: 6963 6974 203d 2054 7275 650a 2020 2020  icit = True.    
+00016ee0: 5f4e 203d 2036 300a 0a20 2020 2064 6566  _N = 60..    def
+00016ef0: 205f 5f69 6e69 745f 5f28 7365 6c66 2c20   __init__(self, 
+00016f00: 6578 7072 2c20 7261 6e67 655f 782c 2072  expr, range_x, r
+00016f10: 616e 6765 5f79 2c20 7261 6e67 655f 7a2c  ange_y, range_z,
+00016f20: 206c 6162 656c 3d22 222c 202a 2a6b 7761   label="", **kwa
+00016f30: 7267 7329 3a0a 2020 2020 2020 2020 7375  rgs):.        su
+00016f40: 7065 7228 292e 5f5f 696e 6974 5f5f 282a  per().__init__(*
+00016f50: 2a6b 7761 7267 7329 0a20 2020 2020 2020  *kwargs).       
+00016f60: 2073 656c 662e 6578 7072 203d 2065 7870   self.expr = exp
+00016f70: 7220 6966 2063 616c 6c61 626c 6528 6578  r if callable(ex
+00016f80: 7072 2920 656c 7365 2073 796d 7069 6679  pr) else sympify
+00016f90: 2865 7870 7229 0a20 2020 2020 2020 2073  (expr).        s
+00016fa0: 656c 662e 7261 6e67 6573 203d 205b 7261  elf.ranges = [ra
+00016fb0: 6e67 655f 782c 2072 616e 6765 5f79 2c20  nge_x, range_y, 
+00016fc0: 7261 6e67 655f 7a5d 0a20 2020 2020 2020  range_z].       
+00016fd0: 2073 656c 662e 7661 725f 782c 2073 656c   self.var_x, sel
+00016fe0: 662e 7374 6172 745f 782c 2073 656c 662e  f.start_x, self.
+00016ff0: 656e 645f 7820 3d20 7365 6c66 2e72 616e  end_x = self.ran
+00017000: 6765 735b 305d 0a20 2020 2020 2020 2073  ges[0].        s
+00017010: 656c 662e 7661 725f 792c 2073 656c 662e  elf.var_y, self.
+00017020: 7374 6172 745f 792c 2073 656c 662e 656e  start_y, self.en
+00017030: 645f 7920 3d20 7365 6c66 2e72 616e 6765  d_y = self.range
+00017040: 735b 315d 0a20 2020 2020 2020 2073 656c  s[1].        sel
+00017050: 662e 7661 725f 7a2c 2073 656c 662e 7374  f.var_z, self.st
+00017060: 6172 745f 7a2c 2073 656c 662e 656e 645f  art_z, self.end_
+00017070: 7a20 3d20 7365 6c66 2e72 616e 6765 735b  z = self.ranges[
+00017080: 325d 0a20 2020 2020 2020 2069 6620 6973  2].        if is
+00017090: 696e 7374 616e 6365 2873 656c 662e 6578  instance(self.ex
+000170a0: 7072 2c20 506c 616e 6529 3a0a 2020 2020  pr, Plane):.    
+000170b0: 2020 2020 2020 2020 7365 6c66 2e65 7870          self.exp
+000170c0: 7220 3d20 7365 6c66 2e65 7870 722e 6571  r = self.expr.eq
+000170d0: 7561 7469 6f6e 2873 656c 662e 7661 725f  uation(self.var_
+000170e0: 782c 2073 656c 662e 7661 725f 792c 2073  x, self.var_y, s
+000170f0: 656c 662e 7661 725f 7a29 0a20 2020 2020  elf.var_z).     
+00017100: 2020 2073 656c 662e 5f73 6574 5f73 7572     self._set_sur
+00017110: 6661 6365 5f6c 6162 656c 286c 6162 656c  face_label(label
+00017120: 290a 0a20 2020 2064 6566 205f 5f73 7472  )..    def __str
+00017130: 5f5f 2873 656c 6629 3a0a 2020 2020 2020  __(self):.      
+00017140: 2020 7661 725f 782c 2073 7461 7274 5f78    var_x, start_x
+00017150: 2c20 656e 645f 7820 3d20 7365 6c66 2e72  , end_x = self.r
+00017160: 616e 6765 735b 305d 0a20 2020 2020 2020  anges[0].       
+00017170: 2076 6172 5f79 2c20 7374 6172 745f 792c   var_y, start_y,
+00017180: 2065 6e64 5f79 203d 2073 656c 662e 7261   end_y = self.ra
+00017190: 6e67 6573 5b31 5d0a 2020 2020 2020 2020  nges[1].        
+000171a0: 7661 725f 7a2c 2073 7461 7274 5f7a 2c20  var_z, start_z, 
+000171b0: 656e 645f 7a20 3d20 7365 6c66 2e72 616e  end_z = self.ran
+000171c0: 6765 735b 325d 0a20 2020 2020 2020 2072  ges[2].        r
+000171d0: 6574 7572 6e20 280a 2020 2020 2020 2020  eturn (.        
+000171e0: 2020 2020 2269 6d70 6c69 6369 7420 7375      "implicit su
+000171f0: 7266 6163 6520 7365 7269 6573 3a20 2573  rface series: %s
+00017200: 2066 6f72 2025 7320 6f76 6572 2025 7320   for %s over %s 
+00017210: 616e 6420 2573 206f 7665 7220 2573 220a  and %s over %s".
+00017220: 2020 2020 2020 2020 2020 2020 2220 616e              " an
+00017230: 6420 2573 206f 7665 7220 2573 2229 2025  d %s over %s") %
+00017240: 2028 0a20 2020 2020 2020 2020 2020 2020   (.             
+00017250: 2020 2073 7472 2873 656c 662e 6578 7072     str(self.expr
+00017260: 292c 0a20 2020 2020 2020 2020 2020 2020  ),.             
+00017270: 2020 2073 7472 2876 6172 5f78 292c 2073     str(var_x), s
+00017280: 7472 2828 666c 6f61 7428 7374 6172 745f  tr((float(start_
+00017290: 7829 2c20 666c 6f61 7428 656e 645f 7829  x), float(end_x)
+000172a0: 2929 2c0a 2020 2020 2020 2020 2020 2020  )),.            
+000172b0: 2020 2020 7374 7228 7661 725f 7929 2c20      str(var_y), 
+000172c0: 7374 7228 2866 6c6f 6174 2873 7461 7274  str((float(start
+000172d0: 5f79 292c 2066 6c6f 6174 2865 6e64 5f79  _y), float(end_y
+000172e0: 2929 292c 0a20 2020 2020 2020 2020 2020  ))),.           
+000172f0: 2020 2020 2073 7472 2876 6172 5f7a 292c       str(var_z),
+00017300: 2073 7472 2828 666c 6f61 7428 7374 6172   str((float(star
+00017310: 745f 7a29 2c20 666c 6f61 7428 656e 645f  t_z), float(end_
+00017320: 7a29 2929 0a20 2020 2020 2020 2020 2020  z))).           
+00017330: 2029 0a0a 2020 2020 6465 6620 6765 745f   )..    def get_
+00017340: 6461 7461 2873 656c 6629 3a0a 2020 2020  data(self):.    
+00017350: 2020 2020 2222 2245 7661 6c75 6174 6520      """Evaluate 
+00017360: 7468 6520 6578 7072 6573 7369 6f6e 206f  the expression o
+00017370: 7665 7220 7468 6520 7072 6f76 6964 6564  ver the provided
+00017380: 2064 6f6d 6169 6e2e 2054 6865 2062 6163   domain. The bac
+00017390: 6b65 6e64 2077 696c 6c0a 2020 2020 2020  kend will.      
+000173a0: 2020 7468 656e 2074 7279 2074 6f20 636f    then try to co
+000173b0: 6d70 7574 6520 616e 6420 7669 7375 616c  mpute and visual
+000173c0: 697a 6520 7468 6520 6669 6e61 6c20 7265  ize the final re
+000173d0: 7375 6c74 2c20 6966 2069 7420 7375 7070  sult, if it supp
+000173e0: 6f72 7420 7468 6973 0a20 2020 2020 2020  ort this.       
+000173f0: 2064 6174 6120 7365 7269 6573 2e0a 0a20   data series... 
+00017400: 2020 2020 2020 2052 6574 7572 6e73 0a20         Returns. 
+00017410: 2020 2020 2020 203d 3d3d 3d3d 3d3d 0a20         =======. 
+00017420: 2020 2020 2020 206d 6573 685f 7820 3a20         mesh_x : 
+00017430: 6e70 2e6e 6461 7272 6179 205b 6e31 2078  np.ndarray [n1 x
+00017440: 206e 3220 7820 6e33 5d0a 2020 2020 2020   n2 x n3].      
+00017450: 2020 6d65 7368 5f79 203a 206e 702e 6e64    mesh_y : np.nd
+00017460: 6172 7261 7920 5b6e 3120 7820 6e32 2078  array [n1 x n2 x
+00017470: 206e 335d 0a20 2020 2020 2020 206d 6573   n3].        mes
+00017480: 685f 7a20 3a20 6e70 2e6e 6461 7272 6179  h_z : np.ndarray
+00017490: 205b 6e31 2078 206e 3220 7820 6e33 5d0a   [n1 x n2 x n3].
+000174a0: 2020 2020 2020 2020 6620 3a20 6e70 2e6e          f : np.n
+000174b0: 6461 7272 6179 205b 6e31 2078 206e 3220  darray [n1 x n2 
+000174c0: 7820 6e33 5d0a 2020 2020 2020 2020 2222  x n3].        ""
+000174d0: 220a 2020 2020 2020 2020 6e70 203d 2069  ".        np = i
+000174e0: 6d70 6f72 745f 6d6f 6475 6c65 2827 6e75  mport_module('nu
+000174f0: 6d70 7927 290a 0a20 2020 2020 2020 2072  mpy')..        r
+00017500: 6573 756c 7473 203d 2073 656c 662e 5f65  esults = self._e
+00017510: 7661 6c75 6174 6528 290a 2020 2020 2020  valuate().      
+00017520: 2020 666f 7220 692c 2072 2069 6e20 656e    for i, r in en
+00017530: 756d 6572 6174 6528 7265 7375 6c74 7329  umerate(results)
+00017540: 3a0a 2020 2020 2020 2020 2020 2020 7265  :.            re
+00017550: 5f76 2c20 696d 5f76 203d 206e 702e 7265  _v, im_v = np.re
+00017560: 616c 2872 292c 206e 702e 696d 6167 2872  al(r), np.imag(r
+00017570: 290a 2020 2020 2020 2020 2020 2020 7265  ).            re
+00017580: 5f76 5b6e 702e 696e 7665 7274 286e 702e  _v[np.invert(np.
+00017590: 6973 636c 6f73 6528 696d 5f76 2c20 6e70  isclose(im_v, np
+000175a0: 2e7a 6572 6f73 5f6c 696b 6528 696d 5f76  .zeros_like(im_v
+000175b0: 2929 295d 203d 206e 702e 6e61 6e0a 2020  )))] = np.nan.  
+000175c0: 2020 2020 2020 2020 2020 7265 7375 6c74            result
+000175d0: 735b 695d 203d 2072 655f 760a 0a20 2020  s[i] = re_v..   
+000175e0: 2020 2020 2072 6574 7572 6e20 7365 6c66       return self
+000175f0: 2e5f 6170 706c 795f 7472 616e 7366 6f72  ._apply_transfor
+00017600: 6d28 2a72 6573 756c 7473 290a 0a0a 636c  m(*results)...cl
+00017610: 6173 7320 436f 6d70 6c65 7850 6f69 6e74  ass ComplexPoint
+00017620: 5365 7269 6573 284c 696e 6532 4442 6173  Series(Line2DBas
+00017630: 6553 6572 6965 7329 3a0a 2020 2020 2222  eSeries):.    ""
+00017640: 2252 6570 7265 7365 6e74 6174 696f 6e20  "Representation 
+00017650: 666f 7220 6120 6c69 6e65 2069 6e20 7468  for a line in th
+00017660: 6520 636f 6d70 6c65 7820 706c 616e 6520  e complex plane 
+00017670: 636f 6e73 6973 7469 6e67 206f 660a 2020  consisting of.  
+00017680: 2020 6c69 7374 206f 6620 706f 696e 7473    list of points
+00017690: 2e22 2222 0a0a 2020 2020 6465 6620 5f5f  ."""..    def __
+000176a0: 696e 6974 5f5f 2873 656c 662c 2065 7870  init__(self, exp
+000176b0: 722c 206c 6162 656c 3d22 222c 202a 2a6b  r, label="", **k
+000176c0: 7761 7267 7329 3a0a 2020 2020 2020 2020  wargs):.        
+000176d0: 7375 7065 7228 292e 5f5f 696e 6974 5f5f  super().__init__
+000176e0: 286c 6162 656c 3d6c 6162 656c 2c20 2a2a  (label=label, **
+000176f0: 6b77 6172 6773 290a 2020 2020 2020 2020  kwargs).        
+00017700: 6966 2069 7369 6e73 7461 6e63 6528 6578  if isinstance(ex
+00017710: 7072 2c20 286c 6973 742c 2074 7570 6c65  pr, (list, tuple
+00017720: 2929 3a0a 2020 2020 2020 2020 2020 2020  )):.            
+00017730: 7365 6c66 2e65 7870 7220 3d20 5475 706c  self.expr = Tupl
+00017740: 6528 2a65 7870 7229 0a20 2020 2020 2020  e(*expr).       
+00017750: 2065 6c69 6620 6973 696e 7374 616e 6365   elif isinstance
+00017760: 2865 7870 722c 2045 7870 7229 3a0a 2020  (expr, Expr):.  
+00017770: 2020 2020 2020 2020 2020 7365 6c66 2e65            self.e
+00017780: 7870 7220 3d20 5475 706c 6528 6578 7072  xpr = Tuple(expr
+00017790: 290a 2020 2020 2020 2020 656c 7365 3a0a  ).        else:.
+000177a0: 2020 2020 2020 2020 2020 2020 7365 6c66              self
+000177b0: 2e65 7870 7220 3d20 6578 7072 0a0a 2020  .expr = expr..  
+000177c0: 2020 2020 2020 7365 6c66 2e5f 626c 6f63        self._bloc
+000177d0: 6b5f 6c61 6d62 6461 5f66 756e 6374 696f  k_lambda_functio
+000177e0: 6e73 282a 7365 6c66 2e65 7870 7229 0a0a  ns(*self.expr)..
+000177f0: 2020 2020 2020 2020 7365 6c66 2e69 735f          self.is_
+00017800: 706f 696e 7420 3d20 6b77 6172 6773 2e67  point = kwargs.g
+00017810: 6574 2822 7363 6174 7465 7222 2c20 6b77  et("scatter", kw
+00017820: 6172 6773 2e67 6574 2822 6973 5f70 6f69  args.get("is_poi
+00017830: 6e74 222c 2054 7275 6529 290a 2020 2020  nt", True)).    
+00017840: 2020 2020 6966 2073 656c 662e 7573 655f      if self.use_
+00017850: 636d 2061 6e64 2073 656c 662e 636f 6c6f  cm and self.colo
+00017860: 725f 6675 6e63 3a0a 2020 2020 2020 2020  r_func:.        
+00017870: 2020 2020 7365 6c66 2e69 735f 7061 7261      self.is_para
+00017880: 6d65 7472 6963 203d 2054 7275 650a 0a20  metric = True.. 
+00017890: 2020 2064 6566 205f 6765 745f 6461 7461     def _get_data
+000178a0: 5f68 656c 7065 7228 7365 6c66 293a 0a20  _helper(self):. 
+000178b0: 2020 2020 2020 2022 2222 5265 7475 726e         """Return
+000178c0: 7320 636f 6f72 6469 6e61 7465 7320 7468  s coordinates th
+000178d0: 6174 206e 6565 6473 2074 6f20 6265 2070  at needs to be p
+000178e0: 6f73 7470 726f 6365 7373 6564 2e22 2222  ostprocessed."""
+000178f0: 0a20 2020 2020 2020 206e 7020 3d20 696d  .        np = im
+00017900: 706f 7274 5f6d 6f64 756c 6528 276e 756d  port_module('num
+00017910: 7079 2729 0a20 2020 2020 2020 2070 6f69  py').        poi
+00017920: 6e74 7320 3d20 5b63 6f6d 706c 6578 2870  nts = [complex(p
+00017930: 2e65 7661 6c66 2873 7562 733d 7365 6c66  .evalf(subs=self
+00017940: 2e70 6172 616d 7329 2920 666f 7220 7020  .params)) for p 
+00017950: 696e 2073 656c 662e 6578 7072 5d0a 2020  in self.expr].  
+00017960: 2020 2020 2020 706f 696e 7473 203d 206e        points = n
+00017970: 702e 6172 7261 7928 706f 696e 7473 290a  p.array(points).
+00017980: 2020 2020 2020 2020 722c 2069 203d 206e          r, i = n
+00017990: 702e 7265 616c 2870 6f69 6e74 7329 2c20  p.real(points), 
+000179a0: 6e70 2e69 6d61 6728 706f 696e 7473 290a  np.imag(points).
+000179b0: 2020 2020 2020 2020 6966 2073 656c 662e          if self.
+000179c0: 7573 655f 636d 2061 6e64 2063 616c 6c61  use_cm and calla
+000179d0: 626c 6528 7365 6c66 2e63 6f6c 6f72 5f66  ble(self.color_f
+000179e0: 756e 6329 3a0a 2020 2020 2020 2020 2020  unc):.          
+000179f0: 2020 7265 7475 726e 2072 2c20 692c 2073    return r, i, s
+00017a00: 656c 662e 6576 616c 5f63 6f6c 6f72 5f66  elf.eval_color_f
+00017a10: 756e 6328 722c 2069 290a 2020 2020 2020  unc(r, i).      
+00017a20: 2020 7265 7475 726e 2072 2c20 690a 0a20    return r, i.. 
+00017a30: 2020 2064 6566 205f 5f73 7472 5f5f 2873     def __str__(s
+00017a40: 656c 6629 3a0a 2020 2020 2020 2020 7265  elf):.        re
+00017a50: 7475 726e 2073 656c 662e 5f73 7472 5f68  turn self._str_h
+00017a60: 656c 7065 7228 2263 6f6d 706c 6578 2070  elper("complex p
+00017a70: 6f69 6e74 733a 2025 7322 2025 2073 656c  oints: %s" % sel
+00017a80: 662e 6578 7072 290a 0a0a 636c 6173 7320  f.expr)...class 
+00017a90: 436f 6d70 6c65 7853 7572 6661 6365 4261  ComplexSurfaceBa
+00017aa0: 7365 5365 7269 6573 2853 7572 6661 6365  seSeries(Surface
+00017ab0: 4261 7365 5365 7269 6573 293a 0a20 2020  BaseSeries):.   
+00017ac0: 2022 2222 5265 7072 6573 656e 7420 6120   """Represent a 
+00017ad0: 636f 6d70 6c65 7820 6675 6e63 7469 6f6e  complex function
+00017ae0: 2e22 2222 0a20 2020 2069 735f 636f 6d70  .""".    is_comp
+00017af0: 6c65 7820 3d20 5472 7565 0a20 2020 205f  lex = True.    _
+00017b00: 4e20 3d20 3330 300a 0a20 2020 2064 6566  N = 300..    def
+00017b10: 205f 5f69 6e69 745f 5f28 7365 6c66 2c20   __init__(self, 
+00017b20: 6578 7072 2c20 722c 206c 6162 656c 3d22  expr, r, label="
+00017b30: 222c 202a 2a6b 7761 7267 7329 3a0a 2020  ", **kwargs):.  
+00017b40: 2020 2020 2020 7375 7065 7228 292e 5f5f        super().__
+00017b50: 696e 6974 5f5f 282a 2a6b 7761 7267 7329  init__(**kwargs)
+00017b60: 0a20 2020 2020 2020 2073 656c 662e 7261  .        self.ra
+00017b70: 6e67 6573 203d 205b 725d 0a20 2020 2020  nges = [r].     
+00017b80: 2020 2073 656c 662e 5f6c 6162 656c 203d     self._label =
+00017b90: 2073 7472 2865 7870 7229 2069 6620 6c61   str(expr) if la
+00017ba0: 6265 6c20 6973 204e 6f6e 6520 656c 7365  bel is None else
+00017bb0: 206c 6162 656c 0a20 2020 2020 2020 2073   label.        s
+00017bc0: 656c 662e 5f6c 6174 6578 5f6c 6162 656c  elf._latex_label
+00017bd0: 203d 206c 6174 6578 2865 7870 7229 2069   = latex(expr) i
+00017be0: 6620 6c61 6265 6c20 6973 204e 6f6e 6520  f label is None 
+00017bf0: 656c 7365 206c 6162 656c 0a20 2020 2020  else label.     
+00017c00: 2020 2023 2064 6574 6572 6d69 6e65 7320     # determines 
+00017c10: 7768 6174 2064 6174 6120 746f 2072 6574  what data to ret
+00017c20: 7572 6e20 6f6e 2074 6865 207a 2d61 7869  urn on the z-axi
+00017c30: 730a 2020 2020 2020 2020 7365 6c66 2e5f  s.        self._
+00017c40: 7265 7475 726e 203d 206b 7761 7267 732e  return = kwargs.
+00017c50: 6765 7428 2272 6574 7572 6e22 2c20 4e6f  get("return", No
+00017c60: 6e65 290a 0a20 2020 2040 7072 6f70 6572  ne)..    @proper
+00017c70: 7479 0a20 2020 2064 6566 2076 6172 2873  ty.    def var(s
+00017c80: 656c 6629 3a0a 2020 2020 2020 2020 7265  elf):.        re
+00017c90: 7475 726e 2073 656c 662e 7261 6e67 6573  turn self.ranges
+00017ca0: 5b30 5d5b 305d 0a0a 2020 2020 4070 726f  [0][0]..    @pro
+00017cb0: 7065 7274 790a 2020 2020 6465 6620 7374  perty.    def st
+00017cc0: 6172 7428 7365 6c66 293a 0a20 2020 2020  art(self):.     
+00017cd0: 2020 2072 6574 7572 6e20 7365 6c66 2e72     return self.r
+00017ce0: 616e 6765 735b 305d 5b31 5d0a 0a20 2020  anges[0][1]..   
+00017cf0: 2040 7072 6f70 6572 7479 0a20 2020 2064   @property.    d
+00017d00: 6566 2065 6e64 2873 656c 6629 3a0a 2020  ef end(self):.  
+00017d10: 2020 2020 2020 7265 7475 726e 2073 656c        return sel
+00017d20: 662e 7261 6e67 6573 5b30 5d5b 325d 0a0a  f.ranges[0][2]..
+00017d30: 2020 2020 6465 6620 5f5f 7374 725f 5f28      def __str__(
+00017d40: 7365 6c66 293a 0a20 2020 2020 2020 2069  self):.        i
+00017d50: 6620 7365 6c66 2e69 735f 646f 6d61 696e  f self.is_domain
+00017d60: 5f63 6f6c 6f72 696e 673a 0a20 2020 2020  _coloring:.     
+00017d70: 2020 2020 2020 2070 7265 6669 7820 3d20         prefix = 
+00017d80: 2263 6f6d 706c 6578 2064 6f6d 6169 6e20  "complex domain 
+00017d90: 636f 6c6f 7269 6e67 220a 2020 2020 2020  coloring".      
+00017da0: 2020 2020 2020 6966 2073 656c 662e 6973        if self.is
+00017db0: 5f33 4473 7572 6661 6365 3a0a 2020 2020  _3Dsurface:.    
+00017dc0: 2020 2020 2020 2020 2020 2020 7072 6566              pref
+00017dd0: 6978 203d 2022 636f 6d70 6c65 7820 3344  ix = "complex 3D
+00017de0: 2064 6f6d 6169 6e20 636f 6c6f 7269 6e67   domain coloring
+00017df0: 220a 2020 2020 2020 2020 656c 7365 3a0a  ".        else:.
+00017e00: 2020 2020 2020 2020 2020 2020 7072 6566              pref
+00017e10: 6978 203d 2022 636f 6d70 6c65 7820 6361  ix = "complex ca
+00017e20: 7274 6573 6961 6e20 7375 7266 6163 6522  rtesian surface"
+00017e30: 0a20 2020 2020 2020 2020 2020 2069 6620  .            if 
+00017e40: 7365 6c66 2e69 735f 636f 6e74 6f75 723a  self.is_contour:
+00017e50: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00017e60: 2070 7265 6669 7820 3d20 2263 6f6d 706c   prefix = "compl
+00017e70: 6578 2063 6f6e 746f 7572 220a 0a20 2020  ex contour"..   
+00017e80: 2020 2020 2077 7261 7070 6572 203d 205f       wrapper = _
+00017e90: 6765 745f 7772 6170 7065 725f 666f 725f  get_wrapper_for_
+00017ea0: 6578 7072 2873 656c 662e 5f72 6574 7572  expr(self._retur
+00017eb0: 6e29 0a20 2020 2020 2020 2072 6573 2c20  n).        res, 
+00017ec0: 7265 6520 3d20 7265 2873 656c 662e 7374  ree = re(self.st
+00017ed0: 6172 7429 2c20 7265 2873 656c 662e 656e  art), re(self.en
+00017ee0: 6429 0a20 2020 2020 2020 2069 6d73 2c20  d).        ims, 
+00017ef0: 696d 6520 3d20 696d 2873 656c 662e 7374  ime = im(self.st
+00017f00: 6172 7429 2c20 696d 2873 656c 662e 656e  art), im(self.en
+00017f10: 6429 0a20 2020 2020 2020 2066 203d 206c  d).        f = l
+00017f20: 616d 6264 6120 743a 2066 6c6f 6174 2874  ambda t: float(t
+00017f30: 2920 6966 206c 656e 2874 2e66 7265 655f  ) if len(t.free_
+00017f40: 7379 6d62 6f6c 7329 203d 3d20 3020 656c  symbols) == 0 el
+00017f50: 7365 2074 0a0a 2020 2020 2020 2020 7265  se t..        re
+00017f60: 7475 726e 2073 656c 662e 5f73 7472 5f68  turn self._str_h
+00017f70: 656c 7065 7228 0a20 2020 2020 2020 2020  elper(.         
+00017f80: 2020 2070 7265 6669 7820 2b20 223a 2025     prefix + ": %
+00017f90: 7320 666f 7222 2022 2072 6528 2573 2920  s for" " re(%s) 
+00017fa0: 6f76 6572 2025 7320 616e 6420 696d 2825  over %s and im(%
+00017fb0: 7329 206f 7665 7220 2573 2220 2520 280a  s) over %s" % (.
+00017fc0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00017fd0: 7772 6170 7065 7220 2520 7365 6c66 2e65  wrapper % self.e
+00017fe0: 7870 722c 0a20 2020 2020 2020 2020 2020  xpr,.           
+00017ff0: 2020 2020 2073 7472 2873 656c 662e 7661       str(self.va
+00018000: 7229 2c0a 2020 2020 2020 2020 2020 2020  r),.            
+00018010: 2020 2020 7374 7228 2866 2872 6573 292c      str((f(res),
+00018020: 2066 2872 6565 2929 292c 0a20 2020 2020   f(ree))),.     
+00018030: 2020 2020 2020 2020 2020 2073 7472 2873             str(s
+00018040: 656c 662e 7661 7229 2c0a 2020 2020 2020  elf.var),.      
+00018050: 2020 2020 2020 2020 2020 7374 7228 2866            str((f
+00018060: 2869 6d73 292c 2066 2869 6d65 2929 292c  (ims), f(ime))),
+00018070: 0a20 2020 2020 2020 2020 2020 2029 0a20  .            ). 
+00018080: 2020 2020 2020 2029 0a0a 2020 2020 6465         )..    de
+00018090: 6620 5f63 7265 6174 655f 6469 7363 7265  f _create_discre
+000180a0: 7469 7a65 645f 646f 6d61 696e 2873 656c  tized_domain(sel
+000180b0: 6629 3a0a 2020 2020 2020 2020 2222 2244  f):.        """D
+000180c0: 6973 6372 6574 697a 6520 7468 6520 7261  iscretize the ra
+000180d0: 6e67 6573 2069 6e20 6361 7365 206f 6620  nges in case of 
+000180e0: 756e 6966 6f72 6d20 6d65 7368 696e 6720  uniform meshing 
+000180f0: 7374 7261 7465 6779 2e0a 2020 2020 2020  strategy..      
+00018100: 2020 2222 220a 2020 2020 2020 2020 6e70    """.        np
+00018110: 203d 2069 6d70 6f72 745f 6d6f 6475 6c65   = import_module
+00018120: 2827 6e75 6d70 7927 290a 2020 2020 2020  ('numpy').      
+00018130: 2020 7374 6172 745f 7820 3d20 7365 6c66    start_x = self
+00018140: 2e5f 7570 6461 7465 5f72 616e 6765 5f76  ._update_range_v
+00018150: 616c 7565 2873 656c 662e 7374 6172 7429  alue(self.start)
+00018160: 2e72 6561 6c0a 2020 2020 2020 2020 656e  .real.        en
+00018170: 645f 7820 3d20 7365 6c66 2e5f 7570 6461  d_x = self._upda
+00018180: 7465 5f72 616e 6765 5f76 616c 7565 2873  te_range_value(s
+00018190: 656c 662e 656e 6429 2e72 6561 6c0a 2020  elf.end).real.  
+000181a0: 2020 2020 2020 7374 6172 745f 7920 3d20        start_y = 
+000181b0: 7365 6c66 2e5f 7570 6461 7465 5f72 616e  self._update_ran
+000181c0: 6765 5f76 616c 7565 2873 656c 662e 7374  ge_value(self.st
+000181d0: 6172 7429 2e69 6d61 670a 2020 2020 2020  art).imag.      
+000181e0: 2020 656e 645f 7920 3d20 7365 6c66 2e5f    end_y = self._
+000181f0: 7570 6461 7465 5f72 616e 6765 5f76 616c  update_range_val
+00018200: 7565 2873 656c 662e 656e 6429 2e69 6d61  ue(self.end).ima
+00018210: 670a 2020 2020 2020 2020 7820 3d20 7365  g.        x = se
+00018220: 6c66 2e5f 6469 7363 7265 7469 7a65 280a  lf._discretize(.
+00018230: 2020 2020 2020 2020 2020 2020 7374 6172              star
+00018240: 745f 782c 2065 6e64 5f78 2c20 7365 6c66  t_x, end_x, self
+00018250: 2e6e 5b30 5d2c 2073 656c 662e 7363 616c  .n[0], self.scal
+00018260: 6573 5b30 5d2c 2073 656c 662e 6f6e 6c79  es[0], self.only
+00018270: 5f69 6e74 6567 6572 7329 0a20 2020 2020  _integers).     
+00018280: 2020 2079 203d 2073 656c 662e 5f64 6973     y = self._dis
+00018290: 6372 6574 697a 6528 0a20 2020 2020 2020  cretize(.       
+000182a0: 2020 2020 2073 7461 7274 5f79 2c20 656e       start_y, en
+000182b0: 645f 792c 2073 656c 662e 6e5b 315d 2c20  d_y, self.n[1], 
+000182c0: 7365 6c66 2e73 6361 6c65 735b 315d 2c20  self.scales[1], 
+000182d0: 7365 6c66 2e6f 6e6c 795f 696e 7465 6765  self.only_intege
+000182e0: 7273 290a 2020 2020 2020 2020 7878 2c20  rs).        xx, 
+000182f0: 7979 203d 206e 702e 6d65 7368 6772 6964  yy = np.meshgrid
+00018300: 2878 2c20 7929 0a20 2020 2020 2020 2064  (x, y).        d
+00018310: 6f6d 6169 6e20 3d20 7878 202b 2031 6a20  omain = xx + 1j 
+00018320: 2a20 7979 0a20 2020 2020 2020 2073 656c  * yy.        sel
+00018330: 662e 5f64 6973 6372 6574 697a 6564 5f64  f._discretized_d
+00018340: 6f6d 6169 6e20 3d20 7b73 656c 662e 7661  omain = {self.va
+00018350: 723a 2064 6f6d 6169 6e7d 0a0a 0a63 6c61  r: domain}...cla
+00018360: 7373 2043 6f6d 706c 6578 5375 7266 6163  ss ComplexSurfac
+00018370: 6553 6572 6965 7328 0a20 2020 2043 6f6d  eSeries(.    Com
+00018380: 6d6f 6e55 6e69 666f 726d 4576 616c 7561  monUniformEvalua
+00018390: 7469 6f6e 2c20 436f 6d70 6c65 7853 7572  tion, ComplexSur
+000183a0: 6661 6365 4261 7365 5365 7269 6573 0a29  faceBaseSeries.)
+000183b0: 3a0a 2020 2020 2222 2252 6570 7265 7365  :.    """Represe
+000183c0: 6e74 7320 6120 3344 2073 7572 6661 6365  nts a 3D surface
+000183d0: 206f 7220 636f 6e74 6f75 7220 706c 6f74   or contour plot
+000183e0: 206f 6620 6120 636f 6d70 6c65 7820 6675   of a complex fu
+000183f0: 6e63 7469 6f6e 206f 7665 720a 2020 2020  nction over.    
+00018400: 7468 6520 636f 6d70 6c65 7820 706c 616e  the complex plan
+00018410: 652e 0a20 2020 2022 2222 0a20 2020 2069  e..    """.    i
+00018420: 735f 3344 7375 7266 6163 6520 3d20 5472  s_3Dsurface = Tr
+00018430: 7565 0a20 2020 2069 735f 636f 6e74 6f75  ue.    is_contou
+00018440: 7220 3d20 4661 6c73 650a 2020 2020 6973  r = False.    is
+00018450: 5f64 6f6d 6169 6e5f 636f 6c6f 7269 6e67  _domain_coloring
+00018460: 203d 2046 616c 7365 0a20 2020 205f 616c   = False.    _al
+00018470: 6c6f 7765 645f 6b65 7973 203d 205b 2274  lowed_keys = ["t
+00018480: 6872 6565 6422 2c20 2269 735f 6669 6c6c  hreed", "is_fill
+00018490: 6564 222c 2022 636c 6162 656c 7322 5d0a  ed", "clabels"].
+000184a0: 0a20 2020 2064 6566 205f 5f69 6e69 745f  .    def __init_
+000184b0: 5f28 7365 6c66 2c20 6578 7072 2c20 722c  _(self, expr, r,
+000184c0: 206c 6162 656c 3d22 222c 202a 2a6b 7761   label="", **kwa
+000184d0: 7267 7329 3a0a 2020 2020 2020 2020 7375  rgs):.        su
+000184e0: 7065 7228 292e 5f5f 696e 6974 5f5f 2865  per().__init__(e
+000184f0: 7870 722c 2072 2c20 6c61 6265 6c2c 202a  xpr, r, label, *
+00018500: 2a6b 7761 7267 7329 0a0a 2020 2020 2020  *kwargs)..      
+00018510: 2020 7365 6c66 2e65 7870 7220 3d20 6578    self.expr = ex
+00018520: 7072 2069 6620 6361 6c6c 6162 6c65 2865  pr if callable(e
+00018530: 7870 7229 2065 6c73 6520 7379 6d70 6966  xpr) else sympif
+00018540: 7928 6578 7072 290a 2020 2020 2020 2020  y(expr).        
+00018550: 6966 2069 7369 6e73 7461 6e63 6528 7365  if isinstance(se
+00018560: 6c66 2c20 436f 6d70 6c65 7853 7572 6661  lf, ComplexSurfa
+00018570: 6365 5365 7269 6573 293a 0a20 2020 2020  ceSeries):.     
+00018580: 2020 2020 2020 2073 656c 662e 5f62 6c6f         self._blo
+00018590: 636b 5f6c 616d 6264 615f 6675 6e63 7469  ck_lambda_functi
+000185a0: 6f6e 7328 7365 6c66 2e65 7870 7229 0a0a  ons(self.expr)..
+000185b0: 2020 2020 2020 2020 6966 206e 6f74 206b          if not k
+000185c0: 7761 7267 732e 6765 7428 2274 6872 6565  wargs.get("three
+000185d0: 6422 2c20 4661 6c73 6529 3a0a 2020 2020  d", False):.    
+000185e0: 2020 2020 2020 2020 7365 6c66 2e69 735f          self.is_
+000185f0: 636f 6e74 6f75 7220 3d20 5472 7565 0a20  contour = True. 
+00018600: 2020 2020 2020 2020 2020 2073 656c 662e             self.
+00018610: 6973 5f33 4473 7572 6661 6365 203d 2046  is_3Dsurface = F
+00018620: 616c 7365 0a20 2020 2020 2020 2020 2020  alse.           
+00018630: 2073 656c 662e 7573 655f 636d 203d 2054   self.use_cm = T
+00018640: 7275 650a 2020 2020 2020 2020 7365 6c66  rue.        self
+00018650: 2e69 735f 6669 6c6c 6564 203d 206b 7761  .is_filled = kwa
+00018660: 7267 732e 6765 7428 2269 735f 6669 6c6c  rgs.get("is_fill
+00018670: 6564 222c 206b 7761 7267 732e 6765 7428  ed", kwargs.get(
+00018680: 2266 696c 6c22 2c20 5472 7565 2929 0a20  "fill", True)). 
+00018690: 2020 2020 2020 2073 656c 662e 7368 6f77         self.show
+000186a0: 5f63 6c61 6265 6c73 203d 206b 7761 7267  _clabels = kwarg
+000186b0: 732e 6765 7428 2263 6c61 6265 6c73 222c  s.get("clabels",
+000186c0: 2054 7275 6529 0a20 2020 2020 2020 2073   True).        s
+000186d0: 656c 662e 5f70 6f73 745f 696e 6974 2829  elf._post_init()
+000186e0: 0a0a 2020 2020 6465 6620 5f63 7265 6174  ..    def _creat
+000186f0: 655f 6469 7363 7265 7469 7a65 645f 646f  e_discretized_do
+00018700: 6d61 696e 2873 656c 6629 3a0a 2020 2020  main(self):.    
+00018710: 2020 2020 7265 7475 726e 2043 6f6d 706c      return Compl
+00018720: 6578 5375 7266 6163 6542 6173 6553 6572  exSurfaceBaseSer
+00018730: 6965 732e 5f63 7265 6174 655f 6469 7363  ies._create_disc
+00018740: 7265 7469 7a65 645f 646f 6d61 696e 2873  retized_domain(s
+00018750: 656c 6629 0a0a 2020 2020 6465 6620 6765  elf)..    def ge
+00018760: 745f 6461 7461 2873 656c 6629 3a0a 2020  t_data(self):.  
+00018770: 2020 2020 2020 2222 2252 6574 7572 6e20        """Return 
+00018780: 6172 7261 7973 206f 6620 636f 6f72 6469  arrays of coordi
+00018790: 6e61 7465 7320 666f 7220 706c 6f74 7469  nates for plotti
+000187a0: 6e67 2e0a 0a20 2020 2020 2020 2052 6574  ng...        Ret
+000187b0: 7572 6e73 0a20 2020 2020 2020 203d 3d3d  urns.        ===
+000187c0: 3d3d 3d3d 0a0a 2020 2020 2020 2020 6d65  ====..        me
+000187d0: 7368 5f78 203a 206e 702e 6e64 6172 7261  sh_x : np.ndarra
+000187e0: 7920 5b6e 3220 7820 6e31 5d0a 2020 2020  y [n2 x n1].    
+000187f0: 2020 2020 2020 2020 5265 616c 2064 6973          Real dis
+00018800: 6372 6574 697a 6564 2064 6f6d 6169 6e2e  cretized domain.
+00018810: 0a0a 2020 2020 2020 2020 6d65 7368 5f79  ..        mesh_y
+00018820: 203a 206e 702e 6e64 6172 7261 7920 5b6e   : np.ndarray [n
+00018830: 3220 7820 6e31 5d0a 2020 2020 2020 2020  2 x n1].        
+00018840: 2020 2020 496d 6167 696e 6172 7920 6469      Imaginary di
+00018850: 7363 7265 7469 7a65 6420 646f 6d61 696e  scretized domain
+00018860: 2e0a 0a20 2020 2020 2020 207a 203a 206e  ...        z : n
+00018870: 702e 6e64 6172 7261 7920 5b6e 3220 7820  p.ndarray [n2 x 
+00018880: 6e31 5d0a 2020 2020 2020 2020 2020 2020  n1].            
+00018890: 5265 7375 6c74 7320 6f66 2074 6865 2065  Results of the e
+000188a0: 7661 6c75 6174 696f 6e2e 0a20 2020 2020  valuation..     
+000188b0: 2020 2022 2222 0a20 2020 2020 2020 206e     """.        n
+000188c0: 7020 3d20 696d 706f 7274 5f6d 6f64 756c  p = import_modul
+000188d0: 6528 276e 756d 7079 2729 0a0a 2020 2020  e('numpy')..    
+000188e0: 2020 2020 646f 6d61 696e 2c20 7a20 3d20      domain, z = 
+000188f0: 7365 6c66 2e5f 6576 616c 7561 7465 2846  self._evaluate(F
+00018900: 616c 7365 290a 2020 2020 2020 2020 6966  alse).        if
+00018910: 2073 656c 662e 5f72 6574 7572 6e20 6973   self._return is
+00018920: 204e 6f6e 653a 0a20 2020 2020 2020 2020   None:.         
+00018930: 2020 2070 6173 730a 2020 2020 2020 2020     pass.        
+00018940: 656c 6966 2073 656c 662e 5f72 6574 7572  elif self._retur
+00018950: 6e20 3d3d 2022 7265 616c 223a 0a20 2020  n == "real":.   
+00018960: 2020 2020 2020 2020 207a 203d 206e 702e           z = np.
+00018970: 7265 616c 287a 290a 2020 2020 2020 2020  real(z).        
+00018980: 656c 6966 2073 656c 662e 5f72 6574 7572  elif self._retur
+00018990: 6e20 3d3d 2022 696d 6167 223a 0a20 2020  n == "imag":.   
+000189a0: 2020 2020 2020 2020 207a 203d 206e 702e           z = np.
+000189b0: 696d 6167 287a 290a 2020 2020 2020 2020  imag(z).        
+000189c0: 656c 6966 2073 656c 662e 5f72 6574 7572  elif self._retur
+000189d0: 6e20 3d3d 2022 6162 7322 3a0a 2020 2020  n == "abs":.    
+000189e0: 2020 2020 2020 2020 7a20 3d20 6e70 2e61          z = np.a
+000189f0: 6273 6f6c 7574 6528 7a29 0a20 2020 2020  bsolute(z).     
+00018a00: 2020 2065 6c69 6620 7365 6c66 2e5f 7265     elif self._re
+00018a10: 7475 726e 203d 3d20 2261 7267 223a 0a20  turn == "arg":. 
+00018a20: 2020 2020 2020 2020 2020 207a 203d 206e             z = n
+00018a30: 702e 616e 676c 6528 7a29 0a20 2020 2020  p.angle(z).     
+00018a40: 2020 2065 6c73 653a 0a20 2020 2020 2020     else:.       
+00018a50: 2020 2020 2072 6169 7365 2056 616c 7565       raise Value
+00018a60: 4572 726f 7228 0a20 2020 2020 2020 2020  Error(.         
+00018a70: 2020 2020 2020 2022 605f 7265 7475 726e         "`_return
+00018a80: 6020 6e6f 7420 7265 636f 676e 697a 6564  ` not recognized
+00018a90: 2e20 5265 6365 6976 6564 3a20 2573 2220  . Received: %s" 
+00018aa0: 2520 7365 6c66 2e5f 7265 7475 726e 290a  % self._return).
+00018ab0: 0a20 2020 2020 2020 2072 6574 7572 6e20  .        return 
+00018ac0: 7365 6c66 2e5f 6170 706c 795f 7472 616e  self._apply_tran
+00018ad0: 7366 6f72 6d28 6e70 2e72 6561 6c28 646f  sform(np.real(do
+00018ae0: 6d61 696e 292c 206e 702e 696d 6167 2864  main), np.imag(d
+00018af0: 6f6d 6169 6e29 2c20 7a29 0a0a 0a63 6c61  omain), z)...cla
+00018b00: 7373 2043 6f6d 706c 6578 446f 6d61 696e  ss ComplexDomain
+00018b10: 436f 6c6f 7269 6e67 5365 7269 6573 280a  ColoringSeries(.
+00018b20: 2020 2020 436f 6d6d 6f6e 556e 6966 6f72      CommonUnifor
+00018b30: 6d45 7661 6c75 6174 696f 6e2c 2043 6f6d  mEvaluation, Com
+00018b40: 706c 6578 5375 7266 6163 6542 6173 6553  plexSurfaceBaseS
+00018b50: 6572 6965 730a 293a 0a20 2020 2022 2222  eries.):.    """
+00018b60: 5265 7072 6573 656e 7473 2061 2032 442f  Represents a 2D/
+00018b70: 3344 2064 6f6d 6169 6e20 636f 6c6f 7269  3D domain colori
+00018b80: 6e67 2070 6c6f 7420 6f66 2061 2063 6f6d  ng plot of a com
+00018b90: 706c 6578 2066 756e 6374 696f 6e20 6f76  plex function ov
+00018ba0: 6572 0a20 2020 2074 6865 2063 6f6d 706c  er.    the compl
+00018bb0: 6578 2070 6c61 6e65 2e0a 2020 2020 2222  ex plane..    ""
+00018bc0: 220a 2020 2020 6973 5f33 4473 7572 6661  ".    is_3Dsurfa
+00018bd0: 6365 203d 2046 616c 7365 0a20 2020 2069  ce = False.    i
+00018be0: 735f 646f 6d61 696e 5f63 6f6c 6f72 696e  s_domain_colorin
+00018bf0: 6720 3d20 5472 7565 0a20 2020 205f 616c  g = True.    _al
+00018c00: 6c6f 7765 645f 6b65 7973 203d 205b 0a20  lowed_keys = [. 
+00018c10: 2020 2020 2020 2022 7468 7265 6564 222c         "threed",
+00018c20: 2022 636f 6c6f 7269 6e67 222c 2022 7068   "coloring", "ph
+00018c30: 6173 6572 6573 222c 2022 636d 6170 222c  aseres", "cmap",
+00018c40: 2022 626c 6576 656c 222c 2022 7068 6173   "blevel", "phas
+00018c50: 656f 6666 7365 7422 2c0a 2020 2020 2020  eoffset",.      
+00018c60: 2020 2263 6f6c 6f72 6261 7222 2c20 2261    "colorbar", "a
+00018c70: 745f 696e 6669 6e69 7479 222c 2022 7269  t_infinity", "ri
+00018c80: 656d 616e 6e5f 6d61 736b 222c 2022 616e  emann_mask", "an
+00018c90: 6e6f 7461 7465 220a 2020 2020 5d0a 0a20  notate".    ].. 
+00018ca0: 2020 2064 6566 205f 5f69 6e69 745f 5f28     def __init__(
+00018cb0: 7365 6c66 2c20 6578 7072 2c20 722c 206c  self, expr, r, l
+00018cc0: 6162 656c 3d22 222c 202a 2a6b 7761 7267  abel="", **kwarg
+00018cd0: 7329 3a0a 2020 2020 2020 2020 7375 7065  s):.        supe
+00018ce0: 7228 292e 5f5f 696e 6974 5f5f 2865 7870  r().__init__(exp
+00018cf0: 722c 2072 2c20 6c61 6265 6c2c 202a 2a6b  r, r, label, **k
+00018d00: 7761 7267 7329 0a20 2020 2020 2020 2069  wargs).        i
+00018d10: 6620 6b77 6172 6773 2e67 6574 2822 7468  f kwargs.get("th
+00018d20: 7265 6564 222c 2046 616c 7365 293a 0a20  reed", False):. 
+00018d30: 2020 2020 2020 2020 2020 2073 656c 662e             self.
+00018d40: 6973 5f33 4473 7572 6661 6365 203d 2054  is_3Dsurface = T
+00018d50: 7275 650a 2020 2020 2020 2020 2020 2020  rue.            
+00018d60: 7365 6c66 2e75 7365 5f63 6d20 3d20 6b77  self.use_cm = kw
+00018d70: 6172 6773 2e67 6574 2822 7573 655f 636d  args.get("use_cm
+00018d80: 222c 2054 7275 6529 0a0a 2020 2020 2020  ", True)..      
+00018d90: 2020 7365 6c66 2e65 7870 7220 3d20 6578    self.expr = ex
+00018da0: 7072 2069 6620 6361 6c6c 6162 6c65 2865  pr if callable(e
+00018db0: 7870 7229 2065 6c73 6520 7379 6d70 6966  xpr) else sympif
+00018dc0: 7928 6578 7072 290a 2020 2020 2020 2020  y(expr).        
+00018dd0: 2320 6170 706c 7920 7468 6520 7472 616e  # apply the tran
+00018de0: 7366 6f72 6d61 7469 6f6e 207a 202d 3e20  sformation z -> 
+00018df0: 312f 7a20 696e 206f 7264 6572 2074 6f20  1/z in order to 
+00018e00: 7374 7564 7920 7468 6520 6265 6861 7669  study the behavi
+00018e10: 6f72 0a20 2020 2020 2020 2023 206f 6620  or.        # of 
+00018e20: 7468 6520 6675 6e63 7469 6f6e 2061 7420  the function at 
+00018e30: 7a3d 696e 6669 6e69 7479 0a20 2020 2020  z=infinity.     
+00018e40: 2020 2073 656c 662e 6174 5f69 6e66 696e     self.at_infin
+00018e50: 6974 7920 3d20 6b77 6172 6773 2e67 6574  ity = kwargs.get
+00018e60: 2822 6174 5f69 6e66 696e 6974 7922 2c20  ("at_infinity", 
+00018e70: 4661 6c73 6529 0a20 2020 2020 2020 2069  False).        i
+00018e80: 6620 7365 6c66 2e61 745f 696e 6669 6e69  f self.at_infini
+00018e90: 7479 3a0a 2020 2020 2020 2020 2020 2020  ty:.            
+00018ea0: 6966 2063 616c 6c61 626c 6528 7365 6c66  if callable(self
+00018eb0: 2e65 7870 7229 3a0a 2020 2020 2020 2020  .expr):.        
+00018ec0: 2020 2020 2020 2020 7261 6973 6520 5661          raise Va
+00018ed0: 6c75 6545 7272 6f72 280a 2020 2020 2020  lueError(.      
+00018ee0: 2020 2020 2020 2020 2020 2020 2020 2260                "`
+00018ef0: 6061 745f 696e 6669 6e69 7479 3d54 7275  `at_infinity=Tru
+00018f00: 6560 6020 6973 206f 6e6c 7920 7375 7070  e`` is only supp
+00018f10: 6f72 7465 6420 666f 7220 7379 6d62 6f6c  orted for symbol
+00018f20: 6963 2022 0a20 2020 2020 2020 2020 2020  ic ".           
+00018f30: 2020 2020 2020 2020 2022 6578 7072 6573           "expres
+00018f40: 7369 6f6e 732e 2049 6e73 7465 6164 2c20  sions. Instead, 
+00018f50: 6120 6361 6c6c 6162 6c65 2077 6173 2070  a callable was p
+00018f60: 726f 7669 6465 642e 2229 0a20 2020 2020  rovided.").     
+00018f70: 2020 2020 2020 207a 203d 2073 656c 662e         z = self.
+00018f80: 7261 6e67 6573 5b30 5d5b 305d 0a20 2020  ranges[0][0].   
+00018f90: 2020 2020 2020 2020 2074 6d70 203d 2073           tmp = s
+00018fa0: 656c 662e 6578 7072 2e73 7562 7328 7a2c  elf.expr.subs(z,
+00018fb0: 2031 202f 207a 290a 2020 2020 2020 2020   1 / z).        
+00018fc0: 2020 2020 6966 2073 656c 662e 5f6c 6162      if self._lab
+00018fd0: 656c 203d 3d20 7374 7228 7365 6c66 2e65  el == str(self.e
+00018fe0: 7870 7229 3a0a 2020 2020 2020 2020 2020  xpr):.          
+00018ff0: 2020 2020 2020 2320 6164 6a75 7374 206c        # adjust l
+00019000: 6162 656c 7320 746f 2070 7265 7665 6e74  abels to prevent
+00019010: 2074 6865 2077 726f 6e67 206f 6e65 2074   the wrong one t
+00019020: 6f20 6265 2073 6565 6e20 6f6e 2063 6f6c  o be seen on col
+00019030: 6f72 6261 720a 2020 2020 2020 2020 2020  orbar.          
+00019040: 2020 2020 2020 7365 6c66 2e5f 6c61 6265        self._labe
+00019050: 6c20 3d20 7374 7228 746d 7029 0a20 2020  l = str(tmp).   
+00019060: 2020 2020 2020 2020 2020 2020 2073 656c               sel
+00019070: 662e 5f6c 6174 6578 5f6c 6162 656c 203d  f._latex_label =
+00019080: 206c 6174 6578 2874 6d70 290a 2020 2020   latex(tmp).    
+00019090: 2020 2020 2020 2020 7365 6c66 2e65 7870          self.exp
+000190a0: 7220 3d20 746d 700a 0a20 2020 2020 2020  r = tmp..       
+000190b0: 2023 2064 6f6d 6169 6e20 636f 6c6f 7269   # domain colori
+000190c0: 6e67 206d 6f64 650a 2020 2020 2020 2020  ng mode.        
+000190d0: 7365 6c66 2e5f 696e 6974 5f64 6f6d 6169  self._init_domai
+000190e0: 6e5f 636f 6c6f 7269 6e67 5f6b 7728 2a2a  n_coloring_kw(**
+000190f0: 6b77 6172 6773 290a 0a20 2020 2020 2020  kwargs)..       
+00019100: 2073 656c 662e 616e 6e6f 7461 7465 203d   self.annotate =
+00019110: 206b 7761 7267 732e 6765 7428 2261 6e6e   kwargs.get("ann
+00019120: 6f74 6174 6522 2c20 5472 7565 290a 2020  otate", True).  
+00019130: 2020 2020 2020 7365 6c66 2e72 6965 6d61        self.riema
+00019140: 6e6e 5f6d 6173 6b20 3d20 6b77 6172 6773  nn_mask = kwargs
+00019150: 2e67 6574 2822 7269 656d 616e 6e5f 6d61  .get("riemann_ma
+00019160: 736b 222c 2046 616c 7365 290a 2020 2020  sk", False).    
+00019170: 2020 2020 7365 6c66 2e5f 706f 7374 5f69      self._post_i
+00019180: 6e69 7428 290a 0a20 2020 2064 6566 205f  nit()..    def _
+00019190: 696e 6974 5f64 6f6d 6169 6e5f 636f 6c6f  init_domain_colo
+000191a0: 7269 6e67 5f6b 7728 7365 6c66 2c20 2a2a  ring_kw(self, **
+000191b0: 6b77 6172 6773 293a 0a20 2020 2020 2020  kwargs):.       
+000191c0: 2073 656c 662e 636f 6c6f 7269 6e67 203d   self.coloring =
+000191d0: 206b 7761 7267 732e 6765 7428 2263 6f6c   kwargs.get("col
+000191e0: 6f72 696e 6722 2c20 2261 2229 0a20 2020  oring", "a").   
+000191f0: 2020 2020 2069 6620 6973 696e 7374 616e       if isinstan
+00019200: 6365 2873 656c 662e 636f 6c6f 7269 6e67  ce(self.coloring
+00019210: 2c20 7374 7229 3a0a 2020 2020 2020 2020  , str):.        
+00019220: 2020 2020 7365 6c66 2e63 6f6c 6f72 696e      self.colorin
+00019230: 6720 3d20 7365 6c66 2e63 6f6c 6f72 696e  g = self.colorin
+00019240: 672e 6c6f 7765 7228 290a 2020 2020 2020  g.lower().      
+00019250: 2020 656c 6966 206e 6f74 2063 616c 6c61    elif not calla
+00019260: 626c 6528 7365 6c66 2e63 6f6c 6f72 696e  ble(self.colorin
+00019270: 6729 3a0a 2020 2020 2020 2020 2020 2020  g):.            
+00019280: 7261 6973 6520 5479 7065 4572 726f 7228  raise TypeError(
+00019290: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+000192a0: 2022 6063 6f6c 6f72 696e 6760 206d 7573   "`coloring` mus
+000192b0: 7420 6265 2061 2063 6861 7261 6374 6572  t be a character
+000192c0: 2066 726f 6d20 2761 2720 746f 2027 6a27   from 'a' to 'j'
+000192d0: 206f 7220 220a 2020 2020 2020 2020 2020   or ".          
+000192e0: 2020 2020 2020 2261 2063 616c 6c61 626c        "a callabl
+000192f0: 652e 2229 0a20 2020 2020 2020 2073 656c  e.").        sel
+00019300: 662e 7068 6173 6572 6573 203d 206b 7761  f.phaseres = kwa
+00019310: 7267 732e 6765 7428 2270 6861 7365 7265  rgs.get("phasere
+00019320: 7322 2c20 3230 290a 2020 2020 2020 2020  s", 20).        
+00019330: 7365 6c66 2e63 6d61 7020 3d20 6b77 6172  self.cmap = kwar
+00019340: 6773 2e67 6574 2822 636d 6170 222c 204e  gs.get("cmap", N
+00019350: 6f6e 6529 0a20 2020 2020 2020 2073 656c  one).        sel
+00019360: 662e 626c 6576 656c 203d 2066 6c6f 6174  f.blevel = float
+00019370: 286b 7761 7267 732e 6765 7428 2262 6c65  (kwargs.get("ble
+00019380: 7665 6c22 2c20 302e 3735 2929 0a20 2020  vel", 0.75)).   
+00019390: 2020 2020 2069 6620 7365 6c66 2e62 6c65       if self.ble
+000193a0: 7665 6c20 3c20 303a 0a20 2020 2020 2020  vel < 0:.       
+000193b0: 2020 2020 2077 6172 6e69 6e67 732e 7761       warnings.wa
+000193c0: 726e 280a 2020 2020 2020 2020 2020 2020  rn(.            
+000193d0: 2020 2020 2249 7420 6d75 7374 2062 6520      "It must be 
+000193e0: 3020 3c3d 2062 6c65 7665 6c20 3c3d 2031  0 <= blevel <= 1
+000193f0: 2e20 4175 746f 6d61 7469 6361 6c6c 7920  . Automatically 
+00019400: 220a 2020 2020 2020 2020 2020 2020 2020  ".              
+00019410: 2020 2273 6574 7469 6e67 2062 6c65 7665    "setting bleve
+00019420: 6c20 3d20 302e 2229 0a20 2020 2020 2020  l = 0.").       
+00019430: 2020 2020 2073 656c 662e 626c 6576 656c       self.blevel
+00019440: 203d 2030 0a20 2020 2020 2020 2069 6620   = 0.        if 
+00019450: 7365 6c66 2e62 6c65 7665 6c20 3e20 313a  self.blevel > 1:
+00019460: 0a20 2020 2020 2020 2020 2020 2077 6172  .            war
+00019470: 6e69 6e67 732e 7761 726e 280a 2020 2020  nings.warn(.    
+00019480: 2020 2020 2020 2020 2020 2020 2249 7420              "It 
+00019490: 6d75 7374 2062 6520 3020 3c3d 2062 6c65  must be 0 <= ble
+000194a0: 7665 6c20 3c3d 2031 2e20 4175 746f 6d61  vel <= 1. Automa
+000194b0: 7469 6361 6c6c 7920 220a 2020 2020 2020  tically ".      
+000194c0: 2020 2020 2020 2020 2020 2273 6574 7469            "setti
+000194d0: 6e67 2062 6c65 7665 6c20 3d20 312e 2229  ng blevel = 1.")
+000194e0: 0a20 2020 2020 2020 2020 2020 2073 656c  .            sel
+000194f0: 662e 626c 6576 656c 203d 2031 0a20 2020  f.blevel = 1.   
+00019500: 2020 2020 2073 656c 662e 7068 6173 656f       self.phaseo
+00019510: 6666 7365 7420 3d20 666c 6f61 7428 6b77  ffset = float(kw
+00019520: 6172 6773 2e67 6574 2822 7068 6173 656f  args.get("phaseo
+00019530: 6666 7365 7422 2c20 3029 290a 0a20 2020  ffset", 0))..   
+00019540: 2064 6566 205f 6372 6561 7465 5f64 6973   def _create_dis
+00019550: 6372 6574 697a 6564 5f64 6f6d 6169 6e28  cretized_domain(
+00019560: 7365 6c66 293a 0a20 2020 2020 2020 2072  self):.        r
+00019570: 6574 7572 6e20 436f 6d70 6c65 7853 7572  eturn ComplexSur
+00019580: 6661 6365 4261 7365 5365 7269 6573 2e5f  faceBaseSeries._
+00019590: 6372 6561 7465 5f64 6973 6372 6574 697a  create_discretiz
+000195a0: 6564 5f64 6f6d 6169 6e28 7365 6c66 290a  ed_domain(self).
+000195b0: 0a20 2020 2064 6566 205f 646f 6d61 696e  .    def _domain
+000195c0: 5f63 6f6c 6f72 696e 6728 7365 6c66 2c20  _coloring(self, 
+000195d0: 646f 6d61 696e 2c20 7729 3a0a 2020 2020  domain, w):.    
+000195e0: 2020 2020 6966 2069 7369 6e73 7461 6e63      if isinstanc
+000195f0: 6528 7365 6c66 2e63 6f6c 6f72 696e 672c  e(self.coloring,
+00019600: 2073 7472 293a 0a20 2020 2020 2020 2020   str):.         
+00019610: 2020 2073 656c 662e 636f 6c6f 7269 6e67     self.coloring
+00019620: 203d 2073 656c 662e 636f 6c6f 7269 6e67   = self.coloring
+00019630: 2e6c 6f77 6572 2829 0a20 2020 2020 2020  .lower().       
+00019640: 2020 2020 2072 6574 7572 6e20 7765 6765       return wege
+00019650: 7274 280a 2020 2020 2020 2020 2020 2020  rt(.            
+00019660: 2020 2020 7365 6c66 2e63 6f6c 6f72 696e      self.colorin
+00019670: 672c 2077 2c20 7365 6c66 2e70 6861 7365  g, w, self.phase
+00019680: 7265 732c 2073 656c 662e 636d 6170 2c0a  res, self.cmap,.
+00019690: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000196a0: 7365 6c66 2e62 6c65 7665 6c2c 2073 656c  self.blevel, sel
+000196b0: 662e 7068 6173 656f 6666 7365 742c 0a20  f.phaseoffset,. 
+000196c0: 2020 2020 2020 2020 2020 2020 2020 2073                 s
+000196d0: 656c 662e 6174 5f69 6e66 696e 6974 792c  elf.at_infinity,
+000196e0: 2073 656c 662e 7269 656d 616e 6e5f 6d61   self.riemann_ma
+000196f0: 736b 2c0a 2020 2020 2020 2020 2020 2020  sk,.            
+00019700: 2020 2020 646f 6d61 696e 3d5b 646f 6d61      domain=[doma
+00019710: 696e 5b30 2c20 305d 2c20 646f 6d61 696e  in[0, 0], domain
+00019720: 5b2d 312c 202d 315d 5d29 0a20 2020 2020  [-1, -1]]).     
+00019730: 2020 2072 6574 7572 6e20 7365 6c66 2e63     return self.c
+00019740: 6f6c 6f72 696e 6728 7729 0a0a 2020 2020  oloring(w)..    
+00019750: 6465 6620 6765 745f 6461 7461 2873 656c  def get_data(sel
+00019760: 6629 3a0a 2020 2020 2020 2020 2222 2252  f):.        """R
+00019770: 6574 7572 6e20 6172 7261 7973 206f 6620  eturn arrays of 
+00019780: 636f 6f72 6469 6e61 7465 7320 666f 7220  coordinates for 
+00019790: 706c 6f74 7469 6e67 2e0a 0a20 2020 2020  plotting...     
+000197a0: 2020 2052 6574 7572 6e73 0a20 2020 2020     Returns.     
+000197b0: 2020 203d 3d3d 3d3d 3d3d 0a0a 2020 2020     =======..    
+000197c0: 2020 2020 6d65 7368 5f78 203a 206e 702e      mesh_x : np.
+000197d0: 6e64 6172 7261 7920 5b6e 3220 7820 6e31  ndarray [n2 x n1
+000197e0: 5d0a 2020 2020 2020 2020 2020 2020 5265  ].            Re
+000197f0: 616c 2064 6973 6372 6574 697a 6564 2064  al discretized d
+00019800: 6f6d 6169 6e2e 0a0a 2020 2020 2020 2020  omain...        
+00019810: 6d65 7368 5f79 203a 206e 702e 6e64 6172  mesh_y : np.ndar
+00019820: 7261 7920 5b6e 3220 7820 6e31 5d0a 2020  ray [n2 x n1].  
+00019830: 2020 2020 2020 2020 2020 496d 6167 696e            Imagin
+00019840: 6172 7920 6469 7363 7265 7469 7a65 6420  ary discretized 
+00019850: 646f 6d61 696e 2e0a 0a20 2020 2020 2020  domain...       
+00019860: 2061 6273 203a 206e 702e 6e64 6172 7261   abs : np.ndarra
+00019870: 7920 5b6e 3220 7820 6e31 5d0a 2020 2020  y [n2 x n1].    
+00019880: 2020 2020 2020 2020 4162 736f 6c75 7465          Absolute
+00019890: 2076 616c 7565 206f 6620 7468 6520 6675   value of the fu
+000198a0: 6e63 7469 6f6e 2e0a 0a20 2020 2020 2020  nction...       
+000198b0: 2061 7267 203a 206e 702e 6e64 6172 7261   arg : np.ndarra
+000198c0: 7920 5b6e 3220 7820 6e31 5d0a 2020 2020  y [n2 x n1].    
+000198d0: 2020 2020 2020 2020 4172 6775 6d65 6e74          Argument
+000198e0: 206f 6620 7468 6520 6675 6e63 7469 6f6e   of the function
+000198f0: 2e0a 0a20 2020 2020 2020 2069 6d67 203a  ...        img :
+00019900: 206e 702e 6e64 6172 7261 7920 5b6e 3220   np.ndarray [n2 
+00019910: 7820 6e31 2078 2033 5d0a 2020 2020 2020  x n1 x 3].      
+00019920: 2020 2020 2020 5247 4220 696d 6167 6520        RGB image 
+00019930: 7661 6c75 6573 2063 6f6d 7075 7465 6420  values computed 
+00019940: 6672 6f6d 2074 6865 2061 7267 756d 656e  from the argumen
+00019950: 7420 6f66 2074 6865 2066 756e 6374 696f  t of the functio
+00019960: 6e2e 0a20 2020 2020 2020 2020 2020 2030  n..            0
+00019970: 203c 3d20 522c 2047 2c20 4220 3c3d 2032   <= R, G, B <= 2
+00019980: 3535 0a0a 2020 2020 2020 2020 636f 6c6f  55..        colo
+00019990: 7273 203a 206e 702e 6e64 6172 7261 7920  rs : np.ndarray 
+000199a0: 5b32 3536 2078 2033 5d0a 2020 2020 2020  [256 x 3].      
+000199b0: 2020 2020 2020 436f 6c6f 7220 7363 616c        Color scal
+000199c0: 6520 6173 736f 6369 6174 6564 2074 6f20  e associated to 
+000199d0: 6069 6d67 602e 0a20 2020 2020 2020 2022  `img`..        "
+000199e0: 2222 0a20 2020 2020 2020 206e 7020 3d20  "".        np = 
+000199f0: 696d 706f 7274 5f6d 6f64 756c 6528 276e  import_module('n
+00019a00: 756d 7079 2729 0a0a 2020 2020 2020 2020  umpy')..        
+00019a10: 646f 6d61 696e 2c20 7a20 3d20 7365 6c66  domain, z = self
+00019a20: 2e5f 6576 616c 7561 7465 2846 616c 7365  ._evaluate(False
+00019a30: 290a 2020 2020 2020 2020 7265 7475 726e  ).        return
+00019a40: 2073 656c 662e 5f61 7070 6c79 5f74 7261   self._apply_tra
+00019a50: 6e73 666f 726d 280a 2020 2020 2020 2020  nsform(.        
+00019a60: 2020 2020 6e70 2e72 6561 6c28 646f 6d61      np.real(doma
+00019a70: 696e 292c 206e 702e 696d 6167 2864 6f6d  in), np.imag(dom
+00019a80: 6169 6e29 2c0a 2020 2020 2020 2020 2020  ain),.          
+00019a90: 2020 6e70 2e61 6273 6f6c 7574 6528 7a29    np.absolute(z)
+00019aa0: 2c20 6e70 2e61 6e67 6c65 287a 292c 0a20  , np.angle(z),. 
+00019ab0: 2020 2020 2020 2020 2020 202a 7365 6c66             *self
+00019ac0: 2e5f 646f 6d61 696e 5f63 6f6c 6f72 696e  ._domain_colorin
+00019ad0: 6728 646f 6d61 696e 2c20 7a29 2c0a 2020  g(domain, z),.  
+00019ae0: 2020 2020 2020 290a 0a0a 636c 6173 7320        )...class 
+00019af0: 436f 6d70 6c65 7850 6172 616d 6574 7269  ComplexParametri
+00019b00: 6333 444c 696e 6553 6572 6965 7328 5061  c3DLineSeries(Pa
+00019b10: 7261 6d65 7472 6963 3344 4c69 6e65 5365  rametric3DLineSe
+00019b20: 7269 6573 293a 0a20 2020 2022 2222 5265  ries):.    """Re
+00019b30: 7072 6573 656e 7420 6120 6d65 7368 2f77  present a mesh/w
+00019b40: 6972 6566 7261 6d65 206c 696e 6520 6f66  ireframe line of
+00019b50: 2061 2063 6f6d 706c 6578 2073 7572 6661   a complex surfa
+00019b60: 6365 2073 6572 6965 732e 0a20 2020 2022  ce series..    "
+00019b70: 2222 0a0a 2020 2020 6465 6620 5f5f 696e  ""..    def __in
+00019b80: 6974 5f5f 2873 656c 662c 202a 6172 6773  it__(self, *args
+00019b90: 2c20 2a2a 6b77 6172 6773 293a 0a20 2020  , **kwargs):.   
+00019ba0: 2020 2020 2073 7570 6572 2829 2e5f 5f69       super().__i
+00019bb0: 6e69 745f 5f28 2a61 7267 732c 202a 2a6b  nit__(*args, **k
+00019bc0: 7761 7267 7329 0a20 2020 2020 2020 2023  wargs).        #
+00019bd0: 2064 6574 6572 6d69 6e65 7320 7768 6174   determines what
+00019be0: 2064 6174 6120 746f 2072 6574 7572 6e20   data to return 
+00019bf0: 6f6e 2074 6865 207a 2d61 7869 730a 2020  on the z-axis.  
+00019c00: 2020 2020 2020 7365 6c66 2e5f 7265 7475        self._retu
+00019c10: 726e 203d 206b 7761 7267 732e 6765 7428  rn = kwargs.get(
+00019c20: 2272 6574 7572 6e22 2c20 4e6f 6e65 290a  "return", None).
+00019c30: 0a20 2020 2064 6566 205f 6164 6170 7469  .    def _adapti
+00019c40: 7665 5f73 616d 706c 696e 6728 7365 6c66  ve_sampling(self
+00019c50: 293a 0a20 2020 2020 2020 2072 6169 7365  ):.        raise
+00019c60: 204e 6f74 496d 706c 656d 656e 7465 6445   NotImplementedE
+00019c70: 7272 6f72 0a0a 2020 2020 6465 6620 5f75  rror..    def _u
+00019c80: 6e69 666f 726d 5f73 616d 706c 696e 6728  niform_sampling(
+00019c90: 7365 6c66 293a 0a20 2020 2020 2020 2022  self):.        "
+00019ca0: 2222 5265 7475 726e 7320 636f 6f72 6469  ""Returns coordi
+00019cb0: 6e61 7465 7320 7468 6174 206e 6565 6473  nates that needs
+00019cc0: 2074 6f20 6265 2070 6f73 7470 726f 6365   to be postproce
+00019cd0: 7373 6564 2e22 2222 0a20 2020 2020 2020  ssed.""".       
+00019ce0: 206e 7020 3d20 696d 706f 7274 5f6d 6f64   np = import_mod
+00019cf0: 756c 6528 276e 756d 7079 2729 0a0a 2020  ule('numpy')..  
+00019d00: 2020 2020 2020 7265 7375 6c74 7320 3d20        results = 
+00019d10: 7365 6c66 2e5f 6576 616c 7561 7465 2829  self._evaluate()
+00019d20: 0a20 2020 2020 2020 2066 6f72 2069 2069  .        for i i
+00019d30: 6e20 7261 6e67 6528 6c65 6e28 7265 7375  n range(len(resu
+00019d40: 6c74 7329 202d 2031 293a 0a20 2020 2020  lts) - 1):.     
+00019d50: 2020 2020 2020 205f 7265 2c20 5f69 6d20         _re, _im 
+00019d60: 3d20 6e70 2e72 6561 6c28 7265 7375 6c74  = np.real(result
+00019d70: 735b 695d 292c 206e 702e 696d 6167 2872  s[i]), np.imag(r
+00019d80: 6573 756c 7473 5b69 5d29 0a20 2020 2020  esults[i]).     
+00019d90: 2020 2020 2020 205f 7265 5b6e 702e 696e         _re[np.in
+00019da0: 7665 7274 286e 702e 6973 636c 6f73 6528  vert(np.isclose(
+00019db0: 5f69 6d2c 206e 702e 7a65 726f 735f 6c69  _im, np.zeros_li
+00019dc0: 6b65 285f 696d 2929 295d 203d 206e 702e  ke(_im)))] = np.
+00019dd0: 6e61 6e0a 2020 2020 2020 2020 2020 2020  nan.            
+00019de0: 7265 7375 6c74 735b 695d 203d 205f 7265  results[i] = _re
+00019df0: 0a0a 2020 2020 2020 2020 6966 2073 656c  ..        if sel
+00019e00: 662e 5f72 6574 7572 6e20 6973 204e 6f6e  f._return is Non
+00019e10: 653a 0a20 2020 2020 2020 2020 2020 2070  e:.            p
+00019e20: 6173 730a 2020 2020 2020 2020 656c 6966  ass.        elif
+00019e30: 2073 656c 662e 5f72 6574 7572 6e20 3d3d   self._return ==
+00019e40: 2022 7265 616c 223a 0a20 2020 2020 2020   "real":.       
+00019e50: 2020 2020 2072 6573 756c 7473 5b2d 315d       results[-1]
+00019e60: 203d 206e 702e 7265 616c 2872 6573 756c   = np.real(resul
+00019e70: 7473 5b2d 315d 290a 2020 2020 2020 2020  ts[-1]).        
+00019e80: 656c 6966 2073 656c 662e 5f72 6574 7572  elif self._retur
+00019e90: 6e20 3d3d 2022 696d 6167 223a 0a20 2020  n == "imag":.   
+00019ea0: 2020 2020 2020 2020 2072 6573 756c 7473           results
+00019eb0: 5b2d 315d 203d 206e 702e 696d 6167 2872  [-1] = np.imag(r
+00019ec0: 6573 756c 7473 5b2d 315d 290a 2020 2020  esults[-1]).    
+00019ed0: 2020 2020 656c 6966 2073 656c 662e 5f72      elif self._r
+00019ee0: 6574 7572 6e20 3d3d 2022 6162 7322 206f  eturn == "abs" o
+00019ef0: 7220 7365 6c66 2e5f 7265 7475 726e 203d  r self._return =
+00019f00: 3d20 2261 6273 6172 6722 3a0a 2020 2020  = "absarg":.    
+00019f10: 2020 2020 2020 2020 7265 7375 6c74 735b          results[
+00019f20: 2d31 5d20 3d20 6e70 2e61 6273 6f6c 7574  -1] = np.absolut
+00019f30: 6528 7265 7375 6c74 735b 2d31 5d29 0a20  e(results[-1]). 
+00019f40: 2020 2020 2020 2065 6c69 6620 7365 6c66         elif self
+00019f50: 2e5f 7265 7475 726e 203d 3d20 2261 7267  ._return == "arg
+00019f60: 223a 0a20 2020 2020 2020 2020 2020 2072  ":.            r
+00019f70: 6573 756c 7473 5b2d 315d 203d 206e 702e  esults[-1] = np.
+00019f80: 616e 676c 6528 7265 7375 6c74 735b 2d31  angle(results[-1
+00019f90: 5d29 0a20 2020 2020 2020 2065 6c73 653a  ]).        else:
+00019fa0: 0a20 2020 2020 2020 2020 2020 2072 6169  .            rai
+00019fb0: 7365 2056 616c 7565 4572 726f 7228 0a20  se ValueError(. 
+00019fc0: 2020 2020 2020 2020 2020 2020 2020 2022                 "
+00019fd0: 605f 7265 7475 726e 6020 6e6f 7420 7265  `_return` not re
+00019fe0: 636f 676e 697a 6564 2e20 5265 6365 6976  cognized. Receiv
+00019ff0: 6564 3a20 2573 2220 2520 7365 6c66 2e5f  ed: %s" % self._
+0001a000: 7265 7475 726e 290a 0a20 2020 2020 2020  return)..       
+0001a010: 2072 6574 7572 6e20 5b2a 7265 7375 6c74   return [*result
+0001a020: 735b 313a 5d2c 2072 6573 756c 7473 5b30  s[1:], results[0
+0001a030: 5d5d 0a0a 0a64 6566 205f 7365 745f 6469  ]]...def _set_di
+0001a040: 7363 7265 7469 7a61 7469 6f6e 5f70 6f69  scretization_poi
+0001a050: 6e74 7328 6b77 6172 6773 2c20 7074 293a  nts(kwargs, pt):
+0001a060: 0a20 2020 2022 2222 416c 6c6f 7720 7468  .    """Allow th
+0001a070: 6520 7573 6520 6f66 2074 6865 206b 6579  e use of the key
+0001a080: 776f 7264 2061 7267 756d 656e 7473 206e  word arguments n
+0001a090: 2c20 6e31 2061 6e64 206e 3220 2861 6e64  , n1 and n2 (and
+0001a0a0: 206e 3329 2074 6f0a 2020 2020 7370 6563   n3) to.    spec
+0001a0b0: 6966 7920 7468 6520 6e75 6d62 6572 206f  ify the number o
+0001a0c0: 6620 6469 7363 7265 7469 7a61 7469 6f6e  f discretization
+0001a0d0: 2070 6f69 6e74 7320 696e 2074 776f 2028   points in two (
+0001a0e0: 6f72 2074 6872 6565 2920 6469 7265 6374  or three) direct
+0001a0f0: 696f 6e73 2e0a 0a20 2020 2050 6172 616d  ions...    Param
+0001a100: 6574 6572 730a 2020 2020 3d3d 3d3d 3d3d  eters.    ======
+0001a110: 3d3d 3d3d 0a0a 2020 2020 6b77 6172 6773  ====..    kwargs
+0001a120: 203a 2064 6963 740a 0a20 2020 2070 7420   : dict..    pt 
+0001a130: 3a20 7479 7065 0a20 2020 2020 2020 2054  : type.        T
+0001a140: 6865 2074 7970 6520 6f66 2074 6865 2073  he type of the s
+0001a150: 6572 6965 732c 2077 6869 6368 2069 6e64  eries, which ind
+0001a160: 6963 6174 6573 2074 6865 206b 696e 6420  icates the kind 
+0001a170: 6f66 2070 6c6f 7420 7765 2061 7265 0a20  of plot we are. 
+0001a180: 2020 2020 2020 2074 7279 696e 6720 746f         trying to
+0001a190: 2063 7265 6174 652e 0a0a 2020 2020 5265   create...    Re
+0001a1a0: 7475 726e 730a 2020 2020 3d3d 3d3d 3d3d  turns.    ======
+0001a1b0: 3d0a 0a20 2020 206b 7761 7267 7320 3a20  =..    kwargs : 
+0001a1c0: 6469 6374 0a20 2020 2022 2222 0a20 2020  dict.    """.   
+0001a1d0: 2064 6570 7265 6361 7465 645f 6b65 7977   deprecated_keyw
+0001a1e0: 6f72 6473 203d 207b 0a20 2020 2020 2020  ords = {.       
+0001a1f0: 2022 6e62 5f6f 665f 706f 696e 7473 223a   "nb_of_points":
+0001a200: 2022 6e22 2c0a 2020 2020 2020 2020 226e   "n",.        "n
+0001a210: 625f 6f66 5f70 6f69 6e74 735f 7822 3a20  b_of_points_x": 
+0001a220: 226e 3122 2c0a 2020 2020 2020 2020 226e  "n1",.        "n
+0001a230: 625f 6f66 5f70 6f69 6e74 735f 7922 3a20  b_of_points_y": 
+0001a240: 226e 3222 2c0a 2020 2020 2020 2020 226e  "n2",.        "n
+0001a250: 625f 6f66 5f70 6f69 6e74 735f 7522 3a20  b_of_points_u": 
+0001a260: 226e 3122 2c0a 2020 2020 2020 2020 226e  "n1",.        "n
+0001a270: 625f 6f66 5f70 6f69 6e74 735f 7622 3a20  b_of_points_v": 
+0001a280: 226e 3222 2c0a 2020 2020 2020 2020 2270  "n2",.        "p
+0001a290: 6f69 6e74 7322 3a20 226e 220a 2020 2020  oints": "n".    
+0001a2a0: 7d0a 2020 2020 666f 7220 6b2c 2076 2069  }.    for k, v i
+0001a2b0: 6e20 6465 7072 6563 6174 6564 5f6b 6579  n deprecated_key
+0001a2c0: 776f 7264 732e 6974 656d 7328 293a 0a20  words.items():. 
+0001a2d0: 2020 2020 2020 2069 6620 6b20 696e 206b         if k in k
+0001a2e0: 7761 7267 732e 6b65 7973 2829 3a0a 2020  wargs.keys():.  
+0001a2f0: 2020 2020 2020 2020 2020 6b77 6172 6773            kwargs
+0001a300: 5b76 5d20 3d20 6b77 6172 6773 2e70 6f70  [v] = kwargs.pop
+0001a310: 286b 290a 0a20 2020 2069 6620 7074 2069  (k)..    if pt i
+0001a320: 6e20 5b0a 2020 2020 2020 2020 4c69 6e65  n [.        Line
+0001a330: 4f76 6572 3144 5261 6e67 6553 6572 6965  Over1DRangeSerie
+0001a340: 732c 2050 6172 616d 6574 7269 6332 444c  s, Parametric2DL
+0001a350: 696e 6553 6572 6965 732c 0a20 2020 2020  ineSeries,.     
+0001a360: 2020 2050 6172 616d 6574 7269 6333 444c     Parametric3DL
+0001a370: 696e 6553 6572 6965 732c 2041 6273 4172  ineSeries, AbsAr
+0001a380: 674c 696e 6553 6572 6965 732c 2043 6f6c  gLineSeries, Col
+0001a390: 6f72 6564 4c69 6e65 4f76 6572 3144 5261  oredLineOver1DRa
+0001a3a0: 6e67 6553 6572 6965 732c 0a20 2020 2020  ngeSeries,.     
+0001a3b0: 2020 2043 6f6d 706c 6578 5061 7261 6d65     ComplexParame
+0001a3c0: 7472 6963 3344 4c69 6e65 5365 7269 6573  tric3DLineSeries
+0001a3d0: 2c20 4e79 7175 6973 744c 696e 6553 6572  , NyquistLineSer
+0001a3e0: 6965 732c 204e 6963 686f 6c73 4c69 6e65  ies, NicholsLine
+0001a3f0: 5365 7269 6573 2c0a 2020 2020 2020 2020  Series,.        
+0001a400: 5379 7374 656d 5265 7370 6f6e 7365 5365  SystemResponseSe
+0001a410: 7269 6573 2c20 436f 6c6f 7265 6453 7973  ries, ColoredSys
+0001a420: 7465 6d52 6573 706f 6e73 6553 6572 6965  temResponseSerie
+0001a430: 730a 2020 2020 5d3a 0a20 2020 2020 2020  s.    ]:.       
+0001a440: 2069 6620 226e 2220 696e 206b 7761 7267   if "n" in kwarg
+0001a450: 732e 6b65 7973 2829 3a0a 2020 2020 2020  s.keys():.      
+0001a460: 2020 2020 2020 6b77 6172 6773 5b22 6e31        kwargs["n1
+0001a470: 225d 203d 206b 7761 7267 735b 226e 225d  "] = kwargs["n"]
+0001a480: 0a20 2020 2020 2020 2020 2020 2069 6620  .            if 
+0001a490: 6861 7361 7474 7228 6b77 6172 6773 5b22  hasattr(kwargs["
+0001a4a0: 6e22 5d2c 2022 5f5f 6974 6572 5f5f 2229  n"], "__iter__")
+0001a4b0: 2061 6e64 2028 6c65 6e28 6b77 6172 6773   and (len(kwargs
+0001a4c0: 5b22 6e22 5d29 203e 2030 293a 0a20 2020  ["n"]) > 0):.   
+0001a4d0: 2020 2020 2020 2020 2020 2020 206b 7761               kwa
+0001a4e0: 7267 735b 226e 3122 5d20 3d20 6b77 6172  rgs["n1"] = kwar
+0001a4f0: 6773 5b22 6e22 5d5b 305d 0a20 2020 2065  gs["n"][0].    e
+0001a500: 6c69 6620 7074 2069 6e20 5b0a 2020 2020  lif pt in [.    
+0001a510: 2020 2020 5375 7266 6163 654f 7665 7232      SurfaceOver2
+0001a520: 4452 616e 6765 5365 7269 6573 2c20 436f  DRangeSeries, Co
+0001a530: 6e74 6f75 7253 6572 6965 732c 2050 6172  ntourSeries, Par
+0001a540: 616d 6574 7269 6353 7572 6661 6365 5365  ametricSurfaceSe
+0001a550: 7269 6573 2c0a 2020 2020 2020 2020 436f  ries,.        Co
+0001a560: 6d70 6c65 7853 7572 6661 6365 5365 7269  mplexSurfaceSeri
+0001a570: 6573 2c20 436f 6d70 6c65 7844 6f6d 6169  es, ComplexDomai
+0001a580: 6e43 6f6c 6f72 696e 6753 6572 6965 732c  nColoringSeries,
+0001a590: 0a20 2020 2020 2020 2056 6563 746f 7232  .        Vector2
+0001a5a0: 4453 6572 6965 732c 2049 6d70 6c69 6369  DSeries, Implici
+0001a5b0: 7453 6572 6965 732c 2052 6965 6d61 6e6e  tSeries, Riemann
+0001a5c0: 5370 6865 7265 5365 7269 6573 0a20 2020  SphereSeries.   
+0001a5d0: 205d 3a0a 2020 2020 2020 2020 6966 2022   ]:.        if "
+0001a5e0: 6e22 2069 6e20 6b77 6172 6773 2e6b 6579  n" in kwargs.key
+0001a5f0: 7328 293a 0a20 2020 2020 2020 2020 2020  s():.           
+0001a600: 2069 6620 6861 7361 7474 7228 6b77 6172   if hasattr(kwar
+0001a610: 6773 5b22 6e22 5d2c 2022 5f5f 6974 6572  gs["n"], "__iter
+0001a620: 5f5f 2229 2061 6e64 2028 6c65 6e28 6b77  __") and (len(kw
+0001a630: 6172 6773 5b22 6e22 5d29 203e 2031 293a  args["n"]) > 1):
+0001a640: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0001a650: 206b 7761 7267 735b 226e 3122 5d20 3d20   kwargs["n1"] = 
+0001a660: 6b77 6172 6773 5b22 6e22 5d5b 305d 0a20  kwargs["n"][0]. 
+0001a670: 2020 2020 2020 2020 2020 2020 2020 206b                 k
+0001a680: 7761 7267 735b 226e 3222 5d20 3d20 6b77  wargs["n2"] = kw
+0001a690: 6172 6773 5b22 6e22 5d5b 315d 0a20 2020  args["n"][1].   
+0001a6a0: 2020 2020 2020 2020 2065 6c73 653a 0a20           else:. 
+0001a6b0: 2020 2020 2020 2020 2020 2020 2020 206b                 k
+0001a6c0: 7761 7267 735b 226e 3122 5d20 3d20 6b77  wargs["n1"] = kw
+0001a6d0: 6172 6773 5b22 6e32 225d 203d 206b 7761  args["n2"] = kwa
+0001a6e0: 7267 735b 226e 225d 0a20 2020 2065 6c69  rgs["n"].    eli
+0001a6f0: 6620 7074 2069 6e20 5b0a 2020 2020 2020  f pt in [.      
+0001a700: 2020 5665 6374 6f72 3344 5365 7269 6573    Vector3DSeries
+0001a710: 2c20 536c 6963 6556 6563 746f 7233 4453  , SliceVector3DS
+0001a720: 6572 6965 732c 2049 6d70 6c69 6369 7433  eries, Implicit3
+0001a730: 4453 6572 6965 732c 2050 6c61 6e65 5365  DSeries, PlaneSe
+0001a740: 7269 6573 0a20 2020 205d 3a0a 2020 2020  ries.    ]:.    
+0001a750: 2020 2020 6966 2022 6e22 2069 6e20 6b77      if "n" in kw
+0001a760: 6172 6773 2e6b 6579 7328 293a 0a20 2020  args.keys():.   
+0001a770: 2020 2020 2020 2020 2069 6620 6861 7361           if hasa
+0001a780: 7474 7228 6b77 6172 6773 5b22 6e22 5d2c  ttr(kwargs["n"],
+0001a790: 2022 5f5f 6974 6572 5f5f 2229 2061 6e64   "__iter__") and
+0001a7a0: 2028 6c65 6e28 6b77 6172 6773 5b22 6e22   (len(kwargs["n"
+0001a7b0: 5d29 203e 2032 293a 0a20 2020 2020 2020  ]) > 2):.       
+0001a7c0: 2020 2020 2020 2020 206b 7761 7267 735b           kwargs[
+0001a7d0: 226e 3122 5d20 3d20 6b77 6172 6773 5b22  "n1"] = kwargs["
+0001a7e0: 6e22 5d5b 305d 0a20 2020 2020 2020 2020  n"][0].         
+0001a7f0: 2020 2020 2020 206b 7761 7267 735b 226e         kwargs["n
+0001a800: 3222 5d20 3d20 6b77 6172 6773 5b22 6e22  2"] = kwargs["n"
+0001a810: 5d5b 315d 0a20 2020 2020 2020 2020 2020  ][1].           
+0001a820: 2020 2020 206b 7761 7267 735b 226e 3322       kwargs["n3"
+0001a830: 5d20 3d20 6b77 6172 6773 5b22 6e22 5d5b  ] = kwargs["n"][
+0001a840: 325d 0a20 2020 2020 2020 2020 2020 2065  2].            e
+0001a850: 6c73 653a 0a20 2020 2020 2020 2020 2020  lse:.           
+0001a860: 2020 2020 206b 7761 7267 735b 226e 3122       kwargs["n1"
+0001a870: 5d20 3d20 6b77 6172 6773 5b22 6e32 225d  ] = kwargs["n2"]
+0001a880: 203d 206b 7761 7267 735b 226e 3322 5d20   = kwargs["n3"] 
+0001a890: 3d20 6b77 6172 6773 5b22 6e22 5d0a 2020  = kwargs["n"].  
+0001a8a0: 2020 7265 7475 726e 206b 7761 7267 730a    return kwargs.
+0001a8b0: 0a0a 636c 6173 7320 5665 6374 6f72 4261  ..class VectorBa
+0001a8c0: 7365 2843 6f6d 6d6f 6e55 6e69 666f 726d  se(CommonUniform
+0001a8d0: 4576 616c 7561 7469 6f6e 2c20 4261 7365  Evaluation, Base
+0001a8e0: 5365 7269 6573 293a 0a20 2020 2022 2222  Series):.    """
+0001a8f0: 5265 7072 6573 656e 7420 6120 7665 6374  Represent a vect
+0001a900: 6f72 2066 6965 6c64 2e22 2222 0a0a 2020  or field."""..  
+0001a910: 2020 6973 5f76 6563 746f 7220 3d20 5472    is_vector = Tr
+0001a920: 7565 0a20 2020 2069 735f 736c 6963 6520  ue.    is_slice 
+0001a930: 3d20 4661 6c73 650a 2020 2020 6973 5f73  = False.    is_s
+0001a940: 7472 6561 6d6c 696e 6573 203d 2046 616c  treamlines = Fal
+0001a950: 7365 0a20 2020 205f 616c 6c6f 7765 645f  se.    _allowed_
+0001a960: 6b65 7973 203d 205b 0a20 2020 2020 2020  keys = [.       
+0001a970: 2022 7374 7265 616d 6c69 6e65 7322 2c20   "streamlines", 
+0001a980: 2271 7569 7665 725f 6b77 222c 2022 7374  "quiver_kw", "st
+0001a990: 7265 616d 5f6b 7722 2c20 226e 6f72 6d61  ream_kw", "norma
+0001a9a0: 6c69 7a65 225d 0a0a 2020 2020 6465 6620  lize"]..    def 
+0001a9b0: 5f5f 696e 6974 5f5f 2873 656c 662c 2065  __init__(self, e
+0001a9c0: 7870 7273 2c20 7261 6e67 6573 2c20 6c61  xprs, ranges, la
+0001a9d0: 6265 6c2c 202a 2a6b 7761 7267 7329 3a0a  bel, **kwargs):.
+0001a9e0: 2020 2020 2020 2020 7375 7065 7228 292e          super().
+0001a9f0: 5f5f 696e 6974 5f5f 282a 2a6b 7761 7267  __init__(**kwarg
+0001aa00: 7329 0a20 2020 2020 2020 2073 656c 662e  s).        self.
+0001aa10: 6578 7072 203d 2074 7570 6c65 285b 6520  expr = tuple([e 
+0001aa20: 6966 2063 616c 6c61 626c 6528 6529 2065  if callable(e) e
+0001aa30: 6c73 6520 7379 6d70 6966 7928 6529 2066  lse sympify(e) f
+0001aa40: 6f72 2065 2069 6e20 6578 7072 735d 290a  or e in exprs]).
+0001aa50: 2020 2020 2020 2020 7365 6c66 2e72 616e          self.ran
+0001aa60: 6765 7320 3d20 7261 6e67 6573 0a20 2020  ges = ranges.   
+0001aa70: 2020 2020 2073 656c 662e 5f6c 6162 656c       self._label
+0001aa80: 203d 2073 7472 2865 7870 7273 2920 6966   = str(exprs) if
+0001aa90: 206c 6162 656c 2069 7320 4e6f 6e65 2065   label is None e
+0001aaa0: 6c73 6520 6c61 6265 6c0a 2020 2020 2020  lse label.      
+0001aab0: 2020 7365 6c66 2e5f 6c61 7465 785f 6c61    self._latex_la
+0001aac0: 6265 6c20 3d20 6c61 7465 7828 6578 7072  bel = latex(expr
+0001aad0: 7329 2069 6620 6c61 6265 6c20 6973 204e  s) if label is N
+0001aae0: 6f6e 6520 656c 7365 206c 6162 656c 0a20  one else label. 
+0001aaf0: 2020 2020 2020 2073 656c 662e 6973 5f73         self.is_s
+0001ab00: 7472 6561 6d6c 696e 6573 203d 206b 7761  treamlines = kwa
+0001ab10: 7267 732e 6765 7428 2273 7472 6561 6d6c  rgs.get("streaml
+0001ab20: 696e 6573 222c 2046 616c 7365 290a 2020  ines", False).  
+0001ab30: 2020 2020 2020 7365 6c66 2e75 7365 5f63        self.use_c
+0001ab40: 6d20 3d20 6b77 6172 6773 2e67 6574 2822  m = kwargs.get("
+0001ab50: 7573 655f 636d 222c 2054 7275 6529 0a20  use_cm", True). 
+0001ab60: 2020 2020 2020 2023 204e 4f54 453a 206e         # NOTE: n
+0001ab70: 6f72 6d61 6c69 7a61 7469 6f6e 2069 7320  ormalization is 
+0001ab80: 6163 6869 6576 6564 2061 7420 7468 6520  achieved at the 
+0001ab90: 6261 636b 656e 6420 7369 6465 3a20 7468  backend side: th
+0001aba0: 6973 2061 6c6c 6f77 7320 746f 0a20 2020  is allows to.   
+0001abb0: 2020 2020 2023 206f 6274 6169 6e20 7361       # obtain sa
+0001abc0: 6d65 206c 656e 6774 6820 6172 726f 7773  me length arrows
+0001abd0: 2c20 6275 7420 636f 6c6f 7265 6420 7769  , but colored wi
+0001abe0: 7468 2074 6865 2061 6374 7561 6c20 6d61  th the actual ma
+0001abf0: 676e 6974 7564 652e 0a20 2020 2020 2020  gnitude..       
+0001ac00: 2023 2049 6620 6e6f 726d 616c 697a 6174   # If normalizat
+0001ac10: 696f 6e20 6973 2061 7070 6c69 6564 206f  ion is applied o
+0001ac20: 6e20 7468 6520 7365 7269 6573 2067 6574  n the series get
+0001ac30: 5f64 6174 6128 292c 2074 6865 2063 6f6c  _data(), the col
+0001ac40: 6f72 696e 670a 2020 2020 2020 2020 2320  oring.        # 
+0001ac50: 6279 206d 6167 6e69 7475 6465 2077 6f75  by magnitude wou
+0001ac60: 6c64 206e 6f74 2062 6520 6170 706c 6963  ld not be applic
+0001ac70: 6162 6c65 2061 7420 7468 6520 6261 636b  able at the back
+0001ac80: 656e 642e 0a20 2020 2020 2020 2073 656c  end..        sel
+0001ac90: 662e 6e6f 726d 616c 697a 6520 3d20 6b77  f.normalize = kw
+0001aca0: 6172 6773 2e67 6574 2822 6e6f 726d 616c  args.get("normal
+0001acb0: 697a 6522 2c20 4661 6c73 6529 0a0a 2020  ize", False)..  
+0001acc0: 2020 2020 2020 2320 6966 2074 6865 2065        # if the e
+0001acd0: 7870 7265 7373 696f 6e73 2061 7265 206c  xpressions are l
+0001ace0: 616d 6264 6120 6675 6e63 7469 6f6e 7320  ambda functions 
+0001acf0: 616e 6420 6e6f 206c 6162 656c 2068 6173  and no label has
+0001ad00: 2062 6565 6e0a 2020 2020 2020 2020 2320   been.        # 
+0001ad10: 7072 6f76 6964 6564 2c20 7468 656e 2069  provided, then i
+0001ad20: 7473 2062 6574 7465 7220 746f 2064 6f20  ts better to do 
+0001ad30: 7468 6520 666f 6c6c 6f77 696e 6720 696e  the following in
+0001ad40: 206f 7264 6572 2074 6f20 6176 6f69 640a   order to avoid.
+0001ad50: 2020 2020 2020 2020 2320 7375 7072 6973          # supris
+0001ad60: 6573 206f 6e20 7468 6520 6261 636b 656e  es on the backen
+0001ad70: 640a 2020 2020 2020 2020 6966 2061 6e79  d.        if any
+0001ad80: 2863 616c 6c61 626c 6528 6529 2066 6f72  (callable(e) for
+0001ad90: 2065 2069 6e20 7365 6c66 2e65 7870 7229   e in self.expr)
+0001ada0: 3a0a 2020 2020 2020 2020 2020 2020 6966  :.            if
+0001adb0: 2073 656c 662e 5f6c 6162 656c 203d 3d20   self._label == 
+0001adc0: 7374 7228 7365 6c66 2e65 7870 7229 3a0a  str(self.expr):.
+0001add0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001ade0: 7365 6c66 2e5f 6c61 6265 6c20 3d20 224d  self._label = "M
+0001adf0: 6167 6e69 7475 6465 220a 0a20 2020 2020  agnitude"..     
+0001ae00: 2020 2023 204e 4f54 453a 2077 6865 6e20     # NOTE: when 
+0001ae10: 706c 6f74 7469 6e67 2076 6563 746f 7220  plotting vector 
+0001ae20: 6669 656c 6473 2069 7420 6d69 6768 7420  fields it might 
+0001ae30: 6265 2075 7365 6675 6c20 746f 2072 6570  be useful to rep
+0001ae40: 6561 7420 7468 650a 2020 2020 2020 2020  eat the.        
+0001ae50: 2320 706c 6f74 2063 6f6d 6d61 6e64 2073  # plot command s
+0001ae60: 7769 7463 6869 6e67 2062 6574 7765 656e  witching between
+0001ae70: 2071 7569 7665 7273 2061 6e64 2073 7472   quivers and str
+0001ae80: 6561 6d6c 696e 6573 2e0a 2020 2020 2020  eamlines..      
+0001ae90: 2020 2320 5573 7561 6c6c 792c 2070 6c6f    # Usually, plo
+0001aea0: 7474 696e 6720 6c69 6272 6172 6965 7320  tting libraries 
+0001aeb0: 6578 706f 7365 2064 6966 6665 7265 6e74  expose different
+0001aec0: 2066 756e 6374 696f 6e73 2066 6f72 2071   functions for q
+0001aed0: 7569 7665 7273 0a20 2020 2020 2020 2023  uivers.        #
+0001aee0: 2061 6e64 2073 7472 6561 6d6c 696e 6573   and streamlines
+0001aef0: 2c20 6163 6365 7074 696e 6720 6469 6666  , accepting diff
+0001af00: 6572 656e 7420 6b65 7977 6f72 6420 6172  erent keyword ar
+0001af10: 6775 6d65 6e74 732e 0a20 2020 2020 2020  guments..       
+0001af20: 2023 2054 6865 2063 686f 6963 6520 746f   # The choice to
+0001af30: 2069 6d70 6c65 6d65 6e74 2073 6570 6172   implement separ
+0001af40: 6174 6573 2073 7472 6561 6d5f 6b77 2061  ates stream_kw a
+0001af50: 6e64 2071 7569 7665 725f 6b77 2061 6c6c  nd quiver_kw all
+0001af60: 6f77 730a 2020 2020 2020 2020 2320 7468  ows.        # th
+0001af70: 6973 2071 7569 636b 2073 7769 7463 682e  is quick switch.
+0001af80: 0a20 2020 2020 2020 2069 6620 7365 6c66  .        if self
+0001af90: 2e69 735f 7374 7265 616d 6c69 6e65 733a  .is_streamlines:
+0001afa0: 0a20 2020 2020 2020 2020 2020 2073 656c  .            sel
+0001afb0: 662e 7265 6e64 6572 696e 675f 6b77 203d  f.rendering_kw =
+0001afc0: 206b 7761 7267 732e 6765 7428 0a20 2020   kwargs.get(.   
+0001afd0: 2020 2020 2020 2020 2020 2020 2022 7374               "st
+0001afe0: 7265 616d 5f6b 7722 2c20 6b77 6172 6773  ream_kw", kwargs
+0001aff0: 2e67 6574 2822 7265 6e64 6572 696e 675f  .get("rendering_
+0001b000: 6b77 222c 2064 6963 7428 2929 290a 2020  kw", dict())).  
+0001b010: 2020 2020 2020 656c 7365 3a0a 2020 2020        else:.    
+0001b020: 2020 2020 2020 2020 7365 6c66 2e72 656e          self.ren
+0001b030: 6465 7269 6e67 5f6b 7720 3d20 6b77 6172  dering_kw = kwar
+0001b040: 6773 2e67 6574 280a 2020 2020 2020 2020  gs.get(.        
+0001b050: 2020 2020 2020 2020 2271 7569 7665 725f          "quiver_
+0001b060: 6b77 222c 206b 7761 7267 732e 6765 7428  kw", kwargs.get(
+0001b070: 2272 656e 6465 7269 6e67 5f6b 7722 2c20  "rendering_kw", 
+0001b080: 6469 6374 2829 2929 0a20 2020 2020 2020  dict())).       
+0001b090: 2073 656c 662e 5f70 6f73 745f 696e 6974   self._post_init
+0001b0a0: 2829 0a0a 2020 2020 6465 6620 6765 745f  ()..    def get_
+0001b0b0: 6c61 6265 6c28 7365 6c66 2c20 7573 655f  label(self, use_
+0001b0c0: 6c61 7465 783d 4661 6c73 652c 2077 7261  latex=False, wra
+0001b0d0: 7070 6572 3d22 2425 7324 2229 3a0a 2020  pper="$%s$"):.  
+0001b0e0: 2020 2020 2020 6966 2075 7365 5f6c 6174        if use_lat
+0001b0f0: 6578 3a0a 2020 2020 2020 2020 2020 2020  ex:.            
+0001b100: 6578 7072 203d 2073 656c 662e 6578 7072  expr = self.expr
+0001b110: 0a20 2020 2020 2020 2020 2020 2069 6620  .            if 
+0001b120: 7365 6c66 2e5f 6c61 6265 6c20 213d 2073  self._label != s
+0001b130: 7472 2865 7870 7229 3a0a 2020 2020 2020  tr(expr):.      
+0001b140: 2020 2020 2020 2020 2020 7265 7475 726e            return
+0001b150: 2073 656c 662e 5f6c 6174 6578 5f6c 6162   self._latex_lab
+0001b160: 656c 0a20 2020 2020 2020 2020 2020 2072  el.            r
+0001b170: 6574 7572 6e20 7365 6c66 2e5f 6765 745f  eturn self._get_
+0001b180: 7772 6170 7065 645f 6c61 6265 6c28 7365  wrapped_label(se
+0001b190: 6c66 2e5f 6c61 7465 785f 6c61 6265 6c2c  lf._latex_label,
+0001b1a0: 2077 7261 7070 6572 290a 2020 2020 2020   wrapper).      
+0001b1b0: 2020 7265 7475 726e 2073 656c 662e 5f6c    return self._l
+0001b1c0: 6162 656c 0a0a 2020 2020 6465 6620 6765  abel..    def ge
+0001b1d0: 745f 6461 7461 2873 656c 6629 3a0a 2020  t_data(self):.  
+0001b1e0: 2020 2020 2020 2222 2252 6574 7572 6e20        """Return 
+0001b1f0: 6172 7261 7973 206f 6620 636f 6f72 6469  arrays of coordi
+0001b200: 6e61 7465 7320 666f 7220 706c 6f74 7469  nates for plotti
+0001b210: 6e67 2e20 4465 7065 6e64 696e 6720 6f6e  ng. Depending on
+0001b220: 2074 6865 0a20 2020 2020 2020 2060 6164   the.        `ad
+0001b230: 6170 7469 7665 6020 6f70 7469 6f6e 2c20  aptive` option, 
+0001b240: 7468 6973 2066 756e 6374 696f 6e20 7769  this function wi
+0001b250: 6c6c 2065 6974 6865 7220 7573 6520 616e  ll either use an
+0001b260: 2061 6461 7074 6976 6520 616c 676f 7269   adaptive algori
+0001b270: 7468 6d0a 2020 2020 2020 2020 6f72 2069  thm.        or i
+0001b280: 7420 7769 6c6c 2075 6e69 666f 726d 6c79  t will uniformly
+0001b290: 2073 616d 706c 6520 7468 6520 6578 7072   sample the expr
+0001b2a0: 6573 7369 6f6e 206f 7665 7220 7468 6520  ession over the 
+0001b2b0: 7072 6f76 6964 6564 2072 616e 6765 2e0a  provided range..
+0001b2c0: 0a20 2020 2020 2020 2052 6574 7572 6e73  .        Returns
+0001b2d0: 0a20 2020 2020 2020 203d 3d3d 3d3d 3d3d  .        =======
+0001b2e0: 0a0a 2020 2020 2020 2020 6d65 7368 5f78  ..        mesh_x
+0001b2f0: 203a 206e 702e 6e64 6172 7261 7920 5b6e   : np.ndarray [n
+0001b300: 3220 7820 6e31 5d0a 2020 2020 2020 2020  2 x n1].        
+0001b310: 2020 2020 4469 7363 7265 7469 7a65 6420      Discretized 
+0001b320: 782d 646f 6d61 696e 2e0a 0a20 2020 2020  x-domain...     
+0001b330: 2020 206d 6573 685f 7920 3a20 6e70 2e6e     mesh_y : np.n
+0001b340: 6461 7272 6179 205b 6e32 2078 206e 315d  darray [n2 x n1]
+0001b350: 0a20 2020 2020 2020 2020 2020 2044 6973  .            Dis
+0001b360: 6372 6574 697a 6564 2079 2d64 6f6d 6169  cretized y-domai
+0001b370: 6e2e 0a0a 2020 2020 2020 2020 6d65 7368  n...        mesh
+0001b380: 5f7a 203a 206e 702e 6e64 6172 7261 7920  _z : np.ndarray 
+0001b390: 5b6e 3220 7820 6e31 5d20 286f 7074 696f  [n2 x n1] (optio
+0001b3a0: 6e61 6c29 0a20 2020 2020 2020 2020 2020  nal).           
+0001b3b0: 2044 6973 6372 6574 697a 6564 207a 2d64   Discretized z-d
+0001b3c0: 6f6d 6169 6e20 696e 2074 6865 2063 6173  omain in the cas
+0001b3d0: 6520 6f66 2056 6563 746f 7233 4453 6572  e of Vector3DSer
+0001b3e0: 6965 732e 0a0a 2020 2020 2020 2020 7520  ies...        u 
+0001b3f0: 3a20 6e70 2e6e 6461 7272 6179 205b 6e32  : np.ndarray [n2
+0001b400: 2078 206e 315d 0a20 2020 2020 2020 2020   x n1].         
+0001b410: 2020 2046 6972 7374 2063 6f6d 706f 6e65     First compone
+0001b420: 6e74 206f 6620 7468 6520 7665 6374 6f72  nt of the vector
+0001b430: 2066 6965 6c64 2e0a 0a20 2020 2020 2020   field...       
+0001b440: 2076 203a 206e 702e 6e64 6172 7261 7920   v : np.ndarray 
+0001b450: 5b6e 3220 7820 6e31 5d0a 2020 2020 2020  [n2 x n1].      
+0001b460: 2020 2020 2020 5365 636f 6e64 2063 6f6d        Second com
+0001b470: 706f 6e65 6e74 206f 6620 7468 6520 7665  ponent of the ve
+0001b480: 6374 6f72 2066 6965 6c64 2e0a 0a20 2020  ctor field...   
+0001b490: 2020 2020 2077 203a 206e 702e 6e64 6172       w : np.ndar
+0001b4a0: 7261 7920 5b6e 3220 7820 6e31 5d20 286f  ray [n2 x n1] (o
+0001b4b0: 7074 696f 6e61 6c29 0a20 2020 2020 2020  ptional).       
+0001b4c0: 2020 2020 2054 6869 7264 2063 6f6d 706f       Third compo
+0001b4d0: 6e65 6e74 206f 6620 7468 6520 7665 6374  nent of the vect
+0001b4e0: 6f72 2066 6965 6c64 2069 6e20 7468 6520  or field in the 
+0001b4f0: 6361 7365 206f 6620 5665 6374 6f72 3344  case of Vector3D
+0001b500: 5365 7269 6573 2e0a 2020 2020 2020 2020  Series..        
+0001b510: 2222 220a 2020 2020 2020 2020 6e70 203d  """.        np =
+0001b520: 2069 6d70 6f72 745f 6d6f 6475 6c65 2827   import_module('
+0001b530: 6e75 6d70 7927 290a 0a20 2020 2020 2020  numpy')..       
+0001b540: 2072 6573 756c 7473 203d 2073 656c 662e   results = self.
+0001b550: 5f65 7661 6c75 6174 6528 290a 2020 2020  _evaluate().    
+0001b560: 2020 2020 666f 7220 692c 2072 2069 6e20      for i, r in 
+0001b570: 656e 756d 6572 6174 6528 7265 7375 6c74  enumerate(result
+0001b580: 7329 3a0a 2020 2020 2020 2020 2020 2020  s):.            
+0001b590: 7265 5f76 2c20 696d 5f76 203d 206e 702e  re_v, im_v = np.
+0001b5a0: 7265 616c 2872 292c 206e 702e 696d 6167  real(r), np.imag
+0001b5b0: 2872 290a 2020 2020 2020 2020 2020 2020  (r).            
+0001b5c0: 7265 5f76 5b6e 702e 696e 7665 7274 286e  re_v[np.invert(n
+0001b5d0: 702e 6973 636c 6f73 6528 696d 5f76 2c20  p.isclose(im_v, 
+0001b5e0: 6e70 2e7a 6572 6f73 5f6c 696b 6528 696d  np.zeros_like(im
+0001b5f0: 5f76 2929 295d 203d 206e 702e 6e61 6e0a  _v)))] = np.nan.
+0001b600: 2020 2020 2020 2020 2020 2020 7265 7375              resu
+0001b610: 6c74 735b 695d 203d 2072 655f 760a 0a20  lts[i] = re_v.. 
+0001b620: 2020 2020 2020 2072 6574 7572 6e20 7365         return se
+0001b630: 6c66 2e5f 6170 706c 795f 7472 616e 7366  lf._apply_transf
+0001b640: 6f72 6d28 2a72 6573 756c 7473 290a 0a0a  orm(*results)...
+0001b650: 636c 6173 7320 5665 6374 6f72 3244 5365  class Vector2DSe
+0001b660: 7269 6573 2856 6563 746f 7242 6173 6529  ries(VectorBase)
+0001b670: 3a0a 2020 2020 2222 2252 6570 7265 7365  :.    """Represe
+0001b680: 6e74 7320 6120 3244 2076 6563 746f 7220  nts a 2D vector 
+0001b690: 6669 656c 642e 2222 220a 0a20 2020 2069  field."""..    i
+0001b6a0: 735f 3244 7665 6374 6f72 203d 2054 7275  s_2Dvector = Tru
+0001b6b0: 650a 2020 2020 2320 6465 6661 756c 7420  e.    # default 
+0001b6c0: 6e75 6d62 6572 206f 6620 6469 7363 7265  number of discre
+0001b6d0: 7469 7a61 7469 6f6e 2070 6f69 6e74 730a  tization points.
+0001b6e0: 2020 2020 5f4e 203d 2032 350a 2020 2020      _N = 25.    
+0001b6f0: 5f61 6c6c 6f77 6564 5f6b 6579 7320 3d20  _allowed_keys = 
+0001b700: 5b22 7363 616c 6172 225d 0a0a 2020 2020  ["scalar"]..    
+0001b710: 6465 6620 5f5f 696e 6974 5f5f 2873 656c  def __init__(sel
+0001b720: 662c 2075 2c20 762c 2072 616e 6765 312c  f, u, v, range1,
+0001b730: 2072 616e 6765 322c 206c 6162 656c 3d22   range2, label="
+0001b740: 222c 202a 2a6b 7761 7267 7329 3a0a 2020  ", **kwargs):.  
+0001b750: 2020 2020 2020 7375 7065 7228 292e 5f5f        super().__
+0001b760: 696e 6974 5f5f 2828 752c 2076 292c 2028  init__((u, v), (
+0001b770: 7261 6e67 6531 2c20 7261 6e67 6532 292c  range1, range2),
+0001b780: 206c 6162 656c 2c20 2a2a 6b77 6172 6773   label, **kwargs
+0001b790: 290a 2020 2020 2020 2020 6966 2022 7363  ).        if "sc
+0001b7a0: 616c 6172 2220 6e6f 7420 696e 206b 7761  alar" not in kwa
+0001b7b0: 7267 732e 6b65 7973 2829 3a0a 2020 2020  rgs.keys():.    
+0001b7c0: 2020 2020 2020 2020 7573 655f 636d 203d          use_cm =
+0001b7d0: 2046 616c 7365 0a20 2020 2020 2020 2065   False.        e
+0001b7e0: 6c69 6620 286e 6f74 206b 7761 7267 735b  lif (not kwargs[
+0001b7f0: 2273 6361 6c61 7222 5d29 206f 7220 286b  "scalar"]) or (k
+0001b800: 7761 7267 735b 2273 6361 6c61 7222 5d20  wargs["scalar"] 
+0001b810: 6973 204e 6f6e 6529 3a0a 2020 2020 2020  is None):.      
+0001b820: 2020 2020 2020 7573 655f 636d 203d 2054        use_cm = T
+0001b830: 7275 650a 2020 2020 2020 2020 656c 7365  rue.        else
+0001b840: 3a0a 2020 2020 2020 2020 2020 2020 7573  :.            us
+0001b850: 655f 636d 203d 2046 616c 7365 0a20 2020  e_cm = False.   
+0001b860: 2020 2020 2073 656c 662e 7573 655f 636d       self.use_cm
+0001b870: 203d 206b 7761 7267 732e 6765 7428 2275   = kwargs.get("u
+0001b880: 7365 5f63 6d22 2c20 7573 655f 636d 290a  se_cm", use_cm).
+0001b890: 0a20 2020 2064 6566 205f 5f73 7472 5f5f  .    def __str__
+0001b8a0: 2873 656c 6629 3a0a 2020 2020 2020 2020  (self):.        
+0001b8b0: 7261 6e67 6573 203d 205b 5d0a 2020 2020  ranges = [].    
+0001b8c0: 2020 2020 6620 3d20 6c61 6d62 6461 2074      f = lambda t
+0001b8d0: 3a20 7420 6966 206c 656e 2874 2e66 7265  : t if len(t.fre
+0001b8e0: 655f 7379 6d62 6f6c 7329 203e 2030 2065  e_symbols) > 0 e
+0001b8f0: 6c73 6520 666c 6f61 7428 7429 0a20 2020  lse float(t).   
+0001b900: 2020 2020 2066 6f72 2072 2069 6e20 7365       for r in se
+0001b910: 6c66 2e72 616e 6765 733a 0a20 2020 2020  lf.ranges:.     
+0001b920: 2020 2020 2020 2072 616e 6765 732e 6170         ranges.ap
+0001b930: 7065 6e64 2828 725b 305d 2c20 6628 725b  pend((r[0], f(r[
+0001b940: 315d 292c 2066 2872 5b32 5d29 2929 0a20  1]), f(r[2]))). 
+0001b950: 2020 2020 2020 2072 6574 7572 6e20 7365         return se
+0001b960: 6c66 2e5f 7374 725f 6865 6c70 6572 280a  lf._str_helper(.
+0001b970: 2020 2020 2020 2020 2020 2020 2232 4420              "2D 
+0001b980: 7665 6374 6f72 2073 6572 6965 733a 205b  vector series: [
+0001b990: 2573 2c20 2573 5d20 6f76 6572 2025 732c  %s, %s] over %s,
+0001b9a0: 2025 7322 2025 2028 0a20 2020 2020 2020   %s" % (.       
+0001b9b0: 2020 2020 2020 2020 202a 7365 6c66 2e65           *self.e
+0001b9c0: 7870 722c 202a 7261 6e67 6573 2929 0a0a  xpr, *ranges))..
+0001b9d0: 0a63 6c61 7373 2056 6563 746f 7233 4453  .class Vector3DS
+0001b9e0: 6572 6965 7328 5665 6374 6f72 4261 7365  eries(VectorBase
+0001b9f0: 293a 0a20 2020 2022 2222 5265 7072 6573  ):.    """Repres
+0001ba00: 656e 7473 2061 2033 4420 7665 6374 6f72  ents a 3D vector
+0001ba10: 2066 6965 6c64 2e22 2222 0a0a 2020 2020   field."""..    
+0001ba20: 6973 5f33 4420 3d20 5472 7565 0a20 2020  is_3D = True.   
+0001ba30: 2069 735f 3344 7665 6374 6f72 203d 2054   is_3Dvector = T
+0001ba40: 7275 650a 2020 2020 2320 6465 6661 756c  rue.    # defaul
+0001ba50: 7420 6e75 6d62 6572 206f 6620 6469 7363  t number of disc
+0001ba60: 7265 7469 7a61 7469 6f6e 2070 6f69 6e74  retization point
+0001ba70: 730a 2020 2020 5f4e 203d 2031 300a 0a20  s.    _N = 10.. 
+0001ba80: 2020 2064 6566 205f 5f69 6e69 745f 5f28     def __init__(
+0001ba90: 7365 6c66 2c20 752c 2076 2c20 7a2c 2072  self, u, v, z, r
+0001baa0: 616e 6765 312c 2072 616e 6765 322c 2072  ange1, range2, r
+0001bab0: 616e 6765 332c 206c 6162 656c 3d22 222c  ange3, label="",
+0001bac0: 202a 2a6b 7761 7267 7329 3a0a 2020 2020   **kwargs):.    
+0001bad0: 2020 2020 7375 7065 7228 292e 5f5f 696e      super().__in
+0001bae0: 6974 5f5f 2828 752c 2076 2c20 7a29 2c20  it__((u, v, z), 
+0001baf0: 2872 616e 6765 312c 2072 616e 6765 322c  (range1, range2,
+0001bb00: 2072 616e 6765 3329 2c20 6c61 6265 6c2c   range3), label,
+0001bb10: 202a 2a6b 7761 7267 7329 0a20 2020 2020   **kwargs).     
+0001bb20: 2020 2069 6620 7365 6c66 2e69 735f 7374     if self.is_st
+0001bb30: 7265 616d 6c69 6e65 7320 616e 6420 6973  reamlines and is
+0001bb40: 696e 7374 616e 6365 2873 656c 662e 636f  instance(self.co
+0001bb50: 6c6f 725f 6675 6e63 2c20 4578 7072 293a  lor_func, Expr):
+0001bb60: 0a20 2020 2020 2020 2020 2020 2072 6169  .            rai
+0001bb70: 7365 2054 7970 6545 7272 6f72 280a 2020  se TypeError(.  
+0001bb80: 2020 2020 2020 2020 2020 2020 2020 2256                "V
+0001bb90: 6563 746f 7233 4453 6572 6965 7320 7769  ector3DSeries wi
+0001bba0: 7468 2073 7472 6561 6d6c 696e 6573 2063  th streamlines c
+0001bbb0: 616e 2774 2075 7365 2022 0a20 2020 2020  an't use ".     
+0001bbc0: 2020 2020 2020 2020 2020 2022 7379 6d62             "symb
+0001bbd0: 6f6c 6963 2060 636f 6c6f 725f 6675 6e63  olic `color_func
+0001bbe0: 602e 2229 0a0a 2020 2020 6465 6620 5f5f  `.")..    def __
+0001bbf0: 7374 725f 5f28 7365 6c66 293a 0a20 2020  str__(self):.   
+0001bc00: 2020 2020 2072 616e 6765 7320 3d20 5b5d       ranges = []
+0001bc10: 0a20 2020 2020 2020 2066 6f72 2072 2069  .        for r i
+0001bc20: 6e20 7365 6c66 2e72 616e 6765 733a 0a20  n self.ranges:. 
+0001bc30: 2020 2020 2020 2020 2020 2072 616e 6765             range
+0001bc40: 732e 6170 7065 6e64 2828 725b 305d 2c20  s.append((r[0], 
+0001bc50: 666c 6f61 7428 725b 315d 292c 2066 6c6f  float(r[1]), flo
+0001bc60: 6174 2872 5b32 5d29 2929 0a20 2020 2020  at(r[2]))).     
+0001bc70: 2020 2072 6574 7572 6e20 7365 6c66 2e5f     return self._
+0001bc80: 7374 725f 6865 6c70 6572 280a 2020 2020  str_helper(.    
+0001bc90: 2020 2020 2020 2020 2233 4420 7665 6374          "3D vect
+0001bca0: 6f72 2073 6572 6965 733a 205b 2573 2c20  or series: [%s, 
+0001bcb0: 2573 2c20 2573 5d20 6f76 6572 2025 732c  %s, %s] over %s,
+0001bcc0: 2025 732c 2025 7322 2025 2028 0a20 2020   %s, %s" % (.   
+0001bcd0: 2020 2020 2020 2020 2020 2020 202a 7365               *se
+0001bce0: 6c66 2e65 7870 722c 202a 7261 6e67 6573  lf.expr, *ranges
+0001bcf0: 2929 0a0a 0a64 6566 205f 6275 696c 645f  ))...def _build_
+0001bd00: 736c 6963 655f 7365 7269 6573 2873 6c69  slice_series(sli
+0001bd10: 6365 5f73 7572 662c 2072 616e 6765 732c  ce_surf, ranges,
+0001bd20: 202a 2a6b 7761 7267 7329 3a0a 2020 2020   **kwargs):.    
+0001bd30: 6966 2069 7369 6e73 7461 6e63 6528 736c  if isinstance(sl
+0001bd40: 6963 655f 7375 7266 2c20 506c 616e 6529  ice_surf, Plane)
+0001bd50: 3a0a 2020 2020 2020 2020 7265 7475 726e  :.        return
+0001bd60: 2050 6c61 6e65 5365 7269 6573 2873 796d   PlaneSeries(sym
+0001bd70: 7069 6679 2873 6c69 6365 5f73 7572 6629  pify(slice_surf)
+0001bd80: 2c20 2a72 616e 6765 732c 202a 2a6b 7761  , *ranges, **kwa
+0001bd90: 7267 7329 0a20 2020 2065 6c69 6620 6973  rgs).    elif is
+0001bda0: 696e 7374 616e 6365 2873 6c69 6365 5f73  instance(slice_s
+0001bdb0: 7572 662c 2042 6173 6553 6572 6965 7329  urf, BaseSeries)
+0001bdc0: 3a0a 2020 2020 2020 2020 6966 2073 6c69  :.        if sli
+0001bdd0: 6365 5f73 7572 662e 6973 5f33 4473 7572  ce_surf.is_3Dsur
+0001bde0: 6661 6365 3a0a 2020 2020 2020 2020 2020  face:.          
+0001bdf0: 2020 7265 7475 726e 2073 6c69 6365 5f73    return slice_s
+0001be00: 7572 660a 2020 2020 2020 2020 7261 6973  urf.        rais
+0001be10: 6520 5479 7065 4572 726f 7228 224f 6e6c  e TypeError("Onl
+0001be20: 7920 3344 2073 7572 6661 6365 2d72 656c  y 3D surface-rel
+0001be30: 6174 6564 2073 6572 6965 7320 6172 6520  ated series are 
+0001be40: 7375 7070 6f72 7465 642e 2229 0a0a 2020  supported.")..  
+0001be50: 2020 2320 4966 2074 6865 2076 6563 746f    # If the vecto
+0001be60: 7220 6669 656c 6420 6973 2056 2878 2c20  r field is V(x, 
+0001be70: 792c 207a 292c 2074 6865 2073 6c69 6365  y, z), the slice
+0001be80: 2065 7870 7265 7373 696f 6e20 6361 6e20   expression can 
+0001be90: 6265 2066 2878 2c20 7929 0a20 2020 2023  be f(x, y).    #
+0001bea0: 206f 7220 6628 792c 207a 2920 6f72 2066   or f(y, z) or f
+0001beb0: 2878 2c20 7a29 2e20 4578 7472 6163 7420  (x, z). Extract 
+0001bec0: 7468 6520 636f 7272 6563 7420 7261 6e67  the correct rang
+0001bed0: 6573 2e0a 2020 2020 6673 203d 2073 6c69  es..    fs = sli
+0001bee0: 6365 5f73 7572 662e 6672 6565 5f73 796d  ce_surf.free_sym
+0001bef0: 626f 6c73 0a20 2020 206e 6577 5f72 616e  bols.    new_ran
+0001bf00: 6765 7320 3d20 5b72 2066 6f72 2072 2069  ges = [r for r i
+0001bf10: 6e20 7261 6e67 6573 2069 6620 725b 305d  n ranges if r[0]
+0001bf20: 2069 6e20 6673 5d0a 2020 2020 2320 6170   in fs].    # ap
+0001bf30: 706c 7920 7468 6520 636f 7272 6563 7420  ply the correct 
+0001bf40: 6469 7363 7265 7469 7a61 7469 6f6e 206e  discretization n
+0001bf50: 756d 6265 720a 2020 2020 6e20 3d20 5b0a  umber.    n = [.
+0001bf60: 2020 2020 2020 2020 696e 7428 6b77 6172          int(kwar
+0001bf70: 6773 2e67 6574 2822 6e31 222c 2056 6563  gs.get("n1", Vec
+0001bf80: 746f 7233 4453 6572 6965 732e 5f4e 2929  tor3DSeries._N))
+0001bf90: 2c0a 2020 2020 2020 2020 696e 7428 6b77  ,.        int(kw
+0001bfa0: 6172 6773 2e67 6574 2822 6e32 222c 2056  args.get("n2", V
+0001bfb0: 6563 746f 7233 4453 6572 6965 732e 5f4e  ector3DSeries._N
+0001bfc0: 2929 2c0a 2020 2020 2020 2020 696e 7428  )),.        int(
+0001bfd0: 6b77 6172 6773 2e67 6574 2822 6e33 222c  kwargs.get("n3",
+0001bfe0: 2056 6563 746f 7233 4453 6572 6965 732e   Vector3DSeries.
+0001bff0: 5f4e 2929 5d0a 2020 2020 6469 7363 725f  _N))].    discr_
+0001c000: 7379 6d62 6f6c 7320 3d20 5b72 5b30 5d20  symbols = [r[0] 
+0001c010: 666f 7220 7220 696e 2072 616e 6765 735d  for r in ranges]
+0001c020: 0a20 2020 2069 6478 203d 205b 6469 7363  .    idx = [disc
+0001c030: 725f 7379 6d62 6f6c 732e 696e 6465 7828  r_symbols.index(
+0001c040: 7329 2066 6f72 2073 2069 6e20 5b72 5b30  s) for s in [r[0
+0001c050: 5d20 666f 7220 7220 696e 206e 6577 5f72  ] for r in new_r
+0001c060: 616e 6765 735d 5d0a 2020 2020 6b77 6172  anges]].    kwar
+0001c070: 6773 3220 3d20 6b77 6172 6773 2e63 6f70  gs2 = kwargs.cop
+0001c080: 7928 290a 2020 2020 6b77 6172 6773 325b  y().    kwargs2[
+0001c090: 226e 3122 5d20 3d20 6e5b 6964 785b 305d  "n1"] = n[idx[0]
+0001c0a0: 5d0a 2020 2020 6b77 6172 6773 325b 226e  ].    kwargs2["n
+0001c0b0: 3222 5d20 3d20 6e5b 6964 785b 315d 5d0a  2"] = n[idx[1]].
+0001c0c0: 0a20 2020 2072 6574 7572 6e20 5375 7266  .    return Surf
+0001c0d0: 6163 654f 7665 7232 4452 616e 6765 5365  aceOver2DRangeSe
+0001c0e0: 7269 6573 2873 6c69 6365 5f73 7572 662c  ries(slice_surf,
+0001c0f0: 202a 6e65 775f 7261 6e67 6573 2c20 2a2a   *new_ranges, **
+0001c100: 6b77 6172 6773 3229 0a0a 0a63 6c61 7373  kwargs2)...class
+0001c110: 2053 6c69 6365 5665 6374 6f72 3344 5365   SliceVector3DSe
+0001c120: 7269 6573 2856 6563 746f 7233 4453 6572  ries(Vector3DSer
+0001c130: 6965 7329 3a0a 2020 2020 2222 2252 6570  ies):.    """Rep
+0001c140: 7265 7365 6e74 7320 6120 3344 2076 6563  resents a 3D vec
+0001c150: 746f 7220 6669 656c 6420 706c 6f74 7465  tor field plotte
+0001c160: 6420 6f76 6572 2061 2073 6c69 6365 2e20  d over a slice. 
+0001c170: 5468 6520 736c 6963 6520 6361 6e20 6265  The slice can be
+0001c180: 0a20 2020 2061 2050 6c61 6e65 206f 7220  .    a Plane or 
+0001c190: 6120 7375 7266 6163 652e 0a20 2020 2022  a surface..    "
+0001c1a0: 2222 0a20 2020 2069 735f 736c 6963 6520  "".    is_slice 
+0001c1b0: 3d20 5472 7565 0a0a 2020 2020 6465 6620  = True..    def 
+0001c1c0: 5f5f 696e 6974 5f5f 280a 2020 2020 2020  __init__(.      
+0001c1d0: 2020 7365 6c66 2c20 736c 6963 655f 7375    self, slice_su
+0001c1e0: 7266 2c20 752c 2076 2c20 772c 2072 616e  rf, u, v, w, ran
+0001c1f0: 6765 5f78 2c20 7261 6e67 655f 792c 2072  ge_x, range_y, r
+0001c200: 616e 6765 5f7a 2c0a 2020 2020 2020 2020  ange_z,.        
+0001c210: 6c61 6265 6c3d 2222 2c20 2a2a 6b77 6172  label="", **kwar
+0001c220: 6773 0a20 2020 2029 3a0a 2020 2020 2020  gs.    ):.      
+0001c230: 2020 7365 6c66 2e73 6c69 6365 5f73 7572    self.slice_sur
+0001c240: 665f 7365 7269 6573 203d 205f 6275 696c  f_series = _buil
+0001c250: 645f 736c 6963 655f 7365 7269 6573 280a  d_slice_series(.
+0001c260: 2020 2020 2020 2020 2020 2020 736c 6963              slic
+0001c270: 655f 7375 7266 2c20 5b72 616e 6765 5f78  e_surf, [range_x
+0001c280: 2c20 7261 6e67 655f 792c 2072 616e 6765  , range_y, range
+0001c290: 5f7a 5d2c 202a 2a6b 7761 7267 7329 0a20  _z], **kwargs). 
+0001c2a0: 2020 2020 2020 2073 7570 6572 2829 2e5f         super()._
+0001c2b0: 5f69 6e69 745f 5f28 752c 2076 2c20 772c  _init__(u, v, w,
+0001c2c0: 2072 616e 6765 5f78 2c20 7261 6e67 655f   range_x, range_
+0001c2d0: 792c 2072 616e 6765 5f7a 2c20 6c61 6265  y, range_z, labe
+0001c2e0: 6c2c 202a 2a6b 7761 7267 7329 0a0a 2020  l, **kwargs)..  
+0001c2f0: 2020 6465 6620 5f64 6973 6372 6574 697a    def _discretiz
+0001c300: 6528 7365 6c66 293a 0a20 2020 2020 2020  e(self):.       
+0001c310: 2064 6174 6120 3d20 7365 6c66 2e73 6c69   data = self.sli
+0001c320: 6365 5f73 7572 665f 7365 7269 6573 2e67  ce_surf_series.g
+0001c330: 6574 5f64 6174 6128 290a 2020 2020 2020  et_data().      
+0001c340: 2020 6966 2069 7369 6e73 7461 6e63 6528    if isinstance(
+0001c350: 7365 6c66 2e73 6c69 6365 5f73 7572 665f  self.slice_surf_
+0001c360: 7365 7269 6573 2c20 506c 616e 6553 6572  series, PlaneSer
+0001c370: 6965 7329 3a0a 2020 2020 2020 2020 2020  ies):.          
+0001c380: 2020 7265 7475 726e 2064 6174 610a 2020    return data.  
+0001c390: 2020 2020 2020 6966 2073 656c 662e 736c        if self.sl
+0001c3a0: 6963 655f 7375 7266 5f73 6572 6965 732e  ice_surf_series.
+0001c3b0: 6973 5f70 6172 616d 6574 7269 633a 0a20  is_parametric:. 
+0001c3c0: 2020 2020 2020 2020 2020 2072 6574 7572             retur
+0001c3d0: 6e20 6461 7461 5b3a 335d 0a0a 2020 2020  n data[:3]..    
+0001c3e0: 2020 2020 2320 7379 6d62 6f6c 7320 7573      # symbols us
+0001c3f0: 6564 2062 7920 7468 6973 2076 6563 746f  ed by this vecto
+0001c400: 7227 7320 6469 7363 7265 7469 7a61 7469  r's discretizati
+0001c410: 6f6e 0a20 2020 2020 2020 2064 6973 6372  on.        discr
+0001c420: 5f73 796d 626f 6c73 203d 205b 725b 305d  _symbols = [r[0]
+0001c430: 2066 6f72 2072 2069 6e20 7365 6c66 2e72   for r in self.r
+0001c440: 616e 6765 735d 0a20 2020 2020 2020 2023  anges].        #
+0001c450: 206f 7264 6572 6564 2073 796d 626f 6c73   ordered symbols
+0001c460: 2066 726f 6d20 736c 6963 655f 7375 7266   from slice_surf
+0001c470: 5f73 6572 6965 730a 2020 2020 2020 2020  _series.        
+0001c480: 6f72 6465 7220 3d20 7365 6c66 2e5f 6469  order = self._di
+0001c490: 7363 7265 7469 7a65 5f68 656c 7065 7228  scretize_helper(
+0001c4a0: 6469 7363 725f 7379 6d62 6f6c 7329 0a20  discr_symbols). 
+0001c4b0: 2020 2020 2020 2072 6574 7572 6e20 5b64         return [d
+0001c4c0: 6174 615b 6b5d 2066 6f72 206b 2069 6e20  ata[k] for k in 
+0001c4d0: 6f72 6465 725d 0a0a 2020 2020 6465 6620  order]..    def 
+0001c4e0: 5f64 6973 6372 6574 697a 655f 6865 6c70  _discretize_help
+0001c4f0: 6572 2873 656c 662c 2076 6563 5f64 6973  er(self, vec_dis
+0001c500: 6372 5f73 796d 626f 6c73 293a 0a20 2020  cr_symbols):.   
+0001c510: 2020 2020 2023 204e 4f54 453a 206c 6574       # NOTE: let
+0001c520: 2773 2073 6179 2074 6865 2076 6563 746f  's say the vecto
+0001c530: 7220 6669 656c 6420 6973 2064 6973 6372  r field is discr
+0001c540: 6574 697a 6564 2061 6c6f 6e67 2078 2c20  etized along x, 
+0001c550: 792c 207a 2028 696e 0a20 2020 2020 2020  y, z (in.       
+0001c560: 2023 2074 6869 7320 6f72 6465 7229 2c20   # this order), 
+0001c570: 616e 6420 7468 6520 736c 6963 6520 7375  and the slice su
+0001c580: 7266 6163 6520 6973 2066 2879 2c20 7a29  rface is f(y, z)
+0001c590: 2e20 5468 656e 2c20 6461 7461 2077 696c  . Then, data wil
+0001c5a0: 6c20 6265 0a20 2020 2020 2020 2023 205b  l be.        # [
+0001c5b0: 7979 2c20 7a7a 2c20 6628 7979 2c20 7a7a  yy, zz, f(yy, zz
+0001c5c0: 295d 2c20 7768 6963 6820 6861 7320 6e6f  )], which has no
+0001c5d0: 7420 7468 6520 636f 7272 6563 7420 6f72  t the correct or
+0001c5e0: 6465 7220 6578 7065 6374 6564 2062 790a  der expected by.
+0001c5f0: 2020 2020 2020 2020 2320 7468 6520 7665          # the ve
+0001c600: 6374 6f72 2066 6965 6c64 2773 2064 6973  ctor field's dis
+0001c610: 6372 6574 697a 6174 696f 6e2e 2048 6572  cretization. Her
+0001c620: 6520 7765 2061 7265 2067 6f69 6e67 2074  e we are going t
+0001c630: 6f20 6669 7820 7468 6174 2e0a 0a20 2020  o fix that...   
+0001c640: 2020 2020 2069 6620 6e6f 7420 6973 696e       if not isin
+0001c650: 7374 616e 6365 2873 656c 662e 736c 6963  stance(self.slic
+0001c660: 655f 7375 7266 5f73 6572 6965 732c 2053  e_surf_series, S
+0001c670: 7572 6661 6365 4f76 6572 3244 5261 6e67  urfaceOver2DRang
+0001c680: 6553 6572 6965 7329 3a0a 2020 2020 2020  eSeries):.      
+0001c690: 2020 2020 2020 7261 6973 6520 5479 7065        raise Type
+0001c6a0: 4572 726f 7228 2254 6869 7320 6865 6c70  Error("This help
+0001c6b0: 6572 2066 756e 6374 696f 6e20 6973 206d  er function is m
+0001c6c0: 6561 6e74 2074 6f20 6265 2075 7365 6420  eant to be used 
+0001c6d0: 6f6e 6c79 2022 0a20 2020 2020 2020 2020  only ".         
+0001c6e0: 2020 2020 2020 2022 7769 7468 206e 6f6e         "with non
+0001c6f0: 2d70 6172 616d 6574 7269 6320 736c 6963  -parametric slic
+0001c700: 696e 6720 7375 7266 6163 6573 206f 6620  ing surfaces of 
+0001c710: 3220 7661 7269 6162 6c65 732e 2022 0a20  2 variables. ". 
+0001c720: 2020 2020 2020 2020 2020 2020 2020 2022                 "
+0001c730: 7479 7065 2873 656c 662e 736c 6963 655f  type(self.slice_
+0001c740: 7375 7266 5f73 6572 6965 7329 203d 207b  surf_series) = {
+0001c750: 7d22 2e66 6f72 6d61 7428 0a20 2020 2020  }".format(.     
+0001c760: 2020 2020 2020 2020 2020 2020 2020 2074                 t
+0001c770: 7970 6528 7365 6c66 2e73 6c69 6365 5f73  ype(self.slice_s
+0001c780: 7572 665f 7365 7269 6573 2929 290a 0a20  urf_series))).. 
+0001c790: 2020 2020 2020 2023 2073 6c69 6365 2073         # slice s
+0001c7a0: 7572 6661 6365 2066 7265 6520 7379 6d62  urface free symb
+0001c7b0: 6f6c 730a 2020 2020 2020 2020 2320 646f  ols.        # do
+0001c7c0: 6e27 7420 7573 6520 7365 6c66 2e73 6c69  n't use self.sli
+0001c7d0: 6365 5f73 7572 665f 7365 7269 6573 2e66  ce_surf_series.f
+0001c7e0: 7265 655f 7379 6d62 6f6c 7320 6173 2074  ree_symbols as t
+0001c7f0: 6869 7320 6578 7072 6573 7369 6f6e 0a20  his expression. 
+0001c800: 2020 2020 2020 2023 206d 6967 6874 206e         # might n
+0001c810: 6f74 2075 7365 2062 6f74 6820 6974 7320  ot use both its 
+0001c820: 6469 7363 7265 7469 7a61 7469 6f6e 2073  discretization s
+0001c830: 796d 626f 6c73 0a20 2020 2020 2020 2073  ymbols.        s
+0001c840: 7366 7320 3d20 5b72 5b30 5d20 666f 7220  sfs = [r[0] for 
+0001c850: 7220 696e 2073 656c 662e 736c 6963 655f  r in self.slice_
+0001c860: 7375 7266 5f73 6572 6965 732e 7261 6e67  surf_series.rang
+0001c870: 6573 5d0a 2020 2020 2020 2020 2320 6769  es].        # gi
+0001c880: 7665 6e20 6628 792c 207a 292c 2077 6520  ven f(y, z), we 
+0001c890: 616c 7265 6164 7920 6861 7665 2079 2c20  already have y, 
+0001c8a0: 7a20 2873 7366 7329 2c20 6e6f 7720 6669  z (ssfs), now fi
+0001c8b0: 6e64 2078 0a20 2020 2020 2020 206d 6973  nd x.        mis
+0001c8c0: 7369 6e67 5f73 796d 626f 6c20 3d20 6c69  sing_symbol = li
+0001c8d0: 7374 2873 6574 2876 6563 5f64 6973 6372  st(set(vec_discr
+0001c8e0: 5f73 796d 626f 6c73 292e 6469 6666 6572  _symbols).differ
+0001c8f0: 656e 6365 2873 7366 7329 290a 2020 2020  ence(ssfs)).    
+0001c900: 2020 2020 2320 6f72 6465 7265 6420 7379      # ordered sy
+0001c910: 6d62 6f6c 7320 696e 2074 6865 2072 6574  mbols in the ret
+0001c920: 7572 6e65 6420 6461 7461 0a20 2020 2020  urned data.     
+0001c930: 2020 2072 6574 7572 6e65 645f 7379 6d62     returned_symb
+0001c940: 6f6c 7320 3d20 7373 6673 202b 206d 6973  ols = ssfs + mis
+0001c950: 7369 6e67 5f73 796d 626f 6c0a 2020 2020  sing_symbol.    
+0001c960: 2020 2020 2320 6f75 7470 7574 206f 7264      # output ord
+0001c970: 6572 0a20 2020 2020 2020 206f 7264 6572  er.        order
+0001c980: 203d 205b 7265 7475 726e 6564 5f73 796d   = [returned_sym
+0001c990: 626f 6c73 2e69 6e64 6578 2873 2920 666f  bols.index(s) fo
+0001c9a0: 7220 7320 696e 2076 6563 5f64 6973 6372  r s in vec_discr
+0001c9b0: 5f73 796d 626f 6c73 5d0a 2020 2020 2020  _symbols].      
+0001c9c0: 2020 7265 7475 726e 206f 7264 6572 0a0a    return order..
+0001c9d0: 2020 2020 6465 6620 5f63 7265 6174 655f      def _create_
+0001c9e0: 6469 7363 7265 7469 7a65 645f 646f 6d61  discretized_doma
+0001c9f0: 696e 2873 656c 6629 3a0a 2020 2020 2020  in(self):.      
+0001ca00: 2020 2222 2244 6973 6372 6574 697a 6520    """Discretize 
+0001ca10: 7468 6520 7261 6e67 6573 2069 6e20 6361  the ranges in ca
+0001ca20: 7365 206f 6620 756e 6966 6f72 6d20 6d65  se of uniform me
+0001ca30: 7368 696e 6720 7374 7261 7465 6779 2e0a  shing strategy..
+0001ca40: 2020 2020 2020 2020 2222 220a 2020 2020          """.    
+0001ca50: 2020 2020 2320 544f 444f 3a20 6f6e 6365      # TODO: once
+0001ca60: 2049 6e74 6572 6163 7469 7665 5365 7269   InteractiveSeri
+0001ca70: 6573 2068 6173 2062 6565 6e20 7265 6d6f  es has been remo
+0001ca80: 7665 2c20 7468 6520 666f 6c6c 6f77 696e  ve, the followin
+0001ca90: 6720 6361 6e0a 2020 2020 2020 2020 2320  g can.        # 
+0001caa0: 6265 2072 656f 7267 616e 697a 6564 2069  be reorganized i
+0001cab0: 6e20 6f72 6465 7220 746f 2072 656d 6f76  n order to remov
+0001cac0: 6520 636f 6465 2072 6570 6574 6974 696f  e code repetitio
+0001cad0: 6e2c 2073 7065 6369 6669 6361 6c6c 7920  n, specifically 
+0001cae0: 7468 650a 2020 2020 2020 2020 2320 666f  the.        # fo
+0001caf0: 6c6c 6f77 696e 6720 6c69 6e65 206f 6620  llowing line of 
+0001cb00: 636f 6465 2e0a 2020 2020 2020 2020 2320  code..        # 
+0001cb10: 7379 6d62 6f6c 7320 7573 6564 2062 7920  symbols used by 
+0001cb20: 7468 6973 2076 6563 746f 7227 7320 6469  this vector's di
+0001cb30: 7363 7265 7469 7a61 7469 6f6e 0a20 2020  scretization.   
+0001cb40: 2020 2020 2064 6973 6372 5f73 796d 626f       discr_symbo
+0001cb50: 6c73 203d 205b 725b 305d 2066 6f72 2072  ls = [r[0] for r
+0001cb60: 2069 6e20 7365 6c66 2e72 616e 6765 735d   in self.ranges]
+0001cb70: 0a20 2020 2020 2020 2064 6973 6372 6574  .        discret
+0001cb80: 697a 6174 696f 6e73 203d 2073 656c 662e  izations = self.
+0001cb90: 5f64 6973 6372 6574 697a 6528 290a 2020  _discretize().  
+0001cba0: 2020 2020 2020 7365 6c66 2e5f 6469 7363        self._disc
+0001cbb0: 7265 7469 7a65 645f 646f 6d61 696e 203d  retized_domain =
+0001cbc0: 207b 0a20 2020 2020 2020 2020 2020 206b   {.            k
+0001cbd0: 3a20 7620 666f 7220 6b2c 2076 2069 6e20  : v for k, v in 
+0001cbe0: 7a69 7028 6469 7363 725f 7379 6d62 6f6c  zip(discr_symbol
+0001cbf0: 732c 2064 6973 6372 6574 697a 6174 696f  s, discretizatio
+0001cc00: 6e73 297d 0a0a 2020 2020 4070 726f 7065  ns)}..    @prope
+0001cc10: 7274 790a 2020 2020 6465 6620 7061 7261  rty.    def para
+0001cc20: 6d73 2873 656c 6629 3a0a 2020 2020 2020  ms(self):.      
+0001cc30: 2020 2222 2247 6574 206f 7220 7365 7420    """Get or set 
+0001cc40: 7468 6520 6375 7272 656e 7420 7061 7261  the current para
+0001cc50: 6d65 7465 7273 2064 6963 7469 6f6e 6172  meters dictionar
+0001cc60: 792e 0a0a 2020 2020 2020 2020 5061 7261  y...        Para
+0001cc70: 6d65 7465 7273 0a20 2020 2020 2020 203d  meters.        =
+0001cc80: 3d3d 3d3d 3d3d 3d3d 3d0a 0a20 2020 2020  =========..     
+0001cc90: 2020 2070 203a 2064 6963 740a 2020 2020     p : dict.    
+0001cca0: 2020 2020 2020 2020 6b65 793a 2073 796d          key: sym
+0001ccb0: 626f 6c20 6173 736f 6369 6174 6564 2074  bol associated t
+0001ccc0: 6f20 7468 6520 7061 7261 6d65 7465 720a  o the parameter.
+0001ccd0: 2020 2020 2020 2020 2020 2020 7661 6c3a              val:
+0001cce0: 2074 6865 2076 616c 7565 0a20 2020 2020   the value.     
+0001ccf0: 2020 2022 2222 0a20 2020 2020 2020 2072     """.        r
+0001cd00: 6574 7572 6e20 7365 6c66 2e5f 7061 7261  eturn self._para
+0001cd10: 6d73 0a0a 2020 2020 4070 6172 616d 732e  ms..    @params.
+0001cd20: 7365 7474 6572 0a20 2020 2064 6566 2070  setter.    def p
+0001cd30: 6172 616d 7328 7365 6c66 2c20 7029 3a0a  arams(self, p):.
+0001cd40: 2020 2020 2020 2020 7365 6c66 2e5f 7061          self._pa
+0001cd50: 7261 6d73 203d 2073 656c 662e 5f70 6172  rams = self._par
+0001cd60: 616d 735f 6865 6c70 6572 2870 290a 2020  ams_helper(p).  
+0001cd70: 2020 2020 2020 6966 2073 656c 662e 736c        if self.sl
+0001cd80: 6963 655f 7375 7266 5f73 6572 6965 732e  ice_surf_series.
+0001cd90: 6973 5f69 6e74 6572 6163 7469 7665 3a0a  is_interactive:.
+0001cda0: 2020 2020 2020 2020 2020 2020 2320 7570              # up
+0001cdb0: 6461 7465 2062 6f74 6820 7061 7261 6d65  date both parame
+0001cdc0: 7465 7273 2061 6e64 2064 6973 6372 6574  ters and discret
+0001cdd0: 697a 6174 696f 6e20 7261 6e67 6573 0a20  ization ranges. 
+0001cde0: 2020 2020 2020 2020 2020 2073 656c 662e             self.
+0001cdf0: 736c 6963 655f 7375 7266 5f73 6572 6965  slice_surf_serie
+0001ce00: 732e 7061 7261 6d73 203d 2070 0a20 2020  s.params = p.   
+0001ce10: 2020 2020 2023 2073 796d 626f 6c73 2075       # symbols u
+0001ce20: 7365 6420 6279 2074 6869 7320 7665 6374  sed by this vect
+0001ce30: 6f72 2773 2064 6973 6372 6574 697a 6174  or's discretizat
+0001ce40: 696f 6e0a 2020 2020 2020 2020 6469 7363  ion.        disc
+0001ce50: 725f 7379 6d62 6f6c 7320 3d20 5b72 5b30  r_symbols = [r[0
+0001ce60: 5d20 666f 7220 7220 696e 2073 656c 662e  ] for r in self.
+0001ce70: 7261 6e67 6573 5d0a 0a20 2020 2020 2020  ranges]..       
+0001ce80: 2069 6620 280a 2020 2020 2020 2020 2020   if (.          
+0001ce90: 2020 6973 696e 7374 616e 6365 2873 656c    isinstance(sel
+0001cea0: 662e 736c 6963 655f 7375 7266 5f73 6572  f.slice_surf_ser
+0001ceb0: 6965 732c 2053 7572 6661 6365 4f76 6572  ies, SurfaceOver
+0001cec0: 3244 5261 6e67 6553 6572 6965 7329 2061  2DRangeSeries) a
+0001ced0: 6e64 0a20 2020 2020 2020 2020 2020 2028  nd.            (
+0001cee0: 6e6f 7420 7365 6c66 2e73 6c69 6365 5f73  not self.slice_s
+0001cef0: 7572 665f 7365 7269 6573 2e69 735f 7061  urf_series.is_pa
+0001cf00: 7261 6d65 7472 6963 290a 2020 2020 2020  rametric).      
+0001cf10: 2020 293a 0a20 2020 2020 2020 2020 2020    ):.           
+0001cf20: 2023 206f 7264 6572 6564 2073 796d 626f   # ordered symbo
+0001cf30: 6c73 2066 726f 6d20 736c 6963 655f 7375  ls from slice_su
+0001cf40: 7266 5f73 6572 6965 730a 2020 2020 2020  rf_series.      
+0001cf50: 2020 2020 2020 6f72 6465 7265 645f 7379        ordered_sy
+0001cf60: 6d62 6f6c 7320 3d20 7365 6c66 2e5f 6469  mbols = self._di
+0001cf70: 7363 7265 7469 7a65 5f68 656c 7065 7228  scretize_helper(
+0001cf80: 6469 7363 725f 7379 6d62 6f6c 7329 0a20  discr_symbols). 
+0001cf90: 2020 2020 2020 2020 2020 2064 6174 6120             data 
+0001cfa0: 3d20 7365 6c66 2e73 6c69 6365 5f73 7572  = self.slice_sur
+0001cfb0: 665f 7365 7269 6573 2e67 6574 5f64 6174  f_series.get_dat
+0001cfc0: 6128 290a 2020 2020 2020 2020 2020 2020  a().            
+0001cfd0: 7365 6c66 2e5f 6469 7363 7265 7469 7a65  self._discretize
+0001cfe0: 645f 646f 6d61 696e 203d 207b 0a20 2020  d_domain = {.   
+0001cff0: 2020 2020 2020 2020 2020 2020 206b 3a20               k: 
+0001d000: 6461 7461 5b76 5d20 666f 7220 6b2c 2076  data[v] for k, v
+0001d010: 2069 6e20 7a69 7028 6469 7363 725f 7379   in zip(discr_sy
+0001d020: 6d62 6f6c 732c 206f 7264 6572 6564 5f73  mbols, ordered_s
+0001d030: 796d 626f 6c73 290a 2020 2020 2020 2020  ymbols).        
+0001d040: 2020 2020 7d0a 2020 2020 2020 2020 656c      }.        el
+0001d050: 7365 3a0a 2020 2020 2020 2020 2020 2020  se:.            
+0001d060: 7365 6c66 2e5f 6469 7363 7265 7469 7a65  self._discretize
+0001d070: 645f 646f 6d61 696e 203d 207b 0a20 2020  d_domain = {.   
+0001d080: 2020 2020 2020 2020 2020 2020 206b 3a20               k: 
+0001d090: 7620 666f 7220 6b2c 2076 2069 6e20 7a69  v for k, v in zi
+0001d0a0: 7028 0a20 2020 2020 2020 2020 2020 2020  p(.             
+0001d0b0: 2020 2020 2020 2064 6973 6372 5f73 796d         discr_sym
+0001d0c0: 626f 6c73 2c0a 2020 2020 2020 2020 2020  bols,.          
+0001d0d0: 2020 2020 2020 2020 2020 7365 6c66 2e73            self.s
+0001d0e0: 6c69 6365 5f73 7572 665f 7365 7269 6573  lice_surf_series
+0001d0f0: 2e67 6574 5f64 6174 6128 290a 2020 2020  .get_data().    
+0001d100: 2020 2020 2020 2020 2020 2020 290a 2020              ).  
+0001d110: 2020 2020 2020 2020 2020 7d0a 0a20 2020            }..   
+0001d120: 2064 6566 205f 5f73 7472 5f5f 2873 656c   def __str__(sel
+0001d130: 6629 3a0a 2020 2020 2020 2020 7265 7475  f):.        retu
+0001d140: 726e 2022 736c 6963 6564 2022 202b 2073  rn "sliced " + s
+0001d150: 7570 6572 2829 2e5f 5f73 7472 5f5f 2829  uper().__str__()
+0001d160: 202b 2022 2061 7420 7b7d 222e 666f 726d   + " at {}".form
+0001d170: 6174 280a 2020 2020 2020 2020 2020 2020  at(.            
+0001d180: 7365 6c66 2e73 6c69 6365 5f73 7572 665f  self.slice_surf_
+0001d190: 7365 7269 6573 290a 0a0a 636c 6173 7320  series)...class 
+0001d1a0: 506c 616e 6553 6572 6965 7328 5375 7266  PlaneSeries(Surf
+0001d1b0: 6163 6542 6173 6553 6572 6965 7329 3a0a  aceBaseSeries):.
+0001d1c0: 2020 2020 2222 2252 6570 7265 7365 6e74      """Represent
+0001d1d0: 7320 6120 706c 616e 6520 696e 2061 2033  s a plane in a 3
+0001d1e0: 4420 646f 6d61 696e 2e22 2222 0a0a 2020  D domain."""..  
+0001d1f0: 2020 6973 5f33 4473 7572 6661 6365 203d    is_3Dsurface =
+0001d200: 2054 7275 650a 2020 2020 5f4e 203d 2032   True.    _N = 2
+0001d210: 300a 0a20 2020 2023 2061 2067 656e 6572  0..    # a gener
+0001d220: 6963 2070 6c61 6e65 2028 666f 7220 6578  ic plane (for ex
+0001d230: 616d 706c 6520 7769 7468 206e 6f72 6d61  ample with norma
+0001d240: 6c20 2831 2c31 2c31 2929 2063 616e 2067  l (1,1,1)) can g
+0001d250: 656e 6572 6174 6520 6120 6875 6765 0a20  enerate a huge. 
+0001d260: 2020 2023 2072 616e 6765 2061 6c6f 6e67     # range along
+0001d270: 2074 6865 207a 2d64 6972 6563 7469 6f6e   the z-direction
+0001d280: 2e20 5769 7468 205f 7573 655f 6e61 6e3d  . With _use_nan=
+0001d290: 5472 7565 2c20 6576 6572 7920 7a2d 7661  True, every z-va
+0001d2a0: 6c75 6520 6f75 7473 6964 650a 2020 2020  lue outside.    
+0001d2b0: 2320 6f66 2074 6865 2070 726f 7669 6465  # of the provide
+0001d2c0: 6420 7a5f 7261 6e67 6520 7769 6c6c 2062  d z_range will b
+0001d2d0: 6520 7365 7420 746f 204e 616e 2e0a 2020  e set to Nan..  
+0001d2e0: 2020 5f75 7365 5f6e 616e 203d 2054 7275    _use_nan = Tru
+0001d2f0: 650a 0a20 2020 2064 6566 205f 5f69 6e69  e..    def __ini
+0001d300: 745f 5f28 0a20 2020 2020 2020 2073 656c  t__(.        sel
+0001d310: 662c 2070 6c61 6e65 2c20 785f 7261 6e67  f, plane, x_rang
+0001d320: 652c 2079 5f72 616e 6765 2c20 7a5f 7261  e, y_range, z_ra
+0001d330: 6e67 653d 4e6f 6e65 2c20 6c61 6265 6c3d  nge=None, label=
+0001d340: 2222 2c20 2a2a 6b77 6172 6773 0a20 2020  "", **kwargs.   
+0001d350: 2029 3a0a 2020 2020 2020 2020 7375 7065   ):.        supe
+0001d360: 7228 292e 5f5f 696e 6974 5f5f 282a 2a6b  r().__init__(**k
+0001d370: 7761 7267 7329 0a20 2020 2020 2020 2073  wargs).        s
+0001d380: 656c 662e 5f62 6c6f 636b 5f6c 616d 6264  elf._block_lambd
+0001d390: 615f 6675 6e63 7469 6f6e 7328 706c 616e  a_functions(plan
+0001d3a0: 6529 0a20 2020 2020 2020 2073 656c 662e  e).        self.
+0001d3b0: 706c 616e 6520 3d20 7379 6d70 6966 7928  plane = sympify(
+0001d3c0: 706c 616e 6529 0a20 2020 2020 2020 2073  plane).        s
+0001d3d0: 656c 662e 6578 7072 203d 2073 656c 662e  elf.expr = self.
+0001d3e0: 706c 616e 650a 2020 2020 2020 2020 6966  plane.        if
+0001d3f0: 206e 6f74 2069 7369 6e73 7461 6e63 6528   not isinstance(
+0001d400: 7365 6c66 2e70 6c61 6e65 2c20 506c 616e  self.plane, Plan
+0001d410: 6529 3a0a 2020 2020 2020 2020 2020 2020  e):.            
+0001d420: 7261 6973 6520 5479 7065 4572 726f 7228  raise TypeError(
+0001d430: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0001d440: 2022 6070 6c61 6e65 6020 6d75 7374 2062   "`plane` must b
+0001d450: 6520 616e 2069 6e73 7461 6e63 6520 6f66  e an instance of
+0001d460: 2073 796d 7079 2e67 656f 6d65 7472 792e   sympy.geometry.
+0001d470: 506c 616e 6522 290a 2020 2020 2020 2020  Plane").        
+0001d480: 7365 6c66 2e78 5f72 616e 6765 203d 2073  self.x_range = s
+0001d490: 796d 7069 6679 2878 5f72 616e 6765 290a  ympify(x_range).
+0001d4a0: 2020 2020 2020 2020 7365 6c66 2e79 5f72          self.y_r
+0001d4b0: 616e 6765 203d 2073 796d 7069 6679 2879  ange = sympify(y
+0001d4c0: 5f72 616e 6765 290a 2020 2020 2020 2020  _range).        
+0001d4d0: 7365 6c66 2e7a 5f72 616e 6765 203d 2073  self.z_range = s
+0001d4e0: 796d 7069 6679 287a 5f72 616e 6765 290a  ympify(z_range).
+0001d4f0: 2020 2020 2020 2020 7365 6c66 2e72 616e          self.ran
+0001d500: 6765 7320 3d20 5b73 656c 662e 785f 7261  ges = [self.x_ra
+0001d510: 6e67 652c 2073 656c 662e 795f 7261 6e67  nge, self.y_rang
+0001d520: 652c 2073 656c 662e 7a5f 7261 6e67 655d  e, self.z_range]
+0001d530: 0a20 2020 2020 2020 2073 656c 662e 5f73  .        self._s
+0001d540: 6574 5f73 7572 6661 6365 5f6c 6162 656c  et_surface_label
+0001d550: 286c 6162 656c 290a 2020 2020 2020 2020  (label).        
+0001d560: 6966 2073 656c 662e 7061 7261 6d73 2061  if self.params a
+0001d570: 6e64 206e 6f74 2073 656c 662e 706c 616e  nd not self.plan
+0001d580: 652e 6672 6565 5f73 796d 626f 6c73 3a0a  e.free_symbols:.
+0001d590: 2020 2020 2020 2020 2020 2020 7365 6c66              self
+0001d5a0: 2e70 6172 616d 7320 3d20 6469 6374 2829  .params = dict()
+0001d5b0: 0a20 2020 2020 2020 2020 2020 2073 656c  .            sel
+0001d5c0: 662e 6973 5f69 6e74 6572 6163 7469 7665  f.is_interactive
+0001d5d0: 203d 2046 616c 7365 0a0a 2020 2020 6465   = False..    de
+0001d5e0: 6620 5f5f 7374 725f 5f28 7365 6c66 293a  f __str__(self):
+0001d5f0: 0a20 2020 2020 2020 2072 6574 7572 6e20  .        return 
+0001d600: 7365 6c66 2e5f 7374 725f 6865 6c70 6572  self._str_helper
+0001d610: 280a 2020 2020 2020 2020 2020 2020 2270  (.            "p
+0001d620: 6c61 6e65 2073 6572 6965 733a 2025 7320  lane series: %s 
+0001d630: 6f76 6572 2025 732c 2025 732c 2025 7322  over %s, %s, %s"
+0001d640: 2025 2028 0a20 2020 2020 2020 2020 2020   % (.           
+0001d650: 2020 2020 2073 656c 662e 706c 616e 652c       self.plane,
+0001d660: 2073 656c 662e 785f 7261 6e67 652c 2073   self.x_range, s
+0001d670: 656c 662e 795f 7261 6e67 652c 2073 656c  elf.y_range, sel
+0001d680: 662e 7a5f 7261 6e67 6529 290a 0a20 2020  f.z_range))..   
+0001d690: 2064 6566 2067 6574 5f64 6174 6128 7365   def get_data(se
+0001d6a0: 6c66 293a 0a20 2020 2020 2020 206e 7020  lf):.        np 
+0001d6b0: 3d20 696d 706f 7274 5f6d 6f64 756c 6528  = import_module(
+0001d6c0: 276e 756d 7079 2729 0a0a 2020 2020 2020  'numpy')..      
+0001d6d0: 2020 782c 2079 2c20 7a20 3d20 7379 6d62    x, y, z = symb
+0001d6e0: 6f6c 7328 2278 2c20 792c 207a 2229 0a20  ols("x, y, z"). 
+0001d6f0: 2020 2020 2020 2070 6c61 6e65 203d 2073         plane = s
+0001d700: 656c 662e 706c 616e 652e 7375 6273 2873  elf.plane.subs(s
+0001d710: 656c 662e 5f70 6172 616d 7329 0a20 2020  elf._params).   
+0001d720: 2020 2020 2066 7320 3d20 706c 616e 652e       fs = plane.
+0001d730: 6571 7561 7469 6f6e 2878 2c20 792c 207a  equation(x, y, z
+0001d740: 292e 6672 6565 5f73 796d 626f 6c73 0a20  ).free_symbols. 
+0001d750: 2020 2020 2020 2078 782c 2079 792c 207a         xx, yy, z
+0001d760: 7a20 3d20 4e6f 6e65 2c20 4e6f 6e65 2c20  z = None, None, 
+0001d770: 4e6f 6e65 0a20 2020 2020 2020 2069 6620  None.        if 
+0001d780: 6673 203d 3d20 7365 7428 5b78 5d29 3a0a  fs == set([x]):.
+0001d790: 2020 2020 2020 2020 2020 2020 2320 7061              # pa
+0001d7a0: 7261 6c6c 656c 2074 6f20 797a 2070 6c61  rallel to yz pla
+0001d7b0: 6e65 2028 6e6f 726d 616c 2076 6563 746f  ne (normal vecto
+0001d7c0: 7220 2831 2c20 302c 2030 2929 0a20 2020  r (1, 0, 0)).   
+0001d7d0: 2020 2020 2020 2020 2073 203d 2053 7572           s = Sur
+0001d7e0: 6661 6365 4f76 6572 3244 5261 6e67 6553  faceOver2DRangeS
+0001d7f0: 6572 6965 7328 0a20 2020 2020 2020 2020  eries(.         
+0001d800: 2020 2020 2020 2070 6c61 6e65 2e70 315b         plane.p1[
+0001d810: 305d 2c0a 2020 2020 2020 2020 2020 2020  0],.            
+0001d820: 2020 2020 2878 2c20 2a73 656c 662e 7a5f      (x, *self.z_
+0001d830: 7261 6e67 655b 313a 5d29 2c0a 2020 2020  range[1:]),.    
+0001d840: 2020 2020 2020 2020 2020 2020 2879 2c20              (y, 
+0001d850: 2a73 656c 662e 795f 7261 6e67 655b 313a  *self.y_range[1:
+0001d860: 5d29 2c0a 2020 2020 2020 2020 2020 2020  ]),.            
+0001d870: 2020 2020 2222 2c0a 2020 2020 2020 2020      "",.        
+0001d880: 2020 2020 2020 2020 6e31 3d73 656c 662e          n1=self.
+0001d890: 6e5b 325d 2c0a 2020 2020 2020 2020 2020  n[2],.          
+0001d8a0: 2020 2020 2020 6e32 3d73 656c 662e 6e5b        n2=self.n[
+0001d8b0: 315d 2c0a 2020 2020 2020 2020 2020 2020  1],.            
+0001d8c0: 2020 2020 7873 6361 6c65 3d73 656c 662e      xscale=self.
+0001d8d0: 5f73 6361 6c65 735b 305d 2c0a 2020 2020  _scales[0],.    
+0001d8e0: 2020 2020 2020 2020 2020 2020 7973 6361              ysca
+0001d8f0: 6c65 3d73 656c 662e 5f73 6361 6c65 735b  le=self._scales[
+0001d900: 315d 0a20 2020 2020 2020 2020 2020 2029  1].            )
+0001d910: 0a20 2020 2020 2020 2020 2020 2078 782c  .            xx,
+0001d920: 2079 792c 207a 7a20 3d20 732e 6765 745f   yy, zz = s.get_
+0001d930: 6461 7461 2829 0a20 2020 2020 2020 2020  data().         
+0001d940: 2020 2078 782c 2079 792c 207a 7a20 3d20     xx, yy, zz = 
+0001d950: 7a7a 2c20 7979 2c20 7878 0a20 2020 2020  zz, yy, xx.     
+0001d960: 2020 2065 6c69 6620 6673 203d 3d20 7365     elif fs == se
+0001d970: 7428 5b79 5d29 3a0a 2020 2020 2020 2020  t([y]):.        
+0001d980: 2020 2020 2320 7061 7261 6c6c 656c 2074      # parallel t
+0001d990: 6f20 787a 2070 6c61 6e65 2028 6e6f 726d  o xz plane (norm
+0001d9a0: 616c 2076 6563 746f 7220 2830 2c20 312c  al vector (0, 1,
+0001d9b0: 2030 2929 0a20 2020 2020 2020 2020 2020   0)).           
+0001d9c0: 2073 203d 2053 7572 6661 6365 4f76 6572   s = SurfaceOver
+0001d9d0: 3244 5261 6e67 6553 6572 6965 7328 0a20  2DRangeSeries(. 
+0001d9e0: 2020 2020 2020 2020 2020 2020 2020 2070                 p
+0001d9f0: 6c61 6e65 2e70 315b 315d 2c0a 2020 2020  lane.p1[1],.    
+0001da00: 2020 2020 2020 2020 2020 2020 2878 2c20              (x, 
+0001da10: 2a73 656c 662e 785f 7261 6e67 655b 313a  *self.x_range[1:
+0001da20: 5d29 2c0a 2020 2020 2020 2020 2020 2020  ]),.            
+0001da30: 2020 2020 2879 2c20 2a73 656c 662e 7a5f      (y, *self.z_
+0001da40: 7261 6e67 655b 313a 5d29 2c0a 2020 2020  range[1:]),.    
+0001da50: 2020 2020 2020 2020 2020 2020 2222 2c0a              "",.
+0001da60: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001da70: 6e31 3d73 656c 662e 6e5b 305d 2c0a 2020  n1=self.n[0],.  
+0001da80: 2020 2020 2020 2020 2020 2020 2020 6e32                n2
+0001da90: 3d73 656c 662e 6e5b 325d 2c0a 2020 2020  =self.n[2],.    
+0001daa0: 2020 2020 2020 2020 2020 2020 7873 6361              xsca
+0001dab0: 6c65 3d73 656c 662e 5f73 6361 6c65 735b  le=self._scales[
+0001dac0: 305d 2c0a 2020 2020 2020 2020 2020 2020  0],.            
+0001dad0: 2020 2020 7973 6361 6c65 3d73 656c 662e      yscale=self.
+0001dae0: 5f73 6361 6c65 735b 315d 0a20 2020 2020  _scales[1].     
+0001daf0: 2020 2020 2020 2029 0a20 2020 2020 2020         ).       
+0001db00: 2020 2020 2078 782c 2079 792c 207a 7a20       xx, yy, zz 
+0001db10: 3d20 732e 6765 745f 6461 7461 2829 0a20  = s.get_data(). 
+0001db20: 2020 2020 2020 2020 2020 2078 782c 2079             xx, y
+0001db30: 792c 207a 7a20 3d20 7878 2c20 7a7a 2c20  y, zz = xx, zz, 
+0001db40: 7979 0a20 2020 2020 2020 2065 6c69 6620  yy.        elif 
+0001db50: 6673 203d 3d20 7365 7428 5b78 2c20 795d  fs == set([x, y]
+0001db60: 293a 0a20 2020 2020 2020 2020 2020 2023  ):.            #
+0001db70: 2076 6572 7469 6361 6c20 706c 616e 6520   vertical plane 
+0001db80: 6f72 6965 6e74 6564 2077 6974 6820 736f  oriented with so
+0001db90: 6d65 2061 6e67 6c65 0a0a 2020 2020 2020  me angle..      
+0001dba0: 2020 2020 2020 2320 4765 7420 6e75 6d70        # Get nump
+0001dbb0: 7920 7665 6374 6f72 730a 2020 2020 2020  y vectors.      
+0001dbc0: 2020 2020 2020 7031 203d 206e 702e 6172        p1 = np.ar
+0001dbd0: 7261 7928 706c 616e 652e 7031 2c20 6474  ray(plane.p1, dt
+0001dbe0: 7970 653d 666c 6f61 7429 0a20 2020 2020  ype=float).     
+0001dbf0: 2020 2020 2020 206e 7620 3d20 6e70 2e61         nv = np.a
+0001dc00: 7272 6179 2870 6c61 6e65 2e6e 6f72 6d61  rray(plane.norma
+0001dc10: 6c5f 7665 6374 6f72 2c20 6474 7970 653d  l_vector, dtype=
+0001dc20: 666c 6f61 7429 0a20 2020 2020 2020 2020  float).         
+0001dc30: 2020 2023 2063 6f6e 7665 7274 2074 6865     # convert the
+0001dc40: 206e 6f72 6d61 6c20 7665 6374 6f72 2074   normal vector t
+0001dc50: 6f20 756e 6974 206e 6f72 6d61 6c20 7665  o unit normal ve
+0001dc60: 6374 6f72 0a20 2020 2020 2020 2020 2020  ctor.           
+0001dc70: 206e 7620 3d20 6e76 202f 206e 702e 7371   nv = nv / np.sq
+0001dc80: 7274 286e 762e 5420 4020 6e76 290a 0a20  rt(nv.T @ nv).. 
+0001dc90: 2020 2020 2020 2020 2020 2023 2070 6c61             # pla
+0001dca0: 6e65 2068 6173 2064 6973 7461 6e63 6520  ne has distance 
+0001dcb0: 746f 206f 7269 6769 6e20 6173 206c 656e  to origin as len
+0001dcc0: 6774 6820 6f66 2070 726f 6a65 6374 696f  gth of projectio
+0001dcd0: 6e20 6f66 0a20 2020 2020 2020 2020 2020  n of.           
+0001dce0: 2023 2070 3120 6f6e 746f 206e 6f72 6d61   # p1 onto norma
+0001dcf0: 6c20 7665 6374 6f72 0a20 2020 2020 2020  l vector.       
+0001dd00: 2020 2020 2070 726f 6a5f 7032 6e76 203d       proj_p2nv =
+0001dd10: 206e 762e 646f 7428 7031 290a 0a20 2020   nv.dot(p1)..   
+0001dd20: 2020 2020 2020 2020 2073 203d 2053 7572           s = Sur
+0001dd30: 6661 6365 4f76 6572 3244 5261 6e67 6553  faceOver2DRangeS
+0001dd40: 6572 6965 7328 0a20 2020 2020 2020 2020  eries(.         
+0001dd50: 2020 2020 2020 2070 726f 6a5f 7032 6e76         proj_p2nv
+0001dd60: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
+0001dd70: 2020 2878 2c20 2a73 656c 662e 785f 7261    (x, *self.x_ra
+0001dd80: 6e67 655b 313a 5d29 2c0a 2020 2020 2020  nge[1:]),.      
+0001dd90: 2020 2020 2020 2020 2020 2879 2c20 2a73            (y, *s
+0001dda0: 656c 662e 7a5f 7261 6e67 655b 313a 5d29  elf.z_range[1:])
+0001ddb0: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
+0001ddc0: 2020 2222 2c0a 2020 2020 2020 2020 2020    "",.          
+0001ddd0: 2020 2020 2020 6e31 3d73 656c 662e 6e5b        n1=self.n[
+0001dde0: 305d 2c0a 2020 2020 2020 2020 2020 2020  0],.            
+0001ddf0: 2020 2020 6e32 3d73 656c 662e 6e5b 325d      n2=self.n[2]
+0001de00: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
+0001de10: 2020 7873 6361 6c65 3d73 656c 662e 5f73    xscale=self._s
+0001de20: 6361 6c65 735b 305d 2c0a 2020 2020 2020  cales[0],.      
+0001de30: 2020 2020 2020 2020 2020 7973 6361 6c65            yscale
+0001de40: 3d73 656c 662e 5f73 6361 6c65 735b 315d  =self._scales[1]
+0001de50: 0a20 2020 2020 2020 2020 2020 2029 0a20  .            ). 
+0001de60: 2020 2020 2020 2020 2020 2078 782c 2079             xx, y
+0001de70: 792c 207a 7a20 3d20 732e 6765 745f 6461  y, zz = s.get_da
+0001de80: 7461 2829 0a20 2020 2020 2020 2020 2020  ta().           
+0001de90: 2078 782c 2079 792c 207a 7a20 3d20 7878   xx, yy, zz = xx
+0001dea0: 2c20 7a7a 2c20 7979 0a0a 2020 2020 2020  , zz, yy..      
+0001deb0: 2020 2020 2020 2320 726f 7461 7465 2070        # rotate p
+0001dec0: 6c61 6e65 2063 6f72 7265 7370 6f6e 6469  lane correspondi
+0001ded0: 6e67 2074 6f20 7468 6520 6e6f 726d 616c  ng to the normal
+0001dee0: 2076 6563 746f 720a 2020 2020 2020 2020   vector.        
+0001def0: 2020 2020 6465 6620 5228 7429 3a0a 2020      def R(t):.  
+0001df00: 2020 2020 2020 2020 2020 2020 2020 7265                re
+0001df10: 7475 726e 206e 702e 6172 7261 7928 5b0a  turn np.array([.
+0001df20: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001df30: 2020 2020 5b6e 702e 636f 7328 7429 2c20      [np.cos(t), 
+0001df40: 2d6e 702e 7369 6e28 7429 2c20 305d 2c0a  -np.sin(t), 0],.
+0001df50: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001df60: 2020 2020 5b6e 702e 7369 6e28 7429 2c20      [np.sin(t), 
+0001df70: 6e70 2e63 6f73 2874 292c 2030 5d2c 0a20  np.cos(t), 0],. 
+0001df80: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001df90: 2020 205b 302c 2030 2c20 315d 0a20 2020     [0, 0, 1].   
+0001dfa0: 2020 2020 2020 2020 2020 2020 205d 290a               ]).
+0001dfb0: 0a20 2020 2020 2020 2020 2020 2074 6865  .            the
+0001dfc0: 7461 203d 206e 702e 6172 6374 616e 3228  ta = np.arctan2(
+0001dfd0: 6e76 5b31 5d2c 206e 765b 305d 290a 2020  nv[1], nv[0]).  
+0001dfe0: 2020 2020 2020 2020 2020 636f 6f72 6473            coords
+0001dff0: 203d 206e 702e 7374 6163 6b28 5b74 2e66   = np.stack([t.f
+0001e000: 6c61 7474 656e 2829 2066 6f72 2074 2069  latten() for t i
+0001e010: 6e20 5b78 782c 2079 792c 206e 702e 6f6e  n [xx, yy, np.on
+0001e020: 6573 5f6c 696b 6528 7878 295d 5d29 2e54  es_like(xx)]]).T
+0001e030: 0a20 2020 2020 2020 2020 2020 2063 6f6f  .            coo
+0001e040: 7264 7320 3d20 6e70 2e6d 6174 6d75 6c28  rds = np.matmul(
+0001e050: 636f 6f72 6473 2c20 5228 7468 6574 6129  coords, R(theta)
+0001e060: 290a 2020 2020 2020 2020 2020 2020 7979  ).            yy
+0001e070: 2c20 7878 203d 2063 6f6f 7264 735b 3a2c  , xx = coords[:,
+0001e080: 2030 5d2e 7265 7368 6170 6528 7979 2e73   0].reshape(yy.s
+0001e090: 6861 7065 292c 2063 6f6f 7264 735b 3a2c  hape), coords[:,
+0001e0a0: 2031 5d2e 7265 7368 6170 6528 7878 2e73   1].reshape(xx.s
+0001e0b0: 6861 7065 290a 2020 2020 2020 2020 656c  hape).        el
+0001e0c0: 7365 3a0a 2020 2020 2020 2020 2020 2020  se:.            
+0001e0d0: 2320 616e 7920 6f74 6865 7220 706c 616e  # any other plan
+0001e0e0: 650a 2020 2020 2020 2020 2020 2020 6571  e.            eq
+0001e0f0: 203d 2070 6c61 6e65 2e65 7175 6174 696f   = plane.equatio
+0001e100: 6e28 782c 2079 2c20 7a29 0a20 2020 2020  n(x, y, z).     
+0001e110: 2020 2020 2020 2069 6620 7a20 696e 2065         if z in e
+0001e120: 712e 6672 6565 5f73 796d 626f 6c73 3a0a  q.free_symbols:.
+0001e130: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001e140: 6571 203d 2073 6f6c 7665 2865 712c 207a  eq = solve(eq, z
+0001e150: 295b 305d 0a20 2020 2020 2020 2020 2020  )[0].           
+0001e160: 2073 203d 2053 7572 6661 6365 4f76 6572   s = SurfaceOver
+0001e170: 3244 5261 6e67 6553 6572 6965 7328 0a20  2DRangeSeries(. 
+0001e180: 2020 2020 2020 2020 2020 2020 2020 2065                 e
+0001e190: 712c 0a20 2020 2020 2020 2020 2020 2020  q,.             
+0001e1a0: 2020 2028 782c 202a 7365 6c66 2e78 5f72     (x, *self.x_r
+0001e1b0: 616e 6765 5b31 3a5d 292c 0a20 2020 2020  ange[1:]),.     
+0001e1c0: 2020 2020 2020 2020 2020 2028 792c 202a             (y, *
+0001e1d0: 7365 6c66 2e79 5f72 616e 6765 5b31 3a5d  self.y_range[1:]
+0001e1e0: 292c 0a20 2020 2020 2020 2020 2020 2020  ),.             
+0001e1f0: 2020 2022 222c 0a20 2020 2020 2020 2020     "",.         
+0001e200: 2020 2020 2020 206e 313d 7365 6c66 2e6e         n1=self.n
+0001e210: 5b30 5d2c 0a20 2020 2020 2020 2020 2020  [0],.           
+0001e220: 2020 2020 206e 323d 7365 6c66 2e6e 5b31       n2=self.n[1
+0001e230: 5d2c 0a20 2020 2020 2020 2020 2020 2020  ],.             
+0001e240: 2020 2078 7363 616c 653d 7365 6c66 2e5f     xscale=self._
+0001e250: 7363 616c 6573 5b30 5d2c 0a20 2020 2020  scales[0],.     
+0001e260: 2020 2020 2020 2020 2020 2079 7363 616c             yscal
+0001e270: 653d 7365 6c66 2e5f 7363 616c 6573 5b31  e=self._scales[1
+0001e280: 5d0a 2020 2020 2020 2020 2020 2020 290a  ].            ).
+0001e290: 2020 2020 2020 2020 2020 2020 7878 2c20              xx, 
+0001e2a0: 7979 2c20 7a7a 203d 2073 2e67 6574 5f64  yy, zz = s.get_d
+0001e2b0: 6174 6128 290a 2020 2020 2020 2020 2020  ata().          
+0001e2c0: 2020 6966 2028 6c65 6e28 6673 2920 3e20    if (len(fs) > 
+0001e2d0: 3129 2061 6e64 2073 656c 662e 5f75 7365  1) and self._use
+0001e2e0: 5f6e 616e 3a0a 2020 2020 2020 2020 2020  _nan:.          
+0001e2f0: 2020 2020 2020 6964 7820 3d20 6e70 2e6c        idx = np.l
+0001e300: 6f67 6963 616c 5f6f 7228 7a7a 203c 2073  ogical_or(zz < s
+0001e310: 656c 662e 7a5f 7261 6e67 655b 315d 2c20  elf.z_range[1], 
+0001e320: 7a7a 203e 2073 656c 662e 7a5f 7261 6e67  zz > self.z_rang
+0001e330: 655b 325d 290a 2020 2020 2020 2020 2020  e[2]).          
+0001e340: 2020 2020 2020 7a7a 5b69 6478 5d20 3d20        zz[idx] = 
+0001e350: 6e70 2e6e 616e 0a20 2020 2020 2020 2072  np.nan.        r
+0001e360: 6574 7572 6e20 7365 6c66 2e5f 6170 706c  eturn self._appl
+0001e370: 795f 7472 616e 7366 6f72 6d28 7878 2c20  y_transform(xx, 
+0001e380: 7979 2c20 7a7a 290a 0a0a 636c 6173 7320  yy, zz)...class 
+0001e390: 4765 6f6d 6574 7279 5365 7269 6573 284c  GeometrySeries(L
+0001e3a0: 696e 6532 4442 6173 6553 6572 6965 7329  ine2DBaseSeries)
+0001e3b0: 3a0a 2020 2020 2222 2252 6570 7265 7365  :.    """Represe
+0001e3c0: 6e74 7320 616e 2065 6e74 6974 7920 6672  nts an entity fr
+0001e3d0: 6f6d 2074 6865 2073 796d 7079 2e67 656f  om the sympy.geo
+0001e3e0: 6d65 7472 7920 6d6f 6475 6c65 2e0a 2020  metry module..  
+0001e3f0: 2020 4465 7065 6e64 696e 6720 6f6e 2074    Depending on t
+0001e400: 6865 2067 656f 6d65 7472 7920 656e 7469  he geometry enti
+0001e410: 7479 2c20 7468 6973 2063 6c61 7373 2063  ty, this class c
+0001e420: 616e 2065 6974 6865 7220 7265 7072 6573  an either repres
+0001e430: 656e 7473 2061 0a20 2020 2070 6f69 6e74  ents a.    point
+0001e440: 2c20 6120 6c69 6e65 2c20 6f72 2061 2070  , a line, or a p
+0001e450: 6172 616d 6574 7269 6320 6c69 6e65 0a20  arametric line. 
+0001e460: 2020 2022 2222 0a0a 2020 2020 6973 5f67     """..    is_g
+0001e470: 656f 6d65 7472 7920 3d20 5472 7565 0a0a  eometry = True..
+0001e480: 2020 2020 6465 6620 5f5f 6e65 775f 5f28      def __new__(
+0001e490: 636c 732c 202a 6172 6773 2c20 2a2a 6b77  cls, *args, **kw
+0001e4a0: 6172 6773 293a 0a20 2020 2020 2020 2069  args):.        i
+0001e4b0: 6620 6973 696e 7374 616e 6365 2861 7267  f isinstance(arg
+0001e4c0: 735b 305d 2c20 506c 616e 6529 3a0a 2020  s[0], Plane):.  
+0001e4d0: 2020 2020 2020 2020 2020 7265 7475 726e            return
+0001e4e0: 2050 6c61 6e65 5365 7269 6573 282a 6172   PlaneSeries(*ar
+0001e4f0: 6773 2c20 2a2a 6b77 6172 6773 290a 2020  gs, **kwargs).  
+0001e500: 2020 2020 2020 656c 6966 2069 7369 6e73        elif isins
+0001e510: 7461 6e63 6528 6172 6773 5b30 5d2c 2043  tance(args[0], C
+0001e520: 7572 7665 293a 0a20 2020 2020 2020 2020  urve):.         
+0001e530: 2020 206e 6577 5f63 6c73 203d 2028 0a20     new_cls = (. 
+0001e540: 2020 2020 2020 2020 2020 2020 2020 2050                 P
+0001e550: 6172 616d 6574 7269 6332 444c 696e 6553  arametric2DLineS
+0001e560: 6572 6965 730a 2020 2020 2020 2020 2020  eries.          
+0001e570: 2020 2020 2020 6966 206c 656e 2861 7267        if len(arg
+0001e580: 735b 305d 2e66 756e 6374 696f 6e73 2920  s[0].functions) 
+0001e590: 3d3d 2032 0a20 2020 2020 2020 2020 2020  == 2.           
+0001e5a0: 2020 2020 2065 6c73 6520 5061 7261 6d65       else Parame
+0001e5b0: 7472 6963 3344 4c69 6e65 5365 7269 6573  tric3DLineSeries
+0001e5c0: 0a20 2020 2020 2020 2020 2020 2029 0a20  .            ). 
+0001e5d0: 2020 2020 2020 2020 2020 2072 6574 7572             retur
+0001e5e0: 6e20 6e65 775f 636c 7328 2a61 7267 735b  n new_cls(*args[
+0001e5f0: 305d 2e66 756e 6374 696f 6e73 2c20 6172  0].functions, ar
+0001e600: 6773 5b30 5d2e 6c69 6d69 7473 2c20 2a2a  gs[0].limits, **
+0001e610: 6b77 6172 6773 290a 2020 2020 2020 2020  kwargs).        
+0001e620: 7265 7475 726e 206f 626a 6563 742e 5f5f  return object.__
+0001e630: 6e65 775f 5f28 636c 7329 0a0a 2020 2020  new__(cls)..    
+0001e640: 6465 6620 5f5f 696e 6974 5f5f 2873 656c  def __init__(sel
+0001e650: 662c 2065 7870 722c 205f 7261 6e67 653d  f, expr, _range=
+0001e660: 4e6f 6e65 2c20 6c61 6265 6c3d 2222 2c20  None, label="", 
+0001e670: 2a2a 6b77 6172 6773 293a 0a20 2020 2020  **kwargs):.     
+0001e680: 2020 2069 6620 6e6f 7420 6973 696e 7374     if not isinst
+0001e690: 616e 6365 2865 7870 722c 2047 656f 6d65  ance(expr, Geome
+0001e6a0: 7472 7945 6e74 6974 7929 3a0a 2020 2020  tryEntity):.    
+0001e6b0: 2020 2020 2020 2020 7261 6973 6520 5661          raise Va
+0001e6c0: 6c75 6545 7272 6f72 280a 2020 2020 2020  lueError(.      
+0001e6d0: 2020 2020 2020 2020 2020 2260 6578 7072            "`expr
+0001e6e0: 6020 6d75 7374 2062 6520 6120 6765 6f6d  ` must be a geom
+0001e6f0: 7472 6963 2065 6e74 6974 792e 5c6e 220a  tric entity.\n".
+0001e700: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001e710: 2b20 2252 6563 6569 7665 643a 2074 7970  + "Received: typ
+0001e720: 6528 6578 7072 2920 3d20 7b7d 5c6e 222e  e(expr) = {}\n".
+0001e730: 666f 726d 6174 2874 7970 6528 6578 7072  format(type(expr
+0001e740: 2929 0a20 2020 2020 2020 2020 2020 2020  )).             
+0001e750: 2020 202b 2022 4578 7072 3a20 7b7d 222e     + "Expr: {}".
+0001e760: 666f 726d 6174 2865 7870 7229 0a20 2020  format(expr).   
+0001e770: 2020 2020 2020 2020 2029 0a20 2020 2020           ).     
+0001e780: 2020 2073 7570 6572 2829 2e5f 5f69 6e69     super().__ini
+0001e790: 745f 5f28 2a2a 6b77 6172 6773 290a 2020  t__(**kwargs).  
+0001e7a0: 2020 2020 2020 7220 3d20 6578 7072 2e66        r = expr.f
+0001e7b0: 7265 655f 7379 6d62 6f6c 732e 6469 6666  ree_symbols.diff
+0001e7c0: 6572 656e 6365 2873 6574 2873 656c 662e  erence(set(self.
+0001e7d0: 7061 7261 6d73 2e6b 6579 7328 2929 290a  params.keys())).
+0001e7e0: 2020 2020 2020 2020 6966 206c 656e 2872          if len(r
+0001e7f0: 2920 3e20 303a 0a20 2020 2020 2020 2020  ) > 0:.         
+0001e800: 2020 2072 6169 7365 2056 616c 7565 4572     raise ValueEr
+0001e810: 726f 7228 0a20 2020 2020 2020 2020 2020  ror(.           
+0001e820: 2020 2020 2022 546f 6f20 6d61 6e79 2066       "Too many f
+0001e830: 7265 6520 7379 6d62 6f6c 732e 2050 6c65  ree symbols. Ple
+0001e840: 6173 652c 2073 7065 6369 6679 2074 6865  ase, specify the
+0001e850: 2076 616c 7565 7320 6f66 2074 6865 2022   values of the "
+0001e860: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0001e870: 2066 2266 6f6c 6c6f 7769 6e67 2073 796d   f"following sym
+0001e880: 626f 6c73 2077 6974 6820 7468 6520 6070  bols with the `p
+0001e890: 6172 616d 7360 2064 6963 7469 6f6e 6172  arams` dictionar
+0001e8a0: 793a 207b 727d 220a 2020 2020 2020 2020  y: {r}".        
+0001e8b0: 2020 2020 290a 2020 2020 2020 2020 7365      ).        se
+0001e8c0: 6c66 2e5f 6578 7072 203d 2065 7870 720a  lf._expr = expr.
+0001e8d0: 2020 2020 2020 2020 7365 6c66 2e72 616e          self.ran
+0001e8e0: 6765 7320 3d20 5b5f 7261 6e67 655d 0a20  ges = [_range]. 
+0001e8f0: 2020 2020 2020 2073 656c 662e 5f6c 6162         self._lab
+0001e900: 656c 203d 2073 7472 2865 7870 7229 2069  el = str(expr) i
+0001e910: 6620 6c61 6265 6c20 6973 204e 6f6e 6520  f label is None 
+0001e920: 656c 7365 206c 6162 656c 0a20 2020 2020  else label.     
+0001e930: 2020 2073 656c 662e 5f6c 6174 6578 5f6c     self._latex_l
+0001e940: 6162 656c 203d 206c 6174 6578 2865 7870  abel = latex(exp
+0001e950: 7229 2069 6620 6c61 6265 6c20 6973 204e  r) if label is N
+0001e960: 6f6e 6520 656c 7365 206c 6162 656c 0a20  one else label. 
+0001e970: 2020 2020 2020 2069 6620 6973 696e 7374         if isinst
+0001e980: 616e 6365 2865 7870 722c 2028 4c69 6e65  ance(expr, (Line
+0001e990: 6172 456e 7469 7479 3344 2c20 506f 696e  arEntity3D, Poin
+0001e9a0: 7433 4429 293a 0a20 2020 2020 2020 2020  t3D)):.         
+0001e9b0: 2020 2073 656c 662e 6973 5f32 446c 696e     self.is_2Dlin
+0001e9c0: 6520 3d20 4661 6c73 650a 2020 2020 2020  e = False.      
+0001e9d0: 2020 2020 2020 7365 6c66 2e69 735f 3344        self.is_3D
+0001e9e0: 6c69 6e65 203d 2054 7275 650a 2020 2020  line = True.    
+0001e9f0: 2020 2020 2020 2020 7365 6c66 2e69 735f          self.is_
+0001ea00: 7061 7261 6d65 7472 6963 203d 2046 616c  parametric = Fal
+0001ea10: 7365 0a20 2020 2020 2020 2020 2020 2069  se.            i
+0001ea20: 6620 6973 696e 7374 616e 6365 2865 7870  f isinstance(exp
+0001ea30: 722c 2050 6f69 6e74 3344 293a 0a20 2020  r, Point3D):.   
+0001ea40: 2020 2020 2020 2020 2020 2020 2073 656c               sel
+0001ea50: 662e 6973 5f70 6f69 6e74 203d 2054 7275  f.is_point = Tru
+0001ea60: 650a 2020 2020 2020 2020 656c 6966 2069  e.        elif i
+0001ea70: 7369 6e73 7461 6e63 6528 6578 7072 2c20  sinstance(expr, 
+0001ea80: 4c69 6e65 6172 456e 7469 7479 3244 293a  LinearEntity2D):
+0001ea90: 0a20 2020 2020 2020 2020 2020 2073 656c  .            sel
+0001eaa0: 662e 6973 5f32 446c 696e 6520 3d20 5472  f.is_2Dline = Tr
+0001eab0: 7565 0a20 2020 2020 2020 2065 6c69 6620  ue.        elif 
+0001eac0: 6973 696e 7374 616e 6365 2865 7870 722c  isinstance(expr,
+0001ead0: 2028 506f 6c79 676f 6e2c 2043 6972 636c   (Polygon, Circl
+0001eae0: 652c 2045 6c6c 6970 7365 2929 3a0a 2020  e, Ellipse)):.  
+0001eaf0: 2020 2020 2020 2020 2020 7365 6c66 2e69            self.i
+0001eb00: 735f 3244 6c69 6e65 203d 206e 6f74 2073  s_2Dline = not s
+0001eb10: 656c 662e 6973 5f66 696c 6c65 640a 2020  elf.is_filled.  
+0001eb20: 2020 2020 2020 656c 6966 2069 7369 6e73        elif isins
+0001eb30: 7461 6e63 6528 6578 7072 2c20 506f 696e  tance(expr, Poin
+0001eb40: 7432 4429 3a0a 2020 2020 2020 2020 2020  t2D):.          
+0001eb50: 2020 7365 6c66 2e69 735f 706f 696e 7420    self.is_point 
+0001eb60: 3d20 5472 7565 0a20 2020 2020 2020 2020  = True.         
+0001eb70: 2020 2073 656c 662e 6973 5f32 446c 696e     self.is_2Dlin
+0001eb80: 6520 3d20 5472 7565 0a20 2020 2020 2020  e = True.       
+0001eb90: 2020 2020 2073 656c 662e 706f 6c65 735f       self.poles_
+0001eba0: 6c6f 6361 7469 6f6e 7320 3d20 5b5d 0a0a  locations = []..
+0001ebb0: 2020 2020 6465 6620 6765 745f 6461 7461      def get_data
+0001ebc0: 2873 656c 6629 3a0a 2020 2020 2020 2020  (self):.        
+0001ebd0: 6e70 203d 2069 6d70 6f72 745f 6d6f 6475  np = import_modu
+0001ebe0: 6c65 2827 6e75 6d70 7927 290a 0a20 2020  le('numpy')..   
+0001ebf0: 2020 2020 2065 7870 7220 3d20 7365 6c66       expr = self
+0001ec00: 2e65 7870 722e 7375 6273 2873 656c 662e  .expr.subs(self.
+0001ec10: 7061 7261 6d73 290a 2020 2020 2020 2020  params).        
+0001ec20: 6966 2069 7369 6e73 7461 6e63 6528 6578  if isinstance(ex
+0001ec30: 7072 2c20 506f 696e 7433 4429 3a0a 2020  pr, Point3D):.  
+0001ec40: 2020 2020 2020 2020 2020 7265 7475 726e            return
+0001ec50: 2073 656c 662e 5f61 7070 6c79 5f74 7261   self._apply_tra
+0001ec60: 6e73 666f 726d 280a 2020 2020 2020 2020  nsform(.        
+0001ec70: 2020 2020 2020 2020 6e70 2e61 7272 6179          np.array
+0001ec80: 285b 6578 7072 2e78 5d2c 2064 7479 7065  ([expr.x], dtype
+0001ec90: 3d66 6c6f 6174 292c 0a20 2020 2020 2020  =float),.       
+0001eca0: 2020 2020 2020 2020 206e 702e 6172 7261           np.arra
+0001ecb0: 7928 5b65 7870 722e 795d 2c20 6474 7970  y([expr.y], dtyp
+0001ecc0: 653d 666c 6f61 7429 2c0a 2020 2020 2020  e=float),.      
+0001ecd0: 2020 2020 2020 2020 2020 6e70 2e61 7272            np.arr
+0001ece0: 6179 285b 6578 7072 2e7a 5d2c 2064 7479  ay([expr.z], dty
+0001ecf0: 7065 3d66 6c6f 6174 290a 2020 2020 2020  pe=float).      
+0001ed00: 2020 2020 2020 290a 2020 2020 2020 2020        ).        
+0001ed10: 656c 6966 2069 7369 6e73 7461 6e63 6528  elif isinstance(
+0001ed20: 6578 7072 2c20 506f 696e 7432 4429 3a0a  expr, Point2D):.
+0001ed30: 2020 2020 2020 2020 2020 2020 7265 7475              retu
+0001ed40: 726e 2073 656c 662e 5f61 7070 6c79 5f74  rn self._apply_t
+0001ed50: 7261 6e73 666f 726d 280a 2020 2020 2020  ransform(.      
+0001ed60: 2020 2020 2020 2020 2020 6e70 2e61 7272            np.arr
+0001ed70: 6179 285b 6578 7072 2e78 5d2c 2064 7479  ay([expr.x], dty
+0001ed80: 7065 3d66 6c6f 6174 292c 0a20 2020 2020  pe=float),.     
+0001ed90: 2020 2020 2020 2020 2020 206e 702e 6172             np.ar
+0001eda0: 7261 7928 5b65 7870 722e 795d 2c20 6474  ray([expr.y], dt
+0001edb0: 7970 653d 666c 6f61 7429 0a20 2020 2020  ype=float).     
+0001edc0: 2020 2020 2020 2029 0a20 2020 2020 2020         ).       
+0001edd0: 2065 6c69 6620 6973 696e 7374 616e 6365   elif isinstance
+0001ede0: 2865 7870 722c 2050 6f6c 7967 6f6e 293a  (expr, Polygon):
+0001edf0: 0a20 2020 2020 2020 2020 2020 2078 203d  .            x =
+0001ee00: 205b 666c 6f61 7428 762e 7829 2066 6f72   [float(v.x) for
+0001ee10: 2076 2069 6e20 6578 7072 2e76 6572 7469   v in expr.verti
+0001ee20: 6365 735d 0a20 2020 2020 2020 2020 2020  ces].           
+0001ee30: 2079 203d 205b 666c 6f61 7428 762e 7929   y = [float(v.y)
+0001ee40: 2066 6f72 2076 2069 6e20 6578 7072 2e76   for v in expr.v
+0001ee50: 6572 7469 6365 735d 0a20 2020 2020 2020  ertices].       
+0001ee60: 2020 2020 2078 2e61 7070 656e 6428 785b       x.append(x[
+0001ee70: 305d 290a 2020 2020 2020 2020 2020 2020  0]).            
+0001ee80: 792e 6170 7065 6e64 2879 5b30 5d29 0a20  y.append(y[0]). 
+0001ee90: 2020 2020 2020 2020 2020 2072 6574 7572             retur
+0001eea0: 6e20 7365 6c66 2e5f 6170 706c 795f 7472  n self._apply_tr
+0001eeb0: 616e 7366 6f72 6d28 6e70 2e61 7272 6179  ansform(np.array
+0001eec0: 2878 292c 206e 702e 6172 7261 7928 7929  (x), np.array(y)
+0001eed0: 290a 2020 2020 2020 2020 656c 6966 2069  ).        elif i
+0001eee0: 7369 6e73 7461 6e63 6528 6578 7072 2c20  sinstance(expr, 
+0001eef0: 4369 7263 6c65 293a 0a20 2020 2020 2020  Circle):.       
+0001ef00: 2020 2020 2063 782c 2063 7920 3d20 666c       cx, cy = fl
+0001ef10: 6f61 7428 6578 7072 2e63 656e 7465 725b  oat(expr.center[
+0001ef20: 305d 292c 2066 6c6f 6174 2865 7870 722e  0]), float(expr.
+0001ef30: 6365 6e74 6572 5b31 5d29 0a20 2020 2020  center[1]).     
+0001ef40: 2020 2020 2020 2072 203d 2066 6c6f 6174         r = float
+0001ef50: 2865 7870 722e 7261 6469 7573 290a 2020  (expr.radius).  
+0001ef60: 2020 2020 2020 2020 2020 7420 3d20 6e70            t = np
+0001ef70: 2e6c 696e 7370 6163 6528 302c 2032 202a  .linspace(0, 2 *
+0001ef80: 206e 702e 7069 2c20 7365 6c66 2e6e 5b30   np.pi, self.n[0
+0001ef90: 5d29 0a20 2020 2020 2020 2020 2020 2078  ]).            x
+0001efa0: 2c20 7920 3d20 6378 202b 2072 202a 206e  , y = cx + r * n
+0001efb0: 702e 636f 7328 7429 2c20 6379 202b 2072  p.cos(t), cy + r
+0001efc0: 202a 206e 702e 7369 6e28 7429 0a20 2020   * np.sin(t).   
+0001efd0: 2020 2020 2020 2020 2078 203d 206e 702e           x = np.
+0001efe0: 6170 7065 6e64 2878 2c20 785b 305d 290a  append(x, x[0]).
+0001eff0: 2020 2020 2020 2020 2020 2020 7920 3d20              y = 
+0001f000: 6e70 2e61 7070 656e 6428 792c 2079 5b30  np.append(y, y[0
+0001f010: 5d29 0a20 2020 2020 2020 2020 2020 2072  ]).            r
+0001f020: 6574 7572 6e20 7365 6c66 2e5f 6170 706c  eturn self._appl
+0001f030: 795f 7472 616e 7366 6f72 6d28 782c 2079  y_transform(x, y
+0001f040: 290a 2020 2020 2020 2020 656c 6966 2069  ).        elif i
+0001f050: 7369 6e73 7461 6e63 6528 6578 7072 2c20  sinstance(expr, 
+0001f060: 456c 6c69 7073 6529 3a0a 2020 2020 2020  Ellipse):.      
+0001f070: 2020 2020 2020 6378 2c20 6379 203d 2066        cx, cy = f
+0001f080: 6c6f 6174 2865 7870 722e 6365 6e74 6572  loat(expr.center
+0001f090: 5b30 5d29 2c20 666c 6f61 7428 6578 7072  [0]), float(expr
+0001f0a0: 2e63 656e 7465 725b 315d 290a 2020 2020  .center[1]).    
+0001f0b0: 2020 2020 2020 2020 6120 3d20 666c 6f61          a = floa
+0001f0c0: 7428 6578 7072 2e68 7261 6469 7573 290a  t(expr.hradius).
+0001f0d0: 2020 2020 2020 2020 2020 2020 6520 3d20              e = 
+0001f0e0: 666c 6f61 7428 6578 7072 2e65 6363 656e  float(expr.eccen
+0001f0f0: 7472 6963 6974 7929 0a20 2020 2020 2020  tricity).       
+0001f100: 2020 2020 2078 203d 206e 702e 6c69 6e73       x = np.lins
+0001f110: 7061 6365 282d 612c 2061 2c20 7365 6c66  pace(-a, a, self
+0001f120: 2e6e 5b30 5d29 0a20 2020 2020 2020 2020  .n[0]).         
+0001f130: 2020 2079 203d 206e 702e 7371 7274 2828     y = np.sqrt((
+0001f140: 6120 2a2a 2032 202d 2078 202a 2a20 3229  a ** 2 - x ** 2)
+0001f150: 202a 2028 3120 2d20 6520 2a2a 2032 2929   * (1 - e ** 2))
+0001f160: 0a20 2020 2020 2020 2020 2020 2078 202b  .            x +
+0001f170: 3d20 6378 0a20 2020 2020 2020 2020 2020  = cx.           
+0001f180: 2078 2c20 7920 3d20 6e70 2e63 6f6e 6361   x, y = np.conca
+0001f190: 7465 6e61 7465 2828 782c 2078 5b3a 3a2d  tenate((x, x[::-
+0001f1a0: 315d 2929 2c20 6e70 2e63 6f6e 6361 7465  1])), np.concate
+0001f1b0: 6e61 7465 2828 6379 202b 2079 2c20 6379  nate((cy + y, cy
+0001f1c0: 202d 2079 5b3a 3a2d 315d 2929 0a20 2020   - y[::-1])).   
+0001f1d0: 2020 2020 2020 2020 2078 203d 206e 702e           x = np.
+0001f1e0: 6170 7065 6e64 2878 2c20 785b 305d 290a  append(x, x[0]).
+0001f1f0: 2020 2020 2020 2020 2020 2020 7920 3d20              y = 
+0001f200: 6e70 2e61 7070 656e 6428 792c 2079 5b30  np.append(y, y[0
+0001f210: 5d29 0a20 2020 2020 2020 2020 2020 2072  ]).            r
+0001f220: 6574 7572 6e20 7365 6c66 2e5f 6170 706c  eturn self._appl
+0001f230: 795f 7472 616e 7366 6f72 6d28 782c 2079  y_transform(x, y
+0001f240: 290a 2020 2020 2020 2020 656c 6966 2069  ).        elif i
+0001f250: 7369 6e73 7461 6e63 6528 6578 7072 2c20  sinstance(expr, 
+0001f260: 4c69 6e65 6172 456e 7469 7479 3344 293a  LinearEntity3D):
+0001f270: 0a20 2020 2020 2020 2020 2020 2070 312c  .            p1,
+0001f280: 2070 3220 3d20 6578 7072 2e70 6f69 6e74   p2 = expr.point
+0001f290: 730a 2020 2020 2020 2020 2020 2020 7820  s.            x 
+0001f2a0: 3d20 6e70 2e61 7272 6179 285b 7031 2e78  = np.array([p1.x
+0001f2b0: 2c20 7032 2e78 5d2c 2064 7479 7065 3d66  , p2.x], dtype=f
+0001f2c0: 6c6f 6174 290a 2020 2020 2020 2020 2020  loat).          
+0001f2d0: 2020 7920 3d20 6e70 2e61 7272 6179 285b    y = np.array([
+0001f2e0: 7031 2e79 2c20 7032 2e79 5d2c 2064 7479  p1.y, p2.y], dty
+0001f2f0: 7065 3d66 6c6f 6174 290a 2020 2020 2020  pe=float).      
+0001f300: 2020 2020 2020 7a20 3d20 6e70 2e61 7272        z = np.arr
+0001f310: 6179 285b 7031 2e7a 2c20 7032 2e7a 5d2c  ay([p1.z, p2.z],
+0001f320: 2064 7479 7065 3d66 6c6f 6174 290a 2020   dtype=float).  
+0001f330: 2020 2020 2020 2020 2020 7265 7475 726e            return
+0001f340: 2073 656c 662e 5f61 7070 6c79 5f74 7261   self._apply_tra
+0001f350: 6e73 666f 726d 2878 2c20 792c 207a 290a  nsform(x, y, z).
+0001f360: 2020 2020 2020 2020 656c 6966 2069 7369          elif isi
+0001f370: 6e73 7461 6e63 6528 6578 7072 2c20 2853  nstance(expr, (S
+0001f380: 6567 6d65 6e74 2c20 5261 7929 293a 0a20  egment, Ray)):. 
+0001f390: 2020 2020 2020 2020 2020 2070 312c 2070             p1, p
+0001f3a0: 3220 3d20 6578 7072 2e70 6f69 6e74 730a  2 = expr.points.
+0001f3b0: 2020 2020 2020 2020 2020 2020 7820 3d20              x = 
+0001f3c0: 6e70 2e61 7272 6179 285b 7031 2e78 2c20  np.array([p1.x, 
+0001f3d0: 7032 2e78 5d29 0a20 2020 2020 2020 2020  p2.x]).         
+0001f3e0: 2020 2079 203d 206e 702e 6172 7261 7928     y = np.array(
+0001f3f0: 5b70 312e 792c 2070 322e 795d 290a 2020  [p1.y, p2.y]).  
+0001f400: 2020 2020 2020 2020 2020 7265 7475 726e            return
+0001f410: 2073 656c 662e 5f61 7070 6c79 5f74 7261   self._apply_tra
+0001f420: 6e73 666f 726d 2878 2e61 7374 7970 6528  nsform(x.astype(
+0001f430: 666c 6f61 7429 2c20 792e 6173 7479 7065  float), y.astype
+0001f440: 2866 6c6f 6174 2929 0a20 2020 2020 2020  (float)).       
+0001f450: 2065 6c73 653a 2020 2320 4c69 6e65 0a20   else:  # Line. 
+0001f460: 2020 2020 2020 2020 2020 2070 312c 2070             p1, p
+0001f470: 3220 3d20 6578 7072 2e70 6f69 6e74 730a  2 = expr.points.
+0001f480: 2020 2020 2020 2020 2020 2020 6966 206e              if n
+0001f490: 6f74 2073 656c 662e 7261 6e67 6573 3a0a  ot self.ranges:.
+0001f4a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001f4b0: 7820 3d20 6e70 2e61 7272 6179 285b 7031  x = np.array([p1
+0001f4c0: 2e78 2c20 7032 2e78 5d29 0a20 2020 2020  .x, p2.x]).     
+0001f4d0: 2020 2020 2020 2020 2020 2079 203d 206e             y = n
+0001f4e0: 702e 6172 7261 7928 5b70 312e 792c 2070  p.array([p1.y, p
+0001f4f0: 322e 795d 290a 2020 2020 2020 2020 2020  2.y]).          
+0001f500: 2020 656c 7365 3a0a 2020 2020 2020 2020    else:.        
+0001f510: 2020 2020 2020 2020 5f72 616e 6765 203d          _range =
+0001f520: 2073 656c 662e 7261 6e67 6573 5b30 5d0a   self.ranges[0].
+0001f530: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001f540: 6d20 3d20 6578 7072 2e73 6c6f 7065 0a20  m = expr.slope. 
+0001f550: 2020 2020 2020 2020 2020 2020 2020 2071                 q
+0001f560: 203d 2070 315b 315d 202d 206d 202a 2070   = p1[1] - m * p
+0001f570: 315b 305d 0a20 2020 2020 2020 2020 2020  1[0].           
+0001f580: 2020 2020 2078 203d 206e 702e 6172 7261       x = np.arra
+0001f590: 7928 5b5f 7261 6e67 655b 315d 2c20 5f72  y([_range[1], _r
+0001f5a0: 616e 6765 5b32 5d5d 290a 2020 2020 2020  ange[2]]).      
+0001f5b0: 2020 2020 2020 2020 2020 7920 3d20 6d20            y = m 
+0001f5c0: 2a20 7820 2b20 710a 2020 2020 2020 2020  * x + q.        
+0001f5d0: 2020 2020 7265 7475 726e 2073 656c 662e      return self.
+0001f5e0: 5f61 7070 6c79 5f74 7261 6e73 666f 726d  _apply_transform
+0001f5f0: 2878 2e61 7374 7970 6528 666c 6f61 7429  (x.astype(float)
+0001f600: 2c20 792e 6173 7479 7065 2866 6c6f 6174  , y.astype(float
+0001f610: 2929 0a0a 2020 2020 6465 6620 5f5f 7374  ))..    def __st
+0001f620: 725f 5f28 7365 6c66 293a 0a20 2020 2020  r__(self):.     
+0001f630: 2020 2072 6574 7572 6e20 7365 6c66 2e5f     return self._
+0001f640: 7374 725f 6865 6c70 6572 2822 6765 6f6d  str_helper("geom
+0001f650: 6574 7279 2065 6e74 6974 793a 2025 7322  etry entity: %s"
+0001f660: 2025 2073 7472 2873 656c 662e 6578 7072   % str(self.expr
+0001f670: 2929 0a0a 0a63 6c61 7373 2047 656e 6572  ))...class Gener
+0001f680: 6963 4461 7461 5365 7269 6573 2842 6173  icDataSeries(Bas
+0001f690: 6553 6572 6965 7329 3a0a 2020 2020 2222  eSeries):.    ""
+0001f6a0: 2252 6570 7265 7365 6e74 7320 6765 6e65  "Represents gene
+0001f6b0: 7269 6320 6e75 6d65 7269 6361 6c20 6461  ric numerical da
+0001f6c0: 7461 2e0a 0a20 2020 204e 4f54 453a 0a20  ta...    NOTE:. 
+0001f6d0: 2020 2054 6869 7320 636c 6173 7320 696d     This class im
+0001f6e0: 706c 656d 656e 7473 2062 6163 6b2d 636f  plements back-co
+0001f6f0: 6d70 6174 6962 696c 6974 7920 7769 7468  mpatibility with
+0001f700: 2053 796d 7079 203c 3d31 2e31 313a 2069   Sympy <=1.11: i
+0001f710: 7473 2070 6c6f 7474 696e 670a 2020 2020  ts plotting.    
+0001f720: 6d6f 6475 6c65 2061 6363 6570 7473 2074  module accepts t
+0001f730: 6865 2066 6f6c 6c6f 7769 6e67 206b 6579  he following key
+0001f740: 776f 7264 2061 7267 756d 656e 7473 3a0a  word arguments:.
+0001f750: 0a20 2020 2061 6e6e 6f74 6174 696f 6e73  .    annotations
+0001f760: 2c20 6d61 726b 6572 732c 2072 6563 7461  , markers, recta
+0001f770: 6e67 6c65 732c 2066 696c 6c0a 0a20 2020  ngles, fill..   
+0001f780: 2053 6164 6c79 2c20 7468 6520 6465 7665   Sadly, the deve
+0001f790: 6c6f 7065 7273 2066 6f72 676f 7420 746f  lopers forgot to
+0001f7a0: 2070 726f 7065 726c 7920 646f 6375 6d65   properly docume
+0001f7b0: 6e74 2074 6865 6d3a 2074 6865 7265 2061  nt them: there a
+0001f7c0: 7265 206e 6f0a 2020 2020 6578 616d 706c  re no.    exampl
+0001f7d0: 6520 7768 6174 736f 6576 6572 2061 626f  e whatsoever abo
+0001f7e0: 7574 2074 6865 6972 2075 7361 6765 2e20  ut their usage. 
+0001f7f0: 5468 6973 2069 7320 6163 7475 616c 6c79  This is actually
+0001f800: 2061 2076 6572 7920 676f 6f64 2074 6869   a very good thi
+0001f810: 6e67 0a20 2020 2066 6f72 2074 6869 7320  ng.    for this 
+0001f820: 6e65 7720 706c 6f74 7469 6e67 206d 6f64  new plotting mod
+0001f830: 756c 652c 2077 6869 6368 2073 7570 706f  ule, which suppo
+0001f840: 7274 7320 6d75 6c74 6970 6c65 2062 6163  rts multiple bac
+0001f850: 6b65 6e64 732e 0a20 2020 2045 7665 7279  kends..    Every
+0001f860: 2062 6163 6b65 6e64 2065 7870 6f73 6573   backend exposes
+0001f870: 2064 6966 6665 7265 6e74 2066 756e 6374   different funct
+0001f880: 696f 6e73 3a0a 0a20 2020 2031 2e20 466f  ions:..    1. Fo
+0001f890: 7220 6578 616d 706c 652c 2074 6f20 6372  r example, to cr
+0001f8a0: 6561 7465 206c 696e 6520 706c 6f74 7320  eate line plots 
+0001f8b0: 4d61 7470 6c6f 746c 6962 2065 7870 6f73  Matplotlib expos
+0001f8c0: 6573 2060 6061 782e 706c 6f74 6060 2c0a  es ``ax.plot``,.
+0001f8d0: 2020 2020 2020 2077 6865 7265 6173 2050         whereas P
+0001f8e0: 6c6f 746c 7920 6578 706f 7365 7320 6060  lotly exposes ``
+0001f8f0: 676f 2e53 6361 7474 6572 6060 2c20 7768  go.Scatter``, wh
+0001f900: 6572 6561 7320 426f 6b65 6820 6578 706f  ereas Bokeh expo
+0001f910: 7365 730a 2020 2020 2020 2060 6066 6967  ses.       ``fig
+0001f920: 2e6c 696e 6560 602c 2065 7463 2e20 4275  .line``, etc. Bu
+0001f930: 7420 7468 6f73 6520 6469 6666 6572 656e  t those differen
+0001f940: 7420 7761 7973 2064 6f20 6e6f 7420 6f76  t ways do not ov
+0001f950: 6572 6c61 7020 636f 6d70 6c65 7465 6c79  erlap completely
+0001f960: 3a0a 2020 2020 2020 2077 6974 6820 6060  :.       with ``
+0001f970: 676f 2e53 6361 7474 6572 6060 2069 7427  go.Scatter`` it'
+0001f980: 7320 616c 736f 2070 6f73 7369 626c 6520  s also possible 
+0001f990: 746f 2063 7265 6174 6520 6669 6c6c 6564  to create filled
+0001f9a0: 2072 6567 696f 6e73 2c0a 2020 2020 2020   regions,.      
+0001f9b0: 2077 6865 7265 6173 2077 6974 6820 6060   whereas with ``
+0001f9c0: 6178 2e70 6c6f 7460 6020 7468 6174 2773  ax.plot`` that's
+0001f9d0: 206e 6f74 2070 6f73 7369 626c 652e 0a20   not possible.. 
+0001f9e0: 2020 2032 2e20 4d6f 7265 6f76 6572 2c20     2. Moreover, 
+0001f9f0: 736f 6d65 2070 6c6f 7474 696e 6720 6c69  some plotting li
+0001fa00: 6272 6172 7920 6578 706f 7365 7320 6675  brary exposes fu
+0001fa10: 6e63 7469 6f6e 616c 6974 6965 7320 7468  nctionalities th
+0001fa20: 6174 2061 7265 0a20 2020 2020 2020 756e  at are.       un
+0001fa30: 6d61 7463 6865 6420 6279 206f 7468 6572  matched by other
+0001fa40: 732e 2046 6f72 2065 7861 6d70 6c65 2c20  s. For example, 
+0001fa50: 4d61 7470 6c6f 746c 6962 2773 2060 6061  Matplotlib's ``a
+0001fa60: 782e 6669 6c6c 5f62 6574 7765 656e 6060  x.fill_between``
+0001fa70: 2069 730a 2020 2020 2020 2073 7562 7374   is.       subst
+0001fa80: 616e 7469 616c 6c79 2064 6966 6665 7265  antially differe
+0001fa90: 6e74 2066 726f 6d20 506c 6f74 6c79 2773  nt from Plotly's
+0001faa0: 2066 696c 6c65 6420 6172 6561 206f 7220   filled area or 
+0001fab0: 7768 6174 6576 6572 2042 6f6b 6568 0a20  whatever Bokeh. 
+0001fac0: 2020 2020 2020 6578 706f 7365 732e 2053        exposes. S
+0001fad0: 696d 696c 6172 6c79 2c20 4d61 7470 6c6f  imilarly, Matplo
+0001fae0: 746c 6962 2773 2052 6563 7461 6e67 6c65  tlib's Rectangle
+0001faf0: 2069 7320 7665 7279 2073 7065 6369 6669   is very specifi
+0001fb00: 632c 2077 6865 7265 6173 0a20 2020 2020  c, whereas.     
+0001fb10: 2020 7769 7468 2050 6c6f 746c 7920 7765    with Plotly we
+0001fb20: 2063 616e 2061 6464 2061 6e79 2073 6861   can add any sha
+0001fb30: 7065 2028 7265 6374 616e 676c 652c 206c  pe (rectangle, l
+0001fb40: 696e 652c 202e 2e2e 2920 7769 7468 2074  ine, ...) with t
+0001fb50: 6865 2073 616d 650a 2020 2020 2020 2066  he same.       f
+0001fb60: 756e 6374 696f 6e20 6361 6c6c 2e0a 0a20  unction call... 
+0001fb70: 2020 2053 6f2c 2074 6865 2070 726f 626c     So, the probl
+0001fb80: 656d 2069 7320 636c 6561 723a 2069 6620  em is clear: if 
+0001fb90: 6465 7665 6c6f 7065 7273 2064 6f63 756d  developers docum
+0001fba0: 656e 7420 6120 6665 6174 7572 6520 746f  ent a feature to
+0001fbb0: 2064 6f20 6f6e 650a 2020 2020 7370 6563   do one.    spec
+0001fbc0: 6966 6963 2074 6869 6e67 2c20 7573 6572  ific thing, user
+0001fbd0: 7320 6578 7065 6374 2069 7420 746f 2070  s expect it to p
+0001fbe0: 726f 6475 6365 2063 6f6e 7369 7374 656e  roduce consisten
+0001fbf0: 7420 7265 7375 6c74 7320 6163 726f 7373  t results across
+0001fc00: 0a20 2020 2062 6163 6b65 6e64 732e 2054  .    backends. T
+0001fc10: 6869 7320 6973 2063 6c65 6172 6c79 2069  his is clearly i
+0001fc20: 6d70 6f73 7369 626c 6520 746f 2061 6368  mpossible to ach
+0001fc30: 6965 7665 2e0a 0a20 2020 2054 6865 7265  ieve...    There
+0001fc40: 2069 7320 616c 736f 2074 6865 2070 726f   is also the pro
+0001fc50: 626c 656d 206f 6620 7768 656e 2022 656e  blem of when "en
+0001fc60: 6f75 6768 2069 7320 656e 6f75 6768 223f  ough is enough"?
+0001fc70: 204d 6561 6e69 6e67 2c20 7768 6f20 6973   Meaning, who is
+0001fc80: 2074 6f0a 2020 2020 7374 6f70 2061 6e79   to.    stop any
+0001fc90: 6f6e 6520 6672 6f6d 2061 6464 696e 6720  one from adding 
+0001fca0: 6e65 7720 6b65 7977 6f72 6420 6172 6775  new keyword argu
+0001fcb0: 6d65 6e74 7320 7468 6174 2061 7265 206a  ments that are j
+0001fcc0: 7573 7420 7772 6170 7065 7273 2074 6f0a  ust wrappers to.
+0001fcd0: 2020 2020 7768 6174 2061 2070 6c6f 7474      what a plott
+0001fce0: 696e 6720 6c69 6272 6172 7920 616c 7265  ing library alre
+0001fcf0: 6164 7920 6361 6e20 646f 3f20 466f 7220  ady can do? For 
+0001fd00: 6578 616d 706c 652c 2049 2063 6f75 6c64  example, I could
+0001fd10: 2061 6464 2074 6865 0a20 2020 2060 6068   add the.    ``h
+0001fd20: 6578 5f74 696c 6560 6020 6b65 7977 6f72  ex_tile`` keywor
+0001fd30: 643a 2069 7427 7320 6265 6175 7469 6675  d: it's beautifu
+0001fd40: 6c20 666f 7220 426f 6b65 682c 2062 7574  l for Bokeh, but
+0001fd50: 2076 6572 7920 6469 6666 6963 756c 740a   very difficult.
+0001fd60: 2020 2020 746f 2069 6d70 6c65 6d65 6e74      to implement
+0001fd70: 206f 6e20 6f74 6865 7220 6261 636b 656e   on other backen
+0001fd80: 6473 2e20 4f72 206d 6179 6265 2049 2063  ds. Or maybe I c
+0001fd90: 6f75 6c64 2061 6464 2060 6068 6c69 6e65  ould add ``hline
+0001fda0: 7360 6020 6f72 0a20 2020 2060 6076 6c69  s`` or.    ``vli
+0001fdb0: 6e65 7360 6020 6b65 7977 6f72 6420 6172  nes`` keyword ar
+0001fdc0: 6775 6d65 6e74 7320 746f 2061 6464 2068  guments to add h
+0001fdd0: 6f72 697a 6f6e 7461 6c20 6f72 2076 6572  orizontal or ver
+0001fde0: 7469 6361 6c20 6c69 6e65 732e 2049 6620  tical lines. If 
+0001fdf0: 7468 6973 0a20 2020 2061 7070 726f 6163  this.    approac
+0001fe00: 6820 7761 7320 746f 2062 6520 666f 6c6c  h was to be foll
+0001fe10: 6f77 6564 2c20 7765 2077 696c 6c20 656e  owed, we will en
+0001fe20: 6420 7570 2072 6577 7269 7469 6e67 206d  d up rewriting m
+0001fe30: 756c 7469 706c 6520 706c 6f74 7469 6e67  ultiple plotting
+0001fe40: 0a20 2020 206c 6962 7261 7269 6573 3a20  .    libraries: 
+0001fe50: 666f 7220 7768 6174 3f0a 0a20 2020 2049  for what?..    I
+0001fe60: 6e73 7465 6164 2c20 7468 6520 676f 616c  nstead, the goal
+0001fe70: 206f 6620 7468 6973 206d 6f64 756c 6520   of this module 
+0001fe80: 6973 2074 6f20 6661 6369 6c69 7461 7465  is to facilitate
+0001fe90: 2074 6865 2070 6c6f 7474 696e 6720 6f66   the plotting of
+0001fea0: 2073 796d 626f 6c69 630a 2020 2020 6578   symbolic.    ex
+0001feb0: 7072 6573 7369 6f6e 732e 2049 6620 7573  pressions. If us
+0001fec0: 6572 206e 6565 6473 2074 6f20 6164 6420  er needs to add 
+0001fed0: 6e75 6d65 7269 6361 6c20 6461 7461 2074  numerical data t
+0001fee0: 6f20 6120 706c 6f74 2c20 6865 2f73 6865  o a plot, he/she
+0001fef0: 2063 616e 0a20 2020 2065 6173 696c 7920   can.    easily 
+0001ff00: 7265 7472 6965 7665 2074 6865 2066 6967  retrieve the fig
+0001ff10: 7572 6520 6f62 6a65 6374 2061 6e64 2070  ure object and p
+0001ff20: 726f 6365 6564 2077 6974 6820 7468 6520  roceed with the 
+0001ff30: 7573 7561 6c20 636f 6d6d 616e 6473 0a20  usual commands. 
+0001ff40: 2020 2061 7373 6f63 6961 7465 6420 746f     associated to
+0001ff50: 2061 2073 7065 6369 6669 6320 706c 6f74   a specific plot
+0001ff60: 7469 6e67 206c 6962 7261 7279 2e0a 2020  ting library..  
+0001ff70: 2020 466f 7220 6578 616d 706c 652c 2066    For example, f
+0001ff80: 6f72 2060 604d 6174 706c 6f74 6c69 6242  or ``MatplotlibB
+0001ff90: 6163 6b65 6e64 6060 3a0a 0a20 2020 202e  ackend``:..    .
+0001ffa0: 2e20 636f 6465 2d62 6c6f 636b 3a3a 2070  . code-block:: p
+0001ffb0: 7974 686f 6e0a 0a20 2020 2020 2020 6672  ython..       fr
+0001ffc0: 6f6d 2073 796d 7079 2069 6d70 6f72 7420  om sympy import 
+0001ffd0: 2a0a 2020 2020 2020 2066 726f 6d20 7370  *.       from sp
+0001ffe0: 6220 696d 706f 7274 202a 0a20 2020 2020  b import *.     
+0001fff0: 2020 696d 706f 7274 206e 756d 7079 2061    import numpy a
+00020000: 7320 6e70 0a20 2020 2020 2020 7661 7228  s np.       var(
+00020010: 2278 2229 0a0a 2020 2020 2020 2023 2070  "x")..       # p
+00020020: 6c6f 7420 7379 6d62 6f6c 6963 2065 7870  lot symbolic exp
+00020030: 7265 7373 696f 6e73 0a20 2020 2020 2020  ressions.       
+00020040: 7020 3d20 706c 6f74 2873 696e 2878 292c  p = plot(sin(x),
+00020050: 2063 6f73 2878 292c 2062 6163 6b65 6e64   cos(x), backend
+00020060: 3d4d 4229 0a20 2020 2020 2020 2320 6578  =MB).       # ex
+00020070: 7472 6163 7420 7468 6520 6178 6573 206f  tract the axes o
+00020080: 626a 6563 740a 2020 2020 2020 2061 7820  bject.       ax 
+00020090: 3d20 702e 6669 672e 6178 6573 5b30 5d0a  = p.fig.axes[0].
+000200a0: 2020 2020 2020 2023 2061 6464 206e 756d         # add num
+000200b0: 6572 6963 616c 2064 6174 610a 2020 2020  erical data.    
+000200c0: 2020 2078 7820 3d20 6e70 2e6c 696e 7370     xx = np.linsp
+000200d0: 6163 6528 2d31 302c 2031 3029 0a20 2020  ace(-10, 10).   
+000200e0: 2020 2020 6620 3d20 3120 2f20 2831 202b      f = 1 / (1 +
+000200f0: 206e 702e 6578 7028 2d78 7829 290a 2020   np.exp(-xx)).  
+00020100: 2020 2020 2061 782e 706c 6f74 2878 782c       ax.plot(xx,
+00020110: 2066 312c 2022 6b3a 222c 206c 6162 656c   f1, "k:", label
+00020120: 3d22 6e75 6d65 7269 6361 6c20 6461 7461  ="numerical data
+00020130: 2229 0a20 2020 2020 2020 6178 2e6c 6567  ").       ax.leg
+00020140: 656e 6428 290a 2020 2020 2020 2070 2e66  end().       p.f
+00020150: 6967 0a0a 2020 2020 4865 6e63 652c 2074  ig..    Hence, t
+00020160: 6865 2064 6563 6973 696f 6e20 746f 206d  he decision to m
+00020170: 6169 6e74 6169 6e20 7468 6973 2062 6163  aintain this bac
+00020180: 6b2d 636f 6d70 6174 6962 696c 6974 7920  k-compatibility 
+00020190: 2866 6f72 2074 6865 206d 6f6d 656e 7429  (for the moment)
+000201a0: 0a20 2020 2062 7574 206e 6f74 2074 6f20  .    but not to 
+000201b0: 646f 6375 6d65 6e74 2074 686f 7365 206b  document those k
+000201c0: 6579 776f 7264 2061 7267 756d 656e 7473  eyword arguments
+000201d0: 206f 6e20 7468 6520 706c 6f74 7469 6e67   on the plotting
+000201e0: 2066 756e 6374 696f 6e73 2e0a 2020 2020   functions..    
+000201f0: 2222 220a 2020 2020 6973 5f67 656e 6572  """.    is_gener
+00020200: 6963 203d 2054 7275 650a 0a20 2020 2064  ic = True..    d
+00020210: 6566 205f 5f69 6e69 745f 5f28 7365 6c66  ef __init__(self
+00020220: 2c20 7470 2c20 2a61 7267 732c 202a 2a6b  , tp, *args, **k
+00020230: 7761 7267 7329 3a0a 2020 2020 2020 2020  wargs):.        
+00020240: 7375 7065 7228 292e 5f5f 696e 6974 5f5f  super().__init__
+00020250: 282a 2a6b 7761 7267 7329 0a20 2020 2020  (**kwargs).     
+00020260: 2020 2073 656c 662e 7479 7065 203d 2074     self.type = t
+00020270: 700a 2020 2020 2020 2020 7365 6c66 2e61  p.        self.a
+00020280: 7267 7320 3d20 6172 6773 0a20 2020 2020  rgs = args.     
+00020290: 2020 2073 656c 662e 7265 6e64 6572 696e     self.renderin
+000202a0: 675f 6b77 203d 206b 7761 7267 730a 0a20  g_kw = kwargs.. 
+000202b0: 2020 2064 6566 2067 6574 5f64 6174 6128     def get_data(
+000202c0: 7365 6c66 293a 0a20 2020 2020 2020 2072  self):.        r
+000202d0: 6574 7572 6e20 7365 6c66 2e61 7267 730a  eturn self.args.
+000202e0: 0a0a 636c 6173 7320 5269 656d 616e 6e53  ..class RiemannS
+000202f0: 7068 6572 6553 6572 6965 7328 4261 7365  phereSeries(Base
+00020300: 5365 7269 6573 293a 0a20 2020 2069 735f  Series):.    is_
+00020310: 636f 6d70 6c65 7820 3d20 5472 7565 0a20  complex = True. 
+00020320: 2020 2069 735f 646f 6d61 696e 5f63 6f6c     is_domain_col
+00020330: 6f72 696e 6720 3d20 5472 7565 0a20 2020  oring = True.   
+00020340: 2069 735f 3344 7375 7266 6163 6520 3d20   is_3Dsurface = 
+00020350: 5472 7565 0a20 2020 205f 4e20 3d20 3135  True.    _N = 15
+00020360: 300a 2020 2020 5f61 6c6c 6f77 6564 5f6b  0.    _allowed_k
+00020370: 6579 7320 3d20 5b0a 2020 2020 2020 2020  eys = [.        
+00020380: 2263 6d61 7022 2c20 2263 6f6c 6f72 696e  "cmap", "colorin
+00020390: 6722 2c20 2262 6c65 7665 6c22 2c20 2270  g", "blevel", "p
+000203a0: 6861 7365 7265 7322 2c20 2270 6861 7365  haseres", "phase
+000203b0: 6f66 6673 6574 225d 0a0a 2020 2020 6465  offset"]..    de
+000203c0: 6620 5f5f 696e 6974 5f5f 2873 656c 662c  f __init__(self,
+000203d0: 2066 2c20 7261 6e67 655f 742c 2072 616e   f, range_t, ran
+000203e0: 6765 5f70 2c20 2a2a 6b77 6172 6773 293a  ge_p, **kwargs):
+000203f0: 0a20 2020 2020 2020 2073 656c 662e 5f62  .        self._b
+00020400: 6c6f 636b 5f6c 616d 6264 615f 6675 6e63  lock_lambda_func
+00020410: 7469 6f6e 7328 6629 0a20 2020 2020 2020  tions(f).       
+00020420: 2073 7570 6572 2829 2e5f 5f69 6e69 745f   super().__init_
+00020430: 5f28 2a2a 6b77 6172 6773 290a 2020 2020  _(**kwargs).    
+00020440: 2020 2020 6966 206c 656e 2866 2e66 7265      if len(f.fre
+00020450: 655f 7379 6d62 6f6c 7329 203e 2031 3a0a  e_symbols) > 1:.
+00020460: 2020 2020 2020 2020 2020 2020 2320 4e4f              # NO
+00020470: 5445 3a20 636f 6e73 6964 6572 696e 6720  TE: considering 
+00020480: 686f 7720 636f 6d70 7574 6174 696f 6e61  how computationa
+00020490: 6c6c 7920 6865 6176 7920 7468 6973 2073  lly heavy this s
+000204a0: 6572 6965 7320 6973 2c0a 2020 2020 2020  eries is,.      
+000204b0: 2020 2020 2020 2320 6974 2069 7320 7261        # it is ra
+000204c0: 7468 6572 2075 6e75 7365 6675 6c20 746f  ther unuseful to
+000204d0: 2061 6c6c 6f77 2069 6e74 6572 6163 7469   allow interacti
+000204e0: 7665 2d77 6964 6765 7473 2070 6c6f 742e  ve-widgets plot.
+000204f0: 0a20 2020 2020 2020 2020 2020 2072 6169  .            rai
+00020500: 7365 2056 616c 7565 4572 726f 7228 0a20  se ValueError(. 
+00020510: 2020 2020 2020 2020 2020 2020 2020 2022                 "
+00020520: 436f 6d70 6c65 7820 6675 6e63 7469 6f6e  Complex function
+00020530: 2063 616e 206f 6e6c 7920 6861 7665 206f   can only have o
+00020540: 6e65 2066 7265 6520 7379 6d62 6f6c 2e20  ne free symbol. 
+00020550: 220a 2020 2020 2020 2020 2020 2020 2020  ".              
+00020560: 2020 2252 6563 6569 7665 6420 6672 6565    "Received free
+00020570: 2073 796d 626f 6c73 3a20 2573 2220 2520   symbols: %s" % 
+00020580: 662e 6672 6565 5f73 796d 626f 6c73 290a  f.free_symbols).
+00020590: 2020 2020 2020 2020 7365 6c66 2e65 7870          self.exp
+000205a0: 7220 3d20 660a 2020 2020 2020 2020 2320  r = f.        # 
+000205b0: 4e4f 5445 3a20 7765 2063 616e 2065 6173  NOTE: we can eas
+000205c0: 696c 7920 6372 6561 7465 2061 2073 7068  ily create a sph
+000205d0: 6572 6520 7769 7468 2061 2073 696e 676c  ere with a singl
+000205e0: 6520 6461 7461 2073 6572 6965 732e 0a20  e data series.. 
+000205f0: 2020 2020 2020 2023 2048 6f77 6576 6572         # However
+00020600: 2c20 4b33 4442 6163 6b65 6e64 2069 7320  , K3DBackend is 
+00020610: 756e 6162 6c65 2074 6f20 7072 6f70 6572  unable to proper
+00020620: 6c79 2076 6973 7561 6c69 7a65 2069 742c  ly visualize it,
+00020630: 2061 6e64 2069 740a 2020 2020 2020 2020   and it.        
+00020640: 2320 776f 756c 6420 7265 7175 6972 6520  # would require 
+00020650: 6120 6665 7720 686f 7572 7320 6f66 2077  a few hours of w
+00020660: 6f72 6b20 746f 2061 7070 6c79 2074 6865  ork to apply the
+00020670: 206e 6563 6573 7361 7279 2065 6469 7473   necessary edits
+00020680: 2e0a 2020 2020 2020 2020 2320 496e 7374  ..        # Inst
+00020690: 6561 642c 2049 276d 2067 6f69 6e67 2074  ead, I'm going t
+000206a0: 6f20 6372 6561 7465 2074 776f 2073 7068  o create two sph
+000206b0: 6572 6520 6361 7073 2028 4e6f 7274 6865  ere caps (Northe
+000206c0: 6e20 616e 6420 536f 7574 6865 726e 0a20  n and Southern. 
+000206d0: 2020 2020 2020 2023 2068 656d 6973 7068         # hemisph
+000206e0: 6572 6573 2c20 7265 7370 6563 7469 7665  eres, respective
+000206f0: 6c79 292c 2068 656e 6365 2074 6865 206e  ly), hence the n
+00020700: 6565 6420 666f 7220 7261 6e67 6573 203a  eed for ranges :
+00020710: 440a 2020 2020 2020 2020 7365 6c66 2e72  D.        self.r
+00020720: 616e 6765 7320 3d20 5b72 616e 6765 5f74  anges = [range_t
+00020730: 2c20 7261 6e67 655f 705d 0a20 2020 2020  , range_p].     
+00020740: 2020 2043 6f6d 706c 6578 446f 6d61 696e     ComplexDomain
+00020750: 436f 6c6f 7269 6e67 5365 7269 6573 2e5f  ColoringSeries._
+00020760: 696e 6974 5f64 6f6d 6169 6e5f 636f 6c6f  init_domain_colo
+00020770: 7269 6e67 5f6b 7728 7365 6c66 2c20 2a2a  ring_kw(self, **
+00020780: 6b77 6172 6773 290a 2020 2020 2020 2020  kwargs).        
+00020790: 6966 2073 656c 662e 6e5b 305d 203d 3d20  if self.n[0] == 
+000207a0: 7365 6c66 2e6e 5b31 5d3a 0a20 2020 2020  self.n[1]:.     
+000207b0: 2020 2020 2020 2073 656c 662e 6e20 3d20         self.n = 
+000207c0: 5b73 656c 662e 6e5b 305d 2c20 3420 2a20  [self.n[0], 4 * 
+000207d0: 7365 6c66 2e6e 5b30 5d5d 0a20 2020 2020  self.n[0]].     
+000207e0: 2020 2073 656c 662e 7573 655f 636d 203d     self.use_cm =
+000207f0: 2054 7275 650a 0a20 2020 2064 6566 2067   True..    def g
+00020800: 6574 5f64 6174 6128 7365 6c66 293a 0a20  et_data(self):. 
+00020810: 2020 2020 2020 2022 2222 5265 7475 726e         """Return
+00020820: 2061 7272 6179 7320 6f66 2063 6f6f 7264   arrays of coord
+00020830: 696e 6174 6573 2066 6f72 2070 6c6f 7474  inates for plott
+00020840: 696e 672e 0a0a 2020 2020 2020 2020 5265  ing...        Re
+00020850: 7475 726e 730a 2020 2020 2020 2020 3d3d  turns.        ==
+00020860: 3d3d 3d3d 3d0a 0a20 2020 2020 2020 2078  =====..        x
+00020870: 2c20 792c 207a 203a 206e 702e 6e64 6172  , y, z : np.ndar
+00020880: 7261 7920 5b6e 3220 7820 6e31 5d0a 2020  ray [n2 x n1].  
+00020890: 2020 2020 2020 2020 2020 436f 6f72 6469            Coordi
+000208a0: 6e61 7465 7320 6f6e 2074 6865 2075 6e69  nates on the uni
+000208b0: 7420 7370 6865 7265 2e0a 0a20 2020 2020  t sphere...     
+000208c0: 2020 2061 7267 203a 206e 702e 6e64 6172     arg : np.ndar
+000208d0: 7261 7920 5b6e 3220 7820 6e31 5d0a 2020  ray [n2 x n1].  
+000208e0: 2020 2020 2020 2020 2020 4172 6775 6d65            Argume
+000208f0: 6e74 206f 6620 7468 6520 6675 6e63 7469  nt of the functi
+00020900: 6f6e 2e0a 0a20 2020 2020 2020 2069 6d67  on...        img
+00020910: 203a 206e 702e 6e64 6172 7261 7920 5b6e   : np.ndarray [n
+00020920: 3220 7820 6e31 2078 2033 5d0a 2020 2020  2 x n1 x 3].    
+00020930: 2020 2020 2020 2020 5247 4220 696d 6167          RGB imag
+00020940: 6520 7661 6c75 6573 2063 6f6d 7075 7465  e values compute
+00020950: 6420 6672 6f6d 2074 6865 2061 7267 756d  d from the argum
+00020960: 656e 7420 6f66 2074 6865 2066 756e 6374  ent of the funct
+00020970: 696f 6e2e 0a20 2020 2020 2020 2020 2020  ion..           
+00020980: 2030 203c 3d20 522c 2047 2c20 4220 3c3d   0 <= R, G, B <=
+00020990: 2032 3535 0a0a 2020 2020 2020 2020 636f   255..        co
+000209a0: 6c6f 7273 203a 206e 702e 6e64 6172 7261  lors : np.ndarra
+000209b0: 7920 5b32 3536 2078 2033 5d0a 2020 2020  y [256 x 3].    
+000209c0: 2020 2020 2020 2020 436f 6c6f 7220 7363          Color sc
+000209d0: 616c 6520 6173 736f 6369 6174 6564 2074  ale associated t
+000209e0: 6f20 6069 6d67 602e 0a20 2020 2020 2020  o `img`..       
+000209f0: 2022 2222 0a20 2020 2020 2020 206e 7020   """.        np 
+00020a00: 3d20 696d 706f 7274 5f6d 6f64 756c 6528  = import_module(
+00020a10: 276e 756d 7079 2729 0a0a 2020 2020 2020  'numpy')..      
+00020a20: 2020 2320 6469 7363 7265 7469 7a65 2074    # discretize t
+00020a30: 6865 2075 6e69 7420 7370 6865 7265 0a20  he unit sphere. 
+00020a40: 2020 2020 2020 2072 203d 2031 0a20 2020         r = 1.   
+00020a50: 2020 2020 2023 2054 4f44 4f3a 2074 6869       # TODO: thi
+00020a60: 7320 7061 7261 6d65 7465 7269 7a61 7469  s parameterizati
+00020a70: 6f6e 2070 6c61 6365 7320 6120 6c6f 7420  on places a lot 
+00020a80: 6f66 2070 6f69 6e74 7320 6e65 6172 2074  of points near t
+00020a90: 6865 2070 6f6c 6573 0a20 2020 2020 2020  he poles.       
+00020aa0: 2023 2062 7574 206e 6f74 2065 6e6f 7567   # but not enoug
+00020ab0: 6820 6e65 6172 2074 6865 2065 7175 6174  h near the equat
+00020ac0: 6f72 2e20 4361 6e20 6120 6469 6666 6572  or. Can a differ
+00020ad0: 656e 7420 7061 7261 6d65 7465 7269 7a61  ent parameteriza
+00020ae0: 7469 6f6e 0a20 2020 2020 2020 2023 2069  tion.        # i
+00020af0: 6d70 726f 7665 7320 7468 6520 6669 6e61  mproves the fina
+00020b00: 6c20 7265 7375 6c74 2c20 6d61 7962 6520  l result, maybe 
+00020b10: 6576 656e 2072 6564 7563 696e 6720 7468  even reducing th
+00020b20: 6520 636f 6d70 7574 6174 696f 6e61 6c0a  e computational.
+00020b30: 2020 2020 2020 2020 2320 636f 7374 3f0a          # cost?.
+00020b40: 2020 2020 2020 2020 7473 2c20 7465 203d          ts, te =
+00020b50: 205b 666c 6f61 7428 7429 2066 6f72 2074   [float(t) for t
+00020b60: 2069 6e20 7365 6c66 2e72 616e 6765 735b   in self.ranges[
+00020b70: 305d 5b31 3a5d 5d0a 2020 2020 2020 2020  0][1:]].        
+00020b80: 7073 2c20 7065 203d 205b 666c 6f61 7428  ps, pe = [float(
+00020b90: 7429 2066 6f72 2074 2069 6e20 7365 6c66  t) for t in self
+00020ba0: 2e72 616e 6765 735b 315d 5b31 3a5d 5d0a  .ranges[1][1:]].
+00020bb0: 2020 2020 2020 2020 742c 2070 203d 206e          t, p = n
+00020bc0: 702e 6d67 7269 645b 7473 3a74 653a 7365  p.mgrid[ts:te:se
+00020bd0: 6c66 2e6e 5b30 5d2a 316a 2c20 7073 3a70  lf.n[0]*1j, ps:p
+00020be0: 653a 7365 6c66 2e6e 5b31 5d2a 316a 5d0a  e:self.n[1]*1j].
+00020bf0: 2020 2020 2020 2020 5820 3d20 7220 2a20          X = r * 
+00020c00: 6e70 2e73 696e 2874 2920 2a20 6e70 2e63  np.sin(t) * np.c
+00020c10: 6f73 2870 290a 2020 2020 2020 2020 5920  os(p).        Y 
+00020c20: 3d20 7220 2a20 6e70 2e73 696e 2874 2920  = r * np.sin(t) 
+00020c30: 2a20 6e70 2e73 696e 2870 290a 2020 2020  * np.sin(p).    
+00020c40: 2020 2020 5a20 3d20 7220 2a20 6e70 2e63      Z = r * np.c
+00020c50: 6f73 2874 290a 2020 2020 2020 2020 2320  os(t).        # 
+00020c60: 7374 6572 656f 6772 6170 6869 6320 7072  stereographic pr
+00020c70: 6f6a 6563 7469 6f6e 0a20 2020 2020 2020  ojection.       
+00020c80: 2023 2054 4f44 4f3a 2073 7570 7072 6573   # TODO: suppres
+00020c90: 7320 7761 726e 696e 6773 0a20 2020 2020  s warnings.     
+00020ca0: 2020 2078 203d 2058 202f 2028 3120 2d20     x = X / (1 - 
+00020cb0: 5a29 0a20 2020 2020 2020 2079 203d 2059  Z).        y = Y
+00020cc0: 202f 2028 3120 2d20 5a29 0a20 2020 2020   / (1 - Z).     
+00020cd0: 2020 2023 2065 7661 6c75 6174 696f 6e20     # evaluation 
+00020ce0: 6f76 6572 2074 6865 2063 6f6d 706c 6578  over the complex
+00020cf0: 2070 6c61 6e65 0a20 2020 2020 2020 2023   plane.        #
+00020d00: 204e 4f54 453a 205f 756e 6966 6f72 6d5f   NOTE: _uniform_
+00020d10: 6576 616c 2073 686f 756c 6420 6265 2075  eval should be u
+00020d20: 7365 642c 2061 7320 6974 2069 7320 6162  sed, as it is ab
+00020d30: 6c65 2074 6f20 6465 616c 2077 6974 680a  le to deal with.
+00020d40: 2020 2020 2020 2020 2320 6469 6666 6572          # differ
+00020d50: 656e 7420 6576 616c 7561 7469 6f6e 206d  ent evaluation m
+00020d60: 6f64 756c 6573 2e20 486f 7765 7665 722c  odules. However,
+00020d70: 2074 6861 7420 6d65 7468 6f64 2069 7320   that method is 
+00020d80: 6d75 6368 2073 6c6f 7765 720a 2020 2020  much slower.    
+00020d90: 2020 2020 2320 7468 616e 2076 616e 696c      # than vanil
+00020da0: 6c61 2d4e 756d 7079 2077 6974 6820 7665  la-Numpy with ve
+00020db0: 6374 6f72 697a 6174 696f 6e2c 2065 7665  ctorization, eve
+00020dc0: 6e20 7768 656e 2075 7369 6e67 204e 756d  n when using Num
+00020dd0: 7079 2e0a 2020 2020 2020 2020 2320 546f  py..        # To
+00020de0: 2067 6574 2064 6563 656e 7420 7265 7375   get decent resu
+00020df0: 6c74 732c 2074 6865 2066 756e 6374 696f  lts, the functio
+00020e00: 6e20 6d75 7374 2062 6520 6576 616c 7561  n must be evalua
+00020e10: 7465 6420 6f6e 2061 2062 6967 0a20 2020  ted on a big.   
+00020e20: 2020 2020 2023 206e 756d 6265 7220 6f66       # number of
+00020e30: 2064 6973 6372 6574 697a 6174 696f 6e20   discretization 
+00020e40: 706f 696e 7473 2c20 7768 6963 6820 6175  points, which au
+00020e50: 746f 6d61 7469 6361 6c6c 7920 7072 6563  tomatically prec
+00020e60: 6c75 6465 730a 2020 2020 2020 2020 2320  ludes.        # 
+00020e70: 6d70 6d61 7468 206f 7220 7379 6d70 792e  mpmath or sympy.
+00020e80: 2048 656e 6365 2c20 6a75 7374 2075 7365   Hence, just use
+00020e90: 2062 6172 6520 626f 6e65 7320 4e75 6d70   bare bones Nump
+00020ea0: 792c 2065 7665 6e20 7468 6f75 6768 2074  y, even though t
+00020eb0: 6869 730a 2020 2020 2020 2020 2320 6d6f  his.        # mo
+00020ec0: 6475 6c65 206d 6967 6874 206e 6f74 2069  dule might not i
+00020ed0: 6d70 6c65 6d65 6e74 2061 6c6c 2074 6865  mplement all the
+00020ee0: 2069 6e74 6572 6573 7469 6e67 2066 756e   interesting fun
+00020ef0: 6374 696f 6e73 2e0a 2020 2020 2020 2020  ctions..        
+00020f00: 7a20 3d20 7820 2b20 316a 202a 2079 0a20  z = x + 1j * y. 
+00020f10: 2020 2020 2020 2066 203d 206c 616d 6264         f = lambd
+00020f20: 6966 7928 6c69 7374 2873 656c 662e 6578  ify(list(self.ex
+00020f30: 7072 2e66 7265 655f 7379 6d62 6f6c 7329  pr.free_symbols)
+00020f40: 5b30 5d2c 2073 656c 662e 6578 7072 290a  [0], self.expr).
+00020f50: 2020 2020 2020 2020 7720 3d20 6628 7a29          w = f(z)
+00020f60: 0a20 2020 2020 2020 2069 6d67 2c20 6373  .        img, cs
+00020f70: 203d 2077 6567 6572 7428 7365 6c66 2e63   = wegert(self.c
+00020f80: 6f6c 6f72 696e 672c 2077 2c20 7365 6c66  oloring, w, self
+00020f90: 2e70 6861 7365 7265 732c 2073 656c 662e  .phaseres, self.
+00020fa0: 636d 6170 290a 2020 2020 2020 2020 7265  cmap).        re
+00020fb0: 7475 726e 2073 656c 662e 5f61 7070 6c79  turn self._apply
+00020fc0: 5f74 7261 6e73 666f 726d 2858 2c20 592c  _transform(X, Y,
+00020fd0: 205a 2c20 6e70 2e61 6e67 6c65 2877 292c   Z, np.angle(w),
+00020fe0: 2069 6d67 2c20 6373 290a 0a0a 636c 6173   img, cs)...clas
+00020ff0: 7320 4856 4c69 6e65 5365 7269 6573 2842  s HVLineSeries(B
+00021000: 6173 6553 6572 6965 7329 3a0a 2020 2020  aseSeries):.    
+00021010: 2222 2252 6570 7265 7365 6e74 2061 6e20  """Represent an 
+00021020: 686f 7269 7a6f 6e74 616c 206f 7220 7665  horizontal or ve
+00021030: 7274 6963 616c 206c 696e 6520 7365 7269  rtical line seri
+00021040: 6573 2e0a 2020 2020 496e 204d 6174 706c  es..    In Matpl
+00021050: 6f74 6c69 622c 2074 6869 7320 7769 6c6c  otlib, this will
+00021060: 2062 6520 7265 6e64 6572 6564 2062 7920   be rendered by 
+00021070: 6178 686c 696e 6520 6f72 2061 7876 6c69  axhline or axvli
+00021080: 6e65 2e0a 2020 2020 2222 220a 2020 2020  ne..    """.    
+00021090: 6465 6620 5f5f 696e 6974 5f5f 2873 656c  def __init__(sel
+000210a0: 662c 2076 2c20 686f 7269 7a6f 6e74 616c  f, v, horizontal
+000210b0: 2c20 6c61 6265 6c3d 2222 2c20 2a2a 6b77  , label="", **kw
+000210c0: 6172 6773 293a 0a20 2020 2020 2020 2073  args):.        s
+000210d0: 7570 6572 2829 2e5f 5f69 6e69 745f 5f28  uper().__init__(
+000210e0: 2a2a 6b77 6172 6773 290a 2020 2020 2020  **kwargs).      
+000210f0: 2020 7365 6c66 2e5f 6578 7072 203d 2073    self._expr = s
+00021100: 796d 7069 6679 2876 290a 2020 2020 2020  ympify(v).      
+00021110: 2020 7365 6c66 2e69 735f 686f 7269 7a6f    self.is_horizo
+00021120: 6e74 616c 203d 2068 6f72 697a 6f6e 7461  ntal = horizonta
+00021130: 6c0a 2020 2020 2020 2020 7365 6c66 2e5f  l.        self._
+00021140: 6c61 6265 6c20 3d20 7374 7228 7365 6c66  label = str(self
+00021150: 2e65 7870 7229 2069 6620 6c61 6265 6c20  .expr) if label 
+00021160: 6973 204e 6f6e 6520 656c 7365 206c 6162  is None else lab
+00021170: 656c 0a20 2020 2020 2020 2073 656c 662e  el.        self.
+00021180: 5f6c 6174 6578 5f6c 6162 656c 203d 206c  _latex_label = l
+00021190: 6174 6578 2873 656c 662e 6578 7072 2920  atex(self.expr) 
+000211a0: 6966 206c 6162 656c 2069 7320 4e6f 6e65  if label is None
+000211b0: 2065 6c73 6520 6c61 6265 6c0a 0a20 2020   else label..   
+000211c0: 2064 6566 2067 6574 5f64 6174 6128 7365   def get_data(se
+000211d0: 6c66 293a 0a20 2020 2020 2020 206c 6f63  lf):.        loc
+000211e0: 6174 696f 6e20 3d20 7365 6c66 2e65 7870  ation = self.exp
+000211f0: 720a 2020 2020 2020 2020 6966 2073 656c  r.        if sel
+00021200: 662e 6973 5f69 6e74 6572 6163 7469 7665  f.is_interactive
+00021210: 3a0a 2020 2020 2020 2020 2020 2020 6c6f  :.            lo
+00021220: 6361 7469 6f6e 203d 2073 656c 662e 6578  cation = self.ex
+00021230: 7072 2e73 7562 7328 7365 6c66 2e70 6172  pr.subs(self.par
+00021240: 616d 7329 0a20 2020 2020 2020 2072 6574  ams).        ret
+00021250: 7572 6e20 666c 6f61 7428 6c6f 6361 7469  urn float(locati
+00021260: 6f6e 290a 0a20 2020 2064 6566 205f 5f73  on)..    def __s
+00021270: 7472 5f5f 2873 656c 6629 3a0a 2020 2020  tr__(self):.    
+00021280: 2020 2020 7072 6520 3d20 2268 6f72 697a      pre = "horiz
+00021290: 6f6e 7461 6c22 2069 6620 7365 6c66 2e69  ontal" if self.i
+000212a0: 735f 686f 7269 7a6f 6e74 616c 2065 6c73  s_horizontal els
+000212b0: 6520 2276 6572 7469 6361 6c22 0a20 2020  e "vertical".   
+000212c0: 2020 2020 2070 6f73 7420 3d20 2279 203d       post = "y =
+000212d0: 2022 2069 6620 7365 6c66 2e69 735f 686f   " if self.is_ho
+000212e0: 7269 7a6f 6e74 616c 2065 6c73 6520 2278  rizontal else "x
+000212f0: 203d 2022 0a20 2020 2020 2020 2072 6574   = ".        ret
+00021300: 7572 6e20 7365 6c66 2e5f 7374 725f 6865  urn self._str_he
+00021310: 6c70 6572 2870 7265 202b 2022 206c 696e  lper(pre + " lin
+00021320: 6520 6174 2022 202b 2070 6f73 7420 2b20  e at " + post + 
+00021330: 7374 7228 7365 6c66 2e65 7870 7229 290a  str(self.expr)).
+00021340: 0a0a 636c 6173 7320 4172 726f 7732 4453  ..class Arrow2DS
+00021350: 6572 6965 7328 4261 7365 5365 7269 6573  eries(BaseSeries
+00021360: 293a 0a20 2020 2022 2222 5265 7072 6573  ):.    """Repres
+00021370: 656e 7420 616e 2061 7272 6f77 2069 6e20  ent an arrow in 
+00021380: 6120 3244 2073 7061 6365 2e0a 2020 2020  a 2D space..    
+00021390: 2222 220a 0a20 2020 2069 735f 3244 7665  """..    is_2Dve
+000213a0: 6374 6f72 203d 2054 7275 650a 2020 2020  ctor = True.    
+000213b0: 5f61 6c6c 6f77 6564 5f6b 6579 7320 3d20  _allowed_keys = 
+000213c0: 5b22 6e6f 726d 616c 697a 6522 5d0a 0a20  ["normalize"].. 
+000213d0: 2020 2064 6566 205f 5f69 6e69 745f 5f28     def __init__(
+000213e0: 7365 6c66 2c20 7374 6172 742c 2064 6972  self, start, dir
+000213f0: 6563 7469 6f6e 2c20 6c61 6265 6c3d 2222  ection, label=""
+00021400: 2c20 2a2a 6b77 6172 6773 293a 0a20 2020  , **kwargs):.   
+00021410: 2020 2020 2073 7570 6572 2829 2e5f 5f69       super().__i
+00021420: 6e69 745f 5f28 2a2a 6b77 6172 6773 290a  nit__(**kwargs).
+00021430: 2020 2020 2020 2020 6e70 203d 2069 6d70          np = imp
+00021440: 6f72 745f 6d6f 6475 6c65 2827 6e75 6d70  ort_module('nump
+00021450: 7927 290a 2020 2020 2020 2020 6966 206c  y').        if l
+00021460: 656e 2873 7461 7274 2920 213d 206c 656e  en(start) != len
+00021470: 2864 6972 6563 7469 6f6e 293a 0a20 2020  (direction):.   
+00021480: 2020 2020 2020 2020 2072 6169 7365 2056           raise V
+00021490: 616c 7565 4572 726f 7228 0a20 2020 2020  alueError(.     
+000214a0: 2020 2020 2020 2020 2020 2022 6073 7461             "`sta
+000214b0: 7274 6020 616e 6420 6064 6972 6563 7469  rt` and `directi
+000214c0: 6f6e 6020 6d75 7374 2068 6176 6520 7468  on` must have th
+000214d0: 6520 7361 6d65 206e 756d 6265 7220 6f66  e same number of
+000214e0: 2065 6c65 6d65 6e74 732e 5c6e 220a 2020   elements.\n".  
+000214f0: 2020 2020 2020 2020 2020 2020 2020 6622                f"
+00021500: 5265 6365 6976 6564 3a20 6c65 6e28 7374  Received: len(st
+00021510: 6172 7429 203d 207b 6c65 6e28 7374 6172  art) = {len(star
+00021520: 7429 7d20 220a 2020 2020 2020 2020 2020  t)} ".          
+00021530: 2020 2020 2020 6622 616e 6420 6c65 6e28        f"and len(
+00021540: 6469 7265 6374 696f 6e29 203d 207b 6c65  direction) = {le
+00021550: 6e28 6469 7265 6374 696f 6e29 7d22 0a20  n(direction)}". 
+00021560: 2020 2020 2020 2020 2020 2029 0a20 2020             ).   
+00021570: 2020 2020 2073 656c 662e 5f62 6c6f 636b       self._block
+00021580: 5f6c 616d 6264 615f 6675 6e63 7469 6f6e  _lambda_function
+00021590: 7328 7374 6172 742c 2064 6972 6563 7469  s(start, directi
+000215a0: 6f6e 290a 2020 2020 2020 2020 6368 6563  on).        chec
+000215b0: 6b20 3d20 6c61 6d62 6461 206c 3a20 5b0a  k = lambda l: [.
+000215c0: 2020 2020 2020 2020 2020 2020 6973 696e              isin
+000215d0: 7374 616e 6365 2874 2c20 4578 7072 2920  stance(t, Expr) 
+000215e0: 616e 6420 286e 6f74 2074 2e69 735f 6e75  and (not t.is_nu
+000215f0: 6d62 6572 2920 666f 7220 7420 696e 206c  mber) for t in l
+00021600: 0a20 2020 2020 2020 205d 0a20 2020 2020  .        ].     
+00021610: 2020 2069 6620 616e 7928 6368 6563 6b28     if any(check(
+00021620: 7374 6172 7429 202b 2063 6865 636b 2864  start) + check(d
+00021630: 6972 6563 7469 6f6e 2929 206f 7220 7365  irection)) or se
+00021640: 6c66 2e70 6172 616d 733a 0a20 2020 2020  lf.params:.     
+00021650: 2020 2020 2020 2069 6620 6e6f 7420 7365         if not se
+00021660: 6c66 2e70 6172 616d 733a 0a20 2020 2020  lf.params:.     
+00021670: 2020 2020 2020 2020 2020 2072 6169 7365             raise
+00021680: 2056 616c 7565 4572 726f 7228 0a20 2020   ValueError(.   
+00021690: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000216a0: 2022 536f 6d65 206f 7220 616c 6c20 656c   "Some or all el
+000216b0: 656d 656e 7473 206f 6620 7468 6520 7072  ements of the pr
+000216c0: 6f76 6964 6564 2063 6f6f 7264 696e 6174  ovided coordinat
+000216d0: 6573 2022 0a20 2020 2020 2020 2020 2020  es ".           
+000216e0: 2020 2020 2020 2020 2022 6172 6520 7379           "are sy
+000216f0: 6d62 6f6c 6963 2065 7870 7265 7373 696f  mbolic expressio
+00021700: 6e73 2c20 6275 7420 7468 6520 6060 7061  ns, but the ``pa
+00021710: 7261 6d73 6060 2064 6963 7469 6f6e 6172  rams`` dictionar
+00021720: 7920 220a 2020 2020 2020 2020 2020 2020  y ".            
+00021730: 2020 2020 2020 2020 2277 6173 206e 6f74          "was not
+00021740: 2070 726f 7669 6465 643a 2074 686f 7365   provided: those
+00021750: 2065 6c65 6d65 6e74 7320 6361 6e27 7420   elements can't 
+00021760: 6265 2065 7661 6c75 6174 6564 2e22 0a20  be evaluated.". 
+00021770: 2020 2020 2020 2020 2020 2020 2020 2029                 )
+00021780: 0a20 2020 2020 2020 2020 2020 2073 656c  .            sel
+00021790: 662e 7374 6172 7420 3d20 5475 706c 6528  f.start = Tuple(
+000217a0: 2a73 7461 7274 290a 2020 2020 2020 2020  *start).        
+000217b0: 2020 2020 7365 6c66 2e64 6972 6563 7469      self.directi
+000217c0: 6f6e 203d 2054 7570 6c65 282a 6469 7265  on = Tuple(*dire
+000217d0: 6374 696f 6e29 0a20 2020 2020 2020 2065  ction).        e
+000217e0: 6c73 653a 0a20 2020 2020 2020 2020 2020  lse:.           
+000217f0: 2073 656c 662e 7374 6172 7420 3d20 6e70   self.start = np
+00021800: 2e61 7272 6179 2873 7461 7274 2c20 6474  .array(start, dt
+00021810: 7970 653d 6e70 2e66 6c6f 6174 3634 290a  ype=np.float64).
+00021820: 2020 2020 2020 2020 2020 2020 7365 6c66              self
+00021830: 2e64 6972 6563 7469 6f6e 203d 206e 702e  .direction = np.
+00021840: 6172 7261 7928 6469 7265 6374 696f 6e2c  array(direction,
+00021850: 2064 7479 7065 3d6e 702e 666c 6f61 7436   dtype=np.float6
+00021860: 3429 0a0a 2020 2020 2020 2020 7365 6c66  4)..        self
+00021870: 2e5f 6578 7072 203d 2028 7365 6c66 2e73  ._expr = (self.s
+00021880: 7461 7274 2c20 7365 6c66 2e64 6972 6563  tart, self.direc
+00021890: 7469 6f6e 290a 2020 2020 2020 2020 6966  tion).        if
+000218a0: 206e 6f74 2061 6e79 2869 7369 6e73 7461   not any(isinsta
+000218b0: 6e63 6528 742c 206e 702e 6e64 6172 7261  nce(t, np.ndarra
+000218c0: 7929 2066 6f72 2074 2069 6e20 5b73 656c  y) for t in [sel
+000218d0: 662e 7374 6172 742c 2073 656c 662e 6469  f.start, self.di
+000218e0: 7265 6374 696f 6e5d 293a 0a20 2020 2020  rection]):.     
+000218f0: 2020 2020 2020 2073 656c 662e 5f63 6865         self._che
+00021900: 636b 5f66 7328 290a 2020 2020 2020 2020  ck_fs().        
+00021910: 6966 206c 6162 656c 3a0a 2020 2020 2020  if label:.      
+00021920: 2020 2020 2020 7365 6c66 2e6c 6162 656c        self.label
+00021930: 203d 206c 6162 656c 0a20 2020 2020 2020   = label.       
+00021940: 2065 6c73 653a 0a20 2020 2020 2020 2020   else:.         
+00021950: 2020 2023 206c 6162 656c 3a20 2866 726f     # label: (fro
+00021960: 6d29 202d 3e20 2874 6f29 0a20 2020 2020  m) -> (to).     
+00021970: 2020 2020 2020 2073 656c 662e 5f6c 6162         self._lab
+00021980: 656c 203d 2028 0a20 2020 2020 2020 2020  el = (.         
+00021990: 2020 2020 2020 2022 287b 7d29 202d 3e20         "({}) -> 
+000219a0: 287b 7d29 222e 666f 726d 6174 280a 2020  ({})".format(.  
+000219b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000219c0: 2020 222c 2022 2e6a 6f69 6e28 5b73 7472    ", ".join([str
+000219d0: 2874 2920 666f 7220 7420 696e 2073 656c  (t) for t in sel
+000219e0: 662e 7374 6172 745d 292c 0a20 2020 2020  f.start]),.     
+000219f0: 2020 2020 2020 2020 2020 2020 2020 2022                 "
+00021a00: 2c20 222e 6a6f 696e 285b 7374 7228 7520  , ".join([str(u 
+00021a10: 2b20 7629 2066 6f72 2075 2c20 7620 696e  + v) for u, v in
+00021a20: 207a 6970 280a 2020 2020 2020 2020 2020   zip(.          
+00021a30: 2020 2020 2020 2020 2020 2020 2020 7365                se
+00021a40: 6c66 2e73 7461 7274 2c20 7365 6c66 2e64  lf.start, self.d
+00021a50: 6972 6563 7469 6f6e 295d 290a 2020 2020  irection)]).    
+00021a60: 2020 2020 2020 2020 2020 2020 290a 2020              ).  
+00021a70: 2020 2020 2020 2020 2020 290a 2020 2020            ).    
+00021a80: 2020 2020 2020 2020 7365 6c66 2e5f 6c61          self._la
+00021a90: 7465 785f 6c61 6265 6c20 3d20 280a 2020  tex_label = (.  
+00021aa0: 2020 2020 2020 2020 2020 2020 2020 7222                r"
+00021ab0: 5c6c 6566 7428 7b7d 5c72 6967 6874 2920  \left({}\right) 
+00021ac0: 5c72 6967 6874 6172 726f 7720 5c6c 6566  \rightarrow \lef
+00021ad0: 7428 7b7d 5c72 6967 6874 2922 2e66 6f72  t({}\right)".for
+00021ae0: 6d61 7428 0a20 2020 2020 2020 2020 2020  mat(.           
+00021af0: 2020 2020 2020 2020 2022 2c20 222e 6a6f           ", ".jo
+00021b00: 696e 285b 6c61 7465 7828 7429 2066 6f72  in([latex(t) for
+00021b10: 2074 2069 6e20 7365 6c66 2e73 7461 7274   t in self.start
+00021b20: 5d29 2c0a 2020 2020 2020 2020 2020 2020  ]),.            
+00021b30: 2020 2020 2020 2020 222c 2022 2e6a 6f69          ", ".joi
+00021b40: 6e28 5b6c 6174 6578 2875 202b 2076 2920  n([latex(u + v) 
+00021b50: 666f 7220 752c 2076 2069 6e20 7a69 7028  for u, v in zip(
+00021b60: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00021b70: 2020 2020 2020 2020 2073 656c 662e 7374           self.st
+00021b80: 6172 742c 2073 656c 662e 6469 7265 6374  art, self.direct
+00021b90: 696f 6e29 5d29 0a20 2020 2020 2020 2020  ion)]).         
+00021ba0: 2020 2020 2020 2029 0a20 2020 2020 2020         ).       
+00021bb0: 2020 2020 2029 0a20 2020 2020 2020 2073       ).        s
+00021bc0: 656c 662e 7573 655f 7175 6976 6572 5f73  elf.use_quiver_s
+00021bd0: 6f6c 6964 5f63 6f6c 6f72 203d 206e 6f74  olid_color = not
+00021be0: 2073 656c 662e 7573 655f 636d 0a20 2020   self.use_cm.   
+00021bf0: 2020 2020 2073 656c 662e 6e6f 726d 616c       self.normal
+00021c00: 697a 6520 3d20 6b77 6172 6773 2e67 6574  ize = kwargs.get
+00021c10: 2822 6e6f 726d 616c 697a 6522 2c20 4661  ("normalize", Fa
+00021c20: 6c73 6529 0a20 2020 2020 2020 2023 2054  lse).        # T
+00021c30: 4f44 4f3a 2044 6f20 4920 4e65 6564 2074  ODO: Do I Need t
+00021c40: 6869 733f 0a20 2020 2020 2020 2073 656c  his?.        sel
+00021c50: 662e 6973 5f73 7472 6561 6d6c 696e 6573  f.is_streamlines
+00021c60: 203d 206b 7761 7267 732e 6765 7428 2273   = kwargs.get("s
+00021c70: 7472 6561 6d6c 696e 6573 222c 2046 616c  treamlines", Fal
+00021c80: 7365 290a 0a20 2020 2064 6566 205f 5f73  se)..    def __s
+00021c90: 7472 5f5f 2873 656c 6629 3a0a 2020 2020  tr__(self):.    
+00021ca0: 2020 2020 7072 6520 3d20 2233 4420 2220      pre = "3D " 
+00021cb0: 6966 2073 656c 662e 6973 5f33 4420 656c  if self.is_3D el
+00021cc0: 7365 2022 3244 2022 0a20 2020 2020 2020  se "2D ".       
+00021cd0: 2073 7461 7274 203d 2074 7570 6c65 2873   start = tuple(s
+00021ce0: 656c 662e 7374 6172 7429 0a20 2020 2020  elf.start).     
+00021cf0: 2020 2065 6e64 203d 2074 7570 6c65 2873     end = tuple(s
+00021d00: 202b 2064 2066 6f72 2073 2c20 6420 696e   + d for s, d in
+00021d10: 207a 6970 2873 7461 7274 2c20 7365 6c66   zip(start, self
+00021d20: 2e64 6972 6563 7469 6f6e 2929 0a20 2020  .direction)).   
+00021d30: 2020 2020 2072 6574 7572 6e20 7365 6c66       return self
+00021d40: 2e5f 7374 725f 6865 6c70 6572 280a 2020  ._str_helper(.  
+00021d50: 2020 2020 2020 2020 2020 7072 6520 2b20            pre + 
+00021d60: 6622 6172 726f 7720 6672 6f6d 207b 7374  f"arrow from {st
+00021d70: 6172 747d 2074 6f20 7b65 6e64 7d22 0a20  art} to {end}". 
+00021d80: 2020 2020 2020 2029 0a0a 2020 2020 6465         )..    de
+00021d90: 6620 6765 745f 6c61 6265 6c28 7365 6c66  f get_label(self
+00021da0: 2c20 7573 655f 6c61 7465 783d 4661 6c73  , use_latex=Fals
+00021db0: 652c 2077 7261 7070 6572 3d22 2425 7324  e, wrapper="$%s$
+00021dc0: 2229 3a0a 2020 2020 2020 2020 2222 2252  "):.        """R
+00021dd0: 6574 7572 6e20 7468 6520 6c61 6265 6c20  eturn the label 
+00021de0: 746f 2062 6520 7573 6564 2074 6f20 6469  to be used to di
+00021df0: 7370 6c61 7920 7468 6520 6578 7072 6573  splay the expres
+00021e00: 7369 6f6e 2e0a 0a20 2020 2020 2020 2050  sion...        P
+00021e10: 6172 616d 6574 6572 730a 2020 2020 2020  arameters.      
+00021e20: 2020 3d3d 3d3d 3d3d 3d3d 3d3d 0a20 2020    ==========.   
+00021e30: 2020 2020 2075 7365 5f6c 6174 6578 203a       use_latex :
+00021e40: 2062 6f6f 6c0a 2020 2020 2020 2020 2020   bool.          
+00021e50: 2020 4966 2046 616c 7365 2c20 7468 6520    If False, the 
+00021e60: 7374 7269 6e67 2072 6570 7265 7365 6e74  string represent
+00021e70: 6174 696f 6e20 6f66 2074 6865 2065 7870  ation of the exp
+00021e80: 7265 7373 696f 6e20 6973 2072 6574 7572  ression is retur
+00021e90: 6e65 642e 0a20 2020 2020 2020 2020 2020  ned..           
+00021ea0: 2049 6620 5472 7565 2c20 7468 6520 6c61   If True, the la
+00021eb0: 7465 7820 7265 7072 6573 656e 7461 7469  tex representati
+00021ec0: 6f6e 2069 7320 7265 7475 726e 6564 2e0a  on is returned..
+00021ed0: 2020 2020 2020 2020 7772 6170 7065 7220          wrapper 
+00021ee0: 3a20 7374 720a 2020 2020 2020 2020 2020  : str.          
+00021ef0: 2020 5468 6520 6261 636b 656e 6420 6d69    The backend mi
+00021f00: 6768 7420 6e65 6564 2074 6865 206c 6174  ght need the lat
+00021f10: 6578 2072 6570 7265 7365 6e74 6174 696f  ex representatio
+00021f20: 6e20 746f 2062 6520 7772 6170 7065 6420  n to be wrapped 
+00021f30: 6279 0a20 2020 2020 2020 2020 2020 2073  by.            s
+00021f40: 6f6d 6520 6368 6172 6163 7465 7273 2e20  ome characters. 
+00021f50: 4465 6661 756c 7420 746f 2060 6022 2425  Default to ``"$%
+00021f60: 7324 2260 602e 0a0a 2020 2020 2020 2020  s$"``...        
+00021f70: 5265 7475 726e 730a 2020 2020 2020 2020  Returns.        
+00021f80: 3d3d 3d3d 3d3d 3d0a 2020 2020 2020 2020  =======.        
+00021f90: 6c61 6265 6c20 3a20 7374 720a 2020 2020  label : str.    
+00021fa0: 2020 2020 2222 220a 2020 2020 2020 2020      """.        
+00021fb0: 6966 2075 7365 5f6c 6174 6578 2069 7320  if use_latex is 
+00021fc0: 4661 6c73 653a 0a20 2020 2020 2020 2020  False:.         
+00021fd0: 2020 2072 6574 7572 6e20 7365 6c66 2e5f     return self._
+00021fe0: 6c61 6265 6c0a 2020 2020 2020 2020 7265  label.        re
+00021ff0: 7475 726e 2073 656c 662e 5f67 6574 5f77  turn self._get_w
+00022000: 7261 7070 6564 5f6c 6162 656c 2873 656c  rapped_label(sel
+00022010: 662e 5f6c 6174 6578 5f6c 6162 656c 2c20  f._latex_label, 
+00022020: 7772 6170 7065 7229 0a0a 2020 2020 6465  wrapper)..    de
+00022030: 6620 6765 745f 6461 7461 2873 656c 6629  f get_data(self)
+00022040: 3a0a 2020 2020 2020 2020 2222 2252 6574  :.        """Ret
+00022050: 7572 6e20 6172 7261 7973 206f 6620 636f  urn arrays of co
+00022060: 6f72 6469 6e61 7465 7320 666f 7220 706c  ordinates for pl
+00022070: 6f74 7469 6e67 2e0a 0a20 2020 2020 2020  otting...       
+00022080: 2052 6574 7572 6e73 0a20 2020 2020 2020   Returns.       
+00022090: 203d 3d3d 3d3d 3d3d 0a20 2020 2020 2020   =======.       
+000220a0: 2078 312c 2079 312c 207a 3120 5b6f 7074   x1, y1, z1 [opt
+000220b0: 696f 6e61 6c5d 203a 2066 6c6f 6174 0a20  ional] : float. 
+000220c0: 2020 2020 2020 2020 2020 2043 6f6f 7264             Coord
+000220d0: 696e 6174 6573 206f 6620 7468 6520 7374  inates of the st
+000220e0: 6172 7420 706f 7369 7469 6f6e 2e0a 2020  art position..  
+000220f0: 2020 2020 2020 7832 2c20 7932 2c20 7a32        x2, y2, z2
+00022100: 205b 6f70 7469 6f6e 616c 5d20 3a20 666c   [optional] : fl
+00022110: 6f61 740a 2020 2020 2020 2020 2020 2020  oat.            
+00022120: 436f 6f72 6469 6e61 7465 7320 6f66 2074  Coordinates of t
+00022130: 6865 2065 6e64 2070 6f73 6974 696f 6e2e  he end position.
+00022140: 0a20 2020 2020 2020 2022 2222 0a20 2020  .        """.   
+00022150: 2020 2020 206e 7020 3d20 696d 706f 7274       np = import
+00022160: 5f6d 6f64 756c 6528 276e 756d 7079 2729  _module('numpy')
+00022170: 0a20 2020 2020 2020 2073 7461 7274 2c20  .        start, 
+00022180: 6469 7265 6374 696f 6e20 3d20 7365 6c66  direction = self
+00022190: 2e73 7461 7274 2c20 7365 6c66 2e64 6972  .start, self.dir
+000221a0: 6563 7469 6f6e 0a0a 2020 2020 2020 2020  ection..        
+000221b0: 6966 206e 6f74 2073 656c 662e 6973 5f69  if not self.is_i
+000221c0: 6e74 6572 6163 7469 7665 3a0a 2020 2020  nteractive:.    
+000221d0: 2020 2020 2020 2020 7374 6172 742c 2064          start, d
+000221e0: 6972 6563 7469 6f6e 203d 205b 0a20 2020  irection = [.   
+000221f0: 2020 2020 2020 2020 2020 2020 206e 702e               np.
+00022200: 6172 7261 7928 742c 2064 7479 7065 3d66  array(t, dtype=f
+00022210: 6c6f 6174 2920 666f 7220 7420 696e 205b  loat) for t in [
+00022220: 7374 6172 742c 2064 6972 6563 7469 6f6e  start, direction
+00022230: 5d0a 2020 2020 2020 2020 2020 2020 5d0a  ].            ].
+00022240: 2020 2020 2020 2020 656c 7365 3a0a 2020          else:.  
+00022250: 2020 2020 2020 2020 2020 7374 6172 7420            start 
+00022260: 3d20 6e70 2e61 7272 6179 280a 2020 2020  = np.array(.    
+00022270: 2020 2020 2020 2020 2020 2020 5b74 2e65              [t.e
+00022280: 7661 6c66 2873 7562 733d 7365 6c66 2e70  valf(subs=self.p
+00022290: 6172 616d 7329 2066 6f72 2074 2069 6e20  arams) for t in 
+000222a0: 7374 6172 745d 2c20 6474 7970 653d 666c  start], dtype=fl
+000222b0: 6f61 7429 0a20 2020 2020 2020 2020 2020  oat).           
+000222c0: 2064 6972 6563 7469 6f6e 203d 206e 702e   direction = np.
+000222d0: 6172 7261 7928 0a20 2020 2020 2020 2020  array(.         
+000222e0: 2020 2020 2020 205b 742e 6576 616c 6628         [t.evalf(
+000222f0: 7375 6273 3d73 656c 662e 7061 7261 6d73  subs=self.params
+00022300: 2920 666f 7220 7420 696e 2064 6972 6563  ) for t in direc
+00022310: 7469 6f6e 5d2c 2064 7479 7065 3d66 6c6f  tion], dtype=flo
+00022320: 6174 290a 0a20 2020 2020 2020 2065 6e64  at)..        end
+00022330: 203d 2073 7461 7274 202b 2064 6972 6563   = start + direc
+00022340: 7469 6f6e 0a20 2020 2020 2020 2072 6574  tion.        ret
+00022350: 7572 6e20 7365 6c66 2e5f 6170 706c 795f  urn self._apply_
+00022360: 7472 616e 7366 6f72 6d28 2a73 7461 7274  transform(*start
+00022370: 2c20 2a65 6e64 290a 0a0a 636c 6173 7320  , *end)...class 
+00022380: 4172 726f 7733 4453 6572 6965 7328 4172  Arrow3DSeries(Ar
+00022390: 726f 7732 4453 6572 6965 7329 3a0a 2020  row2DSeries):.  
+000223a0: 2020 2222 2252 6570 7265 7365 6e74 2061    """Represent a
+000223b0: 6e20 6172 726f 7720 696e 2061 2033 4420  n arrow in a 3D 
+000223c0: 7370 6163 652e 0a20 2020 2022 2222 0a20  space..    """. 
+000223d0: 2020 2069 735f 3344 203d 2054 7275 650a     is_3D = True.
+000223e0: 2020 2020 6973 5f32 4476 6563 746f 7220      is_2Dvector 
+000223f0: 3d20 4661 6c73 650a 2020 2020 6973 5f33  = False.    is_3
+00022400: 4476 6563 746f 7220 3d20 5472 7565 0a0a  Dvector = True..
+00022410: 2020 2020 6465 6620 6765 745f 6461 7461      def get_data
+00022420: 2873 656c 6629 3a0a 2020 2020 2020 2020  (self):.        
+00022430: 2222 2252 6574 7572 6e20 6172 7261 7973  """Return arrays
+00022440: 206f 6620 636f 6f72 6469 6e61 7465 7320   of coordinates 
+00022450: 666f 7220 706c 6f74 7469 6e67 2e0a 0a20  for plotting... 
+00022460: 2020 2020 2020 2052 6574 7572 6e73 0a20         Returns. 
+00022470: 2020 2020 2020 203d 3d3d 3d3d 3d3d 0a20         =======. 
+00022480: 2020 2020 2020 2078 2c20 792c 207a 203a         x, y, z :
+00022490: 2066 6c6f 6174 0a20 2020 2020 2020 2020   float.         
+000224a0: 2020 2043 6f6f 7264 696e 6174 6573 206f     Coordinates o
+000224b0: 6620 7468 6520 7374 6172 7420 706f 7369  f the start posi
+000224c0: 7469 6f6e 2e0a 2020 2020 2020 2020 752c  tion..        u,
+000224d0: 2076 2c20 7720 3a20 666c 6f61 740a 2020   v, w : float.  
+000224e0: 2020 2020 2020 2020 2020 436f 6f72 6469            Coordi
+000224f0: 6e61 7465 7320 6f66 2074 6865 2065 6e64  nates of the end
+00022500: 2070 6f73 6974 696f 6e2e 0a20 2020 2020   position..     
+00022510: 2020 2022 2222 0a20 2020 2020 2020 2072     """.        r
+00022520: 6574 7572 6e20 7375 7065 7228 292e 6765  eturn super().ge
+00022530: 745f 6461 7461 2829 0a0a 0a63 6c61 7373  t_data()...class
+00022540: 2047 7269 6442 6173 653a 0a20 2020 2022   GridBase:.    "
+00022550: 2222 0a20 2020 202a 4772 6964 4c69 6e65  "".    *GridLine
+00022560: 5365 7269 6573 206d 6179 2063 6f76 6572  Series may cover
+00022570: 2074 6865 2065 6e74 6972 6520 7669 7369   the entire visi
+00022580: 626c 6520 6172 6561 2e20 4865 6e63 652c  ble area. Hence,
+00022590: 2074 6865 7920 6e65 6564 2074 6f0a 2020   they need to.  
+000225a0: 2020 6b6e 6f77 2074 6865 2061 7869 7320    know the axis 
+000225b0: 6c69 6d69 7473 2e0a 0a20 2020 2041 7869  limits...    Axi
+000225c0: 7320 6c69 6d69 7473 2063 616e 2062 653a  s limits can be:
+000225d0: 0a20 2020 2031 2e20 7072 6f76 6964 6564  .    1. provided
+000225e0: 2062 7920 7468 6520 7573 6572 2069 6e20   by the user in 
+000225f0: 7468 6520 706c 6f74 2066 756e 6374 696f  the plot functio
+00022600: 6e20 6361 6c6c 2e20 466f 7220 6578 616d  n call. For exam
+00022610: 706c 653a 0a20 2020 2020 2020 6060 706c  ple:.       ``pl
+00022620: 6f74 282e 2e2e 2c20 786c 696d 3d28 612c  ot(..., xlim=(a,
+00022630: 2062 292c 2079 6c69 6d3d 2863 2c20 6429   b), ylim=(c, d)
+00022640: 2960 600a 2020 2020 322e 2063 6f6d 7075  )``.    2. compu
+00022650: 7465 6420 6672 6f6d 2074 6865 2064 6174  ted from the dat
+00022660: 6120 7468 6174 2068 6173 2061 6c72 6561  a that has alrea
+00022670: 6479 2062 6520 706c 6f74 7465 642e 0a20  dy be plotted.. 
+00022680: 2020 2033 2e20 7072 6f76 6964 6564 2069     3. provided i
+00022690: 6e20 736f 6d65 2066 756e 6374 696f 6e20  n some function 
+000226a0: 6361 6c6c 2074 6861 7420 6765 6e65 7261  call that genera
+000226b0: 7465 7320 6461 7461 2073 6572 6965 732e  tes data series.
+000226c0: 2046 6f72 2065 7861 6d70 6c65 3a0a 2020   For example:.  
+000226d0: 2020 2020 2060 6067 7261 7068 6963 7328       ``graphics(
+000226e0: 7367 7269 6428 786c 696d 3d28 612c 2062  sgrid(xlim=(a, b
+000226f0: 292c 2079 6c69 6d3d 2863 2c20 6429 2929  ), ylim=(c, d)))
+00022700: 6060 0a0a 2020 2020 4569 7468 6572 2077  ``..    Either w
+00022710: 6179 2c20 7468 6520 6170 7072 6f70 7269  ay, the appropri
+00022720: 6174 6520 7265 6e64 6572 6572 2077 696c  ate renderer wil
+00022730: 6c3a 0a0a 2020 2020 312e 2066 6967 7572  l:..    1. figur
+00022740: 6520 6974 206f 7574 2074 6865 2061 7869  e it out the axi
+00022750: 7320 6c69 6d69 7473 2e0a 2020 2020 322e  s limits..    2.
+00022760: 204c 6574 2074 6865 2067 7269 6420 7365   Let the grid se
+00022770: 7269 6573 206b 6e6f 7773 2061 626f 7574  ries knows about
+00022780: 2074 6869 7320 6c69 6d69 7473 2062 7920   this limits by 
+00022790: 6361 6c6c 696e 670a 2020 2020 2020 2060  calling.       `
+000227a0: 6073 6572 6965 732e 7365 745f 6178 6973  `series.set_axis
+000227b0: 5f6c 696d 6974 7328 786c 696d 2c20 796c  _limits(xlim, yl
+000227c0: 696d 2960 602e 0a20 2020 2033 2e20 436f  im)``..    3. Co
+000227d0: 6d70 7574 6520 7468 6520 6e75 6d65 7269  mpute the numeri
+000227e0: 6361 6c20 6461 7461 2066 6f72 2074 6865  cal data for the
+000227f0: 2073 7065 6369 6669 6564 2067 7269 6420   specified grid 
+00022800: 7468 6174 2063 6f76 6572 2074 6865 0a20  that cover the. 
+00022810: 2020 2020 2020 7370 6563 6966 6965 6420        specified 
+00022820: 6172 6561 2c20 7769 7468 2060 6073 6572  area, with ``ser
+00022830: 6965 732e 6765 745f 6461 7461 2829 6060  ies.get_data()``
+00022840: 2e0a 0a20 2020 2022 2222 0a20 2020 2069  ...    """.    i
+00022850: 735f 6772 6964 203d 2054 7275 650a 0a20  s_grid = True.. 
+00022860: 2020 2064 6566 205f 5f69 6e69 745f 5f28     def __init__(
+00022870: 7365 6c66 2c20 2a61 7267 732c 202a 2a6b  self, *args, **k
+00022880: 7761 7267 7329 3a0a 2020 2020 2020 2020  wargs):.        
+00022890: 7375 7065 7228 292e 5f5f 696e 6974 5f5f  super().__init__
+000228a0: 282a 6172 6773 2c20 2a2a 6b77 6172 6773  (*args, **kwargs
+000228b0: 290a 2020 2020 2020 2020 7365 6c66 2e73  ).        self.s
+000228c0: 686f 775f 696e 5f6c 6567 656e 6420 3d20  how_in_legend = 
+000228d0: 6b77 6172 6773 2e67 6574 2822 7368 6f77  kwargs.get("show
+000228e0: 5f69 6e5f 6c65 6765 6e64 222c 2046 616c  _in_legend", Fal
+000228f0: 7365 290a 2020 2020 2020 2020 786c 696d  se).        xlim
+00022900: 203d 206b 7761 7267 732e 6765 7428 2278   = kwargs.get("x
+00022910: 6c69 6d22 2c20 4e6f 6e65 290a 2020 2020  lim", None).    
+00022920: 2020 2020 796c 696d 203d 206b 7761 7267      ylim = kwarg
+00022930: 732e 6765 7428 2279 6c69 6d22 2c20 4e6f  s.get("ylim", No
+00022940: 6e65 290a 2020 2020 2020 2020 2320 4a75  ne).        # Ju
+00022950: 7079 7465 7220 6c61 6220 2b20 2266 726f  pyter lab + "fro
+00022960: 6d20 7379 6d70 7920 696d 706f 7274 202a  m sympy import *
+00022970: 2220 636f 6e76 6572 7420 616c 6c20 6e75  " convert all nu
+00022980: 6d62 6572 7320 746f 0a20 2020 2020 2020  mbers to.       
+00022990: 2023 2073 796d 7079 2773 2074 7970 6573   # sympy's types
+000229a0: 2e20 5468 6520 616c 676f 7269 7468 6d20  . The algorithm 
+000229b0: 6578 7065 6374 6573 2074 6865 6d20 746f  expectes them to
+000229c0: 2062 6520 6066 6c6f 6174 602e 0a20 2020   be `float`..   
+000229d0: 2020 2020 2073 656c 662e 5f78 6c69 6d20       self._xlim 
+000229e0: 3d20 5b66 6c6f 6174 2874 2920 666f 7220  = [float(t) for 
+000229f0: 7420 696e 2078 6c69 6d5d 2069 6620 786c  t in xlim] if xl
+00022a00: 696d 2065 6c73 6520 4e6f 6e65 0a20 2020  im else None.   
+00022a10: 2020 2020 2073 656c 662e 5f79 6c69 6d20       self._ylim 
+00022a20: 3d20 5b66 6c6f 6174 2874 2920 666f 7220  = [float(t) for 
+00022a30: 7420 696e 2079 6c69 6d5d 2069 6620 796c  t in ylim] if yl
+00022a40: 696d 2065 6c73 6520 4e6f 6e65 0a0a 2020  im else None..  
+00022a50: 2020 6465 6620 7365 745f 6178 6973 5f6c    def set_axis_l
+00022a60: 696d 6974 7328 7365 6c66 2c20 786c 696d  imits(self, xlim
+00022a70: 2c20 796c 696d 293a 0a20 2020 2020 2020  , ylim):.       
+00022a80: 2073 656c 662e 5f78 6c69 6d20 3d20 786c   self._xlim = xl
+00022a90: 696d 0a20 2020 2020 2020 2073 656c 662e  im.        self.
+00022aa0: 5f79 6c69 6d20 3d20 796c 696d 0a0a 2020  _ylim = ylim..  
+00022ab0: 2020 4070 726f 7065 7274 790a 2020 2020    @property.    
+00022ac0: 6465 6620 786c 696d 2873 656c 6629 3a0a  def xlim(self):.
+00022ad0: 2020 2020 2020 2020 7265 7475 726e 2073          return s
+00022ae0: 656c 662e 5f78 6c69 6d0a 0a20 2020 2040  elf._xlim..    @
+00022af0: 7072 6f70 6572 7479 0a20 2020 2064 6566  property.    def
+00022b00: 2079 6c69 6d28 7365 6c66 293a 0a20 2020   ylim(self):.   
+00022b10: 2020 2020 2072 6574 7572 6e20 7365 6c66       return self
+00022b20: 2e5f 796c 696d 0a0a 0a63 6c61 7373 2053  ._ylim...class S
+00022b30: 4772 6964 4c69 6e65 5365 7269 6573 2847  GridLineSeries(G
+00022b40: 7269 6442 6173 652c 2042 6173 6553 6572  ridBase, BaseSer
+00022b50: 6965 7329 3a0a 2020 2020 2222 2252 6570  ies):.    """Rep
+00022b60: 7265 7365 6e74 2061 2067 7269 6420 6f66  resent a grid of
+00022b70: 2064 616d 7069 6e67 2072 6174 696f 206c   damping ratio l
+00022b80: 696e 6573 2061 6e64 206e 6174 7572 616c  ines and natural
+00022b90: 2066 7265 7175 656e 6379 206c 696e 6573   frequency lines
+00022ba0: 0a20 2020 206f 6e20 7468 6520 732d 706c  .    on the s-pl
+00022bb0: 616e 652e 2054 6869 7320 6461 7461 2073  ane. This data s
+00022bc0: 6572 6965 7320 696d 706c 656d 656e 7473  eries implements
+00022bd0: 2074 776f 206d 6f64 6573 206f 6620 6f70   two modes of op
+00022be0: 6572 6174 696f 6e3a 0a0a 2020 2020 312e  eration:..    1.
+00022bf0: 2055 7365 7220 6361 6e20 7072 6f76 6964   User can provid
+00022c00: 6520 7869 2c20 776e 2e0a 2020 2020 322e  e xi, wn..    2.
+00022c10: 2055 7365 7220 6361 6e20 7072 6f76 6964   User can provid
+00022c20: 6520 6475 6d6d 7920 7869 2c20 776e 2c20  e dummy xi, wn, 
+00022c30: 616e 6420 6120 6c69 7374 206f 6620 6173  and a list of as
+00022c40: 736f 6369 6174 6564 2052 6f6f 744c 6f63  sociated RootLoc
+00022c50: 7573 5365 7269 6573 2e0a 2020 2020 2020  usSeries..      
+00022c60: 2057 6865 6e20 6060 6765 745f 6461 7461   When ``get_data
+00022c70: 2829 6060 2077 696c 6c20 6265 2063 616c  ()`` will be cal
+00022c80: 6c65 642c 2069 7420 6669 7273 7420 6c6f  led, it first lo
+00022c90: 6f70 7320 6f76 6572 2074 6865 2061 7373  ops over the ass
+00022ca0: 6f63 6961 7465 640a 2020 2020 2020 2072  ociated.       r
+00022cb0: 6f6f 7420 6c6f 6375 7320 7365 7269 6573  oot locus series
+00022cc0: 2069 6e20 6f72 6465 7220 746f 2064 6574   in order to det
+00022cd0: 6572 6d69 6e65 2074 6865 2061 7869 7320  ermine the axis 
+00022ce0: 6c69 6d69 7473 206f 6620 7468 6520 7669  limits of the vi
+00022cf0: 7369 626c 650a 2020 2020 2020 2061 7265  sible.       are
+00022d00: 612e 2054 6865 6e2c 2069 7420 636f 6d70  a. Then, it comp
+00022d10: 7574 6573 206e 6577 2076 616c 7565 7320  utes new values 
+00022d20: 6f66 2078 692c 2077 6e20 696e 206f 7264  of xi, wn in ord
+00022d30: 6572 2074 6f20 6765 7420 6772 6964 206c  er to get grid l
+00022d40: 696e 6573 0a20 2020 2020 2020 2265 7665  ines.       "eve
+00022d50: 6e6c 7922 2064 6973 7472 6962 7574 6564  nly" distributed
+00022d60: 206f 6e20 7468 6520 6176 6169 6c61 626c   on the availabl
+00022d70: 6520 7370 6163 652e 0a20 2020 2022 2222  e space..    """
+00022d80: 0a0a 2020 2020 6465 6620 5f5f 696e 6974  ..    def __init
+00022d90: 5f5f 2873 656c 662c 2078 692c 2077 6e2c  __(self, xi, wn,
+00022da0: 2074 702c 2074 732c 2073 6572 6965 733d   tp, ts, series=
+00022db0: 5b5d 2c20 2a2a 6b77 6172 6773 293a 0a20  [], **kwargs):. 
+00022dc0: 2020 2020 2020 2073 7570 6572 2829 2e5f         super()._
+00022dd0: 5f69 6e69 745f 5f28 2a2a 6b77 6172 6773  _init__(**kwargs
+00022de0: 290a 2020 2020 2020 2020 7365 6c66 2e78  ).        self.x
+00022df0: 6920 3d20 7869 0a20 2020 2020 2020 2073  i = xi.        s
+00022e00: 656c 662e 776e 203d 2077 6e0a 2020 2020  elf.wn = wn.    
+00022e10: 2020 2020 7365 6c66 2e74 7020 3d20 7470      self.tp = tp
+00022e20: 0a20 2020 2020 2020 2073 656c 662e 7473  .        self.ts
+00022e30: 203d 2074 730a 2020 2020 2020 2020 2320   = ts.        # 
+00022e40: 7768 6574 6865 7220 636f 6d70 7574 6573  whether computes
+00022e50: 2078 692f 776e 2069 6e20 6f72 6465 7220   xi/wn in order 
+00022e60: 746f 2065 7665 6e6c 7920 6469 7374 7269  to evenly distri
+00022e70: 6275 7465 206c 696e 6573 206f 7665 720a  bute lines over.
+00022e80: 2020 2020 2020 2020 2320 7468 6520 6176          # the av
+00022e90: 6169 6c61 626c 6520 706c 6f74 2d61 7265  ailable plot-are
+00022ea0: 610a 2020 2020 2020 2020 7365 6c66 2e61  a.        self.a
+00022eb0: 7574 6f20 3d20 6b77 6172 6773 2e67 6574  uto = kwargs.get
+00022ec0: 2822 6175 746f 222c 2046 616c 7365 290a  ("auto", False).
+00022ed0: 2020 2020 2020 2020 7365 6c66 2e73 686f          self.sho
+00022ee0: 775f 636f 6e74 726f 6c5f 6178 6973 203d  w_control_axis =
+00022ef0: 206b 7761 7267 732e 6765 7428 2273 686f   kwargs.get("sho
+00022f00: 775f 636f 6e74 726f 6c5f 6178 6973 222c  w_control_axis",
+00022f10: 2046 616c 7365 290a 0a20 2020 2064 6566   False)..    def
+00022f20: 205f 5f73 7472 5f5f 2873 656c 6629 3a0a   __str__(self):.
+00022f30: 2020 2020 2020 2020 7265 7475 726e 2022          return "
+00022f40: 732d 6772 6964 220a 0a20 2020 2064 6566  s-grid"..    def
+00022f50: 205f 7367 7269 645f 6465 6661 756c 745f   _sgrid_default_
+00022f60: 7869 2873 656c 662c 2078 6c69 6d2c 2079  xi(self, xlim, y
+00022f70: 6c69 6d29 3a0a 2020 2020 2020 2020 2222  lim):.        ""
+00022f80: 2252 6574 7572 6e20 6465 6661 756c 7420  "Return default 
+00022f90: 6c69 7374 206f 6620 6461 6d70 696e 6720  list of damping 
+00022fa0: 636f 6566 6669 6369 656e 7473 0a0a 2020  coefficients..  
+00022fb0: 2020 2020 2020 5468 6973 2066 756e 6374        This funct
+00022fc0: 696f 6e20 636f 6d70 7574 6573 2061 206c  ion computes a l
+00022fd0: 6973 7420 6f66 2064 616d 7069 6e67 2063  ist of damping c
+00022fe0: 6f65 6666 6963 6965 6e74 7320 6261 7365  oefficients base
+00022ff0: 6420 6f6e 2074 6865 206c 696d 6974 730a  d on the limits.
+00023000: 2020 2020 2020 2020 6f66 2074 6865 2067          of the g
+00023010: 7261 7068 2e20 2041 2073 6574 206f 6620  raph.  A set of 
+00023020: 3420 6461 6d70 696e 6720 636f 6566 6669  4 damping coeffi
+00023030: 6369 656e 7473 2061 7265 2063 6f6d 7075  cients are compu
+00023040: 7465 6420 666f 7220 7468 6520 782d 6178  ted for the x-ax
+00023050: 6973 0a20 2020 2020 2020 2061 6e64 2061  is.        and a
+00023060: 2073 6574 206f 6620 7468 7265 6520 6461   set of three da
+00023070: 6d70 696e 6720 636f 6566 6669 6369 656e  mping coefficien
+00023080: 7473 2061 7265 2063 6f6d 7075 7465 6420  ts are computed 
+00023090: 666f 7220 7468 6520 792d 6178 6973 0a20  for the y-axis. 
+000230a0: 2020 2020 2020 2028 636f 7272 6573 706f         (correspo
+000230b0: 6e64 696e 6720 746f 2074 6865 206e 6f72  nding to the nor
+000230c0: 6d61 6c20 343a 3320 706c 6f74 2061 7370  mal 4:3 plot asp
+000230d0: 6563 7420 7261 7469 6f20 696e 2060 6d61  ect ratio in `ma
+000230e0: 7470 6c6f 746c 6962 603f 292e 0a0a 2020  tplotlib`?)...  
+000230f0: 2020 2020 2020 5061 7261 6d65 7465 7273        Parameters
+00023100: 0a20 2020 2020 2020 202d 2d2d 2d2d 2d2d  .        -------
+00023110: 2d2d 2d0a 2020 2020 2020 2020 786c 696d  ---.        xlim
+00023120: 203a 2061 7272 6179 5f6c 696b 650a 2020   : array_like.  
+00023130: 2020 2020 2020 2020 2020 4c69 7374 206f            List o
+00023140: 6620 782d 6178 6973 206c 696d 6974 7320  f x-axis limits 
+00023150: 5b6d 696e 2c20 6d61 785d 0a20 2020 2020  [min, max].     
+00023160: 2020 2079 6c69 6d20 3a20 6172 7261 795f     ylim : array_
+00023170: 6c69 6b65 0a20 2020 2020 2020 2020 2020  like.           
+00023180: 204c 6973 7420 6f66 2079 2d61 7869 7320   List of y-axis 
+00023190: 6c69 6d69 7473 205b 6d69 6e2c 206d 6178  limits [min, max
+000231a0: 5d0a 0a20 2020 2020 2020 2052 6574 7572  ]..        Retur
+000231b0: 6e73 0a20 2020 2020 2020 202d 2d2d 2d2d  ns.        -----
+000231c0: 2d2d 0a20 2020 2020 2020 207a 6574 6120  --.        zeta 
+000231d0: 3a20 6c69 7374 0a20 2020 2020 2020 2020  : list.         
+000231e0: 2020 204c 6973 7420 6f66 2064 6566 6175     List of defau
+000231f0: 6c74 2064 616d 7069 6e67 2063 6f65 6666  lt damping coeff
+00023200: 6963 6965 6e74 7320 666f 7220 7468 6520  icients for the 
+00023210: 706c 6f74 0a0a 2020 2020 2020 2020 2222  plot..        ""
+00023220: 220a 2020 2020 2020 2020 6e70 203d 2069  ".        np = i
+00023230: 6d70 6f72 745f 6d6f 6475 6c65 2822 6e75  mport_module("nu
+00023240: 6d70 7922 290a 0a20 2020 2020 2020 2078  mpy")..        x
+00023250: 5f6c 6f77 6572 5f6c 696d 203d 2078 6c69  _lower_lim = xli
+00023260: 6d5b 305d 2069 6620 786c 696d 2065 6c73  m[0] if xlim els
+00023270: 6520 2d31 300a 2020 2020 2020 2020 795f  e -10.        y_
+00023280: 7570 7065 725f 6c69 6d20 3d20 796c 696d  upper_lim = ylim
+00023290: 5b31 5d20 6966 2079 6c69 6d20 656c 7365  [1] if ylim else
+000232a0: 2031 300a 0a20 2020 2020 2020 2023 2044   10..        # D
+000232b0: 616d 7069 6e67 2063 6f65 6666 6963 6965  amping coefficie
+000232c0: 6e74 206c 696e 6573 2074 6861 7420 696e  nt lines that in
+000232d0: 7465 7273 6563 7420 7468 6520 782d 6178  tersect the x-ax
+000232e0: 6973 0a20 2020 2020 2020 2073 6570 3120  is.        sep1 
+000232f0: 3d20 2d78 5f6c 6f77 6572 5f6c 696d 202f  = -x_lower_lim /
+00023300: 2034 0a20 2020 2020 2020 2061 6e67 3120   4.        ang1 
+00023310: 3d20 5b6e 702e 6172 6374 616e 2828 7365  = [np.arctan((se
+00023320: 7031 2a69 292f 795f 7570 7065 725f 6c69  p1*i)/y_upper_li
+00023330: 6d29 2066 6f72 2069 2069 6e20 6e70 2e61  m) for i in np.a
+00023340: 7261 6e67 6528 312c 2034 2c20 3129 5d0a  range(1, 4, 1)].
+00023350: 0a20 2020 2020 2020 2023 2044 616d 7069  .        # Dampi
+00023360: 6e67 2063 6f65 6666 6963 6965 6e74 206c  ng coefficient l
+00023370: 696e 6573 2074 6861 7420 696e 7465 7273  ines that inters
+00023380: 6563 7469 6f6e 2074 6865 2079 2d61 7869  ection the y-axi
+00023390: 730a 2020 2020 2020 2020 7365 7032 203d  s.        sep2 =
+000233a0: 2079 5f75 7070 6572 5f6c 696d 202f 2033   y_upper_lim / 3
+000233b0: 0a20 2020 2020 2020 2061 6e67 3220 3d20  .        ang2 = 
+000233c0: 5b0a 2020 2020 2020 2020 2020 2020 6e70  [.            np
+000233d0: 2e61 7263 7461 6e28 2d78 5f6c 6f77 6572  .arctan(-x_lower
+000233e0: 5f6c 696d 2f28 795f 7570 7065 725f 6c69  _lim/(y_upper_li
+000233f0: 6d2d 7365 7032 2a69 2929 0a20 2020 2020  m-sep2*i)).     
+00023400: 2020 2020 2020 2066 6f72 2069 2069 6e20         for i in 
+00023410: 6e70 2e61 7261 6e67 6528 312c 2033 2c20  np.arange(1, 3, 
+00023420: 3129 0a20 2020 2020 2020 205d 0a0a 2020  1).        ]..  
+00023430: 2020 2020 2020 2320 5075 7420 7468 6520        # Put the 
+00023440: 6c69 6e65 7320 746f 6765 7468 6572 2061  lines together a
+00023450: 6e64 2061 6464 206f 6e65 2061 7420 2d70  nd add one at -p
+00023460: 692f 3220 286e 6567 6174 6976 6520 7265  i/2 (negative re
+00023470: 616c 2061 7869 7329 0a20 2020 2020 2020  al axis).       
+00023480: 2061 6e67 6c65 7320 3d20 6e70 2e63 6f6e   angles = np.con
+00023490: 6361 7465 6e61 7465 2828 616e 6731 2c20  catenate((ang1, 
+000234a0: 616e 6732 2929 0a0a 2020 2020 2020 2020  ang2))..        
+000234b0: 2320 5265 7475 726e 2074 6865 2064 616d  # Return the dam
+000234c0: 7069 6e67 2063 6f65 6666 6963 6965 6e74  ping coefficient
+000234d0: 7320 636f 7272 6573 706f 6e64 696e 6720  s corresponding 
+000234e0: 746f 2074 6865 7365 2061 6e67 6c65 730a  to these angles.
+000234f0: 2020 2020 2020 2020 7a65 7461 203d 206e          zeta = n
+00023500: 702e 7369 6e28 616e 676c 6573 292e 746f  p.sin(angles).to
+00023510: 6c69 7374 2829 0a20 2020 2020 2020 2069  list().        i
+00023520: 6620 6e6f 7420 7365 6c66 2e73 686f 775f  f not self.show_
+00023530: 636f 6e74 726f 6c5f 6178 6973 3a0a 2020  control_axis:.  
+00023540: 2020 2020 2020 2020 2020 7a65 7461 202b            zeta +
+00023550: 3d20 5b30 2c20 315d 0a20 2020 2020 2020  = [0, 1].       
+00023560: 2072 6574 7572 6e20 7a65 7461 0a0a 2020   return zeta..  
+00023570: 2020 6465 6620 5f73 6772 6964 5f64 6566    def _sgrid_def
+00023580: 6175 6c74 5f77 6e28 7365 6c66 2c20 786c  ault_wn(self, xl
+00023590: 696d 2c20 796c 696d 2c20 6d61 785f 6c69  im, ylim, max_li
+000235a0: 6e65 733d 3729 3a0a 2020 2020 2020 2020  nes=7):.        
+000235b0: 2222 2252 6574 7572 6e20 6465 6661 756c  """Return defaul
+000235c0: 7420 776e 2066 6f72 2072 6f6f 7420 6c6f  t wn for root lo
+000235d0: 6375 7320 706c 6f74 0a0a 2020 2020 2020  cus plot..      
+000235e0: 2020 5468 6973 2066 756e 6374 696f 6e20    This function 
+000235f0: 636f 6d70 7574 6573 2061 206c 6973 7420  computes a list 
+00023600: 6f66 206e 6174 7572 616c 2066 7265 7175  of natural frequ
+00023610: 656e 6369 6573 2062 6173 6564 206f 6e20  encies based on 
+00023620: 7468 6520 6772 6964 0a20 2020 2020 2020  the grid.       
+00023630: 2070 6172 616d 6574 6572 7320 6f66 2074   parameters of t
+00023640: 6865 2067 7261 7068 2e0a 0a20 2020 2020  he graph...     
+00023650: 2020 2050 6172 616d 6574 6572 730a 2020     Parameters.  
+00023660: 2020 2020 2020 2d2d 2d2d 2d2d 2d2d 2d2d        ----------
+00023670: 0a20 2020 2020 2020 2078 6c6f 6320 3a20  .        xloc : 
+00023680: 6172 7261 795f 6c69 6b65 0a20 2020 2020  array_like.     
+00023690: 2020 2020 2020 204c 6973 7420 6f66 2078         List of x
+000236a0: 2d61 7869 7320 7469 636b 2076 616c 7565  -axis tick value
+000236b0: 730a 2020 2020 2020 2020 796c 696d 203a  s.        ylim :
+000236c0: 2061 7272 6179 5f6c 696b 650a 2020 2020   array_like.    
+000236d0: 2020 2020 2020 2020 4c69 7374 206f 6620          List of 
+000236e0: 792d 6178 6973 206c 696d 6974 7320 5b6d  y-axis limits [m
+000236f0: 696e 2c20 6d61 785d 0a20 2020 2020 2020  in, max].       
+00023700: 206d 6178 5f6c 696e 6573 203a 2069 6e74   max_lines : int
+00023710: 2c20 6f70 7469 6f6e 616c 0a20 2020 2020  , optional.     
+00023720: 2020 2020 2020 204d 6178 696d 756d 206e         Maximum n
+00023730: 756d 6265 7220 6f66 2066 7265 7175 656e  umber of frequen
+00023740: 6369 6573 2074 6f20 6765 6e65 7261 7465  cies to generate
+00023750: 2028 6465 6661 756c 7420 3d20 3729 0a0a   (default = 7)..
+00023760: 2020 2020 2020 2020 5265 7475 726e 730a          Returns.
+00023770: 2020 2020 2020 2020 2d2d 2d2d 2d2d 2d0a          -------.
+00023780: 2020 2020 2020 2020 776e 203a 206c 6973          wn : lis
+00023790: 740a 2020 2020 2020 2020 2020 2020 4c69  t.            Li
+000237a0: 7374 206f 6620 6465 6661 756c 7420 6e61  st of default na
+000237b0: 7475 7261 6c20 6672 6571 7565 6e63 6965  tural frequencie
+000237c0: 7320 666f 7220 7468 6520 706c 6f74 0a0a  s for the plot..
+000237d0: 2020 2020 2020 2020 2222 220a 2020 2020          """.    
+000237e0: 2020 2020 6c6f 7765 725f 6c69 6d20 3d20      lower_lim = 
+000237f0: 786c 696d 5b30 5d20 6966 2078 6c69 6d20  xlim[0] if xlim 
+00023800: 656c 7365 202d 3130 0a20 2020 2020 2020  else -10.       
+00023810: 206e 7020 3d20 696d 706f 7274 5f6d 6f64   np = import_mod
+00023820: 756c 6528 226e 756d 7079 2229 0a20 2020  ule("numpy").   
+00023830: 2020 2020 2061 7661 696c 6162 6c65 5f77       available_w
+00023840: 6964 7468 203d 2030 202d 206c 6f77 6572  idth = 0 - lower
+00023850: 5f6c 696d 0a20 2020 2020 2020 2077 6e20  _lim.        wn 
+00023860: 3d20 6e70 2e6c 696e 7370 6163 6528 302c  = np.linspace(0,
+00023870: 2061 6273 286c 6f77 6572 5f6c 696d 292c   abs(lower_lim),
+00023880: 206d 6178 5f6c 696e 6573 295b 313a 2d31   max_lines)[1:-1
+00023890: 5d0a 2020 2020 2020 2020 7265 7475 726e  ].        return
+000238a0: 2077 6e0a 0a20 2020 2064 6566 2067 6574   wn..    def get
+000238b0: 5f64 6174 6128 7365 6c66 293a 0a20 2020  _data(self):.   
+000238c0: 2020 2020 2022 2222 0a20 2020 2020 2020       """.       
+000238d0: 2052 6574 7572 6e73 0a20 2020 2020 2020   Returns.       
+000238e0: 203d 3d3d 3d3d 3d3d 0a20 2020 2020 2020   =======.       
+000238f0: 2078 695f 6469 6374 203a 2064 6963 740a   xi_dict : dict.
+00023900: 2020 2020 2020 2020 776e 5f64 6963 7420          wn_dict 
+00023910: 3a20 6469 6374 0a20 2020 2020 2020 2079  : dict.        y
+00023920: 5f74 7020 3a20 6e70 2e6e 6461 7272 6179  _tp : np.ndarray
+00023930: 0a20 2020 2020 2020 2078 5f74 7320 3a20  .        x_ts : 
+00023940: 6e70 2e6e 6461 7272 6179 0a20 2020 2020  np.ndarray.     
+00023950: 2020 2022 2222 0a20 2020 2020 2020 206e     """.        n
+00023960: 7020 3d20 696d 706f 7274 5f6d 6f64 756c  p = import_modul
+00023970: 6528 226e 756d 7079 2229 0a0a 2020 2020  e("numpy")..    
+00023980: 2020 2020 6966 2073 656c 662e 6175 746f      if self.auto
+00023990: 3a0a 2020 2020 2020 2020 2020 2020 7869  :.            xi
+000239a0: 203d 2073 656c 662e 5f73 6772 6964 5f64   = self._sgrid_d
+000239b0: 6566 6175 6c74 5f78 6928 7365 6c66 2e78  efault_xi(self.x
+000239c0: 6c69 6d2c 2073 656c 662e 796c 696d 290a  lim, self.ylim).
+000239d0: 2020 2020 2020 2020 2020 2020 776e 203d              wn =
+000239e0: 2073 656c 662e 5f73 6772 6964 5f64 6566   self._sgrid_def
+000239f0: 6175 6c74 5f77 6e28 7365 6c66 2e78 6c69  ault_wn(self.xli
+00023a00: 6d2c 2073 656c 662e 796c 696d 290a 2020  m, self.ylim).  
+00023a10: 2020 2020 2020 656c 7365 3a0a 2020 2020        else:.    
+00023a20: 2020 2020 2020 2020 7869 203d 206e 702e          xi = np.
+00023a30: 6172 7261 7928 5b0a 2020 2020 2020 2020  array([.        
+00023a40: 2020 2020 2020 2020 742e 6576 616c 6628          t.evalf(
+00023a50: 7375 6273 3d73 656c 662e 7061 7261 6d73  subs=self.params
+00023a60: 2920 6966 2069 7369 6e73 7461 6e63 6528  ) if isinstance(
+00023a70: 742c 2045 7870 7229 2065 6c73 6520 740a  t, Expr) else t.
+00023a80: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00023a90: 666f 7220 7420 696e 2073 656c 662e 7869  for t in self.xi
+00023aa0: 5d2c 2064 7479 7065 3d66 6c6f 6174 290a  ], dtype=float).
+00023ab0: 2020 2020 2020 2020 2020 2020 6966 2061              if a
+00023ac0: 6e79 2878 6920 3e20 3129 206f 7220 616e  ny(xi > 1) or an
+00023ad0: 7928 7869 203c 2030 293a 0a20 2020 2020  y(xi < 0):.     
+00023ae0: 2020 2020 2020 2020 2020 2023 2045 6e66             # Enf
+00023af0: 6f72 6365 2074 6869 7320 636f 6e64 6974  orce this condit
+00023b00: 696f 6e0a 2020 2020 2020 2020 2020 2020  ion.            
+00023b10: 2020 2020 7261 6973 6520 5661 6c75 6545      raise ValueE
+00023b20: 7272 6f72 2822 4974 206d 7573 7420 6265  rror("It must be
+00023b30: 2060 6030 203c 3d20 7869 203c 3d20 312e   ``0 <= xi <= 1.
+00023b40: 2022 0a20 2020 2020 2020 2020 2020 2020   ".             
+00023b50: 2020 2020 2020 2022 436f 6d70 7574 6564         "Computed
+00023b60: 3a20 2573 2220 2520 7869 290a 2020 2020  : %s" % xi).    
+00023b70: 2020 2020 2020 2020 776e 203d 206e 702e          wn = np.
+00023b80: 6172 7261 7928 5b0a 2020 2020 2020 2020  array([.        
+00023b90: 2020 2020 2020 2020 742e 6576 616c 6628          t.evalf(
+00023ba0: 7375 6273 3d73 656c 662e 7061 7261 6d73  subs=self.params
+00023bb0: 2920 6966 2069 7369 6e73 7461 6e63 6528  ) if isinstance(
+00023bc0: 742c 2045 7870 7229 2065 6c73 6520 740a  t, Expr) else t.
+00023bd0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00023be0: 666f 7220 7420 696e 2073 656c 662e 776e  for t in self.wn
+00023bf0: 5d2c 2064 7479 7065 3d66 6c6f 6174 290a  ], dtype=float).
+00023c00: 2020 2020 2020 2020 7470 203d 206e 702e          tp = np.
+00023c10: 6172 7261 7928 5b0a 2020 2020 2020 2020  array([.        
+00023c20: 2020 2020 742e 6576 616c 6628 7375 6273      t.evalf(subs
+00023c30: 3d73 656c 662e 7061 7261 6d73 2920 6966  =self.params) if
+00023c40: 2069 7369 6e73 7461 6e63 6528 742c 2045   isinstance(t, E
+00023c50: 7870 7229 2065 6c73 6520 740a 2020 2020  xpr) else t.    
+00023c60: 2020 2020 2020 2020 666f 7220 7420 696e          for t in
+00023c70: 2073 656c 662e 7470 5d2c 2064 7479 7065   self.tp], dtype
+00023c80: 3d66 6c6f 6174 290a 2020 2020 2020 2020  =float).        
+00023c90: 7473 203d 206e 702e 6172 7261 7928 5b0a  ts = np.array([.
+00023ca0: 2020 2020 2020 2020 2020 2020 742e 6576              t.ev
+00023cb0: 616c 6628 7375 6273 3d73 656c 662e 7061  alf(subs=self.pa
+00023cc0: 7261 6d73 2920 6966 2069 7369 6e73 7461  rams) if isinsta
+00023cd0: 6e63 6528 742c 2045 7870 7229 2065 6c73  nce(t, Expr) els
+00023ce0: 6520 740a 2020 2020 2020 2020 2020 2020  e t.            
+00023cf0: 666f 7220 7420 696e 2073 656c 662e 7473  for t in self.ts
+00023d00: 5d2c 2064 7479 7065 3d66 6c6f 6174 290a  ], dtype=float).
+00023d10: 0a20 2020 2020 2020 2061 6e67 6c65 7320  .        angles 
+00023d20: 3d20 6e70 2e70 6920 2d20 6e70 2e61 7263  = np.pi - np.arc
+00023d30: 636f 7328 7869 290a 2020 2020 2020 2020  cos(xi).        
+00023d40: 795f 6f76 6572 5f78 203d 206e 702e 7461  y_over_x = np.ta
+00023d50: 6e28 616e 676c 6573 290a 2020 2020 2020  n(angles).      
+00023d60: 2020 7220 3d20 6d61 7828 3130 3030 2c20    r = max(1000, 
+00023d70: 6d61 7828 776e 2929 2069 6620 6c65 6e28  max(wn)) if len(
+00023d80: 776e 2920 3e20 3020 656c 7365 2031 3030  wn) > 0 else 100
+00023d90: 300a 0a20 2020 2020 2020 2078 695f 6469  0..        xi_di
+00023da0: 6374 203d 207b 6b3a 207b 7d20 666f 7220  ct = {k: {} for 
+00023db0: 6b20 696e 207a 6970 2878 692c 2061 6e67  k in zip(xi, ang
+00023dc0: 6c65 732c 2079 5f6f 7665 725f 7829 7d0a  les, y_over_x)}.
+00023dd0: 2020 2020 2020 2020 776e 5f64 6963 7420          wn_dict 
+00023de0: 3d20 7b6b 3a20 7b7d 2066 6f72 206b 2069  = {k: {} for k i
+00023df0: 6e20 776e 7d0a 2020 2020 2020 2020 7470  n wn}.        tp
+00023e00: 5f64 6963 7420 3d20 7b6b 3a20 7b7d 2066  _dict = {k: {} f
+00023e10: 6f72 206b 2069 6e20 7470 7d0a 2020 2020  or k in tp}.    
+00023e20: 2020 2020 7473 5f64 6963 7420 3d20 7b6b      ts_dict = {k
+00023e30: 3a20 7b7d 2066 6f72 206b 2069 6e20 7473  : {} for k in ts
+00023e40: 7d0a 0a20 2020 2020 2020 2023 2064 616d  }..        # dam
+00023e50: 7069 6e67 2072 6174 696f 206c 696e 6573  ping ratio lines
+00023e60: 0a20 2020 2020 2020 2066 6f72 206b 2069  .        for k i
+00023e70: 6e20 7a69 7028 7869 2c20 616e 676c 6573  n zip(xi, angles
+00023e80: 2c20 795f 6f76 6572 5f78 293a 0a20 2020  , y_over_x):.   
+00023e90: 2020 2020 2020 2020 2078 2c20 612c 2079           x, a, y
+00023ea0: 7020 3d20 6b0a 2020 2020 2020 2020 2020  p = k.          
+00023eb0: 2020 7869 5f64 6963 745b 6b5d 5b22 7822    xi_dict[k]["x"
+00023ec0: 5d20 3d20 6e70 2e61 7272 6179 285b 302c  ] = np.array([0,
+00023ed0: 2072 202a 206e 702e 636f 7328 6129 5d29   r * np.cos(a)])
+00023ee0: 0a20 2020 2020 2020 2020 2020 2078 695f  .            xi_
+00023ef0: 6469 6374 5b6b 5d5b 2279 225d 203d 206e  dict[k]["y"] = n
+00023f00: 702e 6172 7261 7928 5b30 2c20 7220 2a20  p.array([0, r * 
+00023f10: 6e70 2e73 696e 2861 295d 290a 2020 2020  np.sin(a)]).    
+00023f20: 2020 2020 2020 2020 7869 5f64 6963 745b          xi_dict[
+00023f30: 6b5d 5b22 6c61 6265 6c22 5d20 3d20 2225  k]["label"] = "%
+00023f40: 2e32 6622 2025 2078 0a0a 2020 2020 2020  .2f" % x..      
+00023f50: 2020 2320 6e61 7475 7261 6c20 6672 6571    # natural freq
+00023f60: 7565 6e63 7920 6c69 6e65 730a 2020 2020  uency lines.    
+00023f70: 2020 2020 7420 3d20 6e70 2e6c 696e 7370      t = np.linsp
+00023f80: 6163 6528 6e70 2e70 692f 322c 2033 2a6e  ace(np.pi/2, 3*n
+00023f90: 702e 7069 2f32 2c20 3130 3029 0a20 2020  p.pi/2, 100).   
+00023fa0: 2020 2020 2063 7420 3d20 6e70 2e63 6f73       ct = np.cos
+00023fb0: 2874 290a 2020 2020 2020 2020 7374 203d  (t).        st =
+00023fc0: 206e 702e 7369 6e28 7429 0a20 2020 2020   np.sin(t).     
+00023fd0: 2020 2079 6c69 6d20 3d20 7365 6c66 2e5f     ylim = self._
+00023fe0: 796c 696d 0a20 2020 2020 2020 2079 5f6f  ylim.        y_o
+00023ff0: 6666 7365 7420 3d20 3020 6966 2079 6c69  ffset = 0 if yli
+00024000: 6d20 6973 204e 6f6e 6520 656c 7365 2030  m is None else 0
+00024010: 2e30 3135 202a 2061 6273 2879 6c69 6d5b  .015 * abs(ylim[
+00024020: 315d 202d 2079 6c69 6d5b 305d 290a 2020  1] - ylim[0]).  
+00024030: 2020 2020 2020 666f 7220 7720 696e 2077        for w in w
+00024040: 6e3a 0a20 2020 2020 2020 2020 2020 2077  n:.            w
+00024050: 6e5f 6469 6374 5b77 5d5b 2278 225d 203d  n_dict[w]["x"] =
+00024060: 2077 202a 2063 740a 2020 2020 2020 2020   w * ct.        
+00024070: 2020 2020 776e 5f64 6963 745b 775d 5b22      wn_dict[w]["
+00024080: 7922 5d20 3d20 7720 2a20 7374 0a20 2020  y"] = w * st.   
+00024090: 2020 2020 2020 2020 2077 6e5f 6469 6374           wn_dict
+000240a0: 5b77 5d5b 226c 6162 656c 225d 203d 2022  [w]["label"] = "
+000240b0: 252e 3266 2220 2520 770a 2020 2020 2020  %.2f" % w.      
+000240c0: 2020 2020 2020 776e 5f64 6963 745b 775d        wn_dict[w]
+000240d0: 5b22 6c78 225d 203d 202d 770a 2020 2020  ["lx"] = -w.    
+000240e0: 2020 2020 2020 2020 776e 5f64 6963 745b          wn_dict[
+000240f0: 775d 5b22 6c79 225d 203d 2079 5f6f 6666  w]["ly"] = y_off
+00024100: 7365 740a 0a20 2020 2020 2020 2023 2070  set..        # p
+00024110: 6561 6b20 7469 6d65 206c 696e 6573 0a20  eak time lines. 
+00024120: 2020 2020 2020 2079 5f74 7020 3d20 6e70         y_tp = np
+00024130: 2e70 6920 2f20 7470 0a20 2020 2020 2020  .pi / tp.       
+00024140: 2023 2073 6574 746c 696e 6720 7469 6d65   # settling time
+00024150: 206c 696e 6573 0a20 2020 2020 2020 2078   lines.        x
+00024160: 5f74 7320 3d20 2d34 202f 2074 730a 0a20  _ts = -4 / ts.. 
+00024170: 2020 2020 2020 2072 6574 7572 6e20 7869         return xi
+00024180: 5f64 6963 742c 2077 6e5f 6469 6374 2c20  _dict, wn_dict, 
+00024190: 795f 7470 2c20 785f 7473 0a0a 0a63 6c61  y_tp, x_ts...cla
+000241a0: 7373 205a 4772 6964 4c69 6e65 5365 7269  ss ZGridLineSeri
+000241b0: 6573 2847 7269 6442 6173 652c 2042 6173  es(GridBase, Bas
+000241c0: 6553 6572 6965 7329 3a0a 2020 2020 2222  eSeries):.    ""
+000241d0: 2252 6570 7265 7365 6e74 2061 2067 7269  "Represent a gri
+000241e0: 6420 6f66 2064 616d 7069 6e67 2072 6174  d of damping rat
+000241f0: 696f 206c 696e 6573 2061 6e64 206e 6174  io lines and nat
+00024200: 7572 616c 2066 7265 7175 656e 6379 206c  ural frequency l
+00024210: 696e 6573 0a20 2020 206f 6e20 7468 6520  ines.    on the 
+00024220: 7a2d 706c 616e 652e 0a20 2020 2022 2222  z-plane..    """
+00024230: 0a0a 2020 2020 6465 6620 5f5f 696e 6974  ..    def __init
+00024240: 5f5f 2873 656c 662c 2078 692c 2077 6e2c  __(self, xi, wn,
+00024250: 2074 702c 2074 732c 202a 2a6b 7761 7267   tp, ts, **kwarg
+00024260: 7329 3a0a 2020 2020 2020 2020 7375 7065  s):.        supe
+00024270: 7228 292e 5f5f 696e 6974 5f5f 282a 2a6b  r().__init__(**k
+00024280: 7761 7267 7329 0a20 2020 2020 2020 2054  wargs).        T
+00024290: 203d 206b 7761 7267 732e 6765 7428 2254   = kwargs.get("T
+000242a0: 222c 204e 6f6e 6529 0a20 2020 2020 2020  ", None).       
+000242b0: 2073 656c 662e 7361 6d70 6c69 6e67 5f70   self.sampling_p
+000242c0: 6572 696f 6420 3d20 5420 6966 2054 2069  eriod = T if T i
+000242d0: 7320 4e6f 6e65 2065 6c73 6520 666c 6f61  s None else floa
+000242e0: 7428 5429 0a20 2020 2020 2020 2073 656c  t(T).        sel
+000242f0: 662e 7869 203d 2078 690a 2020 2020 2020  f.xi = xi.      
+00024300: 2020 7365 6c66 2e77 6e20 3d20 776e 0a20    self.wn = wn. 
+00024310: 2020 2020 2020 2073 656c 662e 7470 203d         self.tp =
+00024320: 2074 700a 2020 2020 2020 2020 7365 6c66   tp.        self
+00024330: 2e74 7320 3d20 7473 0a20 2020 2020 2020  .ts = ts.       
+00024340: 2073 656c 662e 7368 6f77 5f63 6f6e 7472   self.show_contr
+00024350: 6f6c 5f61 7869 7320 3d20 6b77 6172 6773  ol_axis = kwargs
+00024360: 2e67 6574 2822 7368 6f77 5f63 6f6e 7472  .get("show_contr
+00024370: 6f6c 5f61 7869 7322 2c20 4661 6c73 6529  ol_axis", False)
+00024380: 0a0a 2020 2020 6465 6620 5f5f 7374 725f  ..    def __str_
+00024390: 5f28 7365 6c66 293a 0a20 2020 2020 2020  _(self):.       
+000243a0: 2072 6574 7572 6e20 227a 2d67 7269 6422   return "z-grid"
+000243b0: 0a0a 2020 2020 6465 6620 6765 745f 6461  ..    def get_da
+000243c0: 7461 2873 656c 6629 3a0a 2020 2020 2020  ta(self):.      
+000243d0: 2020 2222 220a 2020 2020 2020 2020 5265    """.        Re
+000243e0: 7475 726e 730a 2020 2020 2020 2020 3d3d  turns.        ==
+000243f0: 3d3d 3d3d 3d0a 2020 2020 2020 2020 7869  =====.        xi
+00024400: 2c20 776e 2c20 7470 2c20 7473 203a 2064  , wn, tp, ts : d
+00024410: 6963 740a 2020 2020 2020 2020 2020 2020  ict.            
+00024420: 4469 6374 696f 6e61 7269 6573 2063 6f6e  Dictionaries con
+00024430: 7461 696e 696e 6720 7468 6520 7265 7175  taining the requ
+00024440: 6972 6564 206e 756d 6572 6963 616c 2064  ired numerical d
+00024450: 6174 6120 746f 2063 7265 6174 650a 2020  ata to create.  
+00024460: 2020 2020 2020 2020 2020 6c69 6e65 7320            lines 
+00024470: 616e 6420 616e 6e6f 7461 7469 6f6e 732e  and annotations.
+00024480: 0a20 2020 2020 2020 2022 2222 0a20 2020  .        """.   
+00024490: 2020 2020 206e 7020 3d20 696d 706f 7274       np = import
+000244a0: 5f6d 6f64 756c 6528 226e 756d 7079 2229  _module("numpy")
+000244b0: 0a20 2020 2020 2020 2069 6620 7365 6c66  .        if self
+000244c0: 2e69 735f 696e 7465 7261 6374 6976 653a  .is_interactive:
+000244d0: 0a20 2020 2020 2020 2020 2020 2078 6920  .            xi 
+000244e0: 3d20 6e70 2e61 7272 6179 285b 0a20 2020  = np.array([.   
+000244f0: 2020 2020 2020 2020 2020 2020 2074 2e65               t.e
+00024500: 7661 6c66 2873 7562 733d 7365 6c66 2e70  valf(subs=self.p
+00024510: 6172 616d 7329 2069 6620 6973 696e 7374  arams) if isinst
+00024520: 616e 6365 2874 2c20 4578 7072 2920 656c  ance(t, Expr) el
+00024530: 7365 2074 0a20 2020 2020 2020 2020 2020  se t.           
+00024540: 2020 2020 2066 6f72 2074 2069 6e20 7365       for t in se
+00024550: 6c66 2e78 695d 2c20 6474 7970 653d 666c  lf.xi], dtype=fl
+00024560: 6f61 7429 0a20 2020 2020 2020 2020 2020  oat).           
+00024570: 2077 6e20 3d20 6e70 2e61 7272 6179 285b   wn = np.array([
+00024580: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00024590: 2074 2e65 7661 6c66 2873 7562 733d 7365   t.evalf(subs=se
+000245a0: 6c66 2e70 6172 616d 7329 2069 6620 6973  lf.params) if is
+000245b0: 696e 7374 616e 6365 2874 2c20 4578 7072  instance(t, Expr
+000245c0: 2920 656c 7365 2074 0a20 2020 2020 2020  ) else t.       
+000245d0: 2020 2020 2020 2020 2066 6f72 2074 2069           for t i
+000245e0: 6e20 7365 6c66 2e77 6e5d 2c20 6474 7970  n self.wn], dtyp
+000245f0: 653d 666c 6f61 7429 0a20 2020 2020 2020  e=float).       
+00024600: 2020 2020 2074 7020 3d20 6e70 2e61 7272       tp = np.arr
+00024610: 6179 285b 0a20 2020 2020 2020 2020 2020  ay([.           
+00024620: 2020 2020 2074 2e65 7661 6c66 2873 7562       t.evalf(sub
+00024630: 733d 7365 6c66 2e70 6172 616d 7329 2069  s=self.params) i
+00024640: 6620 6973 696e 7374 616e 6365 2874 2c20  f isinstance(t, 
+00024650: 4578 7072 2920 656c 7365 2074 0a20 2020  Expr) else t.   
+00024660: 2020 2020 2020 2020 2020 2020 2066 6f72               for
+00024670: 2074 2069 6e20 7365 6c66 2e74 705d 2c20   t in self.tp], 
+00024680: 6474 7970 653d 666c 6f61 7429 0a20 2020  dtype=float).   
+00024690: 2020 2020 2020 2020 2074 7320 3d20 6e70           ts = np
+000246a0: 2e61 7272 6179 285b 0a20 2020 2020 2020  .array([.       
+000246b0: 2020 2020 2020 2020 2074 2e65 7661 6c66           t.evalf
+000246c0: 2873 7562 733d 7365 6c66 2e70 6172 616d  (subs=self.param
+000246d0: 7329 2069 6620 6973 696e 7374 616e 6365  s) if isinstance
+000246e0: 2874 2c20 4578 7072 2920 656c 7365 2074  (t, Expr) else t
+000246f0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00024700: 2066 6f72 2074 2069 6e20 7365 6c66 2e74   for t in self.t
+00024710: 735d 2c20 6474 7970 653d 666c 6f61 7429  s], dtype=float)
+00024720: 0a20 2020 2020 2020 2065 6c73 653a 0a20  .        else:. 
+00024730: 2020 2020 2020 2020 2020 2078 6920 3d20             xi = 
+00024740: 6e70 2e61 7272 6179 2873 656c 662e 7869  np.array(self.xi
+00024750: 2c20 6474 7970 653d 666c 6f61 7429 0a20  , dtype=float). 
+00024760: 2020 2020 2020 2020 2020 2077 6e20 3d20             wn = 
+00024770: 6e70 2e61 7272 6179 2873 656c 662e 776e  np.array(self.wn
+00024780: 2c20 6474 7970 653d 666c 6f61 7429 0a20  , dtype=float). 
+00024790: 2020 2020 2020 2020 2020 2074 7020 3d20             tp = 
+000247a0: 6e70 2e61 7272 6179 2873 656c 662e 7470  np.array(self.tp
+000247b0: 2c20 6474 7970 653d 666c 6f61 7429 0a20  , dtype=float). 
+000247c0: 2020 2020 2020 2020 2020 2074 7320 3d20             ts = 
+000247d0: 6e70 2e61 7272 6179 2873 656c 662e 7473  np.array(self.ts
+000247e0: 2c20 6474 7970 653d 666c 6f61 7429 0a0a  , dtype=float)..
+000247f0: 2020 2020 2020 2020 5420 3d20 7365 6c66          T = self
+00024800: 2e73 616d 706c 696e 675f 7065 7269 6f64  .sampling_period
+00024810: 0a20 2020 2020 2020 2078 695f 6469 6374  .        xi_dict
+00024820: 203d 207b 6b3a 207b 7d20 666f 7220 6b20   = {k: {} for k 
+00024830: 696e 2078 697d 0a20 2020 2020 2020 2077  in xi}.        w
+00024840: 6e5f 6469 6374 203d 207b 6b3a 207b 7d20  n_dict = {k: {} 
+00024850: 666f 7220 6b20 696e 2077 6e7d 0a20 2020  for k in wn}.   
+00024860: 2020 2020 2074 705f 6469 6374 203d 207b       tp_dict = {
+00024870: 6b3a 207b 7d20 666f 7220 6b20 696e 2074  k: {} for k in t
+00024880: 707d 0a20 2020 2020 2020 2074 735f 6469  p}.        ts_di
+00024890: 6374 203d 207b 6b3a 207b 7d20 666f 7220  ct = {k: {} for 
+000248a0: 6b20 696e 2074 737d 0a0a 2020 2020 2020  k in ts}..      
+000248b0: 2020 2320 6461 6d70 696e 6720 7261 7469    # damping rati
+000248c0: 6f20 6c69 6e65 730a 2020 2020 2020 2020  o lines.        
+000248d0: 666f 7220 7a65 7461 2069 6e20 7869 3a0a  for zeta in xi:.
+000248e0: 2020 2020 2020 2020 2020 2020 2320 4361              # Ca
+000248f0: 6c63 756c 6174 6520 696e 2070 6f6c 6172  lculate in polar
+00024900: 2063 6f6f 7264 696e 6174 6573 0a20 2020   coordinates.   
+00024910: 2020 2020 2020 2020 2066 6163 746f 7220           factor 
+00024920: 3d20 7a65 7461 2f6e 702e 7371 7274 2831  = zeta/np.sqrt(1
+00024930: 2d7a 6574 612a 2a32 290a 2020 2020 2020  -zeta**2).      
+00024940: 2020 2020 2020 7820 3d20 6e70 2e6c 696e        x = np.lin
+00024950: 7370 6163 6528 302c 206e 702e 7371 7274  space(0, np.sqrt
+00024960: 2831 2d7a 6574 612a 2a32 292c 2032 3030  (1-zeta**2), 200
+00024970: 290a 2020 2020 2020 2020 2020 2020 616e  ).            an
+00024980: 6720 3d20 6e70 2e70 692a 780a 2020 2020  g = np.pi*x.    
+00024990: 2020 2020 2020 2020 6d61 6720 3d20 6e70          mag = np
+000249a0: 2e65 7870 282d 6e70 2e70 692a 6661 6374  .exp(-np.pi*fact
+000249b0: 6f72 2a78 290a 2020 2020 2020 2020 2020  or*x).          
+000249c0: 2020 2320 4472 6177 2075 7070 6572 2070    # Draw upper p
+000249d0: 6172 7420 696e 2072 6574 616e 6775 6c61  art in retangula
+000249e0: 7220 636f 6f72 6469 6e61 7465 730a 2020  r coordinates.  
+000249f0: 2020 2020 2020 2020 2020 7872 6574 203d            xret =
+00024a00: 206d 6167 2a6e 702e 636f 7328 616e 6729   mag*np.cos(ang)
+00024a10: 0a20 2020 2020 2020 2020 2020 2079 7265  .            yre
+00024a20: 7420 3d20 6d61 672a 6e70 2e73 696e 2861  t = mag*np.sin(a
+00024a30: 6e67 290a 2020 2020 2020 2020 2020 2020  ng).            
+00024a40: 7869 5f64 6963 745b 7a65 7461 5d5b 2278  xi_dict[zeta]["x
+00024a50: 3122 5d20 3d20 7872 6574 0a20 2020 2020  1"] = xret.     
+00024a60: 2020 2020 2020 2078 695f 6469 6374 5b7a         xi_dict[z
+00024a70: 6574 615d 5b22 7931 225d 203d 2079 7265  eta]["y1"] = yre
+00024a80: 740a 2020 2020 2020 2020 2020 2020 2320  t.            # 
+00024a90: 4472 6177 206c 6f77 6572 2070 6172 7420  Draw lower part 
+00024aa0: 696e 2072 6574 616e 6775 6c61 7220 636f  in retangular co
+00024ab0: 6f72 6469 6e61 7465 730a 2020 2020 2020  ordinates.      
+00024ac0: 2020 2020 2020 7872 6574 203d 206d 6167        xret = mag
+00024ad0: 2a6e 702e 636f 7328 2d61 6e67 290a 2020  *np.cos(-ang).  
+00024ae0: 2020 2020 2020 2020 2020 7972 6574 203d            yret =
+00024af0: 206d 6167 2a6e 702e 7369 6e28 2d61 6e67   mag*np.sin(-ang
+00024b00: 290a 2020 2020 2020 2020 2020 2020 7869  ).            xi
+00024b10: 5f64 6963 745b 7a65 7461 5d5b 2278 3222  _dict[zeta]["x2"
+00024b20: 5d20 3d20 7872 6574 0a20 2020 2020 2020  ] = xret.       
+00024b30: 2020 2020 2078 695f 6469 6374 5b7a 6574       xi_dict[zet
+00024b40: 615d 5b22 7932 225d 203d 2079 7265 740a  a]["y2"] = yret.
+00024b50: 2020 2020 2020 2020 2020 2020 2320 416e              # An
+00024b60: 6e6f 7461 7469 6f6e 0a20 2020 2020 2020  notation.       
+00024b70: 2020 2020 2061 6e5f 6920 3d20 696e 7428       an_i = int(
+00024b80: 6c65 6e28 7872 6574 292f 322e 3529 0a20  len(xret)/2.5). 
+00024b90: 2020 2020 2020 2020 2020 2061 6e5f 7820             an_x 
+00024ba0: 3d20 7872 6574 5b61 6e5f 695d 0a20 2020  = xret[an_i].   
+00024bb0: 2020 2020 2020 2020 2061 6e5f 7920 3d20           an_y = 
+00024bc0: 7972 6574 5b61 6e5f 695d 0a20 2020 2020  yret[an_i].     
+00024bd0: 2020 2020 2020 2078 695f 6469 6374 5b7a         xi_dict[z
+00024be0: 6574 615d 5b22 6c78 225d 203d 2078 7265  eta]["lx"] = xre
+00024bf0: 745b 616e 5f69 5d0a 2020 2020 2020 2020  t[an_i].        
+00024c00: 2020 2020 7869 5f64 6963 745b 7a65 7461      xi_dict[zeta
+00024c10: 5d5b 226c 7922 5d20 3d20 7972 6574 5b61  ]["ly"] = yret[a
+00024c20: 6e5f 695d 0a20 2020 2020 2020 2020 2020  n_i].           
+00024c30: 2078 695f 6469 6374 5b7a 6574 615d 5b22   xi_dict[zeta]["
+00024c40: 6c61 6265 6c22 5d20 3d20 7374 7228 726f  label"] = str(ro
+00024c50: 756e 6428 7a65 7461 2c20 3229 290a 0a20  und(zeta, 2)).. 
+00024c60: 2020 2020 2020 2023 206e 6174 7572 616c         # natural
+00024c70: 2066 7265 7175 656e 6379 206c 696e 6573   frequency lines
+00024c80: 0a20 2020 2020 2020 2072 5f61 6e20 3d20  .        r_an = 
+00024c90: 312e 3037 350a 2020 2020 2020 2020 666d  1.075.        fm
+00024ca0: 7420 3d20 277b 3a31 2e31 667d 2720 6966  t = '{:1.1f}' if
+00024cb0: 206c 656e 2877 6e29 203e 2031 2065 6c73   len(wn) > 1 els
+00024cc0: 6520 277b 3a31 2e32 667d 270a 2020 2020  e '{:1.2f}'.    
+00024cd0: 2020 2020 6465 6620 6765 745f 6c61 6265      def get_labe
+00024ce0: 6c28 6e75 6d29 3a0a 2020 2020 2020 2020  l(num):.        
+00024cf0: 2020 2020 6465 6620 6675 6e63 2875 7365      def func(use
+00024d00: 5f6c 6174 6578 3d54 7275 6529 3a0a 2020  _latex=True):.  
+00024d10: 2020 2020 2020 2020 2020 2020 2020 6966                if
+00024d20: 2075 7365 5f6c 6174 6578 3a0a 2020 2020   use_latex:.    
+00024d30: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00024d40: 7265 7475 726e 2072 2224 5c66 7261 637b  return r"$\frac{
+00024d50: 222b 6e75 6d2b 7222 5c70 697d 7b54 7d24  "+num+r"\pi}{T}$
+00024d60: 220a 2020 2020 2020 2020 2020 2020 2020  ".              
+00024d70: 2020 7265 7475 726e 2073 7472 286e 756d    return str(num
+00024d80: 2920 2b20 2220 cf80 2f54 220a 2020 2020  ) + " ../T".    
+00024d90: 2020 2020 2020 2020 7265 7475 726e 2066          return f
+00024da0: 756e 630a 2020 2020 2020 2020 666f 7220  unc.        for 
+00024db0: 6120 696e 2077 6e3a 0a20 2020 2020 2020  a in wn:.       
+00024dc0: 2020 2020 2023 2043 616c 6375 6c61 7465       # Calculate
+00024dd0: 2069 6e20 706f 6c61 7220 636f 6f72 6469   in polar coordi
+00024de0: 6e61 7465 730a 2020 2020 2020 2020 2020  nates.          
+00024df0: 2020 7820 3d20 6e70 2e6c 696e 7370 6163    x = np.linspac
+00024e00: 6528 2d6e 702e 7069 2f32 2c20 6e70 2e70  e(-np.pi/2, np.p
+00024e10: 692f 322c 2032 3030 290a 2020 2020 2020  i/2, 200).      
+00024e20: 2020 2020 2020 616e 6720 3d20 6e70 2e70        ang = np.p
+00024e30: 692a 612a 6e70 2e73 696e 2878 290a 2020  i*a*np.sin(x).  
+00024e40: 2020 2020 2020 2020 2020 6d61 6720 3d20            mag = 
+00024e50: 6e70 2e65 7870 282d 6e70 2e70 692a 612a  np.exp(-np.pi*a*
+00024e60: 6e70 2e63 6f73 2878 2929 0a20 2020 2020  np.cos(x)).     
+00024e70: 2020 2020 2020 2023 2044 7261 7720 696e         # Draw in
+00024e80: 2072 6574 616e 6775 6c61 7220 636f 6f72   retangular coor
+00024e90: 6469 6e61 7465 730a 2020 2020 2020 2020  dinates.        
+00024ea0: 2020 2020 7872 6574 203d 206d 6167 2a6e      xret = mag*n
+00024eb0: 702e 636f 7328 616e 6729 0a20 2020 2020  p.cos(ang).     
+00024ec0: 2020 2020 2020 2079 7265 7420 3d20 6d61         yret = ma
+00024ed0: 672a 6e70 2e73 696e 2861 6e67 290a 2020  g*np.sin(ang).  
+00024ee0: 2020 2020 2020 2020 2020 776e 5f64 6963            wn_dic
+00024ef0: 745b 615d 5b22 7822 5d20 3d20 7872 6574  t[a]["x"] = xret
+00024f00: 0a20 2020 2020 2020 2020 2020 2077 6e5f  .            wn_
+00024f10: 6469 6374 5b61 5d5b 2279 225d 203d 2079  dict[a]["y"] = y
+00024f20: 7265 740a 2020 2020 2020 2020 2020 2020  ret.            
+00024f30: 2320 416e 6e6f 7461 7469 6f6e 0a20 2020  # Annotation.   
+00024f40: 2020 2020 2020 2020 2061 6e67 6c65 203d           angle =
+00024f50: 206e 702e 6172 6374 616e 3228 7972 6574   np.arctan2(yret
+00024f60: 5b2d 315d 2c20 7872 6574 5b2d 315d 290a  [-1], xret[-1]).
+00024f70: 2020 2020 2020 2020 2020 2020 776e 5f64              wn_d
+00024f80: 6963 745b 615d 5b22 6c78 225d 203d 2072  ict[a]["lx"] = r
+00024f90: 5f61 6e20 2a20 6e70 2e63 6f73 2861 6e67  _an * np.cos(ang
+00024fa0: 6c65 290a 2020 2020 2020 2020 2020 2020  le).            
+00024fb0: 776e 5f64 6963 745b 615d 5b22 6c79 225d  wn_dict[a]["ly"]
+00024fc0: 203d 2072 5f61 6e20 2a20 6e70 2e73 696e   = r_an * np.sin
+00024fd0: 2861 6e67 6c65 290a 2020 2020 2020 2020  (angle).        
+00024fe0: 2020 2020 6966 2054 2069 7320 4e6f 6e65      if T is None
+00024ff0: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+00025000: 2020 6e75 6d20 3d20 666d 742e 666f 726d    num = fmt.form
+00025010: 6174 2861 290a 2020 2020 2020 2020 2020  at(a).          
+00025020: 2020 2020 2020 616e 203d 2072 2224 5c66        an = r"$\f
+00025030: 7261 637b 222b 6e75 6d2b 7222 5c70 697d  rac{"+num+r"\pi}
+00025040: 7b54 7d24 220a 2020 2020 2020 2020 2020  {T}$".          
+00025050: 2020 2020 2020 616e 203d 2067 6574 5f6c        an = get_l
+00025060: 6162 656c 286e 756d 290a 2020 2020 2020  abel(num).      
+00025070: 2020 2020 2020 656c 7365 3a0a 2020 2020        else:.    
+00025080: 2020 2020 2020 2020 2020 2020 6675 6e63              func
+00025090: 203d 206c 616d 6264 6120 612c 2054 3a20   = lambda a, T: 
+000250a0: 6c61 6d62 6461 2075 7365 5f6c 6174 6578  lambda use_latex
+000250b0: 3a20 2225 2e32 6622 2025 2028 6120 2a20  : "%.2f" % (a * 
+000250c0: 6e70 2e70 6920 2a20 5429 0a20 2020 2020  np.pi * T).     
+000250d0: 2020 2020 2020 2020 2020 2061 6e20 3d20             an = 
+000250e0: 6675 6e63 2861 2c20 5429 0a20 2020 2020  func(a, T).     
+000250f0: 2020 2020 2020 2077 6e5f 6469 6374 5b61         wn_dict[a
+00025100: 5d5b 226c 6162 656c 225d 203d 2061 6e0a  ]["label"] = an.
+00025110: 0a20 2020 2020 2020 2023 2070 6561 6b20  .        # peak 
+00025120: 7469 6d65 206c 696e 6573 0a20 2020 2020  time lines.     
+00025130: 2020 2061 6e67 6c65 7320 3d20 6e70 2e70     angles = np.p
+00025140: 6920 2f20 7470 0a20 2020 2020 2020 2066  i / tp.        f
+00025150: 6f72 205f 7470 2c20 6120 696e 207a 6970  or _tp, a in zip
+00025160: 2874 702c 2061 6e67 6c65 7329 3a0a 2020  (tp, angles):.  
+00025170: 2020 2020 2020 2020 2020 7470 5f64 6963            tp_dic
+00025180: 745b 5f74 705d 5b22 7822 5d20 3d20 5b30  t[_tp]["x"] = [0
+00025190: 2c20 6e70 2e63 6f73 2861 295d 0a20 2020  , np.cos(a)].   
+000251a0: 2020 2020 2020 2020 2074 705f 6469 6374           tp_dict
+000251b0: 5b5f 7470 5d5b 2279 225d 203d 205b 302c  [_tp]["y"] = [0,
+000251c0: 206e 702e 7369 6e28 6129 5d0a 2020 2020   np.sin(a)].    
+000251d0: 2020 2020 2020 2020 2320 416e 6e6f 7461          # Annota
+000251e0: 7469 6f6e 0a20 2020 2020 2020 2020 2020  tion.           
+000251f0: 2074 705f 6469 6374 5b5f 7470 5d5b 226c   tp_dict[_tp]["l
+00025200: 7822 5d20 3d20 725f 616e 202a 206e 702e  x"] = r_an * np.
+00025210: 636f 7328 6129 0a20 2020 2020 2020 2020  cos(a).         
+00025220: 2020 2074 705f 6469 6374 5b5f 7470 5d5b     tp_dict[_tp][
+00025230: 226c 7922 5d20 3d20 725f 616e 202a 206e  "ly"] = r_an * n
+00025240: 702e 7369 6e28 6129 0a20 2020 2020 2020  p.sin(a).       
+00025250: 2020 2020 2061 6e20 3d20 5f74 7020 6966       an = _tp if
+00025260: 206e 6f74 2054 2065 6c73 6520 5f74 7020   not T else _tp 
+00025270: 2a20 540a 2020 2020 2020 2020 2020 2020  * T.            
+00025280: 616e 203d 2022 252e 3266 2220 2520 616e  an = "%.2f" % an
+00025290: 2069 6620 6e6f 7420 5420 656c 7365 2022   if not T else "
+000252a0: 252e 3266 2073 2220 2520 616e 0a20 2020  %.2f s" % an.   
+000252b0: 2020 2020 2020 2020 2074 705f 6469 6374           tp_dict
+000252c0: 5b5f 7470 5d5b 226c 6162 656c 225d 203d  [_tp]["label"] =
+000252d0: 2061 6e0a 0a20 2020 2020 2020 2023 2073   an..        # s
+000252e0: 6574 746c 696e 6720 7469 6d65 206c 696e  ettling time lin
+000252f0: 6573 0a20 2020 2020 2020 2072 6164 6975  es.        radiu
+00025300: 7320 3d20 6e70 2e65 7870 282d 3420 2f20  s = np.exp(-4 / 
+00025310: 7473 290a 2020 2020 2020 2020 7468 6574  ts).        thet
+00025320: 6120 3d20 6e70 2e6c 696e 7370 6163 6528  a = np.linspace(
+00025330: 302c 2032 2a6e 702e 7069 2c20 3430 3029  0, 2*np.pi, 400)
+00025340: 0a20 2020 2020 2020 2063 7420 3d20 6e70  .        ct = np
+00025350: 2e63 6f73 2874 6865 7461 290a 2020 2020  .cos(theta).    
+00025360: 2020 2020 7374 203d 206e 702e 7369 6e28      st = np.sin(
+00025370: 7468 6574 6129 0a20 2020 2020 2020 2066  theta).        f
+00025380: 6f72 205f 7473 2c20 7220 696e 207a 6970  or _ts, r in zip
+00025390: 2874 732c 2072 6164 6975 7329 3a0a 2020  (ts, radius):.  
+000253a0: 2020 2020 2020 2020 2020 7473 5f64 6963            ts_dic
+000253b0: 745b 5f74 735d 5b22 7822 5d20 3d20 7220  t[_ts]["x"] = r 
+000253c0: 2a20 6374 0a20 2020 2020 2020 2020 2020  * ct.           
+000253d0: 2074 735f 6469 6374 5b5f 7473 5d5b 2279   ts_dict[_ts]["y
+000253e0: 225d 203d 2072 202a 2073 740a 2020 2020  "] = r * st.    
+000253f0: 2020 2020 2020 2020 2320 416e 6e6f 7461          # Annota
+00025400: 7469 6f6e 0a20 2020 2020 2020 2020 2020  tion.           
+00025410: 2061 6e5f 6920 3d20 696e 7428 6c65 6e28   an_i = int(len(
+00025420: 7468 6574 6129 2a30 2e37 3529 0a20 2020  theta)*0.75).   
+00025430: 2020 2020 2020 2020 2074 735f 6469 6374           ts_dict
+00025440: 5b5f 7473 5d5b 226c 7822 5d20 3d20 7473  [_ts]["lx"] = ts
+00025450: 5f64 6963 745b 5f74 735d 5b22 7822 5d5b  _dict[_ts]["x"][
+00025460: 616e 5f69 5d0a 2020 2020 2020 2020 2020  an_i].          
+00025470: 2020 7473 5f64 6963 745b 5f74 735d 5b22    ts_dict[_ts]["
+00025480: 6c79 225d 203d 2074 735f 6469 6374 5b5f  ly"] = ts_dict[_
+00025490: 7473 5d5b 2279 225d 5b61 6e5f 695d 0a20  ts]["y"][an_i]. 
+000254a0: 2020 2020 2020 2020 2020 2061 6e20 3d20             an = 
+000254b0: 5f74 7320 6966 206e 6f74 2054 2065 6c73  _ts if not T els
+000254c0: 6520 5f74 7320 2a20 540a 2020 2020 2020  e _ts * T.      
+000254d0: 2020 2020 2020 616e 203d 2022 252e 3266        an = "%.2f
+000254e0: 2220 2520 616e 2069 6620 6e6f 7420 5420  " % an if not T 
+000254f0: 656c 7365 2022 252e 3266 2073 2220 2520  else "%.2f s" % 
+00025500: 616e 0a20 2020 2020 2020 2020 2020 2074  an.            t
+00025510: 735f 6469 6374 5b5f 7473 5d5b 226c 6162  s_dict[_ts]["lab
+00025520: 656c 225d 203d 2061 6e0a 0a20 2020 2020  el"] = an..     
+00025530: 2020 2072 6574 7572 6e20 7869 5f64 6963     return xi_dic
+00025540: 742c 2077 6e5f 6469 6374 2c20 7470 5f64  t, wn_dict, tp_d
+00025550: 6963 742c 2074 735f 6469 6374 0a0a 0a63  ict, ts_dict...c
+00025560: 6c61 7373 2041 7272 6f77 734d 6978 696e  lass ArrowsMixin
+00025570: 3a0a 2020 2020 6465 6620 5f5f 696e 6974  :.    def __init
+00025580: 5f5f 2873 656c 662c 202a 6172 6773 2c20  __(self, *args, 
+00025590: 2a2a 6b77 6172 6773 293a 0a20 2020 2020  **kwargs):.     
+000255a0: 2020 2073 7570 6572 2829 2e5f 5f69 6e69     super().__ini
+000255b0: 745f 5f28 2a61 7267 732c 202a 2a6b 7761  t__(*args, **kwa
+000255c0: 7267 7329 0a20 2020 2020 2020 2073 656c  rgs).        sel
+000255d0: 662e 6172 726f 7773 203d 206b 7761 7267  f.arrows = kwarg
+000255e0: 732e 6765 7428 2261 7272 6f77 7322 2c20  s.get("arrows", 
+000255f0: 3329 0a0a 2020 2020 2020 2020 2320 5061  3)..        # Pa
+00025600: 7273 6520 7468 6520 6172 726f 7773 206b  rse the arrows k
+00025610: 6579 776f 7264 0a20 2020 2020 2020 206e  eyword.        n
+00025620: 7020 3d20 696d 706f 7274 5f6d 6f64 756c  p = import_modul
+00025630: 6528 226e 756d 7079 2229 0a20 2020 2020  e("numpy").     
+00025640: 2020 2069 6620 6e6f 7420 7365 6c66 2e61     if not self.a
+00025650: 7272 6f77 733a 0a20 2020 2020 2020 2020  rrows:.         
+00025660: 2020 2073 656c 662e 6172 726f 775f 6c6f     self.arrow_lo
+00025670: 6373 203d 205b 5d0a 2020 2020 2020 2020  cs = [].        
+00025680: 656c 6966 2069 7369 6e73 7461 6e63 6528  elif isinstance(
+00025690: 7365 6c66 2e61 7272 6f77 732c 2069 6e74  self.arrows, int
+000256a0: 293a 0a20 2020 2020 2020 2020 2020 204e  ):.            N
+000256b0: 203d 2033 2069 6620 7365 6c66 2e61 7272   = 3 if self.arr
+000256c0: 6f77 7320 6973 2054 7275 6520 656c 7365  ows is True else
+000256d0: 2073 656c 662e 6172 726f 7773 0a20 2020   self.arrows.   
+000256e0: 2020 2020 2020 2020 2023 2053 7061 6365           # Space
+000256f0: 2061 7272 6f77 7320 6f75 742c 2073 7461   arrows out, sta
+00025700: 7274 696e 6720 6d69 6477 6179 2061 6c6f  rting midway alo
+00025710: 6e67 2065 6163 6820 2272 6567 696f 6e22  ng each "region"
+00025720: 0a20 2020 2020 2020 2020 2020 2073 656c  .            sel
+00025730: 662e 6172 726f 775f 6c6f 6373 203d 206e  f.arrow_locs = n
+00025740: 702e 6c69 6e73 7061 6365 2830 2e35 2f4e  p.linspace(0.5/N
+00025750: 2c20 3120 2b20 302e 352f 4e2c 204e 2c20  , 1 + 0.5/N, N, 
+00025760: 656e 6470 6f69 6e74 3d46 616c 7365 290a  endpoint=False).
+00025770: 2020 2020 2020 2020 656c 6966 2069 7369          elif isi
+00025780: 6e73 7461 6e63 6528 7365 6c66 2e61 7272  nstance(self.arr
+00025790: 6f77 732c 2028 6c69 7374 2c20 6e70 2e6e  ows, (list, np.n
+000257a0: 6461 7272 6179 2929 3a0a 2020 2020 2020  darray)):.      
+000257b0: 2020 2020 2020 7365 6c66 2e61 7272 6f77        self.arrow
+000257c0: 5f6c 6f63 7320 3d20 6e70 2e73 6f72 7428  _locs = np.sort(
+000257d0: 6e70 2e61 746c 6561 7374 5f31 6428 7365  np.atleast_1d(se
+000257e0: 6c66 2e61 7272 6f77 7329 290a 2020 2020  lf.arrows)).    
+000257f0: 2020 2020 656c 7365 3a0a 2020 2020 2020      else:.      
+00025800: 2020 2020 2020 7261 6973 6520 5661 6c75        raise Valu
+00025810: 6545 7272 6f72 2822 756e 6b6e 6f77 6e20  eError("unknown 
+00025820: 6f72 2075 6e73 7570 706f 7274 6564 2061  or unsupported a
+00025830: 7272 6f77 206c 6f63 6174 696f 6e22 290a  rrow location").
+00025840: 0a0a 636c 6173 7320 4e69 6368 6f6c 734c  ..class NicholsL
+00025850: 696e 6553 6572 6965 7328 4172 726f 7773  ineSeries(Arrows
+00025860: 4d69 7869 6e2c 2043 6f6d 6d6f 6e55 6e69  Mixin, CommonUni
+00025870: 666f 726d 4576 616c 7561 7469 6f6e 2c20  formEvaluation, 
+00025880: 4c69 6e65 3244 4261 7365 5365 7269 6573  Line2DBaseSeries
+00025890: 293a 0a20 2020 2022 2222 5265 7072 6573  ):.    """Repres
+000258a0: 656e 7420 6120 4e69 6368 6f6c 7320 6c69  ent a Nichols li
+000258b0: 6e65 2069 6e20 636f 6e74 726f 6c20 7379  ne in control sy
+000258c0: 7374 656d 2070 6c6f 7474 696e 672e 0a20  stem plotting.. 
+000258d0: 2020 2022 2222 0a20 2020 205f 616c 6c6f     """.    _allo
+000258e0: 7765 645f 6b65 7973 203d 205b 2261 7272  wed_keys = ["arr
+000258f0: 6f77 7322 5d0a 0a20 2020 2064 6566 205f  ows"]..    def _
+00025900: 5f69 6e69 745f 5f28 0a20 2020 2020 2020  _init__(.       
+00025910: 2073 656c 662c 2074 662c 206f 6c5f 7068   self, tf, ol_ph
+00025920: 6173 652c 206f 6c5f 6d61 672c 2063 6c5f  ase, ol_mag, cl_
+00025930: 7068 6173 652c 2063 6c5f 6d61 672c 206f  phase, cl_mag, o
+00025940: 6d65 6761 5f72 616e 6765 2c0a 2020 2020  mega_range,.    
+00025950: 2020 2020 6c61 6265 6c3d 2222 2c20 2a2a      label="", **
+00025960: 6b77 6172 6773 0a20 2020 2029 3a0a 2020  kwargs.    ):.  
+00025970: 2020 2020 2020 7375 7065 7228 292e 5f5f        super().__
+00025980: 696e 6974 5f5f 282a 2a6b 7761 7267 7329  init__(**kwargs)
+00025990: 0a20 2020 2020 2020 2073 656c 662e 5f74  .        self._t
+000259a0: 6620 3d20 7466 0a20 2020 2020 2020 2073  f = tf.        s
+000259b0: 656c 662e 6578 7072 203d 2054 7570 6c65  elf.expr = Tuple
+000259c0: 286f 6c5f 7068 6173 652c 206f 6c5f 6d61  (ol_phase, ol_ma
+000259d0: 672c 2063 6c5f 7068 6173 652c 2063 6c5f  g, cl_phase, cl_
+000259e0: 6d61 6729 0a20 2020 2020 2020 2073 656c  mag).        sel
+000259f0: 662e 7261 6e67 6573 203d 205b 6f6d 6567  f.ranges = [omeg
+00025a00: 615f 7261 6e67 655d 0a20 2020 2020 2020  a_range].       
+00025a10: 2073 656c 662e 6c61 6265 6c20 3d20 6c61   self.label = la
+00025a20: 6265 6c0a 2020 2020 2020 2020 7365 6c66  bel.        self
+00025a30: 2e5f 666f 7263 655f 7265 616c 5f65 7661  ._force_real_eva
+00025a40: 6c20 3d20 5472 7565 0a0a 2020 2020 6465  l = True..    de
+00025a50: 6620 5f5f 7374 725f 5f28 7365 6c66 293a  f __str__(self):
+00025a60: 0a20 2020 2020 2020 2072 6574 7572 6e20  .        return 
+00025a70: 7365 6c66 2e5f 7374 725f 6865 6c70 6572  self._str_helper
+00025a80: 2822 6e69 6368 6f6c 7320 6c69 6e65 206f  ("nichols line o
+00025a90: 6620 2573 2220 2520 7365 6c66 2e5f 7466  f %s" % self._tf
+00025aa0: 290a 0a20 2020 2064 6566 2067 6574 5f64  )..    def get_d
+00025ab0: 6174 6128 7365 6c66 293a 0a20 2020 2020  ata(self):.     
+00025ac0: 2020 2022 2222 0a20 2020 2020 2020 2052     """.        R
+00025ad0: 6574 7572 6e73 0a20 2020 2020 2020 203d  eturns.        =
+00025ae0: 3d3d 3d3d 3d3d 0a20 2020 2020 2020 206f  ======.        o
+00025af0: 6d65 6761 203a 206e 702e 6e64 6172 7261  mega : np.ndarra
+00025b00: 790a 2020 2020 2020 2020 6f6c 5f70 6861  y.        ol_pha
+00025b10: 7365 203a 206e 702e 6e64 6172 7261 790a  se : np.ndarray.
+00025b20: 2020 2020 2020 2020 6f6c 5f6d 6167 203a          ol_mag :
+00025b30: 206e 702e 6e64 6172 7261 790a 2020 2020   np.ndarray.    
+00025b40: 2020 2020 636c 5f70 6861 7365 203a 206e      cl_phase : n
+00025b50: 702e 6e64 6172 7261 790a 2020 2020 2020  p.ndarray.      
+00025b60: 2020 636c 5f6d 6167 203a 206e 702e 6e64    cl_mag : np.nd
+00025b70: 6172 7261 790a 2020 2020 2020 2020 2222  array.        ""
+00025b80: 220a 2020 2020 2020 2020 6e70 203d 2069  ".        np = i
+00025b90: 6d70 6f72 745f 6d6f 6475 6c65 2827 6e75  mport_module('nu
+00025ba0: 6d70 7927 290a 0a20 2020 2020 2020 2072  mpy')..        r
+00025bb0: 6573 756c 7473 203d 2073 656c 662e 5f65  esults = self._e
+00025bc0: 7661 6c75 6174 6528 290a 2020 2020 2020  valuate().      
+00025bd0: 2020 666f 7220 692c 2072 2069 6e20 656e    for i, r in en
+00025be0: 756d 6572 6174 6528 7265 7375 6c74 7329  umerate(results)
+00025bf0: 3a0a 2020 2020 2020 2020 2020 2020 5f72  :.            _r
+00025c00: 652c 205f 696d 203d 206e 702e 7265 616c  e, _im = np.real
+00025c10: 2872 292c 206e 702e 696d 6167 2872 290a  (r), np.imag(r).
+00025c20: 2020 2020 2020 2020 2020 2020 5f72 655b              _re[
+00025c30: 6e70 2e69 6e76 6572 7428 6e70 2e69 7363  np.invert(np.isc
+00025c40: 6c6f 7365 285f 696d 2c20 6e70 2e7a 6572  lose(_im, np.zer
+00025c50: 6f73 5f6c 696b 6528 5f69 6d29 2929 5d20  os_like(_im)))] 
+00025c60: 3d20 6e70 2e6e 616e 0a20 2020 2020 2020  = np.nan.       
+00025c70: 2020 2020 2072 6573 756c 7473 5b69 5d20       results[i] 
+00025c80: 3d20 5f72 650a 0a20 2020 2020 2020 206f  = _re..        o
+00025c90: 6d65 6761 2c20 6f6c 5f70 6861 7365 2c20  mega, ol_phase, 
+00025ca0: 6f6c 5f6d 6167 2c20 636c 5f70 6861 7365  ol_mag, cl_phase
+00025cb0: 2c20 636c 5f6d 6167 203d 2072 6573 756c  , cl_mag = resul
+00025cc0: 7473 0a20 2020 2020 2020 206f 6c5f 6d61  ts.        ol_ma
+00025cd0: 6720 3d20 3230 202a 206e 702e 6c6f 6731  g = 20 * np.log1
+00025ce0: 3028 6f6c 5f6d 6167 290a 2020 2020 2020  0(ol_mag).      
+00025cf0: 2020 6f6c 5f70 6861 7365 203d 206e 702e    ol_phase = np.
+00025d00: 6465 6772 6565 7328 756e 7772 6170 286f  degrees(unwrap(o
+00025d10: 6c5f 7068 6173 6529 290a 2020 2020 2020  l_phase)).      
+00025d20: 2020 636c 5f6d 6167 203d 2032 3020 2a20    cl_mag = 20 * 
+00025d30: 6e70 2e6c 6f67 3130 2863 6c5f 6d61 6729  np.log10(cl_mag)
+00025d40: 0a20 2020 2020 2020 2023 2054 4f44 4f3a  .        # TODO:
+00025d50: 2069 6620 7468 6520 6e69 6368 6f6c 7320   if the nichols 
+00025d60: 6c69 6e65 2070 6173 7365 7320 7468 726f  line passes thro
+00025d70: 7567 6820 7468 6520 706f 696e 7420 282d  ugh the point (-
+00025d80: 3138 3020 6465 672c 2030 2064 4229 0a20  180 deg, 0 dB). 
+00025d90: 2020 2020 2020 2023 2028 696e 206f 7065         # (in ope
+00025da0: 6e20 6c6f 6f70 292c 2074 6865 6e20 7468  n loop), then th
+00025db0: 6520 7265 7375 6c74 696e 6720 636c 6f73  e resulting clos
+00025dc0: 6564 2d6c 6f6f 7020 7068 6173 6520 6973  ed-loop phase is
+00025dd0: 2077 726f 6e67 2e20 5768 793f 0a20 2020   wrong. Why?.   
+00025de0: 2020 2020 2023 2046 6f72 2065 7861 6d70       # For examp
+00025df0: 6c65 2c20 7465 7374 2077 6974 6820 7468  le, test with th
+00025e00: 6973 2073 7973 7465 6d3a 0a20 2020 2020  is system:.     
+00025e10: 2020 2023 2074 6620 3d20 2835 202a 2028     # tf = (5 * (
+00025e20: 7320 2d20 3129 2920 2f20 2873 2a2a 3220  s - 1)) / (s**2 
+00025e30: 2a20 2873 2a2a 3220 2b20 7320 2b20 3429  * (s**2 + s + 4)
+00025e40: 290a 2020 2020 2020 2020 636c 5f70 6861  ).        cl_pha
+00025e50: 7365 203d 206e 702e 6465 6772 6565 7328  se = np.degrees(
+00025e60: 756e 7772 6170 2863 6c5f 7068 6173 6529  unwrap(cl_phase)
+00025e70: 290a 2020 2020 2020 2020 7265 7475 726e  ).        return
+00025e80: 206f 6d65 6761 2c20 6f6c 5f70 6861 7365   omega, ol_phase
+00025e90: 2c20 6f6c 5f6d 6167 2c20 636c 5f70 6861  , ol_mag, cl_pha
+00025ea0: 7365 2c20 636c 5f6d 6167 0a0a 0a63 6c61  se, cl_mag...cla
+00025eb0: 7373 2043 6f6e 7472 6f6c 4261 7365 5365  ss ControlBaseSe
+00025ec0: 7269 6573 284c 696e 6532 4442 6173 6553  ries(Line2DBaseS
+00025ed0: 6572 6965 7329 3a0a 2020 2020 2222 2241  eries):.    """A
+00025ee0: 2062 6173 6520 7365 7269 6573 2066 6f72   base series for
+00025ef0: 2063 6c61 7373 6573 2074 6861 7420 6172   classes that ar
+00025f00: 6520 676f 696e 6720 746f 2070 726f 6475  e going to produ
+00025f10: 6365 206e 756d 6572 6963 616c 0a20 2020  ce numerical.   
+00025f20: 2064 6174 6120 7573 696e 6720 7468 6520   data using the 
+00025f30: 6060 636f 6e74 726f 6c60 6020 6d6f 6475  ``control`` modu
+00025f40: 6c65 2066 6f72 2063 6f6e 7472 6f6c 2d73  le for control-s
+00025f50: 7973 7465 6d20 706c 6f74 7469 6e67 2e0a  ystem plotting..
+00025f60: 2020 2020 5468 6f73 6520 7365 7269 6573      Those series
+00025f70: 2072 6570 7265 7365 6e74 2061 2053 4953   represent a SIS
+00025f80: 4f20 7379 7374 656d 2e0a 2020 2020 2222  O system..    ""
+00025f90: 220a 0a20 2020 205f 616c 6c6f 7765 645f  "..    _allowed_
+00025fa0: 6b65 7973 203d 205b 2263 6f6e 7472 6f6c  keys = ["control
+00025fb0: 5f6b 7722 5d0a 0a20 2020 2064 6566 205f  _kw"]..    def _
+00025fc0: 5f69 6e69 745f 5f28 7365 6c66 2c20 2a61  _init__(self, *a
+00025fd0: 7267 732c 202a 2a6b 7761 7267 7329 3a0a  rgs, **kwargs):.
+00025fe0: 2020 2020 2020 2020 7375 7065 7228 292e          super().
+00025ff0: 5f5f 696e 6974 5f5f 282a 2a6b 7761 7267  __init__(**kwarg
+00026000: 7329 0a20 2020 2020 2020 2054 7261 6e73  s).        Trans
+00026010: 6665 7246 756e 6374 696f 6e20 3d20 7379  ferFunction = sy
+00026020: 6d70 792e 7068 7973 6963 732e 636f 6e74  mpy.physics.cont
+00026030: 726f 6c2e 6c74 692e 5472 616e 7366 6572  rol.lti.Transfer
+00026040: 4675 6e63 7469 6f6e 0a20 2020 2020 2020  Function.       
+00026050: 206e 7020 3d20 696d 706f 7274 5f6d 6f64   np = import_mod
+00026060: 756c 6528 276e 756d 7079 2729 0a20 2020  ule('numpy').   
+00026070: 2020 2020 2073 7020 3d20 696d 706f 7274       sp = import
+00026080: 5f6d 6f64 756c 6528 2773 6369 7079 2729  _module('scipy')
+00026090: 0a20 2020 2020 2020 2063 7420 3d20 696d  .        ct = im
+000260a0: 706f 7274 5f6d 6f64 756c 6528 2763 6f6e  port_module('con
+000260b0: 7472 6f6c 2729 0a20 2020 2020 2020 206c  trol').        l
+000260c0: 6162 656c 203d 206b 7761 7267 732e 6765  abel = kwargs.ge
+000260d0: 7428 226c 6162 656c 222c 2022 2229 0a20  t("label", ""). 
+000260e0: 2020 2020 2020 2074 6620 3d20 6172 6773         tf = args
+000260f0: 5b30 5d0a 0a20 2020 2020 2020 2069 6620  [0]..        if 
+00026100: 6973 696e 7374 616e 6365 2874 662c 2028  isinstance(tf, (
+00026110: 4578 7072 2c20 5472 616e 7366 6572 4675  Expr, TransferFu
+00026120: 6e63 7469 6f6e 2929 3a0a 2020 2020 2020  nction)):.      
+00026130: 2020 2020 2020 6966 2069 7369 6e73 7461        if isinsta
+00026140: 6e63 6528 7466 2c20 4578 7072 293a 0a20  nce(tf, Expr):. 
+00026150: 2020 2020 2020 2020 2020 2020 2020 2070                 p
+00026160: 6172 616d 735f 6673 203d 2073 6574 2873  arams_fs = set(s
+00026170: 656c 662e 7061 7261 6d73 2e6b 6579 7328  elf.params.keys(
+00026180: 2929 0a20 2020 2020 2020 2020 2020 2020  )).             
+00026190: 2020 2066 7320 3d20 7466 2e66 7265 655f     fs = tf.free_
+000261a0: 7379 6d62 6f6c 732e 6469 6666 6572 656e  symbols.differen
+000261b0: 6365 2870 6172 616d 735f 6673 290a 2020  ce(params_fs).  
+000261c0: 2020 2020 2020 2020 2020 2020 2020 6673                fs
+000261d0: 203d 2066 732e 706f 7028 2920 6966 206c   = fs.pop() if l
+000261e0: 656e 2866 7329 203e 2030 2065 6c73 6520  en(fs) > 0 else 
+000261f0: 7379 6d62 6f6c 7328 2273 2229 0a20 2020  symbols("s").   
+00026200: 2020 2020 2020 2020 2020 2020 2074 6620               tf 
+00026210: 3d20 5472 616e 7366 6572 4675 6e63 7469  = TransferFuncti
+00026220: 6f6e 2e66 726f 6d5f 7261 7469 6f6e 616c  on.from_rational
+00026230: 5f65 7870 7265 7373 696f 6e28 7466 2c20  _expression(tf, 
+00026240: 6673 290a 2020 2020 2020 2020 2020 2020  fs).            
+00026250: 7365 6c66 2e5f 6578 7072 203d 2074 660a  self._expr = tf.
+00026260: 2020 2020 2020 2020 2020 2020 7365 6c66              self
+00026270: 2e5f 636f 6e74 726f 6c5f 7466 203d 204e  ._control_tf = N
+00026280: 6f6e 650a 2020 2020 2020 2020 2020 2020  one.            
+00026290: 6966 206e 6f74 2073 656c 662e 6973 5f69  if not self.is_i
+000262a0: 6e74 6572 6163 7469 7665 3a0a 2020 2020  nteractive:.    
+000262b0: 2020 2020 2020 2020 2020 2020 7365 6c66              self
+000262c0: 2e5f 636f 6e74 726f 6c5f 7466 203d 2074  ._control_tf = t
+000262d0: 665f 746f 5f63 6f6e 7472 6f6c 2874 6629  f_to_control(tf)
+000262e0: 0a20 2020 2020 2020 2020 2020 2073 656c  .            sel
+000262f0: 662e 5f6c 6162 656c 203d 2073 7472 2873  f._label = str(s
+00026300: 656c 662e 6578 7072 2920 6966 206c 6162  elf.expr) if lab
+00026310: 656c 2069 7320 4e6f 6e65 2065 6c73 6520  el is None else 
+00026320: 6c61 6265 6c0a 2020 2020 2020 2020 2020  label.          
+00026330: 2020 7365 6c66 2e5f 6c61 7465 785f 6c61    self._latex_la
+00026340: 6265 6c20 3d20 6c61 7465 7828 7365 6c66  bel = latex(self
+00026350: 2e65 7870 7229 2069 6620 6c61 6265 6c20  .expr) if label 
+00026360: 6973 204e 6f6e 6520 656c 7365 206c 6162  is None else lab
+00026370: 656c 0a20 2020 2020 2020 2065 6c69 6620  el.        elif 
+00026380: 6973 696e 7374 616e 6365 2874 662c 2028  isinstance(tf, (
+00026390: 7370 2e73 6967 6e61 6c2e 5472 616e 7366  sp.signal.Transf
+000263a0: 6572 4675 6e63 7469 6f6e 2c20 6374 2e54  erFunction, ct.T
+000263b0: 7261 6e73 6665 7246 756e 6374 696f 6e29  ransferFunction)
+000263c0: 293a 0a20 2020 2020 2020 2020 2020 2073  ):.            s
+000263d0: 656c 662e 5f65 7870 7220 3d20 4e6f 6e65  elf._expr = None
+000263e0: 0a20 2020 2020 2020 2020 2020 2073 656c  .            sel
+000263f0: 662e 5f6c 6162 656c 203d 206c 6162 656c  f._label = label
+00026400: 0a20 2020 2020 2020 2020 2020 2073 656c  .            sel
+00026410: 662e 5f6c 6174 6578 5f6c 6162 656c 203d  f._latex_label =
+00026420: 206c 6162 656c 0a20 2020 2020 2020 2020   label.         
+00026430: 2020 2069 6620 6c61 6265 6c20 6973 204e     if label is N
+00026440: 6f6e 653a 0a20 2020 2020 2020 2020 2020  one:.           
+00026450: 2020 2020 2073 203d 2073 796d 626f 6c73       s = symbols
+00026460: 2822 7322 2069 6620 7466 2e64 7420 6973  ("s" if tf.dt is
+00026470: 204e 6f6e 6520 656c 7365 2022 7a22 290a   None else "z").
 00026480: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00026490: 2255 6e6b 6f77 6e20 7379 6d62 6f6c 7320  "Unkown symbols 
-000264a0: 666f 756e 6420 696e 2070 6c6f 7474 696e  found in plottin
-000264b0: 6720 7261 6e67 653a 2025 732e 2022 2025  g range: %s. " %
-000264c0: 2028 722c 2920 2b0a 2020 2020 2020 2020   (r,) +.        
-000264d0: 2020 2020 2020 2020 2020 2020 2241 7265              "Are
-000264e0: 2074 6865 2066 6f6c 6c6f 7769 6e67 2070   the following p
-000264f0: 6172 616d 6574 6572 733f 2025 7322 2025  arameters? %s" %
-00026500: 2072 656d 6169 6e69 6e67 5f66 7329 0a0a   remaining_fs)..
-00026510: 0a63 6c61 7373 204e 7971 7569 7374 4c69  .class NyquistLi
-00026520: 6e65 5365 7269 6573 2841 7272 6f77 734d  neSeries(ArrowsM
-00026530: 6978 696e 2c20 436f 6e74 726f 6c42 6173  ixin, ControlBas
-00026540: 6553 6572 6965 7329 3a0a 2020 2020 2222  eSeries):.    ""
-00026550: 2247 656e 6572 6174 6573 206e 756d 6572  "Generates numer
-00026560: 6963 616c 2064 6174 6120 666f 7220 4e79  ical data for Ny
-00026570: 7175 6973 7420 706c 6f74 2075 7369 6e67  quist plot using
-00026580: 2074 6865 2060 6063 6f6e 7472 6f6c 6060   the ``control``
-00026590: 0a20 2020 206d 6f64 756c 652e 0a20 2020  .    module..   
-000265a0: 2022 2222 0a0a 2020 2020 5f61 6c6c 6f77   """..    _allow
-000265b0: 6564 5f6b 6579 7320 3d20 5b0a 2020 2020  ed_keys = [.    
-000265c0: 2020 2020 2261 7272 6f77 7322 2c20 226d      "arrows", "m
-000265d0: 6178 5f63 7572 7665 5f6d 6167 6e69 7475  ax_curve_magnitu
-000265e0: 6465 222c 2022 6d61 785f 6375 7276 655f  de", "max_curve_
-000265f0: 6f66 6673 6574 222c 0a20 2020 2020 2020  offset",.       
-00026600: 2022 7374 6172 745f 6d61 726b 6572 222c   "start_marker",
-00026610: 2022 7072 696d 6172 795f 7374 796c 6522   "primary_style"
-00026620: 2c20 226d 6972 726f 725f 7374 796c 6522  , "mirror_style"
-00026630: 0a20 2020 205d 0a0a 2020 2020 6465 6620  .    ]..    def 
-00026640: 5f63 6f70 795f 6672 6f6d 5f64 6963 7428  _copy_from_dict(
-00026650: 7365 6c66 2c20 642c 206b 293a 0a20 2020  self, d, k):.   
-00026660: 2020 2020 2069 6620 6b20 696e 2064 2e6b       if k in d.k
-00026670: 6579 7328 293a 0a20 2020 2020 2020 2020  eys():.         
-00026680: 2020 2073 6574 6174 7472 2873 656c 662c     setattr(self,
-00026690: 206b 2c20 645b 6b5d 290a 0a20 2020 2064   k, d[k])..    d
-000266a0: 6566 205f 5f69 6e69 745f 5f28 7365 6c66  ef __init__(self
-000266b0: 2c20 7466 2c20 7661 725f 7374 6172 745f  , tf, var_start_
-000266c0: 656e 642c 206c 6162 656c 3d22 222c 202a  end, label="", *
-000266d0: 2a6b 7761 7267 7329 3a0a 2020 2020 2020  *kwargs):.      
-000266e0: 2020 7375 7065 7228 292e 5f5f 696e 6974    super().__init
-000266f0: 5f5f 2874 662c 206c 6162 656c 3d6c 6162  __(tf, label=lab
-00026700: 656c 2c20 2a2a 6b77 6172 6773 290a 2020  el, **kwargs).  
-00026710: 2020 2020 2020 7365 6c66 2e72 616e 6765        self.range
-00026720: 7320 3d20 5b76 6172 5f73 7461 7274 5f65  s = [var_start_e
-00026730: 6e64 5d0a 2020 2020 2020 2020 7365 6c66  nd].        self
-00026740: 2e5f 6368 6563 6b5f 6673 2829 0a0a 2020  ._check_fs()..  
-00026750: 2020 2020 2020 2320 7468 6573 6520 6174        # these at
-00026760: 7472 6962 7574 6573 2061 7265 2075 7365  tributes are use
-00026770: 6420 6279 2060 6063 6f6e 7472 6f6c 6060  d by ``control``
-00026780: 2069 6e20 7468 6520 7265 6e64 6572 696e   in the renderin
-00026790: 6720 7374 6570 2c0a 2020 2020 2020 2020  g step,.        
-000267a0: 2320 6e6f 7420 696e 2074 6865 2064 6174  # not in the dat
-000267b0: 6120 6765 6e65 7261 7469 6f6e 2073 7465  a generation ste
-000267c0: 702e 2049 206e 6565 6420 7468 656d 2068  p. I need them h
-000267d0: 6572 6520 696e 206f 7264 6572 2074 6f0a  ere in order to.
-000267e0: 2020 2020 2020 2020 2320 636f 6e74 726f          # contro
-000267f0: 6c20 7468 6520 7265 6e64 6572 696e 6720  l the rendering 
-00026800: 696e 2065 6163 6820 6261 636b 656e 642e  in each backend.
-00026810: 0a20 2020 2020 2020 2073 656c 662e 6d61  .        self.ma
-00026820: 785f 6375 7276 655f 6d61 676e 6974 7564  x_curve_magnitud
-00026830: 6520 3d20 6b77 6172 6773 2e67 6574 2822  e = kwargs.get("
-00026840: 6d61 785f 6375 7276 655f 6d61 676e 6974  max_curve_magnit
-00026850: 7564 6522 2c20 3230 290a 2020 2020 2020  ude", 20).      
-00026860: 2020 7365 6c66 2e6d 6178 5f63 7572 7665    self.max_curve
-00026870: 5f6f 6666 7365 7420 3d20 6b77 6172 6773  _offset = kwargs
-00026880: 2e67 6574 2822 6d61 785f 6375 7276 655f  .get("max_curve_
-00026890: 6f66 6673 6574 222c 2030 2e30 3229 0a20  offset", 0.02). 
-000268a0: 2020 2020 2020 2073 656c 662e 7374 6172         self.star
-000268b0: 745f 6d61 726b 6572 203d 206b 7761 7267  t_marker = kwarg
-000268c0: 732e 6765 7428 2273 7461 7274 5f6d 6172  s.get("start_mar
-000268d0: 6b65 7222 2c20 5472 7565 290a 2020 2020  ker", True).    
-000268e0: 2020 2020 7365 6c66 2e70 7269 6d61 7279      self.primary
-000268f0: 5f73 7479 6c65 203d 206b 7761 7267 732e  _style = kwargs.
-00026900: 6765 7428 2270 7269 6d61 7279 5f73 7479  get("primary_sty
-00026910: 6c65 222c 204e 6f6e 6529 0a20 2020 2020  le", None).     
-00026920: 2020 2073 656c 662e 6d69 7272 6f72 5f73     self.mirror_s
-00026930: 7479 6c65 203d 206b 7761 7267 732e 6765  tyle = kwargs.ge
-00026940: 7428 226d 6972 726f 725f 7374 796c 6522  t("mirror_style"
-00026950: 2c20 4e6f 6e65 290a 2020 2020 2020 2020  , None).        
-00026960: 666f 7220 6b20 696e 205b 2261 7272 6f77  for k in ["arrow
-00026970: 7322 2c20 226d 6178 5f63 7572 7665 5f6d  s", "max_curve_m
-00026980: 6167 6e69 7475 6465 222c 2022 6d61 785f  agnitude", "max_
-00026990: 6375 7276 655f 6f66 6673 6574 222c 0a20  curve_offset",. 
-000269a0: 2020 2020 2020 2020 2020 2022 7374 6172             "star
-000269b0: 745f 6d61 726b 6572 222c 2022 7072 696d  t_marker", "prim
-000269c0: 6172 795f 7374 796c 6522 2c20 226d 6972  ary_style", "mir
-000269d0: 726f 725f 7374 796c 6522 5d3a 0a20 2020  ror_style"]:.   
-000269e0: 2020 2020 2020 2020 2073 656c 662e 5f63           self._c
-000269f0: 6f70 795f 6672 6f6d 5f64 6963 7428 7365  opy_from_dict(se
-00026a00: 6c66 2e5f 636f 6e74 726f 6c5f 6b77 2c20  lf._control_kw, 
-00026a10: 6b29 0a0a 2020 2020 6465 6620 5f5f 7374  k)..    def __st
-00026a20: 725f 5f28 7365 6c66 293a 0a20 2020 2020  r__(self):.     
-00026a30: 2020 2072 6574 7572 6e20 7365 6c66 2e5f     return self._
-00026a40: 7374 725f 6865 6c70 6572 280a 2020 2020  str_helper(.    
-00026a50: 2020 2020 2020 2020 226e 7971 7569 7374          "nyquist
-00026a60: 206c 696e 6520 6f66 2025 7322 2025 2028   line of %s" % (
-00026a70: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00026a80: 2073 656c 662e 5f65 7870 7220 6966 2073   self._expr if s
-00026a90: 656c 662e 5f65 7870 7220 656c 7365 2073  elf._expr else s
-00026aa0: 656c 662e 5f63 6f6e 7472 6f6c 5f74 6629  elf._control_tf)
-00026ab0: 290a 0a20 2020 2064 6566 2067 6574 5f64  )..    def get_d
-00026ac0: 6174 6128 7365 6c66 293a 0a20 2020 2020  ata(self):.     
-00026ad0: 2020 2022 2222 0a20 2020 2020 2020 2052     """.        R
-00026ae0: 6574 7572 6e73 0a20 2020 2020 2020 203d  eturns.        =
-00026af0: 3d3d 3d3d 3d3d 0a20 2020 2020 2020 2078  ======.        x
-00026b00: 5f72 6567 2c20 795f 7265 6720 3a20 6e70  _reg, y_reg : np
-00026b10: 2e6e 6461 7272 6179 0a20 2020 2020 2020  .ndarray.       
-00026b20: 2078 5f73 636c 2c20 795f 7363 6c20 3a20   x_scl, y_scl : 
-00026b30: 6e70 2e6e 6461 7272 6179 0a20 2020 2020  np.ndarray.     
-00026b40: 2020 2078 5f69 6e76 312c 2079 5f69 6e76     x_inv1, y_inv
-00026b50: 3120 3a20 6e70 2e6e 6461 7272 6179 0a20  1 : np.ndarray. 
-00026b60: 2020 2020 2020 2078 5f69 6e76 322c 2079         x_inv2, y
-00026b70: 5f69 6e76 3220 3a20 6e70 2e6e 6461 7272  _inv2 : np.ndarr
-00026b80: 6179 0a20 2020 2020 2020 2063 7572 7665  ay.        curve
-00026b90: 5f6f 6666 7365 7420 3a20 6e70 2e6e 6461  _offset : np.nda
-00026ba0: 7272 6179 0a20 2020 2020 2020 2022 2222  rray.        """
-00026bb0: 0a20 2020 2020 2020 206e 7020 3d20 696d  .        np = im
-00026bc0: 706f 7274 5f6d 6f64 756c 6528 226e 756d  port_module("num
-00026bd0: 7079 2229 0a20 2020 2020 2020 2063 7420  py").        ct 
-00026be0: 3d20 696d 706f 7274 5f6d 6f64 756c 6528  = import_module(
-00026bf0: 2263 6f6e 7472 6f6c 2229 0a20 2020 2020  "control").     
-00026c00: 2020 206d 6572 6765 6465 6570 203d 2069     mergedeep = i
-00026c10: 6d70 6f72 745f 6d6f 6475 6c65 2827 6d65  mport_module('me
-00026c20: 7267 6564 6565 7027 290a 0a20 2020 2020  rgedeep')..     
-00026c30: 2020 2069 6620 7365 6c66 2e69 735f 696e     if self.is_in
-00026c40: 7465 7261 6374 6976 653a 0a20 2020 2020  teractive:.     
-00026c50: 2020 2020 2020 2074 6620 3d20 7365 6c66         tf = self
-00026c60: 2e5f 6578 7072 2e73 7562 7328 7365 6c66  ._expr.subs(self
-00026c70: 2e70 6172 616d 7329 0a20 2020 2020 2020  .params).       
-00026c80: 2020 2020 2073 656c 662e 5f63 6f6e 7472       self._contr
-00026c90: 6f6c 5f74 6620 3d20 7466 5f74 6f5f 636f  ol_tf = tf_to_co
-00026ca0: 6e74 726f 6c28 7466 290a 0a20 2020 2020  ntrol(tf)..     
-00026cb0: 2020 2063 6f6e 7472 6f6c 5f6b 7720 3d20     control_kw = 
-00026cc0: 7b7d 0a20 2020 2020 2020 2073 796d 2c20  {}.        sym, 
-00026cd0: 7374 6172 742c 2065 6e64 203d 2073 656c  start, end = sel
-00026ce0: 662e 7261 6e67 6573 5b30 5d0a 2020 2020  f.ranges[0].    
-00026cf0: 2020 2020 6966 2028 7374 6172 7420 213d      if (start !=
-00026d00: 2065 6e64 2920 6f72 2073 656c 662e 5f69   end) or self._i
-00026d10: 6e74 6572 6163 7469 7665 5f72 616e 6765  nteractive_range
-00026d20: 733a 0a20 2020 2020 2020 2020 2020 2073  s:.            s
-00026d30: 7461 7274 203d 2073 656c 662e 5f75 7064  tart = self._upd
-00026d40: 6174 655f 7261 6e67 655f 7661 6c75 6528  ate_range_value(
-00026d50: 7374 6172 7429 2e72 6561 6c0a 2020 2020  start).real.    
-00026d60: 2020 2020 2020 2020 656e 6420 3d20 7365          end = se
-00026d70: 6c66 2e5f 7570 6461 7465 5f72 616e 6765  lf._update_range
-00026d80: 5f76 616c 7565 2865 6e64 292e 7265 616c  _value(end).real
-00026d90: 0a20 2020 2020 2020 2020 2020 2063 6f6e  .            con
-00026da0: 7472 6f6c 5f6b 775b 226f 6d65 6761 5f6c  trol_kw["omega_l
-00026db0: 696d 6974 7322 5d20 3d20 5b31 302a 2a73  imits"] = [10**s
-00026dc0: 7461 7274 2c20 3130 2a2a 656e 645d 0a0a  tart, 10**end]..
-00026dd0: 2020 2020 2020 2020 636b 7720 3d20 6d65          ckw = me
-00026de0: 7267 6564 6565 702e 6d65 7267 6528 7b7d  rgedeep.merge({}
-00026df0: 2c20 636f 6e74 726f 6c5f 6b77 2c20 7365  , control_kw, se
-00026e00: 6c66 2e5f 636f 6e74 726f 6c5f 6b77 290a  lf._control_kw).
-00026e10: 2020 2020 2020 2020 636b 775b 2270 6c6f          ckw["plo
-00026e20: 7422 5d20 3d20 4661 6c73 650a 2020 2020  t"] = False.    
-00026e30: 2020 2020 636b 775b 2272 6574 7572 6e5f      ckw["return_
-00026e40: 636f 6e74 6f75 7222 5d20 3d20 5472 7565  contour"] = True
-00026e50: 0a20 2020 2020 2020 205f 2c20 636f 6e74  .        _, cont
-00026e60: 6f75 7220 3d20 6374 2e6e 7971 7569 7374  our = ct.nyquist
-00026e70: 5f70 6c6f 7428 7365 6c66 2e5f 636f 6e74  _plot(self._cont
-00026e80: 726f 6c5f 7466 2c20 2a2a 636b 7729 0a0a  rol_tf, **ckw)..
-00026e90: 2020 2020 2020 2020 7265 7370 203d 2073          resp = s
-00026ea0: 656c 662e 5f63 6f6e 7472 6f6c 5f74 6628  elf._control_tf(
-00026eb0: 636f 6e74 6f75 7229 0a0a 2020 2020 2020  contour)..      
-00026ec0: 2020 230a 2020 2020 2020 2020 2320 4e4f    #.        # NO
-00026ed0: 5445 3a20 7468 6520 666f 6c6c 6f77 696e  TE: the followin
-00026ee0: 6720 6973 2061 6461 7074 6564 2066 726f  g is adapted fro
-00026ef0: 6d3a 0a20 2020 2020 2020 2023 2060 6063  m:.        # ``c
-00026f00: 6f6e 7472 6f6c 2e66 7265 7170 6c6f 742e  ontrol.freqplot.
-00026f10: 706c 6f74 5f6e 7971 7569 7374 2829 6060  plot_nyquist()``
-00026f20: 0a20 2020 2020 2020 2023 2042 6563 6175  .        # Becau
-00026f30: 7365 2074 6861 7420 6675 6e63 7469 6f6e  se that function
-00026f40: 2064 6f65 736e 2774 2072 6574 7572 6e20   doesn't return 
-00026f50: 6060 7370 6c61 6e65 5f63 6f6e 746f 7572  ``splane_contour
-00026f60: 6060 2061 6e64 2069 7420 6973 0a20 2020  `` and it is.   
-00026f70: 2020 2020 2023 2076 6572 7920 6469 6666       # very diff
-00026f80: 6963 756c 7420 746f 2072 6562 7569 6c64  icult to rebuild
-00026f90: 2069 742c 2049 2072 656d 6f76 6564 2069   it, I removed i
-00026fa0: 7420 6672 6f6d 2074 6865 2066 6f6c 6c6f  t from the follo
-00026fb0: 7769 6e67 2063 6f64 652e 0a20 2020 2020  wing code..     
-00026fc0: 2020 2023 2046 696e 6765 7220 6372 6f73     # Finger cros
-00026fd0: 7365 642e 0a20 2020 2020 2020 2023 0a0a  sed..        #..
-00026fe0: 2020 2020 2020 2020 6d61 785f 6375 7276          max_curv
-00026ff0: 655f 6d61 676e 6974 7564 6520 3d20 7365  e_magnitude = se
-00027000: 6c66 2e6d 6178 5f63 7572 7665 5f6d 6167  lf.max_curve_mag
-00027010: 6e69 7475 6465 0a20 2020 2020 2020 206d  nitude.        m
-00027020: 6178 5f63 7572 7665 5f6f 6666 7365 7420  ax_curve_offset 
-00027030: 3d20 7365 6c66 2e6d 6178 5f63 7572 7665  = self.max_curve
-00027040: 5f6f 6666 7365 740a 0a20 2020 2020 2020  _offset..       
-00027050: 2072 6567 5f6d 6173 6b20 3d20 6e70 2e61   reg_mask = np.a
-00027060: 6273 2872 6573 7029 203e 206d 6178 5f63  bs(resp) > max_c
-00027070: 7572 7665 5f6d 6167 6e69 7475 6465 0a0a  urve_magnitude..
-00027080: 2020 2020 2020 2020 7363 616c 655f 6d61          scale_ma
-00027090: 736b 203d 207e 7265 675f 6d61 736b 205c  sk = ~reg_mask \
-000270a0: 0a20 2020 2020 2020 2020 2020 2026 206e  .            & n
-000270b0: 702e 636f 6e63 6174 656e 6174 6528 287e  p.concatenate((~
-000270c0: 7265 675f 6d61 736b 5b31 3a5d 2c20 7e72  reg_mask[1:], ~r
-000270d0: 6567 5f6d 6173 6b5b 2d31 3a5d 2929 205c  eg_mask[-1:])) \
-000270e0: 0a20 2020 2020 2020 2020 2020 2026 206e  .            & n
-000270f0: 702e 636f 6e63 6174 656e 6174 6528 287e  p.concatenate((~
-00027100: 7265 675f 6d61 736b 5b30 3a31 5d2c 207e  reg_mask[0:1], ~
-00027110: 7265 675f 6d61 736b 5b3a 2d31 5d29 290a  reg_mask[:-1])).
-00027120: 0a20 2020 2020 2020 2023 2052 6573 6361  .        # Resca
-00027130: 6c65 2074 6865 2070 6f69 6e74 7320 7769  le the points wi
-00027140: 7468 206c 6172 6765 206d 6167 6e69 7475  th large magnitu
-00027150: 6465 0a20 2020 2020 2020 2072 6573 6361  de.        resca
-00027160: 6c65 203d 206e 702e 6c6f 6769 6361 6c5f  le = np.logical_
-00027170: 616e 6428 0a20 2020 2020 2020 2020 2020  and(.           
-00027180: 2072 6567 5f6d 6173 6b2c 2061 6273 2872   reg_mask, abs(r
-00027190: 6573 7029 203e 206d 6178 5f63 7572 7665  esp) > max_curve
-000271a0: 5f6d 6167 6e69 7475 6465 290a 2020 2020  _magnitude).    
-000271b0: 2020 2020 7265 7370 5b72 6573 6361 6c65      resp[rescale
-000271c0: 5d20 2a3d 206d 6178 5f63 7572 7665 5f6d  ] *= max_curve_m
-000271d0: 6167 6e69 7475 6465 202f 2061 6273 2872  agnitude / abs(r
-000271e0: 6573 705b 7265 7363 616c 655d 290a 0a20  esp[rescale]).. 
-000271f0: 2020 2020 2020 2023 2050 6c6f 7420 7468         # Plot th
-00027200: 6520 7265 6775 6c61 7220 706f 7274 696f  e regular portio
-00027210: 6e73 206f 6620 7468 6520 6375 7276 6520  ns of the curve 
-00027220: 2861 6e64 2067 7261 6220 7468 6520 636f  (and grab the co
-00027230: 6c6f 7229 0a20 2020 2020 2020 2078 5f72  lor).        x_r
-00027240: 6567 203d 206e 702e 6d61 2e6d 6173 6b65  eg = np.ma.maske
-00027250: 645f 7768 6572 6528 7265 675f 6d61 736b  d_where(reg_mask
-00027260: 2c20 7265 7370 2e72 6561 6c29 0a20 2020  , resp.real).   
-00027270: 2020 2020 2079 5f72 6567 203d 206e 702e       y_reg = np.
-00027280: 6d61 2e6d 6173 6b65 645f 7768 6572 6528  ma.masked_where(
-00027290: 7265 675f 6d61 736b 2c20 7265 7370 2e69  reg_mask, resp.i
-000272a0: 6d61 6729 0a0a 2020 2020 2020 2020 2320  mag)..        # 
-000272b0: 4669 6775 7265 206f 7574 2068 6f77 206d  Figure out how m
-000272c0: 7563 6820 746f 206f 6666 7365 7420 7468  uch to offset th
-000272d0: 6520 6375 7276 653a 2074 6865 206f 6666  e curve: the off
-000272e0: 7365 7420 676f 6573 2066 726f 6d0a 2020  set goes from.  
-000272f0: 2020 2020 2020 2320 7a65 726f 2061 7420        # zero at 
-00027300: 7468 6520 7374 6172 7420 6f66 2074 6865  the start of the
-00027310: 2073 6361 6c65 6420 7365 6374 696f 6e20   scaled section 
-00027320: 746f 206d 6178 5f63 7572 7665 5f6f 6666  to max_curve_off
-00027330: 7365 7420 6173 0a20 2020 2020 2020 2023  set as.        #
-00027340: 2077 6520 6d6f 7665 2061 6c6f 6e67 2074   we move along t
-00027350: 6865 2063 7572 7665 0a20 2020 2020 2020  he curve.       
-00027360: 2063 7572 7665 5f6f 6666 7365 7420 3d20   curve_offset = 
-00027370: 7365 6c66 2e5f 636f 6d70 7574 655f 6375  self._compute_cu
-00027380: 7276 655f 6f66 6673 6574 280a 2020 2020  rve_offset(.    
-00027390: 2020 2020 2020 2020 7265 7370 2c20 7363          resp, sc
-000273a0: 616c 655f 6d61 736b 2c20 6d61 785f 6375  ale_mask, max_cu
-000273b0: 7276 655f 6f66 6673 6574 290a 0a20 2020  rve_offset)..   
-000273c0: 2020 2020 2023 2050 6c6f 7420 7468 6520       # Plot the 
-000273d0: 7363 616c 6564 2073 6563 7469 6f6e 7320  scaled sections 
-000273e0: 6f66 2074 6865 2063 7572 7665 2028 6368  of the curve (ch
-000273f0: 616e 6769 6e67 206c 696e 6573 7479 6c65  anging linestyle
-00027400: 290a 2020 2020 2020 2020 785f 7363 6c20  ).        x_scl 
-00027410: 3d20 6e70 2e6d 612e 6d61 736b 6564 5f77  = np.ma.masked_w
-00027420: 6865 7265 2873 6361 6c65 5f6d 6173 6b2c  here(scale_mask,
-00027430: 2072 6573 702e 7265 616c 290a 2020 2020   resp.real).    
-00027440: 2020 2020 795f 7363 6c20 3d20 6e70 2e6d      y_scl = np.m
-00027450: 612e 6d61 736b 6564 5f77 6865 7265 2873  a.masked_where(s
-00027460: 6361 6c65 5f6d 6173 6b2c 2072 6573 702e  cale_mask, resp.
-00027470: 696d 6167 290a 0a20 2020 2020 2020 2023  imag)..        #
-00027480: 2074 6865 2070 7269 6d61 7279 2063 7572   the primary cur
-00027490: 7665 2028 696e 7669 7369 626c 6529 2066  ve (invisible) f
-000274a0: 6f72 2073 6574 7469 6e67 2061 7272 6f77  or setting arrow
-000274b0: 730a 2020 2020 2020 2020 785f 696e 7631  s.        x_inv1
-000274c0: 2c20 795f 696e 7631 203d 2072 6573 702e  , y_inv1 = resp.
-000274d0: 7265 616c 2e63 6f70 7928 292c 2072 6573  real.copy(), res
-000274e0: 702e 696d 6167 2e63 6f70 7928 290a 2020  p.imag.copy().  
-000274f0: 2020 2020 2020 785f 696e 7631 5b72 6567        x_inv1[reg
-00027500: 5f6d 6173 6b5d 202a 3d20 2831 202b 2063  _mask] *= (1 + c
-00027510: 7572 7665 5f6f 6666 7365 745b 7265 675f  urve_offset[reg_
-00027520: 6d61 736b 5d29 0a20 2020 2020 2020 2079  mask]).        y
-00027530: 5f69 6e76 315b 7265 675f 6d61 736b 5d20  _inv1[reg_mask] 
-00027540: 2a3d 2028 3120 2b20 6375 7276 655f 6f66  *= (1 + curve_of
-00027550: 6673 6574 5b72 6567 5f6d 6173 6b5d 290a  fset[reg_mask]).
-00027560: 0a20 2020 2020 2020 2023 2041 6464 2074  .        # Add t
-00027570: 6865 2061 7272 6f77 7320 746f 2074 6865  he arrows to the
-00027580: 206d 6972 726f 7220 696d 6167 6520 286f   mirror image (o
-00027590: 6e20 746f 7020 6f66 2061 6e20 696e 7669  n top of an invi
-000275a0: 7369 626c 6520 636f 6e74 6f75 7229 0a20  sible contour). 
-000275b0: 2020 2020 2020 2078 5f69 6e76 322c 2079         x_inv2, y
-000275c0: 5f69 6e76 3220 3d20 7265 7370 2e72 6561  _inv2 = resp.rea
-000275d0: 6c2e 636f 7079 2829 2c20 7265 7370 2e69  l.copy(), resp.i
-000275e0: 6d61 672e 636f 7079 2829 0a20 2020 2020  mag.copy().     
-000275f0: 2020 2078 5f69 6e76 325b 7265 675f 6d61     x_inv2[reg_ma
-00027600: 736b 5d20 2a3d 2028 3120 2d20 6375 7276  sk] *= (1 - curv
-00027610: 655f 6f66 6673 6574 5b72 6567 5f6d 6173  e_offset[reg_mas
-00027620: 6b5d 290a 2020 2020 2020 2020 795f 696e  k]).        y_in
-00027630: 7632 5b72 6567 5f6d 6173 6b5d 202a 3d20  v2[reg_mask] *= 
-00027640: 2831 202d 2063 7572 7665 5f6f 6666 7365  (1 - curve_offse
-00027650: 745b 7265 675f 6d61 736b 5d29 0a0a 2020  t[reg_mask])..  
-00027660: 2020 2020 2020 7265 7475 726e 2078 5f72        return x_r
-00027670: 6567 2c20 795f 7265 672c 2078 5f73 636c  eg, y_reg, x_scl
-00027680: 2c20 795f 7363 6c2c 2078 5f69 6e76 312c  , y_scl, x_inv1,
-00027690: 2079 5f69 6e76 312c 2078 5f69 6e76 322c   y_inv1, x_inv2,
-000276a0: 2079 5f69 6e76 322c 2063 7572 7665 5f6f   y_inv2, curve_o
-000276b0: 6666 7365 740a 0a20 2020 2040 7374 6174  ffset..    @stat
-000276c0: 6963 6d65 7468 6f64 0a20 2020 2064 6566  icmethod.    def
-000276d0: 205f 636f 6d70 7574 655f 6375 7276 655f   _compute_curve_
-000276e0: 6f66 6673 6574 2872 6573 702c 206d 6173  offset(resp, mas
-000276f0: 6b2c 206d 6178 5f6f 6666 7365 7429 3a0a  k, max_offset):.
-00027700: 2020 2020 2020 2020 2222 220a 2020 2020          """.    
-00027710: 2020 2020 2020 2020 4675 6e63 7469 6f6e          Function
-00027720: 2074 6f20 636f 6d70 7574 6520 4e79 7175   to compute Nyqu
-00027730: 6973 7420 6375 7276 6520 6f66 6673 6574  ist curve offset
-00027740: 730a 0a20 2020 2020 2020 2054 6869 7320  s..        This 
-00027750: 6675 6e63 7469 6f6e 2063 6f6d 7075 7465  function compute
-00027760: 7320 6120 736d 6f6f 7468 6c79 2076 6172  s a smoothly var
-00027770: 7969 6e67 206f 6666 7365 7420 7468 6174  ying offset that
-00027780: 2073 7461 7274 7320 616e 6420 656e 6473   starts and ends
-00027790: 2061 740a 2020 2020 2020 2020 7a65 726f   at.        zero
-000277a0: 2061 7420 7468 6520 656e 6473 206f 6620   at the ends of 
-000277b0: 6120 7363 616c 6564 2073 6567 6d65 6e74  a scaled segment
-000277c0: 2e0a 0a20 2020 2020 2020 2054 6869 7320  ...        This 
-000277d0: 6675 6e63 7469 6f6e 2063 6f6d 6573 2066  function comes f
-000277e0: 726f 6d20 6060 636f 6e74 726f 6c2f 6672  rom ``control/fr
-000277f0: 6571 706c 6f74 2e70 7960 602e 0a20 2020  eqplot.py``..   
-00027800: 2020 2020 2022 2222 0a20 2020 2020 2020       """.       
-00027810: 206e 7020 3d20 696d 706f 7274 5f6d 6f64   np = import_mod
-00027820: 756c 6528 226e 756d 7079 2229 0a0a 2020  ule("numpy")..  
-00027830: 2020 2020 2020 2320 436f 6d70 7574 6520        # Compute 
-00027840: 7468 6520 6172 6320 6c65 6e67 7468 2061  the arc length a
-00027850: 6c6f 6e67 2074 6865 2063 7572 7665 0a20  long the curve. 
-00027860: 2020 2020 2020 2073 5f63 7572 7665 203d         s_curve =
-00027870: 206e 702e 6375 6d73 756d 280a 2020 2020   np.cumsum(.    
-00027880: 2020 2020 2020 2020 6e70 2e73 7172 7428          np.sqrt(
-00027890: 6e70 2e64 6966 6628 7265 7370 2e72 6561  np.diff(resp.rea
-000278a0: 6c29 202a 2a20 3220 2b20 6e70 2e64 6966  l) ** 2 + np.dif
-000278b0: 6628 7265 7370 2e69 6d61 6729 202a 2a20  f(resp.imag) ** 
-000278c0: 3229 290a 0a20 2020 2020 2020 2023 2049  2))..        # I
-000278d0: 6e69 7469 616c 697a 6520 7468 6520 6f66  nitialize the of
-000278e0: 6673 6574 0a20 2020 2020 2020 206f 6666  fset.        off
-000278f0: 7365 7420 3d20 6e70 2e7a 6572 6f73 2872  set = np.zeros(r
-00027900: 6573 702e 7369 7a65 290a 2020 2020 2020  esp.size).      
-00027910: 2020 6172 636c 656e 203d 206e 702e 7a65    arclen = np.ze
-00027920: 726f 7328 7265 7370 2e73 697a 6529 0a0a  ros(resp.size)..
-00027930: 2020 2020 2020 2020 2320 5761 6c6b 2074          # Walk t
-00027940: 6872 6f75 6768 2074 6865 2072 6573 706f  hrough the respo
-00027950: 6e73 6520 616e 6420 6b65 6570 2074 7261  nse and keep tra
-00027960: 636b 206f 6620 6561 6368 2063 6f6e 7469  ck of each conti
-00027970: 6e6f 7573 2063 6f6d 706f 6e65 6e74 0a20  nous component. 
-00027980: 2020 2020 2020 2069 2c20 6e73 6567 7320         i, nsegs 
-00027990: 3d20 302c 2030 0a20 2020 2020 2020 2077  = 0, 0.        w
-000279a0: 6869 6c65 2069 203c 2072 6573 702e 7369  hile i < resp.si
-000279b0: 7a65 3a0a 2020 2020 2020 2020 2020 2020  ze:.            
-000279c0: 2320 536b 6970 2074 6865 2072 6567 756c  # Skip the regul
-000279d0: 6172 2073 6567 6d65 6e74 0a20 2020 2020  ar segment.     
-000279e0: 2020 2020 2020 2077 6869 6c65 2069 203c         while i <
-000279f0: 2072 6573 702e 7369 7a65 2061 6e64 206d   resp.size and m
-00027a00: 6173 6b5b 695d 3a0a 2020 2020 2020 2020  ask[i]:.        
-00027a10: 2020 2020 2020 2020 6920 2b3d 2031 2020          i += 1  
-00027a20: 2020 2020 2020 2020 2020 2020 2320 496e              # In
-00027a30: 6372 656d 656e 7420 7468 6520 636f 756e  crement the coun
-00027a40: 7465 720a 2020 2020 2020 2020 2020 2020  ter.            
-00027a50: 2020 2020 6966 2069 203d 3d20 7265 7370      if i == resp
-00027a60: 2e73 697a 653a 0a20 2020 2020 2020 2020  .size:.         
-00027a70: 2020 2020 2020 2020 2020 2062 7265 616b             break
-00027a80: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00027a90: 2023 204b 6565 7020 7472 6163 6b20 6f66   # Keep track of
-00027aa0: 2074 6865 2061 7263 6c65 6e67 7468 0a20   the arclength. 
-00027ab0: 2020 2020 2020 2020 2020 2020 2020 2061                 a
-00027ac0: 7263 6c65 6e5b 695d 203d 2061 7263 6c65  rclen[i] = arcle
-00027ad0: 6e5b 692d 315d 202b 206e 702e 6162 7328  n[i-1] + np.abs(
-00027ae0: 7265 7370 5b69 5d20 2d20 7265 7370 5b69  resp[i] - resp[i
-00027af0: 2d31 5d29 0a0a 2020 2020 2020 2020 2020  -1])..          
-00027b00: 2020 6e73 6567 7320 2b3d 2030 2e35 0a20    nsegs += 0.5. 
-00027b10: 2020 2020 2020 2020 2020 2069 6620 6920             if i 
-00027b20: 3d3d 2072 6573 702e 7369 7a65 3a0a 2020  == resp.size:.  
-00027b30: 2020 2020 2020 2020 2020 2020 2020 6272                br
-00027b40: 6561 6b0a 0a20 2020 2020 2020 2020 2020  eak..           
-00027b50: 2023 2053 6176 6520 7468 6520 7374 6172   # Save the star
-00027b60: 7469 6e67 206f 6666 7365 7420 6f66 2074  ting offset of t
-00027b70: 6869 7320 7365 676d 656e 740a 2020 2020  his segment.    
-00027b80: 2020 2020 2020 2020 7365 675f 7374 6172          seg_star
-00027b90: 7420 3d20 690a 0a20 2020 2020 2020 2020  t = i..         
-00027ba0: 2020 2023 2057 616c 6b20 7468 726f 7567     # Walk throug
-00027bb0: 6820 7468 6520 7363 616c 6564 2073 6567  h the scaled seg
-00027bc0: 6d65 6e74 0a20 2020 2020 2020 2020 2020  ment.           
-00027bd0: 2077 6869 6c65 2069 203c 2072 6573 702e   while i < resp.
-00027be0: 7369 7a65 2061 6e64 206e 6f74 206d 6173  size and not mas
-00027bf0: 6b5b 695d 3a0a 2020 2020 2020 2020 2020  k[i]:.          
-00027c00: 2020 2020 2020 6920 2b3d 2031 0a20 2020        i += 1.   
-00027c10: 2020 2020 2020 2020 2020 2020 2069 6620               if 
-00027c20: 6920 3d3d 2072 6573 702e 7369 7a65 3a20  i == resp.size: 
-00027c30: 2023 2053 6565 2069 6620 7765 2061 7265   # See if we are
-00027c40: 2064 6f6e 6520 7769 7468 2074 6869 7320   done with this 
-00027c50: 7365 676d 656e 740a 2020 2020 2020 2020  segment.        
-00027c60: 2020 2020 2020 2020 2020 2020 6272 6561              brea
-00027c70: 6b0a 2020 2020 2020 2020 2020 2020 2020  k.              
-00027c80: 2020 2320 4b65 6570 2074 7261 636b 206f    # Keep track o
-00027c90: 6620 7468 6520 6172 636c 656e 6774 680a  f the arclength.
-00027ca0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00027cb0: 6172 636c 656e 5b69 5d20 3d20 6172 636c  arclen[i] = arcl
-00027cc0: 656e 5b69 2d31 5d20 2b20 6e70 2e61 6273  en[i-1] + np.abs
-00027cd0: 2872 6573 705b 695d 202d 2072 6573 705b  (resp[i] - resp[
-00027ce0: 692d 315d 290a 0a20 2020 2020 2020 2020  i-1])..         
-00027cf0: 2020 206e 7365 6773 202b 3d20 302e 350a     nsegs += 0.5.
-00027d00: 2020 2020 2020 2020 2020 2020 6966 2069              if i
-00027d10: 203d 3d20 7265 7370 2e73 697a 653a 0a20   == resp.size:. 
-00027d20: 2020 2020 2020 2020 2020 2020 2020 2062                 b
-00027d30: 7265 616b 0a0a 2020 2020 2020 2020 2020  reak..          
-00027d40: 2020 2320 5361 7665 2074 6865 2065 6e64    # Save the end
-00027d50: 696e 6720 6f66 6673 6574 206f 6620 7468  ing offset of th
-00027d60: 6973 2073 6567 6d65 6e74 0a20 2020 2020  is segment.     
-00027d70: 2020 2020 2020 2073 6567 5f65 6e64 203d         seg_end =
-00027d80: 2069 0a0a 2020 2020 2020 2020 2020 2020   i..            
-00027d90: 2320 4e6f 7720 636f 6d70 7574 6520 7468  # Now compute th
-00027da0: 6520 7363 616c 696e 6720 666f 7220 7468  e scaling for th
-00027db0: 6973 2073 6567 6d65 6e74 0a20 2020 2020  is segment.     
-00027dc0: 2020 2020 2020 2073 5f73 6567 6d65 6e74         s_segment
-00027dd0: 203d 2061 7263 6c65 6e5b 7365 675f 656e   = arclen[seg_en
-00027de0: 642d 315d 202d 2061 7263 6c65 6e5b 7365  d-1] - arclen[se
-00027df0: 675f 7374 6172 745d 0a20 2020 2020 2020  g_start].       
-00027e00: 2020 2020 206f 6666 7365 745b 7365 675f       offset[seg_
-00027e10: 7374 6172 743a 7365 675f 656e 645d 203d  start:seg_end] =
-00027e20: 206d 6178 5f6f 6666 7365 7420 2a20 735f   max_offset * s_
-00027e30: 7365 676d 656e 742f 735f 6375 7276 655b  segment/s_curve[
-00027e40: 2d31 5d20 2a20 5c0a 2020 2020 2020 2020  -1] * \.        
-00027e50: 2020 2020 2020 2020 6e70 2e73 696e 286e          np.sin(n
-00027e60: 702e 7069 202a 2028 6172 636c 656e 5b73  p.pi * (arclen[s
-00027e70: 6567 5f73 7461 7274 3a73 6567 5f65 6e64  eg_start:seg_end
-00027e80: 5d0a 2020 2020 2020 2020 2020 2020 2020  ].              
-00027e90: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00027ea0: 2020 2d20 6172 636c 656e 5b73 6567 5f73    - arclen[seg_s
-00027eb0: 7461 7274 5d29 2f73 5f73 6567 6d65 6e74  tart])/s_segment
-00027ec0: 290a 0a20 2020 2020 2020 2072 6574 7572  )..        retur
-00027ed0: 6e20 6f66 6673 6574 0a0a 0a63 6c61 7373  n offset...class
-00027ee0: 2052 6f6f 744c 6f63 7573 5365 7269 6573   RootLocusSeries
-00027ef0: 2843 6f6e 7472 6f6c 4261 7365 5365 7269  (ControlBaseSeri
-00027f00: 6573 293a 0a20 2020 2022 2222 4765 6e65  es):.    """Gene
-00027f10: 7261 7465 7320 6e75 6d65 7269 6361 6c20  rates numerical 
-00027f20: 6461 7461 2066 6f72 2072 6f6f 7420 6c6f  data for root lo
-00027f30: 6375 7320 706c 6f74 2075 7369 6e67 2074  cus plot using t
-00027f40: 6865 2060 6063 6f6e 7472 6f6c 6060 0a20  he ``control``. 
-00027f50: 2020 206d 6f64 756c 652e 0a0a 2020 2020     module...    
-00027f60: 5379 6d62 6f6c 6963 2065 7870 7265 7373  Symbolic express
-00027f70: 696f 6e73 206f 7220 5379 6d50 7927 7320  ions or SymPy's 
-00027f80: 7472 616e 7366 6572 2066 756e 6374 696f  transfer functio
-00027f90: 6e73 2061 7265 2063 6f6e 7665 7274 6564  ns are converted
-00027fa0: 2074 6f0a 2020 2020 6060 636f 6e74 726f   to.    ``contro
-00027fb0: 6c2e 5472 616e 7366 6572 4675 6e63 7469  l.TransferFuncti
-00027fc0: 6f6e 6060 2e20 4966 2061 2069 6e74 6572  on``. If a inter
-00027fd0: 6163 7469 7665 2d77 6964 6765 7420 706c  active-widget pl
-00027fe0: 6f74 2069 7320 6372 6561 7465 642c 0a20  ot is created,. 
-00027ff0: 2020 2061 7420 6561 6368 2077 6964 6765     at each widge
-00028000: 7427 7320 7374 6174 652d 6368 616e 6765  t's state-change
-00028010: 2074 6865 2075 7064 6174 6564 2073 796d   the updated sym
-00028020: 626f 6c69 6320 7472 616e 7366 6572 2066  bolic transfer f
-00028030: 756e 6374 696f 6e0a 2020 2020 7769 6c6c  unction.    will
-00028040: 2062 6520 636f 6e76 6572 7465 6420 746f   be converted to
-00028050: 2060 6063 6f6e 7472 6f6c 2e54 7261 6e73   ``control.Trans
-00028060: 6665 7246 756e 6374 696f 6e60 602e 0a0a  ferFunction``...
-00028070: 2020 2020 4974 2068 6173 2062 6565 6e20      It has been 
-00028080: 7368 6f77 6e20 7468 6174 206e 756d 7079  shown that numpy
-00028090: 2e72 6f6f 7473 2829 2070 726f 6475 6365  .roots() produce
-000280a0: 7320 696e 6163 6375 7261 7465 2072 6573  s inaccurate res
-000280b0: 756c 7473 2069 6e0a 2020 2020 636f 6d70  ults in.    comp
-000280c0: 6172 6973 6f6e 2074 6f20 7379 6d70 792e  arison to sympy.
-000280d0: 726f 6f74 7328 292e 2068 7474 7073 3a2f  roots(). https:/
-000280e0: 2f67 6974 6875 622e 636f 6d2f 7379 6d70  /github.com/symp
-000280f0: 792f 7379 6d70 792f 6973 7375 6573 2f32  y/sympy/issues/2
-00028100: 3532 3334 0a20 2020 2048 6f77 6576 6572  5234.    However
-00028110: 2c20 7765 2061 7265 2064 6561 6c69 6e67  , we are dealing
-00028120: 2077 6974 6820 6120 726f 6f74 206c 6f63   with a root loc
-00028130: 7573 2070 6c6f 742c 2077 6865 7265 2062  us plot, where b
-00028140: 7261 6e63 6865 7320 7374 6172 7420 6672  ranches start fr
-00028150: 6f6d 0a20 2020 2070 6f6c 6573 2061 6e64  om.    poles and
-00028160: 2067 6f65 7320 746f 207a 6572 6f73 2028   goes to zeros (
-00028170: 6f72 2074 6f20 696e 6669 6e69 7479 292e  or to infinity).
-00028180: 2048 656e 6365 2c20 7468 6573 6520 6572   Hence, these er
-00028190: 726f 7273 2061 7265 0a20 2020 206c 696b  rors are.    lik
-000281a0: 656c 7920 746f 2062 6520 6972 7265 6c65  ely to be irrele
-000281b0: 7661 6e74 206f 6e20 6120 7072 6163 7469  vant on a practi
-000281c0: 6361 6c20 6361 7365 2e20 5468 6973 2064  cal case. This d
-000281d0: 6174 6120 7365 7269 6573 2075 7365 730a  ata series uses.
-000281e0: 2020 2020 6060 636f 6e74 726f 6c60 6020      ``control`` 
-000281f0: 2868 656e 6365 206e 756d 7079 2920 666f  (hence numpy) fo
-00028200: 7220 7065 7266 6f72 6d61 6365 2e0a 0a20  r performace... 
-00028210: 2020 2052 6566 6572 656e 6365 730a 2020     References.  
-00028220: 2020 3d3d 3d3d 3d3d 3d3d 3d3d 0a0a 2020    ==========..  
-00028230: 2020 6874 7470 733a 2f2f 6769 7468 7562    https://github
-00028240: 2e63 6f6d 2f70 7974 686f 6e2d 636f 6e74  .com/python-cont
-00028250: 726f 6c2f 7079 7468 6f6e 2d63 6f6e 7472  rol/python-contr
-00028260: 6f6c 0a0a 2020 2020 2222 220a 0a20 2020  ol..    """..   
-00028270: 2064 6566 205f 5f69 6e69 745f 5f28 7365   def __init__(se
-00028280: 6c66 2c20 7466 2c20 6c61 6265 6c3d 2222  lf, tf, label=""
-00028290: 2c20 2a2a 6b77 6172 6773 293a 0a20 2020  , **kwargs):.   
-000282a0: 2020 2020 2073 7570 6572 2829 2e5f 5f69       super().__i
-000282b0: 6e69 745f 5f28 7466 2c20 6c61 6265 6c3d  nit__(tf, label=
-000282c0: 6c61 6265 6c2c 202a 2a6b 7761 7267 7329  label, **kwargs)
-000282d0: 0a20 2020 2020 2020 2073 656c 662e 5f63  .        self._c
-000282e0: 6865 636b 5f66 7328 290a 0a20 2020 2020  heck_fs()..     
-000282f0: 2020 2023 2063 6f6d 7075 7465 2061 7070     # compute app
-00028300: 726f 7072 6961 7465 2061 7869 7320 6c69  ropriate axis li
-00028310: 6d69 7473 2066 726f 6d20 7468 6520 7472  mits from the tr
-00028320: 616e 7366 6572 2066 756e 6374 696f 6e0a  ansfer function.
-00028330: 2020 2020 2020 2020 2320 6173 736f 6369          # associ
-00028340: 6174 6564 2074 6f20 7468 6973 2064 6174  ated to this dat
-00028350: 6120 7365 7269 6573 2e0a 2020 2020 2020  a series..      
-00028360: 2020 7365 6c66 2e5f 786c 696d 203d 204e    self._xlim = N
-00028370: 6f6e 650a 2020 2020 2020 2020 7365 6c66  one.        self
-00028380: 2e5f 796c 696d 203d 204e 6f6e 650a 2020  ._ylim = None.  
-00028390: 2020 2020 2020 2320 7a65 726f 7320 616e        # zeros an
-000283a0: 6420 706f 6c65 7320 6172 6520 6e65 6365  d poles are nece
-000283b0: 7373 6172 7920 696e 206f 7264 6572 2074  ssary in order t
-000283c0: 6f20 7368 6f77 2061 7070 726f 7072 6961  o show appropria
-000283d0: 7465 206d 6172 6b65 7273 2e0a 2020 2020  te markers..    
-000283e0: 2020 2020 7365 6c66 2e5f 7a65 726f 7320      self._zeros 
-000283f0: 3d20 4e6f 6e65 0a20 2020 2020 2020 2073  = None.        s
-00028400: 656c 662e 5f70 6f6c 6573 203d 204e 6f6e  elf._poles = Non
-00028410: 650a 0a20 2020 2020 2020 2073 656c 662e  e..        self.
-00028420: 5f63 6f6e 7472 6f6c 5f6b 775b 2270 6c6f  _control_kw["plo
-00028430: 7422 5d20 3d20 4661 6c73 650a 2020 2020  t"] = False.    
-00028440: 2020 2020 7365 6c66 2e5f 7a65 726f 735f      self._zeros_
-00028450: 726b 203d 206b 7761 7267 732e 6765 7428  rk = kwargs.get(
-00028460: 227a 6572 6f73 5f72 6b22 2c20 6469 6374  "zeros_rk", dict
-00028470: 2829 290a 2020 2020 2020 2020 7365 6c66  ()).        self
-00028480: 2e5f 706f 6c65 735f 726b 203d 206b 7761  ._poles_rk = kwa
-00028490: 7267 732e 6765 7428 2270 6f6c 6573 5f72  rgs.get("poles_r
-000284a0: 6b22 2c20 6469 6374 2829 290a 0a20 2020  k", dict())..   
-000284b0: 2064 6566 205f 5f73 7472 5f5f 2873 656c   def __str__(sel
-000284c0: 6629 3a0a 2020 2020 2020 2020 6578 7072  f):.        expr
-000284d0: 203d 2073 656c 662e 5f65 7870 7220 6966   = self._expr if
-000284e0: 2073 656c 662e 5f65 7870 7220 656c 7365   self._expr else
-000284f0: 2073 656c 662e 5f63 6f6e 7472 6f6c 5f74   self._control_t
-00028500: 660a 2020 2020 2020 2020 7265 7475 726e  f.        return
-00028510: 2022 726f 6f74 206c 6f63 7573 206f 6620   "root locus of 
-00028520: 2220 2b20 7374 7228 6578 7072 290a 0a20  " + str(expr).. 
-00028530: 2020 2064 6566 205f 636f 6d70 7574 655f     def _compute_
-00028540: 6178 6973 5f6c 696d 6974 7328 7365 6c66  axis_limits(self
-00028550: 2c20 726f 6f74 735f 6172 7261 7929 3a0a  , roots_array):.
-00028560: 2020 2020 2020 2020 2222 2241 7474 656d          """Attem
-00028570: 7074 2074 6f20 636f 6d70 7574 6520 6170  pt to compute ap
-00028580: 7072 6f70 7269 6174 6520 6178 6973 206c  propriate axis l
-00028590: 696d 6974 7320 736f 2074 6861 7420 7468  imits so that th
-000285a0: 6520 706c 6f74 0a20 2020 2020 2020 2076  e plot.        v
-000285b0: 6973 7561 6c69 7a65 7320 7468 6520 696d  isualizes the im
-000285c0: 706f 7274 616e 7420 7061 7274 7320 6f66  portant parts of
-000285d0: 2074 6865 2072 6f6f 7420 6c6f 6375 732e   the root locus.
-000285e0: 0a20 2020 2020 2020 2022 2222 0a20 2020  .        """.   
-000285f0: 2020 2020 206e 7020 3d20 696d 706f 7274       np = import
-00028600: 5f6d 6f64 756c 6528 226e 756d 7079 2229  _module("numpy")
-00028610: 0a0a 2020 2020 2020 2020 7466 203d 2073  ..        tf = s
-00028620: 656c 662e 5f63 6f6e 7472 6f6c 5f74 660a  elf._control_tf.
-00028630: 2020 2020 2020 2020 5f62 7020 3d20 7365          _bp = se
-00028640: 6c66 2e5f 6272 6561 6b5f 706f 696e 7473  lf._break_points
-00028650: 280a 2020 2020 2020 2020 2020 2020 6e70  (.            np
-00028660: 2e70 6f6c 7931 6428 7466 2e6e 756d 5b30  .poly1d(tf.num[0
-00028670: 5d5b 305d 292c 0a20 2020 2020 2020 2020  ][0]),.         
-00028680: 2020 206e 702e 706f 6c79 3164 2874 662e     np.poly1d(tf.
-00028690: 6465 6e5b 305d 5b30 5d29 0a20 2020 2020  den[0][0]).     
-000286a0: 2020 2029 5b31 5d0a 0a20 2020 2020 2020     )[1]..       
-000286b0: 2023 2072 6f6f 7420 6c6f 6375 7320 6272   # root locus br
-000286c0: 616e 6368 6573 2073 7461 7274 7320 6672  anches starts fr
-000286d0: 6f6d 2070 6f6c 6573 2061 6e64 2067 6f65  om poles and goe
-000286e0: 7320 746f 207a 6572 6f73 206f 720a 2020  s to zeros or.  
-000286f0: 2020 2020 2020 2320 696e 6669 6e69 7479        # infinity
-00028700: 2e20 4c6f 6f6b 2066 6f72 2074 6865 2062  . Look for the b
-00028710: 7261 6e63 6865 7320 7468 6174 2067 6f65  ranches that goe
-00028720: 7320 746f 207a 6572 6f73 2c20 6669 6e64  s to zeros, find
-00028730: 2074 6865 0a20 2020 2020 2020 2023 206d   the.        # m
-00028740: 6178 696d 756d 2069 6d61 6769 6e61 7279  aximum imaginary
-00028750: 2070 6172 742e 2054 6869 7320 7769 6c6c   part. This will
-00028760: 2062 6520 7573 6564 2074 6f20 636f 6d70   be used to comp
-00028770: 7574 6520 796c 696d 2e0a 2020 2020 2020  ute ylim..      
-00028780: 2020 6d61 785f 6865 6967 6874 7320 3d20    max_heights = 
-00028790: 5b5d 0a20 2020 2020 2020 2066 6f72 2070  [].        for p
-000287a0: 2069 6e20 7365 6c66 2e5f 706f 6c65 733a   in self._poles:
-000287b0: 0a20 2020 2020 2020 2020 2020 2066 6f72  .            for
-000287c0: 2063 2069 6e20 726f 6f74 735f 6172 7261   c in roots_arra
-000287d0: 792e 543a 0a20 2020 2020 2020 2020 2020  y.T:.           
-000287e0: 2020 2020 2069 6620 6162 7328 7020 2d20       if abs(p - 
-000287f0: 635b 305d 2920 3c20 3165 2d30 333a 0a20  c[0]) < 1e-03:. 
-00028800: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00028810: 2020 2069 6620 616e 7928 6162 7328 7a20     if any(abs(z 
-00028820: 2d20 635b 2d31 5d29 203c 2031 652d 3033  - c[-1]) < 1e-03
-00028830: 2066 6f72 207a 2069 6e20 7365 6c66 2e5f   for z in self._
-00028840: 7a65 726f 7329 3a0a 2020 2020 2020 2020  zeros):.        
-00028850: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00028860: 6920 3d20 6e70 2e61 7267 6d61 7828 6e70  i = np.argmax(np
-00028870: 2e61 6273 2863 2e69 6d61 6729 290a 2020  .abs(c.imag)).  
-00028880: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00028890: 2020 2020 2020 6d61 785f 6865 6967 6874        max_height
-000288a0: 732e 6170 7065 6e64 2863 5b69 5d29 0a20  s.append(c[i]). 
-000288b0: 2020 2020 2020 206d 696e 5f68 6569 6768         min_heigh
-000288c0: 7473 203d 205b 2d74 2066 6f72 2074 2069  ts = [-t for t i
-000288d0: 6e20 6d61 785f 6865 6967 6874 735d 0a0a  n max_heights]..
-000288e0: 2020 2020 2020 2020 6465 6620 5f68 656c          def _hel
-000288f0: 7065 7228 782c 206d 6172 6769 6e5f 6661  per(x, margin_fa
-00028900: 6374 6f72 5f6c 6f77 6572 2c20 6d61 7267  ctor_lower, marg
-00028910: 696e 5f66 6163 746f 725f 7570 7065 7229  in_factor_upper)
-00028920: 3a0a 2020 2020 2020 2020 2020 2020 6d69  :.            mi
-00028930: 6e5f 782c 206d 6178 5f78 203d 206e 702e  n_x, max_x = np.
-00028940: 6e61 6e6d 696e 2878 292c 206e 702e 6e61  nanmin(x), np.na
-00028950: 6e6d 6178 2878 290a 2020 2020 2020 2020  nmax(x).        
-00028960: 2020 2020 2320 7468 6973 206f 6666 7365      # this offse
-00028970: 7420 616c 6c6f 7773 2074 6f20 6861 7665  t allows to have
-00028980: 2061 206c 6974 746c 6520 6269 7420 6f66   a little bit of
-00028990: 2065 6d70 7479 2073 7061 6365 206f 6e20   empty space on 
-000289a0: 7468 650a 2020 2020 2020 2020 2020 2020  the.            
-000289b0: 2320 4c48 5020 6f66 2072 6f6f 7420 6c6f  # LHP of root lo
-000289c0: 6375 7320 706c 6f74 0a20 2020 2020 2020  cus plot.       
-000289d0: 2020 2020 206f 6666 7365 7420 3d20 302e       offset = 0.
-000289e0: 3235 0a20 2020 2020 2020 2020 2020 206d  25.            m
-000289f0: 696e 5f78 203d 206d 696e 5f78 202d 206f  in_x = min_x - o
-00028a00: 6666 7365 7420 6966 206e 702e 6973 636c  ffset if np.iscl
-00028a10: 6f73 6528 6d69 6e5f 782c 2030 2920 656c  ose(min_x, 0) el
-00028a20: 7365 206d 696e 5f78 0a20 2020 2020 2020  se min_x.       
-00028a30: 2020 2020 206d 6178 5f78 203d 206d 6178       max_x = max
-00028a40: 5f78 202b 206f 6666 7365 7420 6966 206e  _x + offset if n
-00028a50: 702e 6973 636c 6f73 6528 6d61 785f 782c  p.isclose(max_x,
-00028a60: 2030 2920 656c 7365 206d 6178 5f78 0a20   0) else max_x. 
-00028a70: 2020 2020 2020 2020 2020 2023 2070 726f             # pro
-00028a80: 7669 6465 2061 206c 6974 746c 6520 6269  vide a little bi
-00028a90: 7420 6f66 206d 6172 6769 6e0a 2020 2020  t of margin.    
-00028aa0: 2020 2020 2020 2020 6465 6c74 6120 3d20          delta = 
-00028ab0: 6162 7328 6d61 785f 7820 2d20 6d69 6e5f  abs(max_x - min_
-00028ac0: 7829 0a20 2020 2020 2020 2020 2020 206c  x).            l
-00028ad0: 696d 203d 205b 6d69 6e5f 7820 2d20 6465  im = [min_x - de
-00028ae0: 6c74 6120 2a20 6d61 7267 696e 5f66 6163  lta * margin_fac
-00028af0: 746f 725f 6c6f 7765 722c 206d 6178 5f78  tor_lower, max_x
-00028b00: 202b 2064 656c 7461 202a 206d 6172 6769   + delta * margi
-00028b10: 6e5f 6661 6374 6f72 5f75 7070 6572 5d0a  n_factor_upper].
-00028b20: 2020 2020 2020 2020 2020 2020 6966 206e              if n
-00028b30: 702e 6973 636c 6f73 6528 2a6c 696d 293a  p.isclose(*lim):
-00028b40: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00028b50: 2023 2070 7265 7665 6e74 2061 7869 7320   # prevent axis 
-00028b60: 6c69 6d69 7473 2074 6f20 6265 2074 6865  limits to be the
-00028b70: 2073 616d 650a 2020 2020 2020 2020 2020   same.          
-00028b80: 2020 2020 2020 6c69 6d5b 305d 202d 3d20        lim[0] -= 
-00028b90: 310a 2020 2020 2020 2020 2020 2020 2020  1.              
-00028ba0: 2020 6c69 6d5b 315d 202b 3d20 310a 2020    lim[1] += 1.  
-00028bb0: 2020 2020 2020 2020 2020 7265 7475 726e            return
-00028bc0: 206c 696d 0a0a 2020 2020 2020 2020 696d   lim..        im
-00028bd0: 706f 7274 616e 745f 706f 696e 7473 203d  portant_points =
-00028be0: 206e 702e 636f 6e63 6174 656e 6174 6528   np.concatenate(
-00028bf0: 0a20 2020 2020 2020 2020 2020 205b 7365  .            [se
-00028c00: 6c66 2e5f 7a65 726f 732c 2073 656c 662e  lf._zeros, self.
-00028c10: 5f70 6f6c 6573 2c20 5f62 702c 206d 6178  _poles, _bp, max
-00028c20: 5f68 6569 6768 7473 2c20 6d69 6e5f 6865  _heights, min_he
-00028c30: 6967 6874 735d 290a 2020 2020 2020 2020  ights]).        
-00028c40: 7365 6c66 2e5f 786c 696d 203d 205f 6865  self._xlim = _he
-00028c50: 6c70 6572 2869 6d70 6f72 7461 6e74 5f70  lper(important_p
-00028c60: 6f69 6e74 732e 7265 616c 2c20 302e 3135  oints.real, 0.15
-00028c70: 2c20 302e 3035 290a 2020 2020 2020 2020  , 0.05).        
-00028c80: 7365 6c66 2e5f 796c 696d 203d 205f 6865  self._ylim = _he
-00028c90: 6c70 6572 2869 6d70 6f72 7461 6e74 5f70  lper(important_p
-00028ca0: 6f69 6e74 732e 696d 6167 2c20 302e 3035  oints.imag, 0.05
-00028cb0: 2c20 302e 3035 290a 0a20 2020 2040 7072  , 0.05)..    @pr
-00028cc0: 6f70 6572 7479 0a20 2020 2064 6566 207a  operty.    def z
-00028cd0: 6572 6f73 2873 656c 6629 3a0a 2020 2020  eros(self):.    
-00028ce0: 2020 2020 6966 2073 656c 662e 5f7a 6572      if self._zer
-00028cf0: 6f73 2069 7320 4e6f 6e65 3a0a 2020 2020  os is None:.    
-00028d00: 2020 2020 2020 2020 7365 6c66 2e67 6574          self.get
-00028d10: 5f64 6174 6128 290a 2020 2020 2020 2020  _data().        
-00028d20: 7265 7475 726e 2073 656c 662e 5f7a 6572  return self._zer
-00028d30: 6f73 0a0a 2020 2020 4070 726f 7065 7274  os..    @propert
-00028d40: 790a 2020 2020 6465 6620 706f 6c65 7328  y.    def poles(
-00028d50: 7365 6c66 293a 0a20 2020 2020 2020 2069  self):.        i
-00028d60: 6620 7365 6c66 2e5f 706f 6c65 7320 6973  f self._poles is
-00028d70: 204e 6f6e 653a 0a20 2020 2020 2020 2020   None:.         
-00028d80: 2020 2073 656c 662e 6765 745f 6461 7461     self.get_data
-00028d90: 2829 0a20 2020 2020 2020 2072 6574 7572  ().        retur
-00028da0: 6e20 7365 6c66 2e5f 706f 6c65 730a 0a20  n self._poles.. 
-00028db0: 2020 2040 7072 6f70 6572 7479 0a20 2020     @property.   
-00028dc0: 2064 6566 2078 6c69 6d28 7365 6c66 293a   def xlim(self):
-00028dd0: 0a20 2020 2020 2020 2072 6574 7572 6e20  .        return 
-00028de0: 7365 6c66 2e5f 786c 696d 0a0a 2020 2020  self._xlim..    
-00028df0: 4070 726f 7065 7274 790a 2020 2020 6465  @property.    de
-00028e00: 6620 796c 696d 2873 656c 6629 3a0a 2020  f ylim(self):.  
-00028e10: 2020 2020 2020 7265 7475 726e 2073 656c        return sel
-00028e20: 662e 5f79 6c69 6d0a 0a20 2020 2064 6566  f._ylim..    def
-00028e30: 205f 6272 6561 6b5f 706f 696e 7473 2873   _break_points(s
-00028e40: 656c 662c 206e 756d 2c20 6465 6e29 3a0a  elf, num, den):.
-00028e50: 2020 2020 2020 2020 2222 2245 7874 7261          """Extra
-00028e60: 6374 2062 7265 616b 2070 6f69 6e74 7320  ct break points 
-00028e70: 6f76 6572 2072 6561 6c20 6178 6973 2061  over real axis a
-00028e80: 6e64 2067 6169 6e73 2067 6976 656e 2074  nd gains given t
-00028e90: 6865 7365 206c 6f63 6174 696f 6e73 2222  hese locations""
-00028ea0: 220a 2020 2020 2020 2020 2320 7479 7065  ".        # type
-00028eb0: 3a20 286e 702e 706f 6c79 3164 2c20 6e70  : (np.poly1d, np
-00028ec0: 2e70 6f6c 7931 6429 202d 3e20 286e 702e  .poly1d) -> (np.
-00028ed0: 6172 7261 792c 206e 702e 6172 7261 7929  array, np.array)
-00028ee0: 0a20 2020 2020 2020 2064 6e75 6d20 3d20  .        dnum = 
-00028ef0: 6e75 6d2e 6465 7269 7628 6d3d 3129 0a20  num.deriv(m=1). 
-00028f00: 2020 2020 2020 2064 6465 6e20 3d20 6465         dden = de
-00028f10: 6e2e 6465 7269 7628 6d3d 3129 0a20 2020  n.deriv(m=1).   
-00028f20: 2020 2020 2070 6f6c 796e 6f6d 203d 2064       polynom = d
-00028f30: 656e 202a 2064 6e75 6d20 2d20 6e75 6d20  en * dnum - num 
-00028f40: 2a20 6464 656e 0a20 2020 2020 2020 2072  * dden.        r
-00028f50: 6561 6c5f 6272 6561 6b5f 7074 7320 3d20  eal_break_pts = 
-00028f60: 706f 6c79 6e6f 6d2e 720a 2020 2020 2020  polynom.r.      
-00028f70: 2020 2320 646f 6e27 7420 6361 7265 2061    # don't care a
-00028f80: 626f 7574 2069 6e66 696e 6974 6520 6272  bout infinite br
-00028f90: 6561 6b20 706f 696e 7473 0a20 2020 2020  eak points.     
-00028fa0: 2020 2072 6561 6c5f 6272 6561 6b5f 7074     real_break_pt
-00028fb0: 7320 3d20 7265 616c 5f62 7265 616b 5f70  s = real_break_p
-00028fc0: 7473 5b6e 756d 2872 6561 6c5f 6272 6561  ts[num(real_brea
-00028fd0: 6b5f 7074 7329 2021 3d20 305d 0a20 2020  k_pts) != 0].   
-00028fe0: 2020 2020 206b 5f62 7265 616b 203d 202d       k_break = -
-00028ff0: 6465 6e28 7265 616c 5f62 7265 616b 5f70  den(real_break_p
-00029000: 7473 2920 2f20 6e75 6d28 7265 616c 5f62  ts) / num(real_b
-00029010: 7265 616b 5f70 7473 290a 2020 2020 2020  reak_pts).      
-00029020: 2020 6964 7820 3d20 6b5f 6272 6561 6b20    idx = k_break 
-00029030: 3e3d 2069 6e74 2830 2920 2020 2320 6f6e  >= int(0)   # on
-00029040: 6c79 2070 6f73 6974 6976 6573 2067 6169  ly positives gai
-00029050: 6e73 0a20 2020 2020 2020 206b 5f62 7265  ns.        k_bre
-00029060: 616b 203d 206b 5f62 7265 616b 5b69 6478  ak = k_break[idx
-00029070: 5d0a 2020 2020 2020 2020 7265 616c 5f62  ].        real_b
-00029080: 7265 616b 5f70 7473 203d 2072 6561 6c5f  reak_pts = real_
-00029090: 6272 6561 6b5f 7074 735b 6964 785d 0a20  break_pts[idx]. 
-000290a0: 2020 2020 2020 2069 6620 6c65 6e28 6b5f         if len(k_
-000290b0: 6272 6561 6b29 203d 3d20 303a 0a20 2020  break) == 0:.   
-000290c0: 2020 2020 2020 2020 206b 5f62 7265 616b           k_break
-000290d0: 203d 205b 305d 0a20 2020 2020 2020 2020   = [0].         
-000290e0: 2020 2072 6561 6c5f 6272 6561 6b5f 7074     real_break_pt
-000290f0: 7320 3d20 6465 6e2e 726f 6f74 730a 2020  s = den.roots.  
-00029100: 2020 2020 2020 7265 7475 726e 206b 5f62        return k_b
-00029110: 7265 616b 2c20 7265 616c 5f62 7265 616b  reak, real_break
-00029120: 5f70 7473 0a0a 2020 2020 6465 6620 6765  _pts..    def ge
-00029130: 745f 6461 7461 2873 656c 6629 3a0a 2020  t_data(self):.  
-00029140: 2020 2020 2020 2222 220a 2020 2020 2020        """.      
-00029150: 2020 5265 7475 726e 730a 2020 2020 2020    Returns.      
-00029160: 2020 3d3d 3d3d 3d3d 3d0a 2020 2020 2020    =======.      
-00029170: 2020 726f 6f74 7320 3a20 6e64 6172 7261    roots : ndarra
-00029180: 790a 2020 2020 2020 2020 2020 2020 436c  y.            Cl
-00029190: 6f73 6564 2d6c 6f6f 7020 726f 6f74 206c  osed-loop root l
-000291a0: 6f63 6174 696f 6e73 2c20 6172 7261 6e67  ocations, arrang
-000291b0: 6564 2069 6e20 7768 6963 6820 6561 6368  ed in which each
-000291c0: 2072 6f77 2063 6f72 7265 7370 6f6e 6473   row corresponds
-000291d0: 0a20 2020 2020 2020 2020 2020 2074 6f20  .            to 
-000291e0: 6120 6761 696e 2069 6e20 6761 696e 730a  a gain in gains.
-000291f0: 2020 2020 2020 2020 6761 696e 7320 3a20          gains : 
-00029200: 6e64 6172 7261 790a 2020 2020 2020 2020  ndarray.        
-00029210: 2020 2020 4761 696e 7320 7573 6564 2e20      Gains used. 
-00029220: 2053 616d 6520 6173 206b 7665 6374 206b   Same as kvect k
-00029230: 6579 776f 7264 2061 7267 756d 656e 7420  eyword argument 
-00029240: 6966 2070 726f 7669 6465 642e 0a20 2020  if provided..   
-00029250: 2020 2020 2022 2222 0a20 2020 2020 2020       """.       
-00029260: 2069 6620 7365 6c66 2e69 735f 696e 7465   if self.is_inte
-00029270: 7261 6374 6976 653a 0a20 2020 2020 2020  ractive:.       
-00029280: 2020 2020 2074 6620 3d20 7365 6c66 2e5f       tf = self._
-00029290: 6578 7072 2e73 7562 7328 7365 6c66 2e70  expr.subs(self.p
-000292a0: 6172 616d 7329 0a20 2020 2020 2020 2020  arams).         
-000292b0: 2020 2073 656c 662e 5f63 6f6e 7472 6f6c     self._control
-000292c0: 5f74 6620 3d20 7466 5f74 6f5f 636f 6e74  _tf = tf_to_cont
-000292d0: 726f 6c28 7466 290a 0a20 2020 2020 2020  rol(tf)..       
-000292e0: 2063 7420 3d20 696d 706f 7274 5f6d 6f64   ct = import_mod
-000292f0: 756c 6528 2263 6f6e 7472 6f6c 2229 0a20  ule("control"). 
-00029300: 2020 2020 2020 2073 656c 662e 5f7a 6572         self._zer
-00029310: 6f73 203d 2073 656c 662e 5f63 6f6e 7472  os = self._contr
-00029320: 6f6c 5f74 662e 7a65 726f 7328 290a 2020  ol_tf.zeros().  
-00029330: 2020 2020 2020 7365 6c66 2e5f 706f 6c65        self._pole
-00029340: 7320 3d20 7365 6c66 2e5f 636f 6e74 726f  s = self._contro
-00029350: 6c5f 7466 2e70 6f6c 6573 2829 0a20 2020  l_tf.poles().   
-00029360: 2020 2020 2072 6f6f 7473 5f61 7272 6179       roots_array
-00029370: 2c20 6761 696e 7320 3d20 6374 2e72 6f6f  , gains = ct.roo
-00029380: 745f 6c6f 6375 7328 7365 6c66 2e5f 636f  t_locus(self._co
-00029390: 6e74 726f 6c5f 7466 2c20 2a2a 7365 6c66  ntrol_tf, **self
-000293a0: 2e5f 636f 6e74 726f 6c5f 6b77 290a 2020  ._control_kw).  
-000293b0: 2020 2020 2020 7365 6c66 2e5f 636f 6d70        self._comp
-000293c0: 7574 655f 6178 6973 5f6c 696d 6974 7328  ute_axis_limits(
-000293d0: 726f 6f74 735f 6172 7261 7929 0a20 2020  roots_array).   
-000293e0: 2020 2020 2072 6574 7572 6e20 726f 6f74       return root
-000293f0: 735f 6172 7261 792c 2067 6169 6e73 0a0a  s_array, gains..
-00029400: 0a63 6c61 7373 2053 7973 7465 6d52 6573  .class SystemRes
-00029410: 706f 6e73 6553 6572 6965 7328 436f 6e74  ponseSeries(Cont
-00029420: 726f 6c42 6173 6553 6572 6965 7329 3a0a  rolBaseSeries):.
-00029430: 2020 2020 2222 2252 6570 7265 7365 6e74      """Represent
-00029440: 2061 2073 7973 7465 6d20 7265 7370 6f6e   a system respon
-00029450: 7365 2063 6f6d 7075 7465 6420 7769 7468  se computed with
-00029460: 2074 6865 2060 6063 6f6e 7472 6f6c 6060   the ``control``
-00029470: 206d 6f64 756c 652e 0a0a 2020 2020 436f   module...    Co
-00029480: 6d70 7574 696e 6720 7468 6520 696e 7665  mputing the inve
-00029490: 7273 6520 6c61 706c 6163 6520 7472 616e  rse laplace tran
-000294a0: 7366 6f72 6d20 6f66 2061 2073 7973 7465  sform of a syste
-000294b0: 6d20 7769 7468 2053 796d 5079 2069 7320  m with SymPy is 
-000294c0: 6e6f 740a 2020 2020 7472 6976 6961 6c3a  not.    trivial:
-000294d0: 2073 6f6d 6574 696d 6573 2069 7420 776f   sometimes it wo
-000294e0: 726b 7320 6669 6e65 2c20 6f74 6865 7220  rks fine, other 
-000294f0: 7469 6d65 7320 6974 2070 726f 6475 6365  times it produce
-00029500: 7320 7772 6f6e 6720 7265 7375 6c74 732c  s wrong results,
-00029510: 0a20 2020 206f 7468 6572 2074 696d 6573  .    other times
-00029520: 2069 7420 6a75 7374 2063 6f6e 7375 6d65   it just consume
-00029530: 7320 746f 206d 7563 6820 6d65 6d6f 7279  s to much memory
-00029540: 2065 7665 6e20 666f 7220 7472 6976 6961   even for trivia
-00029550: 6c20 7472 616e 7366 6572 0a20 2020 2066  l transfer.    f
-00029560: 756e 6374 696f 6e73 2e20 5468 6973 2069  unctions. This i
-00029570: 7320 7472 7565 2066 6f72 2062 6f74 6820  s true for both 
-00029580: 7468 6520 7075 626c 6963 2060 6069 6e76  the public ``inv
-00029590: 6572 7365 5f6c 6170 6c61 6365 5f74 7261  erse_laplace_tra
-000295a0: 6e73 666f 726d 6060 0a20 2020 2061 7320  nsform``.    as 
-000295b0: 7765 6c6c 2061 7320 7468 6520 7072 6976  well as the priv
-000295c0: 6174 6520 6060 5f66 6173 745f 696e 7665  ate ``_fast_inve
-000295d0: 7273 655f 6c61 706c 6163 6560 6020 7573  rse_laplace`` us
-000295e0: 6564 2069 6e0a 2020 2020 6060 7370 622e  ed in.    ``spb.
-000295f0: 6772 6170 6869 6373 2e63 6f6e 7472 6f6c  graphics.control
-00029600: 6060 2e0a 0a20 2020 2049 6e20 6f72 6465  ``...    In orde
-00029610: 7220 746f 2061 6464 7265 7373 2074 6865  r to address the
-00029620: 7365 2069 7373 7565 732c 206c 6574 2773  se issues, let's
-00029630: 2065 7661 6c75 6174 6520 7468 6520 7379   evaluate the sy
-00029640: 7374 656d 2077 6974 6820 7468 650a 2020  stem with the.  
-00029650: 2020 6060 636f 6e74 726f 6c60 6020 6d6f    ``control`` mo
-00029660: 6475 6c65 2e20 5375 7265 2c20 6974 2072  dule. Sure, it r
-00029670: 656c 6965 7320 6f6e 206e 756d 6572 6963  elies on numeric
-00029680: 616c 2069 6e74 6567 7261 7469 6f6e 2c20  al integration, 
-00029690: 6865 6e63 6520 6572 726f 7273 2e0a 2020  hence errors..  
-000296a0: 2020 4275 742c 2061 7420 6c65 6173 7420    But, at least 
-000296b0: 6974 2064 6f65 736e 2774 2063 7261 7368  it doesn't crash
-000296c0: 2074 6865 206d 6163 6869 6e65 2061 6e64   the machine and
-000296d0: 2069 7420 6973 2072 656c 6961 626c 652e   it is reliable.
-000296e0: 0a20 2020 2022 2222 0a0a 2020 2020 6465  .    """..    de
-000296f0: 6620 5f5f 6e65 775f 5f28 636c 732c 202a  f __new__(cls, *
-00029700: 6172 6773 2c20 2a2a 6b77 6172 6773 293a  args, **kwargs):
-00029710: 0a20 2020 2020 2020 2063 6620 3d20 6b77  .        cf = kw
-00029720: 6172 6773 2e67 6574 2822 636f 6c6f 725f  args.get("color_
-00029730: 6675 6e63 222c 204e 6f6e 6529 0a20 2020  func", None).   
-00029740: 2020 2020 206c 6320 3d20 6b77 6172 6773       lc = kwargs
-00029750: 2e67 6574 2822 6c69 6e65 5f63 6f6c 6f72  .get("line_color
-00029760: 222c 204e 6f6e 6529 0a20 2020 2020 2020  ", None).       
-00029770: 2069 6620 2863 616c 6c61 626c 6528 6366   if (callable(cf
-00029780: 2920 6f72 2063 616c 6c61 626c 6528 6c63  ) or callable(lc
-00029790: 2920 6f72 2069 7369 6e73 7461 6e63 6528  ) or isinstance(
-000297a0: 6366 2c20 4578 7072 2929 3a0a 2020 2020  cf, Expr)):.    
-000297b0: 2020 2020 2020 2020 7265 7475 726e 2073          return s
-000297c0: 7570 6572 2829 2e5f 5f6e 6577 5f5f 2843  uper().__new__(C
-000297d0: 6f6c 6f72 6564 5379 7374 656d 5265 7370  oloredSystemResp
-000297e0: 6f6e 7365 5365 7269 6573 290a 2020 2020  onseSeries).    
-000297f0: 2020 2020 7265 7475 726e 206f 626a 6563      return objec
-00029800: 742e 5f5f 6e65 775f 5f28 636c 7329 0a0a  t.__new__(cls)..
-00029810: 2020 2020 6465 6620 5f5f 696e 6974 5f5f      def __init__
-00029820: 2873 656c 662c 2074 662c 2076 6172 5f73  (self, tf, var_s
-00029830: 7461 7274 5f65 6e64 2c20 6c61 6265 6c3d  tart_end, label=
-00029840: 2222 2c20 2a2a 6b77 6172 6773 293a 0a20  "", **kwargs):. 
-00029850: 2020 2020 2020 2073 7570 6572 2829 2e5f         super()._
-00029860: 5f69 6e69 745f 5f28 7466 2c20 6c61 6265  _init__(tf, labe
-00029870: 6c3d 6c61 6265 6c2c 202a 2a6b 7761 7267  l=label, **kwarg
-00029880: 7329 0a20 2020 2020 2020 2073 656c 662e  s).        self.
-00029890: 7261 6e67 6573 203d 205b 7661 725f 7374  ranges = [var_st
-000298a0: 6172 745f 656e 645d 0a20 2020 2020 2020  art_end].       
-000298b0: 2073 656c 662e 5f63 6865 636b 5f66 7328   self._check_fs(
-000298c0: 290a 2020 2020 2020 2020 2320 6469 7363  ).        # disc
-000298d0: 7265 7469 7a65 2074 6865 2064 6f6d 6169  retize the domai
-000298e0: 6e20 7573 696e 6720 6f6e 6c79 2069 6e74  n using only int
-000298f0: 6567 6572 206e 756d 6265 7273 0a20 2020  eger numbers.   
-00029900: 2020 2020 2073 656c 662e 6f6e 6c79 5f69       self.only_i
-00029910: 6e74 6567 6572 7320 3d20 6b77 6172 6773  ntegers = kwargs
-00029920: 2e67 6574 2822 6f6e 6c79 5f69 6e74 6567  .get("only_integ
-00029930: 6572 7322 2c20 4661 6c73 6529 0a0a 2020  ers", False)..  
-00029940: 2020 2020 2020 7274 203d 206b 7761 7267        rt = kwarg
-00029950: 732e 6765 7428 2272 6573 706f 6e73 655f  s.get("response_
-00029960: 7479 7065 222c 2022 7374 6570 2229 0a20  type", "step"). 
-00029970: 2020 2020 2020 2072 7420 3d20 7274 2e6c         rt = rt.l
-00029980: 6f77 6572 2829 2069 6620 6973 696e 7374  ower() if isinst
-00029990: 616e 6365 2872 742c 2073 7472 2920 656c  ance(rt, str) el
-000299a0: 7365 2072 740a 2020 2020 2020 2020 616c  se rt.        al
-000299b0: 6c6f 7765 645f 7265 7370 6f6e 7365 5f74  lowed_response_t
-000299c0: 7970 6573 203d 205b 2269 6d70 756c 7365  ypes = ["impulse
-000299d0: 222c 2022 7374 6570 222c 2022 7261 6d70  ", "step", "ramp
-000299e0: 225d 0a20 2020 2020 2020 2069 6620 286e  "].        if (n
-000299f0: 6f74 2069 7369 6e73 7461 6e63 6528 7274  ot isinstance(rt
-00029a00: 2c20 7374 7229 2920 6f72 2028 7274 206e  , str)) or (rt n
-00029a10: 6f74 2069 6e20 616c 6c6f 7765 645f 7265  ot in allowed_re
-00029a20: 7370 6f6e 7365 5f74 7970 6573 293a 0a20  sponse_types):. 
-00029a30: 2020 2020 2020 2020 2020 2072 6169 7365             raise
-00029a40: 2056 616c 7565 4572 726f 7228 0a20 2020   ValueError(.   
-00029a50: 2020 2020 2020 2020 2020 2020 2022 6060               "``
-00029a60: 7265 7370 6f6e 7365 5f74 7970 6560 6020  response_type`` 
-00029a70: 6d75 7374 2062 6520 6f6e 6520 6f66 2074  must be one of t
-00029a80: 6865 2066 6f6c 6c6f 7769 6e67 3a20 2573  he following: %s
-00029a90: 5c6e 220a 2020 2020 2020 2020 2020 2020  \n".            
-00029aa0: 2020 2020 2252 6563 6569 7665 643a 2025      "Received: %
-00029ab0: 7322 2025 2028 7274 2c20 616c 6c6f 7765  s" % (rt, allowe
-00029ac0: 645f 7265 7370 6f6e 7365 5f74 7970 6573  d_response_types
-00029ad0: 290a 2020 2020 2020 2020 2020 2020 290a  ).            ).
-00029ae0: 2020 2020 2020 2020 7365 6c66 2e5f 7265          self._re
-00029af0: 7370 6f6e 7365 5f74 7970 6520 3d20 7274  sponse_type = rt
-00029b00: 0a0a 2020 2020 2020 2020 7374 6570 7320  ..        steps 
-00029b10: 3d20 6b77 6172 6773 2e67 6574 2822 7374  = kwargs.get("st
-00029b20: 6570 7322 2c20 4e6f 6e65 290a 2020 2020  eps", None).    
-00029b30: 2020 2020 6966 2073 7465 7073 2069 7320      if steps is 
-00029b40: 4e6f 6e65 3a0a 2020 2020 2020 2020 2020  None:.          
-00029b50: 2020 6966 2073 656c 662e 5f65 7870 7220    if self._expr 
-00029b60: 6973 204e 6f6e 653a 0a20 2020 2020 2020  is None:.       
-00029b70: 2020 2020 2020 2020 2073 656c 662e 7374           self.st
-00029b80: 6570 7320 3d20 7365 6c66 2e5f 636f 6e74  eps = self._cont
-00029b90: 726f 6c5f 7466 2e69 7364 7469 6d65 2829  rol_tf.isdtime()
-00029ba0: 0a20 2020 2020 2020 2020 2020 2065 6c73  .            els
-00029bb0: 653a 0a20 2020 2020 2020 2020 2020 2020  e:.             
-00029bc0: 2020 2073 656c 662e 7374 6570 7320 3d20     self.steps = 
-00029bd0: 4661 6c73 650a 2020 2020 2020 2020 656c  False.        el
-00029be0: 7365 3a0a 2020 2020 2020 2020 2020 2020  se:.            
-00029bf0: 7365 6c66 2e73 7465 7073 203d 2073 7465  self.steps = ste
-00029c00: 7073 0a20 2020 2020 2020 2023 2074 696d  ps.        # tim
-00029c10: 6520 7661 6c75 6573 206f 7665 7220 7768  e values over wh
-00029c20: 6963 6820 7468 6520 6576 616c 7561 7469  ich the evaluati
-00029c30: 6f6e 2077 696c 6c20 6265 2070 6572 666f  on will be perfo
-00029c40: 726d 6564 0a20 2020 2020 2020 2073 656c  rmed.        sel
-00029c50: 662e 5f74 696d 655f 6172 7261 7920 3d20  f._time_array = 
-00029c60: 4e6f 6e65 0a0a 2020 2020 6465 6620 5f5f  None..    def __
-00029c70: 7374 725f 5f28 7365 6c66 293a 0a20 2020  str__(self):.   
-00029c80: 2020 2020 2072 6574 7572 6e20 7365 6c66       return self
-00029c90: 2e5f 7374 725f 6865 6c70 6572 280a 2020  ._str_helper(.  
-00029ca0: 2020 2020 2020 2020 2020 2225 7320 7265            "%s re
-00029cb0: 7370 6f6e 7365 206f 6620 2573 2220 2520  sponse of %s" % 
-00029cc0: 280a 2020 2020 2020 2020 2020 2020 2020  (.              
-00029cd0: 2020 7365 6c66 2e5f 7265 7370 6f6e 7365    self._response
-00029ce0: 5f74 7970 652c 0a20 2020 2020 2020 2020  _type,.         
-00029cf0: 2020 2020 2020 2073 656c 662e 5f65 7870         self._exp
-00029d00: 7220 6966 2073 656c 662e 5f65 7870 7220  r if self._expr 
-00029d10: 656c 7365 2073 656c 662e 5f63 6f6e 7472  else self._contr
-00029d20: 6f6c 5f74 6629 290a 0a20 2020 2064 6566  ol_tf))..    def
-00029d30: 205f 6765 745f 6461 7461 5f68 656c 7065   _get_data_helpe
-00029d40: 7228 7365 6c66 293a 0a20 2020 2020 2020  r(self):.       
-00029d50: 2063 7420 3d20 696d 706f 7274 5f6d 6f64   ct = import_mod
-00029d60: 756c 6528 2263 6f6e 7472 6f6c 2229 0a20  ule("control"). 
-00029d70: 2020 2020 2020 206e 7020 3d20 696d 706f         np = impo
-00029d80: 7274 5f6d 6f64 756c 6528 226e 756d 7079  rt_module("numpy
-00029d90: 2229 0a20 2020 2020 2020 206d 6572 6765  ").        merge
-00029da0: 6465 6570 203d 2069 6d70 6f72 745f 6d6f  deep = import_mo
-00029db0: 6475 6c65 2827 6d65 7267 6564 6565 7027  dule('mergedeep'
-00029dc0: 290a 0a20 2020 2020 2020 2069 6620 7365  )..        if se
-00029dd0: 6c66 2e69 735f 696e 7465 7261 6374 6976  lf.is_interactiv
-00029de0: 653a 0a20 2020 2020 2020 2020 2020 2074  e:.            t
-00029df0: 6620 3d20 7365 6c66 2e5f 6578 7072 2e73  f = self._expr.s
-00029e00: 7562 7328 7365 6c66 2e70 6172 616d 7329  ubs(self.params)
-00029e10: 0a20 2020 2020 2020 2020 2020 2073 656c  .            sel
-00029e20: 662e 5f63 6f6e 7472 6f6c 5f74 6620 3d20  f._control_tf = 
-00029e30: 7466 5f74 6f5f 636f 6e74 726f 6c28 7466  tf_to_control(tf
-00029e40: 290a 0a20 2020 2020 2020 2023 2063 7265  )..        # cre
-00029e50: 6174 6520 286f 7220 7570 6461 7465 2920  ate (or update) 
-00029e60: 7468 6520 6469 7363 7265 7469 7a65 6420  the discretized 
-00029e70: 646f 6d61 696e 0a20 2020 2020 2020 205f  domain.        _
-00029e80: 2c20 7374 6172 742c 2065 6e64 203d 2073  , start, end = s
-00029e90: 656c 662e 7261 6e67 6573 5b30 5d0a 2020  elf.ranges[0].  
-00029ea0: 2020 2020 2020 6966 2073 656c 662e 5f69        if self._i
-00029eb0: 6e74 6572 6163 7469 7665 5f72 616e 6765  nteractive_range
-00029ec0: 733a 0a20 2020 2020 2020 2020 2020 2073  s:.            s
-00029ed0: 7461 7274 203d 2073 656c 662e 5f75 7064  tart = self._upd
-00029ee0: 6174 655f 7261 6e67 655f 7661 6c75 6528  ate_range_value(
-00029ef0: 7374 6172 7429 2e72 6561 6c0a 2020 2020  start).real.    
-00029f00: 2020 2020 2020 2020 656e 6420 3d20 7365          end = se
-00029f10: 6c66 2e5f 7570 6461 7465 5f72 616e 6765  lf._update_range
-00029f20: 5f76 616c 7565 2865 6e64 292e 7265 616c  _value(end).real
-00029f30: 0a20 2020 2020 2020 2065 6c73 653a 0a20  .        else:. 
-00029f40: 2020 2020 2020 2020 2020 2073 7461 7274             start
-00029f50: 2c20 656e 6420 3d20 666c 6f61 7428 7374  , end = float(st
-00029f60: 6172 7429 2c20 666c 6f61 7428 656e 6429  art), float(end)
-00029f70: 0a0a 2020 2020 2020 2020 6966 2028 7365  ..        if (se
-00029f80: 6c66 2e5f 7469 6d65 5f61 7272 6179 2069  lf._time_array i
-00029f90: 7320 4e6f 6e65 2920 6f72 2073 656c 662e  s None) or self.
-00029fa0: 5f69 6e74 6572 6163 7469 7665 5f72 616e  _interactive_ran
-00029fb0: 6765 733a 0a20 2020 2020 2020 2020 2020  ges:.           
-00029fc0: 2069 6620 6e6f 7420 7365 6c66 2e5f 636f   if not self._co
-00029fd0: 6e74 726f 6c5f 7466 2e69 7364 7469 6d65  ntrol_tf.isdtime
-00029fe0: 2829 3a0a 2020 2020 2020 2020 2020 2020  ():.            
-00029ff0: 2020 2020 6e20 3d20 7365 6c66 2e6e 5b30      n = self.n[0
-0002a000: 5d0a 2020 2020 2020 2020 2020 2020 656c  ].            el
-0002a010: 7365 3a0a 2020 2020 2020 2020 2020 2020  se:.            
-0002a020: 2020 2020 6e20 3d20 696e 7428 2865 6e64      n = int((end
-0002a030: 202d 2073 7461 7274 2920 2f20 7365 6c66   - start) / self
-0002a040: 2e5f 636f 6e74 726f 6c5f 7466 2e64 7429  ._control_tf.dt)
-0002a050: 202b 2031 0a20 2020 2020 2020 2020 2020   + 1.           
-0002a060: 2073 656c 662e 5f74 696d 655f 6172 7261   self._time_arra
-0002a070: 7920 3d20 7365 6c66 2e5f 6469 7363 7265  y = self._discre
-0002a080: 7469 7a65 280a 2020 2020 2020 2020 2020  tize(.          
-0002a090: 2020 2020 2020 2020 2020 7374 6172 742c            start,
-0002a0a0: 2065 6e64 2c20 6e2c 2073 656c 662e 7363   end, n, self.sc
-0002a0b0: 616c 6573 5b30 5d2c 2073 656c 662e 6f6e  ales[0], self.on
-0002a0c0: 6c79 5f69 6e74 6567 6572 7329 0a0a 2020  ly_integers)..  
-0002a0d0: 2020 2020 2020 636f 6e74 726f 6c5f 6b77        control_kw
-0002a0e0: 203d 207b 2254 223a 2073 656c 662e 5f74   = {"T": self._t
-0002a0f0: 696d 655f 6172 7261 792c 2022 7371 7565  ime_array, "sque
-0002a100: 657a 6522 3a20 5472 7565 7d0a 0a20 2020  eze": True}..   
-0002a110: 2020 2020 2069 6620 7365 6c66 2e5f 7265       if self._re
-0002a120: 7370 6f6e 7365 5f74 7970 6520 3d3d 2022  sponse_type == "
-0002a130: 7374 6570 223a 0a20 2020 2020 2020 2020  step":.         
-0002a140: 2020 2063 6b77 203d 206d 6572 6765 6465     ckw = mergede
-0002a150: 6570 2e6d 6572 6765 287b 7d2c 2063 6f6e  ep.merge({}, con
-0002a160: 7472 6f6c 5f6b 772c 2073 656c 662e 5f63  trol_kw, self._c
-0002a170: 6f6e 7472 6f6c 5f6b 7729 0a20 2020 2020  ontrol_kw).     
-0002a180: 2020 2020 2020 2078 2c20 7920 3d20 6374         x, y = ct
-0002a190: 2e73 7465 705f 7265 7370 6f6e 7365 2873  .step_response(s
-0002a1a0: 656c 662e 5f63 6f6e 7472 6f6c 5f74 662c  elf._control_tf,
-0002a1b0: 202a 2a63 6b77 290a 2020 2020 2020 2020   **ckw).        
-0002a1c0: 656c 6966 2073 656c 662e 5f72 6573 706f  elif self._respo
-0002a1d0: 6e73 655f 7479 7065 203d 3d20 2269 6d70  nse_type == "imp
-0002a1e0: 756c 7365 223a 0a20 2020 2020 2020 2020  ulse":.         
-0002a1f0: 2020 2063 6b77 203d 206d 6572 6765 6465     ckw = mergede
-0002a200: 6570 2e6d 6572 6765 287b 7d2c 2063 6f6e  ep.merge({}, con
-0002a210: 7472 6f6c 5f6b 772c 2073 656c 662e 5f63  trol_kw, self._c
-0002a220: 6f6e 7472 6f6c 5f6b 7729 0a20 2020 2020  ontrol_kw).     
-0002a230: 2020 2020 2020 2078 2c20 7920 3d20 6374         x, y = ct
-0002a240: 2e69 6d70 756c 7365 5f72 6573 706f 6e73  .impulse_respons
-0002a250: 6528 7365 6c66 2e5f 636f 6e74 726f 6c5f  e(self._control_
-0002a260: 7466 2c20 2a2a 636b 7729 0a20 2020 2020  tf, **ckw).     
-0002a270: 2020 2065 6c69 6620 7365 6c66 2e5f 7265     elif self._re
-0002a280: 7370 6f6e 7365 5f74 7970 6520 3d3d 2022  sponse_type == "
-0002a290: 7261 6d70 223a 0a20 2020 2020 2020 2020  ramp":.         
-0002a2a0: 2020 2072 616d 7020 3d20 7365 6c66 2e5f     ramp = self._
-0002a2b0: 7469 6d65 5f61 7272 6179 0a20 2020 2020  time_array.     
-0002a2c0: 2020 2020 2020 2063 6f6e 7472 6f6c 5f6b         control_k
-0002a2d0: 775b 2255 225d 203d 2072 616d 700a 2020  w["U"] = ramp.  
-0002a2e0: 2020 2020 2020 2020 2020 636b 7720 3d20            ckw = 
-0002a2f0: 6d65 7267 6564 6565 702e 6d65 7267 6528  mergedeep.merge(
-0002a300: 7b7d 2c20 636f 6e74 726f 6c5f 6b77 2c20  {}, control_kw, 
-0002a310: 7365 6c66 2e5f 636f 6e74 726f 6c5f 6b77  self._control_kw
-0002a320: 290a 2020 2020 2020 2020 2020 2020 782c  ).            x,
-0002a330: 2079 203d 2063 742e 666f 7263 6564 5f72   y = ct.forced_r
-0002a340: 6573 706f 6e73 6528 7365 6c66 2e5f 636f  esponse(self._co
-0002a350: 6e74 726f 6c5f 7466 2c20 2a2a 636b 7729  ntrol_tf, **ckw)
-0002a360: 0a20 2020 2020 2020 2065 6c73 653a 0a20  .        else:. 
-0002a370: 2020 2020 2020 2020 2020 2072 6169 7365             raise
-0002a380: 204e 6f74 496d 706c 656d 656e 7465 6445   NotImplementedE
-0002a390: 7272 6f72 0a0a 2020 2020 2020 2020 7265  rror..        re
-0002a3a0: 7475 726e 2078 2c20 790a 0a0a 636c 6173  turn x, y...clas
-0002a3b0: 7320 436f 6c6f 7265 6453 7973 7465 6d52  s ColoredSystemR
-0002a3c0: 6573 706f 6e73 6553 6572 6965 7328 5379  esponseSeries(Sy
-0002a3d0: 7374 656d 5265 7370 6f6e 7365 5365 7269  stemResponseSeri
-0002a3e0: 6573 293a 0a20 2020 2022 2222 5265 7072  es):.    """Repr
-0002a3f0: 6573 656e 7420 6120 7379 7374 656d 2072  esent a system r
-0002a400: 6573 706f 6e73 6520 636f 6d70 7574 6564  esponse computed
-0002a410: 2077 6974 6820 7468 6520 6060 636f 6e74   with the ``cont
-0002a420: 726f 6c60 6020 6d6f 6475 6c65 2c0a 2020  rol`` module,.  
-0002a430: 2020 616e 6420 636f 6c6f 7265 6420 6163    and colored ac
-0002a440: 636f 7264 696e 6720 736f 6d65 2063 6f6c  cording some col
-0002a450: 6f72 2066 756e 6374 696f 6e2e 0a20 2020  or function..   
-0002a460: 2022 2222 0a20 2020 2069 735f 7061 7261   """.    is_para
-0002a470: 6d65 7472 6963 203d 2054 7275 650a 0a20  metric = True.. 
-0002a480: 2020 2064 6566 205f 5f69 6e69 745f 5f28     def __init__(
-0002a490: 7365 6c66 2c20 2a61 7267 732c 202a 2a6b  self, *args, **k
-0002a4a0: 7761 7267 7329 3a0a 2020 2020 2020 2020  wargs):.        
-0002a4b0: 7375 7065 7228 292e 5f5f 696e 6974 5f5f  super().__init__
-0002a4c0: 282a 6172 6773 2c20 2a2a 6b77 6172 6773  (*args, **kwargs
-0002a4d0: 290a 2020 2020 2020 2020 7365 6c66 2e75  ).        self.u
-0002a4e0: 7365 5f63 6d20 3d20 6b77 6172 6773 2e67  se_cm = kwargs.g
-0002a4f0: 6574 2822 7573 655f 636d 222c 2054 7275  et("use_cm", Tru
-0002a500: 6529 0a0a 2020 2020 6465 6620 5f67 6574  e)..    def _get
-0002a510: 5f64 6174 615f 6865 6c70 6572 2873 656c  _data_helper(sel
-0002a520: 6629 3a0a 2020 2020 2020 2020 782c 2079  f):.        x, y
-0002a530: 203d 2073 7570 6572 2829 2e5f 6765 745f   = super()._get_
-0002a540: 6461 7461 5f68 656c 7065 7228 290a 2020  data_helper().  
-0002a550: 2020 2020 2020 7265 7475 726e 2078 2c20        return x, 
-0002a560: 792c 2073 656c 662e 6576 616c 5f63 6f6c  y, self.eval_col
-0002a570: 6f72 5f66 756e 6328 782c 2079 290a 0a0a  or_func(x, y)...
-0002a580: 636c 6173 7320 506f 6c65 5a65 726f 436f  class PoleZeroCo
-0002a590: 6d6d 6f6e 3a0a 2020 2020 6465 6620 5f5f  mmon:.    def __
-0002a5a0: 696e 6974 5f5f 2873 656c 662c 202a 6172  init__(self, *ar
-0002a5b0: 6773 2c20 2a2a 6b77 6172 6773 293a 0a20  gs, **kwargs):. 
-0002a5c0: 2020 2020 2020 2073 7570 6572 2829 2e5f         super()._
-0002a5d0: 5f69 6e69 745f 5f28 2a61 7267 732c 202a  _init__(*args, *
-0002a5e0: 2a6b 7761 7267 7329 0a20 2020 2020 2020  *kwargs).       
-0002a5f0: 2073 656c 662e 6973 5f70 6f69 6e74 203d   self.is_point =
-0002a600: 2054 7275 650a 2020 2020 2020 2020 7365   True.        se
-0002a610: 6c66 2e72 6574 7572 6e5f 706f 6c65 7320  lf.return_poles 
-0002a620: 3d20 6b77 6172 6773 2e67 6574 2822 7265  = kwargs.get("re
-0002a630: 7475 726e 5f70 6f6c 6573 222c 2054 7275  turn_poles", Tru
-0002a640: 6529 0a20 2020 2020 2020 2073 656c 662e  e).        self.
-0002a650: 706f 6c65 5f63 6f6c 6f72 203d 206b 7761  pole_color = kwa
-0002a660: 7267 732e 6765 7428 2270 6f6c 655f 636f  rgs.get("pole_co
-0002a670: 6c6f 7222 2c20 4e6f 6e65 290a 2020 2020  lor", None).    
-0002a680: 2020 2020 7365 6c66 2e7a 6572 6f5f 636f      self.zero_co
-0002a690: 6c6f 7220 3d20 6b77 6172 6773 2e67 6574  lor = kwargs.get
-0002a6a0: 2822 7a65 726f 5f63 6f6c 6f72 222c 204e  ("zero_color", N
-0002a6b0: 6f6e 6529 0a20 2020 2020 2020 2073 656c  one).        sel
-0002a6c0: 662e 706f 6c65 5f6d 6172 6b65 7273 697a  f.pole_markersiz
-0002a6d0: 6520 3d20 6b77 6172 6773 2e67 6574 2822  e = kwargs.get("
-0002a6e0: 706f 6c65 5f6d 6172 6b65 7273 697a 6522  pole_markersize"
-0002a6f0: 2c20 3130 290a 2020 2020 2020 2020 7365  , 10).        se
-0002a700: 6c66 2e7a 6572 6f5f 6d61 726b 6572 7369  lf.zero_markersi
-0002a710: 7a65 203d 206b 7761 7267 732e 6765 7428  ze = kwargs.get(
-0002a720: 227a 6572 6f5f 6d61 726b 6572 7369 7a65  "zero_markersize
-0002a730: 222c 2037 290a 0a20 2020 2064 6566 205f  ", 7)..    def _
-0002a740: 5f73 7472 5f5f 2873 656c 6629 3a0a 2020  _str__(self):.  
-0002a750: 2020 2020 2020 7265 7475 726e 2073 656c        return sel
-0002a760: 662e 5f73 7472 5f68 656c 7065 7228 2270  f._str_helper("p
-0002a770: 6f6c 6573 2220 6966 2073 656c 662e 7265  oles" if self.re
-0002a780: 7475 726e 5f70 6f6c 6573 2065 6c73 6520  turn_poles else 
-0002a790: 227a 6572 6f73 2022 290a 0a0a 636c 6173  "zeros ")...clas
-0002a7a0: 7320 506f 6c65 5a65 726f 5769 7468 5379  s PoleZeroWithSy
-0002a7b0: 6d70 7953 6572 6965 7328 506f 6c65 5a65  mpySeries(PoleZe
-0002a7c0: 726f 436f 6d6d 6f6e 2c20 4c69 7374 3244  roCommon, List2D
-0002a7d0: 5365 7269 6573 293a 0a20 2020 2064 6566  Series):.    def
-0002a7e0: 205f 5f69 6e69 745f 5f28 7365 6c66 2c20   __init__(self, 
-0002a7f0: 2a61 7267 732c 202a 2a6b 7761 7267 7329  *args, **kwargs)
-0002a800: 3a0a 2020 2020 2020 2020 7375 7065 7228  :.        super(
-0002a810: 292e 5f5f 696e 6974 5f5f 282a 6172 6773  ).__init__(*args
-0002a820: 2c20 2a2a 6b77 6172 6773 290a 0a0a 636c  , **kwargs)...cl
-0002a830: 6173 7320 506f 6c65 5a65 726f 5365 7269  ass PoleZeroSeri
-0002a840: 6573 2850 6f6c 655a 6572 6f43 6f6d 6d6f  es(PoleZeroCommo
-0002a850: 6e2c 2043 6f6e 7472 6f6c 4261 7365 5365  n, ControlBaseSe
-0002a860: 7269 6573 293a 0a20 2020 2022 2222 5265  ries):.    """Re
-0002a870: 7072 6573 656e 7420 6120 7468 6520 706f  present a the po
-0002a880: 6c65 2d7a 6572 6f20 6f66 2061 6e20 4c54  le-zero of an LT
-0002a890: 4920 5349 534f 2073 7973 7465 6d20 636f  I SISO system co
-0002a8a0: 6d70 7574 6564 0a20 2020 2077 6974 6820  mputed.    with 
-0002a8b0: 7468 6520 6060 636f 6e74 726f 6c60 6020  the ``control`` 
-0002a8c0: 6d6f 6475 6c65 2e0a 0a20 2020 2054 6869  module...    Thi
-0002a8d0: 7320 7365 7269 6573 2072 6570 7265 7365  s series represe
-0002a8e0: 6e74 7320 6569 7468 6572 2070 6f6c 6573  nts either poles
-0002a8f0: 206f 7220 7a65 726f 732c 206e 6f74 2062   or zeros, not b
-0002a900: 6f74 6820 6174 2074 6865 2073 616d 6520  oth at the same 
-0002a910: 7469 6d65 2e0a 2020 2020 496e 2073 6f6d  time..    In som
-0002a920: 6520 7365 6e73 652c 2069 7420 6265 6861  e sense, it beha
-0002a930: 7665 7320 6c69 6b65 2061 204c 6973 7432  ves like a List2
-0002a940: 4453 6572 6965 732e 2053 6f2c 2074 6f20  DSeries. So, to 
-0002a950: 7265 7072 6573 656e 7473 2062 6f74 680a  represents both.
-0002a960: 2020 2020 706f 6c65 7320 616e 6420 7a65      poles and ze
-0002a970: 726f 7320 6f66 2061 2074 7261 6e73 6665  ros of a transfe
-0002a980: 7220 6675 6e63 7469 6f6e 2c20 7765 206e  r function, we n
-0002a990: 6565 6420 746f 2069 6e73 7461 7469 6174  eed to instatiat
-0002a9a0: 6520 7477 6f0a 2020 2020 6469 6666 6572  e two.    differ
-0002a9b0: 656e 7420 7365 7269 6573 2070 6173 7369  ent series passi
-0002a9c0: 6e67 2069 6e20 7468 6520 7361 6d65 2074  ng in the same t
-0002a9d0: 7261 6e73 6665 7220 6675 6e63 7469 6f6e  ransfer function
-0002a9e0: 2e0a 0a20 2020 2057 6869 6c65 2063 6f6d  ...    While com
-0002a9f0: 7075 7461 7469 6f6e 616c 6c79 206c 6573  putationally les
-0002aa00: 7320 6566 6669 6369 656e 742c 2074 6869  s efficient, thi
-0002aa10: 7320 6465 7369 676e 2063 686f 6963 6520  s design choice 
-0002aa20: 6861 7665 2062 6565 6e20 6d61 6465 0a20  have been made. 
-0002aa30: 2020 2069 6e20 6f72 6465 7220 746f 2072     in order to r
-0002aa40: 6575 7365 2074 6865 2065 7869 7374 696e  euse the existin
-0002aa50: 6720 4261 7365 4261 636b 656e 6420 6172  g BaseBackend ar
-0002aa60: 6368 6974 6563 7475 7265 2c20 7468 6174  chitecture, that
-0002aa70: 2073 6574 7320 7570 0a20 2020 2074 6865   sets up.    the
-0002aa80: 206e 756d 6265 7220 6f66 2063 6f6c 6f72   number of color
-0002aa90: 7320 6261 7365 6420 6f6e 2074 6865 206e  s based on the n
-0002aaa0: 756d 6265 7220 6f66 2064 6174 6120 7365  umber of data se
-0002aab0: 7269 6573 2c20 6173 2077 656c 6c20 6173  ries, as well as
-0002aac0: 2074 6865 0a20 2020 206c 6f67 6963 2074   the.    logic t
-0002aad0: 6f20 7368 6f77 206f 7220 6869 6465 2074  o show or hide t
-0002aae0: 6865 206c 6567 656e 642e 0a20 2020 2022  he legend..    "
-0002aaf0: 2222 0a20 2020 2064 6566 205f 5f69 6e69  "".    def __ini
-0002ab00: 745f 5f28 7365 6c66 2c20 7466 2c20 6c61  t__(self, tf, la
-0002ab10: 6265 6c3d 2222 2c20 2a2a 6b77 6172 6773  bel="", **kwargs
-0002ab20: 293a 0a20 2020 2020 2020 2073 7570 6572  ):.        super
-0002ab30: 2829 2e5f 5f69 6e69 745f 5f28 7466 2c20  ().__init__(tf, 
-0002ab40: 6c61 6265 6c3d 6c61 6265 6c2c 202a 2a6b  label=label, **k
-0002ab50: 7761 7267 7329 0a20 2020 2020 2020 2073  wargs).        s
-0002ab60: 656c 662e 5f63 6865 636b 5f66 7328 290a  elf._check_fs().
-0002ab70: 0a20 2020 2064 6566 205f 5f73 7472 5f5f  .    def __str__
-0002ab80: 2873 656c 6629 3a0a 2020 2020 2020 2020  (self):.        
-0002ab90: 7072 6520 3d20 2270 6f6c 6573 206f 6620  pre = "poles of 
-0002aba0: 2220 6966 2073 656c 662e 7265 7475 726e  " if self.return
-0002abb0: 5f70 6f6c 6573 2065 6c73 6520 227a 6572  _poles else "zer
-0002abc0: 6f73 206f 6620 220a 2020 2020 2020 2020  os of ".        
-0002abd0: 6578 7072 203d 2073 656c 662e 5f65 7870  expr = self._exp
-0002abe0: 7220 6966 2073 656c 662e 5f65 7870 7220  r if self._expr 
-0002abf0: 6973 206e 6f74 204e 6f6e 6520 656c 7365  is not None else
-0002ac00: 2073 656c 662e 5f63 6f6e 7472 6f6c 5f74   self._control_t
-0002ac10: 660a 2020 2020 2020 2020 7265 7475 726e  f.        return
-0002ac20: 2070 7265 202b 2073 7472 2865 7870 7229   pre + str(expr)
-0002ac30: 0a0a 2020 2020 6465 6620 5f67 6574 5f64  ..    def _get_d
-0002ac40: 6174 615f 6865 6c70 6572 2873 656c 6629  ata_helper(self)
-0002ac50: 3a0a 2020 2020 2020 2020 2222 220a 2020  :.        """.  
-0002ac60: 2020 2020 2020 5265 7475 726e 730a 2020        Returns.  
-0002ac70: 2020 2020 2020 3d3d 3d3d 3d3d 3d0a 2020        =======.  
-0002ac80: 2020 2020 2020 7820 3a20 6e70 2e6e 6461        x : np.nda
-0002ac90: 7272 6179 0a20 2020 2020 2020 2079 203a  rray.        y :
-0002aca0: 206e 702e 6e64 6172 7261 790a 2020 2020   np.ndarray.    
-0002acb0: 2020 2020 2222 220a 2020 2020 2020 2020      """.        
-0002acc0: 6e70 203d 2069 6d70 6f72 745f 6d6f 6475  np = import_modu
-0002acd0: 6c65 2822 6e75 6d70 7922 290a 2020 2020  le("numpy").    
-0002ace0: 2020 2020 6966 2073 656c 662e 6973 5f69      if self.is_i
-0002acf0: 6e74 6572 6163 7469 7665 3a0a 2020 2020  nteractive:.    
-0002ad00: 2020 2020 2020 2020 7466 203d 2073 656c          tf = sel
-0002ad10: 662e 5f65 7870 722e 7375 6273 2873 656c  f._expr.subs(sel
-0002ad20: 662e 7061 7261 6d73 290a 2020 2020 2020  f.params).      
-0002ad30: 2020 2020 2020 7365 6c66 2e5f 636f 6e74        self._cont
-0002ad40: 726f 6c5f 7466 203d 2074 665f 746f 5f63  rol_tf = tf_to_c
-0002ad50: 6f6e 7472 6f6c 2874 6629 0a20 2020 2020  ontrol(tf).     
-0002ad60: 2020 2069 6620 7365 6c66 2e72 6574 7572     if self.retur
-0002ad70: 6e5f 706f 6c65 733a 0a20 2020 2020 2020  n_poles:.       
-0002ad80: 2020 2020 2070 6f69 6e74 7320 3d20 7365       points = se
-0002ad90: 6c66 2e5f 636f 6e74 726f 6c5f 7466 2e70  lf._control_tf.p
-0002ada0: 6f6c 6573 2829 0a20 2020 2020 2020 2065  oles().        e
-0002adb0: 6c73 653a 0a20 2020 2020 2020 2020 2020  lse:.           
-0002adc0: 2070 6f69 6e74 7320 3d20 7365 6c66 2e5f   points = self._
-0002add0: 636f 6e74 726f 6c5f 7466 2e7a 6572 6f73  control_tf.zeros
-0002ade0: 2829 0a20 2020 2020 2020 2072 6574 7572  ().        retur
-0002adf0: 6e20 6e70 2e72 6561 6c28 706f 696e 7473  n np.real(points
-0002ae00: 292c 206e 702e 696d 6167 2870 6f69 6e74  ), np.imag(point
-0002ae10: 7329 0a0a 0a63 6c61 7373 204e 4772 6964  s)...class NGrid
-0002ae20: 4c69 6e65 5365 7269 6573 2847 7269 6442  LineSeries(GridB
-0002ae30: 6173 652c 2042 6173 6553 6572 6965 7329  ase, BaseSeries)
-0002ae40: 3a0a 2020 2020 2222 2220 5468 6520 636f  :.    """ The co
-0002ae50: 6465 206f 6620 7468 6973 2063 6c61 7373  de of this class
-0002ae60: 2063 6f6d 6573 2066 726f 6d20 7468 6520   comes from the 
-0002ae70: 6060 636f 6e74 726f 6c60 6020 7061 636b  ``control`` pack
-0002ae80: 6167 652c 2077 6869 6368 2068 6173 0a20  age, which has. 
-0002ae90: 2020 2062 6565 6e20 7265 6172 7261 6e67     been rearrang
-0002aea0: 6564 2074 6f20 776f 726b 2077 6974 6820  ed to work with 
-0002aeb0: 7468 6520 6172 6368 6974 6563 7475 7265  the architecture
-0002aec0: 206f 6620 7468 6973 206d 6f64 756c 652e   of this module.
-0002aed0: 0a20 2020 2022 2222 0a0a 2020 2020 6465  .    """..    de
-0002aee0: 6620 5f5f 696e 6974 5f5f 2873 656c 662c  f __init__(self,
-0002aef0: 2063 6c5f 6d61 6773 3d4e 6f6e 652c 2063   cl_mags=None, c
-0002af00: 6c5f 7068 6173 6573 3d4e 6f6e 652c 206c  l_phases=None, l
-0002af10: 6162 656c 5f63 6c5f 7068 6173 6573 3d46  abel_cl_phases=F
-0002af20: 616c 7365 2c0a 2020 2020 2020 2020 2a2a  alse,.        **
-0002af30: 6b77 6172 6773 293a 0a20 2020 2020 2020  kwargs):.       
-0002af40: 2073 7570 6572 2829 2e5f 5f69 6e69 745f   super().__init_
-0002af50: 5f28 2a2a 6b77 6172 6773 290a 2020 2020  _(**kwargs).    
-0002af60: 2020 2020 6e70 203d 2069 6d70 6f72 745f      np = import_
-0002af70: 6d6f 6475 6c65 2822 6e75 6d70 7922 290a  module("numpy").
-0002af80: 2020 2020 2020 2020 7365 6c66 2e63 6c5f          self.cl_
-0002af90: 6d61 6773 203d 2063 6c5f 6d61 6773 2069  mags = cl_mags i
-0002afa0: 6620 636c 5f6d 6167 7320 6973 204e 6f6e  f cl_mags is Non
-0002afb0: 6520 656c 7365 206e 702e 6172 7261 7928  e else np.array(
-0002afc0: 636c 5f6d 6167 7329 0a20 2020 2020 2020  cl_mags).       
-0002afd0: 2073 656c 662e 636c 5f70 6861 7365 7320   self.cl_phases 
-0002afe0: 3d20 636c 5f70 6861 7365 7320 6966 2063  = cl_phases if c
-0002aff0: 6c5f 7068 6173 6573 2069 7320 4e6f 6e65  l_phases is None
-0002b000: 2065 6c73 6520 6e70 2e61 7272 6179 2863   else np.array(c
-0002b010: 6c5f 7068 6173 6573 290a 2020 2020 2020  l_phases).      
-0002b020: 2020 7365 6c66 2e6c 6162 656c 5f63 6c5f    self.label_cl_
-0002b030: 7068 6173 6573 203d 206c 6162 656c 5f63  phases = label_c
-0002b040: 6c5f 7068 6173 6573 0a20 2020 2020 2020  l_phases.       
-0002b050: 2073 656c 662e 7368 6f77 5f69 6e5f 6c65   self.show_in_le
-0002b060: 6765 6e64 203d 206b 7761 7267 732e 6765  gend = kwargs.ge
-0002b070: 7428 2273 686f 775f 696e 5f6c 6567 656e  t("show_in_legen
-0002b080: 6422 2c20 4661 6c73 6529 0a20 2020 2020  d", False).     
-0002b090: 2020 2073 656c 662e 7368 6f77 5f63 6c5f     self.show_cl_
-0002b0a0: 6d61 6773 203d 206b 7761 7267 732e 6765  mags = kwargs.ge
-0002b0b0: 7428 2273 686f 775f 636c 5f6d 6167 7322  t("show_cl_mags"
-0002b0c0: 2c20 5472 7565 290a 2020 2020 2020 2020  , True).        
-0002b0d0: 7365 6c66 2e73 686f 775f 636c 5f70 6861  self.show_cl_pha
-0002b0e0: 7365 7320 3d20 6b77 6172 6773 2e67 6574  ses = kwargs.get
-0002b0f0: 2822 7368 6f77 5f63 6c5f 7068 6173 6573  ("show_cl_phases
-0002b100: 222c 2054 7275 6529 0a0a 2020 2020 6465  ", True)..    de
-0002b110: 6620 5f5f 7374 725f 5f28 7365 6c66 293a  f __str__(self):
-0002b120: 0a20 2020 2020 2020 2072 6574 7572 6e20  .        return 
-0002b130: 226e 2d67 7269 6422 0a0a 2020 2020 4073  "n-grid"..    @s
-0002b140: 7461 7469 636d 6574 686f 640a 2020 2020  taticmethod.    
-0002b150: 6465 6620 636c 6f73 6564 5f6c 6f6f 705f  def closed_loop_
-0002b160: 636f 6e74 6f75 7273 2847 636c 5f6d 6167  contours(Gcl_mag
-0002b170: 732c 2047 636c 5f70 6861 7365 7329 3a0a  s, Gcl_phases):.
-0002b180: 2020 2020 2020 2020 2222 2243 6f6e 746f          """Conto
-0002b190: 7572 7320 6f66 2074 6865 2066 756e 6374  urs of the funct
-0002b1a0: 696f 6e20 4763 6c20 3d20 476f 6c2f 2831  ion Gcl = Gol/(1
-0002b1b0: 2b47 6f6c 292c 2077 6865 7265 0a20 2020  +Gol), where.   
-0002b1c0: 2020 2020 2047 6f6c 2069 7320 616e 206f       Gol is an o
-0002b1d0: 7065 6e2d 6c6f 6f70 2074 7261 6e73 6665  pen-loop transfe
-0002b1e0: 7220 6675 6e63 7469 6f6e 2c20 616e 6420  r function, and 
-0002b1f0: 4763 6c20 6973 2061 2063 6f72 7265 7370  Gcl is a corresp
-0002b200: 6f6e 6469 6e67 0a20 2020 2020 2020 2063  onding.        c
-0002b210: 6c6f 7365 642d 6c6f 6f70 2074 7261 6e73  losed-loop trans
-0002b220: 6665 7220 6675 6e63 7469 6f6e 2e0a 0a20  fer function... 
-0002b230: 2020 2020 2020 2050 6172 616d 6574 6572         Parameter
-0002b240: 730a 2020 2020 2020 2020 2d2d 2d2d 2d2d  s.        ------
-0002b250: 2d2d 2d2d 0a20 2020 2020 2020 2047 636c  ----.        Gcl
-0002b260: 5f6d 6167 7320 3a20 6172 7261 792d 6c69  _mags : array-li
-0002b270: 6b65 0a20 2020 2020 2020 2020 2020 2041  ke.            A
-0002b280: 7272 6179 206f 6620 6d61 676e 6974 7564  rray of magnitud
-0002b290: 6573 206f 6620 7468 6520 636f 6e74 6f75  es of the contou
-0002b2a0: 7273 0a20 2020 2020 2020 2047 636c 5f70  rs.        Gcl_p
-0002b2b0: 6861 7365 7320 3a20 6172 7261 792d 6c69  hases : array-li
-0002b2c0: 6b65 0a20 2020 2020 2020 2020 2020 2041  ke.            A
-0002b2d0: 7272 6179 206f 6620 7068 6173 6573 2069  rray of phases i
-0002b2e0: 6e20 7261 6469 616e 7320 6f66 2074 6865  n radians of the
-0002b2f0: 2063 6f6e 746f 7572 730a 0a20 2020 2020   contours..     
-0002b300: 2020 2052 6574 7572 6e73 0a20 2020 2020     Returns.     
-0002b310: 2020 202d 2d2d 2d2d 2d2d 0a20 2020 2020     -------.     
-0002b320: 2020 2063 6f6e 746f 7572 7320 3a20 636f     contours : co
-0002b330: 6d70 6c65 7820 6172 7261 790a 2020 2020  mplex array.    
-0002b340: 2020 2020 2020 2020 4172 7261 7920 6f66          Array of
-0002b350: 2063 6f6d 706c 6578 206e 756d 6265 7273   complex numbers
-0002b360: 2063 6f72 7265 7370 6f6e 6469 6e67 2074   corresponding t
-0002b370: 6f20 7468 6520 636f 6e74 6f75 7273 2e0a  o the contours..
-0002b380: 2020 2020 2020 2020 2222 220a 2020 2020          """.    
-0002b390: 2020 2020 2320 436f 6d70 7574 6520 7468      # Compute th
-0002b3a0: 6520 636f 6e74 6f75 7273 2069 6e20 4763  e contours in Gc
-0002b3b0: 6c2d 7370 6163 652e 2053 696e 6365 2077  l-space. Since w
-0002b3c0: 6527 7265 2067 6976 656e 2063 6c6f 7365  e're given close
-0002b3d0: 642d 6c6f 6f70 0a20 2020 2020 2020 2023  d-loop.        #
-0002b3e0: 206d 6167 6e69 7475 6465 7320 616e 6420   magnitudes and 
-0002b3f0: 7068 6173 6573 2c20 7468 6973 2069 7320  phases, this is 
-0002b400: 6a75 7374 2061 2063 6173 6520 6f66 2063  just a case of c
-0002b410: 6f6e 7665 7274 696e 6720 7468 656d 2069  onverting them i
-0002b420: 6e74 6f0a 2020 2020 2020 2020 2320 6120  nto.        # a 
-0002b430: 636f 6d70 6c65 7820 6e75 6d62 6572 2e0a  complex number..
-0002b440: 2020 2020 2020 2020 6e70 203d 2069 6d70          np = imp
-0002b450: 6f72 745f 6d6f 6475 6c65 2822 6e75 6d70  ort_module("nump
-0002b460: 7922 290a 2020 2020 2020 2020 4763 6c20  y").        Gcl 
-0002b470: 3d20 4763 6c5f 6d61 6773 2a6e 702e 6578  = Gcl_mags*np.ex
-0002b480: 7028 312e 6a2a 4763 6c5f 7068 6173 6573  p(1.j*Gcl_phases
-0002b490: 290a 0a20 2020 2020 2020 2023 2049 6e76  )..        # Inv
-0002b4a0: 6572 7420 4763 6c20 3d20 476f 6c2f 2831  ert Gcl = Gol/(1
-0002b4b0: 2b47 6f6c 2920 746f 206d 6170 2074 6865  +Gol) to map the
-0002b4c0: 2063 6f6e 746f 7572 7320 696e 746f 2074   contours into t
-0002b4d0: 6865 206f 7065 6e2d 6c6f 6f70 2073 7061  he open-loop spa
-0002b4e0: 6365 0a20 2020 2020 2020 2072 6574 7572  ce.        retur
-0002b4f0: 6e20 4763 6c2f 2831 2e30 202d 2047 636c  n Gcl/(1.0 - Gcl
-0002b500: 290a 0a20 2020 2040 7374 6174 6963 6d65  )..    @staticme
-0002b510: 7468 6f64 0a20 2020 2064 6566 206d 5f63  thod.    def m_c
-0002b520: 6972 636c 6573 286d 6167 732c 2070 6861  ircles(mags, pha
-0002b530: 7365 5f6d 696e 3d2d 3335 392e 3735 2c20  se_min=-359.75, 
-0002b540: 7068 6173 655f 6d61 783d 2d30 2e32 3529  phase_max=-0.25)
-0002b550: 3a0a 2020 2020 2020 2020 2222 2243 6f6e  :.        """Con
-0002b560: 7374 616e 742d 6d61 676e 6974 7564 6520  stant-magnitude 
-0002b570: 636f 6e74 6f75 7273 206f 6620 7468 6520  contours of the 
-0002b580: 6675 6e63 7469 6f6e 2047 636c 203d 2047  function Gcl = G
-0002b590: 6f6c 2f28 312b 476f 6c29 2c20 7768 6572  ol/(1+Gol), wher
-0002b5a0: 650a 2020 2020 2020 2020 476f 6c20 6973  e.        Gol is
-0002b5b0: 2061 6e20 6f70 656e 2d6c 6f6f 7020 7472   an open-loop tr
-0002b5c0: 616e 7366 6572 2066 756e 6374 696f 6e2c  ansfer function,
-0002b5d0: 2061 6e64 2047 636c 2069 7320 6120 636f   and Gcl is a co
-0002b5e0: 7272 6573 706f 6e64 696e 670a 2020 2020  rresponding.    
-0002b5f0: 2020 2020 636c 6f73 6564 2d6c 6f6f 7020      closed-loop 
-0002b600: 7472 616e 7366 6572 2066 756e 6374 696f  transfer functio
-0002b610: 6e2e 0a0a 2020 2020 2020 2020 5061 7261  n...        Para
-0002b620: 6d65 7465 7273 0a20 2020 2020 2020 202d  meters.        -
-0002b630: 2d2d 2d2d 2d2d 2d2d 2d0a 2020 2020 2020  ---------.      
-0002b640: 2020 6d61 6773 203a 2061 7272 6179 2d6c    mags : array-l
-0002b650: 696b 650a 2020 2020 2020 2020 2020 2020  ike.            
-0002b660: 4172 7261 7920 6f66 206d 6167 6e69 7475  Array of magnitu
-0002b670: 6465 7320 696e 2064 4220 6f66 2074 6865  des in dB of the
-0002b680: 204d 2d63 6972 636c 6573 0a20 2020 2020   M-circles.     
-0002b690: 2020 2070 6861 7365 5f6d 696e 203a 2064     phase_min : d
-0002b6a0: 6567 7265 6573 0a20 2020 2020 2020 2020  egrees.         
-0002b6b0: 2020 204d 696e 696d 756d 2070 6861 7365     Minimum phase
-0002b6c0: 2069 6e20 6465 6772 6565 7320 6f66 2074   in degrees of t
-0002b6d0: 6865 204e 2d63 6972 636c 6573 0a20 2020  he N-circles.   
-0002b6e0: 2020 2020 2070 6861 7365 5f6d 6178 203a       phase_max :
-0002b6f0: 2064 6567 7265 6573 0a20 2020 2020 2020   degrees.       
-0002b700: 2020 2020 204d 6178 696d 756d 2070 6861       Maximum pha
-0002b710: 7365 2069 6e20 6465 6772 6565 7320 6f66  se in degrees of
-0002b720: 2074 6865 204e 2d63 6972 636c 6573 0a0a   the N-circles..
-0002b730: 2020 2020 2020 2020 5265 7475 726e 730a          Returns.
-0002b740: 2020 2020 2020 2020 2d2d 2d2d 2d2d 2d0a          -------.
-0002b750: 2020 2020 2020 2020 636f 6e74 6f75 7273          contours
-0002b760: 203a 2063 6f6d 706c 6578 2061 7272 6179   : complex array
-0002b770: 0a20 2020 2020 2020 2020 2020 2041 7272  .            Arr
-0002b780: 6179 206f 6620 636f 6d70 6c65 7820 6e75  ay of complex nu
-0002b790: 6d62 6572 7320 636f 7272 6573 706f 6e64  mbers correspond
-0002b7a0: 696e 6720 746f 2074 6865 2063 6f6e 746f  ing to the conto
-0002b7b0: 7572 732e 0a20 2020 2020 2020 2022 2222  urs..        """
-0002b7c0: 0a20 2020 2020 2020 2023 2043 6f6e 7665  .        # Conve
-0002b7d0: 7274 206d 6167 6e69 7475 6465 7320 616e  rt magnitudes an
-0002b7e0: 6420 7068 6173 6520 7261 6e67 6520 696e  d phase range in
-0002b7f0: 746f 2061 2067 7269 6420 7375 6974 6162  to a grid suitab
-0002b800: 6c65 2066 6f72 0a20 2020 2020 2020 2023  le for.        #
-0002b810: 2062 7569 6c64 696e 6720 636f 6e74 6f75   building contou
-0002b820: 7273 0a20 2020 2020 2020 206e 7020 3d20  rs.        np = 
-0002b830: 696d 706f 7274 5f6d 6f64 756c 6528 226e  import_module("n
-0002b840: 756d 7079 2229 0a20 2020 2020 2020 2070  umpy").        p
-0002b850: 6861 7365 7320 3d20 6e70 2e72 6164 6961  hases = np.radia
-0002b860: 6e73 286e 702e 6c69 6e73 7061 6365 2870  ns(np.linspace(p
-0002b870: 6861 7365 5f6d 696e 2c20 7068 6173 655f  hase_min, phase_
-0002b880: 6d61 782c 2032 3030 3029 290a 2020 2020  max, 2000)).    
-0002b890: 2020 2020 4763 6c5f 6d61 6773 2c20 4763      Gcl_mags, Gc
-0002b8a0: 6c5f 7068 6173 6573 203d 206e 702e 6d65  l_phases = np.me
-0002b8b0: 7368 6772 6964 2831 302e 302a 2a28 6d61  shgrid(10.0**(ma
-0002b8c0: 6773 2f32 302e 3029 2c20 7068 6173 6573  gs/20.0), phases
-0002b8d0: 290a 2020 2020 2020 2020 7265 7475 726e  ).        return
-0002b8e0: 204e 4772 6964 4c69 6e65 5365 7269 6573   NGridLineSeries
-0002b8f0: 2e63 6c6f 7365 645f 6c6f 6f70 5f63 6f6e  .closed_loop_con
-0002b900: 746f 7572 7328 4763 6c5f 6d61 6773 2c20  tours(Gcl_mags, 
-0002b910: 4763 6c5f 7068 6173 6573 290a 0a20 2020  Gcl_phases)..   
-0002b920: 2040 7374 6174 6963 6d65 7468 6f64 0a20   @staticmethod. 
-0002b930: 2020 2064 6566 206e 5f63 6972 636c 6573     def n_circles
-0002b940: 2870 6861 7365 732c 206d 6167 5f6d 696e  (phases, mag_min
-0002b950: 3d2d 3430 2e30 2c20 6d61 675f 6d61 783d  =-40.0, mag_max=
-0002b960: 3132 2e30 293a 0a20 2020 2020 2020 2022  12.0):.        "
-0002b970: 2222 436f 6e73 7461 6e74 2d70 6861 7365  ""Constant-phase
-0002b980: 2063 6f6e 746f 7572 7320 6f66 2074 6865   contours of the
-0002b990: 2066 756e 6374 696f 6e20 4763 6c20 3d20   function Gcl = 
-0002b9a0: 476f 6c2f 2831 2b47 6f6c 292c 2077 6865  Gol/(1+Gol), whe
-0002b9b0: 7265 0a20 2020 2020 2020 2047 6f6c 2069  re.        Gol i
-0002b9c0: 7320 616e 206f 7065 6e2d 6c6f 6f70 2074  s an open-loop t
-0002b9d0: 7261 6e73 6665 7220 6675 6e63 7469 6f6e  ransfer function
-0002b9e0: 2c20 616e 6420 4763 6c20 6973 2061 2063  , and Gcl is a c
-0002b9f0: 6f72 7265 7370 6f6e 6469 6e67 0a20 2020  orresponding.   
-0002ba00: 2020 2020 2063 6c6f 7365 642d 6c6f 6f70       closed-loop
-0002ba10: 2074 7261 6e73 6665 7220 6675 6e63 7469   transfer functi
-0002ba20: 6f6e 2e0a 0a20 2020 2020 2020 2050 6172  on...        Par
-0002ba30: 616d 6574 6572 730a 2020 2020 2020 2020  ameters.        
-0002ba40: 2d2d 2d2d 2d2d 2d2d 2d2d 0a20 2020 2020  ----------.     
-0002ba50: 2020 2070 6861 7365 7320 3a20 6172 7261     phases : arra
-0002ba60: 792d 6c69 6b65 0a20 2020 2020 2020 2020  y-like.         
-0002ba70: 2020 2041 7272 6179 206f 6620 7068 6173     Array of phas
-0002ba80: 6573 2069 6e20 6465 6772 6565 7320 6f66  es in degrees of
-0002ba90: 2074 6865 204e 2d63 6972 636c 6573 0a20   the N-circles. 
-0002baa0: 2020 2020 2020 206d 6167 5f6d 696e 203a         mag_min :
-0002bab0: 2064 420a 2020 2020 2020 2020 2020 2020   dB.            
-0002bac0: 4d69 6e69 6d75 6d20 6d61 676e 6974 7564  Minimum magnitud
-0002bad0: 6520 696e 2064 4220 6f66 2074 6865 204e  e in dB of the N
-0002bae0: 2d63 6972 636c 6573 0a20 2020 2020 2020  -circles.       
-0002baf0: 206d 6167 5f6d 6178 203a 2064 420a 2020   mag_max : dB.  
-0002bb00: 2020 2020 2020 2020 2020 4d61 7869 6d75            Maximu
-0002bb10: 6d20 6d61 676e 6974 7564 6520 696e 2064  m magnitude in d
-0002bb20: 4220 6f66 2074 6865 204e 2d63 6972 636c  B of the N-circl
-0002bb30: 6573 0a0a 2020 2020 2020 2020 5265 7475  es..        Retu
-0002bb40: 726e 730a 2020 2020 2020 2020 2d2d 2d2d  rns.        ----
-0002bb50: 2d2d 2d0a 2020 2020 2020 2020 636f 6e74  ---.        cont
-0002bb60: 6f75 7273 203a 2063 6f6d 706c 6578 2061  ours : complex a
-0002bb70: 7272 6179 0a20 2020 2020 2020 2020 2020  rray.           
-0002bb80: 2041 7272 6179 206f 6620 636f 6d70 6c65   Array of comple
-0002bb90: 7820 6e75 6d62 6572 7320 636f 7272 6573  x numbers corres
-0002bba0: 706f 6e64 696e 6720 746f 2074 6865 2063  ponding to the c
-0002bbb0: 6f6e 746f 7572 732e 0a20 2020 2020 2020  ontours..       
-0002bbc0: 2022 2222 0a20 2020 2020 2020 2023 2043   """.        # C
-0002bbd0: 6f6e 7665 7274 2070 6861 7365 7320 616e  onvert phases an
-0002bbe0: 6420 6d61 676e 6974 7564 6520 7261 6e67  d magnitude rang
-0002bbf0: 6520 696e 746f 2061 2067 7269 6420 7375  e into a grid su
-0002bc00: 6974 6162 6c65 2066 6f72 0a20 2020 2020  itable for.     
-0002bc10: 2020 2023 2062 7569 6c64 696e 6720 636f     # building co
-0002bc20: 6e74 6f75 7273 0a20 2020 2020 2020 206e  ntours.        n
-0002bc30: 7020 3d20 696d 706f 7274 5f6d 6f64 756c  p = import_modul
-0002bc40: 6528 226e 756d 7079 2229 0a20 2020 2020  e("numpy").     
-0002bc50: 2020 206d 6167 7320 3d20 6e70 2e6c 696e     mags = np.lin
-0002bc60: 7370 6163 6528 3130 2a2a 286d 6167 5f6d  space(10**(mag_m
-0002bc70: 696e 2f32 302e 3029 2c20 3130 2a2a 286d  in/20.0), 10**(m
-0002bc80: 6167 5f6d 6178 2f32 302e 3029 2c20 3230  ag_max/20.0), 20
-0002bc90: 3030 290a 2020 2020 2020 2020 4763 6c5f  00).        Gcl_
-0002bca0: 7068 6173 6573 2c20 4763 6c5f 6d61 6773  phases, Gcl_mags
-0002bcb0: 203d 206e 702e 6d65 7368 6772 6964 286e   = np.meshgrid(n
-0002bcc0: 702e 7261 6469 616e 7328 7068 6173 6573  p.radians(phases
-0002bcd0: 292c 206d 6167 7329 0a20 2020 2020 2020  ), mags).       
-0002bce0: 2072 6574 7572 6e20 4e47 7269 644c 696e   return NGridLin
-0002bcf0: 6553 6572 6965 732e 636c 6f73 6564 5f6c  eSeries.closed_l
-0002bd00: 6f6f 705f 636f 6e74 6f75 7273 2847 636c  oop_contours(Gcl
-0002bd10: 5f6d 6167 732c 2047 636c 5f70 6861 7365  _mags, Gcl_phase
-0002bd20: 7329 0a0a 2020 2020 6465 6620 6765 745f  s)..    def get_
-0002bd30: 6461 7461 2873 656c 6629 3a0a 2020 2020  data(self):.    
-0002bd40: 2020 2020 6e70 203d 2069 6d70 6f72 745f      np = import_
-0002bd50: 6d6f 6475 6c65 2822 6e75 6d70 7922 290a  module("numpy").
-0002bd60: 0a20 2020 2020 2020 2023 2044 6566 6175  .        # Defau
-0002bd70: 6c74 2063 6861 7274 2073 697a 650a 2020  lt chart size.  
-0002bd80: 2020 2020 2020 6f6c 5f70 6861 7365 5f6d        ol_phase_m
-0002bd90: 696e 203d 202d 3335 392e 3939 0a20 2020  in = -359.99.   
-0002bda0: 2020 2020 206f 6c5f 7068 6173 655f 6d61       ol_phase_ma
-0002bdb0: 7820 3d20 302e 300a 2020 2020 2020 2020  x = 0.0.        
-0002bdc0: 6f6c 5f6d 6167 5f6d 696e 203d 202d 3430  ol_mag_min = -40
-0002bdd0: 2e30 0a20 2020 2020 2020 206f 6c5f 6d61  .0.        ol_ma
-0002bde0: 675f 6d61 7820 3d20 6465 6661 756c 745f  g_max = default_
-0002bdf0: 6f6c 5f6d 6167 5f6d 6178 203d 2035 302e  ol_mag_max = 50.
-0002be00: 300a 0a20 2020 2020 2020 2063 6c5f 6d61  0..        cl_ma
-0002be10: 6773 203d 2073 656c 662e 636c 5f6d 6167  gs = self.cl_mag
-0002be20: 730a 2020 2020 2020 2020 636c 5f70 6861  s.        cl_pha
-0002be30: 7365 7320 3d20 7365 6c66 2e63 6c5f 7068  ses = self.cl_ph
-0002be40: 6173 6573 0a20 2020 2020 2020 206c 6162  ases.        lab
-0002be50: 656c 5f63 6c5f 7068 6173 6573 203d 2073  el_cl_phases = s
-0002be60: 656c 662e 6c61 6265 6c5f 636c 5f70 6861  elf.label_cl_pha
-0002be70: 7365 730a 0a20 2020 2020 2020 2023 2046  ses..        # F
-0002be80: 696e 6420 6578 7465 6e74 206f 6620 696e  ind extent of in
-0002be90: 7465 7273 6563 7469 6f6e 2074 6865 2063  tersection the c
-0002bea0: 7572 7265 6e74 2064 6174 6173 6574 206f  urrent dataset o
-0002beb0: 7220 7669 6577 0a20 2020 2020 2020 206f  r view.        o
-0002bec0: 6c5f 7068 6173 655f 6d69 6e2c 206f 6c5f  l_phase_min, ol_
-0002bed0: 7068 6173 655f 6d61 7820 3d20 7365 6c66  phase_max = self
-0002bee0: 2e5f 786c 696d 0a20 2020 2020 2020 206f  ._xlim.        o
-0002bef0: 6c5f 6d61 675f 6d69 6e2c 206f 6c5f 6d61  l_mag_min, ol_ma
-0002bf00: 675f 6d61 7820 3d20 7365 6c66 2e5f 796c  g_max = self._yl
-0002bf10: 696d 0a0a 2020 2020 2020 2020 2320 4d2d  im..        # M-
-0002bf20: 6369 7263 6c65 206d 6167 6e69 7475 6465  circle magnitude
-0002bf30: 732e 0a20 2020 2020 2020 2069 6620 636c  s..        if cl
-0002bf40: 5f6d 6167 7320 6973 204e 6f6e 653a 0a20  _mags is None:. 
-0002bf50: 2020 2020 2020 2020 2020 2023 2044 6566             # Def
-0002bf60: 6175 6c74 2063 6861 7274 206d 6167 6e69  ault chart magni
-0002bf70: 7475 6465 730a 2020 2020 2020 2020 2020  tudes.          
-0002bf80: 2020 2320 5468 6520 6b65 7920 7365 7420    # The key set 
-0002bf90: 6f66 206d 6167 6e69 7475 6465 7320 6172  of magnitudes ar
-0002bfa0: 6520 616c 7761 7973 2067 656e 6572 6174  e always generat
-0002bfb0: 6564 2c20 7369 6e63 6520 7468 6973 0a20  ed, since this. 
-0002bfc0: 2020 2020 2020 2020 2020 2023 2067 7561             # gua
-0002bfd0: 7261 6e74 6565 7320 6120 7265 636f 676e  rantees a recogn
-0002bfe0: 697a 6162 6c65 204e 6963 686f 6c73 2063  izable Nichols c
-0002bff0: 6861 7274 2067 7269 642e 0a20 2020 2020  hart grid..     
-0002c000: 2020 2020 2020 206b 6579 5f63 6c5f 6d61         key_cl_ma
-0002c010: 6773 203d 206e 702e 6172 7261 7928 5b0a  gs = np.array([.
-0002c020: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002c030: 2d34 302e 302c 202d 3230 2e30 2c20 2d31  -40.0, -20.0, -1
-0002c040: 322e 302c 202d 362e 302c 202d 332e 302c  2.0, -6.0, -3.0,
-0002c050: 202d 312e 302c 202d 302e 352c 0a20 2020   -1.0, -0.5,.   
-0002c060: 2020 2020 2020 2020 2020 2020 2030 2e30               0.0
-0002c070: 2c20 302e 3235 2c20 302e 352c 2031 2e30  , 0.25, 0.5, 1.0
-0002c080: 2c20 332e 302c 2036 2e30 2c20 3132 2e30  , 3.0, 6.0, 12.0
-0002c090: 0a20 2020 2020 2020 2020 2020 205d 290a  .            ]).
-0002c0a0: 0a20 2020 2020 2020 2020 2020 2023 2045  .            # E
-0002c0b0: 7874 656e 6420 7468 6520 7261 6e67 6520  xtend the range 
-0002c0c0: 6f66 206d 6167 6e69 7475 6465 7320 6966  of magnitudes if
-0002c0d0: 206e 6563 6573 7361 7279 2e20 5468 6520   necessary. The 
-0002c0e0: 6578 7465 6e64 6564 2061 7261 6e67 650a  extended arange.
-0002c0f0: 2020 2020 2020 2020 2020 2020 2320 7769              # wi
-0002c100: 6c6c 2065 6e64 2075 7020 656d 7074 7920  ll end up empty 
-0002c110: 6966 206e 6f20 6578 7465 6e73 696f 6e20  if no extension 
-0002c120: 6973 2072 6571 7569 7265 642e 2041 7373  is required. Ass
-0002c130: 756d 6573 2074 6861 740a 2020 2020 2020  umes that.      
-0002c140: 2020 2020 2020 2320 636c 6f73 6564 2d6c        # closed-l
-0002c150: 6f6f 7020 6d61 676e 6974 7564 6573 2061  oop magnitudes a
-0002c160: 7265 2061 7070 726f 7869 6d61 7465 6c79  re approximately
-0002c170: 2061 6c69 676e 6564 2077 6974 6820 6f70   aligned with op
-0002c180: 656e 2d6c 6f6f 700a 2020 2020 2020 2020  en-loop.        
-0002c190: 2020 2020 2320 6d61 676e 6974 7564 6573      # magnitudes
-0002c1a0: 2062 6579 6f6e 6420 7468 6520 7661 6c75   beyond the valu
-0002c1b0: 6520 6f66 206e 702e 6d69 6e28 6b65 795f  e of np.min(key_
-0002c1c0: 636c 5f6d 6167 7329 0a20 2020 2020 2020  cl_mags).       
-0002c1d0: 2020 2020 2063 6c5f 6d61 675f 7374 6570       cl_mag_step
-0002c1e0: 203d 202d 3230 2e30 2020 2320 6442 0a20   = -20.0  # dB. 
-0002c1f0: 2020 2020 2020 2020 2020 2065 7874 656e             exten
-0002c200: 6465 645f 636c 5f6d 6167 7320 3d20 6e70  ded_cl_mags = np
-0002c210: 2e61 7261 6e67 6528 0a20 2020 2020 2020  .arange(.       
-0002c220: 2020 2020 2020 2020 206e 702e 6d69 6e28           np.min(
-0002c230: 6b65 795f 636c 5f6d 6167 7329 2c20 6f6c  key_cl_mags), ol
-0002c240: 5f6d 6167 5f6d 696e 202b 2063 6c5f 6d61  _mag_min + cl_ma
-0002c250: 675f 7374 6570 2c20 636c 5f6d 6167 5f73  g_step, cl_mag_s
-0002c260: 7465 7029 0a20 2020 2020 2020 2020 2020  tep).           
-0002c270: 2063 6c5f 6d61 6773 203d 206e 702e 636f   cl_mags = np.co
-0002c280: 6e63 6174 656e 6174 6528 2865 7874 656e  ncatenate((exten
-0002c290: 6465 645f 636c 5f6d 6167 732c 206b 6579  ded_cl_mags, key
-0002c2a0: 5f63 6c5f 6d61 6773 2929 0a0a 2020 2020  _cl_mags))..    
-0002c2b0: 2020 2020 2320 6120 6d69 6e69 6d75 6d20      # a minimum 
-0002c2c0: 3336 3064 6567 2065 7874 656e 7420 636f  360deg extent co
-0002c2d0: 6e74 6169 6e69 6e67 2074 6865 2070 6861  ntaining the pha
-0002c2e0: 7365 730a 2020 2020 2020 2020 7068 6173  ses.        phas
-0002c2f0: 655f 726f 756e 645f 6d61 7820 3d20 3336  e_round_max = 36
-0002c300: 302e 302a 6e70 2e63 6569 6c28 6f6c 5f70  0.0*np.ceil(ol_p
-0002c310: 6861 7365 5f6d 6178 2f33 3630 2e30 290a  hase_max/360.0).
-0002c320: 2020 2020 2020 2020 7068 6173 655f 726f          phase_ro
-0002c330: 756e 645f 6d69 6e20 3d20 6d69 6e28 7068  und_min = min(ph
-0002c340: 6173 655f 726f 756e 645f 6d61 782d 3336  ase_round_max-36
-0002c350: 302c 0a20 2020 2020 2020 2020 2020 2020  0,.             
-0002c360: 2020 2020 2020 2020 2020 2020 2020 2033                 3
-0002c370: 3630 2e30 2a6e 702e 666c 6f6f 7228 6f6c  60.0*np.floor(ol
-0002c380: 5f70 6861 7365 5f6d 696e 2f33 3630 2e30  _phase_min/360.0
-0002c390: 2929 0a0a 2020 2020 2020 2020 2320 4e2d  ))..        # N-
-0002c3a0: 6369 7263 6c65 2070 6861 7365 7320 2873  circle phases (s
-0002c3b0: 686f 756c 6420 6265 2069 6e20 7468 6520  hould be in the 
-0002c3c0: 7261 6e67 6520 2d33 3630 2074 6f20 3029  range -360 to 0)
-0002c3d0: 0a20 2020 2020 2020 2069 6620 636c 5f70  .        if cl_p
-0002c3e0: 6861 7365 7320 6973 204e 6f6e 653a 0a20  hases is None:. 
-0002c3f0: 2020 2020 2020 2020 2020 2023 2061 696d             # aim
-0002c400: 2066 6f72 2039 206c 696e 6573 2c20 6275   for 9 lines, bu
-0002c410: 7420 616c 7761 7973 2073 686f 7720 282d  t always show (-
-0002c420: 3336 302b 6570 732c 202d 3138 302c 202d  360+eps, -180, -
-0002c430: 6570 7329 0a20 2020 2020 2020 2020 2020  eps).           
-0002c440: 2023 2073 6d61 6c6c 6573 7420 7370 6163   # smallest spac
-0002c450: 696e 6720 6973 2034 352c 2062 6967 6765  ing is 45, bigge
-0002c460: 7374 2069 7320 3138 300a 2020 2020 2020  st is 180.      
-0002c470: 2020 2020 2020 7068 6173 655f 7370 616e        phase_span
-0002c480: 203d 2070 6861 7365 5f72 6f75 6e64 5f6d   = phase_round_m
-0002c490: 6178 202d 2070 6861 7365 5f72 6f75 6e64  ax - phase_round
-0002c4a0: 5f6d 696e 0a20 2020 2020 2020 2020 2020  _min.           
-0002c4b0: 2073 7061 6369 6e67 203d 206e 702e 636c   spacing = np.cl
-0002c4c0: 6970 2872 6f75 6e64 2870 6861 7365 5f73  ip(round(phase_s
-0002c4d0: 7061 6e20 2f20 3820 2f20 3435 2920 2a20  pan / 8 / 45) * 
-0002c4e0: 3435 2c20 3435 2c20 3138 3029 0a20 2020  45, 45, 180).   
-0002c4f0: 2020 2020 2020 2020 206b 6579 5f63 6c5f           key_cl_
-0002c500: 7068 6173 6573 203d 206e 702e 6172 7261  phases = np.arra
-0002c510: 7928 5b2d 302e 3235 2c20 2d33 3539 2e37  y([-0.25, -359.7
-0002c520: 355d 290a 2020 2020 2020 2020 2020 2020  5]).            
-0002c530: 6f74 6865 725f 636c 5f70 6861 7365 7320  other_cl_phases 
-0002c540: 3d20 6e70 2e61 7261 6e67 6528 2d73 7061  = np.arange(-spa
-0002c550: 6369 6e67 2c20 2d33 3630 2e30 2c20 2d73  cing, -360.0, -s
-0002c560: 7061 6369 6e67 290a 2020 2020 2020 2020  pacing).        
-0002c570: 2020 2020 636c 5f70 6861 7365 7320 3d20      cl_phases = 
-0002c580: 6e70 2e75 6e69 7175 6528 6e70 2e63 6f6e  np.unique(np.con
-0002c590: 6361 7465 6e61 7465 2828 6b65 795f 636c  catenate((key_cl
-0002c5a0: 5f70 6861 7365 732c 206f 7468 6572 5f63  _phases, other_c
-0002c5b0: 6c5f 7068 6173 6573 2929 290a 2020 2020  l_phases))).    
-0002c5c0: 2020 2020 656c 6966 206e 6f74 2028 282d      elif not ((-
-0002c5d0: 3336 3020 3c20 6e70 2e6d 696e 2863 6c5f  360 < np.min(cl_
-0002c5e0: 7068 6173 6573 2929 2061 6e64 2028 6e70  phases)) and (np
-0002c5f0: 2e6d 6178 2863 6c5f 7068 6173 6573 2920  .max(cl_phases) 
-0002c600: 3c20 302e 3029 293a 0a20 2020 2020 2020  < 0.0)):.       
-0002c610: 2020 2020 2072 6169 7365 2056 616c 7565       raise Value
-0002c620: 4572 726f 7228 2763 6c5f 7068 6173 6573  Error('cl_phases
-0002c630: 206d 7573 7420 6265 7477 6565 6e20 2d33   must between -3
-0002c640: 3630 2061 6e64 2030 2c20 6578 636c 7573  60 and 0, exclus
-0002c650: 6976 6527 290a 0a20 2020 2020 2020 2073  ive')..        s
-0002c660: 656c 662e 636c 5f6d 6167 7320 3d20 636c  elf.cl_mags = cl
-0002c670: 5f6d 6167 730a 2020 2020 2020 2020 7365  _mags.        se
-0002c680: 6c66 2e63 6c5f 7068 6173 6573 203d 2063  lf.cl_phases = c
-0002c690: 6c5f 7068 6173 6573 0a0a 2020 2020 2020  l_phases..      
-0002c6a0: 2020 2320 4669 6e64 2074 6865 204d 2d63    # Find the M-c
-0002c6b0: 6f6e 746f 7572 730a 2020 2020 2020 2020  ontours.        
-0002c6c0: 6d20 3d20 7365 6c66 2e6d 5f63 6972 636c  m = self.m_circl
-0002c6d0: 6573 280a 2020 2020 2020 2020 2020 2020  es(.            
-0002c6e0: 636c 5f6d 6167 732c 2070 6861 7365 5f6d  cl_mags, phase_m
-0002c6f0: 696e 3d6e 702e 6d69 6e28 636c 5f70 6861  in=np.min(cl_pha
-0002c700: 7365 7329 2c20 7068 6173 655f 6d61 783d  ses), phase_max=
-0002c710: 6e70 2e6d 6178 2863 6c5f 7068 6173 6573  np.max(cl_phases
-0002c720: 2929 0a20 2020 2020 2020 206d 5f6d 6167  )).        m_mag
-0002c730: 203d 2032 302a 6e70 2e6c 6f67 3130 286e   = 20*np.log10(n
-0002c740: 702e 6162 7328 6d29 290a 2020 2020 2020  p.abs(m)).      
-0002c750: 2020 6d5f 7068 6173 6520 3d20 6e70 2e6d    m_phase = np.m
-0002c760: 6f64 286e 702e 6465 6772 6565 7328 6e70  od(np.degrees(np
-0002c770: 2e61 6e67 6c65 286d 2929 2c20 2d33 3630  .angle(m)), -360
-0002c780: 2e30 2920 2023 2055 6e77 7261 700a 0a20  .0)  # Unwrap.. 
-0002c790: 2020 2020 2020 2023 2046 696e 6420 7468         # Find th
-0002c7a0: 6520 4e2d 636f 6e74 6f75 7273 0a20 2020  e N-contours.   
-0002c7b0: 2020 2020 206e 203d 2073 656c 662e 6e5f       n = self.n_
-0002c7c0: 6369 7263 6c65 7328 636c 5f70 6861 7365  circles(cl_phase
-0002c7d0: 732c 206d 6167 5f6d 696e 3d6e 702e 6d69  s, mag_min=np.mi
-0002c7e0: 6e28 636c 5f6d 6167 7329 2c20 6d61 675f  n(cl_mags), mag_
-0002c7f0: 6d61 783d 6e70 2e6d 6178 2863 6c5f 6d61  max=np.max(cl_ma
-0002c800: 6773 2929 0a20 2020 2020 2020 206e 5f6d  gs)).        n_m
-0002c810: 6167 203d 2032 302a 6e70 2e6c 6f67 3130  ag = 20*np.log10
-0002c820: 286e 702e 6162 7328 6e29 290a 2020 2020  (np.abs(n)).    
-0002c830: 2020 2020 6e5f 7068 6173 6520 3d20 6e70      n_phase = np
-0002c840: 2e6d 6f64 286e 702e 6465 6772 6565 7328  .mod(np.degrees(
-0002c850: 6e70 2e61 6e67 6c65 286e 2929 2c20 2d33  np.angle(n)), -3
-0002c860: 3630 2e30 2920 2023 2055 6e77 7261 700a  60.0)  # Unwrap.
-0002c870: 0a20 2020 2020 2020 2023 2050 6c6f 7420  .        # Plot 
-0002c880: 7468 6520 636f 6e74 6f75 7273 2062 6568  the contours beh
-0002c890: 696e 6420 6f74 6865 7220 706c 6f74 2065  ind other plot e
-0002c8a0: 6c65 6d65 6e74 732e 0a20 2020 2020 2020  lements..       
-0002c8b0: 2023 2054 6865 2022 7068 6173 6520 6f66   # The "phase of
-0002c8c0: 6673 6574 2220 6973 2075 7365 6420 746f  fset" is used to
-0002c8d0: 2070 726f 6475 6365 2063 6f70 6965 7320   produce copies 
-0002c8e0: 6f66 2074 6865 2063 6861 7274 2074 6861  of the chart tha
-0002c8f0: 7420 636f 7665 720a 2020 2020 2020 2020  t cover.        
-0002c900: 2320 7468 6520 656e 7469 7265 2072 616e  # the entire ran
-0002c910: 6765 206f 6620 7468 6520 706c 6f74 7465  ge of the plotte
-0002c920: 6420 6461 7461 2c20 7374 6172 7469 6e67  d data, starting
-0002c930: 2066 726f 6d20 6120 6261 7365 2063 6861   from a base cha
-0002c940: 7274 2063 6f6d 7075 7465 640a 2020 2020  rt computed.    
-0002c950: 2020 2020 2320 6f76 6572 2074 6865 2072      # over the r
-0002c960: 616e 6765 202d 3336 3020 3c20 7068 6173  ange -360 < phas
-0002c970: 6520 3c20 302e 2047 6976 656e 2074 6865  e < 0. Given the
-0002c980: 2072 616e 6765 0a20 2020 2020 2020 2023   range.        #
-0002c990: 2074 6865 2062 6173 6520 6368 6172 7420   the base chart 
-0002c9a0: 6973 2063 6f6d 7075 7465 6420 6f76 6572  is computed over
-0002c9b0: 2c20 7468 6520 7068 6173 6520 6f66 6673  , the phase offs
-0002c9c0: 6574 2073 686f 756c 6420 6265 2030 0a20  et should be 0. 
-0002c9d0: 2020 2020 2020 2023 2066 6f72 202d 3336         # for -36
-0002c9e0: 3020 3c20 6f6c 5f70 6861 7365 5f6d 696e  0 < ol_phase_min
-0002c9f0: 203c 2030 2e0a 2020 2020 2020 2020 7068   < 0..        ph
-0002ca00: 6173 655f 6f66 6673 6574 7320 3d20 3336  ase_offsets = 36
-0002ca10: 3020 2b20 6e70 2e61 7261 6e67 6528 7068  0 + np.arange(ph
-0002ca20: 6173 655f 726f 756e 645f 6d69 6e2c 2070  ase_round_min, p
-0002ca30: 6861 7365 5f72 6f75 6e64 5f6d 6178 2c20  hase_round_max, 
-0002ca40: 3336 302e 3029 0a20 2020 2020 2020 2072  360.0).        r
-0002ca50: 6574 7572 6e20 6d5f 6d61 672c 206d 5f70  eturn m_mag, m_p
-0002ca60: 6861 7365 2c20 6e5f 6d61 672c 206e 5f70  hase, n_mag, n_p
-0002ca70: 6861 7365 2c20 7068 6173 655f 6f66 6673  hase, phase_offs
-0002ca80: 6574 730a 0a0a 636c 6173 7320 4d43 6972  ets...class MCir
-0002ca90: 636c 6573 5365 7269 6573 2847 7269 6442  clesSeries(GridB
-0002caa0: 6173 652c 2042 6173 6553 6572 6965 7329  ase, BaseSeries)
-0002cab0: 3a0a 2020 2020 6465 6620 5f5f 696e 6974  :.    def __init
-0002cac0: 5f5f 2873 656c 662c 206d 6167 6e69 7475  __(self, magnitu
-0002cad0: 6465 735f 6462 2c20 6d61 676e 6974 7564  des_db, magnitud
-0002cae0: 6573 2c20 2a2a 6b77 6172 6773 293a 0a20  es, **kwargs):. 
-0002caf0: 2020 2020 2020 2073 7570 6572 2829 2e5f         super()._
-0002cb00: 5f69 6e69 745f 5f28 2a2a 6b77 6172 6773  _init__(**kwargs
-0002cb10: 290a 2020 2020 2020 2020 7365 6c66 2e6d  ).        self.m
-0002cb20: 6167 6e69 7475 6465 735f 6462 203d 2054  agnitudes_db = T
-0002cb30: 7570 6c65 282a 6d61 676e 6974 7564 6573  uple(*magnitudes
-0002cb40: 5f64 6229 0a20 2020 2020 2020 2073 656c  _db).        sel
-0002cb50: 662e 6d61 676e 6974 7564 6573 203d 2073  f.magnitudes = s
-0002cb60: 656c 662e 5f65 7870 7220 3d20 5475 706c  elf._expr = Tupl
-0002cb70: 6528 2a6d 6167 6e69 7475 6465 7329 0a20  e(*magnitudes). 
-0002cb80: 2020 2020 2020 2073 656c 662e 7368 6f77         self.show
-0002cb90: 5f6d 696e 7573 5f6f 6e65 203d 206b 7761  _minus_one = kwa
-0002cba0: 7267 732e 6765 7428 2273 686f 775f 6d69  rgs.get("show_mi
-0002cbb0: 6e75 735f 6f6e 6522 2c20 4661 6c73 6529  nus_one", False)
-0002cbc0: 0a0a 2020 2020 6465 6620 6765 745f 6461  ..    def get_da
-0002cbd0: 7461 2873 656c 6629 3a0a 2020 2020 2020  ta(self):.      
-0002cbe0: 2020 2222 220a 2020 2020 2020 2020 5265    """.        Re
-0002cbf0: 7475 726e 730a 2020 2020 2020 2020 3d3d  turns.        ==
-0002cc00: 3d3d 3d3d 3d0a 0a20 2020 2020 2020 2064  =====..        d
-0002cc10: 6174 6120 3a20 6c69 7374 0a20 2020 2020  ata : list.     
-0002cc20: 2020 2020 2020 2045 6163 6820 656c 656d         Each elem
-0002cc30: 656e 7420 6f66 2074 6865 206c 6973 7420  ent of the list 
-0002cc40: 6861 7320 7468 6520 666f 726d 3a0a 2020  has the form:.  
-0002cc50: 2020 2020 2020 2020 2020 6060 5b6d 6167            ``[mag
-0002cc60: 6e69 7475 6465 5f64 622c 2078 5f63 6f6f  nitude_db, x_coo
-0002cc70: 7264 732c 2079 5f63 6f6f 7264 735d 6060  rds, y_coords]``
-0002cc80: 2e0a 2020 2020 2020 2020 2222 220a 2020  ..        """.  
-0002cc90: 2020 2020 2020 6e70 203d 2069 6d70 6f72        np = impor
-0002cca0: 745f 6d6f 6475 6c65 2822 6e75 6d70 7922  t_module("numpy"
-0002ccb0: 290a 2020 2020 2020 2020 6461 7461 203d  ).        data =
-0002ccc0: 205b 5d0a 2020 2020 2020 2020 6d61 676e   [].        magn
-0002ccd0: 6974 7564 6573 203d 2073 656c 662e 6d61  itudes = self.ma
-0002cce0: 676e 6974 7564 6573 0a20 2020 2020 2020  gnitudes.       
-0002ccf0: 206d 6167 6e69 7475 6465 735f 6462 203d   magnitudes_db =
-0002cd00: 2073 656c 662e 6d61 676e 6974 7564 6573   self.magnitudes
-0002cd10: 5f64 620a 2020 2020 2020 2020 6966 2073  _db.        if s
-0002cd20: 656c 662e 6973 5f69 6e74 6572 6163 7469  elf.is_interacti
-0002cd30: 7665 3a0a 2020 2020 2020 2020 2020 2020  ve:.            
-0002cd40: 6d61 676e 6974 7564 6573 203d 206d 6167  magnitudes = mag
-0002cd50: 6e69 7475 6465 732e 7375 6273 2873 656c  nitudes.subs(sel
-0002cd60: 662e 7061 7261 6d73 290a 2020 2020 2020  f.params).      
-0002cd70: 2020 2020 2020 6d61 676e 6974 7564 6573        magnitudes
-0002cd80: 5f64 6220 3d20 6d61 676e 6974 7564 6573  _db = magnitudes
-0002cd90: 5f64 622e 7375 6273 2873 656c 662e 7061  _db.subs(self.pa
-0002cda0: 7261 6d73 290a 2020 2020 2020 2020 6d61  rams).        ma
-0002cdb0: 676e 6974 7564 6573 203d 206e 702e 6172  gnitudes = np.ar
-0002cdc0: 7261 7928 6d61 676e 6974 7564 6573 2c20  ray(magnitudes, 
-0002cdd0: 6474 7970 653d 666c 6f61 7429 0a20 2020  dtype=float).   
-0002cde0: 2020 2020 206d 6167 6e69 7475 6465 735f       magnitudes_
-0002cdf0: 6462 203d 206e 702e 6172 7261 7928 6d61  db = np.array(ma
-0002ce00: 676e 6974 7564 6573 5f64 622c 2064 7479  gnitudes_db, dty
-0002ce10: 7065 3d66 6c6f 6174 290a 0a20 2020 2020  pe=float)..     
-0002ce20: 2020 2074 6865 7461 203d 206e 702e 6c69     theta = np.li
-0002ce30: 6e73 7061 6365 2830 2c20 322a 6e70 2e70  nspace(0, 2*np.p
-0002ce40: 692c 2034 3030 290a 2020 2020 2020 2020  i, 400).        
-0002ce50: 6374 203d 206e 702e 636f 7328 7468 6574  ct = np.cos(thet
-0002ce60: 6129 0a20 2020 2020 2020 2073 7420 3d20  a).        st = 
-0002ce70: 6e70 2e73 696e 2874 6865 7461 290a 2020  np.sin(theta).  
-0002ce80: 2020 2020 2020 666f 7220 6d64 622c 206d        for mdb, m
-0002ce90: 2069 6e20 7a69 7028 6d61 676e 6974 7564   in zip(magnitud
-0002cea0: 6573 5f64 622c 206d 6167 6e69 7475 6465  es_db, magnitude
-0002ceb0: 7329 3a0a 2020 2020 2020 2020 2020 2020  s):.            
-0002cec0: 6966 206e 6f74 206e 702e 6973 636c 6f73  if not np.isclos
-0002ced0: 6528 6d64 622c 2030 293a 0a20 2020 2020  e(mdb, 0):.     
-0002cee0: 2020 2020 2020 2020 2020 2072 203d 206d             r = m
-0002cef0: 202f 2028 3120 2d20 6d2a 2a32 290a 2020   / (1 - m**2).  
-0002cf00: 2020 2020 2020 2020 2020 2020 2020 7820                x 
-0002cf10: 3d20 6d2a 2a32 202f 2028 3120 2d20 6d2a  = m**2 / (1 - m*
-0002cf20: 2a32 2920 2b20 7220 2a20 6374 0a20 2020  *2) + r * ct.   
-0002cf30: 2020 2020 2020 2020 2020 2020 2079 203d               y =
-0002cf40: 2072 202a 2073 740a 2020 2020 2020 2020   r * st.        
-0002cf50: 2020 2020 656c 7365 3a0a 2020 2020 2020      else:.      
-0002cf60: 2020 2020 2020 2020 2020 7820 3d20 5b2d            x = [-
-0002cf70: 302e 355d 0a20 2020 2020 2020 2020 2020  0.5].           
-0002cf80: 2020 2020 2079 203d 205b 305d 0a20 2020       y = [0].   
-0002cf90: 2020 2020 2020 2020 2064 6174 612e 6170           data.ap
-0002cfa0: 7065 6e64 285b 6d64 622c 2078 2c20 795d  pend([mdb, x, y]
-0002cfb0: 290a 2020 2020 2020 2020 7265 7475 726e  ).        return
-0002cfc0: 2064 6174 610a                            data.
+00026490: 6e20 3d20 7466 2e6e 756d 5b30 5d5b 305d  n = tf.num[0][0]
+000264a0: 2069 6620 6973 696e 7374 616e 6365 2863   if isinstance(c
+000264b0: 742e 5472 616e 7366 6572 4675 6e63 7469  t.TransferFuncti
+000264c0: 6f6e 2920 656c 7365 2074 662e 6e75 6d0a  on) else tf.num.
+000264d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000264e0: 6420 3d20 7466 2e64 656e 5b30 5d5b 305d  d = tf.den[0][0]
+000264f0: 2069 6620 6973 696e 7374 616e 6365 2863   if isinstance(c
+00026500: 742e 5472 616e 7366 6572 4675 6e63 7469  t.TransferFuncti
+00026510: 6f6e 2920 656c 7365 2074 662e 6465 6e0a  on) else tf.den.
+00026520: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00026530: 6578 7072 203d 2050 6f6c 792e 6672 6f6d  expr = Poly.from
+00026540: 5f6c 6973 7428 6e2c 2073 2920 2f20 506f  _list(n, s) / Po
+00026550: 6c79 2e66 726f 6d5f 6c69 7374 2864 2c20  ly.from_list(d, 
+00026560: 7329 0a20 2020 2020 2020 2020 2020 2020  s).             
+00026570: 2020 2073 656c 662e 5f6c 6162 656c 203d     self._label =
+00026580: 2073 7472 2865 7870 7229 0a20 2020 2020   str(expr).     
+00026590: 2020 2020 2020 2020 2020 2073 656c 662e             self.
+000265a0: 5f6c 6174 6578 5f6c 6162 656c 203d 206c  _latex_label = l
+000265b0: 6174 6578 2865 7870 7229 0a20 2020 2020  atex(expr).     
+000265c0: 2020 2020 2020 2069 6620 6973 696e 7374         if isinst
+000265d0: 616e 6365 2874 662c 2073 702e 7369 676e  ance(tf, sp.sign
+000265e0: 616c 2e54 7261 6e73 6665 7246 756e 6374  al.TransferFunct
+000265f0: 696f 6e29 3a0a 2020 2020 2020 2020 2020  ion):.          
+00026600: 2020 2020 2020 7365 6c66 2e5f 636f 6e74        self._cont
+00026610: 726f 6c5f 7466 203d 2074 665f 746f 5f63  rol_tf = tf_to_c
+00026620: 6f6e 7472 6f6c 2874 6629 0a20 2020 2020  ontrol(tf).     
+00026630: 2020 2020 2020 2065 6c73 653a 0a20 2020         else:.   
+00026640: 2020 2020 2020 2020 2020 2020 2073 656c               sel
+00026650: 662e 5f63 6f6e 7472 6f6c 5f74 6620 3d20  f._control_tf = 
+00026660: 7466 0a20 2020 2020 2020 2065 6c73 653a  tf.        else:
+00026670: 0a20 2020 2020 2020 2020 2020 2072 6169  .            rai
+00026680: 7365 2054 7970 6545 7272 6f72 280a 2020  se TypeError(.  
+00026690: 2020 2020 2020 2020 2020 2020 2020 2254                "T
+000266a0: 7261 6e73 6665 7220 6675 6e63 7469 6f6e  ransfer function
+000266b0: 2773 2074 7970 6520 6e6f 7420 7265 636f  's type not reco
+000266c0: 676e 697a 6564 2e20 220a 2020 2020 2020  gnized. ".      
+000266d0: 2020 2020 2020 2020 2020 2252 6563 6569            "Recei
+000266e0: 7665 643a 2022 202b 2073 7472 2874 7970  ved: " + str(typ
+000266f0: 6528 7466 2929 0a20 2020 2020 2020 2020  e(tf)).         
+00026700: 2020 2029 0a0a 2020 2020 2020 2020 7365     )..        se
+00026710: 6c66 2e5f 636f 6e74 726f 6c5f 6b77 203d  lf._control_kw =
+00026720: 206b 7761 7267 732e 6765 7428 2263 6f6e   kwargs.get("con
+00026730: 7472 6f6c 5f6b 7722 2c20 7b7d 290a 0a20  trol_kw", {}).. 
+00026740: 2020 2064 6566 205f 6368 6563 6b5f 6673     def _check_fs
+00026750: 2873 656c 6629 3a0a 2020 2020 2020 2020  (self):.        
+00026760: 2222 2220 4368 6563 6b73 2069 6620 7468  """ Checks if th
+00026770: 6572 6520 6172 6520 656e 6f67 6820 7061  ere are enogh pa
+00026780: 7261 6d65 7465 7273 2061 6e64 2066 7265  rameters and fre
+00026790: 6520 7379 6d62 6f6c 732e 0a20 2020 2020  e symbols..     
+000267a0: 2020 2022 2222 0a20 2020 2020 2020 2066     """.        f
+000267b0: 7320 3d20 7365 7428 290a 2020 2020 2020  s = set().      
+000267c0: 2020 6966 2073 656c 662e 5f65 7870 723a    if self._expr:
+000267d0: 0a20 2020 2020 2020 2020 2020 2066 7320  .            fs 
+000267e0: 3d20 7b73 656c 662e 5f65 7870 722e 7661  = {self._expr.va
+000267f0: 727d 0a20 2020 2020 2020 2072 616e 6765  r}.        range
+00026800: 732c 2070 6172 616d 7320 3d20 7365 6c66  s, params = self
+00026810: 2e72 616e 6765 732c 2073 656c 662e 7061  .ranges, self.pa
+00026820: 7261 6d73 0a0a 2020 2020 2020 2020 2320  rams..        # 
+00026830: 6672 6f6d 2074 6865 2065 7870 7265 7373  from the express
+00026840: 696f 6e27 7320 6672 6565 2073 796d 626f  ion's free symbo
+00026850: 6c73 2c20 7265 6d6f 7665 2074 6865 206f  ls, remove the o
+00026860: 6e65 7320 7573 6564 2069 6e0a 2020 2020  nes used in.    
+00026870: 2020 2020 2320 7468 6520 7061 7261 6d65      # the parame
+00026880: 7465 7273 2061 6e64 2074 6865 2072 616e  ters and the ran
+00026890: 6765 730a 2020 2020 2020 2020 6673 203d  ges.        fs =
+000268a0: 2066 732e 6469 6666 6572 656e 6365 2870   fs.difference(p
+000268b0: 6172 616d 732e 6b65 7973 2829 290a 2020  arams.keys()).  
+000268c0: 2020 2020 2020 6966 2072 616e 6765 7320        if ranges 
+000268d0: 6973 206e 6f74 204e 6f6e 653a 0a20 2020  is not None:.   
+000268e0: 2020 2020 2020 2020 2066 7320 3d20 6673           fs = fs
+000268f0: 2e64 6966 6665 7265 6e63 6528 5b72 5b30  .difference([r[0
+00026900: 5d20 666f 7220 7220 696e 2072 616e 6765  ] for r in range
+00026910: 735d 290a 0a20 2020 2020 2020 2069 6620  s])..        if 
+00026920: 6c65 6e28 6673 2920 3e20 313a 0a20 2020  len(fs) > 1:.   
+00026930: 2020 2020 2020 2020 2072 6169 7365 2056           raise V
+00026940: 616c 7565 4572 726f 7228 0a20 2020 2020  alueError(.     
+00026950: 2020 2020 2020 2020 2020 2022 496e 636f             "Inco
+00026960: 6d70 6174 6962 6c65 2065 7870 7265 7373  mpatible express
+00026970: 696f 6e20 616e 6420 7061 7261 6d65 7465  ion and paramete
+00026980: 7273 2e5c 6e22 0a20 2020 2020 2020 2020  rs.\n".         
+00026990: 2020 2020 2020 202b 2022 5370 6563 6966         + "Specif
+000269a0: 7920 7768 6174 2074 6865 7365 2073 796d  y what these sym
+000269b0: 626f 6c73 2072 6570 7265 7365 6e74 3a20  bols represent: 
+000269c0: 7b7d 5c6e 222e 666f 726d 6174 2866 7329  {}\n".format(fs)
+000269d0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+000269e0: 202b 2022 4172 6520 7468 6579 2072 616e   + "Are they ran
+000269f0: 6765 7320 6f72 2070 6172 616d 6574 6572  ges or parameter
+00026a00: 733f 220a 2020 2020 2020 2020 2020 2020  s?".            
+00026a10: 290a 0a20 2020 2020 2020 2023 2076 6572  )..        # ver
+00026a20: 6966 7920 7468 6174 2061 6c6c 2073 796d  ify that all sym
+00026a30: 626f 6c73 2061 7265 206b 6e6f 776e 2028  bols are known (
+00026a40: 7468 6579 2065 6974 6865 7220 7265 7072  they either repr
+00026a50: 6573 656e 7420 706c 6f74 7469 6e67 0a20  esent plotting. 
+00026a60: 2020 2020 2020 2023 2072 616e 6765 7320         # ranges 
+00026a70: 6f72 2070 6172 616d 6574 6572 7329 0a20  or parameters). 
+00026a80: 2020 2020 2020 2072 616e 6765 5f73 796d         range_sym
+00026a90: 626f 6c73 203d 205b 725b 305d 2066 6f72  bols = [r[0] for
+00026aa0: 2072 2069 6e20 7261 6e67 6573 5d0a 2020   r in ranges].  
+00026ab0: 2020 2020 2020 666f 7220 7220 696e 2072        for r in r
+00026ac0: 616e 6765 733a 0a20 2020 2020 2020 2020  anges:.         
+00026ad0: 2020 2066 7320 3d20 7365 7428 292e 756e     fs = set().un
+00026ae0: 696f 6e28 2a5b 652e 6672 6565 5f73 796d  ion(*[e.free_sym
+00026af0: 626f 6c73 2066 6f72 2065 2069 6e20 725b  bols for e in r[
+00026b00: 313a 5d5d 290a 2020 2020 2020 2020 2020  1:]]).          
+00026b10: 2020 6966 2061 6e79 2874 2069 6e20 6673    if any(t in fs
+00026b20: 2066 6f72 2074 2069 6e20 7261 6e67 655f   for t in range_
+00026b30: 7379 6d62 6f6c 7329 3a0a 2020 2020 2020  symbols):.      
+00026b40: 2020 2020 2020 2020 2020 7261 6973 6520            raise 
+00026b50: 5661 6c75 6545 7272 6f72 2822 5261 6e67  ValueError("Rang
+00026b60: 6520 7379 6d62 6f6c 7320 6361 6e27 7420  e symbols can't 
+00026b70: 6265 2069 6e63 6c75 6465 6420 696e 746f  be included into
+00026b80: 2022 0a20 2020 2020 2020 2020 2020 2020   ".             
+00026b90: 2020 2020 2020 2022 6d69 6e69 6d75 6d20         "minimum 
+00026ba0: 616e 6420 6d61 7869 6d75 6d20 6f66 2061  and maximum of a
+00026bb0: 2072 616e 6765 2e20 220a 2020 2020 2020   range. ".      
+00026bc0: 2020 2020 2020 2020 2020 2020 2020 2252                "R
+00026bd0: 6563 6569 7665 6420 7261 6e67 653a 2025  eceived range: %
+00026be0: 7322 2025 2073 7472 2872 2929 0a20 2020  s" % str(r)).   
+00026bf0: 2020 2020 2020 2020 2072 656d 6169 6e69           remaini
+00026c00: 6e67 5f66 7320 3d20 6673 2e64 6966 6665  ng_fs = fs.diffe
+00026c10: 7265 6e63 6528 7061 7261 6d73 2e6b 6579  rence(params.key
+00026c20: 7328 2929 0a20 2020 2020 2020 2020 2020  s()).           
+00026c30: 2069 6620 6c65 6e28 7265 6d61 696e 696e   if len(remainin
+00026c40: 675f 6673 2920 3e20 303a 0a20 2020 2020  g_fs) > 0:.     
+00026c50: 2020 2020 2020 2020 2020 2072 6169 7365             raise
+00026c60: 2056 616c 7565 4572 726f 7228 0a20 2020   ValueError(.   
+00026c70: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00026c80: 2022 556e 6b6f 776e 2073 796d 626f 6c73   "Unkown symbols
+00026c90: 2066 6f75 6e64 2069 6e20 706c 6f74 7469   found in plotti
+00026ca0: 6e67 2072 616e 6765 3a20 2573 2e20 2220  ng range: %s. " 
+00026cb0: 2520 2872 2c29 202b 0a20 2020 2020 2020  % (r,) +.       
+00026cc0: 2020 2020 2020 2020 2020 2020 2022 4172               "Ar
+00026cd0: 6520 7468 6520 666f 6c6c 6f77 696e 6720  e the following 
+00026ce0: 7061 7261 6d65 7465 7273 3f20 2573 2220  parameters? %s" 
+00026cf0: 2520 7265 6d61 696e 696e 675f 6673 290a  % remaining_fs).
+00026d00: 0a0a 636c 6173 7320 4e79 7175 6973 744c  ..class NyquistL
+00026d10: 696e 6553 6572 6965 7328 4172 726f 7773  ineSeries(Arrows
+00026d20: 4d69 7869 6e2c 2043 6f6e 7472 6f6c 4261  Mixin, ControlBa
+00026d30: 7365 5365 7269 6573 293a 0a20 2020 2022  seSeries):.    "
+00026d40: 2222 4765 6e65 7261 7465 7320 6e75 6d65  ""Generates nume
+00026d50: 7269 6361 6c20 6461 7461 2066 6f72 204e  rical data for N
+00026d60: 7971 7569 7374 2070 6c6f 7420 7573 696e  yquist plot usin
+00026d70: 6720 7468 6520 6060 636f 6e74 726f 6c60  g the ``control`
+00026d80: 600a 2020 2020 6d6f 6475 6c65 2e0a 2020  `.    module..  
+00026d90: 2020 2222 220a 0a20 2020 205f 616c 6c6f    """..    _allo
+00026da0: 7765 645f 6b65 7973 203d 205b 0a20 2020  wed_keys = [.   
+00026db0: 2020 2020 2022 6172 726f 7773 222c 2022       "arrows", "
+00026dc0: 6d61 785f 6375 7276 655f 6d61 676e 6974  max_curve_magnit
+00026dd0: 7564 6522 2c20 226d 6178 5f63 7572 7665  ude", "max_curve
+00026de0: 5f6f 6666 7365 7422 2c0a 2020 2020 2020  _offset",.      
+00026df0: 2020 2273 7461 7274 5f6d 6172 6b65 7222    "start_marker"
+00026e00: 2c20 2270 7269 6d61 7279 5f73 7479 6c65  , "primary_style
+00026e10: 222c 2022 6d69 7272 6f72 5f73 7479 6c65  ", "mirror_style
+00026e20: 220a 2020 2020 5d0a 0a20 2020 2064 6566  ".    ]..    def
+00026e30: 205f 636f 7079 5f66 726f 6d5f 6469 6374   _copy_from_dict
+00026e40: 2873 656c 662c 2064 2c20 6b29 3a0a 2020  (self, d, k):.  
+00026e50: 2020 2020 2020 6966 206b 2069 6e20 642e        if k in d.
+00026e60: 6b65 7973 2829 3a0a 2020 2020 2020 2020  keys():.        
+00026e70: 2020 2020 7365 7461 7474 7228 7365 6c66      setattr(self
+00026e80: 2c20 6b2c 2064 5b6b 5d29 0a0a 2020 2020  , k, d[k])..    
+00026e90: 6465 6620 5f5f 696e 6974 5f5f 2873 656c  def __init__(sel
+00026ea0: 662c 2074 662c 2076 6172 5f73 7461 7274  f, tf, var_start
+00026eb0: 5f65 6e64 2c20 6c61 6265 6c3d 2222 2c20  _end, label="", 
+00026ec0: 2a2a 6b77 6172 6773 293a 0a20 2020 2020  **kwargs):.     
+00026ed0: 2020 2073 7570 6572 2829 2e5f 5f69 6e69     super().__ini
+00026ee0: 745f 5f28 7466 2c20 6c61 6265 6c3d 6c61  t__(tf, label=la
+00026ef0: 6265 6c2c 202a 2a6b 7761 7267 7329 0a20  bel, **kwargs). 
+00026f00: 2020 2020 2020 2073 656c 662e 7261 6e67         self.rang
+00026f10: 6573 203d 205b 7661 725f 7374 6172 745f  es = [var_start_
+00026f20: 656e 645d 0a20 2020 2020 2020 2073 656c  end].        sel
+00026f30: 662e 5f63 6865 636b 5f66 7328 290a 0a20  f._check_fs().. 
+00026f40: 2020 2020 2020 2023 2074 6865 7365 2061         # these a
+00026f50: 7474 7269 6275 7465 7320 6172 6520 7573  ttributes are us
+00026f60: 6564 2062 7920 6060 636f 6e74 726f 6c60  ed by ``control`
+00026f70: 6020 696e 2074 6865 2072 656e 6465 7269  ` in the renderi
+00026f80: 6e67 2073 7465 702c 0a20 2020 2020 2020  ng step,.       
+00026f90: 2023 206e 6f74 2069 6e20 7468 6520 6461   # not in the da
+00026fa0: 7461 2067 656e 6572 6174 696f 6e20 7374  ta generation st
+00026fb0: 6570 2e20 4920 6e65 6564 2074 6865 6d20  ep. I need them 
+00026fc0: 6865 7265 2069 6e20 6f72 6465 7220 746f  here in order to
+00026fd0: 0a20 2020 2020 2020 2023 2063 6f6e 7472  .        # contr
+00026fe0: 6f6c 2074 6865 2072 656e 6465 7269 6e67  ol the rendering
+00026ff0: 2069 6e20 6561 6368 2062 6163 6b65 6e64   in each backend
+00027000: 2e0a 2020 2020 2020 2020 7365 6c66 2e6d  ..        self.m
+00027010: 6178 5f63 7572 7665 5f6d 6167 6e69 7475  ax_curve_magnitu
+00027020: 6465 203d 206b 7761 7267 732e 6765 7428  de = kwargs.get(
+00027030: 226d 6178 5f63 7572 7665 5f6d 6167 6e69  "max_curve_magni
+00027040: 7475 6465 222c 2032 3029 0a20 2020 2020  tude", 20).     
+00027050: 2020 2073 656c 662e 6d61 785f 6375 7276     self.max_curv
+00027060: 655f 6f66 6673 6574 203d 206b 7761 7267  e_offset = kwarg
+00027070: 732e 6765 7428 226d 6178 5f63 7572 7665  s.get("max_curve
+00027080: 5f6f 6666 7365 7422 2c20 302e 3032 290a  _offset", 0.02).
+00027090: 2020 2020 2020 2020 7365 6c66 2e73 7461          self.sta
+000270a0: 7274 5f6d 6172 6b65 7220 3d20 6b77 6172  rt_marker = kwar
+000270b0: 6773 2e67 6574 2822 7374 6172 745f 6d61  gs.get("start_ma
+000270c0: 726b 6572 222c 2054 7275 6529 0a20 2020  rker", True).   
+000270d0: 2020 2020 2073 656c 662e 7072 696d 6172       self.primar
+000270e0: 795f 7374 796c 6520 3d20 6b77 6172 6773  y_style = kwargs
+000270f0: 2e67 6574 2822 7072 696d 6172 795f 7374  .get("primary_st
+00027100: 796c 6522 2c20 4e6f 6e65 290a 2020 2020  yle", None).    
+00027110: 2020 2020 7365 6c66 2e6d 6972 726f 725f      self.mirror_
+00027120: 7374 796c 6520 3d20 6b77 6172 6773 2e67  style = kwargs.g
+00027130: 6574 2822 6d69 7272 6f72 5f73 7479 6c65  et("mirror_style
+00027140: 222c 204e 6f6e 6529 0a20 2020 2020 2020  ", None).       
+00027150: 2066 6f72 206b 2069 6e20 5b22 6172 726f   for k in ["arro
+00027160: 7773 222c 2022 6d61 785f 6375 7276 655f  ws", "max_curve_
+00027170: 6d61 676e 6974 7564 6522 2c20 226d 6178  magnitude", "max
+00027180: 5f63 7572 7665 5f6f 6666 7365 7422 2c0a  _curve_offset",.
+00027190: 2020 2020 2020 2020 2020 2020 2273 7461              "sta
+000271a0: 7274 5f6d 6172 6b65 7222 2c20 2270 7269  rt_marker", "pri
+000271b0: 6d61 7279 5f73 7479 6c65 222c 2022 6d69  mary_style", "mi
+000271c0: 7272 6f72 5f73 7479 6c65 225d 3a0a 2020  rror_style"]:.  
+000271d0: 2020 2020 2020 2020 2020 7365 6c66 2e5f            self._
+000271e0: 636f 7079 5f66 726f 6d5f 6469 6374 2873  copy_from_dict(s
+000271f0: 656c 662e 5f63 6f6e 7472 6f6c 5f6b 772c  elf._control_kw,
+00027200: 206b 290a 0a20 2020 2064 6566 205f 5f73   k)..    def __s
+00027210: 7472 5f5f 2873 656c 6629 3a0a 2020 2020  tr__(self):.    
+00027220: 2020 2020 7265 7475 726e 2073 656c 662e      return self.
+00027230: 5f73 7472 5f68 656c 7065 7228 0a20 2020  _str_helper(.   
+00027240: 2020 2020 2020 2020 2022 6e79 7175 6973           "nyquis
+00027250: 7420 6c69 6e65 206f 6620 2573 2220 2520  t line of %s" % 
+00027260: 280a 2020 2020 2020 2020 2020 2020 2020  (.              
+00027270: 2020 7365 6c66 2e5f 6578 7072 2069 6620    self._expr if 
+00027280: 7365 6c66 2e5f 6578 7072 2065 6c73 6520  self._expr else 
+00027290: 7365 6c66 2e5f 636f 6e74 726f 6c5f 7466  self._control_tf
+000272a0: 2929 0a0a 2020 2020 6465 6620 6765 745f  ))..    def get_
+000272b0: 6461 7461 2873 656c 6629 3a0a 2020 2020  data(self):.    
+000272c0: 2020 2020 2222 220a 2020 2020 2020 2020      """.        
+000272d0: 5265 7475 726e 730a 2020 2020 2020 2020  Returns.        
+000272e0: 3d3d 3d3d 3d3d 3d0a 2020 2020 2020 2020  =======.        
+000272f0: 785f 7265 672c 2079 5f72 6567 203a 206e  x_reg, y_reg : n
+00027300: 702e 6e64 6172 7261 790a 2020 2020 2020  p.ndarray.      
+00027310: 2020 785f 7363 6c2c 2079 5f73 636c 203a    x_scl, y_scl :
+00027320: 206e 702e 6e64 6172 7261 790a 2020 2020   np.ndarray.    
+00027330: 2020 2020 785f 696e 7631 2c20 795f 696e      x_inv1, y_in
+00027340: 7631 203a 206e 702e 6e64 6172 7261 790a  v1 : np.ndarray.
+00027350: 2020 2020 2020 2020 785f 696e 7632 2c20          x_inv2, 
+00027360: 795f 696e 7632 203a 206e 702e 6e64 6172  y_inv2 : np.ndar
+00027370: 7261 790a 2020 2020 2020 2020 6375 7276  ray.        curv
+00027380: 655f 6f66 6673 6574 203a 206e 702e 6e64  e_offset : np.nd
+00027390: 6172 7261 790a 2020 2020 2020 2020 2222  array.        ""
+000273a0: 220a 2020 2020 2020 2020 6e70 203d 2069  ".        np = i
+000273b0: 6d70 6f72 745f 6d6f 6475 6c65 2822 6e75  mport_module("nu
+000273c0: 6d70 7922 290a 2020 2020 2020 2020 6374  mpy").        ct
+000273d0: 203d 2069 6d70 6f72 745f 6d6f 6475 6c65   = import_module
+000273e0: 2822 636f 6e74 726f 6c22 290a 2020 2020  ("control").    
+000273f0: 2020 2020 6d65 7267 6564 6565 7020 3d20      mergedeep = 
+00027400: 696d 706f 7274 5f6d 6f64 756c 6528 276d  import_module('m
+00027410: 6572 6765 6465 6570 2729 0a0a 2020 2020  ergedeep')..    
+00027420: 2020 2020 6966 2073 656c 662e 6973 5f69      if self.is_i
+00027430: 6e74 6572 6163 7469 7665 3a0a 2020 2020  nteractive:.    
+00027440: 2020 2020 2020 2020 7466 203d 2073 656c          tf = sel
+00027450: 662e 5f65 7870 722e 7375 6273 2873 656c  f._expr.subs(sel
+00027460: 662e 7061 7261 6d73 290a 2020 2020 2020  f.params).      
+00027470: 2020 2020 2020 7365 6c66 2e5f 636f 6e74        self._cont
+00027480: 726f 6c5f 7466 203d 2074 665f 746f 5f63  rol_tf = tf_to_c
+00027490: 6f6e 7472 6f6c 2874 6629 0a0a 2020 2020  ontrol(tf)..    
+000274a0: 2020 2020 636f 6e74 726f 6c5f 6b77 203d      control_kw =
+000274b0: 207b 7d0a 2020 2020 2020 2020 7379 6d2c   {}.        sym,
+000274c0: 2073 7461 7274 2c20 656e 6420 3d20 7365   start, end = se
+000274d0: 6c66 2e72 616e 6765 735b 305d 0a20 2020  lf.ranges[0].   
+000274e0: 2020 2020 2069 6620 2873 7461 7274 2021       if (start !
+000274f0: 3d20 656e 6429 206f 7220 7365 6c66 2e5f  = end) or self._
+00027500: 696e 7465 7261 6374 6976 655f 7261 6e67  interactive_rang
+00027510: 6573 3a0a 2020 2020 2020 2020 2020 2020  es:.            
+00027520: 7374 6172 7420 3d20 7365 6c66 2e5f 7570  start = self._up
+00027530: 6461 7465 5f72 616e 6765 5f76 616c 7565  date_range_value
+00027540: 2873 7461 7274 292e 7265 616c 0a20 2020  (start).real.   
+00027550: 2020 2020 2020 2020 2065 6e64 203d 2073           end = s
+00027560: 656c 662e 5f75 7064 6174 655f 7261 6e67  elf._update_rang
+00027570: 655f 7661 6c75 6528 656e 6429 2e72 6561  e_value(end).rea
+00027580: 6c0a 2020 2020 2020 2020 2020 2020 636f  l.            co
+00027590: 6e74 726f 6c5f 6b77 5b22 6f6d 6567 615f  ntrol_kw["omega_
+000275a0: 6c69 6d69 7473 225d 203d 205b 3130 2a2a  limits"] = [10**
+000275b0: 7374 6172 742c 2031 302a 2a65 6e64 5d0a  start, 10**end].
+000275c0: 0a20 2020 2020 2020 2063 6b77 203d 206d  .        ckw = m
+000275d0: 6572 6765 6465 6570 2e6d 6572 6765 287b  ergedeep.merge({
+000275e0: 7d2c 2063 6f6e 7472 6f6c 5f6b 772c 2073  }, control_kw, s
+000275f0: 656c 662e 5f63 6f6e 7472 6f6c 5f6b 7729  elf._control_kw)
+00027600: 0a20 2020 2020 2020 2072 6573 706f 6e73  .        respons
+00027610: 655f 6f62 6a20 3d20 6374 2e6e 7971 7569  e_obj = ct.nyqui
+00027620: 7374 5f72 6573 706f 6e73 6528 7365 6c66  st_response(self
+00027630: 2e5f 636f 6e74 726f 6c5f 7466 2c20 2a2a  ._control_tf, **
+00027640: 636b 7729 0a20 2020 2020 2020 2072 6573  ckw).        res
+00027650: 7020 3d20 7265 7370 6f6e 7365 5f6f 626a  p = response_obj
+00027660: 2e72 6573 706f 6e73 650a 2020 2020 2020  .response.      
+00027670: 2020 6966 2072 6573 706f 6e73 655f 6f62    if response_ob
+00027680: 6a2e 6474 2069 6e20 5b30 2c20 4e6f 6e65  j.dt in [0, None
+00027690: 5d3a 0a20 2020 2020 2020 2020 2020 2073  ]:.            s
+000276a0: 706c 616e 655f 636f 6e74 6f75 7220 3d20  plane_contour = 
+000276b0: 7265 7370 6f6e 7365 5f6f 626a 2e63 6f6e  response_obj.con
+000276c0: 746f 7572 0a20 2020 2020 2020 2065 6c73  tour.        els
+000276d0: 653a 0a20 2020 2020 2020 2020 2020 2073  e:.            s
+000276e0: 706c 616e 655f 636f 6e74 6f75 7220 3d20  plane_contour = 
+000276f0: 6e70 2e6c 6f67 2872 6573 706f 6e73 655f  np.log(response_
+00027700: 6f62 6a2e 636f 6e74 6f75 7229 202f 2072  obj.contour) / r
+00027710: 6573 706f 6e73 655f 6f62 6a2e 6474 0a0a  esponse_obj.dt..
+00027720: 2020 2020 2020 2020 6d61 785f 6375 7276          max_curv
+00027730: 655f 6d61 676e 6974 7564 6520 3d20 7365  e_magnitude = se
+00027740: 6c66 2e6d 6178 5f63 7572 7665 5f6d 6167  lf.max_curve_mag
+00027750: 6e69 7475 6465 0a20 2020 2020 2020 206d  nitude.        m
+00027760: 6178 5f63 7572 7665 5f6f 6666 7365 7420  ax_curve_offset 
+00027770: 3d20 7365 6c66 2e6d 6178 5f63 7572 7665  = self.max_curve
+00027780: 5f6f 6666 7365 740a 0a20 2020 2020 2020  _offset..       
+00027790: 2072 6567 5f6d 6173 6b20 3d20 6e70 2e6c   reg_mask = np.l
+000277a0: 6f67 6963 616c 5f6f 7228 0a20 2020 2020  ogical_or(.     
+000277b0: 2020 2020 2020 206e 702e 6162 7328 7265         np.abs(re
+000277c0: 7370 2920 3e20 6d61 785f 6375 7276 655f  sp) > max_curve_
+000277d0: 6d61 676e 6974 7564 652c 0a20 2020 2020  magnitude,.     
+000277e0: 2020 2020 2020 2073 706c 616e 655f 636f         splane_co
+000277f0: 6e74 6f75 722e 7265 616c 2021 3d20 3029  ntour.real != 0)
+00027800: 0a0a 2020 2020 2020 2020 7363 616c 655f  ..        scale_
+00027810: 6d61 736b 203d 207e 7265 675f 6d61 736b  mask = ~reg_mask
+00027820: 205c 0a20 2020 2020 2020 2020 2020 2026   \.            &
+00027830: 206e 702e 636f 6e63 6174 656e 6174 6528   np.concatenate(
+00027840: 287e 7265 675f 6d61 736b 5b31 3a5d 2c20  (~reg_mask[1:], 
+00027850: 7e72 6567 5f6d 6173 6b5b 2d31 3a5d 2929  ~reg_mask[-1:]))
+00027860: 205c 0a20 2020 2020 2020 2020 2020 2026   \.            &
+00027870: 206e 702e 636f 6e63 6174 656e 6174 6528   np.concatenate(
+00027880: 287e 7265 675f 6d61 736b 5b30 3a31 5d2c  (~reg_mask[0:1],
+00027890: 207e 7265 675f 6d61 736b 5b3a 2d31 5d29   ~reg_mask[:-1])
+000278a0: 290a 0a20 2020 2020 2020 2023 2052 6573  )..        # Res
+000278b0: 6361 6c65 2074 6865 2070 6f69 6e74 7320  cale the points 
+000278c0: 7769 7468 206c 6172 6765 206d 6167 6e69  with large magni
+000278d0: 7475 6465 0a20 2020 2020 2020 2072 6573  tude.        res
+000278e0: 6361 6c65 203d 206e 702e 6c6f 6769 6361  cale = np.logica
+000278f0: 6c5f 616e 6428 0a20 2020 2020 2020 2020  l_and(.         
+00027900: 2020 2072 6567 5f6d 6173 6b2c 2061 6273     reg_mask, abs
+00027910: 2872 6573 7029 203e 206d 6178 5f63 7572  (resp) > max_cur
+00027920: 7665 5f6d 6167 6e69 7475 6465 290a 2020  ve_magnitude).  
+00027930: 2020 2020 2020 7265 7370 5b72 6573 6361        resp[resca
+00027940: 6c65 5d20 2a3d 206d 6178 5f63 7572 7665  le] *= max_curve
+00027950: 5f6d 6167 6e69 7475 6465 202f 2061 6273  _magnitude / abs
+00027960: 2872 6573 705b 7265 7363 616c 655d 290a  (resp[rescale]).
+00027970: 0a20 2020 2020 2020 2023 2050 6c6f 7420  .        # Plot 
+00027980: 7468 6520 7265 6775 6c61 7220 706f 7274  the regular port
+00027990: 696f 6e73 206f 6620 7468 6520 6375 7276  ions of the curv
+000279a0: 6520 2861 6e64 2067 7261 6220 7468 6520  e (and grab the 
+000279b0: 636f 6c6f 7229 0a20 2020 2020 2020 2078  color).        x
+000279c0: 5f72 6567 203d 206e 702e 6d61 2e6d 6173  _reg = np.ma.mas
+000279d0: 6b65 645f 7768 6572 6528 7265 675f 6d61  ked_where(reg_ma
+000279e0: 736b 2c20 7265 7370 2e72 6561 6c29 0a20  sk, resp.real). 
+000279f0: 2020 2020 2020 2079 5f72 6567 203d 206e         y_reg = n
+00027a00: 702e 6d61 2e6d 6173 6b65 645f 7768 6572  p.ma.masked_wher
+00027a10: 6528 7265 675f 6d61 736b 2c20 7265 7370  e(reg_mask, resp
+00027a20: 2e69 6d61 6729 0a0a 2020 2020 2020 2020  .imag)..        
+00027a30: 2320 4669 6775 7265 206f 7574 2068 6f77  # Figure out how
+00027a40: 206d 7563 6820 746f 206f 6666 7365 7420   much to offset 
+00027a50: 7468 6520 6375 7276 653a 2074 6865 206f  the curve: the o
+00027a60: 6666 7365 7420 676f 6573 2066 726f 6d0a  ffset goes from.
+00027a70: 2020 2020 2020 2020 2320 7a65 726f 2061          # zero a
+00027a80: 7420 7468 6520 7374 6172 7420 6f66 2074  t the start of t
+00027a90: 6865 2073 6361 6c65 6420 7365 6374 696f  he scaled sectio
+00027aa0: 6e20 746f 206d 6178 5f63 7572 7665 5f6f  n to max_curve_o
+00027ab0: 6666 7365 7420 6173 0a20 2020 2020 2020  ffset as.       
+00027ac0: 2023 2077 6520 6d6f 7665 2061 6c6f 6e67   # we move along
+00027ad0: 2074 6865 2063 7572 7665 0a20 2020 2020   the curve.     
+00027ae0: 2020 2063 7572 7665 5f6f 6666 7365 7420     curve_offset 
+00027af0: 3d20 7365 6c66 2e5f 636f 6d70 7574 655f  = self._compute_
+00027b00: 6375 7276 655f 6f66 6673 6574 280a 2020  curve_offset(.  
+00027b10: 2020 2020 2020 2020 2020 7265 7370 2c20            resp, 
+00027b20: 7363 616c 655f 6d61 736b 2c20 6d61 785f  scale_mask, max_
+00027b30: 6375 7276 655f 6f66 6673 6574 290a 0a20  curve_offset).. 
+00027b40: 2020 2020 2020 2023 2050 6c6f 7420 7468         # Plot th
+00027b50: 6520 7363 616c 6564 2073 6563 7469 6f6e  e scaled section
+00027b60: 7320 6f66 2074 6865 2063 7572 7665 2028  s of the curve (
+00027b70: 6368 616e 6769 6e67 206c 696e 6573 7479  changing linesty
+00027b80: 6c65 290a 2020 2020 2020 2020 785f 7363  le).        x_sc
+00027b90: 6c20 3d20 6e70 2e6d 612e 6d61 736b 6564  l = np.ma.masked
+00027ba0: 5f77 6865 7265 2873 6361 6c65 5f6d 6173  _where(scale_mas
+00027bb0: 6b2c 2072 6573 702e 7265 616c 290a 2020  k, resp.real).  
+00027bc0: 2020 2020 2020 795f 7363 6c20 3d20 6e70        y_scl = np
+00027bd0: 2e6d 612e 6d61 736b 6564 5f77 6865 7265  .ma.masked_where
+00027be0: 2873 6361 6c65 5f6d 6173 6b2c 2072 6573  (scale_mask, res
+00027bf0: 702e 696d 6167 290a 0a20 2020 2020 2020  p.imag)..       
+00027c00: 2023 2074 6865 2070 7269 6d61 7279 2063   # the primary c
+00027c10: 7572 7665 2028 696e 7669 7369 626c 6529  urve (invisible)
+00027c20: 2066 6f72 2073 6574 7469 6e67 2061 7272   for setting arr
+00027c30: 6f77 730a 2020 2020 2020 2020 785f 696e  ows.        x_in
+00027c40: 7631 2c20 795f 696e 7631 203d 2072 6573  v1, y_inv1 = res
+00027c50: 702e 7265 616c 2e63 6f70 7928 292c 2072  p.real.copy(), r
+00027c60: 6573 702e 696d 6167 2e63 6f70 7928 290a  esp.imag.copy().
+00027c70: 2020 2020 2020 2020 785f 696e 7631 5b72          x_inv1[r
+00027c80: 6567 5f6d 6173 6b5d 202a 3d20 2831 202b  eg_mask] *= (1 +
+00027c90: 2063 7572 7665 5f6f 6666 7365 745b 7265   curve_offset[re
+00027ca0: 675f 6d61 736b 5d29 0a20 2020 2020 2020  g_mask]).       
+00027cb0: 2079 5f69 6e76 315b 7265 675f 6d61 736b   y_inv1[reg_mask
+00027cc0: 5d20 2a3d 2028 3120 2b20 6375 7276 655f  ] *= (1 + curve_
+00027cd0: 6f66 6673 6574 5b72 6567 5f6d 6173 6b5d  offset[reg_mask]
+00027ce0: 290a 0a20 2020 2020 2020 2023 2041 6464  )..        # Add
+00027cf0: 2074 6865 2061 7272 6f77 7320 746f 2074   the arrows to t
+00027d00: 6865 206d 6972 726f 7220 696d 6167 6520  he mirror image 
+00027d10: 286f 6e20 746f 7020 6f66 2061 6e20 696e  (on top of an in
+00027d20: 7669 7369 626c 6520 636f 6e74 6f75 7229  visible contour)
+00027d30: 0a20 2020 2020 2020 2078 5f69 6e76 322c  .        x_inv2,
+00027d40: 2079 5f69 6e76 3220 3d20 7265 7370 2e72   y_inv2 = resp.r
+00027d50: 6561 6c2e 636f 7079 2829 2c20 7265 7370  eal.copy(), resp
+00027d60: 2e69 6d61 672e 636f 7079 2829 0a20 2020  .imag.copy().   
+00027d70: 2020 2020 2078 5f69 6e76 325b 7265 675f       x_inv2[reg_
+00027d80: 6d61 736b 5d20 2a3d 2028 3120 2d20 6375  mask] *= (1 - cu
+00027d90: 7276 655f 6f66 6673 6574 5b72 6567 5f6d  rve_offset[reg_m
+00027da0: 6173 6b5d 290a 2020 2020 2020 2020 795f  ask]).        y_
+00027db0: 696e 7632 5b72 6567 5f6d 6173 6b5d 202a  inv2[reg_mask] *
+00027dc0: 3d20 2831 202d 2063 7572 7665 5f6f 6666  = (1 - curve_off
+00027dd0: 7365 745b 7265 675f 6d61 736b 5d29 0a0a  set[reg_mask])..
+00027de0: 2020 2020 2020 2020 7265 7475 726e 2078          return x
+00027df0: 5f72 6567 2c20 795f 7265 672c 2078 5f73  _reg, y_reg, x_s
+00027e00: 636c 2c20 795f 7363 6c2c 2078 5f69 6e76  cl, y_scl, x_inv
+00027e10: 312c 2079 5f69 6e76 312c 2078 5f69 6e76  1, y_inv1, x_inv
+00027e20: 322c 2079 5f69 6e76 322c 2063 7572 7665  2, y_inv2, curve
+00027e30: 5f6f 6666 7365 740a 0a20 2020 2040 7374  _offset..    @st
+00027e40: 6174 6963 6d65 7468 6f64 0a20 2020 2064  aticmethod.    d
+00027e50: 6566 205f 636f 6d70 7574 655f 6375 7276  ef _compute_curv
+00027e60: 655f 6f66 6673 6574 2872 6573 702c 206d  e_offset(resp, m
+00027e70: 6173 6b2c 206d 6178 5f6f 6666 7365 7429  ask, max_offset)
+00027e80: 3a0a 2020 2020 2020 2020 2222 220a 2020  :.        """.  
+00027e90: 2020 2020 2020 2020 2020 4675 6e63 7469            Functi
+00027ea0: 6f6e 2074 6f20 636f 6d70 7574 6520 4e79  on to compute Ny
+00027eb0: 7175 6973 7420 6375 7276 6520 6f66 6673  quist curve offs
+00027ec0: 6574 730a 0a20 2020 2020 2020 2054 6869  ets..        Thi
+00027ed0: 7320 6675 6e63 7469 6f6e 2063 6f6d 7075  s function compu
+00027ee0: 7465 7320 6120 736d 6f6f 7468 6c79 2076  tes a smoothly v
+00027ef0: 6172 7969 6e67 206f 6666 7365 7420 7468  arying offset th
+00027f00: 6174 2073 7461 7274 7320 616e 6420 656e  at starts and en
+00027f10: 6473 2061 740a 2020 2020 2020 2020 7a65  ds at.        ze
+00027f20: 726f 2061 7420 7468 6520 656e 6473 206f  ro at the ends o
+00027f30: 6620 6120 7363 616c 6564 2073 6567 6d65  f a scaled segme
+00027f40: 6e74 2e0a 0a20 2020 2020 2020 2054 6869  nt...        Thi
+00027f50: 7320 6675 6e63 7469 6f6e 2063 6f6d 6573  s function comes
+00027f60: 2066 726f 6d20 6060 636f 6e74 726f 6c2f   from ``control/
+00027f70: 6672 6571 706c 6f74 2e70 7960 602e 0a20  freqplot.py``.. 
+00027f80: 2020 2020 2020 2022 2222 0a20 2020 2020         """.     
+00027f90: 2020 206e 7020 3d20 696d 706f 7274 5f6d     np = import_m
+00027fa0: 6f64 756c 6528 226e 756d 7079 2229 0a0a  odule("numpy")..
+00027fb0: 2020 2020 2020 2020 2320 436f 6d70 7574          # Comput
+00027fc0: 6520 7468 6520 6172 6320 6c65 6e67 7468  e the arc length
+00027fd0: 2061 6c6f 6e67 2074 6865 2063 7572 7665   along the curve
+00027fe0: 0a20 2020 2020 2020 2073 5f63 7572 7665  .        s_curve
+00027ff0: 203d 206e 702e 6375 6d73 756d 280a 2020   = np.cumsum(.  
+00028000: 2020 2020 2020 2020 2020 6e70 2e73 7172            np.sqr
+00028010: 7428 6e70 2e64 6966 6628 7265 7370 2e72  t(np.diff(resp.r
+00028020: 6561 6c29 202a 2a20 3220 2b20 6e70 2e64  eal) ** 2 + np.d
+00028030: 6966 6628 7265 7370 2e69 6d61 6729 202a  iff(resp.imag) *
+00028040: 2a20 3229 290a 0a20 2020 2020 2020 2023  * 2))..        #
+00028050: 2049 6e69 7469 616c 697a 6520 7468 6520   Initialize the 
+00028060: 6f66 6673 6574 0a20 2020 2020 2020 206f  offset.        o
+00028070: 6666 7365 7420 3d20 6e70 2e7a 6572 6f73  ffset = np.zeros
+00028080: 2872 6573 702e 7369 7a65 290a 2020 2020  (resp.size).    
+00028090: 2020 2020 6172 636c 656e 203d 206e 702e      arclen = np.
+000280a0: 7a65 726f 7328 7265 7370 2e73 697a 6529  zeros(resp.size)
+000280b0: 0a0a 2020 2020 2020 2020 2320 5761 6c6b  ..        # Walk
+000280c0: 2074 6872 6f75 6768 2074 6865 2072 6573   through the res
+000280d0: 706f 6e73 6520 616e 6420 6b65 6570 2074  ponse and keep t
+000280e0: 7261 636b 206f 6620 6561 6368 2063 6f6e  rack of each con
+000280f0: 7469 6e6f 7573 2063 6f6d 706f 6e65 6e74  tinous component
+00028100: 0a20 2020 2020 2020 2069 2c20 6e73 6567  .        i, nseg
+00028110: 7320 3d20 302c 2030 0a20 2020 2020 2020  s = 0, 0.       
+00028120: 2077 6869 6c65 2069 203c 2072 6573 702e   while i < resp.
+00028130: 7369 7a65 3a0a 2020 2020 2020 2020 2020  size:.          
+00028140: 2020 2320 536b 6970 2074 6865 2072 6567    # Skip the reg
+00028150: 756c 6172 2073 6567 6d65 6e74 0a20 2020  ular segment.   
+00028160: 2020 2020 2020 2020 2077 6869 6c65 2069           while i
+00028170: 203c 2072 6573 702e 7369 7a65 2061 6e64   < resp.size and
+00028180: 206d 6173 6b5b 695d 3a0a 2020 2020 2020   mask[i]:.      
+00028190: 2020 2020 2020 2020 2020 6920 2b3d 2031            i += 1
+000281a0: 2020 2020 2020 2020 2020 2020 2020 2320                # 
+000281b0: 496e 6372 656d 656e 7420 7468 6520 636f  Increment the co
+000281c0: 756e 7465 720a 2020 2020 2020 2020 2020  unter.          
+000281d0: 2020 2020 2020 6966 2069 203d 3d20 7265        if i == re
+000281e0: 7370 2e73 697a 653a 0a20 2020 2020 2020  sp.size:.       
+000281f0: 2020 2020 2020 2020 2020 2020 2062 7265               bre
+00028200: 616b 0a20 2020 2020 2020 2020 2020 2020  ak.             
+00028210: 2020 2023 204b 6565 7020 7472 6163 6b20     # Keep track 
+00028220: 6f66 2074 6865 2061 7263 6c65 6e67 7468  of the arclength
+00028230: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00028240: 2061 7263 6c65 6e5b 695d 203d 2061 7263   arclen[i] = arc
+00028250: 6c65 6e5b 692d 315d 202b 206e 702e 6162  len[i-1] + np.ab
+00028260: 7328 7265 7370 5b69 5d20 2d20 7265 7370  s(resp[i] - resp
+00028270: 5b69 2d31 5d29 0a0a 2020 2020 2020 2020  [i-1])..        
+00028280: 2020 2020 6e73 6567 7320 2b3d 2030 2e35      nsegs += 0.5
+00028290: 0a20 2020 2020 2020 2020 2020 2069 6620  .            if 
+000282a0: 6920 3d3d 2072 6573 702e 7369 7a65 3a0a  i == resp.size:.
+000282b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000282c0: 6272 6561 6b0a 0a20 2020 2020 2020 2020  break..         
+000282d0: 2020 2023 2053 6176 6520 7468 6520 7374     # Save the st
+000282e0: 6172 7469 6e67 206f 6666 7365 7420 6f66  arting offset of
+000282f0: 2074 6869 7320 7365 676d 656e 740a 2020   this segment.  
+00028300: 2020 2020 2020 2020 2020 7365 675f 7374            seg_st
+00028310: 6172 7420 3d20 690a 0a20 2020 2020 2020  art = i..       
+00028320: 2020 2020 2023 2057 616c 6b20 7468 726f       # Walk thro
+00028330: 7567 6820 7468 6520 7363 616c 6564 2073  ugh the scaled s
+00028340: 6567 6d65 6e74 0a20 2020 2020 2020 2020  egment.         
+00028350: 2020 2077 6869 6c65 2069 203c 2072 6573     while i < res
+00028360: 702e 7369 7a65 2061 6e64 206e 6f74 206d  p.size and not m
+00028370: 6173 6b5b 695d 3a0a 2020 2020 2020 2020  ask[i]:.        
+00028380: 2020 2020 2020 2020 6920 2b3d 2031 0a20          i += 1. 
+00028390: 2020 2020 2020 2020 2020 2020 2020 2069                 i
+000283a0: 6620 6920 3d3d 2072 6573 702e 7369 7a65  f i == resp.size
+000283b0: 3a20 2023 2053 6565 2069 6620 7765 2061  :  # See if we a
+000283c0: 7265 2064 6f6e 6520 7769 7468 2074 6869  re done with thi
+000283d0: 7320 7365 676d 656e 740a 2020 2020 2020  s segment.      
+000283e0: 2020 2020 2020 2020 2020 2020 2020 6272                br
+000283f0: 6561 6b0a 2020 2020 2020 2020 2020 2020  eak.            
+00028400: 2020 2020 2320 4b65 6570 2074 7261 636b      # Keep track
+00028410: 206f 6620 7468 6520 6172 636c 656e 6774   of the arclengt
+00028420: 680a 2020 2020 2020 2020 2020 2020 2020  h.              
+00028430: 2020 6172 636c 656e 5b69 5d20 3d20 6172    arclen[i] = ar
+00028440: 636c 656e 5b69 2d31 5d20 2b20 6e70 2e61  clen[i-1] + np.a
+00028450: 6273 2872 6573 705b 695d 202d 2072 6573  bs(resp[i] - res
+00028460: 705b 692d 315d 290a 0a20 2020 2020 2020  p[i-1])..       
+00028470: 2020 2020 206e 7365 6773 202b 3d20 302e       nsegs += 0.
+00028480: 350a 2020 2020 2020 2020 2020 2020 6966  5.            if
+00028490: 2069 203d 3d20 7265 7370 2e73 697a 653a   i == resp.size:
+000284a0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+000284b0: 2062 7265 616b 0a0a 2020 2020 2020 2020   break..        
+000284c0: 2020 2020 2320 5361 7665 2074 6865 2065      # Save the e
+000284d0: 6e64 696e 6720 6f66 6673 6574 206f 6620  nding offset of 
+000284e0: 7468 6973 2073 6567 6d65 6e74 0a20 2020  this segment.   
+000284f0: 2020 2020 2020 2020 2073 6567 5f65 6e64           seg_end
+00028500: 203d 2069 0a0a 2020 2020 2020 2020 2020   = i..          
+00028510: 2020 2320 4e6f 7720 636f 6d70 7574 6520    # Now compute 
+00028520: 7468 6520 7363 616c 696e 6720 666f 7220  the scaling for 
+00028530: 7468 6973 2073 6567 6d65 6e74 0a20 2020  this segment.   
+00028540: 2020 2020 2020 2020 2073 5f73 6567 6d65           s_segme
+00028550: 6e74 203d 2061 7263 6c65 6e5b 7365 675f  nt = arclen[seg_
+00028560: 656e 642d 315d 202d 2061 7263 6c65 6e5b  end-1] - arclen[
+00028570: 7365 675f 7374 6172 745d 0a20 2020 2020  seg_start].     
+00028580: 2020 2020 2020 206f 6666 7365 745b 7365         offset[se
+00028590: 675f 7374 6172 743a 7365 675f 656e 645d  g_start:seg_end]
+000285a0: 203d 206d 6178 5f6f 6666 7365 7420 2a20   = max_offset * 
+000285b0: 735f 7365 676d 656e 742f 735f 6375 7276  s_segment/s_curv
+000285c0: 655b 2d31 5d20 2a20 5c0a 2020 2020 2020  e[-1] * \.      
+000285d0: 2020 2020 2020 2020 2020 6e70 2e73 696e            np.sin
+000285e0: 286e 702e 7069 202a 2028 6172 636c 656e  (np.pi * (arclen
+000285f0: 5b73 6567 5f73 7461 7274 3a73 6567 5f65  [seg_start:seg_e
+00028600: 6e64 5d0a 2020 2020 2020 2020 2020 2020  nd].            
+00028610: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00028620: 2020 2020 2d20 6172 636c 656e 5b73 6567      - arclen[seg
+00028630: 5f73 7461 7274 5d29 2f73 5f73 6567 6d65  _start])/s_segme
+00028640: 6e74 290a 0a20 2020 2020 2020 2072 6574  nt)..        ret
+00028650: 7572 6e20 6f66 6673 6574 0a0a 0a63 6c61  urn offset...cla
+00028660: 7373 2052 6f6f 744c 6f63 7573 5365 7269  ss RootLocusSeri
+00028670: 6573 2843 6f6e 7472 6f6c 4261 7365 5365  es(ControlBaseSe
+00028680: 7269 6573 293a 0a20 2020 2022 2222 4765  ries):.    """Ge
+00028690: 6e65 7261 7465 7320 6e75 6d65 7269 6361  nerates numerica
+000286a0: 6c20 6461 7461 2066 6f72 2072 6f6f 7420  l data for root 
+000286b0: 6c6f 6375 7320 706c 6f74 2075 7369 6e67  locus plot using
+000286c0: 2074 6865 2060 6063 6f6e 7472 6f6c 6060   the ``control``
+000286d0: 0a20 2020 206d 6f64 756c 652e 0a0a 2020  .    module...  
+000286e0: 2020 5379 6d62 6f6c 6963 2065 7870 7265    Symbolic expre
+000286f0: 7373 696f 6e73 206f 7220 5379 6d50 7927  ssions or SymPy'
+00028700: 7320 7472 616e 7366 6572 2066 756e 6374  s transfer funct
+00028710: 696f 6e73 2061 7265 2063 6f6e 7665 7274  ions are convert
+00028720: 6564 2074 6f0a 2020 2020 6060 636f 6e74  ed to.    ``cont
+00028730: 726f 6c2e 5472 616e 7366 6572 4675 6e63  rol.TransferFunc
+00028740: 7469 6f6e 6060 2e20 4966 2061 2069 6e74  tion``. If a int
+00028750: 6572 6163 7469 7665 2d77 6964 6765 7420  eractive-widget 
+00028760: 706c 6f74 2069 7320 6372 6561 7465 642c  plot is created,
+00028770: 0a20 2020 2061 7420 6561 6368 2077 6964  .    at each wid
+00028780: 6765 7427 7320 7374 6174 652d 6368 616e  get's state-chan
+00028790: 6765 2074 6865 2075 7064 6174 6564 2073  ge the updated s
+000287a0: 796d 626f 6c69 6320 7472 616e 7366 6572  ymbolic transfer
+000287b0: 2066 756e 6374 696f 6e0a 2020 2020 7769   function.    wi
+000287c0: 6c6c 2062 6520 636f 6e76 6572 7465 6420  ll be converted 
+000287d0: 746f 2060 6063 6f6e 7472 6f6c 2e54 7261  to ``control.Tra
+000287e0: 6e73 6665 7246 756e 6374 696f 6e60 602e  nsferFunction``.
+000287f0: 0a0a 2020 2020 4974 2068 6173 2062 6565  ..    It has bee
+00028800: 6e20 7368 6f77 6e20 7468 6174 206e 756d  n shown that num
+00028810: 7079 2e72 6f6f 7473 2829 2070 726f 6475  py.roots() produ
+00028820: 6365 7320 696e 6163 6375 7261 7465 2072  ces inaccurate r
+00028830: 6573 756c 7473 2069 6e0a 2020 2020 636f  esults in.    co
+00028840: 6d70 6172 6973 6f6e 2074 6f20 7379 6d70  mparison to symp
+00028850: 792e 726f 6f74 7328 292e 2068 7474 7073  y.roots(). https
+00028860: 3a2f 2f67 6974 6875 622e 636f 6d2f 7379  ://github.com/sy
+00028870: 6d70 792f 7379 6d70 792f 6973 7375 6573  mpy/sympy/issues
+00028880: 2f32 3532 3334 0a20 2020 2048 6f77 6576  /25234.    Howev
+00028890: 6572 2c20 7765 2061 7265 2064 6561 6c69  er, we are deali
+000288a0: 6e67 2077 6974 6820 6120 726f 6f74 206c  ng with a root l
+000288b0: 6f63 7573 2070 6c6f 742c 2077 6865 7265  ocus plot, where
+000288c0: 2062 7261 6e63 6865 7320 7374 6172 7420   branches start 
+000288d0: 6672 6f6d 0a20 2020 2070 6f6c 6573 2061  from.    poles a
+000288e0: 6e64 2067 6f65 7320 746f 207a 6572 6f73  nd goes to zeros
+000288f0: 2028 6f72 2074 6f20 696e 6669 6e69 7479   (or to infinity
+00028900: 292e 2048 656e 6365 2c20 7468 6573 6520  ). Hence, these 
+00028910: 6572 726f 7273 2061 7265 0a20 2020 206c  errors are.    l
+00028920: 696b 656c 7920 746f 2062 6520 6972 7265  ikely to be irre
+00028930: 6c65 7661 6e74 206f 6e20 6120 7072 6163  levant on a prac
+00028940: 7469 6361 6c20 6361 7365 2e20 5468 6973  tical case. This
+00028950: 2064 6174 6120 7365 7269 6573 2075 7365   data series use
+00028960: 730a 2020 2020 6060 636f 6e74 726f 6c60  s.    ``control`
+00028970: 6020 2868 656e 6365 206e 756d 7079 2920  ` (hence numpy) 
+00028980: 666f 7220 7065 7266 6f72 6d61 6365 2e0a  for performace..
+00028990: 0a20 2020 2052 6566 6572 656e 6365 730a  .    References.
+000289a0: 2020 2020 3d3d 3d3d 3d3d 3d3d 3d3d 0a0a      ==========..
+000289b0: 2020 2020 6874 7470 733a 2f2f 6769 7468      https://gith
+000289c0: 7562 2e63 6f6d 2f70 7974 686f 6e2d 636f  ub.com/python-co
+000289d0: 6e74 726f 6c2f 7079 7468 6f6e 2d63 6f6e  ntrol/python-con
+000289e0: 7472 6f6c 0a0a 2020 2020 2222 220a 0a20  trol..    """.. 
+000289f0: 2020 2064 6566 205f 5f69 6e69 745f 5f28     def __init__(
+00028a00: 7365 6c66 2c20 7466 2c20 6c61 6265 6c3d  self, tf, label=
+00028a10: 2222 2c20 2a2a 6b77 6172 6773 293a 0a20  "", **kwargs):. 
+00028a20: 2020 2020 2020 2073 7570 6572 2829 2e5f         super()._
+00028a30: 5f69 6e69 745f 5f28 7466 2c20 6c61 6265  _init__(tf, labe
+00028a40: 6c3d 6c61 6265 6c2c 202a 2a6b 7761 7267  l=label, **kwarg
+00028a50: 7329 0a20 2020 2020 2020 2073 656c 662e  s).        self.
+00028a60: 5f63 6865 636b 5f66 7328 290a 0a20 2020  _check_fs()..   
+00028a70: 2020 2020 2023 2063 6f6d 7075 7465 2061       # compute a
+00028a80: 7070 726f 7072 6961 7465 2061 7869 7320  ppropriate axis 
+00028a90: 6c69 6d69 7473 2066 726f 6d20 7468 6520  limits from the 
+00028aa0: 7472 616e 7366 6572 2066 756e 6374 696f  transfer functio
+00028ab0: 6e0a 2020 2020 2020 2020 2320 6173 736f  n.        # asso
+00028ac0: 6369 6174 6564 2074 6f20 7468 6973 2064  ciated to this d
+00028ad0: 6174 6120 7365 7269 6573 2e0a 2020 2020  ata series..    
+00028ae0: 2020 2020 7365 6c66 2e5f 786c 696d 203d      self._xlim =
+00028af0: 204e 6f6e 650a 2020 2020 2020 2020 7365   None.        se
+00028b00: 6c66 2e5f 796c 696d 203d 204e 6f6e 650a  lf._ylim = None.
+00028b10: 2020 2020 2020 2020 2320 7a65 726f 7320          # zeros 
+00028b20: 616e 6420 706f 6c65 7320 6172 6520 6e65  and poles are ne
+00028b30: 6365 7373 6172 7920 696e 206f 7264 6572  cessary in order
+00028b40: 2074 6f20 7368 6f77 2061 7070 726f 7072   to show appropr
+00028b50: 6961 7465 206d 6172 6b65 7273 2e0a 2020  iate markers..  
+00028b60: 2020 2020 2020 7365 6c66 2e5f 7a65 726f        self._zero
+00028b70: 7320 3d20 4e6f 6e65 0a20 2020 2020 2020  s = None.       
+00028b80: 2073 656c 662e 5f70 6f6c 6573 203d 204e   self._poles = N
+00028b90: 6f6e 650a 0a20 2020 2020 2020 2073 656c  one..        sel
+00028ba0: 662e 5f7a 6572 6f73 5f72 6b20 3d20 6b77  f._zeros_rk = kw
+00028bb0: 6172 6773 2e67 6574 2822 7a65 726f 735f  args.get("zeros_
+00028bc0: 726b 222c 2064 6963 7428 2929 0a20 2020  rk", dict()).   
+00028bd0: 2020 2020 2073 656c 662e 5f70 6f6c 6573       self._poles
+00028be0: 5f72 6b20 3d20 6b77 6172 6773 2e67 6574  _rk = kwargs.get
+00028bf0: 2822 706f 6c65 735f 726b 222c 2064 6963  ("poles_rk", dic
+00028c00: 7428 2929 0a0a 2020 2020 6465 6620 5f5f  t())..    def __
+00028c10: 7374 725f 5f28 7365 6c66 293a 0a20 2020  str__(self):.   
+00028c20: 2020 2020 2065 7870 7220 3d20 7365 6c66       expr = self
+00028c30: 2e5f 6578 7072 2069 6620 7365 6c66 2e5f  ._expr if self._
+00028c40: 6578 7072 2065 6c73 6520 7365 6c66 2e5f  expr else self._
+00028c50: 636f 6e74 726f 6c5f 7466 0a20 2020 2020  control_tf.     
+00028c60: 2020 2072 6574 7572 6e20 2272 6f6f 7420     return "root 
+00028c70: 6c6f 6375 7320 6f66 2022 202b 2073 7472  locus of " + str
+00028c80: 2865 7870 7229 0a0a 2020 2020 4070 726f  (expr)..    @pro
+00028c90: 7065 7274 790a 2020 2020 6465 6620 7a65  perty.    def ze
+00028ca0: 726f 7328 7365 6c66 293a 0a20 2020 2020  ros(self):.     
+00028cb0: 2020 2069 6620 7365 6c66 2e5f 7a65 726f     if self._zero
+00028cc0: 7320 6973 204e 6f6e 653a 0a20 2020 2020  s is None:.     
+00028cd0: 2020 2020 2020 2073 656c 662e 6765 745f         self.get_
+00028ce0: 6461 7461 2829 0a20 2020 2020 2020 2072  data().        r
+00028cf0: 6574 7572 6e20 7365 6c66 2e5f 7a65 726f  eturn self._zero
+00028d00: 730a 0a20 2020 2040 7072 6f70 6572 7479  s..    @property
+00028d10: 0a20 2020 2064 6566 2070 6f6c 6573 2873  .    def poles(s
+00028d20: 656c 6629 3a0a 2020 2020 2020 2020 6966  elf):.        if
+00028d30: 2073 656c 662e 5f70 6f6c 6573 2069 7320   self._poles is 
+00028d40: 4e6f 6e65 3a0a 2020 2020 2020 2020 2020  None:.          
+00028d50: 2020 7365 6c66 2e67 6574 5f64 6174 6128    self.get_data(
+00028d60: 290a 2020 2020 2020 2020 7265 7475 726e  ).        return
+00028d70: 2073 656c 662e 5f70 6f6c 6573 0a0a 2020   self._poles..  
+00028d80: 2020 4070 726f 7065 7274 790a 2020 2020    @property.    
+00028d90: 6465 6620 786c 696d 2873 656c 6629 3a0a  def xlim(self):.
+00028da0: 2020 2020 2020 2020 7265 7475 726e 2073          return s
+00028db0: 656c 662e 5f78 6c69 6d0a 0a20 2020 2040  elf._xlim..    @
+00028dc0: 7072 6f70 6572 7479 0a20 2020 2064 6566  property.    def
+00028dd0: 2079 6c69 6d28 7365 6c66 293a 0a20 2020   ylim(self):.   
+00028de0: 2020 2020 2072 6574 7572 6e20 7365 6c66       return self
+00028df0: 2e5f 796c 696d 0a0a 2020 2020 6465 6620  ._ylim..    def 
+00028e00: 6765 745f 6461 7461 2873 656c 6629 3a0a  get_data(self):.
+00028e10: 2020 2020 2020 2020 2222 220a 2020 2020          """.    
+00028e20: 2020 2020 5265 7475 726e 730a 2020 2020      Returns.    
+00028e30: 2020 2020 3d3d 3d3d 3d3d 3d0a 2020 2020      =======.    
+00028e40: 2020 2020 726f 6f74 7320 3a20 6e64 6172      roots : ndar
+00028e50: 7261 790a 2020 2020 2020 2020 2020 2020  ray.            
+00028e60: 436c 6f73 6564 2d6c 6f6f 7020 726f 6f74  Closed-loop root
+00028e70: 206c 6f63 6174 696f 6e73 2c20 6172 7261   locations, arra
+00028e80: 6e67 6564 2069 6e20 7768 6963 6820 6561  nged in which ea
+00028e90: 6368 2072 6f77 2063 6f72 7265 7370 6f6e  ch row correspon
+00028ea0: 6473 0a20 2020 2020 2020 2020 2020 2074  ds.            t
+00028eb0: 6f20 6120 6761 696e 2069 6e20 6761 696e  o a gain in gain
+00028ec0: 730a 2020 2020 2020 2020 6761 696e 7320  s.        gains 
+00028ed0: 3a20 6e64 6172 7261 790a 2020 2020 2020  : ndarray.      
+00028ee0: 2020 2020 2020 4761 696e 7320 7573 6564        Gains used
+00028ef0: 2e20 2053 616d 6520 6173 206b 7665 6374  .  Same as kvect
+00028f00: 206b 6579 776f 7264 2061 7267 756d 656e   keyword argumen
+00028f10: 7420 6966 2070 726f 7669 6465 642e 0a20  t if provided.. 
+00028f20: 2020 2020 2020 2022 2222 0a20 2020 2020         """.     
+00028f30: 2020 2063 7420 3d20 696d 706f 7274 5f6d     ct = import_m
+00028f40: 6f64 756c 6528 2263 6f6e 7472 6f6c 2229  odule("control")
+00028f50: 0a20 2020 2020 2020 2023 2054 4f44 4f3a  .        # TODO:
+00028f60: 206f 7065 6e20 5052 206f 6e20 636f 6e74   open PR on cont
+00028f70: 726f 6c20 616e 6420 696d 706c 656d 656e  rol and implemen
+00028f80: 7420 6120 6d65 7468 6f64 2069 6e73 6964  t a method insid
+00028f90: 6520 7468 6520 6f62 6a65 6374 0a20 2020  e the object.   
+00028fa0: 2020 2020 2023 2072 6574 7572 6e65 6420       # returned 
+00028fb0: 6279 2072 6f6f 745f 6c6f 6375 735f 6d61  by root_locus_ma
+00028fc0: 702c 2073 6f20 7468 6174 2077 6520 646f  p, so that we do
+00028fd0: 6e27 7420 6861 7665 2074 6f20 6465 616c  n't have to deal
+00028fe0: 2077 6974 680a 2020 2020 2020 2020 2320   with.        # 
+00028ff0: 7072 6976 6174 6520 6d65 7468 6f64 732e  private methods.
+00029000: 0a20 2020 2020 2020 2066 726f 6d20 636f  .        from co
+00029010: 6e74 726f 6c2e 707a 6d61 7020 696d 706f  ntrol.pzmap impo
+00029020: 7274 205f 636f 6d70 7574 655f 726f 6f74  rt _compute_root
+00029030: 5f6c 6f63 7573 5f6c 696d 6974 730a 0a20  _locus_limits.. 
+00029040: 2020 2020 2020 2069 6620 7365 6c66 2e69         if self.i
+00029050: 735f 696e 7465 7261 6374 6976 653a 0a20  s_interactive:. 
+00029060: 2020 2020 2020 2020 2020 2074 6620 3d20             tf = 
+00029070: 7365 6c66 2e5f 6578 7072 2e73 7562 7328  self._expr.subs(
+00029080: 7365 6c66 2e70 6172 616d 7329 0a20 2020  self.params).   
+00029090: 2020 2020 2020 2020 2073 656c 662e 5f63           self._c
+000290a0: 6f6e 7472 6f6c 5f74 6620 3d20 7466 5f74  ontrol_tf = tf_t
+000290b0: 6f5f 636f 6e74 726f 6c28 7466 290a 0a20  o_control(tf).. 
+000290c0: 2020 2020 2020 2073 656c 662e 5f7a 6572         self._zer
+000290d0: 6f73 203d 2073 656c 662e 5f63 6f6e 7472  os = self._contr
+000290e0: 6f6c 5f74 662e 7a65 726f 7328 290a 2020  ol_tf.zeros().  
+000290f0: 2020 2020 2020 7365 6c66 2e5f 706f 6c65        self._pole
+00029100: 7320 3d20 7365 6c66 2e5f 636f 6e74 726f  s = self._contro
+00029110: 6c5f 7466 2e70 6f6c 6573 2829 0a20 2020  l_tf.poles().   
+00029120: 2020 2020 2064 6174 6120 3d20 6374 2e72       data = ct.r
+00029130: 6f6f 745f 6c6f 6375 735f 6d61 7028 0a20  oot_locus_map(. 
+00029140: 2020 2020 2020 2020 2020 2073 656c 662e             self.
+00029150: 5f63 6f6e 7472 6f6c 5f74 662c 202a 2a73  _control_tf, **s
+00029160: 656c 662e 5f63 6f6e 7472 6f6c 5f6b 7729  elf._control_kw)
+00029170: 0a20 2020 2020 2020 2073 656c 662e 5f78  .        self._x
+00029180: 6c69 6d2c 2073 656c 662e 5f79 6c69 6d20  lim, self._ylim 
+00029190: 3d20 5f63 6f6d 7075 7465 5f72 6f6f 745f  = _compute_root_
+000291a0: 6c6f 6375 735f 6c69 6d69 7473 2864 6174  locus_limits(dat
+000291b0: 6129 0a20 2020 2020 2020 2072 6574 7572  a).        retur
+000291c0: 6e20 6461 7461 2e6c 6f63 692c 2064 6174  n data.loci, dat
+000291d0: 612e 6761 696e 730a 0a0a 0a63 6c61 7373  a.gains....class
+000291e0: 2053 7973 7465 6d52 6573 706f 6e73 6553   SystemResponseS
+000291f0: 6572 6965 7328 436f 6e74 726f 6c42 6173  eries(ControlBas
+00029200: 6553 6572 6965 7329 3a0a 2020 2020 2222  eSeries):.    ""
+00029210: 2252 6570 7265 7365 6e74 2061 2073 7973  "Represent a sys
+00029220: 7465 6d20 7265 7370 6f6e 7365 2063 6f6d  tem response com
+00029230: 7075 7465 6420 7769 7468 2074 6865 2060  puted with the `
+00029240: 6063 6f6e 7472 6f6c 6060 206d 6f64 756c  `control`` modul
+00029250: 652e 0a0a 2020 2020 436f 6d70 7574 696e  e...    Computin
+00029260: 6720 7468 6520 696e 7665 7273 6520 6c61  g the inverse la
+00029270: 706c 6163 6520 7472 616e 7366 6f72 6d20  place transform 
+00029280: 6f66 2061 2073 7973 7465 6d20 7769 7468  of a system with
+00029290: 2053 796d 5079 2069 7320 6e6f 740a 2020   SymPy is not.  
+000292a0: 2020 7472 6976 6961 6c3a 2073 6f6d 6574    trivial: somet
+000292b0: 696d 6573 2069 7420 776f 726b 7320 6669  imes it works fi
+000292c0: 6e65 2c20 6f74 6865 7220 7469 6d65 7320  ne, other times 
+000292d0: 6974 2070 726f 6475 6365 7320 7772 6f6e  it produces wron
+000292e0: 6720 7265 7375 6c74 732c 0a20 2020 206f  g results,.    o
+000292f0: 7468 6572 2074 696d 6573 2069 7420 6a75  ther times it ju
+00029300: 7374 2063 6f6e 7375 6d65 7320 746f 206d  st consumes to m
+00029310: 7563 6820 6d65 6d6f 7279 2065 7665 6e20  uch memory even 
+00029320: 666f 7220 7472 6976 6961 6c20 7472 616e  for trivial tran
+00029330: 7366 6572 0a20 2020 2066 756e 6374 696f  sfer.    functio
+00029340: 6e73 2e20 5468 6973 2069 7320 7472 7565  ns. This is true
+00029350: 2066 6f72 2062 6f74 6820 7468 6520 7075   for both the pu
+00029360: 626c 6963 2060 6069 6e76 6572 7365 5f6c  blic ``inverse_l
+00029370: 6170 6c61 6365 5f74 7261 6e73 666f 726d  aplace_transform
+00029380: 6060 0a20 2020 2061 7320 7765 6c6c 2061  ``.    as well a
+00029390: 7320 7468 6520 7072 6976 6174 6520 6060  s the private ``
+000293a0: 5f66 6173 745f 696e 7665 7273 655f 6c61  _fast_inverse_la
+000293b0: 706c 6163 6560 6020 7573 6564 2069 6e0a  place`` used in.
+000293c0: 2020 2020 6060 7370 622e 6772 6170 6869      ``spb.graphi
+000293d0: 6373 2e63 6f6e 7472 6f6c 6060 2e0a 0a20  cs.control``... 
+000293e0: 2020 2049 6e20 6f72 6465 7220 746f 2061     In order to a
+000293f0: 6464 7265 7373 2074 6865 7365 2069 7373  ddress these iss
+00029400: 7565 732c 206c 6574 2773 2065 7661 6c75  ues, let's evalu
+00029410: 6174 6520 7468 6520 7379 7374 656d 2077  ate the system w
+00029420: 6974 6820 7468 650a 2020 2020 6060 636f  ith the.    ``co
+00029430: 6e74 726f 6c60 6020 6d6f 6475 6c65 2e20  ntrol`` module. 
+00029440: 5375 7265 2c20 6974 2072 656c 6965 7320  Sure, it relies 
+00029450: 6f6e 206e 756d 6572 6963 616c 2069 6e74  on numerical int
+00029460: 6567 7261 7469 6f6e 2c20 6865 6e63 6520  egration, hence 
+00029470: 6572 726f 7273 2e0a 2020 2020 4275 742c  errors..    But,
+00029480: 2061 7420 6c65 6173 7420 6974 2064 6f65   at least it doe
+00029490: 736e 2774 2063 7261 7368 2074 6865 206d  sn't crash the m
+000294a0: 6163 6869 6e65 2061 6e64 2069 7420 6973  achine and it is
+000294b0: 2072 656c 6961 626c 652e 0a20 2020 2022   reliable..    "
+000294c0: 2222 0a0a 2020 2020 6465 6620 5f5f 6e65  ""..    def __ne
+000294d0: 775f 5f28 636c 732c 202a 6172 6773 2c20  w__(cls, *args, 
+000294e0: 2a2a 6b77 6172 6773 293a 0a20 2020 2020  **kwargs):.     
+000294f0: 2020 2063 6620 3d20 6b77 6172 6773 2e67     cf = kwargs.g
+00029500: 6574 2822 636f 6c6f 725f 6675 6e63 222c  et("color_func",
+00029510: 204e 6f6e 6529 0a20 2020 2020 2020 206c   None).        l
+00029520: 6320 3d20 6b77 6172 6773 2e67 6574 2822  c = kwargs.get("
+00029530: 6c69 6e65 5f63 6f6c 6f72 222c 204e 6f6e  line_color", Non
+00029540: 6529 0a20 2020 2020 2020 2069 6620 2863  e).        if (c
+00029550: 616c 6c61 626c 6528 6366 2920 6f72 2063  allable(cf) or c
+00029560: 616c 6c61 626c 6528 6c63 2920 6f72 2069  allable(lc) or i
+00029570: 7369 6e73 7461 6e63 6528 6366 2c20 4578  sinstance(cf, Ex
+00029580: 7072 2929 3a0a 2020 2020 2020 2020 2020  pr)):.          
+00029590: 2020 7265 7475 726e 2073 7570 6572 2829    return super()
+000295a0: 2e5f 5f6e 6577 5f5f 2843 6f6c 6f72 6564  .__new__(Colored
+000295b0: 5379 7374 656d 5265 7370 6f6e 7365 5365  SystemResponseSe
+000295c0: 7269 6573 290a 2020 2020 2020 2020 7265  ries).        re
+000295d0: 7475 726e 206f 626a 6563 742e 5f5f 6e65  turn object.__ne
+000295e0: 775f 5f28 636c 7329 0a0a 2020 2020 6465  w__(cls)..    de
+000295f0: 6620 5f5f 696e 6974 5f5f 2873 656c 662c  f __init__(self,
+00029600: 2074 662c 2076 6172 5f73 7461 7274 5f65   tf, var_start_e
+00029610: 6e64 2c20 6c61 6265 6c3d 2222 2c20 2a2a  nd, label="", **
+00029620: 6b77 6172 6773 293a 0a20 2020 2020 2020  kwargs):.       
+00029630: 2073 7570 6572 2829 2e5f 5f69 6e69 745f   super().__init_
+00029640: 5f28 7466 2c20 6c61 6265 6c3d 6c61 6265  _(tf, label=labe
+00029650: 6c2c 202a 2a6b 7761 7267 7329 0a20 2020  l, **kwargs).   
+00029660: 2020 2020 2073 656c 662e 7261 6e67 6573       self.ranges
+00029670: 203d 205b 7661 725f 7374 6172 745f 656e   = [var_start_en
+00029680: 645d 0a20 2020 2020 2020 2073 656c 662e  d].        self.
+00029690: 5f63 6865 636b 5f66 7328 290a 2020 2020  _check_fs().    
+000296a0: 2020 2020 2320 6469 7363 7265 7469 7a65      # discretize
+000296b0: 2074 6865 2064 6f6d 6169 6e20 7573 696e   the domain usin
+000296c0: 6720 6f6e 6c79 2069 6e74 6567 6572 206e  g only integer n
+000296d0: 756d 6265 7273 0a20 2020 2020 2020 2073  umbers.        s
+000296e0: 656c 662e 6f6e 6c79 5f69 6e74 6567 6572  elf.only_integer
+000296f0: 7320 3d20 6b77 6172 6773 2e67 6574 2822  s = kwargs.get("
+00029700: 6f6e 6c79 5f69 6e74 6567 6572 7322 2c20  only_integers", 
+00029710: 4661 6c73 6529 0a0a 2020 2020 2020 2020  False)..        
+00029720: 7274 203d 206b 7761 7267 732e 6765 7428  rt = kwargs.get(
+00029730: 2272 6573 706f 6e73 655f 7479 7065 222c  "response_type",
+00029740: 2022 7374 6570 2229 0a20 2020 2020 2020   "step").       
+00029750: 2072 7420 3d20 7274 2e6c 6f77 6572 2829   rt = rt.lower()
+00029760: 2069 6620 6973 696e 7374 616e 6365 2872   if isinstance(r
+00029770: 742c 2073 7472 2920 656c 7365 2072 740a  t, str) else rt.
+00029780: 2020 2020 2020 2020 616c 6c6f 7765 645f          allowed_
+00029790: 7265 7370 6f6e 7365 5f74 7970 6573 203d  response_types =
+000297a0: 205b 2269 6d70 756c 7365 222c 2022 7374   ["impulse", "st
+000297b0: 6570 222c 2022 7261 6d70 225d 0a20 2020  ep", "ramp"].   
+000297c0: 2020 2020 2069 6620 286e 6f74 2069 7369       if (not isi
+000297d0: 6e73 7461 6e63 6528 7274 2c20 7374 7229  nstance(rt, str)
+000297e0: 2920 6f72 2028 7274 206e 6f74 2069 6e20  ) or (rt not in 
+000297f0: 616c 6c6f 7765 645f 7265 7370 6f6e 7365  allowed_response
+00029800: 5f74 7970 6573 293a 0a20 2020 2020 2020  _types):.       
+00029810: 2020 2020 2072 6169 7365 2056 616c 7565       raise Value
+00029820: 4572 726f 7228 0a20 2020 2020 2020 2020  Error(.         
+00029830: 2020 2020 2020 2022 6060 7265 7370 6f6e         "``respon
+00029840: 7365 5f74 7970 6560 6020 6d75 7374 2062  se_type`` must b
+00029850: 6520 6f6e 6520 6f66 2074 6865 2066 6f6c  e one of the fol
+00029860: 6c6f 7769 6e67 3a20 2573 5c6e 220a 2020  lowing: %s\n".  
+00029870: 2020 2020 2020 2020 2020 2020 2020 2252                "R
+00029880: 6563 6569 7665 643a 2025 7322 2025 2028  eceived: %s" % (
+00029890: 7274 2c20 616c 6c6f 7765 645f 7265 7370  rt, allowed_resp
+000298a0: 6f6e 7365 5f74 7970 6573 290a 2020 2020  onse_types).    
+000298b0: 2020 2020 2020 2020 290a 2020 2020 2020          ).      
+000298c0: 2020 7365 6c66 2e5f 7265 7370 6f6e 7365    self._response
+000298d0: 5f74 7970 6520 3d20 7274 0a0a 2020 2020  _type = rt..    
+000298e0: 2020 2020 7374 6570 7320 3d20 6b77 6172      steps = kwar
+000298f0: 6773 2e67 6574 2822 7374 6570 7322 2c20  gs.get("steps", 
+00029900: 4e6f 6e65 290a 2020 2020 2020 2020 6966  None).        if
+00029910: 2073 7465 7073 2069 7320 4e6f 6e65 3a0a   steps is None:.
+00029920: 2020 2020 2020 2020 2020 2020 6966 2073              if s
+00029930: 656c 662e 5f65 7870 7220 6973 204e 6f6e  elf._expr is Non
+00029940: 653a 0a20 2020 2020 2020 2020 2020 2020  e:.             
+00029950: 2020 2073 656c 662e 7374 6570 7320 3d20     self.steps = 
+00029960: 7365 6c66 2e5f 636f 6e74 726f 6c5f 7466  self._control_tf
+00029970: 2e69 7364 7469 6d65 2829 0a20 2020 2020  .isdtime().     
+00029980: 2020 2020 2020 2065 6c73 653a 0a20 2020         else:.   
+00029990: 2020 2020 2020 2020 2020 2020 2073 656c               sel
+000299a0: 662e 7374 6570 7320 3d20 4661 6c73 650a  f.steps = False.
+000299b0: 2020 2020 2020 2020 656c 7365 3a0a 2020          else:.  
+000299c0: 2020 2020 2020 2020 2020 7365 6c66 2e73            self.s
+000299d0: 7465 7073 203d 2073 7465 7073 0a20 2020  teps = steps.   
+000299e0: 2020 2020 2023 2074 696d 6520 7661 6c75       # time valu
+000299f0: 6573 206f 7665 7220 7768 6963 6820 7468  es over which th
+00029a00: 6520 6576 616c 7561 7469 6f6e 2077 696c  e evaluation wil
+00029a10: 6c20 6265 2070 6572 666f 726d 6564 0a20  l be performed. 
+00029a20: 2020 2020 2020 2073 656c 662e 5f74 696d         self._tim
+00029a30: 655f 6172 7261 7920 3d20 4e6f 6e65 0a0a  e_array = None..
+00029a40: 2020 2020 6465 6620 5f5f 7374 725f 5f28      def __str__(
+00029a50: 7365 6c66 293a 0a20 2020 2020 2020 2072  self):.        r
+00029a60: 6574 7572 6e20 7365 6c66 2e5f 7374 725f  eturn self._str_
+00029a70: 6865 6c70 6572 280a 2020 2020 2020 2020  helper(.        
+00029a80: 2020 2020 2225 7320 7265 7370 6f6e 7365      "%s response
+00029a90: 206f 6620 2573 2220 2520 280a 2020 2020   of %s" % (.    
+00029aa0: 2020 2020 2020 2020 2020 2020 7365 6c66              self
+00029ab0: 2e5f 7265 7370 6f6e 7365 5f74 7970 652c  ._response_type,
+00029ac0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00029ad0: 2073 656c 662e 5f65 7870 7220 6966 2073   self._expr if s
+00029ae0: 656c 662e 5f65 7870 7220 656c 7365 2073  elf._expr else s
+00029af0: 656c 662e 5f63 6f6e 7472 6f6c 5f74 6629  elf._control_tf)
+00029b00: 290a 0a20 2020 2064 6566 205f 6765 745f  )..    def _get_
+00029b10: 6461 7461 5f68 656c 7065 7228 7365 6c66  data_helper(self
+00029b20: 293a 0a20 2020 2020 2020 2063 7420 3d20  ):.        ct = 
+00029b30: 696d 706f 7274 5f6d 6f64 756c 6528 2263  import_module("c
+00029b40: 6f6e 7472 6f6c 2229 0a20 2020 2020 2020  ontrol").       
+00029b50: 206e 7020 3d20 696d 706f 7274 5f6d 6f64   np = import_mod
+00029b60: 756c 6528 226e 756d 7079 2229 0a20 2020  ule("numpy").   
+00029b70: 2020 2020 206d 6572 6765 6465 6570 203d       mergedeep =
+00029b80: 2069 6d70 6f72 745f 6d6f 6475 6c65 2827   import_module('
+00029b90: 6d65 7267 6564 6565 7027 290a 0a20 2020  mergedeep')..   
+00029ba0: 2020 2020 2069 6620 7365 6c66 2e69 735f       if self.is_
+00029bb0: 696e 7465 7261 6374 6976 653a 0a20 2020  interactive:.   
+00029bc0: 2020 2020 2020 2020 2074 6620 3d20 7365           tf = se
+00029bd0: 6c66 2e5f 6578 7072 2e73 7562 7328 7365  lf._expr.subs(se
+00029be0: 6c66 2e70 6172 616d 7329 0a20 2020 2020  lf.params).     
+00029bf0: 2020 2020 2020 2073 656c 662e 5f63 6f6e         self._con
+00029c00: 7472 6f6c 5f74 6620 3d20 7466 5f74 6f5f  trol_tf = tf_to_
+00029c10: 636f 6e74 726f 6c28 7466 290a 0a20 2020  control(tf)..   
+00029c20: 2020 2020 2023 2063 7265 6174 6520 286f       # create (o
+00029c30: 7220 7570 6461 7465 2920 7468 6520 6469  r update) the di
+00029c40: 7363 7265 7469 7a65 6420 646f 6d61 696e  scretized domain
+00029c50: 0a20 2020 2020 2020 205f 2c20 7374 6172  .        _, star
+00029c60: 742c 2065 6e64 203d 2073 656c 662e 7261  t, end = self.ra
+00029c70: 6e67 6573 5b30 5d0a 2020 2020 2020 2020  nges[0].        
+00029c80: 6966 2073 656c 662e 5f69 6e74 6572 6163  if self._interac
+00029c90: 7469 7665 5f72 616e 6765 733a 0a20 2020  tive_ranges:.   
+00029ca0: 2020 2020 2020 2020 2073 7461 7274 203d           start =
+00029cb0: 2073 656c 662e 5f75 7064 6174 655f 7261   self._update_ra
+00029cc0: 6e67 655f 7661 6c75 6528 7374 6172 7429  nge_value(start)
+00029cd0: 2e72 6561 6c0a 2020 2020 2020 2020 2020  .real.          
+00029ce0: 2020 656e 6420 3d20 7365 6c66 2e5f 7570    end = self._up
+00029cf0: 6461 7465 5f72 616e 6765 5f76 616c 7565  date_range_value
+00029d00: 2865 6e64 292e 7265 616c 0a20 2020 2020  (end).real.     
+00029d10: 2020 2065 6c73 653a 0a20 2020 2020 2020     else:.       
+00029d20: 2020 2020 2073 7461 7274 2c20 656e 6420       start, end 
+00029d30: 3d20 666c 6f61 7428 7374 6172 7429 2c20  = float(start), 
+00029d40: 666c 6f61 7428 656e 6429 0a0a 2020 2020  float(end)..    
+00029d50: 2020 2020 6966 2028 7365 6c66 2e5f 7469      if (self._ti
+00029d60: 6d65 5f61 7272 6179 2069 7320 4e6f 6e65  me_array is None
+00029d70: 2920 6f72 2073 656c 662e 5f69 6e74 6572  ) or self._inter
+00029d80: 6163 7469 7665 5f72 616e 6765 733a 0a20  active_ranges:. 
+00029d90: 2020 2020 2020 2020 2020 2069 6620 6e6f             if no
+00029da0: 7420 7365 6c66 2e5f 636f 6e74 726f 6c5f  t self._control_
+00029db0: 7466 2e69 7364 7469 6d65 2829 3a0a 2020  tf.isdtime():.  
+00029dc0: 2020 2020 2020 2020 2020 2020 2020 6e20                n 
+00029dd0: 3d20 7365 6c66 2e6e 5b30 5d0a 2020 2020  = self.n[0].    
+00029de0: 2020 2020 2020 2020 656c 7365 3a0a 2020          else:.  
+00029df0: 2020 2020 2020 2020 2020 2020 2020 6e20                n 
+00029e00: 3d20 696e 7428 2865 6e64 202d 2073 7461  = int((end - sta
+00029e10: 7274 2920 2f20 7365 6c66 2e5f 636f 6e74  rt) / self._cont
+00029e20: 726f 6c5f 7466 2e64 7429 202b 2031 0a20  rol_tf.dt) + 1. 
+00029e30: 2020 2020 2020 2020 2020 2020 2020 2065                 e
+00029e40: 6e64 203d 2028 6e20 2d20 3129 202a 2073  nd = (n - 1) * s
+00029e50: 656c 662e 5f63 6f6e 7472 6f6c 5f74 662e  elf._control_tf.
+00029e60: 6474 0a20 2020 2020 2020 2020 2020 2073  dt.            s
+00029e70: 656c 662e 5f74 696d 655f 6172 7261 7920  elf._time_array 
+00029e80: 3d20 7365 6c66 2e5f 6469 7363 7265 7469  = self._discreti
+00029e90: 7a65 280a 2020 2020 2020 2020 2020 2020  ze(.            
+00029ea0: 2020 2020 2020 2020 7374 6172 742c 2065          start, e
+00029eb0: 6e64 2c20 6e2c 2073 656c 662e 7363 616c  nd, n, self.scal
+00029ec0: 6573 5b30 5d2c 2073 656c 662e 6f6e 6c79  es[0], self.only
+00029ed0: 5f69 6e74 6567 6572 7329 0a0a 2020 2020  _integers)..    
+00029ee0: 2020 2020 636f 6e74 726f 6c5f 6b77 203d      control_kw =
+00029ef0: 207b 2254 223a 2073 656c 662e 5f74 696d   {"T": self._tim
+00029f00: 655f 6172 7261 792c 2022 7371 7565 657a  e_array, "squeez
+00029f10: 6522 3a20 5472 7565 7d0a 0a20 2020 2020  e": True}..     
+00029f20: 2020 2069 6620 7365 6c66 2e5f 7265 7370     if self._resp
+00029f30: 6f6e 7365 5f74 7970 6520 3d3d 2022 7374  onse_type == "st
+00029f40: 6570 223a 0a20 2020 2020 2020 2020 2020  ep":.           
+00029f50: 2063 6b77 203d 206d 6572 6765 6465 6570   ckw = mergedeep
+00029f60: 2e6d 6572 6765 287b 7d2c 2063 6f6e 7472  .merge({}, contr
+00029f70: 6f6c 5f6b 772c 2073 656c 662e 5f63 6f6e  ol_kw, self._con
+00029f80: 7472 6f6c 5f6b 7729 0a20 2020 2020 2020  trol_kw).       
+00029f90: 2020 2020 2072 6573 706f 6e73 6520 3d20       response = 
+00029fa0: 6374 2e73 7465 705f 7265 7370 6f6e 7365  ct.step_response
+00029fb0: 2873 656c 662e 5f63 6f6e 7472 6f6c 5f74  (self._control_t
+00029fc0: 662c 202a 2a63 6b77 290a 2020 2020 2020  f, **ckw).      
+00029fd0: 2020 656c 6966 2073 656c 662e 5f72 6573    elif self._res
+00029fe0: 706f 6e73 655f 7479 7065 203d 3d20 2269  ponse_type == "i
+00029ff0: 6d70 756c 7365 223a 0a20 2020 2020 2020  mpulse":.       
+0002a000: 2020 2020 2063 6b77 203d 206d 6572 6765       ckw = merge
+0002a010: 6465 6570 2e6d 6572 6765 287b 7d2c 2063  deep.merge({}, c
+0002a020: 6f6e 7472 6f6c 5f6b 772c 2073 656c 662e  ontrol_kw, self.
+0002a030: 5f63 6f6e 7472 6f6c 5f6b 7729 0a20 2020  _control_kw).   
+0002a040: 2020 2020 2020 2020 2072 6573 706f 6e73           respons
+0002a050: 6520 3d20 6374 2e69 6d70 756c 7365 5f72  e = ct.impulse_r
+0002a060: 6573 706f 6e73 6528 7365 6c66 2e5f 636f  esponse(self._co
+0002a070: 6e74 726f 6c5f 7466 2c20 2a2a 636b 7729  ntrol_tf, **ckw)
+0002a080: 0a20 2020 2020 2020 2065 6c69 6620 7365  .        elif se
+0002a090: 6c66 2e5f 7265 7370 6f6e 7365 5f74 7970  lf._response_typ
+0002a0a0: 6520 3d3d 2022 7261 6d70 223a 0a20 2020  e == "ramp":.   
+0002a0b0: 2020 2020 2020 2020 2072 616d 7020 3d20           ramp = 
+0002a0c0: 7365 6c66 2e5f 7469 6d65 5f61 7272 6179  self._time_array
+0002a0d0: 0a20 2020 2020 2020 2020 2020 2063 6f6e  .            con
+0002a0e0: 7472 6f6c 5f6b 775b 2255 225d 203d 2072  trol_kw["U"] = r
+0002a0f0: 616d 700a 2020 2020 2020 2020 2020 2020  amp.            
+0002a100: 636b 7720 3d20 6d65 7267 6564 6565 702e  ckw = mergedeep.
+0002a110: 6d65 7267 6528 7b7d 2c20 636f 6e74 726f  merge({}, contro
+0002a120: 6c5f 6b77 2c20 7365 6c66 2e5f 636f 6e74  l_kw, self._cont
+0002a130: 726f 6c5f 6b77 290a 2020 2020 2020 2020  rol_kw).        
+0002a140: 2020 2020 7265 7370 6f6e 7365 203d 2063      response = c
+0002a150: 742e 666f 7263 6564 5f72 6573 706f 6e73  t.forced_respons
+0002a160: 6528 7365 6c66 2e5f 636f 6e74 726f 6c5f  e(self._control_
+0002a170: 7466 2c20 2a2a 636b 7729 0a20 2020 2020  tf, **ckw).     
+0002a180: 2020 2065 6c73 653a 0a20 2020 2020 2020     else:.       
+0002a190: 2020 2020 2072 6169 7365 204e 6f74 496d       raise NotIm
+0002a1a0: 706c 656d 656e 7465 6445 7272 6f72 0a0a  plementedError..
+0002a1b0: 2020 2020 2020 2020 7265 7475 726e 2072          return r
+0002a1c0: 6573 706f 6e73 652e 7469 6d65 2c20 7265  esponse.time, re
+0002a1d0: 7370 6f6e 7365 2e79 2e66 6c61 7474 656e  sponse.y.flatten
+0002a1e0: 2829 0a0a 0a63 6c61 7373 2043 6f6c 6f72  ()...class Color
+0002a1f0: 6564 5379 7374 656d 5265 7370 6f6e 7365  edSystemResponse
+0002a200: 5365 7269 6573 2853 7973 7465 6d52 6573  Series(SystemRes
+0002a210: 706f 6e73 6553 6572 6965 7329 3a0a 2020  ponseSeries):.  
+0002a220: 2020 2222 2252 6570 7265 7365 6e74 2061    """Represent a
+0002a230: 2073 7973 7465 6d20 7265 7370 6f6e 7365   system response
+0002a240: 2063 6f6d 7075 7465 6420 7769 7468 2074   computed with t
+0002a250: 6865 2060 6063 6f6e 7472 6f6c 6060 206d  he ``control`` m
+0002a260: 6f64 756c 652c 0a20 2020 2061 6e64 2063  odule,.    and c
+0002a270: 6f6c 6f72 6564 2061 6363 6f72 6469 6e67  olored according
+0002a280: 2073 6f6d 6520 636f 6c6f 7220 6675 6e63   some color func
+0002a290: 7469 6f6e 2e0a 2020 2020 2222 220a 2020  tion..    """.  
+0002a2a0: 2020 6973 5f70 6172 616d 6574 7269 6320    is_parametric 
+0002a2b0: 3d20 5472 7565 0a0a 2020 2020 6465 6620  = True..    def 
+0002a2c0: 5f5f 696e 6974 5f5f 2873 656c 662c 202a  __init__(self, *
+0002a2d0: 6172 6773 2c20 2a2a 6b77 6172 6773 293a  args, **kwargs):
+0002a2e0: 0a20 2020 2020 2020 2073 7570 6572 2829  .        super()
+0002a2f0: 2e5f 5f69 6e69 745f 5f28 2a61 7267 732c  .__init__(*args,
+0002a300: 202a 2a6b 7761 7267 7329 0a20 2020 2020   **kwargs).     
+0002a310: 2020 2073 656c 662e 7573 655f 636d 203d     self.use_cm =
+0002a320: 206b 7761 7267 732e 6765 7428 2275 7365   kwargs.get("use
+0002a330: 5f63 6d22 2c20 5472 7565 290a 0a20 2020  _cm", True)..   
+0002a340: 2064 6566 205f 6765 745f 6461 7461 5f68   def _get_data_h
+0002a350: 656c 7065 7228 7365 6c66 293a 0a20 2020  elper(self):.   
+0002a360: 2020 2020 2078 2c20 7920 3d20 7375 7065       x, y = supe
+0002a370: 7228 292e 5f67 6574 5f64 6174 615f 6865  r()._get_data_he
+0002a380: 6c70 6572 2829 0a20 2020 2020 2020 2072  lper().        r
+0002a390: 6574 7572 6e20 782c 2079 2c20 7365 6c66  eturn x, y, self
+0002a3a0: 2e65 7661 6c5f 636f 6c6f 725f 6675 6e63  .eval_color_func
+0002a3b0: 2878 2c20 7929 0a0a 0a63 6c61 7373 2050  (x, y)...class P
+0002a3c0: 6f6c 655a 6572 6f43 6f6d 6d6f 6e3a 0a20  oleZeroCommon:. 
+0002a3d0: 2020 2064 6566 205f 5f69 6e69 745f 5f28     def __init__(
+0002a3e0: 7365 6c66 2c20 2a61 7267 732c 202a 2a6b  self, *args, **k
+0002a3f0: 7761 7267 7329 3a0a 2020 2020 2020 2020  wargs):.        
+0002a400: 7375 7065 7228 292e 5f5f 696e 6974 5f5f  super().__init__
+0002a410: 282a 6172 6773 2c20 2a2a 6b77 6172 6773  (*args, **kwargs
+0002a420: 290a 2020 2020 2020 2020 7365 6c66 2e69  ).        self.i
+0002a430: 735f 706f 696e 7420 3d20 5472 7565 0a20  s_point = True. 
+0002a440: 2020 2020 2020 2073 656c 662e 7265 7475         self.retu
+0002a450: 726e 5f70 6f6c 6573 203d 206b 7761 7267  rn_poles = kwarg
+0002a460: 732e 6765 7428 2272 6574 7572 6e5f 706f  s.get("return_po
+0002a470: 6c65 7322 2c20 5472 7565 290a 2020 2020  les", True).    
+0002a480: 2020 2020 7365 6c66 2e70 6f6c 655f 636f      self.pole_co
+0002a490: 6c6f 7220 3d20 6b77 6172 6773 2e67 6574  lor = kwargs.get
+0002a4a0: 2822 706f 6c65 5f63 6f6c 6f72 222c 204e  ("pole_color", N
+0002a4b0: 6f6e 6529 0a20 2020 2020 2020 2073 656c  one).        sel
+0002a4c0: 662e 7a65 726f 5f63 6f6c 6f72 203d 206b  f.zero_color = k
+0002a4d0: 7761 7267 732e 6765 7428 227a 6572 6f5f  wargs.get("zero_
+0002a4e0: 636f 6c6f 7222 2c20 4e6f 6e65 290a 2020  color", None).  
+0002a4f0: 2020 2020 2020 7365 6c66 2e70 6f6c 655f        self.pole_
+0002a500: 6d61 726b 6572 7369 7a65 203d 206b 7761  markersize = kwa
+0002a510: 7267 732e 6765 7428 2270 6f6c 655f 6d61  rgs.get("pole_ma
+0002a520: 726b 6572 7369 7a65 222c 2031 3029 0a20  rkersize", 10). 
+0002a530: 2020 2020 2020 2073 656c 662e 7a65 726f         self.zero
+0002a540: 5f6d 6172 6b65 7273 697a 6520 3d20 6b77  _markersize = kw
+0002a550: 6172 6773 2e67 6574 2822 7a65 726f 5f6d  args.get("zero_m
+0002a560: 6172 6b65 7273 697a 6522 2c20 3729 0a0a  arkersize", 7)..
+0002a570: 2020 2020 6465 6620 5f5f 7374 725f 5f28      def __str__(
+0002a580: 7365 6c66 293a 0a20 2020 2020 2020 2072  self):.        r
+0002a590: 6574 7572 6e20 7365 6c66 2e5f 7374 725f  eturn self._str_
+0002a5a0: 6865 6c70 6572 2822 706f 6c65 7322 2069  helper("poles" i
+0002a5b0: 6620 7365 6c66 2e72 6574 7572 6e5f 706f  f self.return_po
+0002a5c0: 6c65 7320 656c 7365 2022 7a65 726f 7320  les else "zeros 
+0002a5d0: 2229 0a0a 0a63 6c61 7373 2050 6f6c 655a  ")...class PoleZ
+0002a5e0: 6572 6f57 6974 6853 796d 7079 5365 7269  eroWithSympySeri
+0002a5f0: 6573 2850 6f6c 655a 6572 6f43 6f6d 6d6f  es(PoleZeroCommo
+0002a600: 6e2c 204c 6973 7432 4453 6572 6965 7329  n, List2DSeries)
+0002a610: 3a0a 2020 2020 6465 6620 5f5f 696e 6974  :.    def __init
+0002a620: 5f5f 2873 656c 662c 202a 6172 6773 2c20  __(self, *args, 
+0002a630: 2a2a 6b77 6172 6773 293a 0a20 2020 2020  **kwargs):.     
+0002a640: 2020 2073 7570 6572 2829 2e5f 5f69 6e69     super().__ini
+0002a650: 745f 5f28 2a61 7267 732c 202a 2a6b 7761  t__(*args, **kwa
+0002a660: 7267 7329 0a0a 0a63 6c61 7373 2050 6f6c  rgs)...class Pol
+0002a670: 655a 6572 6f53 6572 6965 7328 506f 6c65  eZeroSeries(Pole
+0002a680: 5a65 726f 436f 6d6d 6f6e 2c20 436f 6e74  ZeroCommon, Cont
+0002a690: 726f 6c42 6173 6553 6572 6965 7329 3a0a  rolBaseSeries):.
+0002a6a0: 2020 2020 2222 2252 6570 7265 7365 6e74      """Represent
+0002a6b0: 2061 2074 6865 2070 6f6c 652d 7a65 726f   a the pole-zero
+0002a6c0: 206f 6620 616e 204c 5449 2053 4953 4f20   of an LTI SISO 
+0002a6d0: 7379 7374 656d 2063 6f6d 7075 7465 640a  system computed.
+0002a6e0: 2020 2020 7769 7468 2074 6865 2060 6063      with the ``c
+0002a6f0: 6f6e 7472 6f6c 6060 206d 6f64 756c 652e  ontrol`` module.
+0002a700: 0a0a 2020 2020 5468 6973 2073 6572 6965  ..    This serie
+0002a710: 7320 7265 7072 6573 656e 7473 2065 6974  s represents eit
+0002a720: 6865 7220 706f 6c65 7320 6f72 207a 6572  her poles or zer
+0002a730: 6f73 2c20 6e6f 7420 626f 7468 2061 7420  os, not both at 
+0002a740: 7468 6520 7361 6d65 2074 696d 652e 0a20  the same time.. 
+0002a750: 2020 2049 6e20 736f 6d65 2073 656e 7365     In some sense
+0002a760: 2c20 6974 2062 6568 6176 6573 206c 696b  , it behaves lik
+0002a770: 6520 6120 4c69 7374 3244 5365 7269 6573  e a List2DSeries
+0002a780: 2e20 536f 2c20 746f 2072 6570 7265 7365  . So, to represe
+0002a790: 6e74 7320 626f 7468 0a20 2020 2070 6f6c  nts both.    pol
+0002a7a0: 6573 2061 6e64 207a 6572 6f73 206f 6620  es and zeros of 
+0002a7b0: 6120 7472 616e 7366 6572 2066 756e 6374  a transfer funct
+0002a7c0: 696f 6e2c 2077 6520 6e65 6564 2074 6f20  ion, we need to 
+0002a7d0: 696e 7374 6174 6961 7465 2074 776f 0a20  instatiate two. 
+0002a7e0: 2020 2064 6966 6665 7265 6e74 2073 6572     different ser
+0002a7f0: 6965 7320 7061 7373 696e 6720 696e 2074  ies passing in t
+0002a800: 6865 2073 616d 6520 7472 616e 7366 6572  he same transfer
+0002a810: 2066 756e 6374 696f 6e2e 0a0a 2020 2020   function...    
+0002a820: 5768 696c 6520 636f 6d70 7574 6174 696f  While computatio
+0002a830: 6e61 6c6c 7920 6c65 7373 2065 6666 6963  nally less effic
+0002a840: 6965 6e74 2c20 7468 6973 2064 6573 6967  ient, this desig
+0002a850: 6e20 6368 6f69 6365 2068 6176 6520 6265  n choice have be
+0002a860: 656e 206d 6164 650a 2020 2020 696e 206f  en made.    in o
+0002a870: 7264 6572 2074 6f20 7265 7573 6520 7468  rder to reuse th
+0002a880: 6520 6578 6973 7469 6e67 2042 6173 6542  e existing BaseB
+0002a890: 6163 6b65 6e64 2061 7263 6869 7465 6374  ackend architect
+0002a8a0: 7572 652c 2074 6861 7420 7365 7473 2075  ure, that sets u
+0002a8b0: 700a 2020 2020 7468 6520 6e75 6d62 6572  p.    the number
+0002a8c0: 206f 6620 636f 6c6f 7273 2062 6173 6564   of colors based
+0002a8d0: 206f 6e20 7468 6520 6e75 6d62 6572 206f   on the number o
+0002a8e0: 6620 6461 7461 2073 6572 6965 732c 2061  f data series, a
+0002a8f0: 7320 7765 6c6c 2061 7320 7468 650a 2020  s well as the.  
+0002a900: 2020 6c6f 6769 6320 746f 2073 686f 7720    logic to show 
+0002a910: 6f72 2068 6964 6520 7468 6520 6c65 6765  or hide the lege
+0002a920: 6e64 2e0a 2020 2020 2222 220a 2020 2020  nd..    """.    
+0002a930: 6465 6620 5f5f 696e 6974 5f5f 2873 656c  def __init__(sel
+0002a940: 662c 2074 662c 206c 6162 656c 3d22 222c  f, tf, label="",
+0002a950: 202a 2a6b 7761 7267 7329 3a0a 2020 2020   **kwargs):.    
+0002a960: 2020 2020 7375 7065 7228 292e 5f5f 696e      super().__in
+0002a970: 6974 5f5f 2874 662c 206c 6162 656c 3d6c  it__(tf, label=l
+0002a980: 6162 656c 2c20 2a2a 6b77 6172 6773 290a  abel, **kwargs).
+0002a990: 2020 2020 2020 2020 7365 6c66 2e5f 6368          self._ch
+0002a9a0: 6563 6b5f 6673 2829 0a0a 2020 2020 6465  eck_fs()..    de
+0002a9b0: 6620 5f5f 7374 725f 5f28 7365 6c66 293a  f __str__(self):
+0002a9c0: 0a20 2020 2020 2020 2070 7265 203d 2022  .        pre = "
+0002a9d0: 706f 6c65 7320 6f66 2022 2069 6620 7365  poles of " if se
+0002a9e0: 6c66 2e72 6574 7572 6e5f 706f 6c65 7320  lf.return_poles 
+0002a9f0: 656c 7365 2022 7a65 726f 7320 6f66 2022  else "zeros of "
+0002aa00: 0a20 2020 2020 2020 2065 7870 7220 3d20  .        expr = 
+0002aa10: 7365 6c66 2e5f 6578 7072 2069 6620 7365  self._expr if se
+0002aa20: 6c66 2e5f 6578 7072 2069 7320 6e6f 7420  lf._expr is not 
+0002aa30: 4e6f 6e65 2065 6c73 6520 7365 6c66 2e5f  None else self._
+0002aa40: 636f 6e74 726f 6c5f 7466 0a20 2020 2020  control_tf.     
+0002aa50: 2020 2072 6574 7572 6e20 7072 6520 2b20     return pre + 
+0002aa60: 7374 7228 6578 7072 290a 0a20 2020 2064  str(expr)..    d
+0002aa70: 6566 205f 6765 745f 6461 7461 5f68 656c  ef _get_data_hel
+0002aa80: 7065 7228 7365 6c66 293a 0a20 2020 2020  per(self):.     
+0002aa90: 2020 2022 2222 0a20 2020 2020 2020 2052     """.        R
+0002aaa0: 6574 7572 6e73 0a20 2020 2020 2020 203d  eturns.        =
+0002aab0: 3d3d 3d3d 3d3d 0a20 2020 2020 2020 2078  ======.        x
+0002aac0: 203a 206e 702e 6e64 6172 7261 790a 2020   : np.ndarray.  
+0002aad0: 2020 2020 2020 7920 3a20 6e70 2e6e 6461        y : np.nda
+0002aae0: 7272 6179 0a20 2020 2020 2020 2022 2222  rray.        """
+0002aaf0: 0a20 2020 2020 2020 206e 7020 3d20 696d  .        np = im
+0002ab00: 706f 7274 5f6d 6f64 756c 6528 226e 756d  port_module("num
+0002ab10: 7079 2229 0a20 2020 2020 2020 2069 6620  py").        if 
+0002ab20: 7365 6c66 2e69 735f 696e 7465 7261 6374  self.is_interact
+0002ab30: 6976 653a 0a20 2020 2020 2020 2020 2020  ive:.           
+0002ab40: 2074 6620 3d20 7365 6c66 2e5f 6578 7072   tf = self._expr
+0002ab50: 2e73 7562 7328 7365 6c66 2e70 6172 616d  .subs(self.param
+0002ab60: 7329 0a20 2020 2020 2020 2020 2020 2073  s).            s
+0002ab70: 656c 662e 5f63 6f6e 7472 6f6c 5f74 6620  elf._control_tf 
+0002ab80: 3d20 7466 5f74 6f5f 636f 6e74 726f 6c28  = tf_to_control(
+0002ab90: 7466 290a 2020 2020 2020 2020 6966 2073  tf).        if s
+0002aba0: 656c 662e 7265 7475 726e 5f70 6f6c 6573  elf.return_poles
+0002abb0: 3a0a 2020 2020 2020 2020 2020 2020 706f  :.            po
+0002abc0: 696e 7473 203d 2073 656c 662e 5f63 6f6e  ints = self._con
+0002abd0: 7472 6f6c 5f74 662e 706f 6c65 7328 290a  trol_tf.poles().
+0002abe0: 2020 2020 2020 2020 656c 7365 3a0a 2020          else:.  
+0002abf0: 2020 2020 2020 2020 2020 706f 696e 7473            points
+0002ac00: 203d 2073 656c 662e 5f63 6f6e 7472 6f6c   = self._control
+0002ac10: 5f74 662e 7a65 726f 7328 290a 2020 2020  _tf.zeros().    
+0002ac20: 2020 2020 7265 7475 726e 206e 702e 7265      return np.re
+0002ac30: 616c 2870 6f69 6e74 7329 2c20 6e70 2e69  al(points), np.i
+0002ac40: 6d61 6728 706f 696e 7473 290a 0a0a 636c  mag(points)...cl
+0002ac50: 6173 7320 4e47 7269 644c 696e 6553 6572  ass NGridLineSer
+0002ac60: 6965 7328 4772 6964 4261 7365 2c20 4261  ies(GridBase, Ba
+0002ac70: 7365 5365 7269 6573 293a 0a20 2020 2022  seSeries):.    "
+0002ac80: 2222 2054 6865 2063 6f64 6520 6f66 2074  "" The code of t
+0002ac90: 6869 7320 636c 6173 7320 636f 6d65 7320  his class comes 
+0002aca0: 6672 6f6d 2074 6865 2060 6063 6f6e 7472  from the ``contr
+0002acb0: 6f6c 6060 2070 6163 6b61 6765 2c20 7768  ol`` package, wh
+0002acc0: 6963 6820 6861 730a 2020 2020 6265 656e  ich has.    been
+0002acd0: 2072 6561 7272 616e 6765 6420 746f 2077   rearranged to w
+0002ace0: 6f72 6b20 7769 7468 2074 6865 2061 7263  ork with the arc
+0002acf0: 6869 7465 6374 7572 6520 6f66 2074 6869  hitecture of thi
+0002ad00: 7320 6d6f 6475 6c65 2e0a 2020 2020 2222  s module..    ""
+0002ad10: 220a 0a20 2020 2064 6566 205f 5f69 6e69  "..    def __ini
+0002ad20: 745f 5f28 7365 6c66 2c20 636c 5f6d 6167  t__(self, cl_mag
+0002ad30: 733d 4e6f 6e65 2c20 636c 5f70 6861 7365  s=None, cl_phase
+0002ad40: 733d 4e6f 6e65 2c20 6c61 6265 6c5f 636c  s=None, label_cl
+0002ad50: 5f70 6861 7365 733d 4661 6c73 652c 0a20  _phases=False,. 
+0002ad60: 2020 2020 2020 202a 2a6b 7761 7267 7329         **kwargs)
+0002ad70: 3a0a 2020 2020 2020 2020 7375 7065 7228  :.        super(
+0002ad80: 292e 5f5f 696e 6974 5f5f 282a 2a6b 7761  ).__init__(**kwa
+0002ad90: 7267 7329 0a20 2020 2020 2020 206e 7020  rgs).        np 
+0002ada0: 3d20 696d 706f 7274 5f6d 6f64 756c 6528  = import_module(
+0002adb0: 226e 756d 7079 2229 0a20 2020 2020 2020  "numpy").       
+0002adc0: 2073 656c 662e 636c 5f6d 6167 7320 3d20   self.cl_mags = 
+0002add0: 636c 5f6d 6167 7320 6966 2063 6c5f 6d61  cl_mags if cl_ma
+0002ade0: 6773 2069 7320 4e6f 6e65 2065 6c73 6520  gs is None else 
+0002adf0: 6e70 2e61 7272 6179 2863 6c5f 6d61 6773  np.array(cl_mags
+0002ae00: 290a 2020 2020 2020 2020 7365 6c66 2e63  ).        self.c
+0002ae10: 6c5f 7068 6173 6573 203d 2063 6c5f 7068  l_phases = cl_ph
+0002ae20: 6173 6573 2069 6620 636c 5f70 6861 7365  ases if cl_phase
+0002ae30: 7320 6973 204e 6f6e 6520 656c 7365 206e  s is None else n
+0002ae40: 702e 6172 7261 7928 636c 5f70 6861 7365  p.array(cl_phase
+0002ae50: 7329 0a20 2020 2020 2020 2073 656c 662e  s).        self.
+0002ae60: 6c61 6265 6c5f 636c 5f70 6861 7365 7320  label_cl_phases 
+0002ae70: 3d20 6c61 6265 6c5f 636c 5f70 6861 7365  = label_cl_phase
+0002ae80: 730a 2020 2020 2020 2020 7365 6c66 2e73  s.        self.s
+0002ae90: 686f 775f 696e 5f6c 6567 656e 6420 3d20  how_in_legend = 
+0002aea0: 6b77 6172 6773 2e67 6574 2822 7368 6f77  kwargs.get("show
+0002aeb0: 5f69 6e5f 6c65 6765 6e64 222c 2046 616c  _in_legend", Fal
+0002aec0: 7365 290a 2020 2020 2020 2020 7365 6c66  se).        self
+0002aed0: 2e73 686f 775f 636c 5f6d 6167 7320 3d20  .show_cl_mags = 
+0002aee0: 6b77 6172 6773 2e67 6574 2822 7368 6f77  kwargs.get("show
+0002aef0: 5f63 6c5f 6d61 6773 222c 2054 7275 6529  _cl_mags", True)
+0002af00: 0a20 2020 2020 2020 2073 656c 662e 7368  .        self.sh
+0002af10: 6f77 5f63 6c5f 7068 6173 6573 203d 206b  ow_cl_phases = k
+0002af20: 7761 7267 732e 6765 7428 2273 686f 775f  wargs.get("show_
+0002af30: 636c 5f70 6861 7365 7322 2c20 5472 7565  cl_phases", True
+0002af40: 290a 0a20 2020 2064 6566 205f 5f73 7472  )..    def __str
+0002af50: 5f5f 2873 656c 6629 3a0a 2020 2020 2020  __(self):.      
+0002af60: 2020 7265 7475 726e 2022 6e2d 6772 6964    return "n-grid
+0002af70: 220a 0a20 2020 2040 7374 6174 6963 6d65  "..    @staticme
+0002af80: 7468 6f64 0a20 2020 2064 6566 2063 6c6f  thod.    def clo
+0002af90: 7365 645f 6c6f 6f70 5f63 6f6e 746f 7572  sed_loop_contour
+0002afa0: 7328 4763 6c5f 6d61 6773 2c20 4763 6c5f  s(Gcl_mags, Gcl_
+0002afb0: 7068 6173 6573 293a 0a20 2020 2020 2020  phases):.       
+0002afc0: 2022 2222 436f 6e74 6f75 7273 206f 6620   """Contours of 
+0002afd0: 7468 6520 6675 6e63 7469 6f6e 2047 636c  the function Gcl
+0002afe0: 203d 2047 6f6c 2f28 312b 476f 6c29 2c20   = Gol/(1+Gol), 
+0002aff0: 7768 6572 650a 2020 2020 2020 2020 476f  where.        Go
+0002b000: 6c20 6973 2061 6e20 6f70 656e 2d6c 6f6f  l is an open-loo
+0002b010: 7020 7472 616e 7366 6572 2066 756e 6374  p transfer funct
+0002b020: 696f 6e2c 2061 6e64 2047 636c 2069 7320  ion, and Gcl is 
+0002b030: 6120 636f 7272 6573 706f 6e64 696e 670a  a corresponding.
+0002b040: 2020 2020 2020 2020 636c 6f73 6564 2d6c          closed-l
+0002b050: 6f6f 7020 7472 616e 7366 6572 2066 756e  oop transfer fun
+0002b060: 6374 696f 6e2e 0a0a 2020 2020 2020 2020  ction...        
+0002b070: 5061 7261 6d65 7465 7273 0a20 2020 2020  Parameters.     
+0002b080: 2020 202d 2d2d 2d2d 2d2d 2d2d 2d0a 2020     ----------.  
+0002b090: 2020 2020 2020 4763 6c5f 6d61 6773 203a        Gcl_mags :
+0002b0a0: 2061 7272 6179 2d6c 696b 650a 2020 2020   array-like.    
+0002b0b0: 2020 2020 2020 2020 4172 7261 7920 6f66          Array of
+0002b0c0: 206d 6167 6e69 7475 6465 7320 6f66 2074   magnitudes of t
+0002b0d0: 6865 2063 6f6e 746f 7572 730a 2020 2020  he contours.    
+0002b0e0: 2020 2020 4763 6c5f 7068 6173 6573 203a      Gcl_phases :
+0002b0f0: 2061 7272 6179 2d6c 696b 650a 2020 2020   array-like.    
+0002b100: 2020 2020 2020 2020 4172 7261 7920 6f66          Array of
+0002b110: 2070 6861 7365 7320 696e 2072 6164 6961   phases in radia
+0002b120: 6e73 206f 6620 7468 6520 636f 6e74 6f75  ns of the contou
+0002b130: 7273 0a0a 2020 2020 2020 2020 5265 7475  rs..        Retu
+0002b140: 726e 730a 2020 2020 2020 2020 2d2d 2d2d  rns.        ----
+0002b150: 2d2d 2d0a 2020 2020 2020 2020 636f 6e74  ---.        cont
+0002b160: 6f75 7273 203a 2063 6f6d 706c 6578 2061  ours : complex a
+0002b170: 7272 6179 0a20 2020 2020 2020 2020 2020  rray.           
+0002b180: 2041 7272 6179 206f 6620 636f 6d70 6c65   Array of comple
+0002b190: 7820 6e75 6d62 6572 7320 636f 7272 6573  x numbers corres
+0002b1a0: 706f 6e64 696e 6720 746f 2074 6865 2063  ponding to the c
+0002b1b0: 6f6e 746f 7572 732e 0a20 2020 2020 2020  ontours..       
+0002b1c0: 2022 2222 0a20 2020 2020 2020 2023 2043   """.        # C
+0002b1d0: 6f6d 7075 7465 2074 6865 2063 6f6e 746f  ompute the conto
+0002b1e0: 7572 7320 696e 2047 636c 2d73 7061 6365  urs in Gcl-space
+0002b1f0: 2e20 5369 6e63 6520 7765 2772 6520 6769  . Since we're gi
+0002b200: 7665 6e20 636c 6f73 6564 2d6c 6f6f 700a  ven closed-loop.
+0002b210: 2020 2020 2020 2020 2320 6d61 676e 6974          # magnit
+0002b220: 7564 6573 2061 6e64 2070 6861 7365 732c  udes and phases,
+0002b230: 2074 6869 7320 6973 206a 7573 7420 6120   this is just a 
+0002b240: 6361 7365 206f 6620 636f 6e76 6572 7469  case of converti
+0002b250: 6e67 2074 6865 6d20 696e 746f 0a20 2020  ng them into.   
+0002b260: 2020 2020 2023 2061 2063 6f6d 706c 6578       # a complex
+0002b270: 206e 756d 6265 722e 0a20 2020 2020 2020   number..       
+0002b280: 206e 7020 3d20 696d 706f 7274 5f6d 6f64   np = import_mod
+0002b290: 756c 6528 226e 756d 7079 2229 0a20 2020  ule("numpy").   
+0002b2a0: 2020 2020 2047 636c 203d 2047 636c 5f6d       Gcl = Gcl_m
+0002b2b0: 6167 732a 6e70 2e65 7870 2831 2e6a 2a47  ags*np.exp(1.j*G
+0002b2c0: 636c 5f70 6861 7365 7329 0a0a 2020 2020  cl_phases)..    
+0002b2d0: 2020 2020 2320 496e 7665 7274 2047 636c      # Invert Gcl
+0002b2e0: 203d 2047 6f6c 2f28 312b 476f 6c29 2074   = Gol/(1+Gol) t
+0002b2f0: 6f20 6d61 7020 7468 6520 636f 6e74 6f75  o map the contou
+0002b300: 7273 2069 6e74 6f20 7468 6520 6f70 656e  rs into the open
+0002b310: 2d6c 6f6f 7020 7370 6163 650a 2020 2020  -loop space.    
+0002b320: 2020 2020 7265 7475 726e 2047 636c 2f28      return Gcl/(
+0002b330: 312e 3020 2d20 4763 6c29 0a0a 2020 2020  1.0 - Gcl)..    
+0002b340: 4073 7461 7469 636d 6574 686f 640a 2020  @staticmethod.  
+0002b350: 2020 6465 6620 6d5f 6369 7263 6c65 7328    def m_circles(
+0002b360: 6d61 6773 2c20 7068 6173 655f 6d69 6e3d  mags, phase_min=
+0002b370: 2d33 3539 2e37 352c 2070 6861 7365 5f6d  -359.75, phase_m
+0002b380: 6178 3d2d 302e 3235 293a 0a20 2020 2020  ax=-0.25):.     
+0002b390: 2020 2022 2222 436f 6e73 7461 6e74 2d6d     """Constant-m
+0002b3a0: 6167 6e69 7475 6465 2063 6f6e 746f 7572  agnitude contour
+0002b3b0: 7320 6f66 2074 6865 2066 756e 6374 696f  s of the functio
+0002b3c0: 6e20 4763 6c20 3d20 476f 6c2f 2831 2b47  n Gcl = Gol/(1+G
+0002b3d0: 6f6c 292c 2077 6865 7265 0a20 2020 2020  ol), where.     
+0002b3e0: 2020 2047 6f6c 2069 7320 616e 206f 7065     Gol is an ope
+0002b3f0: 6e2d 6c6f 6f70 2074 7261 6e73 6665 7220  n-loop transfer 
+0002b400: 6675 6e63 7469 6f6e 2c20 616e 6420 4763  function, and Gc
+0002b410: 6c20 6973 2061 2063 6f72 7265 7370 6f6e  l is a correspon
+0002b420: 6469 6e67 0a20 2020 2020 2020 2063 6c6f  ding.        clo
+0002b430: 7365 642d 6c6f 6f70 2074 7261 6e73 6665  sed-loop transfe
+0002b440: 7220 6675 6e63 7469 6f6e 2e0a 0a20 2020  r function...   
+0002b450: 2020 2020 2050 6172 616d 6574 6572 730a       Parameters.
+0002b460: 2020 2020 2020 2020 2d2d 2d2d 2d2d 2d2d          --------
+0002b470: 2d2d 0a20 2020 2020 2020 206d 6167 7320  --.        mags 
+0002b480: 3a20 6172 7261 792d 6c69 6b65 0a20 2020  : array-like.   
+0002b490: 2020 2020 2020 2020 2041 7272 6179 206f           Array o
+0002b4a0: 6620 6d61 676e 6974 7564 6573 2069 6e20  f magnitudes in 
+0002b4b0: 6442 206f 6620 7468 6520 4d2d 6369 7263  dB of the M-circ
+0002b4c0: 6c65 730a 2020 2020 2020 2020 7068 6173  les.        phas
+0002b4d0: 655f 6d69 6e20 3a20 6465 6772 6565 730a  e_min : degrees.
+0002b4e0: 2020 2020 2020 2020 2020 2020 4d69 6e69              Mini
+0002b4f0: 6d75 6d20 7068 6173 6520 696e 2064 6567  mum phase in deg
+0002b500: 7265 6573 206f 6620 7468 6520 4e2d 6369  rees of the N-ci
+0002b510: 7263 6c65 730a 2020 2020 2020 2020 7068  rcles.        ph
+0002b520: 6173 655f 6d61 7820 3a20 6465 6772 6565  ase_max : degree
+0002b530: 730a 2020 2020 2020 2020 2020 2020 4d61  s.            Ma
+0002b540: 7869 6d75 6d20 7068 6173 6520 696e 2064  ximum phase in d
+0002b550: 6567 7265 6573 206f 6620 7468 6520 4e2d  egrees of the N-
+0002b560: 6369 7263 6c65 730a 0a20 2020 2020 2020  circles..       
+0002b570: 2052 6574 7572 6e73 0a20 2020 2020 2020   Returns.       
+0002b580: 202d 2d2d 2d2d 2d2d 0a20 2020 2020 2020   -------.       
+0002b590: 2063 6f6e 746f 7572 7320 3a20 636f 6d70   contours : comp
+0002b5a0: 6c65 7820 6172 7261 790a 2020 2020 2020  lex array.      
+0002b5b0: 2020 2020 2020 4172 7261 7920 6f66 2063        Array of c
+0002b5c0: 6f6d 706c 6578 206e 756d 6265 7273 2063  omplex numbers c
+0002b5d0: 6f72 7265 7370 6f6e 6469 6e67 2074 6f20  orresponding to 
+0002b5e0: 7468 6520 636f 6e74 6f75 7273 2e0a 2020  the contours..  
+0002b5f0: 2020 2020 2020 2222 220a 2020 2020 2020        """.      
+0002b600: 2020 2320 436f 6e76 6572 7420 6d61 676e    # Convert magn
+0002b610: 6974 7564 6573 2061 6e64 2070 6861 7365  itudes and phase
+0002b620: 2072 616e 6765 2069 6e74 6f20 6120 6772   range into a gr
+0002b630: 6964 2073 7569 7461 626c 6520 666f 720a  id suitable for.
+0002b640: 2020 2020 2020 2020 2320 6275 696c 6469          # buildi
+0002b650: 6e67 2063 6f6e 746f 7572 730a 2020 2020  ng contours.    
+0002b660: 2020 2020 6e70 203d 2069 6d70 6f72 745f      np = import_
+0002b670: 6d6f 6475 6c65 2822 6e75 6d70 7922 290a  module("numpy").
+0002b680: 2020 2020 2020 2020 7068 6173 6573 203d          phases =
+0002b690: 206e 702e 7261 6469 616e 7328 6e70 2e6c   np.radians(np.l
+0002b6a0: 696e 7370 6163 6528 7068 6173 655f 6d69  inspace(phase_mi
+0002b6b0: 6e2c 2070 6861 7365 5f6d 6178 2c20 3230  n, phase_max, 20
+0002b6c0: 3030 2929 0a20 2020 2020 2020 2047 636c  00)).        Gcl
+0002b6d0: 5f6d 6167 732c 2047 636c 5f70 6861 7365  _mags, Gcl_phase
+0002b6e0: 7320 3d20 6e70 2e6d 6573 6867 7269 6428  s = np.meshgrid(
+0002b6f0: 3130 2e30 2a2a 286d 6167 732f 3230 2e30  10.0**(mags/20.0
+0002b700: 292c 2070 6861 7365 7329 0a20 2020 2020  ), phases).     
+0002b710: 2020 2072 6574 7572 6e20 4e47 7269 644c     return NGridL
+0002b720: 696e 6553 6572 6965 732e 636c 6f73 6564  ineSeries.closed
+0002b730: 5f6c 6f6f 705f 636f 6e74 6f75 7273 2847  _loop_contours(G
+0002b740: 636c 5f6d 6167 732c 2047 636c 5f70 6861  cl_mags, Gcl_pha
+0002b750: 7365 7329 0a0a 2020 2020 4073 7461 7469  ses)..    @stati
+0002b760: 636d 6574 686f 640a 2020 2020 6465 6620  cmethod.    def 
+0002b770: 6e5f 6369 7263 6c65 7328 7068 6173 6573  n_circles(phases
+0002b780: 2c20 6d61 675f 6d69 6e3d 2d34 302e 302c  , mag_min=-40.0,
+0002b790: 206d 6167 5f6d 6178 3d31 322e 3029 3a0a   mag_max=12.0):.
+0002b7a0: 2020 2020 2020 2020 2222 2243 6f6e 7374          """Const
+0002b7b0: 616e 742d 7068 6173 6520 636f 6e74 6f75  ant-phase contou
+0002b7c0: 7273 206f 6620 7468 6520 6675 6e63 7469  rs of the functi
+0002b7d0: 6f6e 2047 636c 203d 2047 6f6c 2f28 312b  on Gcl = Gol/(1+
+0002b7e0: 476f 6c29 2c20 7768 6572 650a 2020 2020  Gol), where.    
+0002b7f0: 2020 2020 476f 6c20 6973 2061 6e20 6f70      Gol is an op
+0002b800: 656e 2d6c 6f6f 7020 7472 616e 7366 6572  en-loop transfer
+0002b810: 2066 756e 6374 696f 6e2c 2061 6e64 2047   function, and G
+0002b820: 636c 2069 7320 6120 636f 7272 6573 706f  cl is a correspo
+0002b830: 6e64 696e 670a 2020 2020 2020 2020 636c  nding.        cl
+0002b840: 6f73 6564 2d6c 6f6f 7020 7472 616e 7366  osed-loop transf
+0002b850: 6572 2066 756e 6374 696f 6e2e 0a0a 2020  er function...  
+0002b860: 2020 2020 2020 5061 7261 6d65 7465 7273        Parameters
+0002b870: 0a20 2020 2020 2020 202d 2d2d 2d2d 2d2d  .        -------
+0002b880: 2d2d 2d0a 2020 2020 2020 2020 7068 6173  ---.        phas
+0002b890: 6573 203a 2061 7272 6179 2d6c 696b 650a  es : array-like.
+0002b8a0: 2020 2020 2020 2020 2020 2020 4172 7261              Arra
+0002b8b0: 7920 6f66 2070 6861 7365 7320 696e 2064  y of phases in d
+0002b8c0: 6567 7265 6573 206f 6620 7468 6520 4e2d  egrees of the N-
+0002b8d0: 6369 7263 6c65 730a 2020 2020 2020 2020  circles.        
+0002b8e0: 6d61 675f 6d69 6e20 3a20 6442 0a20 2020  mag_min : dB.   
+0002b8f0: 2020 2020 2020 2020 204d 696e 696d 756d           Minimum
+0002b900: 206d 6167 6e69 7475 6465 2069 6e20 6442   magnitude in dB
+0002b910: 206f 6620 7468 6520 4e2d 6369 7263 6c65   of the N-circle
+0002b920: 730a 2020 2020 2020 2020 6d61 675f 6d61  s.        mag_ma
+0002b930: 7820 3a20 6442 0a20 2020 2020 2020 2020  x : dB.         
+0002b940: 2020 204d 6178 696d 756d 206d 6167 6e69     Maximum magni
+0002b950: 7475 6465 2069 6e20 6442 206f 6620 7468  tude in dB of th
+0002b960: 6520 4e2d 6369 7263 6c65 730a 0a20 2020  e N-circles..   
+0002b970: 2020 2020 2052 6574 7572 6e73 0a20 2020       Returns.   
+0002b980: 2020 2020 202d 2d2d 2d2d 2d2d 0a20 2020       -------.   
+0002b990: 2020 2020 2063 6f6e 746f 7572 7320 3a20       contours : 
+0002b9a0: 636f 6d70 6c65 7820 6172 7261 790a 2020  complex array.  
+0002b9b0: 2020 2020 2020 2020 2020 4172 7261 7920            Array 
+0002b9c0: 6f66 2063 6f6d 706c 6578 206e 756d 6265  of complex numbe
+0002b9d0: 7273 2063 6f72 7265 7370 6f6e 6469 6e67  rs corresponding
+0002b9e0: 2074 6f20 7468 6520 636f 6e74 6f75 7273   to the contours
+0002b9f0: 2e0a 2020 2020 2020 2020 2222 220a 2020  ..        """.  
+0002ba00: 2020 2020 2020 2320 436f 6e76 6572 7420        # Convert 
+0002ba10: 7068 6173 6573 2061 6e64 206d 6167 6e69  phases and magni
+0002ba20: 7475 6465 2072 616e 6765 2069 6e74 6f20  tude range into 
+0002ba30: 6120 6772 6964 2073 7569 7461 626c 6520  a grid suitable 
+0002ba40: 666f 720a 2020 2020 2020 2020 2320 6275  for.        # bu
+0002ba50: 696c 6469 6e67 2063 6f6e 746f 7572 730a  ilding contours.
+0002ba60: 2020 2020 2020 2020 6e70 203d 2069 6d70          np = imp
+0002ba70: 6f72 745f 6d6f 6475 6c65 2822 6e75 6d70  ort_module("nump
+0002ba80: 7922 290a 2020 2020 2020 2020 6d61 6773  y").        mags
+0002ba90: 203d 206e 702e 6c69 6e73 7061 6365 2831   = np.linspace(1
+0002baa0: 302a 2a28 6d61 675f 6d69 6e2f 3230 2e30  0**(mag_min/20.0
+0002bab0: 292c 2031 302a 2a28 6d61 675f 6d61 782f  ), 10**(mag_max/
+0002bac0: 3230 2e30 292c 2032 3030 3029 0a20 2020  20.0), 2000).   
+0002bad0: 2020 2020 2047 636c 5f70 6861 7365 732c       Gcl_phases,
+0002bae0: 2047 636c 5f6d 6167 7320 3d20 6e70 2e6d   Gcl_mags = np.m
+0002baf0: 6573 6867 7269 6428 6e70 2e72 6164 6961  eshgrid(np.radia
+0002bb00: 6e73 2870 6861 7365 7329 2c20 6d61 6773  ns(phases), mags
+0002bb10: 290a 2020 2020 2020 2020 7265 7475 726e  ).        return
+0002bb20: 204e 4772 6964 4c69 6e65 5365 7269 6573   NGridLineSeries
+0002bb30: 2e63 6c6f 7365 645f 6c6f 6f70 5f63 6f6e  .closed_loop_con
+0002bb40: 746f 7572 7328 4763 6c5f 6d61 6773 2c20  tours(Gcl_mags, 
+0002bb50: 4763 6c5f 7068 6173 6573 290a 0a20 2020  Gcl_phases)..   
+0002bb60: 2064 6566 2067 6574 5f64 6174 6128 7365   def get_data(se
+0002bb70: 6c66 293a 0a20 2020 2020 2020 206e 7020  lf):.        np 
+0002bb80: 3d20 696d 706f 7274 5f6d 6f64 756c 6528  = import_module(
+0002bb90: 226e 756d 7079 2229 0a0a 2020 2020 2020  "numpy")..      
+0002bba0: 2020 2320 4465 6661 756c 7420 6368 6172    # Default char
+0002bbb0: 7420 7369 7a65 0a20 2020 2020 2020 206f  t size.        o
+0002bbc0: 6c5f 7068 6173 655f 6d69 6e20 3d20 2d33  l_phase_min = -3
+0002bbd0: 3539 2e39 390a 2020 2020 2020 2020 6f6c  59.99.        ol
+0002bbe0: 5f70 6861 7365 5f6d 6178 203d 2030 2e30  _phase_max = 0.0
+0002bbf0: 0a20 2020 2020 2020 206f 6c5f 6d61 675f  .        ol_mag_
+0002bc00: 6d69 6e20 3d20 2d34 302e 300a 2020 2020  min = -40.0.    
+0002bc10: 2020 2020 6f6c 5f6d 6167 5f6d 6178 203d      ol_mag_max =
+0002bc20: 2064 6566 6175 6c74 5f6f 6c5f 6d61 675f   default_ol_mag_
+0002bc30: 6d61 7820 3d20 3530 2e30 0a0a 2020 2020  max = 50.0..    
+0002bc40: 2020 2020 636c 5f6d 6167 7320 3d20 7365      cl_mags = se
+0002bc50: 6c66 2e63 6c5f 6d61 6773 0a20 2020 2020  lf.cl_mags.     
+0002bc60: 2020 2063 6c5f 7068 6173 6573 203d 2073     cl_phases = s
+0002bc70: 656c 662e 636c 5f70 6861 7365 730a 2020  elf.cl_phases.  
+0002bc80: 2020 2020 2020 6c61 6265 6c5f 636c 5f70        label_cl_p
+0002bc90: 6861 7365 7320 3d20 7365 6c66 2e6c 6162  hases = self.lab
+0002bca0: 656c 5f63 6c5f 7068 6173 6573 0a0a 2020  el_cl_phases..  
+0002bcb0: 2020 2020 2020 2320 4669 6e64 2065 7874        # Find ext
+0002bcc0: 656e 7420 6f66 2069 6e74 6572 7365 6374  ent of intersect
+0002bcd0: 696f 6e20 7468 6520 6375 7272 656e 7420  ion the current 
+0002bce0: 6461 7461 7365 7420 6f72 2076 6965 770a  dataset or view.
+0002bcf0: 2020 2020 2020 2020 6f6c 5f70 6861 7365          ol_phase
+0002bd00: 5f6d 696e 2c20 6f6c 5f70 6861 7365 5f6d  _min, ol_phase_m
+0002bd10: 6178 203d 2073 656c 662e 5f78 6c69 6d0a  ax = self._xlim.
+0002bd20: 2020 2020 2020 2020 6f6c 5f6d 6167 5f6d          ol_mag_m
+0002bd30: 696e 2c20 6f6c 5f6d 6167 5f6d 6178 203d  in, ol_mag_max =
+0002bd40: 2073 656c 662e 5f79 6c69 6d0a 0a20 2020   self._ylim..   
+0002bd50: 2020 2020 2023 204d 2d63 6972 636c 6520       # M-circle 
+0002bd60: 6d61 676e 6974 7564 6573 2e0a 2020 2020  magnitudes..    
+0002bd70: 2020 2020 6966 2063 6c5f 6d61 6773 2069      if cl_mags i
+0002bd80: 7320 4e6f 6e65 3a0a 2020 2020 2020 2020  s None:.        
+0002bd90: 2020 2020 2320 4465 6661 756c 7420 6368      # Default ch
+0002bda0: 6172 7420 6d61 676e 6974 7564 6573 0a20  art magnitudes. 
+0002bdb0: 2020 2020 2020 2020 2020 2023 2054 6865             # The
+0002bdc0: 206b 6579 2073 6574 206f 6620 6d61 676e   key set of magn
+0002bdd0: 6974 7564 6573 2061 7265 2061 6c77 6179  itudes are alway
+0002bde0: 7320 6765 6e65 7261 7465 642c 2073 696e  s generated, sin
+0002bdf0: 6365 2074 6869 730a 2020 2020 2020 2020  ce this.        
+0002be00: 2020 2020 2320 6775 6172 616e 7465 6573      # guarantees
+0002be10: 2061 2072 6563 6f67 6e69 7a61 626c 6520   a recognizable 
+0002be20: 4e69 6368 6f6c 7320 6368 6172 7420 6772  Nichols chart gr
+0002be30: 6964 2e0a 2020 2020 2020 2020 2020 2020  id..            
+0002be40: 6b65 795f 636c 5f6d 6167 7320 3d20 6e70  key_cl_mags = np
+0002be50: 2e61 7272 6179 285b 0a20 2020 2020 2020  .array([.       
+0002be60: 2020 2020 2020 2020 202d 3430 2e30 2c20           -40.0, 
+0002be70: 2d32 302e 302c 202d 3132 2e30 2c20 2d36  -20.0, -12.0, -6
+0002be80: 2e30 2c20 2d33 2e30 2c20 2d31 2e30 2c20  .0, -3.0, -1.0, 
+0002be90: 2d30 2e35 2c0a 2020 2020 2020 2020 2020  -0.5,.          
+0002bea0: 2020 2020 2020 302e 302c 2030 2e32 352c        0.0, 0.25,
+0002beb0: 2030 2e35 2c20 312e 302c 2033 2e30 2c20   0.5, 1.0, 3.0, 
+0002bec0: 362e 302c 2031 322e 300a 2020 2020 2020  6.0, 12.0.      
+0002bed0: 2020 2020 2020 5d29 0a0a 2020 2020 2020        ])..      
+0002bee0: 2020 2020 2020 2320 4578 7465 6e64 2074        # Extend t
+0002bef0: 6865 2072 616e 6765 206f 6620 6d61 676e  he range of magn
+0002bf00: 6974 7564 6573 2069 6620 6e65 6365 7373  itudes if necess
+0002bf10: 6172 792e 2054 6865 2065 7874 656e 6465  ary. The extende
+0002bf20: 6420 6172 616e 6765 0a20 2020 2020 2020  d arange.       
+0002bf30: 2020 2020 2023 2077 696c 6c20 656e 6420       # will end 
+0002bf40: 7570 2065 6d70 7479 2069 6620 6e6f 2065  up empty if no e
+0002bf50: 7874 656e 7369 6f6e 2069 7320 7265 7175  xtension is requ
+0002bf60: 6972 6564 2e20 4173 7375 6d65 7320 7468  ired. Assumes th
+0002bf70: 6174 0a20 2020 2020 2020 2020 2020 2023  at.            #
+0002bf80: 2063 6c6f 7365 642d 6c6f 6f70 206d 6167   closed-loop mag
+0002bf90: 6e69 7475 6465 7320 6172 6520 6170 7072  nitudes are appr
+0002bfa0: 6f78 696d 6174 656c 7920 616c 6967 6e65  oximately aligne
+0002bfb0: 6420 7769 7468 206f 7065 6e2d 6c6f 6f70  d with open-loop
+0002bfc0: 0a20 2020 2020 2020 2020 2020 2023 206d  .            # m
+0002bfd0: 6167 6e69 7475 6465 7320 6265 796f 6e64  agnitudes beyond
+0002bfe0: 2074 6865 2076 616c 7565 206f 6620 6e70   the value of np
+0002bff0: 2e6d 696e 286b 6579 5f63 6c5f 6d61 6773  .min(key_cl_mags
+0002c000: 290a 2020 2020 2020 2020 2020 2020 636c  ).            cl
+0002c010: 5f6d 6167 5f73 7465 7020 3d20 2d32 302e  _mag_step = -20.
+0002c020: 3020 2023 2064 420a 2020 2020 2020 2020  0  # dB.        
+0002c030: 2020 2020 6578 7465 6e64 6564 5f63 6c5f      extended_cl_
+0002c040: 6d61 6773 203d 206e 702e 6172 616e 6765  mags = np.arange
+0002c050: 280a 2020 2020 2020 2020 2020 2020 2020  (.              
+0002c060: 2020 6e70 2e6d 696e 286b 6579 5f63 6c5f    np.min(key_cl_
+0002c070: 6d61 6773 292c 206f 6c5f 6d61 675f 6d69  mags), ol_mag_mi
+0002c080: 6e20 2b20 636c 5f6d 6167 5f73 7465 702c  n + cl_mag_step,
+0002c090: 2063 6c5f 6d61 675f 7374 6570 290a 2020   cl_mag_step).  
+0002c0a0: 2020 2020 2020 2020 2020 636c 5f6d 6167            cl_mag
+0002c0b0: 7320 3d20 6e70 2e63 6f6e 6361 7465 6e61  s = np.concatena
+0002c0c0: 7465 2828 6578 7465 6e64 6564 5f63 6c5f  te((extended_cl_
+0002c0d0: 6d61 6773 2c20 6b65 795f 636c 5f6d 6167  mags, key_cl_mag
+0002c0e0: 7329 290a 0a20 2020 2020 2020 2023 2061  s))..        # a
+0002c0f0: 206d 696e 696d 756d 2033 3630 6465 6720   minimum 360deg 
+0002c100: 6578 7465 6e74 2063 6f6e 7461 696e 696e  extent containin
+0002c110: 6720 7468 6520 7068 6173 6573 0a20 2020  g the phases.   
+0002c120: 2020 2020 2070 6861 7365 5f72 6f75 6e64       phase_round
+0002c130: 5f6d 6178 203d 2033 3630 2e30 2a6e 702e  _max = 360.0*np.
+0002c140: 6365 696c 286f 6c5f 7068 6173 655f 6d61  ceil(ol_phase_ma
+0002c150: 782f 3336 302e 3029 0a20 2020 2020 2020  x/360.0).       
+0002c160: 2070 6861 7365 5f72 6f75 6e64 5f6d 696e   phase_round_min
+0002c170: 203d 206d 696e 2870 6861 7365 5f72 6f75   = min(phase_rou
+0002c180: 6e64 5f6d 6178 2d33 3630 2c0a 2020 2020  nd_max-360,.    
+0002c190: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002c1a0: 2020 2020 2020 2020 3336 302e 302a 6e70          360.0*np
+0002c1b0: 2e66 6c6f 6f72 286f 6c5f 7068 6173 655f  .floor(ol_phase_
+0002c1c0: 6d69 6e2f 3336 302e 3029 290a 0a20 2020  min/360.0))..   
+0002c1d0: 2020 2020 2023 204e 2d63 6972 636c 6520       # N-circle 
+0002c1e0: 7068 6173 6573 2028 7368 6f75 6c64 2062  phases (should b
+0002c1f0: 6520 696e 2074 6865 2072 616e 6765 202d  e in the range -
+0002c200: 3336 3020 746f 2030 290a 2020 2020 2020  360 to 0).      
+0002c210: 2020 6966 2063 6c5f 7068 6173 6573 2069    if cl_phases i
+0002c220: 7320 4e6f 6e65 3a0a 2020 2020 2020 2020  s None:.        
+0002c230: 2020 2020 2320 6169 6d20 666f 7220 3920      # aim for 9 
+0002c240: 6c69 6e65 732c 2062 7574 2061 6c77 6179  lines, but alway
+0002c250: 7320 7368 6f77 2028 2d33 3630 2b65 7073  s show (-360+eps
+0002c260: 2c20 2d31 3830 2c20 2d65 7073 290a 2020  , -180, -eps).  
+0002c270: 2020 2020 2020 2020 2020 2320 736d 616c            # smal
+0002c280: 6c65 7374 2073 7061 6369 6e67 2069 7320  lest spacing is 
+0002c290: 3435 2c20 6269 6767 6573 7420 6973 2031  45, biggest is 1
+0002c2a0: 3830 0a20 2020 2020 2020 2020 2020 2070  80.            p
+0002c2b0: 6861 7365 5f73 7061 6e20 3d20 7068 6173  hase_span = phas
+0002c2c0: 655f 726f 756e 645f 6d61 7820 2d20 7068  e_round_max - ph
+0002c2d0: 6173 655f 726f 756e 645f 6d69 6e0a 2020  ase_round_min.  
+0002c2e0: 2020 2020 2020 2020 2020 7370 6163 696e            spacin
+0002c2f0: 6720 3d20 6e70 2e63 6c69 7028 726f 756e  g = np.clip(roun
+0002c300: 6428 7068 6173 655f 7370 616e 202f 2038  d(phase_span / 8
+0002c310: 202f 2034 3529 202a 2034 352c 2034 352c   / 45) * 45, 45,
+0002c320: 2031 3830 290a 2020 2020 2020 2020 2020   180).          
+0002c330: 2020 6b65 795f 636c 5f70 6861 7365 7320    key_cl_phases 
+0002c340: 3d20 6e70 2e61 7272 6179 285b 2d30 2e32  = np.array([-0.2
+0002c350: 352c 202d 3335 392e 3735 5d29 0a20 2020  5, -359.75]).   
+0002c360: 2020 2020 2020 2020 206f 7468 6572 5f63           other_c
+0002c370: 6c5f 7068 6173 6573 203d 206e 702e 6172  l_phases = np.ar
+0002c380: 616e 6765 282d 7370 6163 696e 672c 202d  ange(-spacing, -
+0002c390: 3336 302e 302c 202d 7370 6163 696e 6729  360.0, -spacing)
+0002c3a0: 0a20 2020 2020 2020 2020 2020 2063 6c5f  .            cl_
+0002c3b0: 7068 6173 6573 203d 206e 702e 756e 6971  phases = np.uniq
+0002c3c0: 7565 286e 702e 636f 6e63 6174 656e 6174  ue(np.concatenat
+0002c3d0: 6528 286b 6579 5f63 6c5f 7068 6173 6573  e((key_cl_phases
+0002c3e0: 2c20 6f74 6865 725f 636c 5f70 6861 7365  , other_cl_phase
+0002c3f0: 7329 2929 0a20 2020 2020 2020 2065 6c69  s))).        eli
+0002c400: 6620 6e6f 7420 2828 2d33 3630 203c 206e  f not ((-360 < n
+0002c410: 702e 6d69 6e28 636c 5f70 6861 7365 7329  p.min(cl_phases)
+0002c420: 2920 616e 6420 286e 702e 6d61 7828 636c  ) and (np.max(cl
+0002c430: 5f70 6861 7365 7329 203c 2030 2e30 2929  _phases) < 0.0))
+0002c440: 3a0a 2020 2020 2020 2020 2020 2020 7261  :.            ra
+0002c450: 6973 6520 5661 6c75 6545 7272 6f72 2827  ise ValueError('
+0002c460: 636c 5f70 6861 7365 7320 6d75 7374 2062  cl_phases must b
+0002c470: 6574 7765 656e 202d 3336 3020 616e 6420  etween -360 and 
+0002c480: 302c 2065 7863 6c75 7369 7665 2729 0a0a  0, exclusive')..
+0002c490: 2020 2020 2020 2020 7365 6c66 2e63 6c5f          self.cl_
+0002c4a0: 6d61 6773 203d 2063 6c5f 6d61 6773 0a20  mags = cl_mags. 
+0002c4b0: 2020 2020 2020 2073 656c 662e 636c 5f70         self.cl_p
+0002c4c0: 6861 7365 7320 3d20 636c 5f70 6861 7365  hases = cl_phase
+0002c4d0: 730a 0a20 2020 2020 2020 2023 2046 696e  s..        # Fin
+0002c4e0: 6420 7468 6520 4d2d 636f 6e74 6f75 7273  d the M-contours
+0002c4f0: 0a20 2020 2020 2020 206d 203d 2073 656c  .        m = sel
+0002c500: 662e 6d5f 6369 7263 6c65 7328 0a20 2020  f.m_circles(.   
+0002c510: 2020 2020 2020 2020 2063 6c5f 6d61 6773           cl_mags
+0002c520: 2c20 7068 6173 655f 6d69 6e3d 6e70 2e6d  , phase_min=np.m
+0002c530: 696e 2863 6c5f 7068 6173 6573 292c 2070  in(cl_phases), p
+0002c540: 6861 7365 5f6d 6178 3d6e 702e 6d61 7828  hase_max=np.max(
+0002c550: 636c 5f70 6861 7365 7329 290a 2020 2020  cl_phases)).    
+0002c560: 2020 2020 6d5f 6d61 6720 3d20 3230 2a6e      m_mag = 20*n
+0002c570: 702e 6c6f 6731 3028 6e70 2e61 6273 286d  p.log10(np.abs(m
+0002c580: 2929 0a20 2020 2020 2020 206d 5f70 6861  )).        m_pha
+0002c590: 7365 203d 206e 702e 6d6f 6428 6e70 2e64  se = np.mod(np.d
+0002c5a0: 6567 7265 6573 286e 702e 616e 676c 6528  egrees(np.angle(
+0002c5b0: 6d29 292c 202d 3336 302e 3029 2020 2320  m)), -360.0)  # 
+0002c5c0: 556e 7772 6170 0a0a 2020 2020 2020 2020  Unwrap..        
+0002c5d0: 2320 4669 6e64 2074 6865 204e 2d63 6f6e  # Find the N-con
+0002c5e0: 746f 7572 730a 2020 2020 2020 2020 6e20  tours.        n 
+0002c5f0: 3d20 7365 6c66 2e6e 5f63 6972 636c 6573  = self.n_circles
+0002c600: 2863 6c5f 7068 6173 6573 2c20 6d61 675f  (cl_phases, mag_
+0002c610: 6d69 6e3d 6e70 2e6d 696e 2863 6c5f 6d61  min=np.min(cl_ma
+0002c620: 6773 292c 206d 6167 5f6d 6178 3d6e 702e  gs), mag_max=np.
+0002c630: 6d61 7828 636c 5f6d 6167 7329 290a 2020  max(cl_mags)).  
+0002c640: 2020 2020 2020 6e5f 6d61 6720 3d20 3230        n_mag = 20
+0002c650: 2a6e 702e 6c6f 6731 3028 6e70 2e61 6273  *np.log10(np.abs
+0002c660: 286e 2929 0a20 2020 2020 2020 206e 5f70  (n)).        n_p
+0002c670: 6861 7365 203d 206e 702e 6d6f 6428 6e70  hase = np.mod(np
+0002c680: 2e64 6567 7265 6573 286e 702e 616e 676c  .degrees(np.angl
+0002c690: 6528 6e29 292c 202d 3336 302e 3029 2020  e(n)), -360.0)  
+0002c6a0: 2320 556e 7772 6170 0a0a 2020 2020 2020  # Unwrap..      
+0002c6b0: 2020 2320 506c 6f74 2074 6865 2063 6f6e    # Plot the con
+0002c6c0: 746f 7572 7320 6265 6869 6e64 206f 7468  tours behind oth
+0002c6d0: 6572 2070 6c6f 7420 656c 656d 656e 7473  er plot elements
+0002c6e0: 2e0a 2020 2020 2020 2020 2320 5468 6520  ..        # The 
+0002c6f0: 2270 6861 7365 206f 6666 7365 7422 2069  "phase offset" i
+0002c700: 7320 7573 6564 2074 6f20 7072 6f64 7563  s used to produc
+0002c710: 6520 636f 7069 6573 206f 6620 7468 6520  e copies of the 
+0002c720: 6368 6172 7420 7468 6174 2063 6f76 6572  chart that cover
+0002c730: 0a20 2020 2020 2020 2023 2074 6865 2065  .        # the e
+0002c740: 6e74 6972 6520 7261 6e67 6520 6f66 2074  ntire range of t
+0002c750: 6865 2070 6c6f 7474 6564 2064 6174 612c  he plotted data,
+0002c760: 2073 7461 7274 696e 6720 6672 6f6d 2061   starting from a
+0002c770: 2062 6173 6520 6368 6172 7420 636f 6d70   base chart comp
+0002c780: 7574 6564 0a20 2020 2020 2020 2023 206f  uted.        # o
+0002c790: 7665 7220 7468 6520 7261 6e67 6520 2d33  ver the range -3
+0002c7a0: 3630 203c 2070 6861 7365 203c 2030 2e20  60 < phase < 0. 
+0002c7b0: 4769 7665 6e20 7468 6520 7261 6e67 650a  Given the range.
+0002c7c0: 2020 2020 2020 2020 2320 7468 6520 6261          # the ba
+0002c7d0: 7365 2063 6861 7274 2069 7320 636f 6d70  se chart is comp
+0002c7e0: 7574 6564 206f 7665 722c 2074 6865 2070  uted over, the p
+0002c7f0: 6861 7365 206f 6666 7365 7420 7368 6f75  hase offset shou
+0002c800: 6c64 2062 6520 300a 2020 2020 2020 2020  ld be 0.        
+0002c810: 2320 666f 7220 2d33 3630 203c 206f 6c5f  # for -360 < ol_
+0002c820: 7068 6173 655f 6d69 6e20 3c20 302e 0a20  phase_min < 0.. 
+0002c830: 2020 2020 2020 2070 6861 7365 5f6f 6666         phase_off
+0002c840: 7365 7473 203d 2033 3630 202b 206e 702e  sets = 360 + np.
+0002c850: 6172 616e 6765 2870 6861 7365 5f72 6f75  arange(phase_rou
+0002c860: 6e64 5f6d 696e 2c20 7068 6173 655f 726f  nd_min, phase_ro
+0002c870: 756e 645f 6d61 782c 2033 3630 2e30 290a  und_max, 360.0).
+0002c880: 2020 2020 2020 2020 7265 7475 726e 206d          return m
+0002c890: 5f6d 6167 2c20 6d5f 7068 6173 652c 206e  _mag, m_phase, n
+0002c8a0: 5f6d 6167 2c20 6e5f 7068 6173 652c 2070  _mag, n_phase, p
+0002c8b0: 6861 7365 5f6f 6666 7365 7473 0a0a 0a63  hase_offsets...c
+0002c8c0: 6c61 7373 204d 4369 7263 6c65 7353 6572  lass MCirclesSer
+0002c8d0: 6965 7328 4772 6964 4261 7365 2c20 4261  ies(GridBase, Ba
+0002c8e0: 7365 5365 7269 6573 293a 0a20 2020 2064  seSeries):.    d
+0002c8f0: 6566 205f 5f69 6e69 745f 5f28 7365 6c66  ef __init__(self
+0002c900: 2c20 6d61 676e 6974 7564 6573 5f64 622c  , magnitudes_db,
+0002c910: 206d 6167 6e69 7475 6465 732c 202a 2a6b   magnitudes, **k
+0002c920: 7761 7267 7329 3a0a 2020 2020 2020 2020  wargs):.        
+0002c930: 7375 7065 7228 292e 5f5f 696e 6974 5f5f  super().__init__
+0002c940: 282a 2a6b 7761 7267 7329 0a20 2020 2020  (**kwargs).     
+0002c950: 2020 2073 656c 662e 6d61 676e 6974 7564     self.magnitud
+0002c960: 6573 5f64 6220 3d20 5475 706c 6528 2a6d  es_db = Tuple(*m
+0002c970: 6167 6e69 7475 6465 735f 6462 290a 2020  agnitudes_db).  
+0002c980: 2020 2020 2020 7365 6c66 2e6d 6167 6e69        self.magni
+0002c990: 7475 6465 7320 3d20 7365 6c66 2e5f 6578  tudes = self._ex
+0002c9a0: 7072 203d 2054 7570 6c65 282a 6d61 676e  pr = Tuple(*magn
+0002c9b0: 6974 7564 6573 290a 2020 2020 2020 2020  itudes).        
+0002c9c0: 7365 6c66 2e73 686f 775f 6d69 6e75 735f  self.show_minus_
+0002c9d0: 6f6e 6520 3d20 6b77 6172 6773 2e67 6574  one = kwargs.get
+0002c9e0: 2822 7368 6f77 5f6d 696e 7573 5f6f 6e65  ("show_minus_one
+0002c9f0: 222c 2046 616c 7365 290a 0a20 2020 2064  ", False)..    d
+0002ca00: 6566 2067 6574 5f64 6174 6128 7365 6c66  ef get_data(self
+0002ca10: 293a 0a20 2020 2020 2020 2022 2222 0a20  ):.        """. 
+0002ca20: 2020 2020 2020 2052 6574 7572 6e73 0a20         Returns. 
+0002ca30: 2020 2020 2020 203d 3d3d 3d3d 3d3d 0a0a         =======..
+0002ca40: 2020 2020 2020 2020 6461 7461 203a 206c          data : l
+0002ca50: 6973 740a 2020 2020 2020 2020 2020 2020  ist.            
+0002ca60: 4561 6368 2065 6c65 6d65 6e74 206f 6620  Each element of 
+0002ca70: 7468 6520 6c69 7374 2068 6173 2074 6865  the list has the
+0002ca80: 2066 6f72 6d3a 0a20 2020 2020 2020 2020   form:.         
+0002ca90: 2020 2060 605b 6d61 676e 6974 7564 655f     ``[magnitude_
+0002caa0: 6462 2c20 785f 636f 6f72 6473 2c20 795f  db, x_coords, y_
+0002cab0: 636f 6f72 6473 5d60 602e 0a20 2020 2020  coords]``..     
+0002cac0: 2020 2022 2222 0a20 2020 2020 2020 206e     """.        n
+0002cad0: 7020 3d20 696d 706f 7274 5f6d 6f64 756c  p = import_modul
+0002cae0: 6528 226e 756d 7079 2229 0a20 2020 2020  e("numpy").     
+0002caf0: 2020 2064 6174 6120 3d20 5b5d 0a20 2020     data = [].   
+0002cb00: 2020 2020 206d 6167 6e69 7475 6465 7320       magnitudes 
+0002cb10: 3d20 7365 6c66 2e6d 6167 6e69 7475 6465  = self.magnitude
+0002cb20: 730a 2020 2020 2020 2020 6d61 676e 6974  s.        magnit
+0002cb30: 7564 6573 5f64 6220 3d20 7365 6c66 2e6d  udes_db = self.m
+0002cb40: 6167 6e69 7475 6465 735f 6462 0a20 2020  agnitudes_db.   
+0002cb50: 2020 2020 2069 6620 7365 6c66 2e69 735f       if self.is_
+0002cb60: 696e 7465 7261 6374 6976 653a 0a20 2020  interactive:.   
+0002cb70: 2020 2020 2020 2020 206d 6167 6e69 7475           magnitu
+0002cb80: 6465 7320 3d20 6d61 676e 6974 7564 6573  des = magnitudes
+0002cb90: 2e73 7562 7328 7365 6c66 2e70 6172 616d  .subs(self.param
+0002cba0: 7329 0a20 2020 2020 2020 2020 2020 206d  s).            m
+0002cbb0: 6167 6e69 7475 6465 735f 6462 203d 206d  agnitudes_db = m
+0002cbc0: 6167 6e69 7475 6465 735f 6462 2e73 7562  agnitudes_db.sub
+0002cbd0: 7328 7365 6c66 2e70 6172 616d 7329 0a20  s(self.params). 
+0002cbe0: 2020 2020 2020 206d 6167 6e69 7475 6465         magnitude
+0002cbf0: 7320 3d20 6e70 2e61 7272 6179 286d 6167  s = np.array(mag
+0002cc00: 6e69 7475 6465 732c 2064 7479 7065 3d66  nitudes, dtype=f
+0002cc10: 6c6f 6174 290a 2020 2020 2020 2020 6d61  loat).        ma
+0002cc20: 676e 6974 7564 6573 5f64 6220 3d20 6e70  gnitudes_db = np
+0002cc30: 2e61 7272 6179 286d 6167 6e69 7475 6465  .array(magnitude
+0002cc40: 735f 6462 2c20 6474 7970 653d 666c 6f61  s_db, dtype=floa
+0002cc50: 7429 0a0a 2020 2020 2020 2020 7468 6574  t)..        thet
+0002cc60: 6120 3d20 6e70 2e6c 696e 7370 6163 6528  a = np.linspace(
+0002cc70: 302c 2032 2a6e 702e 7069 2c20 3430 3029  0, 2*np.pi, 400)
+0002cc80: 0a20 2020 2020 2020 2063 7420 3d20 6e70  .        ct = np
+0002cc90: 2e63 6f73 2874 6865 7461 290a 2020 2020  .cos(theta).    
+0002cca0: 2020 2020 7374 203d 206e 702e 7369 6e28      st = np.sin(
+0002ccb0: 7468 6574 6129 0a20 2020 2020 2020 2066  theta).        f
+0002ccc0: 6f72 206d 6462 2c20 6d20 696e 207a 6970  or mdb, m in zip
+0002ccd0: 286d 6167 6e69 7475 6465 735f 6462 2c20  (magnitudes_db, 
+0002cce0: 6d61 676e 6974 7564 6573 293a 0a20 2020  magnitudes):.   
+0002ccf0: 2020 2020 2020 2020 2069 6620 6e6f 7420           if not 
+0002cd00: 6e70 2e69 7363 6c6f 7365 286d 6462 2c20  np.isclose(mdb, 
+0002cd10: 3029 3a0a 2020 2020 2020 2020 2020 2020  0):.            
+0002cd20: 2020 2020 7220 3d20 6d20 2f20 2831 202d      r = m / (1 -
+0002cd30: 206d 2a2a 3229 0a20 2020 2020 2020 2020   m**2).         
+0002cd40: 2020 2020 2020 2078 203d 206d 2a2a 3220         x = m**2 
+0002cd50: 2f20 2831 202d 206d 2a2a 3229 202b 2072  / (1 - m**2) + r
+0002cd60: 202a 2063 740a 2020 2020 2020 2020 2020   * ct.          
+0002cd70: 2020 2020 2020 7920 3d20 7220 2a20 7374        y = r * st
+0002cd80: 0a20 2020 2020 2020 2020 2020 2065 6c73  .            els
+0002cd90: 653a 0a20 2020 2020 2020 2020 2020 2020  e:.             
+0002cda0: 2020 2078 203d 205b 2d30 2e35 5d0a 2020     x = [-0.5].  
+0002cdb0: 2020 2020 2020 2020 2020 2020 2020 7920                y 
+0002cdc0: 3d20 5b30 5d0a 2020 2020 2020 2020 2020  = [0].          
+0002cdd0: 2020 6461 7461 2e61 7070 656e 6428 5b6d    data.append([m
+0002cde0: 6462 2c20 782c 2079 5d29 0a20 2020 2020  db, x, y]).     
+0002cdf0: 2020 2072 6574 7572 6e20 6461 7461 0a       return data.
```

### Comparing `sympy_plot_backends-3.2.0/spb/utils.py` & `sympy_plot_backends-3.3.0/spb/utils.py`

 * *Files 3% similar despite different names*

```diff
@@ -44,15 +44,25 @@
         _max = cfg["plot_range"]["max"]
         if not imaginary:
             return Tuple(symbol, _min, _max)
         return Tuple(symbol, _min + _min * 1j, _max + _max * 1j)
 
     free_symbols = _get_free_symbols(exprs)
     if params is not None:
-        free_symbols = free_symbols.difference(params.keys())
+        if any(isinstance(t, (list, tuple)) for t in params.keys()):
+            # take care of RangeSlider
+            p_symbols = set()
+            for k in params.keys():
+                if isinstance(k, (list, tuple)):
+                    p_symbols = p_symbols.union(k)
+                else:
+                    p_symbols = p_symbols.union([k])
+        else:
+            p_symbols = params.keys()
+        free_symbols = free_symbols.difference(p_symbols)
 
     if len(free_symbols) > npar:
         raise ValueError(
             "Too many free symbols.\n"
             + "Expected {} free symbols.\n".format(npar)
             + "Received {}: {}".format(len(free_symbols), free_symbols)
         )
@@ -685,33 +695,36 @@
         number_types = (NumberSymbol, Float, Integer, Rational,
             float, int, complex)
     else:
         number_types = (NumberSymbol, Float, Integer, Rational, float, int)
     return isinstance(t, number_types) or (isinstance(t, Expr) and t.is_number)
 
 
-def tf_to_control(tf, gen=None):
+def tf_to_control(tf):
     """Convert a transfer function to a ``control.TransferFunction``.
 
     Parameters
     ==========
-    tf : Expr, sympy.physics.control.TransferFunction, scipy.signal.TransferFunction
-        If the transfer function is a symbolic expression, it must be a
-        rational expression.
-    gen : Symbol or None
-        The s or z variable. It is only used if ``tf`` is a symbolic
-        expression containing multiple free symbols.
+    tf :
+        The transfer function's type can be:
+
+        * an instance of :py:class:`sympy.physics.control.lti.TransferFunction`
+          or :py:class:`sympy.physics.control.lti.TransferFunctionMatrix`
+        * an instance of :py:class:`scipy.signal.TransferFunction`
+        * a symbolic expression in rational form.
+        * a tuple of two or three elements: ``(num, den, generator [opt])``.
+          ``num, den`` can be symbolic expressions or list of coefficients.
 
     Returns
     =======
-    tf : ct.TransferFunction
+    tf : :py:class:`ct.TransferFunction`
     """
     ct = import_module("control")
     sp = import_module("scipy")
-    sympy = import_module("sympy")
+    sm = import_module("sympy.physics", import_kwargs={'fromlist':['control']})
 
     def _from_sympy_to_ct(num, den):
         fs = num.free_symbols.union(den.free_symbols)
         if len(fs) != 1:
             raise ValueError(
                 "In order to convert a SymPy trasfer function to a "
                 "``control`` transfer function, there must only be "
@@ -739,85 +752,115 @@
                 "coefficients are complex. At the time of coding this "
                 "message, the ``control`` module doesn't support complex "
                 "coefficents. You might still be able to achieve your goal "
                 "by setting ``control=False`` in your function call."
             )
         return ct.tf(n, d)
 
-    if isinstance(tf, ct.TransferFunction):
+    if ct and isinstance(tf, ct.TransferFunction):
         return tf
+
     if isinstance(tf, Expr):
-        if gen is None:
-            gen = tf.free_symbols.pop()
-        tf = sympy.physics.control.TransferFunction.from_rational_expression(
+        gen = tf.free_symbols.pop()
+        tf = sm.control.TransferFunction.from_rational_expression(
             tf, gen)
         return _from_sympy_to_ct(tf.num, tf.den)
-    elif isinstance(tf, sympy.physics.control.TransferFunction):
+
+    elif isinstance(tf, sm.control.TransferFunction):
         return _from_sympy_to_ct(tf.num, tf.den)
-    elif isinstance(tf, sp.signal.TransferFunction):
+
+    elif isinstance(tf, sm.control.TransferFunctionMatrix):
+        num, den = [], []
+        for i in range(tf.num_outputs):
+            row_num, row_den = [], []
+            for j in range(tf.num_inputs):
+                tmp = _from_sympy_to_ct(tf[i, j].num, tf[i, j].den)
+                row_num.append(list(tmp.num[0][0]))
+                row_den.append(list(tmp.den[0][0]))
+            num.append(row_num)
+            den.append(row_den)
+        return ct.tf(num, den)
+
+    elif sp and isinstance(tf, sp.signal.TransferFunction):
         return ct.tf(tf.num, tf.den, dt=0 if tf.dt is None else tf.dt)
+
+    elif isinstance(tf, (list, tuple)):
+        tf = tf_to_sympy(tf)
+        return _from_sympy_to_ct(tf.num, tf.den)
+
     else:
         raise TypeError(
             "Transfer function's type not recognized.\n" +
             "Received: type(tf) = %s\n" % type(tf) +
-            "Expected: Expr or sympy.physics.control.TransferFunction"
+            "Expected: Expr or sympy.physics.control.TransferFunction or " +
+            "sympy.physics.control.TransferFunctionMatrix"
         )
 
 
-def tf_to_sympy(tf, var=None, skip_check_dt=False):
+def tf_to_sympy(tf, var=None, skip_check_dt=False, params={}):
     """Convert a transfer function from the control module or from scipy.signal
     to a sympy ``TransferFunction`` or ``TransferFunctionMatrix``.
 
     Parameters
     ==========
     tf : control.TransferFunction, scipy.signal.TransferFunction
+
+        * an instance of :py:class:`sympy.physics.control.lti.TransferFunction`
+          or :py:class:`sympy.physics.control.lti.TransferFunctionMatrix`
+        * an instance of :py:class:`control.TransferFunction`
+        * an instance of :py:class:`scipy.signal.TransferFunction`
+        * a symbolic expression in rational form.
+        * a tuple of two or three elements: ``(num, den, generator [opt])``.
+          ``num, den`` can be symbolic expressions or list of coefficients.
+
     var : Symbol or None
-        The s-variable (or z-variable).
+        The s-variable (or z-variable) when ``tf`` is a symbolic expression.
+        If not provided, it will be automatically selected.
     skip_check_dt : bool
         If True, don't raise a warning about sympy not supporting discrete-time
         systems.
+    params : dict
+        A dictionary whose keys are symbols.
 
     Returns
     =======
     tf : TransferFunction or TransferFunctionMatrix
     """
     ct = import_module("control")
     sp = import_module("scipy")
-    sympy = import_module("sympy")
+    sm = import_module("sympy.physics", import_kwargs={'fromlist':['control']})
 
     gen = Symbol("z") if is_discrete_time(tf) else Symbol("s")
-    TransferFunction = sympy.physics.control.lti.TransferFunction
-    TransferFunctionMatrix = sympy.physics.control.lti.TransferFunctionMatrix
-    Series = sympy.physics.control.lti.Series
-    Parallel = sympy.physics.control.lti.Parallel
+    TransferFunction = sm.control.lti.TransferFunction
+    TransferFunctionMatrix = sm.control.lti.TransferFunctionMatrix
+    Series = sm.control.lti.Series
+    Parallel = sm.control.lti.Parallel
 
     def _check_dt(system):
         if system.dt and (not skip_check_dt):
             warnings.warn(
                 "At the time of writing this message, SymPy doesn't "
                 "implement discrete-time transfer functions. Returning "
                 "a continuous-time transfer function."
             )
 
     if isinstance(tf, (TransferFunction, TransferFunctionMatrix)):
         return tf
 
     elif isinstance(tf, Expr):
         if var is None:
-            fs = list(tf.free_symbols)
+            fs = list(tf.free_symbols.difference(params.keys()))
             if len(fs) > 1:
                 warnings.warn(
                     "Multiple free symbols found in transfer function: %s. "
                     "Selecting the first as the s-variable "
                     "(or z-variable). Use the ``var=`` keyword argument "
                     "to specify the appropriate symbol." % fs
                 )
-                var = fs[0]
-            else:
-                var = tf.free_symbols.pop() if len(tf.free_symbols) > 0 else Symbol("s")
+            var = fs[0] if len(tf.free_symbols) > 0 else Symbol("s")
         return TransferFunction.from_rational_expression(tf, var)
 
     elif isinstance(tf, (Series, Parallel)):
         return tf.doit()
 
     if (ct is not None) and isinstance(tf, ct.TransferFunction):
         if (tf.ninputs == 1) and (tf.noutputs == 1):
@@ -839,14 +882,38 @@
 
     elif (sp is not None) and isinstance(tf, sp.signal.TransferFunction):
         n = Poly.from_list(tf.num, gen).as_expr()
         d = Poly.from_list(tf.den, gen).as_expr()
         _check_dt(tf)
         return TransferFunction(n, d, gen)
 
+    if isinstance(tf, (list, tuple)):
+        powers = lambda e, s: [t * s**(len(e) - (k + 1))
+            for k, t in enumerate(e)]
+        if len(tf) == 2:
+            num, den = tf
+            if all(isinstance(e, Expr) for e in tf):
+                gen = Tuple(num, den).free_symbols.difference(params.keys()).pop()
+            else:
+                num = sum(powers(num, gen))
+                den = sum(powers(den, gen))
+            return TransferFunction(num, den, gen)
+        elif len(tf) == 3:
+            num, den, gen = tf
+            if not all(isinstance(e, Expr) for e in tf):
+                num = sum(powers(num, gen))
+                den = sum(powers(den, gen))
+            return TransferFunction(num, den, gen)
+        else:
+            raise ValueError(
+                "If a tuple/list is provided, it must have "
+                "two or three elements: (num, den, free_symbol [opt]). "
+                f"Received len(system) = {len(tf)}, system = {tf}"
+            )
+
     else:
         raise TypeError(
             "Transfer function's type not recognized.\n" +
             "Received: type(tf) = %s\n" % type(tf) +
             "Expected: Expr or sympy.physics.control.TransferFunction"
         )
 
@@ -861,17 +928,17 @@
 
 
 def is_discrete_time(system):
     """Verify if ``system`` is a discrete-time control system.
     """
     ct = import_module("control")
     sp = import_module("scipy")
-    sy = import_module("sympy")
+    sm = import_module("sympy.physics", import_kwargs={'fromlist':['control']})
 
-    if isinstance(system, sy.physics.control.lti.SISOLinearTimeInvariant):
+    if isinstance(system, sm.control.lti.SISOLinearTimeInvariant):
         return False
     if (sp is not None) and isinstance(system, sp.signal.TransferFunction):
         return False if system.dt is None else True
     if (ct is not None) and isinstance(system, ct.TransferFunction):
         return system.isdtime()
     return False
 
@@ -890,7 +957,27 @@
             "sympy.physics.control.lti.TransferFunction."
         )
 
     num, den, s = tf.args
     exp_num = [t for t in num.find(exp) if t.has(s)]
     exp_den = [t for t in den.find(exp) if t.has(s)]
     return exp_num + exp_den
+
+
+def is_siso(system):
+    """Check if a control system is SISO or not.
+    """
+    ct = import_module("control")
+    sp = import_module("scipy")
+    sm = import_module("sympy.physics", import_kwargs={'fromlist':['control']})
+    if isinstance(system, sm.control.lti.SISOLinearTimeInvariant):
+        return True
+    if sp and isinstance(system, sp.signal.TransferFunction):
+        return True
+    if (
+        ct and isinstance(system, ct.TransferFunction) and
+        (system.ninputs == 1) and (system.noutputs == 1)
+    ):
+        return True
+    if isinstance(system, Expr):
+        return True
+    return False
```

### Comparing `sympy_plot_backends-3.2.0/spb/wegert.py` & `sympy_plot_backends-3.3.0/spb/wegert.py`

 * *Files identical despite different names*

### Comparing `sympy_plot_backends-3.2.0/sympy_plot_backends.egg-info/PKG-INFO` & `sympy_plot_backends-3.3.0/sympy_plot_backends.egg-info/PKG-INFO`

 * *Files 6% similar despite different names*

```diff
@@ -1,10 +1,10 @@
 Metadata-Version: 2.1
 Name: sympy_plot_backends
-Version: 3.2.0
+Version: 3.3.0
 Summary: Backends for plotting with SymPy
 Home-page: https://github.com/Davide-sd/sympy-plot-backends
 Author: Davide Sandona
 Author-email: sandona.davide@gmail.com
 License: BSD License
 Keywords: sympy plot plotting backend plotly bokeh mayavi k3d panel
 Classifier: Development Status :: 5 - Production/Stable
@@ -28,45 +28,46 @@
 Requires-Dist: ipympl>=0.7.0; extra == "all"
 Requires-Dist: plotly>=4.14.3; extra == "all"
 Requires-Dist: panel>=1.0.0; extra == "all"
 Requires-Dist: ipywidgets_bokeh; extra == "all"
 Requires-Dist: colorcet; extra == "all"
 Requires-Dist: k3d>=2.9.7; extra == "all"
 Requires-Dist: vtk; extra == "all"
-Requires-Dist: control>=0.9.4; extra == "all"
+Requires-Dist: control>=0.10.0; extra == "all"
 Provides-Extra: dev
 Requires-Dist: scipy>=1.7.1; extra == "dev"
 Requires-Dist: adaptive>=0.13.1; extra == "dev"
 Requires-Dist: notebook; extra == "dev"
 Requires-Dist: ipympl>=0.7.0; extra == "dev"
 Requires-Dist: plotly>=4.14.3; extra == "dev"
 Requires-Dist: panel>=1.0.0; extra == "dev"
 Requires-Dist: ipywidgets_bokeh; extra == "dev"
 Requires-Dist: colorcet; extra == "dev"
 Requires-Dist: k3d>=2.9.7; extra == "dev"
 Requires-Dist: vtk; extra == "dev"
-Requires-Dist: control>=0.9.4; extra == "dev"
+Requires-Dist: control>=0.10.0; extra == "dev"
 Requires-Dist: pytest; extra == "dev"
 Requires-Dist: pytest-mock; extra == "dev"
 Requires-Dist: sphinx; extra == "dev"
 Requires-Dist: sphinx-rtd-theme; extra == "dev"
 Requires-Dist: kaleido; extra == "dev"
 Requires-Dist: numpydoc; extra == "dev"
 
 # Sympy Plotting Backends
 
 [![PyPI version](https://badge.fury.io/py/sympy-plot-backends.svg)](https://badge.fury.io/py/sympy-plot-backends)
 [![Conda Version](https://img.shields.io/conda/vn/conda-forge/sympy_plot_backends.svg)](https://anaconda.org/conda-forge/sympy_plot_backends)
 [![Documentation Status](https://readthedocs.org/projects/sympy-plot-backends/badge/?version=latest)](http://sympy-plot-backends.readthedocs.io/)
 ![Coverage](https://github.com/Davide-sd/sympy-plot-backends/blob/master/coverage.svg)
+[![](https://img.shields.io/static/v1?label=Github%20Sponsor&message=%E2%9D%A4&logo=GitHub&color=%23fe8e86)](https://github.com/sponsors/Davide-sd)
 
 
 This module contains a few plotting backends that can be used with [SymPy](github.com/sympy/sympy) and [Numpy](https://github.com/numpy/numpy). A backend represents the plotting library: it provides the necessary functionalities to quickly and easily plot the most common types of symbolic expressions (line plots, surface plots, parametric plots, vector plots, complex plots, control system plots).
 
-The following plotting libraries are supported: [Matplolib](https://matplotlib.org/), [Plotly](https://plotly.com/), [Bokeh](https://github.com/bokeh/bokeh), [K3D-Jupyter](https://github.com/K3D-tools/K3D-jupyter), [Mayavi](https://github.com/enthought/mayavi).
+The following plotting libraries are supported: [Matplolib](https://matplotlib.org/), [Plotly](https://plotly.com/), [Bokeh](https://github.com/bokeh/bokeh), [K3D-Jupyter](https://github.com/K3D-tools/K3D-jupyter).
 
 <div>
 <img src="https://raw.githubusercontent.com/Davide-sd/sympy-plot-backends/master/imgs/iplot_bokeh.png" width=250/>
 <img src="https://raw.githubusercontent.com/Davide-sd/sympy-plot-backends/master/imgs/mpl-streamplot.png" width=250/>
 <img src="https://raw.githubusercontent.com/Davide-sd/sympy-plot-backends/master/imgs/plotly_streamlines_2.png" width=250/>
 <img src="https://raw.githubusercontent.com/Davide-sd/sympy-plot-backends/master/imgs/K3D-spherical-harmonics.png" width=250/>
 <img src="https://raw.githubusercontent.com/Davide-sd/sympy-plot-backends/master/imgs/bokeh_domain_coloring.png" width=250/>
@@ -80,32 +81,39 @@
 `plot_parametric`, `plot3d`, etc.), this module offers the capabily to:
 
 * use a different plotting library.
 * visualize discontinuities on 2D line plots.
 * visualize 2D/3D vector fields with quivers or streamlines.
 * visualize complex functions with [domain coloring](https://en.wikipedia.org/wiki/Domain_coloring).
 * visualize entities from the `sympy.geometry` module.
-* visualize control systems' response to input signals, visualize Bode, Nyquist and Nichols plots.
+* visualize control systems' response to input signals, root locus, as well as Bode, Nyquist and Nichols diagrams.
 * create parametric-interactive plots using widgets
   (sliders, buttons, etc.) with *ipywidgets* or *Holoviz's Panel*.
-* combine multiple plots into a grid-like layout.
 
 Please, read the
 [following documentation page](https://sympy-plot-backends.readthedocs.io/en/latest/overview.html#differences-with-sympy-plotting)
 to understand the differences between this module and ``sympy.plotting``.
 
-If you feel like some feature could be implemented, open an issue or create
-a PR.
 
+## Development and Support
 
-## Explore the Capabilities
+If you feel like a feature could be implemented, open an issue or create a PR.
 
-[Read the documentation](https://sympy-plot-backends.readthedocs.io/) to 
-explore the capabilities before the installation, which contains plenty of
-examples.
+If you really want a new feature but you don't have the capabilities or the
+time to make it work, I'm willing to help; but first, open an issue or send
+me an email so that we can discuss a sponsorship strategy.
+
+Developing this module and its documentation was no easy job. Implementing
+new features and fixing bugs requires time and energy too. If you found this
+module useful and would like to show your appreciation, please consider
+sponsoring this project with either one of these options:
+
+[!["Buy Me A Coffee"](https://www.buymeacoffee.com/assets/img/custom_images/orange_img.png)](https://www.buymeacoffee.com/davide_sd)
+or
+[![](https://img.shields.io/static/v1?label=Github%20Sponsor&message=%E2%9D%A4&logo=GitHub&color=%23fe8e86)](https://github.com/sponsors/Davide-sd)
 
 
 ## Installation
 
 *SymPy Plotting Backends* can be installed with `pip` or `conda`. By default,
 only basic plotting with Matplotlib will be installed:
 
@@ -122,32 +130,33 @@
 To install the complete requirements in order to get interactive plots, bokeh,
 plotly, k3d, vtk, execute the following command:
 
 ```
 pip install sympy_plot_backends[all]
 ```
 
-Or:
+If you are using zshell, the above `pip` command is going to fail.
+Use the following instead:
+
+```
+pip install "sympy_plot_backends[all]"
+```
+
+Or, if you are using `conda`:
 
 ```
 conda install -c anaconda scipy notebook colorcet
 conda install -c conda-forge adaptive
 conda install -c conda-forge panel
 conda install -c anaconda ipywidgets
 conda install -c conda-forge ipympl
 conda install -c bokeh ipywidgets_bokeh
 conda install -c conda-forge k3d msgpack-python
 conda install -c plotly plotly
 conda install -c conda-forge vtk
+conda install -c conda-forge control slycot
 ```
 
-Finally, if you are using zshell, the above `pip` command is going to fail.
-Use the following instead:
-
-```
-pip install "sympy_plot_backends[all]"
-```
-  
 
 ## Warnings
 
 **Some backend comes with a memory cost**. Since they require external libraries and/or open a server-process in order to visualize the data, memory usage can quickly rise if we are showing many plots. Keep an eye on you system monitor and act accordingly (close the kernels, restart the browser, etc.).
```

### Comparing `sympy_plot_backends-3.2.0/sympy_plot_backends.egg-info/SOURCES.txt` & `sympy_plot_backends-3.3.0/sympy_plot_backends.egg-info/SOURCES.txt`

 * *Files 1% similar despite different names*

```diff
@@ -45,14 +45,15 @@
 spb/backends/k3d/renderers/implicit3d.py
 spb/backends/k3d/renderers/line3d.py
 spb/backends/k3d/renderers/surface.py
 spb/backends/k3d/renderers/vector3d.py
 spb/backends/matplotlib/__init__.py
 spb/backends/matplotlib/matplotlib.py
 spb/backends/matplotlib/renderers/__init__.py
+spb/backends/matplotlib/renderers/_sgrid_helper.py
 spb/backends/matplotlib/renderers/arrow2d.py
 spb/backends/matplotlib/renderers/arrow3d.py
 spb/backends/matplotlib/renderers/complex.py
 spb/backends/matplotlib/renderers/contour.py
 spb/backends/matplotlib/renderers/generic.py
 spb/backends/matplotlib/renderers/geometry.py
 spb/backends/matplotlib/renderers/hvline.py
```

### Comparing `sympy_plot_backends-3.2.0/tests/backends/__init__.py` & `sympy_plot_backends-3.3.0/tests/backends/__init__.py`

 * *Files identical despite different names*

### Comparing `sympy_plot_backends-3.2.0/tests/backends/make_tests.py` & `sympy_plot_backends-3.3.0/tests/backends/make_tests.py`

 * *Files 5% similar despite different names*

```diff
@@ -1,15 +1,16 @@
 from spb import (
     plot, plot_parametric, plot_polar, plot_list, plot_implicit,
     plot_contour, plot_piecewise, plot_geometry,
     plot3d_parametric_line, plot3d, plot3d_list,
     plot3d_implicit, plot3d_parametric_surface,
     plot_vector, plot_complex, plot_real_imag, plot_riemann_sphere,
     graphics, arrow_2d, arrow_3d, plot_root_locus, plot_pole_zero,
-    ngrid, sgrid, zgrid, mcircles, surface, surface_parametric, line
+    ngrid, sgrid, zgrid, mcircles, surface, surface_parametric, line,
+    root_locus
 )
 from spb.series import (
     SurfaceOver2DRangeSeries, ParametricSurfaceSeries, LineOver1DRangeSeries,
     HVLineSeries
 )
 from sympy import (
     symbols, sin, cos, pi, exp, Matrix, sqrt, Heaviside, Piecewise, Eq, I,
@@ -913,27 +914,47 @@
 
 def make_test_root_locus_2(B):
     G1 = (s**2 + 1) / (s**3 + 2*s**2 + 3*s + 4)
     G2 = (s**2 - 4) / (s**3 + 2*s - 3)
     return plot_root_locus((G1, "a"), (G2, "b"), backend=B, show=False)
 
 
+def make_test_root_locus_3(B, _sgrid, _zgrid):
+    G = (a * s**2 + 1) / (s**3 + 2*s**2 + 3*s + 4)
+    grid = []
+    if _sgrid:
+        grid = sgrid(auto=False)
+    elif _zgrid:
+        grid = zgrid()
+    return graphics(
+        grid,
+        root_locus(G, sgrid=False, zgrid=False, params={a: (1, 0, 2)}),
+        show=False, backend=B)
+
+
 def make_test_plot_pole_zero(B, sgrid, zgrid, T, is_filled):
     G = (a * s**2 + 1) / (s**4 + 4*s**3 + 6*s**2 + 5*s + 2)
     return plot_pole_zero(G, show=False, backend=B,
         params={a: (1, 0, 2)}, T=T, sgrid=sgrid, zgrid=zgrid,
         is_filled=is_filled)
 
 
 def make_test_poles_zeros_sgrid(B):
     G = (a * s**2 + 1) / (s**4 + 4*s**3 + 6*s**2 + 5*s + 2)
     return plot_pole_zero(G, sgrid=True, show=False, backend=B,
         params={a: (1, 0, 2)})
 
 
+def make_test_root_locus_4(B, sgrid, zgrid):
+    G1 = 1 / (s + 2)
+    G2 = (a * s**2 + 1) / (s**4 + 4*s**3 + 6*s**2 + 5*s + 2)
+    return plot_root_locus(G1, G2, show=False,
+        backend=B, sgrid=sgrid, zgrid=zgrid, params={a: (1, 0, 2)})
+
+
 def make_test_ngrid(B, cl_mags, cl_phases, label_cl_phases):
     return graphics(
         ngrid(cl_mags, cl_phases, label_cl_phases),
         grid=False, show=False, backend=B
     )
```

### Comparing `sympy_plot_backends-3.2.0/tests/backends/test_base_backend.py` & `sympy_plot_backends-3.3.0/tests/backends/test_base_backend.py`

 * *Files identical despite different names*

### Comparing `sympy_plot_backends-3.2.0/tests/backends/test_bokeh.py` & `sympy_plot_backends-3.3.0/tests/backends/test_bokeh.py`

 * *Files 2% similar despite different names*

```diff
@@ -62,14 +62,15 @@
     make_test_parametric_texts_2d,
     make_test_line_color_func,
     make_test_plot_list_color_func,
     make_test_real_imag,
     make_test_arrow_2d,
     make_test_root_locus_1,
     make_test_root_locus_2,
+    make_test_root_locus_4,
     make_test_plot_pole_zero,
     make_test_poles_zeros_sgrid,
     make_test_ngrid,
     make_test_sgrid,
     make_test_zgrid,
     make_test_mcircles,
     make_test_hvlines
@@ -636,15 +637,15 @@
 
 
 def test_plot_size():
     # verify that the keyword `size` is doing it's job
     # NOTE: K3DBackend doesn't support custom size
 
     p = make_test_plot_size(BB)
-    assert p.fig.sizing_mode == "stretch_width"
+    assert p.fig.sizing_mode == "fixed"
 
     p = make_test_plot_size(BB, (400, 200))
     assert p.fig.sizing_mode == "fixed"
     assert (p.fig.width == 400) and (p.fig.height == 200)
 
 
 @pytest.mark.filterwarnings("ignore::RuntimeWarning")
@@ -1344,14 +1345,36 @@
     line_colors = {'#1f77b4', '#ff7f0e', '#aaa'}
     assert all(t.glyph.line_color in line_colors for t in fig.renderers)
     assert fig.legend[0].items[0].label["value"] == "a"
     assert fig.legend[0].items[1].label["value"] == "b"
     p.update_interactive({})
 
 
+@pytest.mark.skipif(ct is None, reason="control is not installed")
+@pytest.mark.parametrize(
+    "sgrid, zgrid", [
+        (True, False),
+        (False, True),
+        (False, False)
+    ]
+)
+def test_plot_root_locus_axis_limits(sgrid, zgrid):
+    # verify that root locus is renderered with appropriate axis limits
+
+    p = make_test_root_locus_4(BB, sgrid, zgrid)
+    fig = p.backend.fig
+    xlim = [fig.x_range.start, fig.x_range.end]
+    ylim = [fig.y_range.start, fig.y_range.end]
+    assert (xlim is not None) and (ylim is not None)
+    # these are eyeball numbers, it should allows a little bit of tweeking at
+    # the code for better positioning the grid...
+    assert xlim[0] > -5 and xlim[1] < 2
+    assert ylim[0] > -5 and ylim[1] < 5
+
+
 @pytest.mark.parametrize(
     "mag, n_lines, n_vlines, n_labels",
     [
         (None, 11, 1, 11),
         (-3, 2, 0, 1),
         (0, 1, 1, 1),
     ]
```

### Comparing `sympy_plot_backends-3.2.0/tests/backends/test_color_utils.py` & `sympy_plot_backends-3.3.0/tests/backends/test_color_utils.py`

 * *Files identical despite different names*

### Comparing `sympy_plot_backends-3.2.0/tests/backends/test_k3d.py` & `sympy_plot_backends-3.3.0/tests/backends/test_k3d.py`

 * *Files identical despite different names*

### Comparing `sympy_plot_backends-3.2.0/tests/backends/test_matplotlib.py` & `sympy_plot_backends-3.3.0/tests/backends/test_matplotlib.py`

 * *Files 1% similar despite different names*

```diff
@@ -11,15 +11,18 @@
     MB, plot, plot_riemann_sphere, plot_real_imag, plot_complex,
     plot_vector, plot3d_revolution, plot3d_spherical,
     plot3d_parametric_surface, plot_contour, plot3d, plot3d_parametric_line,
     plot_parametric, plot_implicit, plot_list, plot_geometry,
     plot_complex_list, graphics, vector_field_2d, plot_nyquist, plot_nichols,
     plot_step_response
 )
-from spb.series import RootLocusSeries, SGridLineSeries, ZGridLineSeries
+from spb.series import (
+    RootLocusSeries, SGridLineSeries, ZGridLineSeries, ContourSeries,
+    Vector2DSeries
+)
 from spb.series import SurfaceOver2DRangeSeries
 from sympy import (
     sin, cos, I, pi, Eq, exp, Circle, Polygon, sqrt, Matrix, Line, Segment,
     latex, log
 )
 from sympy.abc import x, y, z, u, t, a, b, c
 from sympy.external import import_module
@@ -84,14 +87,16 @@
     make_test_line_color_func,
     make_test_plot_list_color_func,
     make_test_real_imag,
     make_test_arrow_2d,
     make_test_arrow_3d,
     make_test_root_locus_1,
     make_test_root_locus_2,
+    make_test_root_locus_3,
+    make_test_root_locus_4,
     make_test_plot_pole_zero,
     make_test_poles_zeros_sgrid,
     make_test_ngrid,
     make_test_sgrid,
     make_test_zgrid,
     make_test_mcircles,
     make_test_hvlines
@@ -2158,15 +2163,17 @@
     assert np.allclose(ax.patches[0]._dxdydz, [4, 5, 6])
     p.backend.close()
 
 
 @pytest.mark.skipif(ct is None, reason="control is not installed")
 @pytest.mark.parametrize(
     "sgrid, zgrid, n_lines, n_texts, instance", [
-        (True, False, 18, 10, SGridLineSeries),
+        # the grid is drawn by some kind of matplotlib's grid locator
+        (True, False, 1, 0, SGridLineSeries),
+        # the grid is drawn manually, line by line
         (False, True, 33, 20, ZGridLineSeries),
     ]
 )
 def test_plot_root_locus_1(sgrid, zgrid, n_lines, n_texts, instance):
     a = symbols("a")
     p = make_test_root_locus_1(MB, sgrid, zgrid)
     assert isinstance(p.backend, MB)
@@ -2182,28 +2189,54 @@
     line_colors = {'#1f77b4', '0.75'}
     assert all(l.get_color() in line_colors for l in ax.lines)
     p.backend.update_interactive({a: 2})
     p.backend.close()
 
 
 @pytest.mark.skipif(ct is None, reason="control is not installed")
+@pytest.mark.parametrize(
+    "sgrid, zgrid, n_lines, n_texts, instance", [
+        (True, False, 35, 21, SGridLineSeries),
+        (False, True, 33, 20, ZGridLineSeries),
+    ]
+)
+def test_plot_root_locus_3(sgrid, zgrid, n_lines, n_texts, instance):
+    a = symbols("a")
+    p = make_test_root_locus_3(MB, sgrid, zgrid)
+    assert isinstance(p.backend, MB)
+    assert len(p.backend.series) == 2
+    # NOTE: the backend is going to reorder data series such that grid
+    # series are placed at the end.
+    assert isinstance(p.backend[0], RootLocusSeries)
+    assert isinstance(p.backend[1], instance)
+    ax = p.backend.ax
+    assert len(ax.lines) == n_lines
+    assert ax.get_legend() is None
+    assert len(ax.texts) == n_texts # number of sgrid labels on the plot
+    line_colors = {'#1f77b4', '0.75'}
+    assert all(l.get_color() in line_colors for l in ax.lines)
+    p.backend.update_interactive({a: 2})
+    p.backend.close()
+
+
+@pytest.mark.skipif(ct is None, reason="control is not installed")
 def test_plot_root_locus_2():
     p = make_test_root_locus_2(MB)
     assert isinstance(p, MB)
     assert len(p.series) == 3
     assert isinstance(p[0], RootLocusSeries)
     assert isinstance(p[1], RootLocusSeries)
     assert isinstance(p[2], SGridLineSeries)
     ax = p.ax
-    assert len(ax.lines) == 19
+    assert len(ax.lines) == 2
+    assert len(ax.texts) == 0
     assert len(ax.get_legend().texts) == 2
     assert p.ax.get_legend().texts[0].get_text() == "a"
     assert p.ax.get_legend().texts[1].get_text() == "b"
-    assert len(p.ax.texts) == 10 # number of sgrid labels on the plot
-    line_colors = {'#1f77b4', '#ff7f0e', '0.75'}
+    line_colors = {'#1f77b4', '#ff7f0e'}
     assert all(l.get_color() in line_colors for l in ax.lines)
     p.close()
 
 
 @pytest.mark.skipif(ipy is None, reason="ipywidgets is not installed")
 @pytest.mark.parametrize(
     "sgrid, zgrid, T, is_filled", [
@@ -2239,18 +2272,25 @@
     assert xlim[0] > -5 and xlim[1] < 2
     assert ylim[0] > -5 and ylim[1] < 5
     p.backend.update_interactive({a: 2})
     p.backend.close()
 
 
 @pytest.mark.skipif(ct is None, reason="control is not installed")
-def test_plot_root_locus_sgrid():
-    # verify that SGridLineSeries is rendered with "proper" axis limits
+@pytest.mark.parametrize(
+    "sgrid, zgrid", [
+        (True, False),
+        (False, True),
+        (False, False)
+    ]
+)
+def test_plot_root_locus_axis_limits(sgrid, zgrid):
+    # verify that root locus is renderered with appropriate axis limits
 
-    p = make_test_root_locus_1(MB, True, False)
+    p = make_test_root_locus_4(MB, sgrid, zgrid)
     ax = p.backend.ax
     xlim = ax.get_xlim()
     ylim = ax.get_ylim()
     assert (xlim is not None) and (ylim is not None)
     # these are eyeball numbers, it should allows a little bit of tweeking at
     # the code for better positioning the grid...
     assert xlim[0] > -5 and xlim[1] < 2
@@ -2276,16 +2316,16 @@
 
 
 @pytest.mark.parametrize(
     "xi, wn, tp, ts, auto, show_control_axis, params, n_lines, n_texts",
     [
         (None, None, None, None, False, True, None, 34, 21),
         (None, None, None, None, False, False, None, 35, 21),
-        (None, None, None, None, True, True, None, 17, 10),
-        (None, None, None, None, True, False, None, 18, 10),
+        (None, None, None, None, True, True, None, 0, 0),
+        (None, None, None, None, True, False, None, 0, 0),
         (0.5, False, None, None, False, False, None, 2, 1),
         ([0.5, 0.75], False, None, None, False, False, None, 4, 2),
         (False, 2, None, None, False, False, None, 1, 1),
         (False, [2, 3], None, None, False, False, None, 2, 2),
         (False, False, 2, None, False, False, None, 1, 0),
         (False, False, None, 3, False, False, None, 1, 0),
         (False, False, 2, 3, False, False, None, 2, 0),
@@ -2562,7 +2602,36 @@
     ax = p.backend.ax
     assert len(ax.lines) == 2
     assert not np.allclose(
         ax.lines[0].get_data(), ax.lines[1].get_data()
     )
     p.backend.update_interactive({a: 3, b: 4})
     p.backend.close()
+
+
+def test_plot_vector_2d_legend_1():
+    x, y = symbols("x, y")
+    p = plot_vector(
+        [-sin(y), cos(x)], (x, -pi, pi), (y, -pi, pi),
+        backend=MB, scalar=True, n=10, show=False
+    )
+    assert isinstance(p[0], ContourSeries)
+    assert isinstance(p[1], Vector2DSeries)
+    assert not p[1].use_cm
+    # this is because there is only one vector series with use_cm=False
+    assert p.legend is None
+
+@pytest.mark.parametrize(
+    "streamlines, use_cm, expected", [
+        (False, False, True),
+        (False, True, None),
+        (True, False, True),
+        (True, True, None)
+    ]
+)
+def test_plot_vector_2d_legend_2(streamlines, use_cm, expected):
+    x, y = symbols("x, y")
+    p = plot_vector(
+        [-sin(y), cos(x)], [cos(x), -sin(y)], (x, -pi, pi), (y, -pi, pi),
+        backend=MB, n=10, show=False, streamlines=streamlines, use_cm=use_cm
+    )
+    assert p.legend is expected
```

### Comparing `sympy_plot_backends-3.2.0/tests/backends/test_plotly.py` & `sympy_plot_backends-3.3.0/tests/backends/test_plotly.py`

 * *Files identical despite different names*

### Comparing `sympy_plot_backends-3.2.0/tests/graphics/test_complex_analysis.py` & `sympy_plot_backends-3.3.0/tests/graphics/test_complex_analysis.py`

 * *Files identical despite different names*

### Comparing `sympy_plot_backends-3.2.0/tests/graphics/test_control.py` & `sympy_plot_backends-3.3.0/tests/graphics/test_control.py`

 * *Files 7% similar despite different names*

```diff
@@ -757,15 +757,15 @@
     series1 = root_locus(G1, sgrid=False)
     assert len(series1) == 1
     assert isinstance(series1[0], RootLocusSeries)
     data1 = series1[0].get_data()
 
     series2 = root_locus(
         G1, control_kw={
-            "kvect": np.linspace(1e-03, 1000, 10)
+            "gains": np.linspace(1e-03, 1000, 10)
         }, sgrid=False)
     assert len(series2) == 1
     data2 = series2[0].get_data()
     assert data1[0].shape != data2[0].shape
 
     series = root_locus(G1, sgrid=False)
     assert len(series) == 1
@@ -831,50 +831,65 @@
     s2 = series[0]
     d2 = s2.get_data()
 
     assert np.allclose(d1, d2)
 
 
 @pytest.mark.parametrize(
-    "tf_mimo, func, use_control",
+    "tf_mimo, func, use_control, upper_limit",
     [
-        (tf_mimo_sympy, step_response, True),
-        (tf_mimo_sympy, impulse_response, True),
-        (tf_mimo_sympy, ramp_response, True),
-        (tf_mimo_sympy, step_response, False),
-        (tf_mimo_sympy, impulse_response, False),
-        (tf_mimo_sympy, ramp_response, False),
-        (tf_mimo_control, step_response, True),
-        (tf_mimo_control, impulse_response, True),
-        (tf_mimo_control, ramp_response, True),
-        (tf_mimo_control, step_response, False),
-        (tf_mimo_control, impulse_response, False),
-        (tf_mimo_control, ramp_response, False),
+        (tf_mimo_sympy, step_response, True, None),
+        (tf_mimo_sympy, impulse_response, True, None),
+        (tf_mimo_sympy, ramp_response, True, None),
+        (tf_mimo_sympy, step_response, False, None),
+        (tf_mimo_sympy, impulse_response, False, None),
+        (tf_mimo_sympy, ramp_response, False, None),
+        (tf_mimo_control, step_response, True, None),
+        (tf_mimo_control, impulse_response, True, None),
+        (tf_mimo_control, ramp_response, True, None),
+        (tf_mimo_control, step_response, False, None),
+        (tf_mimo_control, impulse_response, False, None),
+        (tf_mimo_control, ramp_response, False, None),
+        (tf_mimo_sympy, step_response, True, 10),
+        (tf_mimo_sympy, impulse_response, True, 10),
+        (tf_mimo_sympy, ramp_response, True, 10),
+        (tf_mimo_sympy, step_response, False, 10),
+        (tf_mimo_sympy, impulse_response, False, 10),
+        (tf_mimo_sympy, ramp_response, False, 10),
+        (tf_mimo_control, step_response, True, 10),
+        (tf_mimo_control, impulse_response, True, 10),
+        (tf_mimo_control, ramp_response, True, 10),
+        (tf_mimo_control, step_response, False, 10),
+        (tf_mimo_control, impulse_response, False, 10),
+        (tf_mimo_control, ramp_response, False, 10),
     ]
 )
-def test_mimo_responses(tf_mimo, func, use_control):
+def test_mimo_responses(tf_mimo, func, use_control, upper_limit):
     # verify that a MIMO system gets unpacked into several SISO systems
 
-    series = func(tf_mimo, prec=16, n=10, control=use_control)
+    series = func(tf_mimo, prec=16, n=10, control=use_control,
+        upper_limit=upper_limit)
     assert len(series) == 6
     test_series = SystemResponseSeries if use_control else LineOver1DRangeSeries
     assert all(isinstance(s, test_series) for s in series)
 
-    s1 = func(tf_1, prec=16, n=10, control=use_control)[0]
-    s2 = func(tf_2, prec=16, n=10, control=use_control)[0]
-    s3 = func(tf_3, prec=16, n=10, control=use_control)[0]
-    s4 = func(-tf_1, prec=16, n=10, control=use_control)[0]
-    s5 = func(-tf_2, prec=16, n=10, control=use_control)[0]
-    s6 = func(-tf_3, prec=16, n=10, control=use_control)[0]
-    assert np.allclose(s1.get_data(), series[0].get_data())
-    assert np.allclose(s2.get_data(), series[1].get_data())
-    assert np.allclose(s3.get_data(), series[2].get_data())
-    assert np.allclose(s4.get_data(), series[3].get_data())
-    assert np.allclose(s5.get_data(), series[4].get_data())
-    assert np.allclose(s6.get_data(), series[5].get_data())
+    kwargs = dict(prec=16, n=10, control=use_control, upper_limit=upper_limit)
+    s1 = func(tf_1, **kwargs)[0]
+    s2 = func(tf_2, **kwargs)[0]
+    s3 = func(tf_3, **kwargs)[0]
+    s4 = func(-tf_1, **kwargs)[0]
+    s5 = func(-tf_2, **kwargs)[0]
+    s6 = func(-tf_3, **kwargs)[0]
+    if upper_limit is not None:
+        assert np.allclose(s1.get_data(), series[0].get_data())
+        assert np.allclose(s2.get_data(), series[1].get_data())
+        assert np.allclose(s3.get_data(), series[2].get_data())
+        assert np.allclose(s4.get_data(), series[3].get_data())
+        assert np.allclose(s5.get_data(), series[4].get_data())
+        assert np.allclose(s6.get_data(), series[5].get_data())
 
 
 @pytest.mark.parametrize(
     "tf_mimo, func, inp, out",
     [
         (tf_mimo_sympy, step_response, 1, 2),
         (tf_mimo_sympy, impulse_response, 1, 2),
```

### Comparing `sympy_plot_backends-3.2.0/tests/graphics/test_control_min_module.py` & `sympy_plot_backends-3.3.0/tests/graphics/test_control_min_module.py`

 * *Files identical despite different names*

### Comparing `sympy_plot_backends-3.2.0/tests/graphics/test_functions_2d.py` & `sympy_plot_backends-3.3.0/tests/graphics/test_functions_2d.py`

 * *Files identical despite different names*

### Comparing `sympy_plot_backends-3.2.0/tests/graphics/test_functions_3d.py` & `sympy_plot_backends-3.3.0/tests/graphics/test_functions_3d.py`

 * *Files identical despite different names*

### Comparing `sympy_plot_backends-3.2.0/tests/graphics/test_graphics.py` & `sympy_plot_backends-3.3.0/tests/graphics/test_graphics.py`

 * *Files identical despite different names*

### Comparing `sympy_plot_backends-3.2.0/tests/graphics/test_vectors.py` & `sympy_plot_backends-3.3.0/tests/graphics/test_vectors.py`

 * *Files identical despite different names*

### Comparing `sympy_plot_backends-3.2.0/tests/interactive/test_interactive.py` & `sympy_plot_backends-3.3.0/tests/interactive/test_interactive.py`

 * *Files 2% similar despite different names*

```diff
@@ -22,17 +22,19 @@
     [
         ((1, 0, 5), 1, 0, 5, 0.125, None, "x", "linear"),
         ((5, 0, 1), 1, 0, 5, 0.125, None, "x", "linear"),
         ((0, 1, 5), 1, 0, 5, 0.125, None, "x", "linear"),
         ((0, 5, 1), 1, 0, 5, 0.125, None, "x", "linear"),
         ((0, 0, 1), 0, 0, 1, 0.025, None, "x", "linear"),
         ((1, 0, 1), 1, 0, 1, 0.025, None, "x", "linear"),
+        # if symbolic numbers are provided, they'll get casted to floats
         ((pi, Rational(1, 2), Integer(15)), math.pi, 0.5, 15, 0.3625, None, "x", "linear"),
         ((1, 0, 5, 50), 1, 0, 5, 0.1, None, "x", "linear"),
         ((1, 0, 5, 50, ".5f"), 1, 0, 5, 0.1, ".5f", "x", "linear"),
+        ((1, 0, 5, 50, "%.4f"), 1, 0, 5, 0.1, "%.4f", "x", "linear"),
         ((1, 0, 5, 50, ".5f", "test"), 1, 0, 5, 0.1, ".5f", "test", "linear"),
         ((1, 0, 5, 50, ".5f", "test", "log"), 1, 0, 5, 0.1, ".5f", "test", "log"),
         ((1, 0, 5, 50, "log"), 1, 0, 5, 0.1, None, "x", "log"),
         ((1, 0, 5, 50, "test"), 1, 0, 5, 0.1, None, "test", "linear"),
         ((1, 0, 5, "test"), 1, 0, 5, 0.125, None, "test", "linear"),
         ((1, 0, 5, "test", ".5f"), 1, 0, 5, 0.125, ".5f", "test", "linear"),
         ((1, 0, 5, tf), 1, 0, 5, 0.125, tf, "x", "linear"),
```

### Comparing `sympy_plot_backends-3.2.0/tests/interactive/test_panel.py` & `sympy_plot_backends-3.3.0/tests/interactive/test_panel.py`

 * *Files 26% similar despite different names*

```diff
@@ -1,312 +1,132 @@
 import pytest
 from pytest import raises
 pn = pytest.importorskip("panel")
-from spb import BB, PB, MB, plot
+from spb import BB, PB, MB, plot, graphics, line, line_parametric_2d
 from spb.interactive.panel import (
-    DynamicParam, MyList, InteractivePlot, create_widgets
+    DynamicParam, InteractivePlot, create_widgets
 )
 from spb.interactive.bootstrap_spb import SymPyBootstrapTemplate
+from spb.utils import prange
 from sympy import (
-    Integer, Float, Rational, pi, symbols, sin, cos
+    Integer, Float, Rational, pi, symbols, sin, cos, exp
 )
 import numpy as np
 import param
 import bokeh
 
 
-def test_DynamicParam():
-    a, b, c, d, e, f = symbols("a, b, c, d, e, f")
-
-    # test _tuple_to_dict
-    t = DynamicParam(
-        params={
-            a: (1, 0, 5),
-            b: (2, 1.5, 4.5, 20),
-            c: (3, 2, 5, 30, None, "test1"),
-            d: (1, 1, 10, 10, None, "test2", "log"),
-        },
-        use_latex=False,
-    )
-    p1 = getattr(t.param, "dyn_param_0")
-    p2 = getattr(t.param, "dyn_param_1")
-    p3 = getattr(t.param, "dyn_param_2")
-    p4 = getattr(t.param, "dyn_param_3")
-
-    def test_number(p, d, sb, l, st):
-        assert isinstance(p, param.Number)
-        assert p.default == d
-        assert p.softbounds == sb
-        assert p.label == l
-        assert p.step == st
-
-    def test_log_slider(p, d, sb, n, l):
-        assert isinstance(p, MyList)
-        assert p.default == 1
-        assert p.objects[0] == sb[0]
-        assert p.objects[-1] == sb[1]
-        assert len(p.objects) == 10
-        assert p.label == l
-
-    test_number(p1, 1, (0, 5), "a", 0.125)
-    test_number(p2, 2, (1.5, 4.5), "b", 0.15)
-    test_number(p3, 3, (2, 5), "test1", 0.1)
-    test_log_slider(p4, 1, (1, 10), 10, "test2")
-
-    # all formatters should be None
-    assert isinstance(t.formatters, dict)
-    assert len(t.formatters) == 4
-    assert all(e is None for e in t.formatters.values())
-
-    # test use_latex
-    formatter = bokeh.models.formatters.PrintfTickFormatter(format="%.4f")
-    t = DynamicParam(
-        params={
-            a: (1, 0, 5),
-            b: (2, 1.5, 4.5, 20),
-            c: (3, 2, 5, 30, formatter, "test1"),
-            d: (1, 1, 10, 10, None, "test2", "log"),
-        },
-        use_latex=True,
-    )
-    p1 = getattr(t.param, "dyn_param_0")
-    p2 = getattr(t.param, "dyn_param_1")
-    p3 = getattr(t.param, "dyn_param_2")
-    p4 = getattr(t.param, "dyn_param_3")
-
-    test_number(p1, 1, (0, 5), "$$a$$", 0.125)
-    test_number(p2, 2, (1.5, 4.5), "$$b$$", 0.15)
-    test_number(p3, 3, (2, 5), "test1", 0.1)
-    test_log_slider(p4, 1, (1, 10), 10, "test2")
-
-    # one formatter should be set
-    assert isinstance(t.formatters, dict)
-    assert len(t.formatters) == 4
-    assert all(t.formatters[k] is None for k in [a, b, d])
-    assert isinstance(
-        t.formatters[c], bokeh.models.formatters.PrintfTickFormatter
-    )
-
-    # test mix tuple and parameters
-    t = DynamicParam(
-        params={
-            a: (1, 0, 5),
-            b: (1, 1, 10, 10, None, "test3", "log"),
-            c: param.Boolean(default=True, label="test4"),
-            d: param.ObjectSelector(
+@pytest.mark.parametrize(
+    "par, expected_widget_type", [
+        (
+            param.Number(default=0, bounds=(0, 2), label="test"),
+            pn.widgets.FloatSlider
+        ),
+        (
+            param.Integer(default=0, bounds=(0, 2), label="test"),
+            pn.widgets.IntSlider
+        ),
+        (
+            param.Boolean(True),
+            pn.widgets.Checkbox
+        ),
+        (
+            param.ObjectSelector(
                 default=5, objects=[1, 2, 3, 4, 5], label="test5"
             ),
-            e: param.Number(
-                default=6.1, softbounds=(1.1, 10.1), label="test6"
-            ),
-            f: param.Integer(default=6, softbounds=(1, None), label="test7"),
-        },
-        use_latex=False,
-    )
-    p1 = getattr(t.param, "dyn_param_0")
-    p2 = getattr(t.param, "dyn_param_1")
-    p3 = getattr(t.param, "dyn_param_2")
-    p4 = getattr(t.param, "dyn_param_3")
-    p5 = getattr(t.param, "dyn_param_4")
-    p6 = getattr(t.param, "dyn_param_5")
-    test_number(p1, 1, (0, 5), "a", 0.125)
-    test_log_slider(p2, 1, (1, 10), 10, "test3")
-    assert isinstance(p3, param.Boolean)
-    assert p3.default is True
-    assert p3.label == "test4"
-    assert isinstance(p4, param.ObjectSelector)
-    assert p4.label == "test5"
-    assert p4.default == 5
-    assert isinstance(p5, param.Number)
-    assert p5.default == 6.1
-    assert p5.softbounds == (1.1, 10.1)
-    assert p5.label == "test6"
-    assert isinstance(p6, param.Integer)
-    assert p6.default == 6
-    assert p6.label == "test7"
-
-    r = {a: 1, b: 1, c: True, d: 5, e: 6.1, f: 6}
-    assert t.read_parameters() == r
-
-
-def test_DynamicParam_symbolic_parameters():
-    # verify that we can pass symbolic numbers, which will then be converted
-    # to float numbers
-
-    a, b, c = symbols("a, b, c")
-
-    # test _tuple_to_dict
-    t = DynamicParam(
-        params={
-            a: (Integer(1), 0, 5),
-            b: (2, Float(1.5), 4.5, Integer(20)),
-            c: (3 * pi / 2, Rational(2, 3), Float(5), 30, None, "test1"),
-        },
-        use_latex=False,
-    )
-    p1 = getattr(t.param, "dyn_param_0")
-    p2 = getattr(t.param, "dyn_param_1")
-    p3 = getattr(t.param, "dyn_param_2")
-
-    def test_number(p, d, sb):
-        assert isinstance(p, param.Number)
-        assert np.isclose(p.default, d) and isinstance(p.default, float)
-        assert p.softbounds == sb
-        assert all(isinstance(t, float) for t in p.softbounds)
-        assert isinstance(p.step, float)
-
-    test_number(p1, 1, (0, 5))
-    test_number(p2, 2, (1.5, 4.5))
-    test_number(p3, 1.5 * np.pi, (2 / 3, 5))
+            pn.widgets.select.Select
+        )
+    ]
+)
+def test_DynamicParam(par, expected_widget_type):
+    # verify the proper conversion from a param's Parameter to a
+    # panel's widget
+    d = DynamicParam(par)
+    tmp_panel = pn.Param(d)
+    widget = tmp_panel.widget("dyn_param_0")
+    assert isinstance(widget, expected_widget_type)
 
 
 def test_iplot(panel_options):
     # verify that the correct widgets are created, with the appropriate labels
 
     bm = bokeh.models
-    a, b, c, d = symbols("a, b, c, d")
-    x, y, u, v = symbols("x, y, u, v")
+    a, b, c, d, e, f, g, h, x = symbols("a, b, c, d, e, f, g, h, x")
 
     t = plot(
-        (a + b + c + d) * cos(x),
+        c * cos(a * x) * exp(-abs(x) / b) + d * (x - e) * f + g*h,
         (x, -5, 5),
         params={
             a: (2, 1, 3, 5),
-            b: (3, 2, 4000, 10, None, "label", "log"),
+            b: (3, 1e-03, 4e03, 10, None, "label", "log"),
             c: param.Number(0.15, softbounds=(0, 1), label="test", step=0.025),
             # TODO: if I remove the following label, the tests are going to
             # fail: it would use the label "test5"... How is it possible?
             d: param.Integer(1, softbounds=(0, 10), label="d"),
-            y: param.Integer(1, softbounds=(0, None)),
-            u: param.Boolean(default=True),
-            v: param.ObjectSelector(default=2, objects=[1, 2, 3, 4]),
+            e: param.Integer(1, softbounds=(0, None)),
+            f: param.Boolean(default=True),
+            g: param.ObjectSelector(default=2, objects=[1, 2, 3, 4]),
+            h: pn.widgets.FloatSlider(
+                value=5, start=0, end=10, name="float slider")
         },
         layout="tb",
         ncols=2,
         use_latex=False,
         **panel_options
     )
 
-    # no latex in labels
-    p1 = getattr(t.param, "dyn_param_0")
-    p2 = getattr(t.param, "dyn_param_1")
-    p3 = getattr(t.param, "dyn_param_2")
-    p4 = getattr(t.param, "dyn_param_3")
-
-    assert p1.label == "a"
-    assert p2.label == "label"
-    assert p3.label == "test"
-    assert p4.label == "d"
-
-    # there are 7 parameters in this plot
-    assert len(t.mapping) == 7
-
     # c1 wraps the controls, c2 wraps the plot
-    c1, c2 = t.show().get_root().children
-    gridbox = c1.children[0].children[0]
+    gridbox, html = t.show().get_root().children
     assert isinstance(gridbox.children[0][0], bm.Slider)
     assert isinstance(gridbox.children[1][0].children[1], bm.Slider)
     assert isinstance(gridbox.children[2][0], bm.Slider)
     assert isinstance(gridbox.children[3][0], bm.Slider)
     assert isinstance(gridbox.children[4][0], bm.Spinner)
     assert isinstance(gridbox.children[5][0], bm.Checkbox)
     assert isinstance(gridbox.children[6][0], bm.Select)
+    assert isinstance(gridbox.children[7][0], bm.Slider)
+    assert gridbox.children[0][0].title == "a"
+    assert gridbox.children[1][0].children[0].text[:5] == "label"
+    assert gridbox.children[2][0].title == "test"
+    assert gridbox.children[3][0].title == "d"
+    assert gridbox.children[7][0].title == "float slider"
+    # verify it's an Nx2 grid of widgets
+    assert gridbox.children[0][1:3] == (0, 0)
+    assert gridbox.children[1][1:3] == (0, 1)
+    assert gridbox.children[2][1:3] == (1, 0)
+    assert gridbox.children[3][1:3] == (1, 1)
+    assert gridbox.children[4][1:3] == (2, 0)
+    assert gridbox.children[5][1:3] == (2, 1)
+    assert gridbox.children[6][1:3] == (3, 0)
+    assert gridbox.children[7][1:3] == (3, 1)
 
-    # test that the previous class-attribute associated to the previous
-    # parameters are cleared in a new instance
-    current_params = [
-        k for k in InteractivePlot.__dict__.keys() if "dyn_param_" in k
-    ]
-    assert len(current_params) == 7
-
+    # verify use_latex works properly
     t = plot(
         (a + b + c) * cos(x),
         (x, -5, 5),
         params={
             a: (2, 1, 3, 5),
             b: (3, 2, 4000, 10),
             c: param.Number(0.15, softbounds=(0, 1), label="test", step=0.025),
         },
         layout="tb",
-        ncols=2,
+        ncols=3,
         use_latex=True,
         **panel_options
     )
 
-    # there are 3 parameters in this plot
-    assert len(t.mapping) == 3
-
-    # latex in labels
-    p1 = getattr(t.param, "dyn_param_0")
-    p2 = getattr(t.param, "dyn_param_1")
-    p3 = getattr(t.param, "dyn_param_2")
-
-    assert p1.label == "$$a$$"
-    assert p2.label == "$$b$$"
-    assert p3.label == "test"
-
-    t = plot(
-        (a + b) * cos(x),
-        (x, -5, 5),
-        params={
-            a: (1, 0, 5),
-            b: (1, 1, 10, 10, None, "test3", "log"),
-        },
-        use_latex=False,
-        **panel_options
-    )
-
-    new_params = [
-        k for k in InteractivePlot.__dict__.keys() if "dyn_param_" in k
-    ]
-    assert len(new_params) == 2
-
-
-def test_create_widgets():
-    x, y, z = symbols("x:z")
-
-    w = create_widgets(
-        {
-            x: (2, 0, 4),
-            y: (200, 1, 1000, 10, None, "y", "log"),
-            z: param.Integer(3, softbounds=(3, 10), label="n"),
-        },
-        use_latex=True,
-    )
-
-    assert isinstance(w, dict)
-    assert len(w) == 3
-    assert isinstance(w[x], pn.widgets.FloatSlider)
-    assert isinstance(w[y], pn.widgets.DiscreteSlider)
-    assert isinstance(w[z], pn.widgets.IntSlider)
-    assert w[x].name == "$$x$$"
-    assert w[y].name == "y"
-    assert w[z].name == "n"
-
-    formatter = bokeh.models.formatters.PrintfTickFormatter(format="%.4f")
-    w = create_widgets(
-        {
-            x: (2, 0, 4),
-            y: (200, 1, 1000, 10, formatter, "y", "log"),
-            z: param.Integer(3, softbounds=(3, 10), label="n"),
-        },
-        use_latex=False,
-    )
-
-    assert isinstance(w, dict)
-    assert len(w) == 3
-    assert isinstance(w[x], pn.widgets.FloatSlider)
-    assert isinstance(w[y], pn.widgets.DiscreteSlider)
-    assert isinstance(w[z], pn.widgets.IntSlider)
-    assert w[x].name == "x"
-    assert w[y].name == "y"
-    assert w[z].name == "n"
-
-    assert all(w[k].format is None for k in [x, z])
-    assert isinstance(w[y].format, bokeh.models.formatters.PrintfTickFormatter)
+    # c1 wraps the controls, c2 wraps the plot
+    gridbox, html = t.show().get_root().children
+    assert gridbox.children[0][0].title == "$$a$$"
+    assert gridbox.children[1][0].title == "$$b$$"
+    assert gridbox.children[2][0].title == "test"
+    # verify it's an 1x3 grid of widgets
+    assert gridbox.children[0][1:3] == (0, 0)
+    assert gridbox.children[1][1:3] == (0, 1)
+    assert gridbox.children[2][1:3] == (0, 2)
 
 
 def test_template(panel_options):
     # verify that user can provide custom templates for servable applications
     # (the ones that launches on a new browser window instead of being shown
     # on Jupyter Notebook).
     # NOTE: I'm not aware of any way to test an application once they have been
@@ -370,7 +190,99 @@
         cos(x * y), (x, -5, 5),
         params={y: (1, 0, 2)},
         servable=True,
         template="str",
         **panel_options
     )
     raises(TypeError, lambda: p._create_template())
+
+
+def test_create_widgets():
+    x, y, z = symbols("x:z")
+
+    w = create_widgets(
+        {
+            x: (2, 0, 4),
+            y: (200, 1, 1000, 10, None, "y", "log"),
+            z: param.Integer(3, softbounds=(3, 10), label="n"),
+        },
+        use_latex=True,
+    )
+
+    assert isinstance(w, dict)
+    assert len(w) == 3
+    assert isinstance(w[x], pn.widgets.FloatSlider)
+    assert isinstance(w[y], pn.widgets.DiscreteSlider)
+    assert isinstance(w[z], pn.widgets.IntSlider)
+    assert w[x].name == "$$x$$"
+    assert w[y].name == "y"
+    assert w[z].name == "n"
+
+    formatter = bokeh.models.formatters.PrintfTickFormatter(format="%.4f")
+    w = create_widgets(
+        {
+            x: (2, 0, 4, formatter),
+            y: (200, 1, 1000, 10, "%.4f", "y", "log"),
+            z: param.Integer(3, softbounds=(3, 10), label="n"),
+        },
+        use_latex=False,
+    )
+
+    assert isinstance(w, dict)
+    assert len(w) == 3
+    assert isinstance(w[x], pn.widgets.FloatSlider)
+    assert isinstance(w[y], pn.widgets.DiscreteSlider)
+    assert isinstance(w[z], pn.widgets.IntSlider)
+    assert w[x].name == "x"
+    assert w[y].name == "y"
+    assert w[z].name == "n"
+
+    assert isinstance(w[x].format, bokeh.models.formatters.PrintfTickFormatter)
+    assert w[y].formatter == "%.4f"
+    assert w[z].format is None
+
+
+@pytest.mark.skipif(pn is None, reason="panel is not installed")
+def test_params_multi_value_widgets_1():
+    a, b, c, x = symbols("a:c x")
+    p = plot(
+        cos(c * x), prange(x, a, b), n=10, adaptive=False,
+        params={
+            (a, b): pn.widgets.RangeSlider(
+                value=(-2, 2), start=-5, end=5, step=0.1),
+            c: (1, 0, 5)
+        }, imodule="panel", show=False, backend=MB)
+    fig = p.fig
+    d1 = p.backend[0].get_data()
+    # verify that no errors are raise when an update event is triggered
+    p._update((-3, 3), 2)
+    d2 = p.backend[0].get_data()
+    assert not np.allclose(d1, d2)
+
+
+@pytest.mark.skipif(pn is None, reason="panel is not installed")
+def test_params_multi_value_widgets_2():
+    a, b, c, d, x = symbols("a:d x")
+    p = graphics(
+        line(cos(x), range=(x, -5, 5), n=10, adaptive=False),
+        line(cos(c * x), range=(x, a, b), n=10, adaptive=False,
+            params={
+                (a, b): pn.widgets.RangeSlider(
+                    value=(-2, 2), start=-5, end=5, step=0.1),
+                c: (1, 0, 5)
+            }),
+        line_parametric_2d(cos(d*x), sin(d*x), range=(x, -4, 4),
+            n=10, adaptive=False,
+            params={d: (2, 0, 6)}),
+        imodule="panel", show=False, backend=MB)
+    fig = p.fig
+    d1 = p.backend[0].get_data()
+    d2 = p.backend[1].get_data()
+    d3 = p.backend[2].get_data()
+    # verify that no errors are raise when an update event is triggered
+    p._update((-3, 3), 2, 3)
+    d4 = p.backend[0].get_data()
+    d5 = p.backend[1].get_data()
+    d6 = p.backend[2].get_data()
+    assert np.allclose(d1, d4)
+    assert not np.allclose(d2, d5)
+    assert not np.allclose(d3, d6)
```

### Comparing `sympy_plot_backends-3.2.0/tests/plot_functions/test_complex.py` & `sympy_plot_backends-3.3.0/tests/plot_functions/test_complex.py`

 * *Files identical despite different names*

### Comparing `sympy_plot_backends-3.2.0/tests/plot_functions/test_control.py` & `sympy_plot_backends-3.3.0/tests/plot_functions/test_control.py`

 * *Files 10% similar despite different names*

```diff
@@ -1,12 +1,12 @@
 
 from spb.plot_functions.control import  (
     plot_pole_zero, plot_step_response, plot_impulse_response,
     plot_ramp_response, plot_bode_magnitude,
-    plot_bode_phase, plot_bode, plot_nyquist, plot_nichols)
+    plot_bode_phase, plot_bode, plot_nyquist, plot_nichols, plot_root_locus)
 from spb.interactive import IPlot
 from spb.series import HVLineSeries
 from spb.backends.matplotlib import unset_show
 from sympy import Dummy, I, Abs, arg, log, symbols, exp, latex
 from sympy.abc import s, p, a, b
 from sympy.external import import_module
 from sympy.physics.control.lti import (TransferFunction,
@@ -39,14 +39,23 @@
 num2, den2 = p, (p + a) * (p + b)
 tf_test2 = TransferFunction(num2, den2, p)
 test_params = {
     a: (3, 0, 5),
     b: (5, 0, 10),
 }
 
+_tf1 = TransferFunction(1, s + 2, s)
+_tf2 = TransferFunction(s + 1, s**2 + s + 1, s)
+_tf3 = TransferFunction(s + 1, s**2 + s + 1.5, s)
+tfm1 = TransferFunctionMatrix(
+    [[_tf1, -_tf1], [_tf2, -_tf2], [_tf3, -_tf3]])
+tfm2 = TransferFunctionMatrix(
+    [[_tf1*_tf1, -_tf1*_tf1], [_tf2*_tf1, -_tf2*_tf1], [_tf3*_tf1, -_tf3*_tf1]])
+
+
 def _to_tuple(a, b):
     return tuple(a), tuple(b)
 
 def _trim_tuple(a, b):
     a, b = _to_tuple(a, b)
     return tuple(a[0: 2] + a[len(a)//2 : len(a)//2 + 1] + a[-2:]), \
         tuple(b[0: 2] + b[len(b)//2 : len(b)//2 + 1] + b[-2:])
@@ -248,15 +257,16 @@
     return all(np.isclose(a_i, b_i) for a_i, b_i in zip(a, b))
 
 
 def test_impulse_response():
 
     def impulse_res_tester(sys, expected_value):
         p = plot_impulse_response(sys,
-            control=False, show_axes=False, show=False, n=10, prec=16)
+            control=False, show_axes=False, show=False, n=10, prec=16,
+            upper_limit=10)
         x, y = p[0].get_data()
         x_check = check_point_accuracy(x, expected_value[0])
         y_check = check_point_accuracy(y, expected_value[1])
         return x_check and y_check
 
     exp1 = ((0.0, 1.1111111111111112, 2.2222222222222223, 3.3333333333333335, 4.444444444444445,
         5.555555555555555, 6.666666666666667, 7.777777777777779, 8.88888888888889, 10.0),
@@ -298,15 +308,15 @@
     assert impulse_res_tester(ser1, exp7)
 
 
 def test_step_response():
 
     def step_res_tester(sys, expected_value):
         p = plot_step_response(sys,
-            control=False, show_axes=False, show=False, n=10)
+            control=False, show_axes=False, show=False, n=10, upper_limit=10)
         x, y = p[0].get_data()
         x_check = check_point_accuracy(x, expected_value[0])
         y_check = check_point_accuracy(y, expected_value[1])
         return x_check and y_check
 
     exp1 = ((0.0, 1.1111111111111112, 2.2222222222222223, 3.3333333333333335, 4.444444444444445,
         5.555555555555555, 6.666666666666667, 7.777777777777779, 8.88888888888889, 10.0),
@@ -346,15 +356,15 @@
 
 
 def test_ramp_response():
 
     def ramp_res_tester(sys, num_points, expected_value, slope=1):
         p = plot_ramp_response(sys,
             control=False, show_axes=False, show=False,
-            slope=slope, n=num_points)
+            slope=slope, n=num_points, upper_limit=10)
         x, y = p[0].get_data()
         x_check = check_point_accuracy(x, expected_value[0])
         y_check = check_point_accuracy(y, expected_value[1])
         return x_check and y_check
 
     exp1 = ((0.0, 2.0, 4.0, 6.0, 8.0, 10.0), (0.0, 0.7324667795033895, 1.9909720978650398,
         2.7956587704217783, 3.9224897567931514, 4.85022655284895))
@@ -386,16 +396,16 @@
     assert ramp_res_tester(tf5, 10, exp5, 9)
     assert ramp_res_tester(tf6, 10, exp6)
 
 
 @pytest.mark.skipif(ct is None, reason="control is not installed")
 def test_show_axes():
     def do_test(plot_func, sys, expected_num_series):
-        p1 = plot_func(sys, show=False, show_axes=False)
-        p2 = plot_func(sys, show=False, show_axes=True)
+        p1 = plot_func(sys, show=False, show_axes=False, legend=True)
+        p2 = plot_func(sys, show=False, show_axes=True, legend=True)
         assert len(p1.series) == expected_num_series
         assert len(p2.series) == expected_num_series + 2
         assert all(not isinstance(t, HVLineSeries) for t in p1.series)
         assert all(isinstance(t, HVLineSeries) for t in p2.series[:2])
         assert all(t.show_in_legend is False for t in p2.series[:2])
         p1.draw()
         p2.draw()
@@ -425,14 +435,57 @@
     do_test(plot_impulse_response)
     do_test(plot_step_response)
     do_test(plot_ramp_response)
     do_test(plot_bode_magnitude)
     do_test(plot_bode_phase)
 
 
+@pytest.mark.skipif(ct is None, reason="control is not installed")
+@pytest.mark.filterwarnings("ignore::UserWarning")
+@pytest.mark.parametrize(
+    "tfs, lower_limit, upper_limit, use_control", [
+        ([_tf1], None, None, True),
+        ([_tf1], 1, 9, True),
+        ([_tf1, _tf2], None, None, True),
+        ([_tf1, _tf2], 1, 9, True),
+        ([tfm1], None, None, True),
+        ([tfm1], 1, 9, True),
+        ([_tf1], None, None, False),
+        ([_tf1], 1, 9, False),
+        ([_tf1, _tf2], None, None, False),
+        ([_tf1, _tf2], 1, 9, False),
+        ([tfm1], None, None, False),
+        ([tfm1], 1, 9, False),
+    ]
+)
+def test_responses_lower_upper_limits(
+    tfs, lower_limit, upper_limit, use_control
+):
+    # verify that lower/upper limits are autocomputed if not provided by user
+    kwargs = dict(lower_limit=lower_limit, upper_limit=upper_limit,
+        show=False, n=10)
+
+    def do_test(func):
+        p = func(*tfs, **kwargs)
+        expected_lower_limit = 0 if not lower_limit else lower_limit
+        all_data = [s.get_data() for s in p.series]
+        assert all(np.isclose(data[0][0], expected_lower_limit)
+            for data in all_data)
+        if upper_limit:
+            assert all(np.isclose(data[0][-1], upper_limit)
+                for data in all_data)
+        else:
+            assert all(not np.isclose(data[0][-1], 10)
+                for data in all_data)
+
+    do_test(plot_step_response)
+    do_test(plot_impulse_response)
+    do_test(plot_ramp_response)
+
+
 # xfail because tf7... who knows?!?!? locally works fine, on github it's
 # random success
 @pytest.mark.xfail
 @pytest.mark.skipif(ct is None, reason="control is not installed")
 def test_plot_nyquist():
     exp1 = (
         [ 5.00000000e-01,  5.00169418e-01,  5.01314254e-01,  5.10328032e-01,
@@ -742,16 +795,16 @@
     p5 = func((num2, den2, p), **kwargs)
     d4, d5 = [t.backend[0].get_data() for t in [p4, p5]]
     assert np.allclose(d4, d5)
 
 
 @pytest.mark.skipif(ct is None, reason="control is not installed")
 def test_plot_bode_title():
-    G1 = (s+5)/(s+2)**2
-    G2 = 1/s**2
+    G1 = (s + 5) / (s + 2)**2
+    G2 = 1 / s**2
 
     p = plot_bode(G1, show=False)
     assert p.args[0].title == f"Bode Plot"
     assert p.args[1].title == ""
 
     p = plot_bode(G1, show=False, title="Test")
     assert p.args[0].title == "Test"
@@ -760,7 +813,83 @@
     p = plot_bode(G1, G2, show=False)
     assert p.args[0].title == "Bode Plot"
     assert p.args[1].title == ""
 
     p = plot_bode(G1, G2, show=False, title="Test")
     assert p.args[0].title == "Test"
     assert p.args[1].title == ""
+
+
+@pytest.mark.skipif(ct is None, reason="control is not installed")
+@pytest.mark.parametrize(
+    "func, title, expected", [
+        (plot_step_response, None, "Step Response"),
+        (plot_ramp_response, None, "Ramp Response"),
+        (plot_impulse_response, None, "Impulse Response"),
+        (plot_pole_zero, None, "Poles and Zeros"),
+        (plot_nichols, None, "Nichols Plot"),
+        (plot_nyquist, None, "Nyquist Plot"),
+        (plot_root_locus, None, "Root Locus"),
+        (plot_bode_magnitude, None, "Bode Plot (Magnitude)"),
+        (plot_bode_phase, None, "Bode Plot (Phase)"),
+        (plot_step_response, "Test", "Test"),
+        (plot_ramp_response, "Test", "Test"),
+        (plot_impulse_response, "Test", "Test"),
+        (plot_pole_zero, "Test", "Test"),
+        (plot_nichols, "Test", "Test"),
+        (plot_nyquist, "Test", "Test"),
+        (plot_root_locus, "Test", "Test"),
+        (plot_bode_magnitude, "Test", "Test"),
+        (plot_bode_phase, "Test", "Test"),
+    ]
+)
+def test_plot_title(func, title, expected):
+    G1 = (s + 5) / (s + 2)**2
+    G2 = 1 / s**2
+    kwargs = {"show": False}
+    if title:
+        kwargs["title"] = title
+    p1 = func(G1, **kwargs)
+    assert p1.title == expected
+    p2 = func(G1, G2, **kwargs)
+    assert p2.title == expected
+
+
+@pytest.mark.skipif(ct is None, reason="control is not installed")
+@pytest.mark.parametrize(
+    "func", [
+        plot_step_response, plot_ramp_response, plot_impulse_response,
+        plot_root_locus
+    ]
+)
+def test_label_mimo(func):
+    kwargs = {"show": False}
+    if func is plot_root_locus:
+        kwargs["sgrid"] = False
+        kwargs["zgrid"] = False
+    p1 = func(tfm1, **kwargs)
+    assert all("System 1" not in s.get_label(False) for s in p1.series)
+    assert p1[0].get_label(False) == "u[0] to y[0]"
+    assert p1[-1].get_label(False) == "u[1] to y[2]"
+
+    p2 = func(tfm1, tfm2, **kwargs)
+    n = int(len(p2.series) / 2)
+    assert all("System 1" in s.get_label(False) for s in p2.series[:n])
+    assert all("System 2" in s.get_label(False) for s in p2.series[n:])
+    assert p2[0].get_label(False) == "System 1 - u[0] to y[0]"
+    assert p2[n].get_label(False) == "System 2 - u[0] to y[0]"
+
+
+@pytest.mark.skipif(ct is None, reason="control is not installed")
+def test_label_mimo_plot_pole_zero():
+    kwargs = {"show": False, "sgrid": False, "zgrid": False}
+    p1 = plot_pole_zero(tfm1, **kwargs)
+    assert all("System 1" not in s.get_label(False) for s in p1.series)
+    assert p1[0].get_label(False) == "poles of u[0] to y[0]"
+    assert p1[-1].get_label(False) == "zeros of u[1] to y[2]"
+
+    p2 = plot_pole_zero(tfm1, tfm2, **kwargs)
+    n = int(len(p2.series) / 2)
+    assert all("System 1" in s.get_label(False) for s in p2.series[:n])
+    assert all("System 2" in s.get_label(False) for s in p2.series[n:])
+    assert p2[0].get_label(False) == "poles of System 1 - u[0] to y[0]"
+    assert p2[n].get_label(False) == "poles of System 2 - u[0] to y[0]"
```

### Comparing `sympy_plot_backends-3.2.0/tests/plot_functions/test_functions_2d.py` & `sympy_plot_backends-3.3.0/tests/plot_functions/test_functions_2d.py`

 * *Files identical despite different names*

### Comparing `sympy_plot_backends-3.2.0/tests/plot_functions/test_functions_3d.py` & `sympy_plot_backends-3.3.0/tests/plot_functions/test_functions_3d.py`

 * *Files identical despite different names*

### Comparing `sympy_plot_backends-3.2.0/tests/plot_functions/test_vectors.py` & `sympy_plot_backends-3.3.0/tests/plot_functions/test_vectors.py`

 * *Files identical despite different names*

### Comparing `sympy_plot_backends-3.2.0/tests/test_defaults.py` & `sympy_plot_backends-3.3.0/tests/test_defaults.py`

 * *Files identical despite different names*

### Comparing `sympy_plot_backends-3.2.0/tests/test_deprecated_module.py` & `sympy_plot_backends-3.3.0/tests/test_deprecated_module.py`

 * *Files identical despite different names*

### Comparing `sympy_plot_backends-3.2.0/tests/test_doc_utils.py` & `sympy_plot_backends-3.3.0/tests/test_doc_utils.py`

 * *Files identical despite different names*

### Comparing `sympy_plot_backends-3.2.0/tests/test_plotgrid.py` & `sympy_plot_backends-3.3.0/tests/test_plotgrid.py`

 * *Files 2% similar despite different names*

```diff
@@ -237,45 +237,49 @@
     # NOTE: I'm going to test with Plotly and not Matplotlib because I have
     # no idea how to setup test for Matplotlib, which requires interactivity...
     p = build_plotgrid(PB)
     assert isinstance(p, IPlot)
     res = p.show()
     assert isinstance(res, pn.Column)
     assert len(res.objects) == 2
-    assert isinstance(res.objects[0], pn.param.ParamMethod)
+    assert isinstance(res.objects[0], pn.GridBox)
     assert isinstance(res.objects[1], pn.GridSpec)
     # widgets grid
-    t = res.objects[0].get_root()
-    sliders = t.children[0].children[0].children
+    grid = res.objects[0]
+    assert grid.ncols == 2
+    assert grid.nrows is None
+    sliders = grid.objects
+    assert len(sliders) == 2
     assert all(
-        isinstance(s[0], bokeh.models.widgets.sliders.Slider) for s in sliders
+        isinstance(o, pn.widgets.FloatSlider) for o in sliders
     )
     # plots grid
-    assert res.objects[1].nrows == 3
-    assert res.objects[1].ncols == 1
-    assert all(
-        isinstance(res.objects[1][i, 0], pn.pane.plotly.Plotly)
-        for i in range(3)
-    )
+    plots = res.objects[1]
+    assert plots.ncols == 1
+    assert plots.nrows == 3
+    assert len(plots.objects) == 3
+    assert isinstance(plots.objects[(0, 0, 1, 1)], pn.pane.Plotly)
+    assert isinstance(plots.objects[(1, 0, 2, 1)], pn.pane.Plotly)
+    assert isinstance(plots.objects[(2, 0, 3, 1)], pn.pane.Plotly)
 
     # quick run-down to verify that no errors are raised when changing the
     # value of a widget
-    sliders[0][0].value = 2
+    sliders[0].value = 2
 
     p = build_plotgrid(BB)
     res = p.show()
-    t = res.objects[0].get_root()
-    sliders = t.children[0].children[0].children
-    sliders[0][0].value = 2
+    grid = res.objects[0]
+    sliders = grid.objects
+    sliders[0].value = 2
 
     p = build_plotgrid(MB)
     res = p.show()
-    t = res.objects[0].get_root()
-    sliders = t.children[0].children[0].children
-    sliders[0][0].value = 2
+    grid = res.objects[0]
+    sliders = grid.objects
+    sliders[0].value = 2
 
 
 @pytest.mark.filterwarnings("ignore::DeprecationWarning")
 def test_plotgrid_mode_2_matplotlib():
     from matplotlib.gridspec import GridSpec
 
     x, y, z = symbols("x, y, z")
@@ -516,37 +520,34 @@
     }
     p = plotgrid(gs=mapping, show=False, imodule="panel")
 
     assert isinstance(p, IPlot)
     res = p.show()
     assert isinstance(res, pn.Column)
     assert len(res.objects) == 2
-    assert isinstance(res.objects[0], pn.param.ParamMethod)
+    assert isinstance(res.objects[0], pn.GridBox)
     assert isinstance(res.objects[1], pn.GridSpec)
     # widgets grid
-    t = res.objects[0].get_root()
-    sliders = t.children[0].children[0].children
+    grid = res.objects[0]
+    assert grid.ncols == 2
+    assert grid.nrows is None
+    sliders = grid.objects
     assert all(
-        isinstance(s[0], bokeh.models.widgets.sliders.Slider) for s in sliders
+        isinstance(s, pn.widgets.FloatSlider) for s in sliders
     )
     # plots grid
-    assert res.objects[1].nrows == 3
-    assert res.objects[1].ncols == 3
-    assert isinstance(res.objects[1][0, 0], pn.pane.plotly.Plotly)
-    assert isinstance(res.objects[1][1, 0], pn.pane.plotly.Plotly)
-    assert isinstance(res.objects[1][2, 0], pn.pane.plotly.Plotly)
-    assert isinstance(res.objects[1][2, 1:], pn.GridSpec)
-    assert isinstance(
-        list(res.objects[1][2, 1:].objects.values())[0], pn.pane.plotly.Plotly
-    )
-    assert isinstance(res.objects[1][0:2, 1:], pn.GridSpec)
-    assert isinstance(
-        list(res.objects[1][0:2, 1:].objects.values())[0],
-        pn.pane.plotly.Plotly
-    )
+    plots = res.objects[1]
+    assert plots.ncols == 3
+    assert plots.nrows == 3
+    assert len(plots.objects) == 5
+    assert isinstance(plots.objects[(0, 0, 1, 1)], pn.pane.Plotly)
+    assert isinstance(plots.objects[(1, 0, 2, 1)], pn.pane.Plotly)
+    assert isinstance(plots.objects[(2, 0, 3, 1)], pn.pane.Plotly)
+    assert isinstance(plots.objects[(2, 1, 3, 3)], pn.pane.Plotly)
+    assert isinstance(plots.objects[(0, 1, 2, 3)], pn.pane.Plotly)
 
 
 @pytest.mark.skipif(pn is None, reason="panel is not installed")
 @pytest.mark.filterwarnings("ignore::DeprecationWarning")
 def test_panel_kw_imodule_panel():
     x = symbols("x")
     options = dict(adaptive=False, n=100, show=False, imodule="panel")
```

### Comparing `sympy_plot_backends-3.2.0/tests/test_series.py` & `sympy_plot_backends-3.3.0/tests/test_series.py`

 * *Files 0% similar despite different names*

```diff
@@ -27,14 +27,16 @@
 from sympy.external import import_module
 import numpy as np
 
 ct = import_module("control")
 scipy = import_module("scipy")
 adaptive = import_module("adaptive")
 plotly = import_module("plotly")
+pn = import_module("panel")
+ipy = import_module("ipywidgets")
 
 # NOTE:
 #
 # These tests are meant to verify that the data series generates the expected
 # numerical data.
 #
 # If your issue is related to the processing and generation of *Series
@@ -1990,15 +1992,15 @@
     )
     assert s.use_cm is use_cm
 
     s = ComplexSurfaceSeries(
         sqrt(z), (z, -2 - 3j, 4 + 5j),
         threed=False, use_cm=use_cm
     )
-    assert s.use_cm is use_cm
+    assert s.use_cm is True
 
     s = ComplexSurfaceSeries(
         sqrt(z), (z, -2 - 3j, 4 + 5j),
         threed=True, use_cm=use_cm
     )
     assert s.use_cm is use_cm
 
@@ -4534,7 +4536,31 @@
     assert np.allclose(x,
         [-3.26953084208114, -1, -0.365234578959429, -0.365234578959429 ])
     assert np.allclose(y, [0, 0, 0.691601229992822, -0.691601229992822])
 
     x, y = s2.get_data()
     assert np.allclose(x, [0, 0])
     assert np.allclose(y, [0.5, -0.5])
+
+
+@pytest.mark.skipif(pn is None, reason="panel is not installed")
+def test_params_multi_value_widgets_1():
+    # verify that data series are able to deal with widgets returning
+    # multiple values
+
+    a, b, c, x = symbols("a:c x")
+    range_slider = pn.widgets.RangeSlider(
+        value=(-2, 2), start=-5, end=5, step=0.1)
+    s = LineOver1DRangeSeries(cos(c * x), (x, a, b), n=10, adaptive=False,
+        params={
+            (a, b): range_slider,
+            c: (1, 0, 5)
+        })
+    # verify that tuples in params.keys() are going to be expanded
+    assert len(s.params) == 3
+    assert s.params[a] is range_slider
+    assert s.params[b] is range_slider
+    assert s.params[c] == (1, 0, 5)
+    # simulate update event
+    new_params = {(a, b): (-3, 4), c: 2}
+    s.params = new_params
+    assert s.params == {a: -3, b: 4, c: 2}
```

### Comparing `sympy_plot_backends-3.2.0/tests/test_utils.py` & `sympy_plot_backends-3.3.0/tests/test_utils.py`

 * *Files 20% similar despite different names*

```diff
@@ -18,15 +18,15 @@
 from sympy.external import import_module
 from sympy.physics.control import TransferFunction, TransferFunctionMatrix
 import numpy as np
 
 ct = import_module("control")
 scipy = import_module("scipy")
 
-x, a, b = symbols("x a b")
+x, a, b, s = symbols("x a b s")
 
 
 def test_plot_sympify():
     x, y = symbols("x, y")
 
     # argument is already sympified
     args = x + y
@@ -326,14 +326,51 @@
     G2 = s / (s**2 + 2*s + exp(3))
     _is_control_tf_equals(
         tf_to_control(G2),
         ct.tf([1., 0.], [1., 2., 20.08553692])
     )
 
 
+@pytest.mark.skipif(ct is None, reason="control is not installed")
+def test_tf_to_control_7():
+    # MIMO systems
+    s = symbols("s")
+
+    tf1 = TransferFunction(1, s + 2, s)
+    tf2 = TransferFunction(s + 1, s**2 + s + 1, s)
+    tf3 = TransferFunction(s + 1, s**2 + s + 1.5, s)
+    tfm = TransferFunctionMatrix(
+        [[tf1, -tf1], [tf2, -tf2], [tf3, -tf3]])
+
+    num = [[[1.0], [-1.0]], [[1.0, 1.0], [-1.0, -1.0]], [[1.0, 1.0], [-1.0, -1.0]]]
+    den = [[[1.0, 2.0], [1.0, 2.0]], [[1.0, 1.0, 1.0], [1.0, 1.0, 1.0]], [[1.0, 1.0, 1.5], [1.0, 1.0, 1.5]]]
+    tfm_expected = ct.tf(num, den)
+    _is_control_tf_equals(tf_to_control(tfm), tfm_expected)
+
+
+@pytest.mark.skipif(ct is None, reason="control is not installed")
+def test_tf_to_control_8():
+    # tuple/list of elements
+
+    tf = ([1, 2], [3, 4, 5])
+    _is_control_tf_equals(tf_to_control(tf), ct.tf([1, 2], [3, 4, 5]))
+
+    tf = (s + 2, 3*s**2 + 4*s + 5)
+    _is_control_tf_equals(tf_to_control(tf), ct.tf([1, 2], [3, 4, 5]))
+
+    tf = (a + 2, 3*a**2 + 4*a + 5)
+    _is_control_tf_equals(tf_to_control(tf), ct.tf([1, 2], [3, 4, 5]))
+
+    tf = (a + 2, 3*a**2 + 4*a + 5, a)
+    _is_control_tf_equals(tf_to_control(tf), ct.tf([1, 2], [3, 4, 5]))
+
+    tf = (s + a, 3*s**2 + 4*s + 5)
+    raises(ValueError, lambda: tf_to_control(tf))
+
+
 def test_tf_to_sympy_1():
     # symbolic expressions to TransferFunction
 
     s = symbols("s")
     G = s / (s+4) / (s+8)
     assert tf_to_sympy(G).args == TransferFunction(s, (s+4) * (s+8), s).args
 
@@ -375,18 +412,19 @@
     assert H[1, 0].args == tf2.args
     assert H[1, 1].args == (-tf2).args
     assert H[2, 0].args == tf3.args
     assert H[2, 1].args == (-tf3).args
 
 
 def test_tf_to_sympy_5():
-    # raise TypeError
+    # raise errors
     raises(TypeError, lambda: tf_to_sympy(1))
     raises(TypeError, lambda: tf_to_sympy([1, 2, 3]))
-    raises(TypeError, lambda: tf_to_sympy([[1, 2, 3], [1, 2, 3, 4]]))
+    raises(ValueError, lambda: tf_to_sympy(
+        ([1, 2, 3], [4, 5, 6, 7], s, "test")))
 
 
 @pytest.mark.skipif(ct is None, reason="control is not installed")
 def test_tf_to_sympy_6():
     # raise warnings caused by the lack of discrete-time transfer function
     # in sympy
 
@@ -417,14 +455,50 @@
     with warns(
         UserWarning,
         match="At the time of writing this message, SymPy "
     ):
         H = tf_to_sympy(G3)
         assert H.var == z
 
+@pytest.mark.parametrize(
+    "tf_tuple, tf", [
+        (([1, 2], [4, 5, 6]), TransferFunction(s+2, 4*s**2 + 5*s + 6, s)),
+        ((s+2, 4*s**2 + 5*s + 6), TransferFunction(s+2, 4*s**2 + 5*s + 6, s)),
+        # multiple free symbols: the s-variable is the first from the
+        # free-symbols set
+        ((s+a, 4*s**2 + b*s + 6), (
+            TransferFunction(s+a, 4*s**2 + b*s + 6, a),
+            TransferFunction(s+a, 4*s**2 + b*s + 6, b),
+            TransferFunction(s+a, 4*s**2 + b*s + 6, s),
+        )),
+        # one free-symbol, different from s
+        ((a+2, 4*a**2 + 5*a + 6), TransferFunction(a+2, 4*a**2 + 5*a + 6, a)),
+    ]
+)
+def test_tf_to_sympy_7(tf_tuple, tf):
+    # 2 elements-tuple to TransferFunction
+    if isinstance(tf, TransferFunction):
+        assert tf_to_sympy(tf_tuple) == tf
+    else:
+        assert tf_to_sympy(tf_tuple) in tf
+
+
+@pytest.mark.parametrize(
+    "tf_tuple, tf", [
+        (([1, 2], [4, 5, 6], s), TransferFunction(s+2, 4*s**2 + 5*s + 6, s)),
+        ((s+2, 4*s**2 + 5*s + 6, s), TransferFunction(s+2, 4*s**2 + 5*s + 6, s)),
+        ((s+a, 4*s**2 + b*s + 6, s), TransferFunction(s+a, 4*s**2 + b*s + 6, s)),
+        # multiple free-symbols, s-variable different from s
+        ((s+a, 4*s**2 + b*s + 6, a), TransferFunction(s+a, 4*s**2 + b*s + 6, a)),
+    ]
+)
+def test_tf_to_sympy_8(tf_tuple, tf):
+    # 3 elements-tuple to TransferFunction
+    assert tf_to_sympy(tf_tuple) == tf
+
 
 @pytest.mark.skipif(ct is None, reason="control is not installed")
 def test_is_discrete_time():
     a, s = symbols("a, s")
     G1 = s / (s**2 + 2*s + 3)
     G2 = s / (s**2 + a*s + 3)
     G3 = TransferFunction(s, s**2 + 2*s + 3, s)
```

